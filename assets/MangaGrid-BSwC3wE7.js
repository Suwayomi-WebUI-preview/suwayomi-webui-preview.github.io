import{bZ as De,b_ as Re,f as m,b$ as Te,c0 as Ge,j as n,aZ as Se,c1 as Ee,c2 as Pe,bV as Oe,bR as Ae,a2 as Q,aY as Be,ay as Le,az as he,aA as Ne,M as se,B as z,ai as Fe,c3 as te,c4 as ze,c5 as We,u as K,c6 as O,c7 as He,ah as Ue,Q as Ke,c8 as Ye,c9 as qe,L as V,A as J,ao as be,ca as Ze,cb as Je,cc as Qe,m as ye,h as Ve,aB as Xe,s as et,aJ as tt,aK as nt,Z as X,aM as st,d as H,e as N,z as ot,n as rt,ag as it,k as F,a0 as at,I as ct,cd as pe,aq as lt,C as je,a as Ce,S as ve,Y as A,bC as ne,b as ut,a7 as dt,T as Me,$ as ke,ce as ft,af as gt,aG as ht,aj as pt,ax as mt,l as we,aI as xt,bs as bt,cf as yt,bt as jt,q as Ct,g as vt,D as me,E as Mt}from"./index-C-NRbn2J.js";import{c as kt,C as wt,e as It,f as _t,d as $t,T as Dt,a as Rt}from"./useManageMangaLibraryState-Bu52EvVG.js";import{d as Tt}from"./Sync-D6ciS1Ub.js";import{M as $,b as Gt,a as St}from"./Mangas-BPXmRPR1.js";import{F as Et}from"./ListPreference-h7iT6dUa.js";import{A as Pt}from"./Avatar-CYWTEGlm.js";import{d as Ot}from"./PlayArrow-B7NCVHVC.js";import{D as At}from"./StyledFab-CZM_ncxT.js";const Bt=(e,t)=>e.filter(s=>t.includes(s)),Y=(e,t,s)=>{const r=e.keys[0];Array.isArray(t)?t.forEach((a,o)=>{s((i,f)=>{o<=e.keys.length-1&&(o===0?Object.assign(i,f):i[e.up(e.keys[o])]=f)},a)}):t&&typeof t=="object"?(Object.keys(t).length>e.keys.length?e.keys:Bt(e.keys,Object.keys(t))).forEach(o=>{if(e.keys.includes(o)){const i=t[o];i!==void 0&&s((f,u)=>{r===o?Object.assign(f,u):f[e.up(o)]=u},i)}}):(typeof t=="number"||typeof t=="string")&&s((a,o)=>{Object.assign(a,o)},t)};function E(e){return e?"Level".concat(e):""}function oe(e){return e.unstable_level>0&&e.container}function Lt(e){return function(s){return"var(--Grid-".concat(s,"Spacing").concat(E(e.unstable_level),")")}}function ee(e){return function(s){return e.unstable_level===0?"var(--Grid-".concat(s,"Spacing)"):"var(--Grid-".concat(s,"Spacing").concat(E(e.unstable_level-1),")")}}function U(e){return e.unstable_level===0?"var(--Grid-columns)":"var(--Grid-columns".concat(E(e.unstable_level-1),")")}const Nt=({theme:e,ownerState:t})=>{const s=ee(t),r={};return Y(e.breakpoints,t.size,(a,o)=>{let i={};o==="grow"&&(i={flexBasis:0,flexGrow:1,maxWidth:"100%"}),o==="auto"&&(i={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof o=="number"&&(i={flexGrow:0,flexBasis:"auto",width:"calc(100% * ".concat(o," / ").concat(U(t)," - (").concat(U(t)," - ").concat(o,") * (").concat(s("column")," / ").concat(U(t),"))")}),a(r,i)}),r},Ft=({theme:e,ownerState:t})=>{const s=ee(t),r={};return Y(e.breakpoints,t.offset,(a,o)=>{let i={};o==="auto"&&(i={marginLeft:"auto"}),typeof o=="number"&&(i={marginLeft:o===0?"0px":"calc(100% * ".concat(o," / ").concat(U(t)," + ").concat(s("column")," * ").concat(o," / ").concat(U(t),")")}),a(r,i)}),r},zt=({theme:e,ownerState:t})=>{if(!t.container)return{};const s=oe(t)?{["--Grid-columns".concat(E(t.unstable_level))]:U(t)}:{"--Grid-columns":12};return Y(e.breakpoints,t.columns,(r,a)=>{r(s,{["--Grid-columns".concat(E(t.unstable_level))]:a})}),s},Wt=({theme:e,ownerState:t})=>{if(!t.container)return{};const s=ee(t),r=oe(t)?{["--Grid-rowSpacing".concat(E(t.unstable_level))]:s("row")}:{};return Y(e.breakpoints,t.rowSpacing,(a,o)=>{var i;a(r,{["--Grid-rowSpacing".concat(E(t.unstable_level))]:typeof o=="string"?o:(i=e.spacing)==null?void 0:i.call(e,o)})}),r},Ht=({theme:e,ownerState:t})=>{if(!t.container)return{};const s=ee(t),r=oe(t)?{["--Grid-columnSpacing".concat(E(t.unstable_level))]:s("column")}:{};return Y(e.breakpoints,t.columnSpacing,(a,o)=>{var i;a(r,{["--Grid-columnSpacing".concat(E(t.unstable_level))]:typeof o=="string"?o:(i=e.spacing)==null?void 0:i.call(e,o)})}),r},Ut=({theme:e,ownerState:t})=>{if(!t.container)return{};const s={};return Y(e.breakpoints,t.direction,(r,a)=>{r(s,{flexDirection:a})}),s},Kt=({ownerState:e})=>{const t=Lt(e);return{minWidth:0,boxSizing:"border-box",...e.container&&{display:"flex",flexWrap:"wrap",...e.wrap&&e.wrap!=="wrap"&&{flexWrap:e.wrap},gap:"".concat(t("row")," ").concat(t("column"))}}},Yt=e=>{const t=[];return Object.entries(e).forEach(([s,r])=>{r!==!1&&r!==void 0&&t.push("grid-".concat(s,"-").concat(String(r)))}),t},qt=(e,t="xs")=>{function s(r){return r===void 0?!1:typeof r=="string"&&!Number.isNaN(Number(r))||typeof r=="number"&&r>0}if(s(e))return["spacing-".concat(t,"-").concat(String(e))];if(typeof e=="object"&&!Array.isArray(e)){const r=[];return Object.entries(e).forEach(([a,o])=>{s(o)&&r.push("spacing-".concat(a,"-").concat(String(o)))}),r}return[]},Zt=e=>e===void 0?[]:typeof e=="object"?Object.entries(e).map(([t,s])=>"direction-".concat(t,"-").concat(s)):["direction-xs-".concat(String(e))],Jt=De(),Qt=Re("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,t)=>t.root});function Vt(e){return Pe({props:e,name:"MuiGrid",defaultTheme:Jt})}function Xt(e={}){const{createStyledComponent:t=Qt,useThemeProps:s=Vt,componentName:r="MuiGrid"}=e,a=(u,c)=>{const{container:l,direction:h,spacing:p,wrap:d,size:b}=u,g={root:["root",l&&"container",d!=="wrap"&&"wrap-xs-".concat(String(d)),...Zt(h),...Yt(b),...l?qt(p,c.breakpoints.keys[0]):[]]};return Oe(g,y=>Ae(r,y),{})};function o(u,c,l=()=>!0){const h={};return u===null||(Array.isArray(u)?u.forEach((p,d)=>{p!==null&&l(p)&&c.keys[d]&&(h[c.keys[d]]=p)}):typeof u=="object"?Object.keys(u).forEach(p=>{const d=u[p];d!=null&&l(d)&&(h[p]=d)}):h[c.keys[0]]=u),h}const i=t(zt,Ht,Wt,Nt,Ut,Kt,Ft),f=m.forwardRef(function(c,l){var ie,ae,ce,le,ue,de;const h=Te(),p=s(c),d=Ge(p),{className:b,children:g,columns:y=12,container:j=!1,component:M="div",direction:I="row",wrap:w="wrap",size:_={},offset:S={},spacing:C=0,rowSpacing:v=C,columnSpacing:T=C,unstable_level:k=0,...G}=d,D=o(_,h.breakpoints,L=>L!==!1),R=o(S,h.breakpoints),x=(ie=c.columns)!=null?ie:k?void 0:y,P=(ae=c.spacing)!=null?ae:k?void 0:C,B=(le=(ce=c.rowSpacing)!=null?ce:c.spacing)!=null?le:k?void 0:v,W=(de=(ue=c.columnSpacing)!=null?ue:c.spacing)!=null?de:k?void 0:T,q={...d,level:k,columns:x,container:j,direction:I,wrap:w,spacing:P,rowSpacing:B,columnSpacing:W,size:D,offset:R},Z=a(q,h);return n.jsx(i,{ref:l,as:M,ownerState:q,className:Se(Z.root,b),...G,children:m.Children.map(g,L=>{var fe,ge;return m.isValidElement(L)&&Ee(L,["Grid"])?m.cloneElement(L,{unstable_level:(ge=(fe=L.props)==null?void 0:fe.unstable_level)!=null?ge:k+1}):L})})});return f.muiName="Grid",f}const re=Xt({createStyledComponent:Q("div",{name:"MuiGrid2",slot:"Root",overridesResolver:(e,t)=>t.root}),componentName:"MuiGrid2",useThemeProps:e=>Be({props:e,name:"MuiGrid2"})}),en=m.forwardRef(({MenuItemProps:e,className:t,label:s,LeftIcon:r,renderLabel:a,RightIcon:o,...i},f)=>n.jsxs(Le,{...e,ref:f,className:t,...i,children:[r&&n.jsx(he,{children:n.jsx(r,{fontSize:"small"})}),n.jsx(Ne,{children:s}),o&&n.jsx(he,{style:{minWidth:0},children:n.jsx(o,{fontSize:"small"})})]})),Ie=m.forwardRef((e,t)=>{const{parentMenuOpen:s,label:r,renderLabel:a,RightIcon:o=te(We,ze),LeftIcon:i,children:f,className:u,tabIndex:c,ContainerProps:l={},MenuProps:h,...p}=e,d=se.useIsTouchDevice(),{ref:b,...g}=l,y=m.useRef(null);m.useImperativeHandle(t,()=>y.current);const j=m.useRef(null);m.useImperativeHandle(b,()=>j.current);const M=m.useRef(null),[I,w]=m.useState(!1),_=x=>{if(I!==x){if(e.disabled){w(!1);return}w(x)}},S=x=>{d||(_(!0),g.onMouseEnter&&g.onMouseEnter(x))},C=x=>{_(!1),g.onMouseLeave&&g.onMouseLeave(x)},v=()=>{var P,B;const x=(B=(P=j.current)==null?void 0:P.ownerDocument.activeElement)!=null?B:null;if(M.current==null)return!1;for(const W of M.current.children)if(W===x)return!0;return!1},T=x=>{d||(x.target===j.current&&_(!0),g.onFocus&&g.onFocus(x))},k=x=>{_(!I),g.onClick&&g.onClick(x)},G=x=>{var B,W,q;if(x.key==="Escape")return;v()&&x.stopPropagation();const P=(B=j.current)==null?void 0:B.ownerDocument.activeElement;if(x.key==="ArrowLeft"&&v()&&((W=j.current)==null||W.focus()),x.key==="ArrowRight"&&x.target===j.current&&x.target===P){const Z=(q=M.current)==null?void 0:q.children[0];Z==null||Z.focus()}},D=I&&s;let R;return e.disabled||(R=c!==void 0?c:-1),n.jsxs(z,{...g,ref:j,onFocus:T,onClick:k,tabIndex:R,onMouseEnter:S,onMouseLeave:C,onKeyDown:G,children:[n.jsx(en,{MenuItemProps:p,className:u,ref:y,LeftIcon:i,RightIcon:o,label:r,renderLabel:a}),n.jsx(Fe,{style:{pointerEvents:"none"},anchorEl:y.current,anchorOrigin:{horizontal:te("right","left"),vertical:"top"},transformOrigin:{horizontal:te("left","right"),vertical:"top"},open:D,autoFocus:!1,disableAutoFocus:!0,disableEnforceFocus:!0,onClose:()=>{_(!1)},...h,children:n.jsx(z,{ref:M,style:{pointerEvents:"auto"},children:f})})]})});Ie.displayName="NestedMenuItem";const tn=["remove_from_library"],nn=({manga:e,handleSelection:t,selectedMangas:s,onClose:r,setHideMenu:a})=>{var T,k;const{t:o}=K(),[i,f]=m.useState(!1),u=!!e,c=s!=null?s:[],l=Ze(u,Gt),h=Je(u),p=Qe(u),d=!!e&&e.downloadCount===e.chapters.totalCount,b=!!(e!=null&&e.downloadCount),g=!!(e!=null&&e.unreadCount),y=!!e&&e.unreadCount!==e.chapters.totalCount,{openCategorySelect:j,CategorySelectComponent:M}=kt({mangaId:e==null?void 0:e.id,mangaIds:s?$.getIds(c):void 0,onClose:()=>r(!0),addToLibrary:!1}),I=()=>{t==null||t(e.id,!0),r(!0)},w=(G,D)=>{$.performAction(G,e?[e.id]:$.getIds(D),{wasManuallyMarkedAsRead:!0}).catch(ye()),r(!tn.includes(G))},{downloadableMangas:_,downloadedMangas:S,unreadMangas:C,readMangas:v}=m.useMemo(()=>({downloadableMangas:[...$.getNotDownloaded(c),...$.getPartiallyDownloaded(c)],downloadedMangas:[...$.getPartiallyDownloaded(c),...$.getFullyDownloaded(c)],unreadMangas:[...$.getUnread(c),...$.getPartiallyRead(c)],readMangas:[...$.getPartiallyRead(c),...$.getFullyRead(c)]}),[c]);return n.jsxs(n.Fragment,{children:[!!t&&u&&n.jsx(O,{onClick:I,Icon:He,title:o("chapter.action.label.select")}),h(!d)&&n.jsx(Ie,{disabled:p(!_.length),LeftIcon:Ue,label:l("download",_.length),parentMenuOpen:!0,children:n.jsx(wt,{mangaIds:u?[e.id]:$.getIds(c),closeMenu:()=>r(!0)})}),h(b)&&n.jsx(O,{Icon:Ke,disabled:p(!S.length),onClick:()=>w("delete",S),title:l("delete",S.length)}),h(g)&&n.jsx(O,{Icon:Ye,disabled:p(!C.length),onClick:()=>w("mark_as_read",C),title:l("mark_as_read",C.length)}),h(y)&&n.jsx(O,{Icon:qe,disabled:p(!v.length),onClick:()=>w("mark_as_unread",v),title:l("mark_as_unread",v.length)}),u&&n.jsx(V,{to:"".concat(J.migrate.childRoutes.search.path((T=e==null?void 0:e.sourceId)!=null?T:-1,(k=e==null?void 0:e.id)!=null?k:-1),"?query=").concat(e==null?void 0:e.title),state:{mangaTitle:e==null?void 0:e.title},style:{textDecoration:"none",color:"inherit"},children:n.jsx(O,{Icon:It,title:l("migrate",c.length)})}),u&&n.jsx(O,{onClick:()=>{f(!0),a(!0)},Icon:Tt,title:l("track",c.length)}),n.jsx(O,{onClick:()=>{j(!0),a(!0)},Icon:_t,title:l("change_categories",c.length)}),n.jsx(O,{onClick:()=>w("remove_from_library",c),Icon:$t,title:l("remove_from_library",c.length)}),M,i&&n.jsx(be,{open:!0,maxWidth:"md",fullWidth:!0,scroll:"paper",onClose:()=>{f(!1),r(!0)},children:n.jsx(Dt,{manga:e})})]})},sn=({mangaIdToMigrateTo:e,onClose:t})=>{const{t:s}=K(),r=Ve(),{mangaId:a}=Xe(),o=Number(a),{settings:{migrateChapters:i,migrateCategories:f,migrateTracking:u,deleteChapters:c}}=et(),[l,h]=m.useState(!1),p=ot(ye()),d=async b=>{if(o==null)throw new Error('MigrateDialog::migrate: unexpected mangaId "'.concat(o,'"'));rt(s("migrate.label.info"),"info"),h(!0);try{await $.migrate(o,e,{mode:b,migrateChapters:i,migrateCategories:f,migrateTracking:u,deleteChapters:c}),r(J.manga.path(e),{replace:!0})}catch(g){h(!1)}};return n.jsxs(be,{open:!0,fullWidth:!0,onClose:t,children:[n.jsx(tt,{children:s("migrate.dialog.title")}),n.jsx(nt,{dividers:!0,children:n.jsxs(Et,{children:[n.jsx(X,{disabled:l,label:s("chapter.title_one"),checked:i,onChange:(b,g)=>p("migrateChapters",g)}),n.jsx(X,{disabled:l,label:s("category.title.category_one"),checked:f,onChange:(b,g)=>p("migrateCategories",g)}),n.jsx(X,{disabled:l,label:s("tracking.title"),checked:u,onChange:(b,g)=>p("migrateTracking",g)}),n.jsx(X,{disabled:l,label:s("migrate.dialog.label.delete_downloaded"),checked:c,onChange:(b,g)=>p("deleteChapters",g)})]})}),n.jsx(st,{children:n.jsxs(H,{direction:"row",sx:{justifyContent:"space-between",width:"100%"},children:[n.jsx(N,{disabled:l,component:V,to:J.manga.path(e),children:s("migrate.dialog.action.button.show_entry")}),n.jsxs(H,{direction:"row",children:[n.jsx(N,{disabled:l,onClick:t,children:s("global.button.cancel")}),n.jsx(N,{disabled:l,onClick:()=>d("copy"),children:s("global.button.copy")}),n.jsx(N,{disabled:l,onClick:()=>d("migrate"),children:s("global.button.migrate")})]})]})})]})},_e=m.forwardRef(({id:e,selected:t,handleSelection:s,asCheckbox:r=!1,popupState:a},o)=>{const{t:i}=K(),f=se.useIsTouchDevice(),u=m.useMemo(()=>it(a),[a]),c=d=>{d.stopPropagation(),d.preventDefault()},l=(d,b)=>{c(d),s==null||s(e,b)},h=d=>{f||(c(d),a.open(d),u.onClick(d))};return s?t!==null?r?n.jsx(F,{title:i(t?"global.button.deselect":"global.button.select"),children:n.jsx(at,{checked:t,onMouseDown:c,onChange:l})}):null:r?n.jsx(F,{title:i("global.button.options"),children:n.jsx(ct,{ref:o,...u,onClick:h,onTouchStart:h,"aria-label":"more",size:"large",onMouseDown:c,children:n.jsx(pe,{})})}):n.jsx(F,{title:i("global.button.options"),children:n.jsx(N,{ref:o,...u,onClick:h,onTouchStart:h,className:"manga-option-button",size:"small",variant:"contained",sx:{minWidth:"unset",paddingX:"0",paddingY:"2.5px",visibility:a.isOpen?"visible":"hidden",pointerEvents:"none","@media not (pointer: fine)":{visibility:"hidden",pointerEvents:void 0}},onMouseDown:d=>d.stopPropagation(),children:n.jsx(pe,{})})}):null}),on=Q("div")({position:"absolute",bottom:0,width:"100%",height:"30%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),rn=Q("div")({position:"absolute",bottom:0,width:"100%",height:"20%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),an=({manga:e,longPressBind:t,popupState:s,handleClick:r,mangaLinkTo:a,selected:o,inLibraryIndicator:i,isInLibrary:f,gridLayout:u,handleSelection:c,continueReadingButton:l,mangaBadges:h,mode:p})=>{const d=m.useRef(null),{id:b,title:g}=e;return n.jsx(lt,{component:V,...t(()=>s.open(d.current)),onClick:r,to:a,state:{mangaTitle:g},sx:{textDecoration:"none",touchCallout:"none"},children:n.jsxs(z,{sx:{display:"flex",flexDirection:"column",m:.25,outline:o?"4px solid":void 0,borderRadius:o?"1px":void 0,outlineColor:y=>y.palette.primary.main,backgroundColor:y=>o?y.palette.primary.main:void 0,"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:p==="source"?"none":"flex"}}},children:[n.jsx(je,{sx:{aspectRatio:St,display:"flex"},children:n.jsxs(Ce,{sx:{position:"relative",height:"100%"},children:[n.jsx(ve,{alt:g,src:$.getThumbnailUrl(e),imgStyle:i&&f?{height:"100%",width:"100%",objectFit:"cover",filter:"brightness(0.4)"}:{height:"100%",width:"100%",objectFit:"cover"},spinnerStyle:{display:"grid",placeItems:"center"}}),n.jsxs(H,{direction:"row",sx:{alignItems:"start",justifyContent:"space-between",position:"absolute",top:y=>y.spacing(1),left:y=>y.spacing(1),right:y=>y.spacing(1)},children:[h,n.jsx(_e,{ref:d,popupState:s,id:b,selected:o,handleSelection:c})]}),n.jsxs(n.Fragment,{children:[u!==A.Comfortable&&n.jsxs(n.Fragment,{children:[n.jsx(on,{}),n.jsx(rn,{})]}),n.jsxs(H,{direction:"row",sx:{justifyContent:u!==A.Comfortable?"space-between":"end",alignItems:"end",position:"absolute",bottom:0,width:"100%",p:1,gap:1},children:[u!==A.Comfortable&&n.jsx(F,{title:g,placement:"top",children:n.jsx(ne,{component:"h3",sx:{color:"white",textShadow:"0px 0px 3px #000000"},children:g})}),l]})]})]})}),u===A.Comfortable&&n.jsx(H,{sx:{pb:1},children:n.jsx(F,{title:g,placement:"top",children:n.jsx(ne,{component:"h3",sx:{color:y=>o?y.palette.primary.contrastText:"text.primary",height:"3rem",pt:.5},children:g})})})]})})},cn=({manga:e,longPressBind:t,popupState:s,handleClick:r,mangaLinkTo:a,selected:o,inLibraryIndicator:i,isInLibrary:f,handleSelection:u,continueReadingButton:c,mangaBadges:l,mode:h})=>{const p=m.useRef(null),{id:d,title:b}=e;return n.jsx(je,{children:n.jsx(Ce,{component:V,to:a,state:{mangaTitle:b},onClick:r,...t(()=>s.open(p.current)),sx:{touchCallout:"none","@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:h==="source"?"none":"inline-flex"}}},children:n.jsxs(ut,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5,position:"relative"},children:[n.jsx(Pt,{variant:"rounded",sx:{width:56,height:56,flex:"0 0 auto",marginRight:1},children:n.jsx(ve,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%",imageRendering:"pixelated",filter:i&&f?"brightness(0.4)":void 0},alt:e.title,src:$.getThumbnailUrl(e)})}),n.jsx(z,{sx:{display:"flex",flexDirection:"row",flexGrow:1,width:"min-content"},children:n.jsx(F,{title:b,placement:"top",children:n.jsx(ne,{variant:"h6",component:"h3",children:b})})}),n.jsxs(H,{direction:"row",sx:{alignItems:"center",gap:.5},children:[l,c,n.jsx(_e,{ref:p,popupState:s,id:d,selected:o,handleSelection:u,asCheckbox:!0})]})]})})})},ln=({showContinueReadingButton:e,chapter:t,mangaLinkTo:s})=>{const{t:r}=K();if(!e||!t)return null;const{sourceOrder:a}=t,o=a===1;return n.jsx(F,{title:r(o?"global.button.start":"global.button.resume"),children:n.jsx(N,{variant:"contained",size:"small",sx:{minWidth:"unset",py:.5,px:.75},component:V,to:"".concat(s,"/chapter/").concat(t.sourceOrder),state:{resumeMode:dt.getReaderResumeMode(t)},onClick:i=>i.stopPropagation(),onMouseDown:i=>i.stopPropagation(),children:n.jsx(Ot,{})})})},un=Q("div")(({theme:e})=>({display:"flex",height:"fit-content",borderRadius:e.shape.borderRadius,overflow:"hidden"})),xe=Q(Me)(({theme:e})=>({color:e.palette.primary.contrastText,paddingInline:e.spacing(.3)})),dn=({inLibraryIndicator:e,updateLibraryState:t,isInLibrary:s,unread:r,downloadCount:a,mode:o})=>{const{t:i}=K(),f=se.useIsTouchDevice(),{options:{showUnreadBadge:u,showDownloadBadge:c}}=ke();return n.jsxs(un,{children:[!f&&e&&o==="source"&&n.jsx(N,{className:"source-manga-library-state-button",component:"div",variant:"contained",size:"small",onMouseDown:l=>l.stopPropagation(),onClick:l=>{l.preventDefault(),l.stopPropagation(),t()},sx:{display:"none"},color:s?"error":"primary",children:i(s?"manga.action.library.remove.label.action":"manga.button.add_to_library")}),e&&s&&n.jsx(Me,{className:"source-manga-library-state-indicator",sx:{backgroundColor:"primary.dark",color:"primary.contrastText",p:.3},children:i("manga.button.in_library")}),(u&&o==="default"||o==="duplicate")&&(r!=null?r:0)>0&&n.jsx(xe,{sx:{backgroundColor:"primary.main",color:"primary.contrastText"},children:r}),(c&&o==="default"||o==="duplicate")&&(a!=null?a:0)>0&&n.jsx(xe,{sx:{backgroundColor:"secondary.main",color:"secondary.contrastText"},children:a})]})},fn=(e,t,s,r)=>{switch(e){case"default":case"source":case"duplicate":return J.manga.path(t);case"migrate.search":return"".concat(J.migrate.childRoutes.search.path(s!=null?s:"-1",t),"?query=").concat(r);case"migrate.select":return"";default:throw new Error('getMangaLinkTo: unexpected MangaCardMode "'.concat(e,'"'))}},gn=e=>{const{manga:t,gridLayout:s,inLibraryIndicator:r,selected:a,handleSelection:o,mode:i="default"}=e,{id:f,firstUnreadChapter:u,downloadCount:c,unreadCount:l}=t,{options:{showContinueReadingButton:h}}=ke(),{CategorySelectComponent:p,updateLibraryState:d,isInLibrary:b}=Rt(t,i==="source"),g=fn(i,t.id,t.sourceId,t.title),[y,j]=m.useState(!1),M=(C,v)=>{const T=i==="default",k=i==="source",G=i==="migrate.select",D=a!==null;if(G||D||(T||k)&&v){if(C.preventDefault(),k){d();return}if(D){o==null||o(f,!a,{selectRange:C.shiftKey});return}if(T){v==null||v();return}G&&j(!0)}},I=ft((C,{context:v})=>{C.shiftKey=!0,M(C,v)}),w=m.useMemo(()=>s===A.List?cn:an,[s]),_=m.useMemo(()=>n.jsx(ln,{showContinueReadingButton:h&&i==="default",chapter:u,mangaLinkTo:g}),[h,u,g]),S=m.useMemo(()=>n.jsx(dn,{inLibraryIndicator:r,isInLibrary:b,unread:l,downloadCount:c,updateLibraryState:d,mode:i}),[r,b,l,c,d]);return n.jsxs(n.Fragment,{children:[y&&n.jsx(sn,{mangaIdToMigrateTo:t.id,onClose:()=>j(!1)}),n.jsx(gt,{variant:"popover",popupId:"manga-card-action-menu",children:C=>n.jsxs(n.Fragment,{children:[n.jsx(w,{...e,longPressBind:I,popupState:C,handleClick:M,mangaLinkTo:g,isInLibrary:b,inLibraryIndicator:r,continueReadingButton:_,mangaBadges:S}),!!o&&C.isOpen&&n.jsx(ht,{...pt(C),children:(v,T)=>n.jsx(nn,{manga:t,handleSelection:o,onClose:v,setHideMenu:T})}),p]})})]})},hn=mt.forwardRef(({children:e,...t},s)=>n.jsx(re,{...t,ref:s,container:!0,spacing:1,children:e})),pn=(e,t,s,r=12)=>{const a=Math.ceil(e/t),o=s===A.List?r:r/a;return({children:i,...f})=>n.jsx(re,{...f,size:o,children:i})},$e=(e,t,s,r=!1,a,o,i)=>n.jsx(gn,{manga:e,gridLayout:t,inLibraryIndicator:s,selected:r?a==null?void 0:a.includes(e.id):null,handleSelection:o,mode:i}),mn=m.forwardRef(({isLoading:e,mangas:t,inLibraryIndicator:s,GridItemContainer:r,gridLayout:a,isSelectModeActive:o,selectedMangaIds:i,handleSelection:f,mode:u},c)=>n.jsx(re,{ref:c,container:!0,spacing:1,sx:{width:"100%",overflowX:"auto",display:"-webkit-inline-box",flexWrap:"nowrap"},children:e?n.jsx(we,{}):t.map(l=>n.jsx(r,{children:$e(l,a,s,o,i,f,u)},l.id))})),xn=e=>"MangaGrid-snapshot-location-".concat(e.key),bn=m.forwardRef(({isLoading:e,mangas:t,inLibraryIndicator:s,GridItemContainer:r,gridLayout:a,hasNextPage:o,loadMore:i,isSelectModeActive:f,selectedMangaIds:u,handleSelection:c,mode:l},h)=>{const p=xt(),d=xn(p),[b]=bt(d,void 0),g=m.useRef(),y=j=>{const M=window.location.href;clearTimeout(g.current),g.current=setTimeout(()=>{M===window.location.href&&jt.session.setItem(d,j,!1)},250)};return m.useEffect(()=>clearTimeout(g.current),[p.key,g.current]),n.jsxs(n.Fragment,{children:[n.jsx(z,{ref:h,children:n.jsx(yt,{useWindowScroll:!0,overscan:window.innerHeight*.25,totalCount:t.length,components:{List:hn,Item:r},restoreStateFrom:b,stateChanged:y,endReached:()=>i(),computeItemKey:j=>t[j].id,itemContent:j=>$e(t[j],a,s,f,u,c,l)})}),f&&a===A.List?n.jsx(z,{sx:{paddingBottom:At}}):e?n.jsx(we,{}):o?n.jsx("div",{style:{height:"75px"}}):null]})}),_n=({mangas:e,isLoading:t,message:s,messageExtra:r,topOffset:a,hasNextPage:o,loadMore:i,gridLayout:f,horizontal:u,noFaces:c,inLibraryIndicator:l,isSelectModeActive:h,selectedMangaIds:p,handleSelection:d,mode:b,retry:g,gridWrapperProps:y})=>{var k,G;const{t:j}=K(),{navBarWidth:M}=Ct(),I=m.useRef(null),w=m.useRef(null),[_,S]=m.useState((G=(k=w.current)==null?void 0:k.offsetWidth)!=null?G:Math.max(0,document.documentElement.offsetWidth-M)),[C]=vt("ItemWidth",300),v=m.useMemo(()=>pn(_,C,f),[_,C,f]);return m.useLayoutEffect(()=>{let D;const R=x=>{D=setTimeout(()=>{if(document.body.style.overflow.includes("hidden")){R(250);return}document.body.style.overflowY=f===A.List?"auto":"scroll"},x)};return R(0),()=>{clearTimeout(D)}},[f]),m.useLayoutEffect(()=>()=>{document.body.style.overflowY="auto"},[]),me(w,m.useCallback(()=>{S((()=>{var x;const R=(x=w.current)==null?void 0:x.offsetWidth;return R||document.documentElement.offsetWidth-M})())},[M])),me(I,m.useCallback((D,R)=>{const x=D[0].target.clientHeight,P=x>document.documentElement.clientHeight;if(!t&&x){if(P){R.disconnect();return}i(),R.disconnect()}},[I,i,t])),!t&&e.length===0?n.jsx(Mt,{noFaces:c,message:s!=null?s:j("manga.error.label.no_mangas_found"),messageExtra:r,retry:g,topOffset:a}):n.jsx(z,{...y,ref:w,sx:{...y==null?void 0:y.sx,overflow:"hidden"},children:u?n.jsx(mn,{ref:I,isLoading:t,mangas:e,inLibraryIndicator:l,GridItemContainer:v,gridLayout:f,isSelectModeActive:h,selectedMangaIds:p,handleSelection:d,mode:b}):n.jsx(bn,{ref:I,isLoading:t,mangas:e,inLibraryIndicator:l,GridItemContainer:v,hasNextPage:o,loadMore:i,gridLayout:f,isSelectModeActive:h,selectedMangaIds:p,handleSelection:d,mode:b})})};export{_n as M,nn as a,gn as b,xn as g};
