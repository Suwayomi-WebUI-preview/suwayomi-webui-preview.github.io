import{bH as V,f as p,bI as U,c as _,j as v,at as F,u as R,aK as q,az as z,i as A,I as B}from"./index-kfrPXZL3.js";import{d as G}from"./useManageMangaLibraryState-C8lNiMs1.js";function D(e,t){if(e==null)return e;if(e.length===0&&(!t||t&&e!==""))return null;const r=e instanceof Array?e[0]:e;return r==null?r:!t&&r===""?null:r}function $(e){return e==null?e:String(e)}function H(e){const t=D(e);return t==null?t:t===""?null:+t}function W(e){return e==null?e:String(e)}function J(e){const t=D(e,!0);return t==null?t:String(t)}const j={encode:W,decode:J},Se={encode:$,decode:H};function X(e,t){const r={},n=Object.keys(t);for(const s of n){const a=t[s];e[s]?r[s]=e[s].encode(t[s]):r[s]=a==null?a:String(a)}return r}class Y{constructor(){this.paramsMap=new Map,this.registeredParams=new Map}set(t,r,n,s){this.paramsMap.set(t,{stringified:r,decoded:n,decode:s})}has(t,r,n){if(!this.paramsMap.has(t))return!1;const s=this.paramsMap.get(t);return s?s.stringified===r&&(n==null||s.decode===n):!1}get(t){var r;if(this.paramsMap.has(t))return(r=this.paramsMap.get(t))==null?void 0:r.decoded}registerParams(t){for(const r of t){const n=this.registeredParams.get(r)||0;this.registeredParams.set(r,n+1)}}unregisterParams(t){for(const r of t){const n=(this.registeredParams.get(r)||0)-1;n<=0?(this.registeredParams.delete(r),this.paramsMap.has(r)&&this.paramsMap.delete(r)):this.registeredParams.set(r,n)}}clear(){this.paramsMap.clear(),this.registeredParams.clear()}}const b=new Y;function Z(e,t){var r,n,s;const a={};let c=!1;const o=Object.keys(e);let i=o;if(t.includeKnownParams||t.includeKnownParams!==!1&&o.length===0){const f=Object.keys((r=t.params)!=null?r:{});i.push(...f)}for(const f of i){const l=e[f];if(l!=null&&typeof l=="object"){a[f]=l;continue}c=!0,a[f]=(s=(n=t.params)==null?void 0:n[f])!=null?s:j}return c?a:e}function E(e,t,r,n){var s;if(!r||!t.length)return e;let a={...e},c=!1;for(const o of t)Object.prototype.hasOwnProperty.call(a,o)||(a[o]=(s=r[o])!=null?s:n,c=!0);return c?a:e}const ee=Object.prototype.hasOwnProperty;function K(e,t){return e===t?e!==0||t!==0||1/e===1/t:e!==e&&t!==t}function Q(e,t,r){var n,s;if(K(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const a=Object.keys(e),c=Object.keys(t);if(a.length!==c.length)return!1;for(let o=0;o<a.length;o++){const i=(s=(n=void 0)==null?void 0:n.equals)!=null?s:K;if(!ee.call(t,a[o])||!i(e[a[o]],t[a[o]]))return!1}return!0}function T(e,t,r){const n={},s=Object.keys(t);for(const a of s){const c=t[a],o=e[a];let i;if(r.has(a,o,c.decode))i=r.get(a);else{if(i=c.decode(o),c.equals&&r.has(a,o)){const d=r.get(a);c.equals(i,d)&&(i=d)}i!==void 0&&r.set(a,o,i,c.decode)}i===void 0&&c.default!==void 0&&(i=c.default),n[a]=i}return n}function te(){let e;function t(r,n,s){const a=T(r,n,s);return e!=null&&Q(e,a)?e:(e=a,a)}return t}function re(e){let t;for(const r in e)if(e[r].urlName){const n=e[r].urlName,s="".concat(n,"\0").concat(r);t?t.push(s):t=[s]}return t?t.join("\n"):void 0}function ne(e){if(e)return Object.fromEntries(e.split("\n").map(t=>t.split("\0")))}function ae(e,t){var r;let n={};for(const s in e)((r=t[s])==null?void 0:r.urlName)!=null?n[t[s].urlName]=e[s]:n[s]=e[s];return n}let x,C,L,N={};const I=(e,t,r)=>{if(x===t&&L===e&&C===r)return N;x=t,L=e;const n=e(t!=null?t:"");C=r;const s=ne(r);for(let[a,c]of Object.entries(n)){s!=null&&s[a]&&(delete n[a],a=s[a],n[a]=c);const o=N[a];Q(c,o)&&(n[a]=o)}return N=n,n};function se(e,t){var r;for(const n in e)((r=t[n])==null?void 0:r.default)!==void 0&&e[n]!==void 0&&t[n].encode(t[n].default)===e[n]&&(e[n]=void 0)}function oe({changes:e,updateType:t,currentSearchString:r,paramConfigMap:n,options:s}){const{searchStringToObject:a,objectToSearchString:c}=s;t==null&&(t=s.updateType);let o;const i=I(a,r),d=E(n,Object.keys(e),s.params);let f;if(typeof e=="function"){const g=T(i,d,b);f=e(g)}else f=e;o=X(d,f),s.removeDefaultsFromUrl&&se(o,d),o=ae(o,d);let l;return t==="push"||t==="replace"?l=c(o):l=c({...i,...o}),l!=null&&l.length&&l[0]!=="?"&&(l="?".concat(l)),l!=null?l:""}function ce({searchString:e,adapter:t,navigate:r,updateType:n}){const a={...t.location,search:e};r&&(typeof n=="string"&&n.startsWith("replace")?t.replace(a):t.push(a))}const ie=e=>e(),le=e=>setTimeout(()=>e(),0),P=[];function ue(e,{immediate:t}={}){P.push(e);let r=t?ie:le;P.length===1&&r(()=>{const n=P.slice();P.length=0;const s=n[0].currentSearchString;let a;for(let c=0;c<n.length;++c){const o=c===0?n[c]:{...n[c],currentSearchString:a};a=oe(o)}e.options.skipUpdateWhenNoChange&&a===s||ce({searchString:a!=null?a:"",adapter:n[n.length-1].adapter,navigate:!0,updateType:n[n.length-1].updateType})})}function fe(e,t){const{adapter:r,options:n}=V(),[s]=p.useState(te),{paramConfigMap:a,options:c}=pe(e,t),o=p.useMemo(()=>U(n,c),[n,c]);let i=Z(a,o);const d=I(o.searchStringToObject,r.location.search,re(i));o.includeAllParams&&(i=E(i,Object.keys(d),o.params,j));const f=s(d,i,b),l=Object.keys(i).join("\0");p.useEffect(()=>{const h=l.split("\0");return b.registerParams(h),()=>{b.unregisterParams(h)}},[l]);const g={adapter:r,paramConfigMap:i,options:o},m=p.useRef(g);m.current==null&&(m.current=g),p.useEffect(()=>{m.current.adapter=r,m.current.paramConfigMap=i,m.current.options=o},[r,i,o]);const[O]=p.useState(()=>(M,y)=>{const{adapter:k,paramConfigMap:S,options:u}=m.current;y==null&&(y=u.updateType),ue({changes:M,updateType:y,currentSearchString:k.location.search,paramConfigMap:S,options:u,adapter:k},{immediate:!u.enableBatching})});return[f,O]}var de=fe;function pe(e,t){let r,n;return e===void 0?(r={},n=t):Array.isArray(e)?(r=Object.fromEntries(e.map(s=>[s,"inherit"])),n=t):(r=e,n=t),{paramConfigMap:r,options:n}}const me=(e,t,r)=>{const n=p.useMemo(()=>({[e]:t!=null?t:"inherit"}),[e,t]),[s,a]=de(n,r),c=s[e],o=p.useCallback((i,d)=>a(typeof i=="function"?f=>{const l=i(f[e]);return{[e]:l}}:{[e]:i},d),[e,a]);return[c,o]},he=_(v.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),ve=e=>{const{isClosable:t=!0}=e,r=F(),{t:n}=R(),[s,a]=p.useState(),c=q(),[o,i]=me("query",j),[d,f]=p.useState(!t||!!o),l=z.useRef(),[g,m]=p.useState(o!=null?o:"");s!==c.key&&(a(c.key),m(o!=null?o:""),f(!t||!!o));const O=d||!!o,h=u=>{var w;t&&(f(u),u&&((w=l.current)==null||w.focus()))};function M(u){u!==""&&(i(u),h(!1))}const y=()=>{m(""),i(void 0),h(!1)},k=()=>{g||h(!1)},S=u=>{(u.key==="F3"||u.ctrlKey&&u.key==="f")&&(u.preventDefault(),h(!0))};return p.useEffect(()=>(window.addEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)}),[S]),O?v.jsx(G,{autoFocus:!0,variant:"standard",value:g,onCancel:y,onChange:u=>m(u.target.value),onKeyDown:u=>{u.key==="Enter"&&M(g)},onBlur:k,inputRef:l,sx:{...r.applyStyles("light",{"& .MuiInput-underline:before":{borderBottomColor:"primary.contrastText"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.contrastText"},"& .MuiInput-underline:after":{borderBottomColor:"primary.dark"}})},cancelButtonProps:{sx:{...r.applyStyles("light",{color:"primary.contrastText"})}}}):v.jsx(A,{title:n("search.title.search"),children:v.jsx(B,{onClick:()=>h(!0),color:"inherit",children:v.jsx(he,{})})})};export{ve as A,Se as N,j as S,he as a,me as u};
