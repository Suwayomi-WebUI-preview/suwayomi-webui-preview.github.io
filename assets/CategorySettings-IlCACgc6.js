import{u as A,j as e,o as x,T as K,S as V,C as T,I,r as c,b1 as W,e as i,ae as $,h as z,g as b,i as J,b2 as Q,_ as X,$ as Y,a0 as Z,a1 as ee,B as v,m as k}from"./index-B9sXdsff.js";import{A as te}from"./Add-CbVr3wBZ.js";import{D as oe,a as ae,b as re,c as se,S as ne,v as ie,d as le,e as ce}from"./DragHandle-Dg9zOwDM.js";import{D as de,F as ge}from"./StyledFab-tSHcntjY.js";import{E as me}from"./EmptyViewAbsoluteCentered-Bt5j7wSo.js";import{E as ue}from"./Edit-CVh9NpDS.js";import{D as xe}from"./Delete-CcMybldr.js";import{L as he}from"./ListCardContent-B7hvkgHx.js";import{C as pe}from"./Card-DbJySDoj.js";import{u as fe}from"./useAppTitle-DSyYosGS.js";import{T as Ce}from"./TextField-syre69i-.js";import{F as je,C as ye}from"./Checkbox-CplIld-b.js";import"./useFormControl-DktQh-yB.js";import"./formControlState-Dq1zat_P.js";import"./SwitchBase-CNV_Zt6H.js";const F=({category:a,onEdit:n})=>{const{t:d}=A(),g=()=>{c.deleteCategory(a.id)};return e.jsx(x,{sx:{p:1,pb:0},children:e.jsx(pe,{children:e.jsxs(he,{sx:{gap:2},children:[e.jsx(oe,{}),e.jsx(K,{sx:{flexGrow:1},variant:"h6",component:"h2",children:a.name}),e.jsxs(V,{sx:{flexDirection:"row"},children:[e.jsx(T,{title:d("global.button.edit"),children:e.jsx(I,{component:x,onClick:n,children:e.jsx(ue,{})})}),e.jsx(T,{title:d("chapter.action.download.delete.label.action"),children:e.jsx(I,{component:x,onClick:g,children:e.jsx(xe,{})})})]})]})})})};function Ge(){const{t:a}=A();fe(a("category.dialog.title.edit_category_other"));const{data:n,loading:d,error:g,refetch:L}=c.useGetCategories(W,{notifyOnNetworkStatusChange:!0}),r=i.useMemo(()=>{var o;const t=[...(o=n==null?void 0:n.categories.nodes)!=null?o:[]];return t.length>0&&t[0].name==="Default"&&t.shift(),t},[n]),[h,S]=i.useState(-1),[O,m]=i.useState(!1),[p,f]=i.useState(""),[C,j]=i.useState(!1),[w,{reset:B}]=c.useReorderCategory(),E=$(),G=ae.useSensorsForDevice(),[l,u]=i.useState(null),R=(t,o,s)=>{const y=t[o];w({variables:{input:{id:y.id,position:s+1}}}).catch(()=>B())},H=t=>{const{active:o,over:s}=t;if(u(null),!s||o.id===s.id)return;const y=r.findIndex(D=>D.id===o.id),P=r.findIndex(D=>D.id===s.id);R(r,y,P)},N=()=>{f(""),j(!1),S(-1)},M=()=>{N(),m(!0)},U=t=>{f(r[t].name),j(r[t].default),S(t),m(!0)},_=()=>{m(!1)},q=()=>{if(m(!1),h===-1)c.createCategory({name:p,default:C}).response.catch(t=>k(a("category.error.label.create_failure"),"error",b(t)));else{const t=r[h];c.updateCategory(t.id,{name:p,default:C}).response.catch(o=>k(a("global.error.label.failed_to_save_changes"),"error",b(o)))}};return d?e.jsx(z,{}):g?e.jsx(me,{message:a("category.error.label.request_failure"),messageExtra:b(g),retry:()=>L().catch(J())}):e.jsxs(e.Fragment,{children:[e.jsx(re,{sensors:G,collisionDetection:se,onDragStart:t=>{var o;return u((o=r.find(s=>s.id===t.active.id))!=null?o:null)},onDragEnd:H,onDragCancel:()=>u(null),onDragAbort:()=>u(null),children:e.jsxs(x,{sx:{paddingBottom:de},children:[e.jsx(ne,{items:r,strategy:ie,children:r.map((t,o)=>e.jsx(le,{id:t.id,isDragging:t.id===(l==null?void 0:l.id),children:e.jsx(F,{category:t,onEdit:()=>U(o)})},t.id))}),e.jsx(ce,{isActive:!!l,children:e.jsx(F,{category:l,onEdit:Q})})]})}),e.jsx(ge,{color:"primary","aria-label":"add",style:{position:"fixed",bottom:E.spacing(2),right:E.spacing(2)},onClick:M,children:e.jsx(te,{})}),e.jsxs(X,{open:O,onClose:_,children:[e.jsx(Y,{id:"form-dialog-title",children:a(h===-1?"category.dialog.title.new_category":"category.dialog.title.edit_category_one")}),e.jsxs(Z,{children:[e.jsx(Ce,{autoFocus:!0,margin:"dense",id:"name",label:a("category.label.category_name"),type:"text",fullWidth:!0,value:p,onChange:t=>f(t.target.value)}),e.jsx(je,{control:e.jsx(ye,{checked:C,onChange:t=>j(t.target.checked)}),label:a("category.label.use_as_default_category")})]}),e.jsxs(ee,{children:[e.jsx(v,{onClick:_,color:"primary",children:a("global.button.cancel")}),e.jsx(v,{onClick:q,color:"primary",children:a("global.button.submit")})]})]})]})}export{Ge as CategorySettings};
