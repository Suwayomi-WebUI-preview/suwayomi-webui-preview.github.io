var fs=Object.defineProperty;var xs=(e,t,r)=>t in e?fs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var ve=(e,t,r)=>xs(e,typeof t!="symbol"?t+"":t,r);import{cP as Nr,b as l,cQ as Tt,j as a,i as Yt,at as v,n as Kt,cR as ms,E as Ke,cS as ct,cT as Zt,S as N,z as $,T as tt,cw as vs,cU as Ss,cV as bs,cW as Wt,a1 as Ze,a9 as er,C as F,cX as kr,cY as H,cZ as pt,c_ as cr,as as mt,c$ as _r,d0 as Rs,d1 as Ie,f as St,b5 as Cs,d2 as bt,d3 as ce,a as Hr,d4 as Ye,d5 as z,d6 as le,bW as q,M as We,cB as Ps,d7 as Ts,d8 as Es,d9 as ws,cC as Is,am as nt,da as lr,aO as rt,db as dr,bn as Rt,A as tr,L as kt,c as Ae,u as W,c2 as Vr,a$ as zr,b0 as Ur,ax as Ct,a3 as Dt,a4 as Lt,c4 as As,ap as Ms,B as st,dc as Os,dd as ur,de as Fr,df as qt,dg as Wr,dh as js,di as gr,dj as Gr,aV as ys,dk as Ve,b3 as Ds,dl as it,s as $r,I as ae,r as Et,c3 as Ls,aE as Bs,bb as Ns,e as _t,aN as ks,dm as rr,a6 as _s,a7 as Hs,m as Xr,dn as vt,al as hr,bd as Vs,aX as He,dp as zs,dq as Yr,g as Kr,aA as Zr,dr as pr,O as fr,ds as ft,dt as Q,bc as Us,du as Jt,d as Fs,az as Ws,dv as Gs,dw as $s}from"./index-CeCBjXeT.js";import{b as J,R as Xs,a as y,w as ue,c as lt,d as qe,e as Ht,g as Be,f as be,i as de,h as ze,j as et,k as Z,l as xr,m as mr,n as ie,o as Ys,p as Pt,q as Ks,r as Zs,s as qs,t as Js,v as qr,x as Jr,y as Qr,S as Qs,z as en,A as Vt,B as wt,C as Ue,D as sr,E as tn,F as rn,G as sn,H as nn,I as nr,J as an,K as on,L as es,M as cn,N as Fe,O as ln,P as vr,Q as Mt,T as dn,U as un,V as gn,W as hn,X as ts,Y as rs,Z as pn,_ as fn,$ as ar,a0 as xn,a1 as mn,a2 as jt,a3 as Sr,a4 as vn,a5 as Sn,a6 as Gt,a7 as bn}from"./ReaderSettingsTabs-CrvahYHe.js";import{r as Rn}from"./Strings-CAV0u705.js";import{C as Le,b as Qt,F as ss}from"./Chapters-DdZm8pXE.js";import{P as Cn}from"./PushPin-B_9_-Hv3.js";import{P as Pn}from"./PushPinOutlined-D_ovba8B.js";import{L as yt}from"./Link-BmzdHVwT.js";import{S as ns}from"./Select-DFkwrDej.js";import{C as as,c as Tn,F as En,l as wn,n as In,a as An}from"./useManageMangaLibraryState-yj-_cK0N.js";import{q as Mn}from"./index-Bf2-sy__.js";import{C as On,B as jn,I as yn}from"./ChapterListCard-BajT25uJ.js";import{D as Dn}from"./Download-D2fUWiGL.js";import{D as Ln}from"./Delete-CAPdu8QE.js";import{D as Bn}from"./ChapterCardMetadata-DTmh8ZE1.js";import{F as Nn,I as kn}from"./IconWebView-D9CnXFh2.js";import{F as or}from"./Mangas-DKt-Z8NQ.js";import{C as _n}from"./CheckboxInput-C6NClL50.js";import{E as Bt}from"./EmptyViewAbsoluteCentered-UfbEthVP.js";import{u as Hn}from"./SpinnerImage-Ba65IT3Q.js";import{u as Vn}from"./use-window-event-B3Ml1v7u.js";import{u as zn}from"./use-merged-ref-HKC1eTco.js";import{u as Un}from"./useAppTitle-I3e5bSgI.js";import"./TabsMenu-D6bQ7y0Z.js";import"./Tabs-CuLz5G1R.js";import"./Trans-BExkjahw.js";import"./Slider-CISLKei5.js";import"./ListSubheader-8OEgymNj.js";import"./Add-B6e7JWdz.js";import"./DateHelper-DJA0esoW.js";import"./Asserts-CPOF6ww_.js";import"./ThreeStateCheckboxInput-CUGAEFRm.js";import"./Checkbox-D5qWUVxh.js";import"./SwitchBase-irjrQwZj.js";import"./FormGroup-DJjwwOOU.js";import"./DoneAll-CWTgsjy4.js";import"./MUI.util-CEodEA2f.js";import"./ListCardContent-Um38IMt6.js";import"./Card-BVFtYHOO.js";import"./CardActionArea-Dnoc7rOV.js";import"./Refresh-Bi1FZ9OB.js";const Fn=e=>{const{activeScopes:t,enableScope:r,disableScope:s}=Nr(),n=l.useRef([]);l.useEffect(()=>e?(n.current=[...t],r(Tt.NONE),n.current.forEach(s),()=>{s(Tt.NONE),n.current.forEach(r)}):()=>{},[e])},Wn=({isOpen:e,close:t})=>{const r=J(c=>c.settings);Fn(e);const[s,n]=l.useState(0),[o,i]=l.useState(!1);return e?a.jsx(Yt,{open:e,maxWidth:"md",fullWidth:!0,onClose:t,hideBackdrop:s===ms.FILTER,sx:{...v(o,{opacity:.75})},children:a.jsx(Kt,{sx:{p:0},children:a.jsx(Xs,{activeTab:s,setActiveTab:n,settings:r,updateSetting:(...c)=>y.updateSetting(...c),deleteSetting:(...c)=>y.deleteSetting(...c),setTransparent:i})})}):null},Gn=({isDesktop:e,readerNavBarWidth:t})=>{const r=lt(u=>u.scrollbar),{currentPageIndex:s,pages:n,totalPages:o}=qe(u=>({currentPageIndex:u.pages.currentPageIndex,pages:u.pages.pages,totalPages:u.pages.totalPages})),{readingDirection:i,shouldShowPageNumber:c,progressBarType:d}=J(u=>({readingDirection:u.settings.readingDirection.value,shouldShowPageNumber:u.settings.shouldShowPageNumber,progressBarType:u.settings.progressBarType})),p=Ht(u=>u.progressBar.isMaximized),g=l.useMemo(()=>{const u=Be(s,n).name,h="/",f="".concat(u).concat(h).concat(o);return i===ct.LTR?f:Rn(f,h)},[s,n,o,i]);return!c||p||e&&d===Zt.STANDARD||p&&d===Zt.HIDDEN?null:a.jsx(N,{sx:{position:"fixed",left:t,right:0,bottom:u=>"max(calc(".concat(u.spacing(1)," + ").concat(r.xSize,"px), env(safe-area-inset-bottom))"),alignItems:"center",transition:u=>"left 0.".concat(u.transitions.duration.shortest,"s")},children:a.jsx($,{sx:{p:.5,borderRadius:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:a.jsx(tt,{sx:{color:"white"},children:g})})})},$n=ue(Gn,[y.useOverlayMode,Ke],["isDesktop","readerNavBarWidth"]);function br(e){return e.substring(2).toLowerCase()}function Xn(e,t){return t.documentElement.clientWidth<e.clientX||t.documentElement.clientHeight<e.clientY}function Yn(e){const{children:t,disableReactTree:r=!1,mouseEvent:s="onClick",onClickAway:n,touchEvent:o="onTouchEnd"}=e,i=l.useRef(!1),c=l.useRef(null),d=l.useRef(!1),p=l.useRef(!1);l.useEffect(()=>(setTimeout(()=>{d.current=!0},0),()=>{d.current=!1}),[]);const g=vs(Ss(t),c),u=bs(x=>{const S=p.current;p.current=!1;const T=Wt(c.current);if(!d.current||!c.current||"clientX"in x&&Xn(x,T))return;if(i.current){i.current=!1;return}let m;x.composedPath?m=x.composedPath().includes(c.current):m=!T.documentElement.contains(x.target)||c.current.contains(x.target),!m&&(r||!S)&&n(x)}),h=x=>S=>{p.current=!0;const T=t.props[x];T&&T(S)},f={ref:g};return o!==!1&&(f[o]=h(o)),l.useEffect(()=>{if(o!==!1){const x=br(o),S=Wt(c.current),T=()=>{i.current=!0};return S.addEventListener(x,u),S.addEventListener("touchmove",T),()=>{S.removeEventListener(x,u),S.removeEventListener("touchmove",T)}}},[u,o]),s!==!1&&(f[s]=h(s)),l.useEffect(()=>{if(s!==!1){const x=br(s),S=Wt(c.current);return S.addEventListener(x,u),()=>{S.removeEventListener(x,u)}}},[u,s]),l.cloneElement(t,f)}const Rr=Ze(tt)({boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",textAlign:"center",userSelect:"none",cursor:"pointer"}),Kn=Ze(N,{shouldForwardProp:er(["progressBarPosition"])})(({theme:e,progressBarPosition:t})=>({position:"fixed",pointerEvents:"all",touchAction:"none",...v(be(t).isHorizontal,{justifyContent:"flex-end",bottom:0,right:0}),...v(be(t).isVertical,{top:0,bottom:0}),...v(be(t).isLeft,{alignItems:e.direction==="ltr"?"flex-start":"flex-end"}),...v(be(t).isRight,{alignItems:e.direction==="ltr"?"flex-end":"flex-start"})})),Zn=Ze(N)(({theme:e})=>({flexDirection:"row",justifyContent:"center",alignItems:"center",gap:e.spacing(.5)})),qn=Ze(N)({flexDirection:"row",flexGrow:1,overflow:"hidden"}),Jn=Ze($,{shouldForwardProp:er(["currentPagesIndex","pagesLength","progressBarPosition"])})(({currentPagesIndex:e,pagesLength:t,progressBarPosition:r})=>({position:"absolute",pointerEvents:"none",...v(be(r).isHorizontal,{left:0,width:"".concat((e+1)/t*100,"%"),height:"100%"}),...v(be(r).isVertical,{top:0,width:"100%",height:"".concat((e+1)/t*100,"%")})})),Qn=({pageName:e,currentPagesIndex:t,pagesLength:r,isDragging:s,boxProps:n,children:o,progressBarPosition:i})=>a.jsx(F,{title:e,slotProps:{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}},placement:kr[i],children:a.jsx($,{...n,sx:{position:"absolute",cursor:s?"grabbing":"grab",...v(be(i).isHorizontal,{left:"".concat(Math.max(0,t-1)/(r-1)*100,"%"),width:"calc(100% / ".concat(r-1,")"),height:"100%"}),...v(be(i).isVertical,{top:"".concat(Math.max(0,t-1)/(r-1)*100,"%"),width:"100%",height:"calc(100% / ".concat(r-1,")")}),...n==null?void 0:n.sx},children:o})}),ea=Ze(N)({position:"relative",flexDirection:"row",flexGrow:1}),ta={[pt.EDGE]:[{rect:[0,0,100,33.33],type:H.NEXT},{rect:[0,33.33,33.33,66.66],type:H.NEXT},{rect:[66.66,33.33,33.33,66.66],type:H.NEXT},{rect:[33.33,33.33,33.33,33.33],type:H.MENU},{rect:[33.33,66.66,33.33,33.33],type:H.PREVIOUS}],[pt.KINDLE]:[{rect:[0,0,100,33.33],type:H.MENU},{rect:[0,33.33,33.33,66.66],type:H.PREVIOUS},{rect:[33.33,33.33,66.66,66.66],type:H.NEXT}],[pt.L_SHAPE]:[{rect:[0,0,100,33.33],type:H.PREVIOUS},{rect:[0,33.33,33.33,33.33],type:H.PREVIOUS},{rect:[33.33,33.33,33.33,33.33],type:H.MENU},{rect:[66.66,33.33,33.33,33.33],type:H.NEXT},{rect:[0,66.66,100,33.33],type:H.NEXT}],[pt.RIGHT_LEFT]:[{rect:[0,0,33.33,100],type:H.PREVIOUS},{rect:[33.33,0,33.33,100],type:H.MENU},{rect:[66.66,0,33.33,100],type:H.NEXT}],[pt.DISABLED]:[{rect:[0,0,100,100],type:H.MENU}]},ra={[H.PREVIOUS]:{text:"global.label.previous",color:"rgba(255, 114, 118, .5)"},[H.NEXT]:{text:"global.label.next",color:"rgba(144, 238, 144, .5)"},[H.MENU]:{text:"global.label.menu",color:"rgba(0, 0, 0, .5)"}};class Se{static invertRect(t,{vertical:r,horizontal:s,isRTL:n}){const o=r?this.invertVertical(t):t,i=s?this.invertHorizontal(o):o;return n?this.invertHorizontal(i):i}static getRegions(t,r){return ta[t].map(({type:n,rect:o})=>({type:n,rect:this.invertRect(o,r)}))}static isCanvasReusable(t,r,s,n,o){var f;const i=this.layout===t,c=this.width===r,d=this.height===s,p=!!this.canvas,g=this.language===cr.language,u=((f=this.invertMode)==null?void 0:f.vertical)===o.vertical&&this.invertMode.horizontal===o.horizontal&&this.invertMode.isRTL===o.isRTL,h=this.fontStyle===n;return p&&c&&d&&i&&g&&u&&h}static drawCanvas(t,r,s,n,o){o.forEach(({type:i,rect:[c,d,p,g]})=>{const{text:u,color:h}=ra[i],f=mt(u),x=(E,R)=>E/100*R,S=x(c,r),T=x(d,s),m=x(p,r),P=x(g,s),I=(E,R)=>(E+R)*.5+E*.5,w=I(S,m),A=I(T,P);t.beginPath(),t.rect(S,T,m,P),t.fillStyle=h,t.strokeStyle=h,t.lineWidth=.1,t.stroke(),t.fill(),t.strokeStyle="black",t.textAlign="center",t.textBaseline="middle",t.font="".concat(n.fontSize," ").concat(n.fontFamily),t.strokeStyle="black",t.lineWidth=3,t.strokeText(f,w,A),t.lineWidth=1,t.fillStyle="white",t.fillText(f,w,A)})}static getOrCreateCanvas(t,r,s,n,o){if(this.isCanvasReusable(t,r,s,n,o))return this.canvas;const i=document.createElement("canvas"),c=i.getContext("2d");c.canvas.width=r,c.canvas.height=s;const d=this.getRegions(t,o);return this.drawCanvas(c,r,s,n,d),this.layout=t,this.canvas=i,this.width=r,this.height=s,this.language=cr.language,this.invertMode=o,this.regions=d,this.fontStyle=n,i}static doesRegionContainPos(t,r,s){const[n,o,i,c]=t.rect;return r>=n&&r<=n+i&&s>=o&&s<=o+c}static getAction(t,r){var i;const s=t/this.width*100,n=r/this.height*100,o=(i=this.regions)==null?void 0:i.find(c=>this.doesRegionContainPos(c,s,n));return o?o.type:H.MENU}}ve(Se,"layout",null),ve(Se,"canvas",null),ve(Se,"width",null),ve(Se,"height",null),ve(Se,"language",null),ve(Se,"invertMode",null),ve(Se,"regions",null),ve(Se,"fontStyle",null),ve(Se,"invertVertical",([t,r,s,n])=>[t,100-(r+n),s,n]),ve(Se,"invertHorizontal",([t,r,s,n])=>[100-(t+s),r,s,n]);const sa=(e,t,r)=>{if(e===Ie.X){if(t===le.BACKWARD)return r==="ltr"?-1:1;if(t===le.FORWARD)return r==="ltr"?1:-1}return t===le.BACKWARD?-1:1},pe=class pe{static scroll(t,r,s,n,o,i,c=_r.LARGE){if(!o)return;const d=bt[n],p=Rs().direction===d,g=de(s),u=Math.abs(o.scrollTop)<=1,h=Math.floor(o.scrollTop)===o.scrollHeight-o.clientHeight||Math.ceil(o.scrollTop)===o.scrollHeight-o.clientHeight,f=Math.abs(o.scrollLeft)<=1,x=o.scrollWidth-o.clientWidth-Math.floor(Math.abs(o.scrollLeft))<=1||o.scrollWidth-o.clientWidth-Math.ceil(Math.abs(o.scrollLeft))<=1,S=p?f:x,T=p?x:f,m=c/100,P=sa(r,t,d),I=(A,E)=>A+E*m*P;ze().setIsVisible(!1),i(!1);const w=(A,E,R)=>{if(A&&t===le.BACKWARD&&g){pe.openChapter("previous");return}if(E&&t===le.FORWARD&&g){pe.openChapter("next");return}o.scroll({...R,behavior:"smooth"})};switch(r){case Ie.X:w(S,T,{left:I(o.scrollLeft,o.clientWidth)});break;case Ie.Y:w(u,h,{top:I(o.scrollTop,o.clientHeight)});break;default:throw new Error('Unexpected "ScrollDirection" ('.concat(r,")"))}}static openChapter(t,r=!0,s=!0){const{currentChapter:n,previousChapter:o,nextChapter:i,chapters:c,visibleChapters:{lastLeadingChapterSourceOrder:d,lastTrailingChapterSourceOrder:p},setReaderStateChapters:g}=et(),{shouldInformAboutMissingChapter:u,shouldInformAboutScanlatorChange:h,shouldUseInfiniteScroll:f}=Z();if(!n)return;const x=typeof t=="number",S=t==="previous";if(!(x||S&&!!o||!S&&!!i))return;(async()=>{const w=x?c.find(E=>E.id===t):S?o:i;if(!w)return;const A=w.sourceOrder<n.sourceOrder;try{r&&await pe.checkNextChapterConsistency(A?"previous":"next",n,w,u,h);const E=d<=w.sourceOrder&&p>=w.sourceOrder,R=f&&(!s||E);R&&g(C=>qs(A,C,w.sourceOrder,s,A?!1:void 0,A?void 0:!1)),y.navigateToChapter(w,{resumeMode:Js(x||!R,A),updateInitialChapter:!R})}catch(E){}})().catch(St())}static async checkNextChapterConsistency(t,r,s,n,o){if(!r||!s)return;const i=Le.getGap(r,s),c=!o||r.scanlator===s.scanlator,d=!n||!i;if(!(!c||!d))return;const g={previous:{scanlator:"reader.chapter_transition.warning.previous.scanlator",chapter_number:"reader.chapter_transition.warning.previous.chapter_number"},next:{scanlator:"reader.chapter_transition.warning.next.scanlator",chapter_number:"reader.chapter_transition.warning.next.chapter_number"}},u=c?"":mt(g[t].scanlator,{nextScanlator:s.scanlator,currentScanlator:r.scanlator}),h=d?"":mt(g[t].chapter_number,{count:i,nextChapter:"#".concat(s.chapterNumber," ").concat(s.name),currentChapter:"#".concat(r.chapterNumber," ").concat(r.name)}),f=!c&&!d?"\n\n":"",x="".concat(u).concat(f).concat(h);await Cs({title:mt("reader.chapter_transition.warning.title"),message:x,actions:{confirm:{title:mt("global.button.open")}}})}static openPage(t,r,s=!0){const{currentPageIndex:n,setPageToScrollToIndex:o,pages:i,transitionPageMode:c,setTransitionPageMode:d}=xr(),{readingDirection:p,readingMode:g,shouldShowTransitionPage:u}=Z(),h=bt[p.value],f=q(t,t==="previous"?"next":"previous",r!=null?r:h),x=Be(n,i),S=mr("previous",x.pagesIndex,i),T=mr("next",x.pagesIndex,i),m=ie(i[0]),P=ie(i[i.length-1]),I=x.primary.index===0,w=n===P,A=Ys(c,g.value),E=de(g.value);s&&(ze().setIsVisible(!1),Pt().setShowPreview(!1));const R=()=>d(ce.NONE);if(typeof t=="number"){o(t),R();return}const C=E&&A,M=!E&&c===ce.PREVIOUS||C,D=!E&&c===ce.NEXT||C;if(I&&(!u||M)&&f==="previous"&&!!et().previousChapter){pe.openChapter("previous");return}if(w&&(!u||D)&&f==="next"&&!!et().nextChapter){pe.openChapter("next");return}const j=f==="previous",G=f==="next";if(A&&!E&&(M&&G||D&&j)){R(),o(M?m:P);return}if((I&&j||w&&G)&&!E){d(j?ce.PREVIOUS:ce.NEXT);return}o(j?S:T)}static useUpdateCurrentPageIndex(){const t=y.useUpdateChapter(),{settings:{downloadAheadLimit:r}}=Hr();return l.useCallback((s,n=!0,o=!1)=>{const{currentPageIndex:i,setCurrentPageIndex:c}=xr(),{currentChapter:d,chapters:p,previousChapter:g,nextChapter:u,visibleChapters:h,setReaderStateChapters:f}=et();if(s===i&&!o||(c(s),!d))return;const x=Le.getNextChapters(d,p,{offset:Ye.NEXT}),S=i>s?Ye.PREVIOUS:Ye.NEXT;y.downloadAhead(d,u,x,s,r),y.preloadChapter(s,d.pageCount,S===Ye.NEXT?u:g,h.lastLeadingChapterSourceOrder,h.lastTrailingChapterSourceOrder,f,S);const T=()=>{const m=qr(d.id);if(!m)return;const P=o?m.pageCount-1:s,I=P===m.pageCount-1;t({lastPageRead:P,isRead:I?!0:void 0})};if(clearTimeout(pe.updateCurrentPageTimeout),n){pe.updateCurrentPageTimeout=setTimeout(T,1e3);return}T()},[r])}static updateCurrentPageOnScroll(t,r,s,n,o){var g;const i=bt[o],c=t.current.findIndex(u=>u&&Ks(u,n,{bottom:1,left:q(0,window.innerWidth+1,i),right:q(1,0,i)})),d=(g=t.current)==null?void 0:g[t.current.length-1],p=d&&Zs(d,n,o);if(c!==-1){if(p){s(c,!1,!0);return}s(c,c!==r)}}static handleClick(t,r){if(!t)return;const{readingMode:s,readingDirection:n,isStaticNav:o,scrollAmount:i}=Z(),c=r.currentTarget.getBoundingClientRect(),d=r.clientX-c.left,p=r.clientY-c.top,g=Se.getAction(d,p);Pt().setShowPreview(!1);const u=de(s.value),h=s.value===z.CONTINUOUS_HORIZONTAL?Ie.X:Ie.Y;switch(g){case H.MENU:ze().setIsVisible(o||!ze().isVisible);break;case H.PREVIOUS:case H.NEXT:u?pe.scroll(g===H.PREVIOUS?le.BACKWARD:le.FORWARD,h,s.value,n.value,t,Pt().setShowPreview,i):pe.openPage(g===H.PREVIOUS?"previous":"next","ltr");break;default:throw new Error('Unexpected "TapZoneRegionType" ('.concat(g,")"))}}static useHandleProgressDragging(t,r,s,n,o,i,c){l.useEffect(()=>{if(!r)return()=>{};const{isHorizontal:d}=be(o),p=h=>{if(!t.current)return;const f=ie(Jr(h,t.current,n,d,c,i));ie(s)!==f&&pe.openPage(f,void 0,!1)},g=h=>{p(h)},u=h=>{h.touches.length>0&&p(h.touches[0])};return document.addEventListener("mousemove",g),document.addEventListener("touchmove",u),()=>{document.removeEventListener("mousemove",g),document.removeEventListener("touchmove",u)}},[r,s,n,o])}};ve(pe,"updateCurrentPageTimeout");let V=pe;const na=l.memo(Ze($,{shouldForwardProp:er(["isFirstPage","isLastPage"])})(({isFirstPage:e,isLastPage:t})=>({flexGrow:1,height:"100%",cursor:"pointer",borderLeftWidth:e?0:void 0,borderRightWidth:t?0:void 0}))),aa=l.memo(({page:e,pagesIndex:t,isCurrentPage:r,isLeadingPage:s,isTrailingPage:n,totalPages:o,showDraggingStyle:i,primaryPageLoadState:c,secondaryPageLoadState:d,createProgressBarSlot:p,...g})=>{const u=l.useMemo(()=>p(e,t,c,d,r,s,n,o,i),[p,e,t,c,d,r,s,n,o,i]);return a.jsx(na,{...g,isFirstPage:t===0,isLastPage:t===o-1,children:u})}),oa=({slotProps:e,slots:t,createProgressBarSlot:r,progressBarPosition:s,direction:n,fullSegmentClicks:o})=>{var C,M,D,k,B,j,G,fe,se,ge,K,_,L,Re,Me,Ce,ne,Oe,Ge,Pe,Te,Ne,xe,$e,Je,at,je,Ee,X,ye,ke,_e;const{pages:i,pageLoadStates:c,totalPages:d,currentPageIndex:p}=qe(b=>({pages:b.pages.pages,pageLoadStates:b.pages.pageLoadStates,totalPages:b.pages.totalPages,currentPageIndex:b.pages.currentPageIndex})),g=J(b=>b.settings.readingMode.value),{isDragging:u,setIsDragging:h}=Ht(b=>({isDragging:b.progressBar.isDragging,setIsDragging:b.progressBar.setIsDragging})),f=l.useRef(null),x=l.useRef(void 0),[S,T]=l.useState(0),m=l.useRef(null);We(m,l.useCallback(()=>{const b=m.current;if(!b)return;const{paddingLeft:Y,paddingRight:he}=getComputedStyle(b),U=6,me=b.clientWidth-parseFloat(Y)-parseFloat(he),Qe=g===z.DOUBLE_PAGE?me*2+U:me;T(Qe)},[g]));const P=l.useMemo(()=>Be(p,i).pagesIndex,[p,i]),I=be(s).isHorizontal,w=l.useMemo(()=>Be(p,i),[p,i]),A=l.useCallback((...b)=>q(b[0],b[1],n),[n]);V.useHandleProgressDragging(f,u,w,i,s,A,o);const E=b=>{if(!f.current)return;const Y="touches"in b;V.openPage(ie(Jr(Y?b.touches[0]:b,f.current,i,I,o,A)),void 0,!1),clearTimeout(x.current),x.current=setTimeout(()=>h(!0),250)},R=()=>{h(!1),clearTimeout(x.current)};return a.jsx(Kn,{...e==null?void 0:e.container,progressBarPosition:s,children:a.jsxs(Zn,{...e==null?void 0:e.progressBarRoot,children:[a.jsx(Rr,{...(C=e==null?void 0:e.progressBarPageTexts)==null?void 0:C.base,...(M=e==null?void 0:e.progressBarPageTexts)==null?void 0:M.current,sx:[{width:"".concat(S,"px")},...Array.isArray((k=(D=e==null?void 0:e.progressBarPageTexts)==null?void 0:D.base)==null?void 0:k.sx)?(G=(j=(B=e==null?void 0:e.progressBarPageTexts)==null?void 0:B.base)==null?void 0:j.sx)!=null?G:[]:[(se=(fe=e==null?void 0:e.progressBarPageTexts)==null?void 0:fe.base)==null?void 0:se.sx],...Array.isArray((K=(ge=e==null?void 0:e.progressBarPageTexts)==null?void 0:ge.current)==null?void 0:K.sx)?(Re=(L=(_=e==null?void 0:e.progressBarPageTexts)==null?void 0:_.current)==null?void 0:L.sx)!=null?Re:[]:[(Ce=(Me=e==null?void 0:e.progressBarPageTexts)==null?void 0:Me.current)==null?void 0:Ce.sx]],onClick:()=>V.openPage("previous","ltr",!1),children:w.name}),a.jsx(Yn,{onClickAway:()=>h(!1),children:a.jsxs(ea,{...e==null?void 0:e.progressBarSlotsActionArea,onMouseDown:E,onMouseUp:R,onTouchStart:E,onTouchEnd:R,children:[a.jsxs(qn,{ref:f,...e==null?void 0:e.progressBarSlotsContainer,children:[i.map((b,Y)=>l.createElement(aa,{...e==null?void 0:e.progressBarSlot,key:b.primary.index,page:b,pagesIndex:Y,isCurrentPage:Y===P,isLeadingPage:Y<P,isTrailingPage:Y>P,totalPages:i.length,primaryPageLoadState:c[b.primary.index].loaded,secondaryPageLoadState:b.secondary?c[b.secondary.index].loaded:void 0,createProgressBarSlot:r,showDraggingStyle:Y===P&&u})),a.jsx(Jn,{...e==null?void 0:e.progressBarReadPages,currentPagesIndex:w.pagesIndex,pagesLength:i.length,progressBarPosition:s})]}),a.jsx(Qn,{boxProps:e==null?void 0:e.progressBarCurrentPageSlot,pageName:w.name,currentPagesIndex:w.pagesIndex,pagesLength:i.length,isDragging:u,progressBarPosition:s,children:t==null?void 0:t.progressBarCurrentPage})]})}),a.jsx(Rr,{ref:m,...(ne=e==null?void 0:e.progressBarPageTexts)==null?void 0:ne.base,...(Oe=e==null?void 0:e.progressBarPageTexts)==null?void 0:Oe.total,sx:[{minWidth:"unset"},...Array.isArray((Pe=(Ge=e==null?void 0:e.progressBarPageTexts)==null?void 0:Ge.base)==null?void 0:Pe.sx)?(xe=(Ne=(Te=e==null?void 0:e.progressBarPageTexts)==null?void 0:Te.base)==null?void 0:Ne.sx)!=null?xe:[]:[(Je=($e=e==null?void 0:e.progressBarPageTexts)==null?void 0:$e.base)==null?void 0:Je.sx],...Array.isArray((je=(at=e==null?void 0:e.progressBarPageTexts)==null?void 0:at.total)==null?void 0:je.sx)?(ye=(X=(Ee=e==null?void 0:e.progressBarPageTexts)==null?void 0:Ee.total)==null?void 0:X.sx)!=null?ye:[]:[(_e=(ke=e==null?void 0:e.progressBarPageTexts)==null?void 0:ke.total)==null?void 0:_e.sx]],onClick:()=>V.openPage("next","ltr",!1),children:d})]})})},os=l.memo(oa),ia=({direction:e,...t})=>{const{settings:{customThemes:r,appTheme:s,themeMode:n,shouldUsePureBlackMode:o}}=Hr(),i=l.useMemo(()=>Ps(n,Ts(s,r),o,e),[n,s,r,o,e]);return a.jsx(Es,{value:ws[e],children:a.jsx(Is,{theme:i,children:a.jsx($,{...t,dir:e})})})},is=ue(ia,[()=>({direction:y.useGetThemeDirection()})],["direction"]),cs=l.memo(({pageName:e,progressBarPosition:t,slotProps:r,children:s})=>{var n;return a.jsx(F,{...r==null?void 0:r.tooltip,title:e,placement:kr[t],children:a.jsx($,{...r==null?void 0:r.box,sx:{width:"100%",height:"100%",...(n=r==null?void 0:r.box)==null?void 0:n.sx},children:s})})}),ca=l.memo(({pageName:e,primaryPageLoadState:t,secondaryPageLoadState:r,progressBarPosition:s,isCurrentPage:n,isLeadingPage:o,showDraggingStyle:i})=>{const c=nt();return a.jsx(cs,{pageName:e,progressBarPosition:s,slotProps:{box:{sx:{cursor:"pointer",backgroundColor:lr(c.palette.background.paper,.2),...c.applyStyles("dark",{backgroundColor:dr(c.palette.background.paper,.1)}),...v(t&&(r==null||r),{backgroundColor:lr(c.palette.background.paper,.35),...c.applyStyles("dark",{backgroundColor:dr(c.palette.background.paper,.25)})})}},tooltip:{slotProps:n?{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}}:void 0}},children:a.jsx($,{sx:{width:"100%",height:"100%",...v(o,{backgroundColor:rt(c.palette.primary.main,.5)}),...v(n,{cursor:i?"grabbing":"grab",pointer:"grabbing",borderRadius:2,backgroundColor:"primary.dark",...c.applyStyles("dark",{backgroundColor:"primary.light"})})}})})}),la=({readerNavBarWidth:e,readerDirection:t})=>{const r=nt(),s=lt(E=>E.scrollbar),n=qe(E=>E.pages.totalPages),{progressBarType:o,progressBarSize:i,progressBarPosition:c,progressBarPositionAutoVertical:d}=J(E=>({progressBarType:E.settings.progressBarType,progressBarSize:E.settings.progressBarSize,progressBarPosition:E.settings.progressBarPosition,progressBarPositionAutoVertical:E.settings.progressBarPositionAutoVertical})),{isMaximized:p,setIsMaximized:g,isDragging:u}=Ht(E=>({isMaximized:E.progressBar.isMaximized,setIsMaximized:E.progressBar.setIsMaximized,isDragging:E.progressBar.isDragging})),[,h]=l.useState({});We(window.document.documentElement,l.useCallback(()=>h({}),[]));const f=Qr(c,d,s.ySize,e+s.xSize),{isBottom:x,isLeft:S,isRight:T,isVertical:m,isHorizontal:P}=be(f),I=!!n,w=o===Zt.HIDDEN,A=!p&&!u;return a.jsx(is,{children:a.jsx(os,{direction:P?t:"ltr",progressBarPosition:f,fullSegmentClicks:!0,createProgressBarSlot:l.useCallback((E,R,C,M,D,k,B,j,G)=>a.jsx(ca,{pageName:E.name,primaryPageLoadState:C,secondaryPageLoadState:M,progressBarPosition:f,isCurrentPage:D,isLeadingPage:k,showDraggingStyle:G}),[f]),slotProps:{container:{sx:{overflow:"hidden",transition:"all 0.".concat(r.transitions.duration.shortest,"s"),...v(P,{minHeight:"100px",...v(r.direction==="ltr",{left:t==="ltr"?e:s.ySize,right:t==="rtl"?e:s.ySize}),...v(r.direction==="rtl",{left:t==="rtl"?e:s.ySize,right:t==="ltr"?e:s.ySize})}),...v(m,{minWidth:"100px",bottom:"".concat(s.xSize,"px")}),...v(x,{bottom:"".concat(s.xSize,"px")}),...v(S,{...v(r.direction==="ltr",{left:t==="ltr"?e:"unset",right:t==="rtl"?e:"unset"}),...v(r.direction==="rtl",{right:t==="rtl"?s.ySize:"unset",left:t==="ltr"?s.ySize:"unset"})}),...v(T,{...v(r.direction==="ltr",{right:t==="ltr"?s.ySize:"unset",left:t==="rtl"?s.ySize:"unset"}),...v(r.direction==="rtl",{left:t==="rtl"?e:"unset",right:t==="ltr"?e:"unset"})}),...v(A,{opacity:w?0:.85}),...v(!I,{pointerEvents:"none"})},onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1)},progressBarRoot:{sx:{gap:0,transition:"all 0.1s ease-in-out",backgroundColor:"background.paper",...v(m,{flexDirection:"column",height:"100%"}),...v(A,{backgroundColor:"unset",pointerEvents:"none",...v(P,{px:2}),...v(m,{py:2}),...v(x,{pb:.25}),...v(S,{...v(r.direction==="ltr",{pl:t==="ltr"?.25:0,pr:t==="rtl"?.25:0}),...v(r.direction==="rtl",{pr:t==="rtl"?.25:0,pl:t==="ltr"?.25:0})}),...v(T,{...v(r.direction==="ltr",{pr:t==="ltr"?.25:0,pl:t==="rtl"?.25:0}),...v(r.direction==="rtl",{pl:t==="rtl"?.25:0,pr:t==="ltr"?.25:0})})})}},progressBarSlotsContainer:{sx:{gap:.25,borderRadius:2,transition:"height 0.1s ease-in-out",...v(P,{height:"20px"}),...v(m,{flexDirection:"column",width:"20px"}),...v(A,{...v(P,{height:"".concat(i,"px")}),...v(m,{width:"".concat(i,"px")})})}},progressBarReadPages:{sx:{display:"none"}},progressBarCurrentPageSlot:{sx:{display:"none"}},progressBarPageTexts:{base:{sx:{px:1,py:1.5,transition:"all 0.1s ease-in-out",...v(A,{transform:"scale(0)",p:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})}}}}})})},da=ue(l.memo(la),[Ke,()=>({readerDirection:y.useGetThemeDirection()})],["readerNavBarWidth","readerDirection"]),ua=Ze(N)({width:"400px",minWidth:"400px",maxWidth:"400px",height:"100vh",overflowY:"auto"}),ga=l.memo(({mangaId:e,mangaTitle:t,chapterTitle:r,scanlator:s})=>a.jsxs(N,{children:[a.jsx(F,{title:t,placement:"right",children:a.jsx(Rt,{lines:3,variant:"h6",component:"h1",sx:{textAlign:"center"},children:a.jsx(yt,{component:kt,to:tr.manga.path(e),sx:{textDecoration:"none",color:"inherit"},children:t})})}),a.jsx(F,{title:r,placement:"right",children:a.jsx(Rt,{lines:4,variant:"body1",component:"h2",sx:{textAlign:"center"},children:r})}),s&&a.jsx(F,{title:s,placement:"right",children:a.jsx(Rt,{lines:4,variant:"body2",component:"h3",color:"textDisabled",sx:{textAlign:"center"},children:s})})]})),ha=Ae(a.jsx("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"})),pa=Ae(a.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),Nt=({title:e,type:t,disabled:r,...s})=>a.jsx(F,{title:e,disabled:r,children:a.jsx(as,{sx:{flexBasis:"15%"},variant:"contained",disabled:r,...s,children:t==="previous"?a.jsx(ha,{}):a.jsx(pa,{})})}),fa=()=>{const{t:e}=W(),t=Vr(),{currentPageIndex:r,pages:s}=qe(c=>({currentPageIndex:c.pages.currentPageIndex,pages:c.pages.pages})),n=J(c=>c.settings.readingDirection.value),o=l.useMemo(()=>Be(r,s),[r,s]),i=bt[n];return a.jsxs(N,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[a.jsx(Nt,{type:"previous",title:e(t("reader.button.previous_page","reader.button.next_page",i)),disabled:t(!o.primary.index,ie(o)===ie(s.slice(-1)[0]),i),onClick:()=>V.openPage("previous",void 0,!1)}),a.jsxs(zr,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[a.jsx(Ur,{id:"reader-nav-bar-desktop-page-select",children:e("reader.page_info.label.page")}),a.jsx(ns,{labelId:"reader-nav-bar-desktop-page-select",label:e("reader.page_info.label.page"),value:ie(o),onChange:c=>V.openPage(c.target.value,void 0,!1),children:s.map(c=>a.jsx(Ct,{value:ie(c),children:c.name},ie(c)))})]}),a.jsx(Nt,{type:"next",title:e(t("reader.button.next_page","reader.button.previous_page",i)),disabled:t(ie(o)===ie(s.slice(-1)[0]),!o.primary.index,i),onClick:()=>V.openPage("next",void 0,!1)})]})},xa=l.memo(fa),ma=()=>{},ls=({currentChapter:e,chapters:t,style:r})=>{const s=l.useMemo(()=>e&&t.findIndex(n=>n.id===e.id),[e,t]);return a.jsx(Mn,{style:{height:"calc(".concat(t.length," * 100px)"),...r},initialTopMostItemIndex:s!=null?s:0,totalCount:t.length,computeItemKey:n=>t[n].id,itemContent:n=>a.jsx(On,{index:n,chapters:t,isSortDesc:!0,mode:"reader",showChapterNumber:!1,selected:null,onSelect:ma,selectable:!1,isActiveChapter:n===s}),increaseViewportBy:400})},va=({currentChapter:e,previousChapter:t,nextChapter:r,chapters:s=[],readerThemeDirection:n})=>{var c,d;const{t:o}=W(),i=Dt({variant:"popover",popupId:"reader-nav-bar-desktop-chapter-list"});return l.useLayoutEffect(()=>{i.close()},[e==null?void 0:e.id]),a.jsxs(N,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[a.jsx(Nt,{type:"previous",title:o(q("reader.button.previous_chapter","reader.button.next_chapter",n)),onClick:()=>{V.openChapter(q("previous","next",n))},disabled:q(!t,!r,n)}),a.jsxs(zr,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[a.jsx(Ur,{id:"reader-nav-bar-desktop-chapter-select",children:o("chapter.title_one")}),a.jsx(ns,{...Lt(i),open:i.isOpen,value:(c=e==null?void 0:e.id)!=null?c:0,MenuProps:{sx:{visibility:"hidden"}},label:o("chapter.title_one"),labelId:"reader-nav-bar-desktop-chapter-select",children:a.jsx(Ct,{value:(d=e==null?void 0:e.id)!=null?d:0,children:e?"#".concat(e.chapterNumber," ").concat(e.name):""},e==null?void 0:e.id)})]}),a.jsx(Nt,{component:kt,type:"next",title:o(q("reader.button.next_chapter","reader.button.previous_chapter",n)),onClick:()=>{V.openChapter(q("next","previous",n))},disabled:q(!r,!t,n)}),a.jsx(As,{...Ms(i),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:a.jsx($,{sx:{mb:1},children:a.jsx(ls,{style:{width:"500px",maxWidth:"90vw",minHeight:"150px",maxHeight:"300px"},currentChapter:e,chapters:s})})})]})},Sa=ue(l.memo(va),[()=>({readerThemeDirection:y.useGetThemeDirection()})],["readerThemeDirection"]),ba=Ae(a.jsx("path",{d:"M17 4h3c1.1 0 2 .9 2 2v2h-2V6h-3zM4 8V6h3V4H4c-1.1 0-2 .9-2 2v2zm16 8v2h-3v2h3c1.1 0 2-.9 2-2v-2zM7 18H4v-2H2v2c0 1.1.9 2 2 2h3zM18 8H6v8h12z"})),ds=(e,t,r)=>{const n=(e+1)%t.length===0;if(!(r&&n))return t[(e+1)%t.length]},ir=({tooltip:e,value:t,defaultValue:r,values:s,setValue:n,valueToDisplayData:o,isDefaultable:i,onDefault:c,defaultIcon:d})=>{const{t:p}=W(),g=t===void 0,u=l.useMemo(()=>g?-1:s.indexOf(t),[t,s]);return a.jsx(F,{title:e,children:g?a.jsx(st,{onClick:()=>n(s[0]),sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:d,size:"large",children:r===void 0?p("global.label.default"):a.jsx(Qs,{i18nKey:"settings.default_value",value:o[r].isTitleString?o[r].title:p(o[r].title)})}):a.jsx(st,{onClick:()=>{const h=ds(u,s,i);if(h===void 0){c==null||c();return}n(h)},sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:o[t].icon,size:"large",children:o[t].isTitleString?o[t].title:p(o[t].title)})})},Ra=({pageScaleMode:e,shouldStretchPage:t,updateSetting:r,...s})=>{const{t:n}=W();return a.jsxs(N,{sx:{flexDirection:"row",gap:1},children:[a.jsx(ir,{...s,tooltip:n("reader.settings.page_scale.title"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Fr,setValue:o=>r("pageScaleMode",o),valueToDisplayData:ur,defaultIcon:ur[e.value].icon}),Os[e.value]&&a.jsx(F,{title:n("reader.settings.page_scale.stretch"),children:a.jsx(as,{onClick:()=>r("shouldStretchPage",!t.value),sx:{px:void 0},variant:"contained",color:t.value?"secondary":"primary",children:a.jsx(ba,{})})})]})},Ca=({readingMode:e,setReadingMode:t,...r})=>{const{t:s}=W();return a.jsx(ir,{...r,tooltip:s("reader.settings.label.reading_mode"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Wr,setValue:t,valueToDisplayData:qt,defaultIcon:qt[e.value].icon})},Pa=()=>a.jsx(js,{children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{d:"M2 4h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2m20 0h-6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6M2 12h20m-3-3 3 3-3 3M5 9l-3 3 3 3"})})}),Ta=({readingMode:e,shouldOffsetDoubleSpreads:t,setShouldOffsetDoubleSpreads:r})=>{const{t:s}=W();return en(e)?a.jsx(st,{sx:{justifyContent:"start",textTransform:"unset"},size:"large",onClick:()=>r(!t),color:t?"secondary":"primary",variant:"contained",startIcon:a.jsx(Pa,{}),children:s("reader.settings.label.offset_double_spread")}):null},Ea=({readingDirection:e,setReadingDirection:t,...r})=>{const{t:s}=W();return a.jsx(ir,{...r,tooltip:s("reader.settings.label.reading_direction"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Gr,setValue:t,valueToDisplayData:gr,defaultIcon:gr[e.value].icon})},wa=Ae(a.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 14H9V8h2zm4 0h-2V8h2z"})),Ia=Ae(a.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 14.5v-9l6 4.5z"})),Aa=({autoScroll:e,setAutoScroll:t})=>{const{t:r}=W(),{isActive:s,toggleActive:n}=Vt(i=>({isActive:i.autoScroll.isActive,toggleActive:i.autoScroll.toggleActive})),o=l.useRef(void 0);return a.jsxs(N,{sx:{flexDirection:"row",gap:1},children:[a.jsx(st,{sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},size:"large",onClick:n,color:s?"secondary":"primary",variant:"contained",startIcon:s?a.jsx(wa,{}):a.jsx(Ia,{}),children:r("reader.settings.auto_scroll.title")}),a.jsx(ys,{value:e.value,type:"number",size:"small",onBlur:i=>{const c=it(+i.target.value,Ve.min,Ve.max);c!==e.value&&(clearTimeout(o.current),t({...e,value:c},!0))},onChange:i=>{const c=it(+i.target.value,Ve.min,Ve.max);t({...e,value:c},!1),clearTimeout(o.current),o.current=setTimeout(()=>t({...e,value:c},!0),1e3)},slotProps:{input:{inputProps:Ve,endAdornment:a.jsx(Ds,{position:"end",children:r("global.time.seconds.second",{count:e.value})})}}})]})},Ma=({openSettings:e})=>{const{t}=W(),{readingMode:r,shouldOffsetDoubleSpreads:s,pageScaleMode:n,shouldStretchPage:o,readingDirection:i,autoScroll:c}=J(d=>({readingMode:d.settings.readingMode,shouldOffsetDoubleSpreads:d.settings.shouldOffsetDoubleSpreads,pageScaleMode:d.settings.pageScaleMode,shouldStretchPage:d.settings.shouldStretchPage,readingDirection:d.settings.readingDirection,autoScroll:d.settings.autoScroll}));return a.jsxs(N,{sx:{gap:1},children:[a.jsx(Ca,{readingMode:r,setReadingMode:d=>y.updateSetting("readingMode",d),isDefaultable:!0,onDefault:()=>y.deleteSetting("readingMode")}),a.jsx(Ta,{readingMode:r.value,shouldOffsetDoubleSpreads:s.value,setShouldOffsetDoubleSpreads:d=>y.updateSetting("shouldOffsetDoubleSpreads",d)}),a.jsx(Ra,{pageScaleMode:n,shouldStretchPage:o,updateSetting:y.updateSetting,isDefaultable:!0,onDefault:()=>y.deleteSetting("pageScaleMode")}),a.jsx(Ea,{readingDirection:i,setReadingDirection:d=>y.updateSetting("readingDirection",d),isDefaultable:!0,onDefault:()=>y.deleteSetting("readingDirection")}),a.jsx(Aa,{autoScroll:c,setAutoScroll:(...d)=>y.updateSetting("autoScroll",...d)}),a.jsx(st,{onClick:()=>e(),size:"large",sx:{justifyContent:"start",textTransform:"none"},variant:"contained",startIcon:a.jsx($r,{}),children:t("settings.title")})]})},Oa=l.memo(Ma),ja=Ae(a.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"})),Cr={...or,title:"Fallback",inLibrary:!1},us=l.memo(()=>{const e=wt(o=>o.manga),{inLibrary:t}=e!=null?e:Cr,{t:r}=W(),{CategorySelectComponent:s,updateLibraryState:n}=Tn(e!=null?e:Cr,!0);return a.jsxs(a.Fragment,{children:[a.jsx(F,{title:r(t?"manga.action.library.remove.label.action":"manga.button.add_to_library"),children:a.jsx(ae,{onClick:n,color:"inherit",children:t?a.jsx(Nn,{}):a.jsx(En,{})})}),s]})}),ya=Ae(a.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),Da=({id:e,isBookmarked:t})=>{const{t:r}=W(),s=t?"unbookmark":"bookmark";return a.jsx(F,{title:r(Qt[s].action.single),children:a.jsx(ae,{onClick:()=>Le.performAction(s,[e],{}),color:"inherit",children:t?a.jsx(jn,{}):a.jsx(ya,{})})})},gs=l.memo(Da),La=({currentChapter:e})=>{var s;const{t}=W(),r=Le.useDownloadStatusFromCache((s=e==null?void 0:e.id)!=null?s:-1);return e&&Le.isDownloaded(e)?a.jsx(F,{title:t(Qt.delete.action.single),children:a.jsx(ae,{onClick:()=>Le.performAction("delete",[e.id],{}),color:"inherit",children:a.jsx(Ln,{})})}):r?a.jsx(Bn,{chapterId:r.chapter.id}):a.jsx(F,{title:t(Qt.download.action.single),disabled:!e,children:a.jsx(ae,{disabled:!e,onClick:()=>{var n;return Le.performAction("download",[(n=e==null?void 0:e.id)!=null?n:-1],{})},color:"inherit",children:a.jsx(Dn,{})})})},Ba=l.memo(()=>{const e=Ue(g=>g.chapters.currentChapter),{id:t,isBookmarked:r,realUrl:s}=e!=null?e:ss,{t:n}=W(),{pageLoadStates:o,setPageLoadStates:i,setRetryFailedPagesKeyPrefix:c}=qe(g=>({pageLoadStates:g.pages.pageLoadStates,setPageLoadStates:g.pages.setPageLoadStates,setRetryFailedPagesKeyPrefix:g.pages.setRetryFailedPagesKeyPrefix})),d=l.useRef(0),p=l.useMemo(()=>o.some(g=>g.error),[o]);return a.jsxs(N,{sx:{flexDirection:"row",justifyContent:"center",gap:1},children:[a.jsx(us,{}),a.jsx(gs,{id:t,isBookmarked:r}),a.jsx(F,{title:n("reader.button.retry_load_pages"),disabled:!p,children:a.jsx(ae,{onClick:()=>{i(g=>g.map(u=>({url:u.url,loaded:u.loaded}))),c("".concat(d.current)),d.current=(d.current+1)%1e3},disabled:!p,color:"inherit",children:a.jsx(ja,{})})}),a.jsx(La,{currentChapter:e}),a.jsx(F,{title:n("global.button.open_browser"),disabled:!s,children:a.jsx(ae,{disabled:!s,href:s!=null?s:"",rel:"noreferrer",target:"_blank",color:"inherit",children:a.jsx(yn,{})})}),a.jsx(F,{title:n("global.button.open_webview"),disabled:!s,children:a.jsx(ae,{disabled:!s,href:s?Et.getWebviewUrl(s):"",rel:"noreferrer",target:"_blank",color:"inherit",children:a.jsx(kn,{})})})]})}),Na=({exit:e})=>{const{t}=W(),r=Vr();return a.jsx(F,{title:t("reader.button.exit"),children:a.jsx(ae,{sx:{marginRight:2},onClick:e,color:"inherit",children:r(a.jsx(Ls,{}),a.jsx(Bs,{}))})})},hs=ue(l.memo(Na),[()=>({exit:y.useExit()})],["exit"]),ka=(e,t)=>{const r=l.useRef(t),s=l.useRef(t);return s.current!==r.current&&!e&&(r.current=!1),s.current!==t&&(r.current=s.current,s.current=t),r.current},_a=({isVisible:e,openSettings:t,setReaderNavBarWidth:r})=>{const{t:s}=W(),n=wt(S=>S.manga),{chapters:o,currentChapter:i,previousChapter:c,nextChapter:d}=Ue(S=>({chapters:S.chapters.chapters,currentChapter:S.chapters.currentChapter,previousChapter:S.chapters.previousChapter,nextChapter:S.chapters.nextChapter})),p=J(S=>S.settings.isStaticNav),[g,u]=l.useState();We(g,l.useCallback(()=>{p&&r(g.offsetWidth)},[g,p])),l.useLayoutEffect(()=>()=>r(0),[]);const x=ka(e,p)&&e?0:void 0;return a.jsx(Ns,{variant:p?"permanent":"persistent",open:e||p,transitionDuration:x,SlideProps:{unmountOnExit:!0},PaperProps:{ref:S=>u(S)},children:a.jsxs(ua,{sx:{backgroundColor:"background.paper",pointerEvents:"all"},children:[a.jsxs(N,{sx:{p:2,gap:2,backgroundColor:"action.hover"},children:[a.jsxs(N,{sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[a.jsx(hs,{}),a.jsx(F,{title:s("reader.settings.label.static_navigation"),children:a.jsx(ae,{onClick:()=>{r(0),y.updateSetting("isStaticNav",!p)},color:p?"primary":"inherit",children:p?a.jsx(Cn,{}):a.jsx(Pn,{})})})]}),n&&i?a.jsxs(a.Fragment,{children:[a.jsx(ga,{mangaId:n.id,mangaTitle:n.title,chapterTitle:i.name,scanlator:i.scanlator}),a.jsx(Ba,{})]}):a.jsx(_t,{})]}),a.jsxs(N,{sx:{p:2,gap:2},children:[a.jsxs(N,{sx:{gap:1},children:[a.jsx(xa,{}),a.jsx(Sa,{chapters:o,currentChapter:i,nextChapter:d,previousChapter:c})]}),a.jsx(ks,{}),a.jsx(Oa,{openSettings:t})]})]})})},Ha=ue(l.memo(_a),[Ke],["setReaderNavBarWidth"]),Va={...or,title:""},za=({isVisible:e,ref:t})=>{const{t:r}=W(),s=Dt({popupId:"reader-overlay-more-menu",variant:"popover"}),n=Ue(f=>f.chapters.currentChapter),o=wt(f=>f.manga),i=lt(f=>f.scrollbar),{id:c,title:d}=o!=null?o:Va,{id:p,name:g,realUrl:u,isBookmarked:h}=n!=null?n:ss;return a.jsx(rr,{direction:"down",in:e,ref:t,children:a.jsxs(N,{sx:{flexDirection:"row",alignItems:"center",position:"fixed",top:0,left:0,right:"".concat(i.ySize,"px"),p:2,pt:f=>"max(env(safe-area-inset-top), ".concat(f.spacing(2),")"),backgroundColor:f=>rt(f.palette.background.paper,.95),pointerEvents:"all",boxShadow:2},children:[a.jsx(hs,{}),a.jsx(N,{sx:{flexGrow:1},children:o&&n?a.jsxs(a.Fragment,{children:[a.jsx(F,{title:d,children:a.jsx(Rt,{lines:1,component:"h1",variant:"h5",children:a.jsx(yt,{component:kt,to:tr.manga.path(c),sx:{textDecoration:"none",color:"inherit"},children:d})})}),a.jsx(F,{title:g,children:a.jsx(Rt,{lines:1,children:g})})]}):a.jsx(_t,{})}),a.jsx(us,{}),a.jsx(gs,{id:p,isBookmarked:h}),a.jsx(ae,{...Lt(s),color:"inherit",children:a.jsx(wn,{})}),a.jsxs(_s,{...Hs(s),children:[a.jsx(Ct,{component:yt,disabled:!u,href:u!=null?u:"",rel:"noreferrer",target:"_blank",children:r("global.button.open_browser")}),a.jsx(Ct,{component:yt,disabled:!u,href:u?Et.getWebviewUrl(u):"",rel:"noreferrer",target:"_blank",children:r("global.button.open_webview")}),a.jsx(Ct,{disabled:!u,onClick:async()=>{await navigator.clipboard.writeText(d),Xr(r("global.label.copied_clipboard"),"info")},children:r("global.label.share")})]})]})})},Ua=l.memo(za),Fa=Ae(a.jsx("path",{d:"m21.81 12.74-.82-.63v-.22l.8-.63c.16-.12.2-.34.1-.51l-.85-1.48c-.07-.13-.21-.2-.35-.2q-.075 0-.15.03l-.95.38c-.08-.05-.11-.07-.19-.11l-.15-1.01c-.03-.21-.2-.36-.4-.36h-1.71c-.2 0-.37.15-.4.34l-.14 1.01c-.03.02-.07.03-.1.05l-.09.06-.95-.38q-.075-.03-.15-.03c-.14 0-.27.07-.35.2l-.85 1.48c-.1.17-.06.39.1.51l.8.63v.23l-.8.63c-.16.12-.2.34-.1.51l.85 1.48c.07.13.21.2.35.2q.075 0 .15-.03l.95-.37c.08.05.12.07.2.11l.15 1.01c.03.2.2.34.4.34h1.71c.2 0 .37-.15.4-.34l.15-1.01c.03-.02.07-.03.1-.05l.09-.06.95.38q.075.03.15.03c.14 0 .27-.07.35-.2l.85-1.48c.1-.17.06-.39-.1-.51M18 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M17 17h2v4c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v4h-2V6H7v12h10z"})),Wa=Ae(a.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5M7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"})),Pr=Ae(a.jsx("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})),Tr=Ae(a.jsx("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"})),Ga={display:"flex",alignItems:"center",justifyContent:"end",position:"relative",backgroundColor:"background.default"},Er="3px",$a=l.memo(({isTrailingPage:e,pagesIndex:t,totalPages:r,isVertical:s,isHorizontal:n})=>{const o="".concat(t/(r-1)*100,"%");return a.jsx($,{sx:{position:"absolute",...v(s,{top:o,left:"50%"}),...v(n,{top:"50%",left:o}),transform:"translate(-50%, -50%)",width:Er,height:Er,borderRadius:100,backgroundColor:"background.paper",...v(e,{backgroundColor:"primary.main"}),zIndex:1}})}),Xa=l.memo(({pageName:e,isTrailingPage:t,isCurrentPage:r,pagesIndex:s,totalPages:n,isVertical:o,isHorizontal:i})=>a.jsx(cs,{pageName:e,progressBarPosition:vt.BOTTOM,slotProps:{box:{sx:Ga}},children:!r&&a.jsx($a,{isTrailingPage:t,pagesIndex:s,totalPages:n,isVertical:o,isHorizontal:i})})),Ya={[vt.BOTTOM]:"up",[vt.LEFT]:"right",[vt.RIGHT]:"left",[vt.AUTO]:"left"},Ka=({direction:e,topOffset:t=0,bottomOffset:r=0})=>{const s=lt(R=>R.scrollbar),n=sr(R=>R.overlay.isVisible),{currentPageIndex:o,pages:i}=qe(R=>({currentPageIndex:R.pages.currentPageIndex,pages:R.pages.pages})),{previousChapter:c,nextChapter:d}=Ue(R=>({previousChapter:R.chapters.previousChapter,nextChapter:R.chapters.nextChapter})),{progressBarPosition:p,progressBarPositionAutoVertical:g}=J(R=>({progressBarPosition:R.settings.progressBarPosition,progressBarPositionAutoVertical:R.settings.progressBarPositionAutoVertical})),{setIsMaximized:u,isDragging:h}=Ht(R=>({setIsMaximized:R.progressBar.setIsMaximized,isDragging:R.progressBar.isDragging})),[,f]=l.useState({});We(window.document.documentElement,l.useCallback(()=>f({}),[]));const x=Qr(p,g,t+r,s.xSize),{isLeft:S,isRight:T,isVertical:m,isHorizontal:P}=be(x),I=P?e:"ltr",w=l.useMemo(()=>Be(o,i).pagesIndex,[o,i]),A=l.useMemo(()=>({container:{sx:{flexGrow:1,position:"relative",display:"flex",justifyItems:"center",alignItems:"stretch",backgroundColor:R=>rt(R.palette.background.paper,.85),borderRadius:100,boxShadow:2}},progressBarRoot:{sx:{flexGrow:1,gap:0,...v(m,{flexDirection:"column"}),...v(P,{alignItems:"stretch"})}},progressBarSlotsActionArea:{sx:{alignItems:"center",cursor:"pointer",...v(m,{width:"100%",flexDirection:"column",px:2}),...v(P,{height:"100%",py:2})}},progressBarSlotsContainer:{sx:{borderRadius:100,backgroundColor:"background.default",...v(m,{flexDirection:"column",py:1}),...v(P,{px:1})}},progressBarSlot:{sx:{...v(m,{width:"20px"}),...v(P,{height:"20px"})}},progressBarCurrentPageSlot:{sx:{display:"flex",zIndex:1,cursor:"inherit",...v(m,{justifyContent:"center"}),...v(P,{alignItems:"center"})}},progressBarPageTexts:{base:{sx:{...v(m,{py:1}),...v(P,{px:1})}}}}),[m,P]),E=l.useMemo(()=>({progressBarCurrentPage:a.jsx($,{sx:{position:"absolute",...v(m,{top:"calc(100% - 6px)",...v(w===0,{top:"0"}),width:"75%",height:"6px"}),...v(P,{left:"calc(100% - 0px)",...v(w===0,{left:"0"}),width:"6px",height:"75%"}),backgroundColor:"primary.main",borderRadius:100,cursor:h?"grabbing":"grab"}})}),[w,i.length,h,m,P]);return l.useLayoutEffect(()=>(u(n),()=>u(!1)),[n]),a.jsx(rr,{direction:Ya[x],in:n,children:a.jsx(is,{sx:{position:"relative",display:"flex",alignItems:"end",height:"100%",pointerEvents:"none",...v(S,{justifyContent:e==="ltr"?"start":"end"}),...v(T,{justifyContent:e==="ltr"?"end":"start"})},children:a.jsxs(N,{sx:{p:2,gap:1,pointerEvents:"all",alignItems:"center",...v(m,{height:"100%",flexDirection:"column"}),...v(P,{width:"100%",flexDirection:"row"})},children:[a.jsx(ae,{onClick:()=>V.openChapter("previous"),disabled:!c,sx:{backgroundColor:R=>rt(R.palette.background.paper,.85),boxShadow:2},children:q(a.jsx(Pr,{sx:{...v(m,{transform:"rotate(90deg)"})}}),a.jsx(Tr,{sx:{...v(m,{transform:"rotate(90deg)"})}}),I)}),a.jsx(os,{direction:I,progressBarPosition:x,fullSegmentClicks:!1,createProgressBarSlot:l.useCallback((R,C,M,D,k,B,j,G)=>a.jsx(Xa,{pageName:R.name,isTrailingPage:j,isCurrentPage:k,pagesIndex:C,totalPages:G,isVertical:m,isHorizontal:P}),[m,P]),slotProps:{...A,progressBarReadPages:{sx:{backgroundColor:"primary.main",...v(m,{width:"20px",height:"".concat(Math.max(0,Be(o,i).pagesIndex)/(i.length-1)*100,"%"),borderRadius:"400px 400px 0 0"}),...v(P,{width:"".concat(Math.max(0,Be(o,i).pagesIndex)/(i.length-1)*100,"%"),height:"20px",borderRadius:"400px 0 0 400px"})}}},slots:E}),a.jsx(ae,{onClick:()=>V.openChapter("next"),disabled:!d,sx:{backgroundColor:R=>rt(R.palette.background.paper,.85),boxShadow:2},children:q(a.jsx(Tr,{sx:{...v(m,{transform:"rotate(90deg)"})}}),a.jsx(Pr,{sx:{...v(m,{transform:"rotate(90deg)"})}}),I)})]})})})},Za=ue(l.memo(Ka),[()=>({direction:y.useGetThemeDirection()})],["direction"]),qa=()=>{const{t:e}=W(),{isActive:t,toggleActive:r}=Vt(i=>({isActive:i.autoScroll.isActive,toggleActive:i.autoScroll.toggleActive})),{readingMode:s,readingDirection:n,autoScroll:o}=J(i=>({readingMode:i.settings.readingMode,readingDirection:i.settings.readingDirection,autoScroll:i.settings.autoScroll}));return a.jsxs(N,{sx:{gap:2},children:[a.jsx(tn,{}),a.jsx(rn,{readingMode:s,setReadingMode:i=>y.updateSetting("readingMode",i),isDefaultable:!0,onDefault:()=>y.deleteSetting("readingMode")}),a.jsx(sn,{readingDirection:n,setReadingDirection:i=>y.updateSetting("readingDirection",i),isDefaultable:!0,onDefault:()=>y.deleteSetting("readingDirection")}),a.jsx(_n,{label:e("reader.settings.auto_scroll.title"),checked:t,onChange:()=>r()}),a.jsx(nn,{autoScroll:o,setAutoScroll:(...i)=>y.updateSetting("autoScroll",...i)})]})},Ja=l.memo(qa),Qa=({openSettings:e,isVisible:t,topOffset:r=0})=>{const{t:s}=W(),{currentChapter:n,chapters:o}=Ue(h=>({currentChapter:h.chapters.currentChapter,chapters:h.chapters.chapters})),i=Dt({variant:"dialog",popupId:"reader-chapter-list-dialog"}),c=Dt({variant:"dialog",popupId:"reader-quick-settings-dialog"}),d=lt(h=>h.scrollbar),[p,g]=l.useState(0),u=l.useRef(null);return We(u,l.useCallback(()=>{var h,f;return g((f=(h=u.current)==null?void 0:h.clientHeight)!=null?f:0)},[p])),l.useLayoutEffect(()=>{i.close()},[n==null?void 0:n.id]),a.jsxs(a.Fragment,{children:[a.jsxs(N,{sx:{position:"fixed",right:"".concat(d.ySize,"px"),bottom:0,left:0,height:"calc(100% - ".concat(r,"px)")},children:[a.jsx(Za,{topOffset:r,bottomOffset:p}),a.jsx(rr,{direction:"up",in:t,children:a.jsx(N,{ref:u,sx:{alignItems:"center",backgroundColor:h=>rt(h.palette.background.paper,.95),pb:"max(".concat(d.xSize,"px, env(safe-area-inset-bottom))"),boxShadow:2,pointerEvents:"all"},children:a.jsxs(N,{sx:{width:"50%",flexDirection:"row",p:2,gap:1,justifyContent:"space-evenly",alignItems:"center"},children:[a.jsx(F,{title:s("reader.button.chapter_list"),children:a.jsx(ae,{...Lt(i),color:"inherit",children:a.jsx(Wa,{})})}),a.jsx(F,{title:s("reader.settings.title.quick_settings"),children:a.jsx(ae,{...Lt(c),color:"inherit",children:a.jsx(Fa,{})})}),a.jsx(F,{title:s("settings.title"),children:a.jsx(ae,{onClick:e,color:"inherit",children:a.jsx($r,{})})})]})})})]}),i.isOpen&&a.jsx(Yt,{...hr(i),fullWidth:!0,maxWidth:"md",scroll:"paper",children:a.jsx(Kt,{sx:{p:0,pb:1},children:a.jsx(ls,{style:{minHeight:"15vh",maxHeight:"75vh"},currentChapter:n,chapters:o})})}),c.isOpen&&a.jsx(Yt,{...hr(c),fullWidth:!0,maxWidth:"md",scroll:"paper",children:a.jsx(Kt,{children:a.jsx(Ja,{})})})]})},eo=l.memo(Qa),to=({isDesktop:e,isMobile:t})=>{const r=sr(d=>d.overlay.isVisible),[s,n]=l.useState(!1),[o,i]=l.useState(0),c=l.useRef(null);return We(c,l.useCallback(()=>{var d,p;return i((p=(d=c.current)==null?void 0:d.clientHeight)!=null?p:0)},[t])),a.jsxs($,{sx:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none",zIndex:1},children:[e&&a.jsxs(a.Fragment,{children:[a.jsx(da,{}),a.jsx(Ha,{isVisible:r,openSettings:()=>n(!0)})]}),t&&a.jsxs(a.Fragment,{children:[a.jsx(Ua,{ref:c,isVisible:r}),a.jsx(eo,{openSettings:()=>n(!0),isVisible:r,topOffset:o})]}),a.jsx(Wn,{isOpen:s,close:()=>n(!1)}),a.jsx($n,{})]})},ro=ue(l.memo(to),[y.useOverlayMode],["isDesktop","isMobile"]),wr="reader-tap-zone-layout-canvas",so=({readerNavBarWidth:e})=>{const t=nt(),{tapZoneLayout:r,tapZoneInvertMode:s,readingDirection:n}=J(f=>({tapZoneLayout:f.settings.tapZoneLayout.value,tapZoneInvertMode:f.settings.tapZoneInvertMode.value,readingDirection:f.settings.readingDirection.value})),o=nr(f=>f.tapZone.showPreview),[i,c]=l.useState(0),[d,p]=l.useState(0),[g,u]=l.useState(null);We(g,l.useCallback(()=>{var f,x;c((f=g==null?void 0:g.clientWidth)!=null?f:0),p((x=g==null?void 0:g.clientHeight)!=null?x:0)},[g]));const h=Se.getOrCreateCanvas(r,i,d,t.typography.h3,{vertical:s.vertical,horizontal:s.horizontal,isRTL:n===ct.RTL});return l.useLayoutEffect(()=>{const f=document.getElementById(wr);f==null||f.replaceChildren(h)},[h,o]),a.jsx($,{ref:u,sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none"},children:o&&a.jsx("div",{id:wr})})},no=ue(so,[Ke],["readerNavBarWidth"]),ao=({readerNavBarWidth:e})=>{const{value:{red:t,green:r,blue:s,alpha:n,blendMode:o},enabled:i}=J(c=>c.settings.customFilter.rgba);return i?a.jsx($,{sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none",background:"rgba(".concat(t," ").concat(r," ").concat(s," / ").concat(n,"%)"),mixBlendMode:"".concat(o)}}):null},oo=ue(ao,[Ke],["readerNavBarWidth"]),Ir=2,xt=0,ee=0,te=1,io=(e,t=Ie.XY)=>{const[r,s]=l.useState(!1),n=l.useRef(void 0),o=l.useRef([0,0,0]),i=l.useRef([0,0,0]),c=l.useRef([0,0,0]),d=l.useRef([0,0]),p=l.useRef(void 0),g=l.useRef([0,0]),u=l.useRef([0,0]);return l.useEffect(()=>{const h=e==null?void 0:e.current;if(!h)return()=>{};const f=()=>{n.current||(n.current=getComputedStyle(h));const C=n.current.direction==="rtl",M=n.current.flexDirection==="row-reverse";return C||!C&&M},x=()=>(n.current||(n.current=getComputedStyle(h)),n.current.flexDirection==="column-reverse"),S=t!==Ie.Y,T=t!==Ie.X,m=()=>{p.current!==void 0&&(cancelAnimationFrame(p.current),p.current=void 0)},P=()=>{const C=(Ce,ne,Oe)=>(Ce[xt]-Ce[Ir])/(ne[xt]-ne[Ir])*1e3/Oe,M=[S?C(o.current,c.current,h.clientWidth):0,T?C(i.current,c.current,h.clientHeight):0],D=S&&T?Math.sqrt(M[ee]**2+M[te]**2):Math.abs(T?M[te]:M[ee]),k=[M[ee]/D,M[te]/D],B=it(1.2*D,-12,12),j=(Date.now()-c.current[xt])/1e3,G=B-14.278*j+75.24*j**2/B-149.72*j**3/B/B;if(!(B!==0&&G>0&&!Number.isNaN(B))){m();return}const se=(Ce,ne)=>Ce*ne*(B*j-7.1397*j**2+25.08*j**3/B-37.43*j**4/B/B),ge=[se(h.clientWidth,k[ee]),se(h.clientHeight,k[te])],K=[h.scrollWidth-h.clientWidth,h.scrollHeight-h.clientHeight],_=[it(d.current[ee]-ge[ee],f()?-K[ee]:0,K[ee]),it(d.current[te]-ge[te],x()?-K[te]:0,K[te])],L=_[ee]!==0||_[ee]!==K[ee],Re=_[te]!==0||_[te]!==K[te];L||Re||m(),S&&(h.scrollLeft=_[ee]),T&&(h.scrollTop=_[te])};let I=!1;const w=C=>{if(I)return!0;const M=[h.clientHeight<h.scrollHeight,h.clientWidth<h.scrollWidth],D=[Math.abs(o.current[xt]-C.pageX)>0,Math.abs(i.current[xt]-C.pageY)>0];return M[ee]&&D[ee]||M[te]&&D[te]},A=C=>{w(C)&&(I=!0,s(!0),o.current=[...o.current.slice(1),C.pageX],i.current=[...i.current.slice(1),C.pageY],c.current=[...c.current.slice(1),Date.now()],S&&(h.scrollLeft=u.current[ee]-(C.pageX-g.current[ee])),T&&(h.scrollTop=u.current[te]-(C.pageY-g.current[te])))},E=()=>{h.removeEventListener("mousemove",A),h.removeEventListener("mouseup",E),setTimeout(()=>{I=!1,s(!1)},0),d.current=[h.scrollLeft,h.scrollTop];const C=()=>{P(),p.current=requestAnimationFrame(C)};p.current=requestAnimationFrame(C)},R=C=>{C.button===0&&(C.preventDefault(),g.current=[C.pageX,C.pageY],u.current=[h.scrollLeft,h.scrollTop],o.current=[C.pageX,C.pageX,C.pageX],i.current=[C.pageY,C.pageY,C.pageY],c.current=[Date.now()-2,Date.now()-1,Date.now()],h.addEventListener("mousemove",A),h.addEventListener("mouseup",E),m())};return h.addEventListener("mousedown",R),h.addEventListener("wheel",m),()=>{h.removeEventListener("mousedown",R),h.removeEventListener("wheel",m),m()}},[e,t]),r},co=(e,t,r,s,n)=>{l.useEffect(()=>{if(e&&!n){r();return}s()},[e,t,n])},lo=(e,t,r,s)=>{l.useEffect(()=>{var o,i;const n=()=>{e&&ze().setIsVisible(!1),t&&r(!1)};return(o=s.current)==null||o.addEventListener("wheel",n),(i=s.current)==null||i.addEventListener("touchmove",n),()=>{var c,d;(c=s.current)==null||c.removeEventListener("wheel",n),(d=s.current)==null||d.removeEventListener("touchmove",n)}},[e,t])},uo=(e,t,r)=>{l.useEffect(()=>{if(e!==z.CONTINUOUS_HORIZONTAL)return()=>{};if(!r.current)return()=>{};let s,n,o;const i=c=>{var u,h;if(o===!0)return;c.preventDefault();const d=!Math.abs(Math.abs(s!=null?s:c.deltaX)-Math.abs(c.deltaX)),p=!Math.abs(Math.abs(n!=null?n:c.deltaY)-Math.abs(c.deltaY));if(s=c.deltaX,n=c.deltaY,o||(o=!d||!p),o!==void 0){if(c.shiftKey){(u=r.current)==null||u.scrollBy({top:c.deltaY});return}(h=r.current)==null||h.scrollBy({left:t===ct.LTR?c.deltaY:c.deltaY*-1})}};return r.current.addEventListener("wheel",i),()=>{var c;return(c=r.current)==null?void 0:c.removeEventListener("wheel",i)}},[e,t])},go=e=>{const t=l.useRef(void 0);l.useEffect(()=>{const r=n=>{const o=e.current;o&&(o.style.cursor=n?"default":"none")},s=()=>{r(!0),clearTimeout(t.current),t.current=setTimeout(()=>{r(!1)},5e3)};return s(),window.addEventListener("mousemove",s),()=>{r(!0),window.removeEventListener("mousemove",s),clearTimeout(t.current)}},[])},ho=(e,t,r,s,n)=>{l.useLayoutEffect(()=>{var o;t||(o=n.current)==null||o.scrollTo(an(n.current,r,s),0)},[e])},po=(e,t,r,s,n,o,i,c,d,p)=>{l.useLayoutEffect(()=>{if(e==null)return;const g=Be(e,r);if(i){const f=e>t?Ye.PREVIOUS:Ye.NEXT,x=c.current[g.pagesIndex];x==null||x.scrollIntoView({block:"start",inline:on(f,d,p)})}const u=ie(g),h=u===s-1;n(null),o(u,!h,h)},[e])},fo=(e,t,r,s,n,o,i)=>{const[c,d]=l.useState(i===z.DOUBLE_PAGE);l.useLayoutEffect(()=>{if(c&&i!==z.DOUBLE_PAGE){d(!1);const u=es(r);s(u),n(u.map(({primary:{url:h}})=>({url:h,isSpread:!1})));return}i===z.DOUBLE_PAGE&&(c||o(ie(Be(e,t))),s(t),d(i===z.DOUBLE_PAGE))},[t,i])},$t=({title:e,name:t,scanlator:r,backgroundColor:s})=>{const n=nt(),o=n.palette.getContrastText(zs(n.palette,Yr[s])),i=rt(o,.5);return t?a.jsxs(N,{children:[a.jsx(tt,{color:o,children:e}),a.jsx(tt,{color:o,variant:"h6",component:"h1",children:t}),r&&a.jsx(tt,{variant:"body2",color:i,children:r})]}):null},xo=({type:e,currentChapterName:t,currentChapterScanlator:r,previousChapterName:s,previousChapterScanlator:n,nextChapterName:o,nextChapterScanlator:i,readerNavBarWidth:c,handleBack:d})=>{var R;const{t:p}=W(),g=wt(C=>C.manga),u=lt(C=>C.scrollbar),h=qe(C=>C.pages.transitionPageMode),{readingMode:f,backgroundColor:x,shouldShowTransitionPage:S}=J(C=>({readingMode:C.settings.readingMode.value,backgroundColor:C.settings.backgroundColor,shouldShowTransitionPage:C.settings.shouldShowTransitionPage})),T=e===ce.PREVIOUS,m=e===ce.NEXT,P=!!t&&!s,I=!!t&&!o,w=P&&e===ce.PREVIOUS,A=I&&e===ce.NEXT;return!S&&!(w||A)||!cn(e,h,f)?null:a.jsx(N,{sx:{justifyContent:"center",alignItems:"center",...v(!de(f),{width:"100%",height:"100%"}),...v(de(f),{position:"sticky",...v(Fe(f),{left:0,maxWidth:"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px)"),minHeight:"calc(100vh - ".concat(u.xSize,"px)")}),...v(f===z.CONTINUOUS_HORIZONTAL,{top:0,minWidth:"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px)"),maxHeight:"calc(100vh - ".concat(u.xSize,"px)")})})},children:a.jsxs(N,{sx:{gap:2,maxWidth:C=>"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px - ").concat(C.spacing(2),")"),maxHeight:"calc(100vh - ".concat(u.xSize,"px)"),width:"max-content",p:1},children:[T&&P&&a.jsx(tt,{variant:"h6",children:p("reader.transition_page.first_chapter")}),a.jsxs(N,{sx:{gap:5},children:[T&&!P&&a.jsx($t,{title:p("reader.transition_page.previous"),name:s,scanlator:n,backgroundColor:x}),!!t&&a.jsx($t,{title:p(T?"reader.transition_page.current":"reader.transition_page.finished"),name:t,scanlator:r,backgroundColor:x}),m&&!I&&a.jsx($t,{title:p("reader.transition_page.next"),name:o,scanlator:i,backgroundColor:x})]}),m&&I&&a.jsx(tt,{variant:"h6",children:p("reader.transition_page.last_chapter")}),(T&&P||m&&I)&&a.jsxs(N,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:[a.jsx(st,{sx:{flexGrow:1},onClick:C=>{C.stopPropagation(),d()},variant:"contained",children:p("reader.transition_page.exit.previous_page")}),a.jsx(st,{sx:{flexGrow:1},component:kt,onClick:C=>{C.stopPropagation()},variant:"contained",to:tr.manga.path((R=g==null?void 0:g.id)!=null?R:-1),children:p("reader.transition_page.exit.manga_page")})]})]})})},Ar=ue(l.memo(xo),[({chapterId:e})=>{const t=Ue(i=>i.chapters.chapters),r=l.useMemo(()=>t.findIndex(i=>i.id===e),[e,t]),s=t[r],n=l.useMemo(()=>t[r+1],[r,t]),o=l.useMemo(()=>t[r-1],[r,t]);return{currentChapterName:s==null?void 0:s.name,currentChapterScanlator:s==null?void 0:s.scanlator,previousChapterName:n==null?void 0:n.name,previousChapterScanlator:n==null?void 0:n.name,nextChapterName:o==null?void 0:o.name,nextChapterScanlator:o==null?void 0:o.scanlator}},Ke,({chapterId:e,type:t})=>{const r=Vs(),s=Ue(g=>g.chapters.chapters),n=l.useMemo(()=>s.findIndex(g=>g.id===e),[e,s]),o=n===0,i=n===s.length-1,c=t===ce.PREVIOUS&&i,d=t===ce.NEXT&&o;return{handleBack:c||d?r:He}}],["currentChapterName","currentChapterScanlator","previousChapterName","previousChapterScanlator","nextChapterName","nextChapterScanlator","readerNavBarWidth","handleBack"]),mo=(e,t,r,s,n,o,i,c,d,p,g,u,h,f,x,S,T,m)=>{var I,w;const P=l.useRef(void 0);l.useLayoutEffect(()=>{var D;const A=(D=t.data)==null?void 0:D.fetchChapterPages;if(!A)return;const{pages:E}=A,R=E.length?E:[""],C=ln(r,s!=null?s:0,R.length-1),M=P.current!==(A==null?void 0:A.pages);if(M){P.current=A.pages;const k=es(R);d(!0),u(k),h(R),f(k.map(({primary:{url:B}})=>({url:B,loaded:!1}))),x(k.map(({primary:{url:B}})=>({url:B,isSpread:!1})))}else u(n),f(o),x(i);g(A.pages.length),h(R),S(C),T(C),p(k=>({...k,isCurrentChapterReady:c||M})),m(ce.NONE)},[(w=(I=t.data)==null?void 0:I.fetchChapterPages)==null?void 0:w.pages,e])},Mr=0,Ot="-10px",vo=(e,t,r)=>{if(!de(t))return;const s=bt[r],n="0px ".concat(Ot," 0px 0px"),o="0px 0px 0px ".concat(Ot);return Fe(t)?e==="first"?"0px 0px ".concat(Ot," 0px"):"".concat(Ot," 0px 0px 0px"):e==="first"?q(n,o,s):q(o,n,s)},So=(e,t,r,s)=>e===ct.LTR?{start:r>=s,end:t<0}:{start:t<0,end:r>=s},bo=(e,{top:t,right:r,bottom:s,left:n},o,i)=>{const c=window.innerWidth-i,d=window.innerHeight-o;return{[z.CONTINUOUS_VERTICAL]:{start:s>=d,end:t<0},[z.CONTINUOUS_HORIZONTAL]:So(e,n,r,c)}},Ro=({[z.CONTINUOUS_VERTICAL]:e,[z.CONTINUOUS_HORIZONTAL]:t},r)=>Fe(r)?e.start||e.end:t.start||t.end,Co=({[z.CONTINUOUS_VERTICAL]:e,[z.CONTINUOUS_HORIZONTAL]:t},r)=>Fe(r)?e:t,Or=(e,t,r,s,n,o,i)=>{const{readingMode:c,readingDirection:d,shouldUseInfiniteScroll:p,shouldShowTransitionPage:g}=J(u=>({readingMode:u.settings.readingMode.value,readingDirection:u.settings.readingDirection.value,shouldUseInfiniteScroll:u.settings.shouldUseInfiniteScroll,shouldShowTransitionPage:u.settings.shouldShowTransitionPage}));l.useEffect(()=>{const u=de(c),h=Fe(c);if(g||!i||!u||!p||!s||n||r===void 0)return()=>{};const f=()=>{const x=i.scrollLeft===0,S=i.scrollLeft===i.scrollWidth-i.clientWidth,T=i.scrollTop===0,m=i.scrollTop===i.scrollHeight-i.clientHeight;(e==="first"&&(h?T:x)||e==="last"&&(h?m:S))&&V.openChapter(r,void 0,!1)};return i.addEventListener("scroll",f),()=>i.removeEventListener("scroll",f)},[c,i,g,p,s,n,r]),Hn(o,l.useCallback(u=>{if(!p||!de(c)||r===void 0||!g&&!n)return;const h=u[u.length-1],f=bo(d,h.target.getBoundingClientRect(),vr().xSize,vr().ySize),{start:x,end:S}=Co(f,c),T=h.intersectionRatio<=Mr;if(!Ro(f,c))return;const m=e==="first"&&x&&!n,P=e==="last"&&!s&&S;if(m||e==="last"&&S&&T){V.openChapter(r,!n,!1);return}P&&V.openChapter(t,!1,!1)},[e,t,r,s,n,c,d,p,g]),l.useMemo(()=>({root:i,threshold:[Mr],rootMargin:vo(e,c,d),ignoreInitialObserve:!0}),[e,c,d]))},Po=({chapterId:e,previousChapterId:t,nextChapterId:r,isPreviousChapterVisible:s,isCurrentChapter:n,isNextChapterVisible:o,imageWrapper:i,scrollElement:c})=>(Or("first",e,t,n,s,i,c),Or("last",e,r,n,o,i,c),null),To=l.memo(Po),Eo=({currentPageIndex:e,setPages:t,setPageLoadStates:r,setTotalPages:s,setCurrentPageIndex:n,updateCurrentPageIndex:o,setPageToScrollToIndex:i,transitionPageMode:c,retryFailedPagesKeyPrefix:d,setTransitionPageMode:p,readingMode:g,readerWidth:u,pageScaleMode:h,shouldOffsetDoubleSpreads:f,readingDirection:x,imagePreLoadAmount:S,pageGap:T,chapterId:m,previousChapterId:P,nextChapterId:I,isPreviousChapterVisible:w,isNextChapterVisible:A,lastPageRead:E,isInitialChapter:R,isCurrentChapter:C,isPreviousChapter:M,isNextChapter:D,isLeadingChapter:k,isTrailingChapter:B,isPreloadMode:j,imageRefs:G,scrollIntoView:fe,resumeMode:se,customFilter:ge,shouldStretchPage:K,readerNavBarWidth:_,onSizeChange:L,minWidth:Re,minHeight:Me,scrollElement:Ce})=>{const{t:ne}=W(),{direction:Oe}=nt(),[Ge,Pe]=Et.useGetChapterPagesFetch(m!=null?m:-1),[Te,Ne]=l.useState(!1),[xe,$e]=l.useState(Mt.totalPages),[Je,at]=l.useState(Mt.pageUrls),[je,Ee]=l.useState(Mt.pages),[X,ye]=l.useState(Mt.pageLoadStates),[ke,_e]=l.useState(X.map(({url:O})=>({url:O,isSpread:!1}))),b=l.useRef(null),Y=l.useRef(C),he=l.useRef(je.map(()=>null)),U=l.useRef(null),me=l.useMemo(()=>!!!xe||!(xe===ke.length)?je:g===z.DOUBLE_PAGE?dn(Je,ke,f,x):je,[ke,g,f,x,xe]),Qe=l.useMemo(()=>un(g),[g]),dt=x===ct.LTR,we=de(g),Xe=!we&&!C||j,It=!we&&C,ut=!Xe&&(It||we&&(R||k)),gt=!Xe&&(It||we&&(R||B));Y.current=C,C&&(G.current=he.current);const ht=l.useCallback(()=>{m&&(Ne(!1),Ge({variables:{input:{chapterId:m}}}).catch(St()))},[Ge,m]),zt=l.useMemo(()=>gn(me,_e,O=>{Y.current&&r(O),ye(O)},g),[me,g]),Ut=l.useMemo(()=>hn(O=>{Y.current&&r(O),ye(O)}),[]);l.useEffect(()=>{ht()},[m]),We(b,l.useCallback(O=>{const{clientWidth:De,clientHeight:ot}=O[0].target;L(De,ot,m)},[L,b.current,m]));const oe=(O,De,ot,At=!1)=>{(At||!Te)&&De(O),C&&ot(O)};return mo(C,Pe,se,E,me,X,ke,Te,Ne,O=>oe(O,He,et().setReaderStateChapters),O=>oe(O,$e,s),O=>oe(O,Ee,t),O=>oe(O,at,He),O=>oe(O,ye,r),O=>oe(O,_e,He),O=>oe(O,He,n),O=>{(R&&!Te||fe)&&(i(O),et().setReaderStateChapters(De=>({...De,visibleChapters:{...De.visibleChapters,scrollIntoView:!1,resumeMode:void 0}})))},O=>oe(O,He,p)),fo(e,me,Je,O=>oe(O,Ee,t,!0),O=>oe(O,_e,He,!0),O=>oe(O,He,o),g),we||C||M||D?Pe.error?Xe?null:a.jsx($,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center",position:"relative"},children:a.jsx(Bt,{message:ne("global.error.label.failed_to_load_data"),messageExtra:Kr(Pe.error),retry:()=>{ht()}})}):Pe.loading||!Te?Xe?null:a.jsx($,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center"},children:a.jsx(_t,{})}):m!=null&&!xe?Xe?null:a.jsx($,{sx:{minWidth:"100%",minHeight:"100%",position:"relative"},children:a.jsx(Bt,{message:ne("reader.error.label.no_pages_found"),retry:ht})}):a.jsxs(N,{ref:b,sx:{width:"fit-content",height:"fit-content",margin:"auto",flexWrap:"nowrap",...v(g===z.CONTINUOUS_HORIZONTAL,{minHeight:Me}),...v(Fe(g),{minWidth:Re}),...v(Xe,{maxWidth:0,maxHeight:0,minWidth:"unset",minHeight:"unset",overflow:"hidden",margin:"unset"}),...v(Fe(g)&&ts(u,h),{alignItems:"center"}),...v(g===z.CONTINUOUS_HORIZONTAL,{...v(Oe==="ltr",{flexDirection:dt?"row":"row-reverse"}),...v(Oe==="rtl",{flexDirection:dt?"row-reverse":"row"})})},children:[!j&&a.jsx(To,{chapterId:m,previousChapterId:P,nextChapterId:I,isCurrentChapter:C,isPreviousChapterVisible:w,isNextChapterVisible:A,imageWrapper:U.current,scrollElement:Ce}),ut&&a.jsx(Ar,{chapterId:m,type:ce.PREVIOUS}),a.jsx(Qe,{ref:U,totalPages:xe,currentPageIndex:e,pages:me,transitionPageMode:c,pageLoadStates:X,retryFailedPagesKeyPrefix:d,imageRefs:he,onLoad:zt,onError:Ut,isCurrentChapter:C,isPreviousChapter:M,isNextChapter:D,readingMode:g,imagePreLoadAmount:S,readingDirection:x,pageScaleMode:h,pageGap:T,customFilter:ge,shouldStretchPage:K,readerWidth:u,readerNavBarWidth:_,isPreloadMode:j,resumeMode:se,handleAsInitialRender:fe}),gt&&a.jsx(Ar,{chapterId:m,type:ce.NEXT})]}):null},wo=l.memo(Eo),Io=(e,t,r,s)=>{if(!de(e))return!1;const n=pn(t),o=fn(t),i=r!==window.innerWidth,c=s!==window.innerHeight;return n&&i||o&&c},jr=(e,t,r)=>{l.useLayoutEffect(()=>{r(t)},[e])},Ao=(e,t,r,s)=>{const n=l.useRef({width:window.innerWidth,height:window.innerHeight}),o=l.useRef(!1),i=l.useRef(void 0),c=l.useRef(null),d=l.useCallback(()=>{const{width:p,height:g}=n.current;n.current={width:window.innerWidth,height:window.innerHeight},o.current||(o.current=!0,c.current=s),Io(e,t,p,g)&&(r(c.current),clearTimeout(i.current),i.current=setTimeout(()=>{o.current=!1,c.current=null},50))},[e,t]);Vn("resize",d)},ps=e=>{const t=l.useRef({left:0,top:0,visibleElement:void 0,visibleElementLeft:0,visibleElementTop:0});return l.useEffect(()=>{const r=e.current;if(!r)return()=>{};const s=()=>{var o,i;const{visibleElement:n}=t.current;t.current={...t.current,left:r.scrollLeft,top:r.scrollTop,visibleElementLeft:(o=n==null?void 0:n.offsetLeft)!=null?o:0,visibleElementTop:(i=n==null?void 0:n.offsetTop)!=null?i:0}};return r.addEventListener("scroll",s),()=>r.removeEventListener("scroll",s)},[]),l.useEffect(()=>{const r=e.current;if(!r)return()=>{};const s=(i,c)=>Array.from(i).filter(d=>d instanceof HTMLElement).flatMap(d=>d instanceof HTMLImageElement?[d]:Array.from(d.querySelectorAll("img"))).forEach(c),n=new IntersectionObserver(i=>{const c=i.find(d=>d.isIntersecting);(c==null?void 0:c.target)instanceof HTMLElement&&(t.current={...t.current,visibleElement:c.target,visibleElementLeft:c.target.offsetLeft,visibleElementTop:c.target.offsetTop})}),o=new MutationObserver(i=>{for(const c of i)s(c.addedNodes,d=>n.observe(d)),s(c.removedNodes,d=>n.unobserve(d))});return o.observe(r,{childList:!0,subtree:!0}),()=>{o.disconnect(),n.disconnect()}},[]),t},Mo=(e,t)=>{const r=ps(e),s=de(t),n=Fe(t);l.useEffect(()=>{const o=e.current;if(!o||!s)return()=>{};const i=g=>{const{left:u,top:h,visibleElement:f,visibleElementLeft:x,visibleElementTop:S}=r.current;if(!f||!!!g.filter(w=>!(w.target instanceof HTMLElement)||!w.target.clientWidth&&!w.target.clientHeight?!1:n?w.target.offsetTop<h:Math.abs(w.target.offsetLeft)<Math.abs(u)).length)return;const P=u-x+f.offsetLeft,I=h-S+f.offsetTop;o.scrollTo(P,I)},c=(g,u)=>Array.from(g).filter(h=>h instanceof HTMLElement).flatMap(h=>h instanceof HTMLImageElement?[h]:Array.from(h.querySelectorAll("img"))).forEach(u),d=new ResizeObserver(i),p=new MutationObserver(g=>{for(const u of g)c(u.addedNodes,h=>d.observe(h)),c(u.removedNodes,h=>d.unobserve(h))});return p.observe(o,{childList:!0,subtree:!0}),()=>{p.disconnect(),d.disconnect()}},[s,n])},Oo=(e,t,r,s,n,o,i)=>{const c=ps(e),d=()=>{const p=e.current,{left:g,top:u,visibleElementLeft:h,visibleElementTop:f,visibleElement:x}=c.current;if(!p||!i||!x)return!1;const S=rs(r,n,o),T=s===0;if(!(!S.previous&&T))return!1;const P=g-h+x.offsetLeft,I=u-f+x.offsetTop;return p.scrollTo(P,I),!0};l.useEffect(()=>{const p=e.current;if(!p||!i)return()=>{};let g=!1;const u=(x,S)=>{Array.from(x).filter(T=>T instanceof HTMLElement).flatMap(T=>T instanceof HTMLImageElement?[T]:Array.from(T.querySelectorAll("img"))).forEach(S)},h=new ResizeObserver(()=>{g||(g=d(),g&&h.disconnect())}),f=new MutationObserver(x=>{for(const S of x)u(S.addedNodes,T=>h.observe(T)),u(S.removedNodes,T=>h.unobserve(T))});return f.observe(p,{childList:!0,subtree:!0}),()=>{f.disconnect(),h.disconnect()}},[t]),l.useLayoutEffect(()=>{d()},[t])},jo=(e,t,r,s,n,o,i,c,d,p)=>{Oo(e,t,r,s,n,o,de(i)),Mo(e,i),Ao(i,p,d,s),jr(c,s,d),jr(i,s,d)},yo={[z.SINGLE_PAGE]:ft.X,[z.DOUBLE_PAGE]:ft.X,[z.CONTINUOUS_VERTICAL]:ft.Y,[z.CONTINUOUS_HORIZONTAL]:ft.X,[z.WEBTOON]:ft.Y},Do=({readerNavBarWidth:e,updateCurrentPageIndex:t,ref:r})=>{var _e;const{direction:s}=nt(),n=sr(b=>b.overlay.isVisible),{currentPageIndex:o,pageToScrollToIndex:i,setPageToScrollToIndex:c,pages:d,totalPages:p,setPages:g,setPageLoadStates:u,setTotalPages:h,setCurrentPageIndex:f,transitionPageMode:x,retryFailedPagesKeyPrefix:S,setTransitionPageMode:T}=qe(b=>({currentPageIndex:b.pages.currentPageIndex,pageToScrollToIndex:b.pages.pageToScrollToIndex,setPageToScrollToIndex:b.pages.setPageToScrollToIndex,pages:b.pages.pages,totalPages:b.pages.totalPages,setPages:b.pages.setPages,setPageLoadStates:b.pages.setPageLoadStates,setTotalPages:b.pages.setTotalPages,setCurrentPageIndex:b.pages.setCurrentPageIndex,transitionPageMode:b.pages.transitionPageMode,retryFailedPagesKeyPrefix:b.pages.retryFailedPagesKeyPrefix,setTransitionPageMode:b.pages.setTransitionPageMode})),{initialChapter:m,currentChapter:P,chapters:I,visibleChapters:w,isCurrentChapterReady:A}=Ue(b=>({initialChapter:b.chapters.initialChapter,currentChapter:b.chapters.currentChapter,chapters:b.chapters.chapters,visibleChapters:b.chapters.visibleChapters,setReaderStateChapters:b.chapters.setReaderStateChapters,isCurrentChapterReady:b.chapters.isCurrentChapterReady})),{readingMode:E,readingDirection:R,readerWidth:C,pageScaleMode:M,shouldOffsetDoubleSpreads:D,imagePreLoadAmount:k,pageGap:B,customFilter:j,shouldStretchPage:G,isStaticNav:fe}=J(b=>({readingMode:b.settings.readingMode.value,readingDirection:b.settings.readingDirection.value,readerWidth:b.settings.readerWidth.value,pageScaleMode:b.settings.pageScaleMode.value,shouldOffsetDoubleSpreads:b.settings.shouldOffsetDoubleSpreads.value,imagePreLoadAmount:b.settings.imagePreLoadAmount,pageGap:b.settings.pageGap.value,customFilter:b.settings.customFilter,shouldStretchPage:b.settings.shouldStretchPage.value,isStaticNav:b.settings.isStaticNav})),{showPreview:se,setShowPreview:ge}=nr(b=>({showPreview:b.tapZone.showPreview,setShowPreview:b.tapZone.setShowPreview})),{resumeMode:K=pr.START}=(_e=Zr().state)!=null?_e:{resumeMode:pr.START},_=l.useRef(null),L=zn(r,_),Re=Fe(E),Me=de(E),Ce=io(_),ne=Vt(b=>({isPaused:b.autoScroll.isPaused,pause:b.autoScroll.pause,resume:b.autoScroll.resume,setScrollRef:b.autoScroll.setScrollRef}));l.useEffect(()=>ne.setScrollRef(_.current),[]);const Oe=fr.useGetScrollbarSize("width",_.current),Ge=fr.useGetScrollbarSize("height",_.current);l.useLayoutEffect(()=>{const{scrollbar:b}=ar();b.setXSize(Oe),b.setYSize(Ge)},[Oe,Ge]);const Pe=l.useRef(d.map(()=>null)),[{minChapterViewWidth:Te,minChapterViewHeight:Ne,minChapterSizeSourceChapterId:xe},$e]=l.useState({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),[,Je]=l.useState({}),at=yo[E],je=R===ct.LTR,Ee=l.useMemo(()=>I.findIndex(b=>b.id===(m==null?void 0:m.id)),[I,m==null?void 0:m.id]),X=l.useMemo(()=>I.slice(Math.max(0,Ee-w.trailing),Math.min(I.length,Ee+w.leading+1)),[I,Ee,w.trailing,w.leading]),ye=l.useMemo(()=>X.findIndex(b=>b.id===(P==null?void 0:P.id)),[P,X]),ke=l.useCallback((b,Y,he)=>{if(!Me)return;const U=he===xe;if(Re){if(!U&&Te>=b)return;$e({minChapterViewWidth:b,minChapterViewHeight:0,minChapterSizeSourceChapterId:he});return}(U||Ne<Y)&&$e({minChapterViewWidth:0,minChapterViewHeight:Y,minChapterSizeSourceChapterId:he})},[Me,Re,Te,Ne,xe]);if(po(i,o,d,p,c,t,Me,Pe,s,R),ho(o,Me,s,R,_),go(_),uo(E,R,_),lo(n,se,ge,_),co(n,ne.isPaused,ne.pause,ne.resume,fe),jo(_,P==null?void 0:P.id,ye,o,X,w,E,R,c,M),l.useLayoutEffect(()=>{$e({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),Je({})},[E]),!m||!P)throw new Error("ReaderViewer: illegal state - initialChapter and currentChapter should not be undefined");return a.jsx(N,{ref:L,sx:{width:"100%",height:"100%",overflow:"auto",flexWrap:"nowrap",...v(Re&&ts(C,M),{alignItems:"center"}),...v(!Re,{...v(s==="ltr",{flexDirection:je?"row":"row-reverse"}),...v(s==="rtl",{flexDirection:je?"row-reverse":"row"})})},onClick:b=>!Ce&&V.handleClick(_.current,b),onScroll:()=>V.updateCurrentPageOnScroll(Pe,p-1,t,at,R),children:X.map((b,Y)=>{var O,De,ot,At;const he=Math.max(0,X.length-Y-1),U=X[he],me=(O=X[he+1])!=null?O:I[Ee+w.leading+1],Qe=(De=X[he-1])!=null?De:I[Ee-w.trailing-1],dt=U.id===m.id,we=U.id===P.id,Xe=U.id===((ot=X[ye+1])==null?void 0:ot.id),It=U.id===((At=X[ye-1])==null?void 0:At.id),ut=m.sourceOrder>U.sourceOrder,gt=m.sourceOrder<U.sourceOrder,ht=w.lastLeadingChapterSourceOrder===U.sourceOrder,zt=w.lastTrailingChapterSourceOrder===U.sourceOrder,Ut=ht&&w.isLeadingChapterPreloadMode||zt&&w.isTrailingChapterPreloadMode,oe=rs(he,X,w),Ft=U.id===xe;return a.jsx(wo,{chapterId:U.id,previousChapterId:me==null?void 0:me.id,nextChapterId:Qe==null?void 0:Qe.id,isPreviousChapterVisible:oe.previous,isNextChapterVisible:oe.next,lastPageRead:it(U.lastPageRead,0,U.pageCount-1),currentPageIndex:mn(o,U,P,we,A,ut,gt,w),isInitialChapter:dt,isCurrentChapter:we,isPreviousChapter:Xe,isNextChapter:It,isLeadingChapter:ut,isTrailingChapter:gt,isPreloadMode:Ut,imageRefs:Pe,setPages:g,setPageLoadStates:u,setTotalPages:h,setCurrentPageIndex:f,setPageToScrollToIndex:c,transitionPageMode:x,retryFailedPagesKeyPrefix:S,readingMode:E,readerWidth:C,pageScaleMode:M,shouldOffsetDoubleSpreads:D,readingDirection:R,updateCurrentPageIndex:we?t:He,scrollIntoView:we&&w.scrollIntoView,resumeMode:xn(we,dt,ut,gt,w.resumeMode,K),setTransitionPageMode:T,pageGap:B,imagePreLoadAmount:k,customFilter:j,shouldStretchPage:G,readerNavBarWidth:e,onSizeChange:ke,minWidth:Ft?0:Te,minHeight:Ft?0:Ne,scrollElement:_.current},U.id)})})},Lo=ue(l.memo(Do),[()=>({updateCurrentPageIndex:V.useUpdateCurrentPageIndex()}),Ke],["readerNavBarWidth","updateCurrentPageIndex"]),Bo=Object.fromEntries(Object.values(Tt).map(e=>[e,{scopes:e}])),re=(...e)=>{const[t,r,s,n]=e;return Us(t,r,{...s,...Bo.reader},n)},Xt=(e,t,r,s,n)=>{if(s){y.updateSetting(e,r[0]);return}const o=ds(r.indexOf(t),r,n);if(o===void 0){y.deleteSetting(e);return}y.updateSetting(e,o)},No=({scrollElementRef:e})=>{const t=y.useGetThemeDirection(),{enableScope:r,disableScope:s}=Nr(),{hotkeys:n}=J(i=>({hotkeys:i.settings.hotkeys})),o=y.useExit();return re(n[Q.PREVIOUS_PAGE],()=>V.openPage("previous")),re(n[Q.NEXT_PAGE],()=>V.openPage("next")),re(n[Q.SCROLL_BACKWARD],()=>{const i=jt(),{readingMode:c,readingDirection:d,scrollAmount:p}=Z();if(i.isActive){i.setDirection(le.BACKWARD);return}e.current&&V.scroll(le.BACKWARD,Jt[c.value],c.value,d.value,e.current,Pt().setShowPreview,p)},{preventDefault:!0}),re(n[Q.SCROLL_FORWARD],()=>{const i=jt(),{readingMode:c,readingDirection:d,scrollAmount:p}=Z();if(i.isActive){i.setDirection(le.FORWARD);return}e.current&&V.scroll(le.FORWARD,Jt[c.value],c.value,d.value,e.current,Pt().setShowPreview,p)},{preventDefault:!0}),re(n[Q.PREVIOUS_CHAPTER],()=>V.openChapter(q("previous","next",t)),[t]),re(n[Q.NEXT_CHAPTER],()=>V.openChapter(q("next","previous",t)),[t]),re(n[Q.TOGGLE_MENU],()=>ze().setIsVisible(!ze().isVisible)),re(n[Q.CYCLE_SCALE_TYPE],()=>{Xt("pageScaleMode",Z().pageScaleMode.value,Fr,Z().pageScaleMode.isDefault,!0)},[]),re(n[Q.STRETCH_IMAGE],()=>y.updateSetting("shouldStretchPage",!Z().shouldStretchPage.value)),re(n[Q.OFFSET_SPREAD_PAGES],()=>y.updateSetting("shouldOffsetDoubleSpreads",!Z().shouldOffsetDoubleSpreads.value)),re(n[Q.CYCLE_READING_MODE],()=>{Xt("readingMode",Z().readingMode.value,Wr,Z().readingMode.isDefault,!0)}),re(n[Q.CYCLE_READING_DIRECTION],()=>{Xt("readingDirection",Z().readingDirection.value,Gr,Z().readingDirection.isDefault,!0)}),re(n[Q.TOGGLE_AUTO_SCROLL],()=>jt().toggleActive(),{preventDefault:!0}),re(n[Q.AUTO_SCROLL_SPEED_DECREASE],()=>y.updateSetting("autoScroll",{...Z().autoScroll,value:Math.min(Ve.max,Z().autoScroll.value+Ve.step)})),re(n[Q.AUTO_SCROLL_SPEED_INCREASE],()=>y.updateSetting("autoScroll",{...Z().autoScroll,value:Math.max(Ve.min,Z().autoScroll.value-Ve.step)})),re(n[Q.EXIT_READER],o,[o]),l.useEffect(()=>(r(Tt.READER),()=>s(Tt.READER)),[]),null},ko=()=>{l.useEffect(()=>()=>{ar().reset()},[])},_o=(e,t,r,s,n,o)=>{var i;l.useEffect(()=>{var x;const c=(x=e.data)==null?void 0:x.manga;if(!c||t.loading||t.error)return;const d=Sr(c,r),p=vn(c,d.shouldUseAutoWebtoonMode,d.readingMode),g={...r,readingMode:p?z.WEBTOON:r.readingMode},u=p?z.WEBTOON:d.readingMode.value,h=Sn("global",{meta:s},g,void 0,u),f=Sr(c,h);n(f),o(!0)},[(i=e.data)==null?void 0:i.manga,r])},yr=5e3,Ho=(e,t,r,s,n,o,i,c,d)=>{const{t:p}=W(),g=l.useRef(void 0),u=l.useRef(void 0),h=l.useRef(void 0),f=l.useRef(!0);l.useEffect(()=>{if(e||t||!r)return;const x=JSON.stringify(s)!==JSON.stringify(g.current);i&&x&&Xr(p(qt[s.value].title),{autoHideDuration:yr}),g.current=s;const T=JSON.stringify(n)!==JSON.stringify(u.current)||JSON.stringify(o)!==JSON.stringify(h.current);c&&T&&(d(!0),f.current&&setTimeout(()=>d(!1),yr)),u.current=n,h.current=o,f.current=!1},[e,t,r,s.value,s.isDefault,n.value,n.isDefault,o.value,o.isDefault])},Vo=(e,t,r,s,n,o,i,c)=>{var h;const d=Fs(),p=Zr().state,{updateInitialChapter:g}=p!=null?p:{},u=g?void 0:s;l.useEffect(()=>{var A,E;const f=(A=e.data)==null?void 0:A.chapters.nodes,x=f?(E=f[f.length-t])!=null?E:null:void 0,S=u!=null?u:x,T=n!=null?n:x,m=(()=>{if(!f||!T)return[];const R=i?In(r!=null?r:f,c):f;return(o?Le.removeDuplicates(T,R):R).map(M=>qr(M.id))})(),P=x&&Le.getNextChapter(x,m,{offset:Ye.NEXT}),I=x&&Le.getNextChapter(x,m,{offset:Ye.PREVIOUS}),w=S!=null&&S.id!==(u==null?void 0:u.id);w&&d("",{replace:!0,state:{...p,updateInitialChapter:void 0}}),et().setReaderStateChapters(R=>{var M,D,k,B;const C=(x==null?void 0:x.id)!==((M=R.currentChapter)==null?void 0:M.id);return{...R,mangaChapters:(D=R.mangaChapters)!=null?D:f,chapters:m,initialChapter:S,chapterForDuplicatesHandling:T,currentChapter:x,nextChapter:P,previousChapter:I,isCurrentChapterReady:C?!1:R.isCurrentChapterReady,visibleChapters:w?{...Gt.chapters.visibleChapters,lastLeadingChapterSourceOrder:(k=S==null?void 0:S.sourceOrder)!=null?k:Gt.chapters.visibleChapters.lastLeadingChapterSourceOrder,lastTrailingChapterSourceOrder:(B=S==null?void 0:S.sourceOrder)!=null?B:Gt.chapters.visibleChapters.lastTrailingChapterSourceOrder,isLeadingChapterPreloadMode:!1,isTrailingChapterPreloadMode:!1,scrollIntoView:!!R.initialChapter}:R.visibleChapters}})},[(h=e.data)==null?void 0:h.chapters.nodes,t,o,i,u,c])},zo=1,Dr=(e,t,r=!1,s=!1)=>{const n=Math.max(e*t,zo),o=r?-n:n;return s?o*-1:o},Lr=(e,t,r)=>e*(t/100)/r;function Br(e,t,r,s,n){if(n(),!e){r(setInterval(()=>{s(t)},t),"interval");return}let o;const i=c=>{const d=c-(o!=null?o:c);o=c,s(d),r(requestAnimationFrame(i),"animationFrame")};r(requestAnimationFrame(i),"animationFrame")}const Uo=(e,t,r=Ie.Y,s=100,n=!1,o=!1)=>{const i=typeof e=="function",c=l.useRef(void 0),d=l.useRef(void 0),p=l.useRef(-1),[g,u]=l.useState(!1),[h,f]=l.useState(!1),[x,S]=l.useState({width:window.innerWidth,height:window.innerHeight});We(document.documentElement,l.useCallback(()=>{const E=window.innerWidth,R=window.innerHeight;(x.width!==E||x.height!==R)&&S({width:E,height:R})},[]));const T=l.useCallback(()=>{clearTimeout(d.current),cancelAnimationFrame(p.current)},[]),m=l.useCallback(()=>{u(!0)},[]),P=l.useCallback(()=>{u(!1),f(!1),T()},[]),I=l.useCallback(()=>{if(g){P();return}m()},[g]),w=l.useCallback(()=>{f(!0)},[]),A=l.useCallback(()=>{f(!1)},[]);return l.useEffect(()=>{if(!e||!g)return()=>{};if(h)return T(),()=>{};const E=t*1e3;if(i)return Br(!1,E,j=>{d.current=j},e,T),()=>T();const R=e.current;if(!R)return()=>{};c.current||(c.current=getComputedStyle(R));const C=c.current.direction==="rtl",M=r!==Ie.Y,D=r!==Ie.X,k=Lr(window.innerWidth,s,E),B=Lr(window.innerHeight,s,E);return Br(o,E,(j,G)=>{switch(G){case"interval":d.current=j;break;case"animationFrame":p.current=j;break;default:throw new Error('Unexpected "type" ('.concat(G,")"))}},j=>{R.scrollBy({top:Number(D)*Dr(B,j,!1,n),left:Number(M)*Dr(k,j,C,n),behavior:o?void 0:"smooth"})},T),()=>T()},[e,t,s,x,g,h,n,o]),l.useMemo(()=>({isActive:g,isPaused:h,start:m,cancel:P,toggleActive:I,pause:w,resume:A}),[g,h,m,P,I,w,A])},Fo=({themeDirection:e,combinedDirection:t})=>{const{scrollRef:r,direction:s}=Vt(u=>({scrollRef:u.autoScroll.scrollRef,direction:u.autoScroll.direction})),{readingMode:n,autoScroll:o}=J(u=>({readingMode:u.settings.readingMode.value,autoScroll:u.settings.autoScroll})),c=n===z.CONTINUOUS_HORIZONTAL&&e!==t?q(s===le.BACKWARD,s===le.FORWARD,t):s===le.BACKWARD,d=de(n),p=l.useCallback(()=>{V.openPage("next","ltr")},[]),g=Uo(d?r:p,o.value,Jt[n],_r.MEDIUM,c,o.smooth);return l.useEffect(()=>{const u=jt();u.setIsActive(g.isActive),u.setIsPaused(g.isPaused),u.setStart(g.start),u.setCancel(g.cancel),u.setToggleActive(g.toggleActive),u.setPause(g.pause),u.setResume(g.resume)},[g]),null},Wo=ue(l.memo(Fo),[()=>({themeDirection:nt().direction}),()=>({combinedDirection:y.useGetThemeDirection()})],["themeDirection","combinedDirection"]),Go=({setOverride:e,readerNavBarWidth:t})=>{var ge,K,_;const{t:r}=W(),s=wt(L=>L.manga),{mangaChapters:n,initialChapter:o,chapterForDuplicatesHandling:i,currentChapter:c}=Ue(L=>({mangaChapters:L.chapters.mangaChapters,initialChapter:L.chapters.initialChapter,chapterForDuplicatesHandling:L.chapters.chapterForDuplicatesHandling,currentChapter:L.chapters.currentChapter})),{shouldSkipDupChapters:d,shouldSkipFilteredChapters:p,backgroundColor:g,readingMode:u,tapZoneLayout:h,tapZoneInvertMode:f,shouldShowReadingModePreview:x,shouldShowTapZoneLayoutPreview:S,setSettings:T}=J(L=>({shouldSkipDupChapters:L.settings.shouldSkipDupChapters,shouldSkipFilteredChapters:L.settings.shouldSkipFilteredChapters,backgroundColor:L.settings.backgroundColor,readingMode:L.settings.readingMode,tapZoneLayout:L.settings.tapZoneLayout,tapZoneInvertMode:L.settings.tapZoneInvertMode,shouldShowReadingModePreview:L.settings.shouldShowReadingModePreview,shouldShowTapZoneLayoutPreview:L.settings.shouldShowTapZoneLayoutPreview,setSettings:L.settings.setSettings})),m=nr(L=>L.tapZone.setShowPreview),P=l.useRef(null),[I,w]=l.useState(!1),{chapterSourceOrder:A,mangaId:E}=Ws(),R=Number(A),C=Number(E),M=Et.useGetManga(Gs,C),D=Et.useGetMangaChapters($s,C);Un(!s||!c?r("reader.title",{mangaId:C,chapterIndex:R}):"".concat(s.title,": ").concat(c.name));const{metadata:k,settings:B,request:j}=bn(),G=An(s!=null?s:or),fe=c===void 0||!I||M.loading||D.loading||j.loading,se=(K=(ge=M.error)!=null?ge:D.error)!=null?K:j.error;return l.useEffect(()=>{var L;ar().setManga((L=M.data)==null?void 0:L.manga)},[(_=M.data)==null?void 0:_.manga]),ko(),_o(M,j,B,k,T,w),Ho(fe,se,I,u,h,f,x,S,m),Vo(D,R,n,o,i,d,p,G),l.useLayoutEffect(()=>(e({status:!0,value:a.jsxs($,{sx:{position:"absolute"},children:[a.jsx(No,{scrollElementRef:P}),a.jsx(ro,{}),!P.current&&a.jsx($,{onClick:()=>ze().setIsVisible(!ze().isVisible),sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"transparent"}})]})}),()=>e({status:!1,value:null})),[P.current]),se?a.jsx(Bt,{message:r("global.error.label.failed_to_load_data"),messageExtra:Kr(se),retry:()=>{M.error&&M.refetch().catch(St()),j.error&&j.refetch().catch(St()),D.error&&D.refetch().catch(St())}}):fe?a.jsx($,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:a.jsx(_t,{})}):c===null?a.jsx(Bt,{message:r("reader.error.label.chapter_not_found")}):!s||!c?null:a.jsxs($,{sx:{position:"relative",display:"flex",flexDirection:"column",minWidth:"calc(100vw - ".concat(t,"px)"),maxWidth:"calc(100vw - ".concat(t,"px)"),width:"calc(100vw - ".concat(t,"px)"),height:"100vh",marginLeft:"".concat(t,"px"),transition:L=>"width 0.".concat(L.transitions.duration.shortest,"s, margin-left 0.").concat(L.transitions.duration.shortest,"s"),overflow:"auto",backgroundColor:Yr[g]},children:[a.jsx(Lo,{ref:P}),a.jsx(no,{}),a.jsx(oo,{}),a.jsx(Wo,{})]})},Di=ue(l.memo(Go),[Ke],["setOverride","readerNavBarWidth"]);export{Di as Reader};
