import{r as z,i as T,j as e,u as q,a as n,c as f,N as V,f as m,I as p,g as B,E as C,h as S,B as v,L as N,S as F,T as y,m as R}from"./index-Buo3ze1d.js";import{d as G}from"./Delete-DHKOWmi6.js";import{D as W,S as J,P as K,d as U}from"./StrictModeDroppable-DDSiaRRI.js";import{d as X}from"./PlayArrow-BB4cXyYz.js";import{V as Y,C as Z,a as ee}from"./index-D7rGQn8F.js";import{D as re}from"./DownloadStateIndicator-C2Uzclzm.js";var j={},te=T;Object.defineProperty(j,"__esModule",{value:!0});var $=j.default=void 0,ae=te(z()),oe=e;$=j.default=(0,ae.default)((0,oe.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause");var w={},se=T;Object.defineProperty(w,"__esModule",{value:!0});var k=w.default=void 0,ne=se(z()),le=e;k=w.default=(0,ne.default)((0,le.jsx)("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3zM14 5h-3l-1-1H6L5 5H2v2h12z"}),"DeleteSweep");const ie=({children:t,...s})=>e.jsx(v,{...s,style:{height:s["data-known-size"]||void 0},children:t}),I=({provided:t,item:s,isDragging:h,handleDelete:i})=>{const{t:g}=q();return e.jsx(v,{...t.draggableProps,...t.dragHandleProps,ref:t.innerRef,sx:{pt:1,px:1},children:e.jsx(Z,{sx:{backgroundColor:h?"custom.light":void 0},children:e.jsxs(ee,{component:N,to:"/manga/".concat(s.chapter.manga.id),sx:{display:"flex",alignItems:"center",p:1},children:[e.jsx(p,{sx:{pointerEvents:"none"},children:e.jsx(U,{})}),e.jsxs(F,{sx:{flex:1,ml:1},direction:"column",children:[e.jsx(y,{variant:"h6",children:s.chapter.manga.title}),e.jsx(y,{variant:"caption",display:"block",gutterBottom:!0,children:s.chapter.name})]}),e.jsx(re,{download:s}),e.jsx(m,{title:g("chapter.action.download.delete.label.action"),children:e.jsx(p,{onClick:d=>{d.preventDefault(),d.stopPropagation(),i(s.chapter)},size:"large",children:e.jsx(G,{})})})]})})})},xe=()=>{var E,P;const{t}=q(),[s,{reset:h}]=n.useReorderChapterInDownloadQueue(),{data:i,loading:g,error:d,refetch:O}=n.useGetDownloadStatus({notifyOnNetworkStatusChange:!0}),l=i==null?void 0:i.downloadStatus,u=(E=l==null?void 0:l.queue)!=null?E:[],c=(P=l==null?void 0:l.state)!=null?P:"STARTED",x=!u.length,{setTitle:D,setAction:b}=f.useContext(V),H=async()=>{try{await n.clearDownloads().response}catch(r){R(t("download.queue.error.label.failed_delete_all"),"error")}},M=()=>{c==="STOPPED"?n.startDownloads():n.stopDownloads()};f.useEffect(()=>(D(t("download.queue.title")),b(e.jsxs(e.Fragment,{children:[e.jsx(m,{title:t("download.queue.label.delete_all"),children:e.jsx(p,{onClick:H,size:"large",children:e.jsx(k,{})})}),e.jsx(m,{title:t(c==="STOPPED"?"global.button.start":"global.button.stop"),children:e.jsx(p,{onClick:M,size:"large",disabled:x,children:c==="STOPPED"?e.jsx(X,{}):e.jsx($,{})})})]})),()=>{D(""),b(null)}),[t,c,x]),f.useEffect(()=>{const r=a=>{(a.message==="ResizeObserver loop completed with undelivered notifications."||a.message==="ResizeObserver loop limit exceeded")&&a.stopImmediatePropagation()};return window.addEventListener("error",r),()=>window.removeEventListener("error",r)},[]);const L=(r,a,o)=>{a!==o&&s({variables:{input:{chapterId:r[a].chapter.id,to:o}}}).catch(()=>{h()})},A=r=>{r.destination&&L(u,r.source.index,r.destination.index)},_=async r=>{const a=c==="STARTED";try{a&&await n.stopDownloads().response,await Promise.all([n.removeChapterFromDownloadQueue(r.id).response,n.deleteDownloadedChapter(r.id).response])}catch(o){R(t("download.queue.error.label.failed_to_remove"),"error")}a&&n.startDownloads().response.catch(S())};return g?e.jsx(B,{}):d?e.jsx(C,{message:t("global.error.label.failed_to_load_data"),messageExtra:d.message,retry:()=>O().catch(S())}):x?e.jsx(C,{message:t("download.queue.label.no_downloads")}):e.jsx(W,{onDragEnd:A,children:e.jsx(J,{droppableId:"droppable",mode:"virtual",renderClone:(r,a,o)=>e.jsx(I,{provided:r,item:u[o.source.index],isDragging:a.isDragging,handleDelete:_}),children:r=>e.jsx(v,{ref:r.innerRef,children:e.jsx(Y,{useWindowScroll:!0,overscan:window.innerHeight*.5,data:u,components:{Item:ie},itemContent:(a,o)=>e.jsx(K,{draggableId:"".concat(o.chapter.manga.id,"-").concat(o.chapter.sourceOrder),index:a,children:Q=>e.jsx(I,{provided:Q,item:o,isDragging:!1,handleDelete:_})},"".concat(o.chapter.manga.id,"-").concat(o.chapter.sourceOrder))})})})})};export{xe as DownloadQueue};
