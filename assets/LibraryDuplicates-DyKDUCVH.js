import{u as S,aq as y,Z as x,r as G,bP as v,b as s,j as e,e as A,g as E,f as D,T as f,z as B,a5 as _,I as F,a4 as P,s as w,a6 as V,a7 as K,ax as U}from"./index-DtQrBt4M.js";import{G as W}from"./GridLayouts-BL5hUuzi.js";import{C as q}from"./CheckboxInput-nUettrcV.js";import{E as z}from"./EmptyViewAbsoluteCentered-DI8B4Znn.js";import{c as H}from"./MangaGrid-BX7IYWw3.js";import{S as N,a as b}from"./StyledGroupHeader-C1H_NPup.js";import{B as R}from"./BaseMangaGrid-p3ApG3Ok.js";import{S as $}from"./StyledGroupItemWrapper-lnxftLDV.js";import{V as O}from"./Virtuoso.util-DmSxE_xX.js";import{u as Z}from"./useAppTitleAndAction-PYWtMrOZ.js";import"./Checkbox-BflEth31.js";import"./SwitchBase-DsJUurlx.js";import"./ListPreference-vpJJtb53.js";import"./FormGroup-CGnUOrUb.js";import"./useManageMangaLibraryState-ov3VZlXp.js";import"./Chapters-GxJSDZJ7.js";import"./DateHelper-BqLcb6il.js";import"./Asserts-C0856h9S.js";import"./Mangas-CKRoohmQ.js";import"./ThreeStateCheckboxInput-C25RFnac.js";import"./Delete-FiCE_LSZ.js";import"./Download-BCPaQv4d.js";import"./ContinueReadingTooltip-Dypy5p2F.js";import"./Trackers-Bgo8y--2.js";import"./AvatarSpinner-DUVVuAKz.js";import"./SpinnerImage-C9pQjMpG.js";import"./Refresh-DJLFrVAM.js";import"./Card-BbwqA1T1.js";import"./ListCardContent-CNnYMY6x.js";import"./CheckCircle-CPcYacUU.js";import"./Metadata-NC0XKnck.js";import"./MUI.util-CEodEA2f.js";import"./CardActionArea-CHU1s-nP.js";import"./Link-DkBDjiPX.js";import"./NumberSetting-i9dDfmNN.js";import"./Slider-BzYEmfyX.js";import"./useMobilePicker-DZ_iuGud.js";import"./Chip-CLEn_YA0.js";import"./SelectSetting-CeTDmTjP.js";import"./Select-XMo28PZU.js";import"./Sync-zyHFH569.js";import"./use-merged-ref-D-ccnGyI.js";import"./ListCardAvatar-CFpDzWCg.js";import"./PlayArrow-BhGO3FwY.js";import"./StyledFab-BYjwCb63.js";import"./index-CvZdBQYg.js";import"./useAppTitle-BJQWe9Un.js";import"./useAppAction-CZ-aQqcK.js";const Ht=()=>{const{t:p}=S(),[n,j]=y("libraryDuplicatesGridLayout",x.List),[m,C]=y("libraryDuplicatesCheckAlternativeTitles",!1);Z(p("library.settings.advanced.duplicates.label.title"),e.jsxs(e.Fragment,{children:[e.jsx(W,{gridLayout:n,onChange:j}),e.jsx(_,{variant:"popover",popupId:"library-dupliactes-settings",children:t=>e.jsxs(e.Fragment,{children:[e.jsx(F,{...P(t),color:"inherit",children:e.jsx(w,{})}),e.jsx(V,{...K(t),children:e.jsx(U,{children:e.jsx(q,{label:p("library.settings.advanced.duplicates.settings.label.check_description"),checked:m,onChange:(r,l)=>C(l)})})})]})})]}),[p,n,m]);const{data:i,loading:M,error:u,refetch:L}=G.useGetMangas(v,{condition:{inLibrary:!0}}),[T,d]=s.useState(!0),[o,g]=s.useState({});s.useEffect(()=>{var l;d(!0);const t=(l=i==null?void 0:i.mangas.nodes)!=null?l:[];if(!t.length)return g({}),()=>{};const r=new Worker(new URL("/assets/LibraryDuplicatesWorker-DSTy3Dmj.js",import.meta.url),{type:"module"});return r.onmessage=I=>{g(I.data),d(!1)},r.postMessage({mangas:t,checkAlternativeTitles:m}),()=>r.terminate()},[i==null?void 0:i.mangas.nodes,m]);const a=s.useMemo(()=>Object.keys(o).toSorted((t,r)=>t.localeCompare(r)),[o]),c=s.useMemo(()=>a.map(t=>o[t]).flat(),[o]),h=s.useMemo(()=>a.map(t=>o[t]).map(t=>t.length),[o]),k=O.useCreateGroupedComputeItemKey(h,s.useCallback(t=>a[t],[a]),s.useCallback((t,r)=>"".concat(a[r],"-").concat(c[t].id,"}"),[a,c]));return M||T?e.jsx(A,{}):u?e.jsx(z,{message:p("global.error.label.failed_to_load_data"),messageExtra:E(u),retry:()=>L().catch(D())}):n===x.List?e.jsx(N,{persistKey:"library-duplicates",groupCounts:h,groupContent:t=>e.jsx(b,{isFirstItem:t===0,children:e.jsx(f,{variant:"h5",component:"h2",children:a[t]})}),computeItemKey:k,itemContent:t=>e.jsx($,{children:e.jsx(H,{manga:c[t],gridLayout:n,selected:null,mode:"duplicate"})})}):a.map((t,r)=>e.jsxs(B,{children:[e.jsx(b,{sx:{pt:r===0?void 0:0,pb:0},isFirstItem:!1,children:e.jsx(f,{variant:"h5",component:"h2",children:t})}),e.jsx(R,{mangas:o[t],hasNextPage:!1,loadMore:()=>{},isLoading:!1,gridLayout:n,inLibraryIndicator:!1,horizontal:!0,mode:"duplicate"},m.toString())]},t))};export{Ht as LibraryDuplicates};
