import{u as Z,j as e,N as c,av as Q,v as o,d6 as q,d7 as ee,d8 as N,bE as se,m as R,g as T,r as P,e as ae,f as te,d9 as ie,s as l,F as re,i as de,k as z,da as I,cO as d,db as ne,dc as w,dd as B,cF as f,de as H,cC as oe,bl as X,df as K,G as W,dg as J}from"./index-BeKqgGKZ.js";import{N as _}from"./NumberSetting-P2DkhItC.js";import{S}from"./SelectSetting-tLuAuDUe.js";import{E as le}from"./EmptyViewAbsoluteCentered-DyDu9RIa.js";import{u as ge}from"./useAppTitle-LfsGNaad.js";import{C as ce}from"./LoginDialog-LNMoaLc3.js";import{a as he}from"./Asserts-xItX73wb.js";import{L as u}from"./ListSubheader-BqQ113AT.js";import{S as g}from"./Switch-DHyslwgU.js";import{L as ue}from"./Link-BQmOKeEU.js";import"./Slider-sNaarOa3.js";import"./Select-Cumjb25j.js";import"./SwitchBase-DTMsCk50.js";const xe=({settings:{koreaderSyncPercentageTolerance:a,koreaderSyncStrategyBackward:G,koreaderSyncStrategyForward:L,koreaderSyncChecksumMethod:M},serverAddress:h,username:y,isLoggedIn:v,updateSetting:j})=>{const{i18n:r,_:V}=Z(),A=async()=>{const{data:i}=await P.koSyncLogout().response;if(i!=null&&i.logoutKoSyncAccount.status.isLoggedIn)throw new Error(r._({id:"lOSiAU"}))},O=async(i,m,U)=>{var t;const{data:n}=await P.koSyncLogin(i,m,U).response;if(!(n!=null&&n.connectKoSyncAccount.status.isLoggedIn))throw new Error((t=n==null?void 0:n.connectKoSyncAccount.message)!=null?t:r._({id:"Ef7StM"}))},x=async(i="https://sync.koreader.rocks/",m,U)=>{const n=ce.showControlled({title:v?r._({id:"Xhiyqx"}):r._({id:"Y7Xyov"}),description:v?r._({id:"wHIs4p",values:{initialUsername:m,initialServerAddress:i}}):void 0,isLoading:!1,isLoggedIn:v,withServerAddress:!0,username:m,password:U,serverAddress:i,loginLogout:async(t,b,C)=>{if(n.update({isLoading:!0,loginLogout:se}),v){try{await A(),n.submit()}catch(p){R(r._({id:"GMbSBT"}),"error",T(p))}return}try{he(C),await O(C,t,b),n.submit()}catch(p){R(r._({id:"afv3MM"}),"error",T(p));const E="__retry__";await Promise.race([n.promise,Promise.resolve(E)])===E&&x(C,t,b)}}},{id:"koreader-sync-login-logout"})};return e.jsxs(c,{subheader:e.jsx(u,{component:"div",id:"koreader-sync-settings",children:r._({id:"OWRDvt"})}),children:[e.jsx(Q,{onClick:()=>x(h!=null?h:void 0,y!=null?y:void 0),children:e.jsx(o,{primary:r._({id:"bRUdLR"}),secondary:v?r._({id:"b399gU",values:{currentUsername:y,currentServerAddress:h}}):r._({id:"ZYnwzF"})})}),e.jsx(S,{settingName:r._({id:"+RWMg+"}),value:L,values:q,handleChange:i=>j("koreaderSyncStrategyForward",i)}),e.jsx(S,{settingName:r._({id:"/XdHDm"}),value:G,values:q,handleChange:i=>j("koreaderSyncStrategyBackward",i)}),e.jsx(S,{settingName:r._({id:"Qys1LM"}),value:M,values:ee,handleChange:i=>j("koreaderSyncChecksumMethod",i)}),e.jsx(_,{settingTitle:r._({id:"rImcuw"}),dialogDescription:r._({id:"dTsOHI"}),settingValue:a.toString(),value:a,defaultValue:N.default,minValue:N.min,maxValue:N.max,stepSize:N.step,valueUnit:"",handleUpdate:i=>j("koreaderSyncPercentageTolerance",i)})]})},me=a=>a===0?W._({id:"qqeAJM"}):W._({id:"yzAXZK",values:{ttl:a}}),Pe=()=>{var E,D,Y;const{i18n:a,_:G}=Z();ge(a._({id:"sGH11W"}));const{settings:{serverInformAvailableUpdate:L},loading:M,request:{error:h,refetch:y}}=ae(),v=re(s=>R(a._({id:"cBoXe4"}),"error",T(s))),{data:j,loading:r,error:V,refetch:A}=P.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[O]=P.useUpdateServerSettings(),x=P.useKoSyncStatus(),i=async(s,F,k)=>{try{await O({variables:{input:{settings:{[s]:F}}}}),k==null||k(!0)}catch($){R(a._({id:"cBoXe4"}),"error",T($)),k==null||k(!1)}},m=te.useMemo(()=>e.jsxs(c,{subheader:e.jsx(u,{component:"div",id:"server-settings-client",children:a._({id:"+6NyRG"})}),children:[e.jsx(ie,{}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"IV9G4u"}),secondary:a._({id:"3tqdsS"})}),e.jsx(g,{edge:"end",checked:L,onChange:s=>v("serverInformAvailableUpdate",s.target.checked)})]})]}),[L]);if(M||r||x.loading)return e.jsxs(e.Fragment,{children:[m,e.jsx(de,{})]});const n=(E=h!=null?h:V)!=null?E:x.error;if(n)return e.jsxs(e.Fragment,{children:[m,e.jsx(le,{message:a._({id:"6m5aox"}),messageExtra:T(n),retry:()=>{h&&y().catch(z("ServerSettings::refetchServerMetadataSettings")),V&&A().catch(z("ServerSettings::refetchServerSettings")),x.error&&x.refetch().catch(z("ServerSettings::koSyncStatus.refetch"))}})]});const t=j.settings,b=x.data.koSyncStatus,C=!((D=t.authUsername)!=null&&D.trim())||!((Y=t.authPassword)!=null&&Y.trim()),p=t.databaseType===I.H2;return e.jsxs(c,{sx:{pt:0},children:[m,e.jsxs(c,{subheader:e.jsx(u,{component:"div",id:"server-settings-server-address",children:a._({id:"iJnGhA"})}),children:[e.jsx(d,{settingName:a._({id:"XDWu5B"}),handleChange:s=>i("ip",s),value:t.ip,placeholder:"0.0.0.0"}),e.jsx(_,{settingTitle:a._({id:"hZ6znB"}),settingValue:t.port.toString(),handleUpdate:s=>i("port",s),value:t.port,defaultValue:4567,valueUnit:a._({id:"hZ6znB"})})]}),e.jsxs(c,{subheader:e.jsx(u,{component:"div",id:"server-settings-socks-proxy",children:a._({id:"IdzG48"})}),children:[e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"HwFBFo"})}),e.jsx(g,{edge:"end",checked:t.socksProxyEnabled,onChange:s=>i("socksProxyEnabled",s.target.checked)})]}),e.jsx(S,{settingName:a._({id:"2g+1ub"}),value:t.socksProxyVersion,values:[[4,{text:"4"}],[5,{text:"5"}]],handleChange:s=>i("socksProxyVersion",s)}),e.jsx(d,{settingName:a._({id:"ZTBYmB"}),value:t.socksProxyHost,handleChange:s=>i("socksProxyHost",s)}),e.jsx(d,{settingName:a._({id:"PV+Q4R"}),value:t.socksProxyPort,handleChange:s=>i("socksProxyPort",s)}),e.jsx(d,{settingName:a._({id:"5HymAx"}),value:t.socksProxyUsername,handleChange:s=>i("socksProxyUsername",s)}),e.jsx(d,{settingName:a._({id:"+vIDaq"}),value:t.socksProxyPassword,handleChange:s=>i("socksProxyPassword",s),isPassword:!0})]}),e.jsxs(c,{subheader:e.jsx(u,{component:"div",id:"server-settings-auth",children:a._({id:"P8fBlG"})}),children:[e.jsx(S,{settingName:a._({id:"nCdrw7"}),value:t.authMode,values:ne,handleChange:s=>{i("authMode",s,F=>{F&&(s!==w.UiLogin&&J.removeTokens(),J.setAuthRequired(s===w.UiLogin))})},disabled:C}),e.jsx(d,{settingName:a._({id:"7sNhEz"}),value:t.authUsername,validate:s=>t.authMode===w.None||!!s.trim(),handleChange:s=>i("authUsername",s)}),e.jsx(d,{settingName:a._({id:"8ZsakT"}),value:t.authPassword,isPassword:!0,validate:s=>t.authMode===w.None||!!s.trim(),handleChange:s=>i("authPassword",s)}),t.authMode===w.UiLogin&&e.jsxs(e.Fragment,{children:[e.jsx(d,{settingName:a._({id:"4cDbUL"}),value:t.jwtAudience,handleChange:s=>i("jwtAudience",s)}),e.jsx(_,{settingTitle:a._({id:"iy6/4L"}),settingValue:f(t.jwtTokenExpiry).minutes.humanize(),value:f(t.jwtTokenExpiry).minutes.inWholeMinutes,valueUnit:a._({id:"6UYTy8"}),defaultValue:B.default,minValue:B.min,maxValue:B.max,handleUpdate:s=>i("jwtTokenExpiry",f(s).minutes.toISOString()),showSlider:!0}),e.jsx(_,{settingTitle:a._({id:"edd3iD"}),settingValue:f(t.jwtRefreshExpiry).days.humanize(),value:f(t.jwtRefreshExpiry).days.inWholeDays,valueUnit:a._({id:"H7OUPr"}),defaultValue:H.default,minValue:H.min,maxValue:H.max,handleUpdate:s=>i("jwtRefreshExpiry",f(s).days.toISOString()),showSlider:!0})]})]}),e.jsxs(c,{subheader:e.jsx(u,{component:"div",id:"server-settings-clouadflare-bypass",children:a._({id:"suR1M1"})}),children:[e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"AqggDz"}),secondary:e.jsx(oe,{id:"+XFSWG",components:{0:e.jsx(ue,{href:"https://github.com/FlareSolverr/FlareSolverr?tab=readme-ov-file#installation",target:"_blank",rel:"noreferrer"})}})}),e.jsx(g,{edge:"end",checked:t.flareSolverrEnabled,onChange:s=>i("flareSolverrEnabled",s.target.checked)})]}),e.jsx(d,{settingName:a._({id:"PodnxK"}),dialogDescription:a._({id:"4lrq7s"}),value:t.flareSolverrUrl,handleChange:s=>i("flareSolverrUrl",s)}),e.jsx(_,{settingTitle:a._({id:"yzsb1/"}),settingValue:a._({id:"RRgNMe",values:{0:t.flareSolverrTimeout}}),dialogDescription:a._({id:"xvwlRN"}),value:t.flareSolverrTimeout,defaultValue:60,minValue:20,maxValue:60*5,stepSize:1,showSlider:!0,valueUnit:a._({id:"ku//5b"}),handleUpdate:s=>i("flareSolverrTimeout",s)}),e.jsx(d,{settingName:a._({id:"Xbcbrg"}),value:t.flareSolverrSessionName,handleChange:s=>i("flareSolverrSessionName",s)}),e.jsx(_,{settingTitle:a._({id:"/GGbha"}),settingValue:a._({id:"PlVus2",values:{0:t.flareSolverrSessionTtl}}),dialogDescription:a._({id:"RL110l"}),value:t.flareSolverrSessionTtl,defaultValue:15,minValue:1,maxValue:60,stepSize:1,showSlider:!0,valueUnit:a._({id:"6UYTy8"}),handleUpdate:s=>i("flareSolverrSessionTtl",s)}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"WRRVr6"}),secondary:a._({id:"6RZNqg"})}),e.jsx(g,{edge:"end",checked:t.flareSolverrAsResponseFallback,onChange:s=>i("flareSolverrAsResponseFallback",s.target.checked)})]})]}),e.jsxs(c,{subheader:e.jsx(u,{component:"div",id:"server-settings-opds",children:a._({id:"1CgbvA"})}),children:[e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"PvaA4n"}),secondary:a._({id:"OpJaQ1"})}),e.jsx(g,{edge:"end",checked:t.opdsUseBinaryFileSizes,onChange:s=>i("opdsUseBinaryFileSizes",s.target.checked)})]}),e.jsx(_,{settingTitle:a._({id:"rYHzDr"}),settingValue:t.opdsItemsPerPage.toString(),dialogDescription:a._({id:"6bbe+O"}),value:t.opdsItemsPerPage,defaultValue:50,minValue:10,maxValue:5e3,stepSize:10,showSlider:!0,valueUnit:a._({id:"/uUlFU"}),handleUpdate:s=>i("opdsItemsPerPage",s)}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"t/Uh/y"}),secondary:a._({id:"Ksbu3S"})}),e.jsx(g,{edge:"end",checked:t.opdsEnablePageReadProgress,onChange:s=>i("opdsEnablePageReadProgress",s.target.checked)})]}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"21fX0f"}),secondary:a._({id:"gAg0jz"})}),e.jsx(g,{edge:"end",checked:t.opdsMarkAsReadOnDownload,onChange:s=>i("opdsMarkAsReadOnDownload",s.target.checked)})]}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"OGJIxn"}),secondary:a._({id:"lBguvO"})}),e.jsx(g,{edge:"end",checked:t.opdsShowOnlyUnreadChapters,onChange:s=>i("opdsShowOnlyUnreadChapters",s.target.checked)})]}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"MKIIWQ"}),secondary:a._({id:"rnLFHn"})}),e.jsx(g,{edge:"end",checked:t.opdsShowOnlyDownloadedChapters,onChange:s=>i("opdsShowOnlyDownloadedChapters",s.target.checked)})]}),e.jsx(S,{settingName:a._({id:"O+jeEW"}),dialogDescription:a._({id:"KJBWIH"}),value:t.opdsChapterSortOrder,values:[[X.Asc,{text:a._({id:"nYD/Cq"})}],[X.Desc,{text:a._({id:"Cko536"})}]],handleChange:s=>i("opdsChapterSortOrder",s)}),e.jsx(S,{settingName:a._({id:"X82C+j"}),dialogDescription:a._({id:"vRvxLg"}),value:t.opdsCbzMimetype,values:[[K.Legacy,{text:a._({id:"Sn1jT8"})}],[K.Modern,{text:a._({id:"IU7sBy"})}],[K.Compatible,{text:a._({id:"33v1rN"})}]],handleChange:s=>i("opdsCbzMimetype",s)})]}),e.jsx(xe,{settings:t,serverAddress:b.serverAddress,username:b.username,isLoggedIn:b.isLoggedIn,updateSetting:i}),e.jsxs(c,{subheader:e.jsx(u,{component:"div",id:"server-settings-database",children:a._({id:"JY5Oyv"})}),children:[e.jsx(S,{settingName:a._({id:"+zy2Nq"}),value:t.databaseType,values:[[I.H2,{text:a._({id:"Vk0+bV"})}],[I.Postgresql,{text:a._({id:"YJ8OX/"})}]],handleChange:s=>i("databaseType",s)}),e.jsx(d,{settingName:a._({id:"2i9vSp"}),handleChange:s=>i("databaseUrl",s),value:t.databaseUrl,placeholder:"postgresql://localhost:5432/suwayomi",disabled:p}),e.jsx(d,{settingName:a._({id:"7sNhEz"}),value:t.databaseUsername,handleChange:s=>i("databaseUsername",s),disabled:p}),e.jsx(d,{settingName:a._({id:"8ZsakT"}),value:t.databasePassword,handleChange:s=>i("databasePassword",s),disabled:p,isPassword:!0}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"Fq7Eez"}),secondary:a._({id:"x/ksEp"})}),e.jsx(g,{edge:"end",checked:t.useHikariConnectionPool,onChange:s=>i("useHikariConnectionPool",s.target.checked)})]})]}),e.jsxs(c,{subheader:e.jsx(u,{component:"div",id:"server-settings-misc",children:a._({id:"7gjU/0"})}),children:[e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"/CEXTz"})}),e.jsx(g,{edge:"end",checked:t.debugLogsEnabled,onChange:s=>i("debugLogsEnabled",s.target.checked)})]}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"jdKrxF"}),secondary:a._({id:"agLJTe"})}),e.jsx(g,{edge:"end",checked:t.systemTrayEnabled,onChange:s=>i("systemTrayEnabled",s.target.checked)})]}),e.jsx(_,{settingTitle:a._({id:"gy0Zlr"}),settingValue:me(t.maxLogFiles),value:t.maxLogFiles,valueUnit:a._({id:"H7OUPr"}),handleUpdate:s=>i("maxLogFiles",s)}),e.jsx(d,{settingName:a._({id:"sEmi/d"}),value:t.maxLogFileSize,dialogDescription:a._({id:"RGlpP+"}),validate:s=>!!s.match(/^[0-9]+(|kb|KB|mb|MB|gb|GB)$/g),handleChange:s=>i("maxLogFileSize",s)}),e.jsx(d,{settingName:a._({id:"P73ZCN"}),value:t.maxLogFolderSize,dialogDescription:a._({id:"RGlpP+"}),validate:s=>!!s.match(/^[0-9]+(|kb|KB|mb|MB|gb|GB)$/g),handleChange:s=>i("maxLogFolderSize",s)})]})]})};export{Pe as ServerSettings};
