import{c as Z,j as e,u as y,A as O,L as G,r as T,S as K,T as v,l as Se,B as R,C as N,I as M,m as I,g as w,a as ee,b as l,D as Ae,d as ke,e as te,f as P,t as H,h as pe,i as Ne,k as Me,n as Ue,o as Oe,p as Re,q as Pe,s as Be,v as je,w as me,x as De,y as Ge,z as Fe,E as He,F as he,G as ge,H as ze,J as Ve}from"./index-G46Fdggo.js";import{u as Ce,S as be,A as Ke}from"./AppbarSearch-CeSESK0c.js";import{P as qe}from"./PushPin-CqJbxUkU.js";import{P as We}from"./PushPinOutlined-BO35WQlC.js";import{SourceContentType as xe}from"./SourceMangas-BHpgBJx-.js";import{M as Q}from"./MUI.util-CYBuX_Wz.js";import{u as $e,S as k,c as Xe}from"./Sources-DUNUbIYd.js";import{L as se}from"./ListCardAvatar-BoCoTQrN.js";import{L as ne}from"./ListCardContent-Pa215Vat.js";import{C as oe}from"./Card-DanTl0nA.js";import{C as re}from"./CardActionArea-OGaoKLza.js";import{E as V}from"./EmptyViewAbsoluteCentered-CovG7djH.js";import{i as Ye,t as q,g as z,I as Je,a as Qe,E as ve,b as D,c as Ze,u as et,d as tt,e as st,f as nt,h as ot,j as rt,k as at}from"./Extensions.utils-DBFrFiTZ.js";import{u as Ee}from"./useAppAction-BcY93dSk.js";import{S as Le,a as Te}from"./StyledGroupHeader-D1JrHzfq.js";import{V as ye}from"./Virtuoso.util-CLVBVGro.js";import{S as ae}from"./StyledGroupItemWrapper-BUEL8mdk.js";import{S as it}from"./SourceLanguageSelect-Cb0q9UoU.js";import{f as ct}from"./file-selector-DlHkLoY8.js";import{A as lt}from"./Add-BPDinqx7.js";import{F as ut}from"./FilterList-CCu3WPMo.js";import{j as dt}from"./index-As6JimRO.js";import{S as pt}from"./Switch-BtnmcNda.js";import{u as fe}from"./use-window-event-nCDn_F7T.js";import{T as Y,a as J}from"./Tabs-CvoNXx--.js";import{T as mt}from"./TabsWrapper-CcCaYEoL.js";import{T as ht}from"./TabsMenu-CN1ObQxk.js";import{A as gt,a as xt}from"./SortRadioInput-BwNO4vpf.js";import{C as ft}from"./Chip-ZKQNBQUj.js";import{u as St}from"./useAppTitle-Datch0bI.js";import"./ChaptersDownloadActionMenuItems-B_MKyCjW.js";import"./Trackers-COtG7wmP.js";import"./Avatar-DUmUcl_c.js";import"./TextField-BRgOKGna.js";import"./useFormControl-CT6bsidr.js";import"./formControlState-Dq1zat_P.js";import"./InputAdornment-BS64HwSB.js";import"./CheckCircle-D3a999rX.js";import"./Metadata-DOmjq81n.js";import"./Link-Ctw05YYq.js";import"./useManageMangaLibraryState-CXKmNnsM.js";import"./ThreeStateCheckboxInput-BjQtgj2p.js";import"./Checkbox-BfEM26Pl.js";import"./SwitchBase-qIEchQvh.js";import"./CheckboxInput-CR2fS89x.js";import"./FormGroup-BwKYwlqA.js";import"./ListPreference-BhYC9fD9.js";import"./NumberSetting-CnP08o-H.js";import"./Slider-kxcpEXb5.js";import"./useMobilePicker-oWkqoc7c.js";import"./SelectSetting-ChFryBwm.js";import"./Select-CBhhpE2v.js";import"./Favorite-CugIEZVi.js";import"./GridLayouts-DzaH_VWG.js";import"./Delete-Dc95J15p.js";import"./ExpandMore-DD9uwbgc.js";import"./useDebounce-Dt5mnRVN.js";import"./StyledFab-C5yo8GOr.js";import"./BaseMangaGrid-D_c4RRzC.js";import"./MangaGrid-BKLhIzrj.js";import"./Download-DJLffM7p.js";import"./Sync-CFemNj3K.js";import"./use-merged-ref-DGZZwTVB.js";import"./PlayArrow-DMexcOWT.js";import"./useAppTitleAndAction-khKl4iUr.js";import"./ListItemAvatar-CuBE0f-t.js";const jt=Z(e.jsx("path",{d:"M19.3 16.9c.4-.7.7-1.5.7-2.4 0-2.5-2-4.5-4.5-4.5S11 12 11 14.5s2 4.5 4.5 4.5c.9 0 1.7-.3 2.4-.7l3.2 3.2 1.4-1.4zm-3.8.1c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5M12 20v2C6.48 22 2 17.52 2 12S6.48 2 12 2c4.84 0 8.87 3.44 9.8 8h-2.07c-.64-2.46-2.4-4.47-4.73-5.41V5c0 1.1-.9 2-2 2h-2v2c0 .55-.45 1-1 1H8v2h2v3H9l-4.79-4.79C4.08 10.79 4 11.38 4 12c0 4.41 3.59 8 8 8"})),Ct=u=>{const{t}=y(),{source:n,showSourceRepo:p,showLanguage:c}=u,{id:s,name:o,lang:r,iconUrl:m,supportsLatest:j,isNsfw:i,extension:{repo:g}}=n,{isPinned:d}=$e(n),x=k.isLocalSource(n)?t("source.local_source.title"):o,f=Xe(n,b=>I(t("global.error.label.failed_to_save_changes"),"error",w(b)));return e.jsx(oe,{children:e.jsx(re,{component:G,to:O.sources.childRoutes.browse.path(s),state:{contentType:xe.POPULAR,clearCache:!0},children:e.jsxs(ne,{children:[e.jsx(se,{iconUrl:T.getValidImgUrlFor(m),alt:x}),e.jsxs(K,{sx:{justifyContent:"center",flexGrow:1,flexShrink:1,wordBreak:"break-word"},children:[e.jsx(v,{variant:"h6",component:"h3",children:x}),e.jsxs(v,{variant:"caption",children:[c&&Se(r),i&&e.jsx(v,{variant:"caption",color:"error",children:" 18+"})]}),p&&e.jsx(v,{variant:"caption",children:g})]}),j&&e.jsx(R,{...Q.preventRippleProp(),variant:"outlined",component:G,to:O.sources.childRoutes.browse.path(s),state:{contentType:xe.LATEST,clearCache:!0},children:t("global.button.latest")}),e.jsx(N,{title:t(d?"source.pin.remove":"source.pin.add"),children:e.jsx(M,{...Q.preventRippleProp(),onClick:b=>{b.preventDefault(),f("isPinned",!d)},color:d?"primary":"inherit",children:d?e.jsx(qe,{}):e.jsx(We,{})})})]})})})};function bt({tabsMenuHeight:u}){const{t}=y(),{languages:n,setLanguages:p}=k.useLanguages(),{settings:{showNsfw:c,lastUsedSourceId:s}}=ee(),{data:o,loading:r,error:m,refetch:j}=T.useGetSourceList({notifyOnNetworkStatusChange:!0}),i=o==null?void 0:o.sources.nodes,g=l.useMemo(()=>k.filter(i!=null?i:[],{showNsfw:c,languages:n,keepLocalSource:!0,enabled:!0}),[i,n]),d=l.useMemo(()=>{const h=k.getLastUsedSource(s,g),S=Object.entries(k.groupByLanguage(g));return h?[[Ae.LAST_USED_SOURCE,[h]],...S]:S},[g]),x=l.useMemo(()=>k.getLanguages(i!=null?i:[]),[i]),f=l.useMemo(()=>k.areFromMultipleRepos(g),[g]),b=l.useMemo(()=>d.map(([,h])=>h).flat(1),[d]),L=l.useMemo(()=>d.map(h=>h[1].length),[d]),_=ye.useCreateGroupedComputeItemKey(L,l.useCallback(h=>d[h][0],[d]),l.useCallback((h,S)=>"".concat(d[S][0],"_").concat(b[h].id),[b])),U=ke();return Ee(e.jsxs(e.Fragment,{children:[e.jsx(N,{title:t("search.title.global_search"),children:e.jsx(M,{onClick:()=>U(O.sources.childRoutes.searchAll.path()),color:"inherit",children:e.jsx(jt,{})})}),e.jsx(it,{selectedLanguages:n,setSelectedLanguages:p,languages:x,sources:i!=null?i:[]})]}),[t,n,x,i]),r?e.jsx(te,{}):m?e.jsx(V,{message:t("global.error.label.failed_to_load_data"),messageExtra:w(m),retry:()=>j().catch(P())}):(i==null?void 0:i.length)===0?e.jsx(V,{message:t("source.error.label.no_sources_found")}):e.jsx(Le,{persistKey:"sources",heightToSubtract:u,overscan:window.innerHeight*.5,groupCounts:L,computeItemKey:_,groupContent:h=>{const[S]=d[h];return e.jsx(Te,{isFirstItem:!h,children:e.jsx(v,{variant:"h5",component:"h2",children:q(S)})})},itemContent:(h,S)=>{const B=d[S][0],C=b[h];return e.jsx(ae,{children:e.jsx(Ct,{source:C,showSourceRepo:f,showLanguage:Ye(B)})})}})}function vt(u){const{t}=y(),{selectedLanguages:n,setSelectedLanguages:p,languages:c}=u,[s,o]=l.useState(H(n)),[r,m]=l.useState(!1),j=l.useMemo(()=>H([...s.toSorted(pe),...c.toSorted(pe)]),[c,s]),i=()=>{m(!1),o(H(n))},g=()=>{m(!1),p(H(s))},d=(x,f)=>{o(f?[...s,x]:s.toSpliced(s.indexOf(x),1))};return e.jsxs(e.Fragment,{children:[e.jsx(N,{title:t("settings.title"),children:e.jsx(M,{onClick:()=>m(!0),"aria-label":"display more actions",edge:"end",color:"inherit",children:e.jsx(ut,{})})}),e.jsxs(Ne,{fullWidth:!0,maxWidth:"xs",open:r,onClose:i,children:[e.jsx(Me,{children:t("global.language.title.enabled_languages")}),e.jsx(Ue,{dividers:!0,sx:{padding:0},children:e.jsx(dt,{style:{height:j.length*54,minHeight:"25vh",maxHeight:"50vh"},data:j,increaseViewportBy:400,computeItemKey:x=>j[x],itemContent:(x,f)=>e.jsxs(Oe,{children:[e.jsx(Re,{primary:q(f)}),e.jsx(pt,{checked:s.includes(f),onChange:b=>d(f,b.target.checked)})]})})}),e.jsxs(Pe,{children:[e.jsx(R,{autoFocus:!0,onClick:i,color:"primary",children:t("global.button.cancel")}),e.jsx(R,{onClick:g,color:"primary",children:t("global.button.ok")})]})]})]})}const Et=({disabled:u,children:t,...n})=>u?t:e.jsx(re,{component:G,...n,children:t});function Lt(u){const{t}=y(),{extension:{name:n,lang:p,versionName:c,isInstalled:s,hasUpdate:o,isObsolete:r,pkgName:m,iconUrl:j,isNsfw:i,repo:g},handleUpdate:d,showSourceRepo:x,forcedState:f}=u,[b,L]=l.useState(z(s,r,o)),_=f!=null?f:b;l.useEffect(()=>{L(z(s,r,o))},[z(s,r,o)]);const U=async S=>{const B=tt[S],C=Ze[S];try{L(C),await et(m,r,S),L(B),d()}catch(W){L(z(s,r,o))}};function h(){switch(_){case D.INSTALL:case D.UPDATE:case D.UNINSTALL:U(_).catch(P());break;case ve.OBSOLETE:U(D.UNINSTALL).catch(P());break}}return e.jsx(oe,{children:e.jsx(Et,{disabled:!s,to:O.extension.childRoutes.info.path(m),children:e.jsxs(ne,{children:[e.jsx(se,{iconUrl:T.getValidImgUrlFor(j),alt:n}),e.jsxs(K,{sx:{justifyContent:"center",flexGrow:1,flexShrink:1,wordBreak:"break-word"},children:[e.jsx(v,{variant:"h6",component:"h3",children:n}),e.jsxs(v,{variant:"caption",children:[s?"".concat(Se(p)," "):"",c,i&&e.jsx(v,{variant:"caption",color:"error",children:" 18+"})]}),x&&e.jsx(v,{variant:"caption",children:g})]}),s&&e.jsx(N,{title:t("settings.title"),children:e.jsx(M,{color:"inherit",...Q.preventRippleProp(),children:e.jsx(Be,{})})}),e.jsx(R,{variant:"outlined",sx:{color:_===Qe.OBSOLETE?"red":"inherit",flexShrink:0},onClick:S=>{S.preventDefault(),h()},children:t(Je[_])})]})})})}const Tt=0,yt=1,_t=({groupName:u,isFirstItem:t,groupExtensionIds:n,isUpdateGroup:p,updatingExtensionIds:c,setUpdatingExtensionIds:s,handleExtensionUpdate:o})=>{const{t:r}=y();return e.jsxs(Te,{isFirstItem:t,sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",pr:1},children:[e.jsx(v,{variant:"h5",component:"h2",children:q(u)}),p&&e.jsx(R,{disabled:!!c.length,variant:"contained",onClick:()=>{s(n),T.updateExtensions(n,{update:!0}).response.then(()=>o()).catch(m=>I(r(at[D.UPDATE],{count:n.length}),"error",w(m))).finally(()=>s([]))},children:r("extension.action.label.update_all")})]},u)};function It({tabsMenuHeight:u}){var ue,de;const{t}=y(),{data:n,loading:p,error:c,refetch:s}=T.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[o,{data:r,loading:m,error:j}]=T.useExtensionListFetch(),{settings:{extensionLanguages:i,showNsfw:g}}=ee(),d=je(a=>I(t("global.error.label.failed_to_save_changes"),"error",w(a))),[x]=Ce("query",be),[f,b]=l.useState([]),[L,_]=l.useState({}),U=p||m,h=c!=null?c:j,S=!!(n!=null&&n.settings.extensionRepos.length),B=((ue=n==null?void 0:n.settings.extensionRepos.length)!=null?ue:0)>1,C=(de=r==null?void 0:r.fetchExtensions)==null?void 0:de.extensions,W=l.useMemo(()=>st(C!=null?C:[]),[C]),ie=l.useMemo(()=>nt(C!=null?C:[],{selectedLanguages:i,showNsfw:g,query:x}),[C,i,g,x]),A=l.useMemo(()=>ot(ie),[ie]),ce=l.useMemo(()=>A.map(a=>a[yt].length),[A]),$=l.useMemo(()=>A.map(([,a])=>a).flat(1),[A]),_e=ye.useCreateGroupedComputeItemKey(ce,l.useCallback(a=>A[a][Tt],[A]),l.useCallback(a=>$[a].pkgName,[$])),X=l.useCallback(()=>_({}),[]),le=a=>{if(!a.name.toLowerCase().endsWith("apk")){I(t("global.error.label.invalid_file_type"),"error");return}I(t("extension.label.installing_file"),"info"),T.installExternalExtension(a).response.then(()=>{X(),I(t("extension.label.installed_successfully"),"success")}).catch(E=>I(t("extension.label.installation_failed"),"error",w(E)))};return l.useEffect(()=>{o()},[L]),Ee(e.jsxs(e.Fragment,{children:[e.jsx(Ke,{}),e.jsx(N,{title:t("extension.action.label.install_external"),children:e.jsx(M,{onClick:()=>{const a=document.createElement("input");a.style.display="none",a.type="file",a.onchange=()=>{var F;const E=(F=a.files)==null?void 0:F[0];E&&le(E)},document.documentElement.appendChild(a),a.click(),document.documentElement.removeChild(a)},color:"inherit",children:e.jsx(lt,{})})}),e.jsx(vt,{selectedLanguages:i,setSelectedLanguages:a=>d("extensionLanguages",a),languages:W})]}),[t,i,W]),fe("drop",async a=>{a.preventDefault();const E=await ct(a);le(E[0])}),fe("dragover",a=>{a.preventDefault()}),U?e.jsx(te,{}):h?e.jsx(V,{message:t("global.error.label.failed_to_load_data"),messageExtra:w(h),retry:()=>{c&&s().catch(P()),j&&o().catch(P())}}):!(C!=null&&C.length)&&!S?e.jsxs(K,{sx:{alignItems:"center",justifyContent:"center",rowGap:"10px",paddingTop:"20px"},children:[e.jsx(v,{children:t("extension.label.add_repository_info")}),e.jsx(R,{component:G,variant:"contained",to:O.settings.childRoutes.browse.path,children:t("settings.title")})]}):e.jsx(Le,{persistKey:"extensions",heightToSubtract:u,overscan:window.innerHeight*.5,groupCounts:ce,groupContent:a=>{const[E,F]=A[a],Ie=E===rt.UPDATE_PENDING;return e.jsx(_t,{groupName:E,isFirstItem:a===0,groupExtensionIds:F.map(we=>we.pkgName),isUpdateGroup:Ie,updatingExtensionIds:f,setUpdatingExtensionIds:b,handleExtensionUpdate:X})},computeItemKey:_e,itemContent:a=>{const E=$[a];return e.jsx(ae,{children:e.jsx(Lt,{extension:E,handleUpdate:X,showSourceRepo:B,forcedState:f.includes(E.pkgName)?ve.UPDATING:void 0})})}})}const wt=Z(e.jsx("path",{d:"M14.94 4.66h-4.72l2.36-2.36zm-4.69 14.71h4.66l-2.33 2.33zM6.1 6.27 1.6 17.73h1.84l.92-2.45h5.11l.92 2.45h1.84L7.74 6.27zm-1.13 7.37 1.94-5.18 1.94 5.18zm10.76 2.5h6.12v1.59h-8.53v-1.29l5.92-8.56h-5.88v-1.6h8.3v1.26z"})),At=Z(e.jsx("path",{d:"M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4zm-6 4h-4v-4h4z"})),kt=({id:u,name:t,lang:n,iconUrl:p,mangaCount:c})=>{const{t:s}=y(),r=Number(u)===0?s("source.local_source.title"):t;return e.jsx(oe,{children:e.jsx(re,{component:G,to:O.migrate.path(u),children:e.jsxs(ne,{sx:{justifyContent:"space-between"},children:[e.jsxs(me,{sx:{display:"flex",gap:1},children:[e.jsx(se,{iconUrl:T.getValidImgUrlFor(p),alt:r}),e.jsxs(me,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(v,{variant:"h6",component:"h3",children:r}),e.jsx(v,{variant:"caption",sx:{display:"block"},children:q(n)})]})]}),e.jsx(ft,{sx:{borderRadius:1},size:"small",label:c})]})})})},Nt=(u,{sortBy:t,sortOrder:n})=>{if(!u)return[];const p={};u.forEach(({sourceId:s,source:o})=>{var m;const r=(m=p[s])!=null?m:{id:s,name:s,lang:"unknown",iconUrl:null,mangaCount:0,...o};p[s]={...r,mangaCount:r.mangaCount+1}});const c=Object.values(p).toSorted((s,o)=>{switch(t){case he.SOURCE_NAME:return s.name.localeCompare(o.name);case he.MANGA_COUNT:return s.mangaCount-o.mangaCount;default:throw new Error('Unexpected "sortBy" "'.concat(t,'"'))}});switch(n){case ge.ASC:return c;case ge.DESC:return c.toReversed();default:throw new Error('Unexpected "sortOrder" "'.concat(n,'"'))}},Mt=({tabsMenuHeight:u})=>{const{t}=y(),{appBarHeight:n}=De(),{settings:{migrateSortSettings:p}}=ee(),c=je(d=>I(t("global.error.label.failed_to_save_changes"),"error",w(d))),{sortBy:s,sortOrder:o}=p,{data:r,loading:m,error:j,refetch:i}=T.useGetMigratableSources({notifyOnNetworkStatusChange:!0}),g=l.useMemo(()=>Nt(r==null?void 0:r.mangas.nodes,p),[r==null?void 0:r.mangas.nodes,p]);return m?e.jsx(te,{}):j?e.jsx(V,{message:t("global.error.label.failed_to_load_data"),messageExtra:w(j),retry:()=>i().catch(P())}):e.jsxs(e.Fragment,{children:[e.jsxs(K,{sx:{position:"sticky",top:"".concat(n+u,"px"),flexDirection:"row",justifyContent:"end",alignItems:"center",gap:1,p:1,backgroundColor:"background.default",zIndex:1},children:[e.jsx(N,{title:t(Ge[s]),children:e.jsx(M,{color:"inherit",onClick:()=>c("migrateSortSettings",{sortBy:(s+1)%2,sortOrder:o}),children:s?e.jsx(At,{}):e.jsx(wt,{})})}),e.jsx(N,{title:t(Fe[o]),children:e.jsx(M,{color:"inherit",onClick:()=>c("migrateSortSettings",{sortBy:s,sortOrder:(o+1)%2}),children:o?e.jsx(gt,{}):e.jsx(xt,{})})})]}),e.jsx(He,{sx:{p:0},children:g.map(d=>e.jsx(ae,{children:e.jsx(kt,{...d})},d.id))})]})};function Ws(){const{t:u}=y();St(u("global.label.browse"));const t=l.useRef(null),[n,p]=l.useState(0);ze(t,l.useCallback(()=>p(t.current.offsetHeight),[t.current]));const[c,s]=Ce("tab",be,{}),o=c!=null?c:"source";return c||s(o,"replaceIn"),e.jsxs(mt,{children:[e.jsxs(ht,{ref:t,sx:{zIndex:Ve},variant:"fullWidth",value:o,onChange:(r,m)=>s(m,"replaceIn"),children:[e.jsx(Y,{value:"source",sx:{textTransform:"none"},label:u("source.title_one")}),e.jsx(Y,{value:"extensions",sx:{textTransform:"none"},label:u("extension.title_other")}),e.jsx(Y,{value:"migrate",sx:{textTransform:"none"},label:u("migrate.title")})]}),e.jsx(J,{index:"source",currentIndex:o,children:e.jsx(bt,{tabsMenuHeight:n})}),e.jsx(J,{index:"extensions",currentIndex:o,children:e.jsx(It,{tabsMenuHeight:n})}),e.jsx(J,{index:"migrate",currentIndex:o,children:e.jsx(Mt,{tabsMenuHeight:n})})]})}export{Ws as Browse};
