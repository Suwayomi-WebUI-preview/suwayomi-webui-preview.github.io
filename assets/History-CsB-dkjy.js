import{g as n,j as e,a1 as g,A as j,L as I,B as w,bl as R,aN as E,u as T,d as G,r as L,k as M,l as P,T as S,i as k}from"./index-YAtlvmGf.js";import{E as h}from"./EmptyViewAbsoluteCentered-6ui_Uq2m.js";import{V as d,a as v,S as A,b as O}from"./Virtuoso.util-BOaA_mKU.js";import{D as U}from"./DownloadStateIndicator-BlPLoN2a.js";import{C as B,a as N,b as F}from"./ChapterDownloadRetryButton-gzA_Dm04.js";import{C as _}from"./ChapterCardMetadata-BBeg6W7B.js";import{C as V}from"./Card-BU1dYrjx.js";import{C as D}from"./CardActionArea-C9R1S_-n.js";import{C as K}from"./CardContent-Ci5UNtd0.js";import"./MUI.util-CRrI--AY.js";import"./Avatar-BjP32HBi.js";import"./Download-pWaRfNBn.js";const $=n.memo(({chapter:t})=>{const{manga:s}=t;return e.jsx(V,{children:e.jsx(D,{component:I,to:j.reader.path(t.manga.id,t.sourceOrder),state:g.getReaderOpenChapterLocationState(t),sx:{color:a=>a.palette.text[t.isRead?"disabled":"primary"]},children:e.jsxs(K,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5},children:[e.jsxs(w,{sx:{display:"flex",flexGrow:1},children:[e.jsx(B,{mangaId:s.id,mangaTitle:s.title,thumbnailUrl:s.thumbnailUrl,thumbnailUrlLastFetched:s.thumbnailUrlLastFetched}),e.jsx(_,{title:s.title,secondaryText:"".concat(t.name," â€” ").concat(R.format(E(Number(t.lastReadAt)).valueOf()))})]}),e.jsx(U,{chapterId:t.id}),e.jsx(N,{chapterId:t.id}),e.jsx(F,{chapterId:t.id,isDownloaded:t.isDownloaded})]})})})}),re=()=>{var c;const{t}=T(),{setTitle:s}=G(),{data:a,loading:l,error:m,fetchMore:C,refetch:x}=L.useGetRecentlyReadChapters(void 0,{fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),u=!!(a!=null&&a.chapters.pageInfo.hasNextPage),f=a==null?void 0:a.chapters.pageInfo.endCursor,o=(c=a==null?void 0:a.chapters.nodes)!=null?c:[],i=n.useMemo(()=>Object.entries(g.groupByDate(o,"lastReadAt")),[o]),p=n.useMemo(()=>i.map(r=>r[d.ITEMS].length),[i]),y=d.useCreateGroupedComputeItemKey(p,n.useCallback(r=>i[r][d.GROUP],[i]),n.useCallback(r=>o[r].id,[o]));n.useLayoutEffect(()=>(s(t("history.title")),()=>{s("")}),[t]);const b=n.useCallback(()=>{u&&C({variables:{offset:o.length}})},[u,f]);return m?e.jsx(h,{message:t("global.error.label.failed_to_load_data"),messageExtra:M(m),retry:()=>x().catch(P())}):!l&&o.length===0?e.jsx(h,{message:t("history.error.label.no_history_available")}):e.jsx(v,{style:{height:"undefined"},components:{Footer:()=>l?e.jsx(k,{usePadding:!0}):null},overscan:window.innerHeight*.5,endReached:b,groupCounts:p,groupContent:r=>e.jsx(O,{isFirstItem:r===0,children:e.jsx(S,{variant:"h5",component:"h2",children:i[r][d.GROUP]})}),computeItemKey:y,itemContent:r=>e.jsx(A,{children:e.jsx($,{chapter:o[r]})})})};export{re as History};
