import{r as z,i as T,j as e,u as q,a as n,c as f,N as V,f as m,I as p,g as B,E as P,h as S,B as v,L as N,S as F,T as y,m as R}from"./index-aRdpybDP.js";import{d as G}from"./Delete-O6q18e_o.js";import{D as W,S as J,P as K,d as U}from"./StrictModeDroppable-BDh5Zxus.js";import{d as X}from"./PlayArrow-DMfA4sks.js";import{V as Y,C as Z}from"./index-DsS6TrSK.js";import{D as ee}from"./DownloadStateIndicator-DYYQ3pY1.js";import{C as re,a as ae}from"./CardContent-D1Dp0n3h.js";var j={},te=T;Object.defineProperty(j,"__esModule",{value:!0});var $=j.default=void 0,oe=te(z()),se=e;$=j.default=(0,oe.default)((0,se.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause");var w={},ne=T;Object.defineProperty(w,"__esModule",{value:!0});var k=w.default=void 0,le=ne(z()),ie=e;k=w.default=(0,le.default)((0,ie.jsx)("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3zM14 5h-3l-1-1H6L5 5H2v2h12z"}),"DeleteSweep");const de=({children:a,...s})=>e.jsx(v,{...s,style:{height:s["data-known-size"]||void 0},children:a}),I=({provided:a,item:s,isDragging:h,handleDelete:i})=>{const{t:g}=q();return e.jsx(v,{...a.draggableProps,...a.dragHandleProps,ref:a.innerRef,sx:{p:1,pb:0},children:e.jsx(re,{sx:{backgroundColor:h?"custom.light":void 0},children:e.jsx(Z,{component:N,to:"/manga/".concat(s.manga.id),children:e.jsxs(ae,{sx:{display:"flex",alignItems:"center",p:1.5},children:[e.jsx(p,{sx:{pointerEvents:"none"},children:e.jsx(U,{})}),e.jsxs(F,{sx:{flex:1,ml:1},direction:"column",children:[e.jsx(y,{variant:"h6",component:"h3",children:s.manga.title}),e.jsx(y,{variant:"caption",display:"block",children:s.chapter.name})]}),e.jsx(ee,{download:s}),e.jsx(m,{title:g("chapter.action.download.delete.label.action"),children:e.jsx(p,{onClick:d=>{d.preventDefault(),d.stopPropagation(),i(s.chapter)},size:"large",children:e.jsx(G,{})})})]})})})})},me=()=>{var C,E;const{t:a}=q(),[s,{reset:h}]=n.useReorderChapterInDownloadQueue(),{data:i,loading:g,error:d,refetch:O}=n.useGetDownloadStatus({notifyOnNetworkStatusChange:!0}),l=i==null?void 0:i.downloadStatus,u=(C=l==null?void 0:l.queue)!=null?C:[],c=(E=l==null?void 0:l.state)!=null?E:"STARTED",x=!u.length,{setTitle:D,setAction:b}=f.useContext(V),H=async()=>{try{await n.clearDownloads().response}catch(r){R(a("download.queue.error.label.failed_delete_all"),"error")}},M=()=>{c==="STOPPED"?n.startDownloads():n.stopDownloads()};f.useEffect(()=>(D(a("download.queue.title")),b(e.jsxs(e.Fragment,{children:[e.jsx(m,{title:a("download.queue.label.delete_all"),children:e.jsx(p,{onClick:H,size:"large",children:e.jsx(k,{})})}),e.jsx(m,{title:a(c==="STOPPED"?"global.button.start":"global.button.stop"),children:e.jsx(p,{onClick:M,size:"large",disabled:x,children:c==="STOPPED"?e.jsx(X,{}):e.jsx($,{})})})]})),()=>{D(""),b(null)}),[a,c,x]),f.useEffect(()=>{const r=t=>{(t.message==="ResizeObserver loop completed with undelivered notifications."||t.message==="ResizeObserver loop limit exceeded")&&t.stopImmediatePropagation()};return window.addEventListener("error",r),()=>window.removeEventListener("error",r)},[]);const L=(r,t,o)=>{t!==o&&s({variables:{input:{chapterId:r[t].chapter.id,to:o}}}).catch(()=>{h()})},A=r=>{r.destination&&L(u,r.source.index,r.destination.index)},_=async r=>{const t=c==="STARTED";try{t&&await n.stopDownloads().response,await Promise.all([n.removeChapterFromDownloadQueue(r.id).response,n.deleteDownloadedChapter(r.id).response])}catch(o){R(a("download.queue.error.label.failed_to_remove"),"error")}t&&n.startDownloads().response.catch(S())};return g?e.jsx(B,{}):d?e.jsx(P,{message:a("global.error.label.failed_to_load_data"),messageExtra:d.message,retry:()=>O().catch(S())}):x?e.jsx(P,{message:a("download.queue.label.no_downloads")}):e.jsx(W,{onDragEnd:A,children:e.jsx(J,{droppableId:"droppable",mode:"virtual",renderClone:(r,t,o)=>e.jsx(I,{provided:r,item:u[o.source.index],isDragging:t.isDragging,handleDelete:_}),children:r=>e.jsx(v,{ref:r.innerRef,children:e.jsx(Y,{useWindowScroll:!0,overscan:window.innerHeight*.5,data:u,components:{Item:de},itemContent:(t,o)=>e.jsx(K,{draggableId:"".concat(o.manga.id,"-").concat(o.chapter.sourceOrder),index:t,children:Q=>e.jsx(I,{provided:Q,item:o,isDragging:!1,handleDelete:_})},"".concat(o.manga.id,"-").concat(o.chapter.sourceOrder))})})})})};export{me as DownloadQueue};
