import{u as T,r as b,f as k,j as e,aQ as D,v as c,o as G,p as w,q as R,bw as E,w as O,B as N,av as x,m as j,g as S,M as y,s as _,bx as C,b8 as F,e as P,i as V,k as L,aN as M,A as U,F as B,by as q}from"./index-DxgalVhl.js";import{C as H,a as K}from"./CategoriesInclusionSetting-C8mUdi3Z.js";import{C as Q}from"./CheckboxInput-F06xFMuH.js";import{N as z}from"./NumberSetting-Ba59CIML.js";import{u as J,g as W}from"./usePersistedValue-8lnNW0zp.js";import{S as f}from"./Switch-B_TucHfS.js";import{L as I}from"./ListSubheader-DckEPLZ4.js";import{a as X}from"./Mangas-Csz19lxx.js";import{E as Y}from"./EmptyViewAbsoluteCentered-CiljhVsh.js";import{u as Z}from"./useAppTitle-CAGOJfWZ.js";import"./ThreeStateCheckboxInput-C9R8vv7d.js";import"./Checkbox-BJZDgsc1.js";import"./SwitchBase-lxmYe8oS.js";import"./Slider-CDAC3y_f.js";import"./Chapters-DPEj1IyB.js";import"./DateHelper-CQYhIsOb.js";import"./Asserts-GOIVsp8n.js";const $=a=>{const r=[];return a.excludeUnreadChapters&&r.push(x(E.excludeUnreadChapters)),a.excludeNotStarted&&r.push(x(E.excludeNotStarted)),a.excludeCompleted&&r.push(x(E.excludeCompleted)),!r.length&&r.push(x("global.label.none")),r.join(", ")},ee=a=>({excludeCompleted:a.excludeCompleted,excludeNotStarted:a.excludeNotStarted,excludeUnreadChapters:a.excludeUnreadChapters}),te=({serverSettings:a})=>{const{t:r}=T(),t=ee(a),[o]=b.useUpdateServerSettings(),[l,s]=k.useState(t!=null?t:{}),[d,i]=k.useState(!1),u=$(t),n=async()=>{const g=(t==null?void 0:t.excludeCompleted)!==l.excludeCompleted||t.excludeNotStarted!==l.excludeNotStarted||t.excludeUnreadChapters!==l.excludeUnreadChapters;if(i(!1),!!g)try{await o({variables:{input:{settings:l}}})}catch(m){j(r("global.error.label.failed_to_save_changes"),"error",S(m))}},h=()=>{s(t!=null?t:{}),i(!1)};return k.useEffect(()=>{t&&s(t)},[t==null?void 0:t.excludeCompleted,t==null?void 0:t.excludeNotStarted,t==null?void 0:t.excludeUnreadChapters]),e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:()=>i(!0),children:e.jsx(c,{primary:r("library.settings.global_update.entries.title"),secondary:u,onClick:()=>i(!0)})}),e.jsxs(G,{open:d,onClose:h,children:[e.jsx(w,{children:r("library.settings.global_update.entries.title")}),e.jsx(R,{children:e.jsx(H,{children:Object.entries(l).map(([g,m])=>e.jsx(Q,{label:r(E[g]),checked:m,onChange:(A,v)=>{s({...l,[g]:v})}},g))})}),e.jsxs(O,{children:[e.jsx(N,{onClick:h,color:"primary",children:r("global.button.cancel")}),e.jsx(N,{onClick:n,color:"primary",children:r("global.button.ok")})]})]})]})},ae=({globalUpdateInterval:a})=>{const{t:r}=T(),t=a,o=!!t,[l]=b.useUpdateServerSettings(),[s,d]=J("lastGlobalUpdateInterval",C.default,t,W),i=k.useCallback(n=>{d(n===0?s:n),l({variables:{input:{settings:{globalUpdateInterval:n}}}})},[s]),u=n=>{i(n?s:0)};return e.jsxs(y,{children:[e.jsxs(_,{children:[e.jsx(c,{primary:r("library.settings.global_update.auto_update.label.title")}),e.jsx(f,{edge:"end",checked:o,onChange:n=>u(n.target.checked)})]}),e.jsx(z,{settingTitle:r("library.settings.global_update.auto_update.interval.label.title"),settingValue:r("library.settings.global_update.auto_update.interval.label.value",{hours:s}),value:s,minValue:C.min,maxValue:C.max,defaultValue:C.default,showSlider:!0,valueUnit:r("global.time.hour_short"),handleUpdate:i,disabled:!o})]})},re=({serverSettings:a,categories:r})=>{const{t}=T(),{updateMangas:o}=a,[l]=b.useUpdateServerSettings(),s=async(d,i)=>{try{await l({variables:{input:{settings:{[d]:i}}}})}catch(u){j(t("global.error.label.failed_to_save_changes"),"error",S(u))}};return e.jsxs(y,{subheader:e.jsx(I,{component:"div",id:"global-update-settings",children:t("library.settings.global_update.title")}),children:[e.jsx(ae,{globalUpdateInterval:a.globalUpdateInterval}),e.jsx(te,{serverSettings:a}),e.jsx(K,{categories:r,includeField:"includeInUpdate",dialogText:t("library.settings.global_update.categories.label.info")}),e.jsxs(_,{children:[e.jsx(c,{primary:t("library.settings.global_update.metadata.label.title"),secondary:t("library.settings.global_update.metadata.label.description")}),e.jsx(f,{edge:"end",checked:o,onChange:d=>s("updateMangas",d.target.checked)})]})]})},se=async()=>{try{const a=await b.getMangas(q,{filter:{inLibrary:{equalTo:!1},categoryId:{isNull:!1}}},{fetchPolicy:"no-cache"}).response,r=X.getIds(a.data.mangas.nodes);r.length&&await b.updateMangasCategories(r,{clearCategories:!0}).response,j(x("library.settings.advanced.database.cleanup.label.success"),"success")}catch(a){j(x("library.settings.advanced.database.cleanup.label.error"),"error",S(a))}};function Se(){var g,m,A,v;const{t:a}=T();Z(a("library.title"));const r=b.useGetCategories(F),t=b.useGetServerSettings({notifyOnNetworkStatusChange:!0}),{settings:o,loading:l,request:{error:s,refetch:d}}=P(),i=B(p=>j(a("search.error.label.failed_to_save_settings"),"error",S(p))),u=((m=(g=r.data)==null?void 0:g.categories.nodes.length)!=null?m:1)-1;if(t.loading||l||r.loading)return e.jsx(V,{});const h=(v=(A=t.error)!=null?A:s)!=null?v:r.error;return h?e.jsx(Y,{message:a("global.error.label.failed_to_load_data"),messageExtra:S(h),retry:()=>{t.error&&(t==null||t.refetch().catch(L())),s&&d().catch(L()),r.error&&r.refetch().catch(L())}}):e.jsxs(y,{sx:{pt:0},children:[e.jsxs(y,{subheader:e.jsx(I,{component:"div",id:"library-category-settings",children:a("category.title.category_other")}),children:[e.jsx(M,{to:U.settings.childRoutes.categories.path,children:e.jsx(c,{primary:a("category.dialog.title.edit_category_other"),secondary:a("category.value",{count:u})})}),e.jsxs(_,{children:[e.jsx(c,{primary:a("library.settings.general.add_to_library.category_selection.label.title"),secondary:a("library.settings.general.add_to_library.category_selection.label.description")}),e.jsx(f,{edge:"end",checked:o.showAddToLibraryCategorySelectDialog,onChange:p=>i("showAddToLibraryCategorySelectDialog",p.target.checked)})]}),e.jsxs(_,{children:[e.jsx(c,{primary:a("library.settings.general.remove_from_library.remove_from_categories.label.title"),secondary:a("library.settings.general.remove_from_library.remove_from_categories.label.description")}),e.jsx(f,{edge:"end",checked:o.removeMangaFromCategories,onChange:p=>i("removeMangaFromCategories",p.target.checked)})]})]}),e.jsx(y,{subheader:e.jsx(I,{component:"div",id:"library-general-settings",children:a("global.label.general")}),children:e.jsxs(_,{children:[e.jsx(c,{primary:a("library.settings.general.search.ignore_filters.label.title"),secondary:a("library.settings.general.search.ignore_filters.label.description")}),e.jsx(f,{edge:"end",checked:o.ignoreFilters,onChange:p=>i("ignoreFilters",p.target.checked)})]})}),e.jsx(re,{serverSettings:t.data.settings,categories:r.data.categories.nodes}),e.jsxs(y,{subheader:e.jsx(I,{component:"div",id:"library-advanced",children:a("global.label.advanced")}),children:[e.jsx(D,{onClick:()=>se(),children:e.jsx(c,{primary:a("library.settings.advanced.database.cleanup.label.title"),secondary:a("library.settings.advanced.database.cleanup.label.description")})}),e.jsx(M,{to:U.settings.childRoutes.library.childRoutes.duplicates.path,children:e.jsx(c,{primary:a("library.settings.advanced.duplicates.label.title"),secondary:a("library.settings.advanced.duplicates.label.description")})})]})]})}export{Se as LibrarySettings};
