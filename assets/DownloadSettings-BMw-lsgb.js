import{u as D,j as a,x as w,aE as i,as as h,Q as M,n as f,k as m,d as U,g as R,r as b,b3 as P,f as V,i as W,l as C,t as z}from"./index-YAtlvmGf.js";import{T as O}from"./TextSetting-BEOeKwkt.js";import{N as k}from"./NumberSetting-Bxnjr-8f.js";import{u as G,g as H}from"./usePersistedValue-C8YmXGio.js";import{S as c}from"./Switch-dYYnEC4v.js";import{S as B}from"./SelectSetting-BwxSN0wH.js";import{a as q}from"./CategoriesInclusionSetting-DPSO8k6n.js";import{E as F}from"./EmptyViewAbsoluteCentered-6ui_Uq2m.js";import{L as j}from"./ListSubheader-Bo9w8TfH.js";import"./PasswordTextField-nMd54wUF.js";import"./TextField-mKvu1Dg7.js";import"./useFormControl-BmhXecYK.js";import"./formControlState-Dq1zat_P.js";import"./InputAdornment-tKPrVGyD.js";import"./Slider-BQ2AI3Nb.js";import"./SwitchBase-C2GwZp-q.js";import"./Select-imZ-AwMv.js";import"./ThreeStateCheckboxInput-DiN_J2UZ.js";import"./Checkbox-BATqlhXZ.js";const N=2,K=10,v=N,Q=({downloadAheadLimit:e})=>{const{t:d}=D(),n=!!e,[s,r]=G("lastDownloadAheadLimit",v,e,H),_=l=>{r(l===0?s:l),M("downloadAheadLimit",l).catch(u=>f(d("global.error.label.failed_to_save_changes"),"error",m(u)))},g=l=>{_(l?s:0)};return a.jsxs(w,{children:[a.jsxs(i,{children:[a.jsx(h,{primary:d("download.settings.download_ahead.label.while_reading")}),a.jsx(c,{edge:"end",checked:n,onChange:l=>g(l.target.checked)})]}),a.jsx(k,{settingTitle:d("download.settings.download_ahead.label.unread_chapters_to_download"),settingValue:d("download.settings.download_ahead.label.value",{chapters:s,count:s}),value:s,minValue:N,maxValue:K,defaultValue:v,showSlider:!0,dialogDescription:d("download.settings.download_ahead.label.description"),dialogDisclaimer:d("download.settings.download_ahead.label.disclaimer"),valueUnit:d("chapter.title_one"),handleUpdate:_,disabled:!n})]})},X=[0,1,2,3,4,5],Y={0:{text:"global.label.disabled"},1:{text:"download.settings.delete_chapters.while_reading.option.label.first"},2:{text:"download.settings.delete_chapters.while_reading.option.label.second"},3:{text:"download.settings.delete_chapters.while_reading.option.label.third"},4:{text:"download.settings.delete_chapters.while_reading.option.label.fourth"},5:{text:"download.settings.delete_chapters.while_reading.option.label.fifth"}},J=X.map(e=>[e,Y[e]]),Z=e=>typeof e=="boolean"?Number(e):e,$=({chapterToDelete:e,handleChange:d})=>{const{t:n}=D(),s=Z(e);return a.jsx(B,{settingName:n("download.settings.delete_chapters.while_reading.label.title"),value:s,values:J,handleChange:d})},ee=e=>({downloadAsCbz:e.downloadAsCbz,downloadsPath:e.downloadsPath,autoDownloadNewChapters:e.autoDownloadNewChapters,autoDownloadNewChaptersLimit:e.autoDownloadNewChaptersLimit,excludeEntryWithUnreadChapters:e.excludeEntryWithUnreadChapters,autoDownloadIgnoreReUploads:e.autoDownloadIgnoreReUploads}),je=()=>{var L,S,T;const{t:e}=D(),{setTitle:d,setAction:n}=U();R.useLayoutEffect(()=>(d(e("download.title.download")),n(null),()=>{d(""),n(null)}),[e]);const s=b.useGetCategories(P),r=b.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[_]=b.useUpdateServerSettings(),{settings:g,loading:l,request:{error:u,refetch:A}}=V();if(r.loading||l||s.loading)return a.jsx(W,{});const E=(S=(L=r.error)!=null?L:u)!=null?S:s.error;if(E)return a.jsx(F,{message:e("global.error.label.failed_to_load_data"),messageExtra:m(E),retry:()=>{r.error&&r.refetch().catch(C()),u&&A().catch(C()),s.error&&s.refetch().catch(C())}});const t=ee(r.data.settings),p=(o,y)=>{_({variables:{input:{settings:{[o]:y}}}}).catch(I=>f(e("global.error.label.failed_to_save_changes"),"error",m(I)))},x=z(o=>f(e("global.error.label.failed_to_save_changes"),"error",m(o)));return a.jsxs(w,{sx:{pt:0},children:[a.jsx(O,{settingName:e("download.settings.download_path.label.title"),dialogDescription:e("download.settings.download_path.label.description"),value:t==null?void 0:t.downloadsPath,settingDescription:t!=null&&t.downloadsPath.length?t.downloadsPath:e("global.label.default"),handleChange:o=>p("downloadsPath",o)}),a.jsxs(i,{children:[a.jsx(h,{primary:e("download.settings.file_type.label.cbz")}),a.jsx(c,{edge:"end",checked:!!(t!=null&&t.downloadAsCbz),onChange:o=>p("downloadAsCbz",o.target.checked)})]}),a.jsxs(w,{subheader:a.jsx(j,{component:"div",id:"download-settings-auto-delete-downloads",children:e("download.settings.delete_chapters.title")}),children:[a.jsxs(i,{children:[a.jsx(h,{primary:e("download.settings.delete_chapters.label.manually_marked_as_read")}),a.jsx(c,{edge:"end",checked:g.deleteChaptersManuallyMarkedRead,onChange:o=>x("deleteChaptersManuallyMarkedRead",o.target.checked)})]}),a.jsx($,{chapterToDelete:g.deleteChaptersWhileReading,handleChange:o=>x("deleteChaptersWhileReading",o)}),a.jsxs(i,{children:[a.jsx(h,{primary:e("download.settings.delete_chapters.label.allow_deletion_of_bookmarked")}),a.jsx(c,{edge:"end",checked:g.deleteChaptersWithBookmark,onChange:o=>x("deleteChaptersWithBookmark",o.target.checked)})]})]}),a.jsxs(w,{subheader:a.jsx(j,{component:"div",id:"download-settings-auto-download",children:e("download.settings.auto_download.title")}),children:[a.jsxs(i,{children:[a.jsx(h,{primary:e("download.settings.auto_download.label.new_chapters")}),a.jsx(c,{edge:"end",checked:!!(t!=null&&t.autoDownloadNewChapters),onChange:o=>p("autoDownloadNewChapters",o.target.checked)})]}),a.jsx(k,{disabled:!(t!=null&&t.autoDownloadNewChapters),settingTitle:e("download.settings.auto_download.download_limit.label.title"),dialogDescription:e("download.settings.auto_download.download_limit.label.description"),value:(T=t==null?void 0:t.autoDownloadNewChaptersLimit)!=null?T:0,settingValue:t.autoDownloadNewChaptersLimit?e("download.settings.download_ahead.label.value",{chapters:t.autoDownloadNewChaptersLimit,count:t.autoDownloadNewChaptersLimit}):e("global.label.none"),defaultValue:0,minValue:0,maxValue:20,showSlider:!0,valueUnit:e("chapter.title_one"),handleUpdate:o=>p("autoDownloadNewChaptersLimit",o)}),a.jsxs(i,{children:[a.jsx(h,{primary:e("download.settings.auto_download.label.ignore_with_unread_chapters")}),a.jsx(c,{edge:"end",checked:!!(t!=null&&t.excludeEntryWithUnreadChapters),onChange:o=>p("excludeEntryWithUnreadChapters",o.target.checked),disabled:!(t!=null&&t.autoDownloadNewChapters)})]}),a.jsxs(i,{children:[a.jsx(h,{primary:e("download.settings.auto_download.label.ignore_re_uploads")}),a.jsx(c,{edge:"end",checked:!!(t!=null&&t.autoDownloadIgnoreReUploads),onChange:o=>p("autoDownloadIgnoreReUploads",o.target.checked),disabled:!(t!=null&&t.autoDownloadNewChapters)})]}),a.jsx(q,{categories:s.data.categories.nodes,includeField:"includeInDownload",dialogText:e("download.settings.auto_download.categories.label.include_in_download")})]}),a.jsx(w,{subheader:a.jsx(j,{component:"div",id:"download-settings-download-ahead",children:e("download.settings.download_ahead.title")}),children:a.jsx(Q,{downloadAheadLimit:g.downloadAheadLimit})})]})};export{je as DownloadSettings};
