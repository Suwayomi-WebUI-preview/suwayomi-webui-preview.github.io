import{u as O,h as U,aE as Q,y as V,E as J,S as C,e as K,r as H,f as l,j as e,i as Y,g as _,k as D,G as P,b as F,B as I,F as X,ay as Z,aI as q,z as ee,m as re,A as te,L as oe,T as B,C as se,I as ae,aJ as ne,aK as ie,aL as ce}from"./index-B0UwsKMl.js";import{P as ue}from"./PushPin-DDGg8_kw.js";import{D as le}from"./DoneAll-CYo1_X3v.js";import{F as me}from"./FilterList-CD9Ejmp4.js";import{A as pe}from"./AppbarSearch-BLkt-Z07.js";import{u as N}from"./useDebounce-Bdxfyile.js";import{B as de}from"./BaseMangaGrid-GUFocQyN.js";import{E as he}from"./EmptyViewAbsoluteCentered-Bs5AD096.js";import{t as ge}from"./Extensions.utils-D7rcIq_A.js";import{u as fe}from"./useAppTitleAndAction-C6z_y38M.js";import{M as xe}from"./MUI.util-CEodEA2f.js";import{S as Se}from"./SourceLanguageSelect-jrMpK3Nu.js";import{u as ye}from"./use-resize-observer-DgxFxnXw.js";import{C as be}from"./Card-BZt02v0e.js";import{C as je}from"./CardActionArea-BaIGu5xk.js";import"./ContinueReadingTooltip-BJKrb4hj.js";import"./Trackers-Bgo8y--2.js";import"./AvatarSpinner-DqrfcPAj.js";import"./SpinnerImage-DhBU3Hmo.js";import"./Refresh-BAAuuYyu.js";import"./Image-BjjbaAmX.js";import"./ListCardContent-merDFDsh.js";import"./CheckCircle-CmX11qoU.js";import"./Metadata-B8thO0tZ.js";import"./Mangas-Y1Ak7Os2.js";import"./Chapters-D6Ju3num.js";import"./DateHelper-Ct80tg9h.js";import"./Asserts-BTvS50Ww.js";import"./Link-Sj9lu0iN.js";import"./useManageMangaLibraryState-DVljZsI4.js";import"./ThreeStateCheckboxInput-CmoG1MZm.js";import"./Checkbox-4uhdyfHT.js";import"./SwitchBase-_t5Xifnm.js";import"./CheckboxInput-CNq-E9lj.js";import"./FormGroup-DKPkNSCm.js";import"./ListPreference-JfLvycct.js";import"./NumberSetting-wGGGirZY.js";import"./Slider-CKpmKyJR.js";import"./useMobilePicker-BID8sQM-.js";import"./Chip-CRl0uIfO.js";import"./SelectSetting-BRuxTpuo.js";import"./Select-DbZjlVpk.js";import"./MangaGrid-GiDgvZ60.js";import"./Delete-BmoE21Ne.js";import"./Download-B_v7a91W.js";import"./Sync-Bh7uyZLU.js";import"./use-merged-ref-CaF8PN0v.js";import"./ListCardAvatar-CxaFD5ss.js";import"./PlayArrow-BZAUZIYt.js";import"./StyledFab-DHYMZwFA.js";import"./index-DeLo89Jy.js";import"./Virtuoso.util-Bxir-kqr.js";import"./Strings-CAV0u705.js";import"./useAppTitle-DqHPF1XK.js";import"./useAppAction-Dgh2NHBd.js";import"./Switch-SWhSrS5Q.js";import"./ListItemAvatar-UcQWRgZw.js";const we=(o,m)=>o.displayName.localeCompare(m.displayName),Le=(o,m,t)=>{const s=q(o).isPinned,y=q(m).isPinned,a=t.get(o.id),r=t.get(m.id),p=!(a!=null&&a.isLoading),n=!!(a!=null&&a.error),b=!(a!=null&&a.hasResults)&&!n,c=!(r!=null&&r.isLoading),d=!!(r!=null&&r.error),j=!(r!=null&&r.hasResults)&&!d;return p&&!c?-1:!p&&c||b&&!j?1:j&&!b||!n&&d?-1:n&&!d?1:s&&!y?-1:!s&&y?1:0},Me=ce(1).seconds.inWholeMilliseconds,Re=Z.memo(({source:o,onSearchRequestFinished:m,searchString:t,emptyQuery:s,mode:y,shouldShowOnlySourcesWithResults:a})=>{var M,R;const{t:r}=O(),{id:p,name:n,lang:b}=o,c=l.useRef(t),d=l.useRef(()=>{});c.current!==t&&(c.current=t,d.current(new Error("SourceSearchPreview(".concat(p,", ").concat(n,"): search string changed"))));const[w,g]=H.useSourceSearch(p,t!=null?t:"",void 0,1,{skipRequest:!t,addAbortSignal:!0}),{data:L,isLoading:f,error:h,abortRequest:u}=g[0];d.current=u;const E=(R=(M=L==null?void 0:L.fetchSourceManga)==null?void 0:M.mangas)!=null?R:[],S=!h&&!f&&!E.length;l.useEffect(()=>{m(o,{isLoading:f,hasResults:!S,emptySearch:!t,error:h})},[f,S,t,h]);let x;return h?x=r("search.error.label.source_search_failed"):S&&(x=r("manga.error.label.no_mangas_found")),!f&&!t||s||a&&(S||h)?null:e.jsxs(P,{sx:{pb:2},children:[e.jsx(be,{sx:{mb:1},children:e.jsxs(je,{component:oe,to:te.sources.childRoutes.browse.path(p,t),sx:{p:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(P,{children:[e.jsx(B,{variant:"h5",children:n}),e.jsx(B,{variant:"caption",children:ge(b)})]}),e.jsx(se,{title:r("global.button.show_more"),children:e.jsx(ae,{...xe.preventRippleProp(),children:e.jsx(ne,{})})})]})}),x?e.jsx(ie,{sx:{alignItems:"start",height:void 0},noFaces:!0,message:x,messageExtra:_(h),retry:h?()=>w(1).catch(D("SourceSearchPreview(".concat(o.id,")::refetch"))):void 0}):e.jsx(de,{gridWrapperProps:{sx:{px:0}},mangas:E,isLoading:f,hasNextPage:!1,loadMore:()=>{},horizontal:!0,noFaces:!0,message:x,inLibraryIndicator:!0,mode:y},t)]})}),Cr=()=>{var k;const{t:o}=O(),m=U(),{pathname:t,state:s}=Q(),{ref:y,height:a}=ye(),r=(k=s==null?void 0:s.shouldShowOnlyPinnedSources)!=null?k:!0,p=t.startsWith("/migrate/source"),[n]=V(J.QUERY,ee),b=N(n,Me),{languages:c,setLanguages:d}=C.useLanguages(),{settings:{showNsfw:j,shouldShowOnlySourcesWithResults:w}}=K(),{data:g,loading:L,error:f,refetch:h}=H.useGetSourceList({notifyOnNetworkStatusChange:!0}),u=l.useMemo(()=>{var i;return(i=g==null?void 0:g.sources.nodes)!=null?i:[]},[g==null?void 0:g.sources.nodes]),[E,S]=l.useState(new Map),x=N(E,500),M=l.useMemo(()=>C.getLanguages(u),[u]),R=l.useMemo(()=>C.filter(u,{showNsfw:j,languages:c,keepLocalSource:!0,pinned:r,enabled:!0}),[u,c,r]),A=l.useMemo(()=>[...R].toSorted(we),[R]),$=l.useMemo(()=>[...A].sort((i,v)=>Le(i,v,x)),[A,x]),G=l.useCallback(({id:i},v)=>{S(z=>{const T=new Map(z);return T.set(i,v),T})},[S]),W=X(i=>re(o("global.error.label.failed_to_save_changes"),"error",_(i)));return fe(o(p?"migrate.search.title":"search.title.global_search",{title:s==null?void 0:s.mangaTitle}),e.jsxs(e.Fragment,{children:[e.jsx(pe,{isClosable:!1}),e.jsx(Se,{selectedLanguages:c,setSelectedLanguages:d,languages:M,sources:u!=null?u:[]})]}),[c,d,M,u]),L?e.jsx(Y,{}):f?e.jsx(he,{message:o("global.error.label.failed_to_load_data"),messageExtra:_(f),retry:()=>h().catch(D())}):e.jsxs(P,{sx:{position:"relative",px:1,pb:1},children:[e.jsxs(F,{ref:y,sx:{width:"100%",position:"fixed",zIndex:1,flexDirection:"row",gap:2,pt:1,pb:2,background:i=>i.palette.background.default},children:[e.jsxs(F,{sx:{flexDirection:"row",gap:1},children:[e.jsx(I,{startIcon:e.jsx(ue,{}),variant:r?"contained":"outlined",onClick:()=>m({pathname:"",search:n?"query=".concat(n):""},{replace:!0,state:{...s,shouldShowOnlyPinnedSources:!0}}),children:o("global.label.pinned")}),e.jsx(I,{startIcon:e.jsx(le,{}),variant:r?"outlined":"contained",onClick:()=>m({pathname:"",search:n?"query=".concat(n):""},{replace:!0,state:{...s,shouldShowOnlyPinnedSources:!1}}),children:o("extension.language.all")})]}),e.jsx(I,{startIcon:e.jsx(me,{}),variant:w?"contained":"outlined",onClick:()=>W("shouldShowOnlySourcesWithResults",!w),children:o("search.filter.has_results")})]}),e.jsx(P,{sx:{pt:"".concat(a,"px")},children:$.map(i=>e.jsx(Re,{source:i,onSearchRequestFinished:G,searchString:b,emptyQuery:!n,mode:p?"migrate.select":"source",shouldShowOnlySourcesWithResults:w},i.id))})]})};export{Cr as SearchAll};
