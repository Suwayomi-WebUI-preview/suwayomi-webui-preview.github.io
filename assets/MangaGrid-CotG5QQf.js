import{c as h,$ as Se,_ as $e,s as q,a2 as H,a3 as _e,w as De,bD as Re,a4 as Te,j as t,a5 as Ee,bE as X,bF as ne,a6 as Le,r as de,i as pe,Q as Pe,U as ae,V as Ge,M as oe,B as N,F as Be,af as ee,u as A,v as We,L as Y,H as fe,h as ge,e as ze,W as Fe,p as Oe,au as Ne,av as Ae,aw as Ve,S as K,b as W,bg as He,m as Ke,y as Ue,f as z,I as qe,o as P,n as he,T as te,P as Ye,z as Ze,R as Qe,g as me,ak as Xe,b2 as Je,b3 as et,d as tt,E as nt}from"./index-DUjAQRrY.js";import{C as xe,a as be,b as ot}from"./index-BNqJm-x8.js";import{l as rt,M as L,d as st,C as it,a as at,b as ct,m as lt,n as ut,j as dt,T as pt,c as ft,e as gt,f as ht,g as ce,i as mt,J as xt,h as bt}from"./useManageMangaLibraryState-BXTNkZCn.js";import{d as vt}from"./Delete-LG6ztto4.js";import{d as jt}from"./Sync-CQWUCWaR.js";import{M as I,a as Ct}from"./Mangas-Bim3x2l-.js";import{C as Q}from"./CheckboxInput-DbmwjMWz.js";import{F as wt}from"./ListPreference-C4WCxO6Q.js";import{S as ve}from"./SpinnerImage-Cxhh8Fbn.js";import{C as yt}from"./Checkbox-DFgtu5-F.js";import{T as je,C as Mt}from"./TypographyMaxLines-B_8XvgzD.js";import{L as kt}from"./Link-D0biBbd8.js";import{A as It}from"./Avatar-050Z0ab-.js";import{d as St}from"./PlayArrow-Du9h7dzu.js";import{D as $t}from"./StyledFab-Dh0hOvbp.js";const _t=h.createContext(),le=_t;function Dt(e){return Se("MuiGrid",e)}const Rt=[0,1,2,3,4,5,6,7,8,9,10],Tt=["column-reverse","column","row-reverse","row"],Et=["nowrap","wrap-reverse","wrap"],V=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],U=$e("MuiGrid",["root","container","item","zeroMinWidth",...Rt.map(e=>"spacing-xs-".concat(e)),...Tt.map(e=>"direction-xs-".concat(e)),...Et.map(e=>"wrap-xs-".concat(e)),...V.map(e=>"grid-xs-".concat(e)),...V.map(e=>"grid-sm-".concat(e)),...V.map(e=>"grid-md-".concat(e)),...V.map(e=>"grid-lg-".concat(e)),...V.map(e=>"grid-xl-".concat(e))]),Lt=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function O(e){const n=parseFloat(e);return"".concat(n).concat(String(e).replace(String(n),"")||"px")}function Pt({theme:e,ownerState:n}){let o;return e.breakpoints.keys.reduce((r,i)=>{let s={};if(n[i]&&(o=n[i]),!o)return r;if(o===!0)s={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(o==="auto")s={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const a=X({values:n.columns,breakpoints:e.breakpoints.values}),d=typeof a=="object"?a[i]:a;if(d==null)return r;const u="".concat(Math.round(o/d*1e8)/1e6,"%");let l={};if(n.container&&n.item&&n.columnSpacing!==0){const c=e.spacing(n.columnSpacing);if(c!=="0px"){const g="calc(".concat(u," + ").concat(O(c),")");l={flexBasis:g,maxWidth:g}}}s=H({flexBasis:u,flexGrow:0,maxWidth:u},l)}return e.breakpoints.values[i]===0?Object.assign(r,s):r[e.breakpoints.up(i)]=s,r},{})}function Gt({theme:e,ownerState:n}){const o=X({values:n.direction,breakpoints:e.breakpoints.values});return ne({theme:e},o,r=>{const i={flexDirection:r};return r.indexOf("column")===0&&(i["& > .".concat(U.item)]={maxWidth:"none"}),i})}function Ce({breakpoints:e,values:n}){let o="";Object.keys(n).forEach(i=>{o===""&&n[i]!==0&&(o=i)});const r=Object.keys(e).sort((i,s)=>e[i]-e[s]);return r.slice(0,r.indexOf(o))}function Bt({theme:e,ownerState:n}){const{container:o,rowSpacing:r}=n;let i={};if(o&&r!==0){const s=X({values:r,breakpoints:e.breakpoints.values});let a;typeof s=="object"&&(a=Ce({breakpoints:e.breakpoints.values,values:s})),i=ne({theme:e},s,(d,u)=>{var l;const c=e.spacing(d);return c!=="0px"?{marginTop:"-".concat(O(c)),["& > .".concat(U.item)]:{paddingTop:O(c)}}:(l=a)!=null&&l.includes(u)?{}:{marginTop:0,["& > .".concat(U.item)]:{paddingTop:0}}})}return i}function Wt({theme:e,ownerState:n}){const{container:o,columnSpacing:r}=n;let i={};if(o&&r!==0){const s=X({values:r,breakpoints:e.breakpoints.values});let a;typeof s=="object"&&(a=Ce({breakpoints:e.breakpoints.values,values:s})),i=ne({theme:e},s,(d,u)=>{var l;const c=e.spacing(d);return c!=="0px"?{width:"calc(100% + ".concat(O(c),")"),marginLeft:"-".concat(O(c)),["& > .".concat(U.item)]:{paddingLeft:O(c)}}:(l=a)!=null&&l.includes(u)?{}:{width:"100%",marginLeft:0,["& > .".concat(U.item)]:{paddingLeft:0}}})}return i}function zt(e,n,o={}){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[o["spacing-xs-".concat(String(e))]];const r=[];return n.forEach(i=>{const s=e[i];Number(s)>0&&r.push(o["spacing-".concat(i,"-").concat(String(s))])}),r}const Ft=q("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:o}=e,{container:r,direction:i,item:s,spacing:a,wrap:d,zeroMinWidth:u,breakpoints:l}=o;let c=[];r&&(c=zt(a,l,n));const g=[];return l.forEach(m=>{const p=o[m];p&&g.push(n["grid-".concat(m,"-").concat(String(p))])}),[n.root,r&&n.container,s&&n.item,u&&n.zeroMinWidth,...c,i!=="row"&&n["direction-xs-".concat(String(i))],d!=="wrap"&&n["wrap-xs-".concat(String(d))],...g]}})(({ownerState:e})=>H({boxSizing:"border-box"},e.container&&{display:"flex",flexWrap:"wrap",width:"100%"},e.item&&{margin:0},e.zeroMinWidth&&{minWidth:0},e.wrap!=="wrap"&&{flexWrap:e.wrap}),Gt,Bt,Wt,Pt);function Ot(e,n){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return["spacing-xs-".concat(String(e))];const o=[];return n.forEach(r=>{const i=e[r];if(Number(i)>0){const s="spacing-".concat(r,"-").concat(String(i));o.push(s)}}),o}const Nt=e=>{const{classes:n,container:o,direction:r,item:i,spacing:s,wrap:a,zeroMinWidth:d,breakpoints:u}=e;let l=[];o&&(l=Ot(s,u));const c=[];u.forEach(m=>{const p=e[m];p&&c.push("grid-".concat(m,"-").concat(String(p)))});const g={root:["root",o&&"container",i&&"item",d&&"zeroMinWidth",...l,r!=="row"&&"direction-xs-".concat(String(r)),a!=="wrap"&&"wrap-xs-".concat(String(a)),...c]};return Le(g,Dt,n)},At=h.forwardRef(function(n,o){const r=_e({props:n,name:"MuiGrid"}),{breakpoints:i}=De(),s=Re(r),{className:a,columns:d,columnSpacing:u,component:l="div",container:c=!1,direction:g="row",item:m=!1,rowSpacing:p,spacing:x=0,wrap:f="wrap",zeroMinWidth:j=!1}=s,v=Te(s,Lt),k=p||x,S=u||x,$=h.useContext(le),M=c?d||12:$,_={},D=H({},v);i.keys.forEach(y=>{v[y]!=null&&(_[y]=v[y],delete D[y])});const C=H({},s,{columns:M,container:c,direction:g,item:m,rowSpacing:k,columnSpacing:S,wrap:f,zeroMinWidth:j,spacing:x},_,{breakpoints:i.keys}),w=Nt(C);return t.jsx(le.Provider,{value:M,children:t.jsx(Ft,H({ownerState:C,className:Ee(w.root,a),as:l,ref:o},D))})}),re=At;var se={},Vt=pe;Object.defineProperty(se,"__esModule",{value:!0});var we=se.default=void 0,Ht=Vt(de()),Kt=t;we=se.default=(0,Ht.default)((0,Kt.jsx)("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"ChevronRight");var ie={},Ut=pe;Object.defineProperty(ie,"__esModule",{value:!0});var ye=ie.default=void 0,qt=Ut(de()),Yt=t;ye=ie.default=(0,qt.default)((0,Yt.jsx)("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"ChevronLeft");const Zt=h.forwardRef(({MenuItemProps:e,className:n,label:o,LeftIcon:r,renderLabel:i,RightIcon:s,...a},d)=>t.jsxs(Pe,{...e,ref:d,className:n,...a,children:[r&&t.jsx(ae,{children:t.jsx(r,{fontSize:"small"})}),t.jsx(Ge,{children:o}),s&&t.jsx(ae,{style:{minWidth:0},children:t.jsx(s,{fontSize:"small"})})]})),Me=h.forwardRef((e,n)=>{const{parentMenuOpen:o,label:r,renderLabel:i,RightIcon:s=ee(we,ye),LeftIcon:a,children:d,className:u,tabIndex:l,ContainerProps:c={},MenuProps:g,...m}=e,p=oe.useIsTouchDevice(),{ref:x,...f}=c,j=h.useRef(null);h.useImperativeHandle(n,()=>j.current);const v=h.useRef(null);h.useImperativeHandle(x,()=>v.current);const k=h.useRef(null),[S,$]=h.useState(!1),M=b=>{if(S!==b){if(e.disabled){$(!1);return}$(b)}},_=b=>{p||(M(!0),f.onMouseEnter&&f.onMouseEnter(b))},D=b=>{M(!1),f.onMouseLeave&&f.onMouseLeave(b)},C=()=>{var G,E;const b=(E=(G=v.current)==null?void 0:G.ownerDocument.activeElement)!=null?E:null;if(k.current==null)return!1;for(const B of k.current.children)if(B===b)return!0;return!1},w=b=>{p||(b.target===v.current&&M(!0),f.onFocus&&f.onFocus(b))},y=b=>{M(!S),f.onClick&&f.onClick(b)},F=b=>{var E,B,J;if(b.key==="Escape")return;C()&&b.stopPropagation();const G=(E=v.current)==null?void 0:E.ownerDocument.activeElement;if(b.key==="ArrowLeft"&&C()&&((B=v.current)==null||B.focus()),b.key==="ArrowRight"&&b.target===v.current&&b.target===G){const Z=(J=k.current)==null?void 0:J.children[0];Z==null||Z.focus()}},R=S&&o;let T;return e.disabled||(T=l!==void 0?l:-1),t.jsxs(N,{...f,ref:v,onFocus:w,onClick:y,tabIndex:T,onMouseEnter:_,onMouseLeave:D,onKeyDown:F,children:[t.jsx(Zt,{MenuItemProps:m,className:u,ref:j,LeftIcon:a,RightIcon:s,label:r,renderLabel:i}),t.jsx(Be,{style:{pointerEvents:"none"},anchorEl:j.current,anchorOrigin:{horizontal:ee("right","left"),vertical:"top"},transformOrigin:{horizontal:ee("left","right"),vertical:"top"},open:R,autoFocus:!1,disableAutoFocus:!0,disableEnforceFocus:!0,onClose:()=>{M(!1)},...g,children:t.jsx(N,{ref:k,style:{pointerEvents:"auto"},children:d})})]})});Me.displayName="NestedMenuItem";const Qt=["remove_from_library"],Xt=({manga:e,handleSelection:n,selectedMangas:o,onClose:r,setHideMenu:i})=>{const{t:s}=A(),[a,d]=h.useState(!1),u=!!e,l=o!=null?o:[],c=ft(u,Ct),g=gt(u),m=ht(u),p=!!e&&e.downloadCount===e.chapters.totalCount,x=!!(e!=null&&e.downloadCount),f=!!(e!=null&&e.unreadCount),j=!!e&&e.unreadCount!==e.chapters.totalCount,{openCategorySelect:v,CategorySelectComponent:k}=rt({mangaId:e==null?void 0:e.id,mangaIds:o?I.getIds(l):void 0,onClose:()=>r(!0),addToLibrary:!1}),S=()=>{n==null||n(e.id,!0),r(!0)},$=(w,y)=>{I.performAction(w,e?[e.id]:I.getIds(y),{wasManuallyMarkedAsRead:!0}).catch(ge()),r(!Qt.includes(w))},{downloadableMangas:M,downloadedMangas:_,unreadMangas:D,readMangas:C}=h.useMemo(()=>({downloadableMangas:[...I.getNotDownloaded(l),...I.getPartiallyDownloaded(l)],downloadedMangas:[...I.getPartiallyDownloaded(l),...I.getFullyDownloaded(l)],unreadMangas:[...I.getUnread(l),...I.getPartiallyRead(l)],readMangas:[...I.getPartiallyRead(l),...I.getFullyRead(l)]}),[l]);return t.jsxs(t.Fragment,{children:[!!n&&u&&t.jsx(L,{onClick:S,Icon:st,title:s("chapter.action.label.select")}),g(!p)&&t.jsx(Me,{disabled:m(!M.length),LeftIcon:We,label:c("download",M.length),parentMenuOpen:!0,children:t.jsx(it,{mangaIds:u?[e.id]:I.getIds(l),closeMenu:()=>r(!0)})}),g(x)&&t.jsx(L,{Icon:vt,disabled:m(!_.length),onClick:()=>$("delete",_),title:c("delete",_.length)}),g(f)&&t.jsx(L,{Icon:at,disabled:m(!D.length),onClick:()=>$("mark_as_read",D),title:c("mark_as_read",D.length)}),g(j)&&t.jsx(L,{Icon:ct,disabled:m(!C.length),onClick:()=>$("mark_as_unread",C),title:c("mark_as_unread",C.length)}),u&&t.jsx(Y,{to:"/migrate/source/".concat(e==null?void 0:e.sourceId,"/manga/").concat(e==null?void 0:e.id,"/search?query=").concat(e==null?void 0:e.title),state:{mangaTitle:e==null?void 0:e.title},style:{textDecoration:"none",color:"inherit"},children:t.jsx(L,{Icon:lt,title:c("migrate",l.length)})}),u&&t.jsx(L,{onClick:()=>{d(!0),i(!0)},Icon:jt,title:c("track",l.length)}),t.jsx(L,{onClick:()=>{v(!0),i(!0)},Icon:ut,title:c("change_categories",l.length)}),t.jsx(L,{onClick:()=>$("remove_from_library",l),Icon:dt,title:c("remove_from_library",l.length)}),k,a&&t.jsx(fe,{open:!0,maxWidth:"md",fullWidth:!0,scroll:"paper",onClose:()=>{d(!1),r(!0)},children:t.jsx(pt,{manga:e})})]})},Jt=({mangaIdToMigrateTo:e,onClose:n})=>{const{t:o}=A(),r=ze(),{mangaId:i}=Fe(),s=Number(i),{settings:{migrateChapters:a,migrateCategories:d,migrateTracking:u,deleteChapters:l}}=Oe(),[c,g]=h.useState(!1),m=He(ge()),p=async x=>{if(s==null)throw new Error('MigrateDialog::migrate: unexpected mangaId "'.concat(s,'"'));Ke(o("migrate.label.info"),"info"),g(!0);try{await I.migrate(s,e,{mode:x,migrateChapters:a,migrateCategories:d,migrateTracking:u,deleteChapters:l}),r("/manga/".concat(e),{replace:!0})}catch(f){g(!1)}};return t.jsxs(fe,{open:!0,fullWidth:!0,onClose:n,children:[t.jsx(Ne,{children:o("migrate.dialog.title")}),t.jsx(Ae,{dividers:!0,children:t.jsxs(wt,{children:[t.jsx(Q,{disabled:c,label:o("chapter.title_one"),checked:a,onChange:(x,f)=>m("migrateChapters",f)}),t.jsx(Q,{disabled:c,label:o("category.title.category_one"),checked:d,onChange:(x,f)=>m("migrateCategories",f)}),t.jsx(Q,{disabled:c,label:o("tracking.title"),checked:u,onChange:(x,f)=>m("migrateTracking",f)}),t.jsx(Q,{disabled:c,label:o("migrate.dialog.label.delete_downloaded"),checked:l,onChange:(x,f)=>m("deleteChapters",f)})]})}),t.jsx(Ve,{children:t.jsxs(K,{sx:{width:"100%"},direction:"row",justifyContent:"space-between",children:[t.jsx(W,{disabled:c,component:Y,to:"/manga/".concat(e),children:o("migrate.dialog.action.button.show_entry")}),t.jsxs(K,{direction:"row",children:[t.jsx(W,{disabled:c,onClick:n,children:o("global.button.cancel")}),t.jsx(W,{disabled:c,onClick:()=>p("copy"),children:o("global.button.copy")}),t.jsx(W,{disabled:c,onClick:()=>p("migrate"),children:o("global.button.migrate")})]})]})})]})},ke=h.forwardRef(({id:e,selected:n,handleSelection:o,asCheckbox:r=!1,popupState:i},s)=>{const{t:a}=A(),d=oe.useIsTouchDevice(),u=h.useMemo(()=>Ue(i),[i]),l=p=>{p.stopPropagation(),p.preventDefault()},c=(p,x)=>{l(p),o==null||o(e,x)},g=p=>{d||(l(p),i.open(p),u.onClick(p))};return o?n!==null?r?t.jsx(z,{title:a(n?"global.button.deselect":"global.button.select"),children:t.jsx(yt,{checked:n,onMouseDown:l,onChange:c})}):null:r?t.jsx(z,{title:a("global.button.options"),children:t.jsx(qe,{ref:s,...u,onClick:g,onTouchStart:g,"aria-label":"more",size:"large",onMouseDown:l,children:t.jsx(ce,{})})}):t.jsx(z,{title:a("global.button.options"),children:t.jsx(W,{ref:s,...u,onClick:g,onTouchStart:g,className:"manga-option-button",size:"small",variant:"contained",sx:{minWidth:"unset",paddingX:"0",paddingY:"2.5px",visibility:i.isOpen?"visible":"hidden",pointerEvents:"none","@media not (pointer: fine)":{visibility:"hidden",pointerEvents:void 0}},onMouseDown:p=>p.stopPropagation(),children:t.jsx(ce,{})})}):null}),en=q("div")({position:"absolute",bottom:0,width:"100%",height:"30%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),tn=q("div")({position:"absolute",bottom:0,width:"100%",height:"20%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),ue=q(je)({fontSize:"1.05rem"}),nn=({manga:e,longPressBind:n,popupState:o,handleClick:r,mangaLinkTo:i,selected:s,inLibraryIndicator:a,isInLibrary:d,gridLayout:u,handleSelection:l,continueReadingButton:c,mangaBadges:g,mode:m})=>{const p=h.useRef(null),{id:x,title:f}=e;return t.jsx(kt,{component:Y,...n(()=>o.open(p.current)),onClick:r,to:i,state:{mangaTitle:f},sx:{textDecoration:"none",touchCallout:"none"},children:t.jsxs(N,{sx:{display:"flex",flexDirection:"column",margin:"2px",outline:s?"4px solid":void 0,borderRadius:s?"1px":void 0,outlineColor:j=>j.palette.primary.main,backgroundColor:j=>s?j.palette.primary.main:void 0,"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:m==="source"?"none":"flex"}}},children:[t.jsx(xe,{sx:{aspectRatio:"225/350",display:"flex"},children:t.jsxs(be,{sx:{position:"relative",height:"100%"},children:[t.jsx(ve,{alt:f,src:I.getThumbnailUrl(e),imgStyle:a&&d?{height:"100%",width:"100%",objectFit:"cover",filter:"brightness(0.4)"}:{height:"100%",width:"100%",objectFit:"cover"},spinnerStyle:{display:"grid",placeItems:"center"}}),t.jsxs(K,{alignItems:"start",justifyContent:"space-between",direction:"row",sx:{position:"absolute",top:5,left:5,right:5},children:[g,t.jsx(ke,{ref:p,popupState:o,id:x,selected:s,handleSelection:l})]}),t.jsxs(t.Fragment,{children:[u!==P.Comfortable&&t.jsxs(t.Fragment,{children:[t.jsx(en,{}),t.jsx(tn,{})]}),t.jsxs(K,{direction:"row",justifyContent:u!==P.Comfortable?"space-between":"end",alignItems:"end",sx:{position:"absolute",bottom:0,width:"100%",margin:"0.5em 0",padding:"0 0.5em",gap:"0.5em"},children:[u!==P.Comfortable&&t.jsx(z,{title:f,placement:"top",children:t.jsx(ue,{sx:{color:"white",textShadow:"0px 0px 3px #000000"},children:f})}),c]})]})]})}),u===P.Comfortable&&t.jsx(z,{title:f,placement:"top",children:t.jsx(ue,{sx:{position:"relative",width:"100%",bottom:0,margin:"0.5em 0",padding:"0 0.5em",color:"text.primary",height:"3rem"},children:f})})]})})},on=({manga:e,longPressBind:n,popupState:o,handleClick:r,mangaLinkTo:i,selected:s,inLibraryIndicator:a,isInLibrary:d,handleSelection:u,continueReadingButton:l,mangaBadges:c,mode:g})=>{const m=h.useRef(null),{id:p,title:x}=e;return t.jsx(xe,{children:t.jsx(be,{component:Y,to:i,state:{mangaTitle:x},onClick:r,...n(()=>o.open(m.current)),sx:{touchCallout:"none","@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:g==="source"?"none":"inline-flex"}}},children:t.jsxs(Mt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:2,position:"relative"},children:[t.jsx(It,{variant:"rounded",sx:{width:56,height:56,flex:"0 0 auto",marginRight:2},children:t.jsx(ve,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%",imageRendering:"pixelated",filter:a&&d?"brightness(0.4)":void 0},alt:e.title,src:I.getThumbnailUrl(e)})}),t.jsx(N,{sx:{display:"flex",flexDirection:"row",flexGrow:1,width:"min-content"},children:t.jsx(z,{title:x,placement:"top",children:t.jsx(je,{variant:"h5",children:x})})}),t.jsxs(K,{direction:"row",alignItems:"center",gap:"5px",children:[c,l,t.jsx(ke,{ref:m,popupState:o,id:p,selected:s,handleSelection:u,asCheckbox:!0})]})]})})})},rn=({showContinueReadingButton:e,isLatestChapterRead:n,nextChapterIndexToRead:o,mangaLinkTo:r})=>{const{t:i}=A(),s=o===1;return!e||n?null:t.jsx(z,{title:i(s?"global.button.start":"global.button.resume"),children:t.jsx(W,{variant:"contained",size:"small",sx:{minWidth:"unset"},component:Y,to:"".concat(r,"chapter/").concat(o),onClick:a=>a.stopPropagation(),onMouseDown:a=>a.stopPropagation(),children:t.jsx(St,{})})})},sn=q("div")({display:"flex",height:"fit-content",borderRadius:"5px",overflow:"hidden","& p":{color:"white",padding:"0.1em",paddingInline:"0.2em",fontSize:"1.05rem"}}),an=({inLibraryIndicator:e,updateLibraryState:n,isInLibrary:o,unread:r,downloadCount:i,mode:s})=>{const{t:a}=A(),d=oe.useIsTouchDevice(),{options:{showUnreadBadge:u,showDownloadBadge:l}}=he();return t.jsxs(sn,{children:[!d&&e&&s==="source"&&t.jsx(W,{className:"source-manga-library-state-button",component:"div",variant:"contained",size:"small",onMouseDown:c=>c.stopPropagation(),onClick:c=>{c.preventDefault(),c.stopPropagation(),n()},sx:{display:"none"},color:o?"error":"primary",children:a(o?"manga.action.library.remove.label.action":"manga.button.add_to_library")}),e&&o&&t.jsx(te,{className:"source-manga-library-state-indicator",sx:{backgroundColor:"primary.dark"},children:a("manga.button.in_library")}),(u&&s==="default"||s==="duplicate")&&(r!=null?r:0)>0&&t.jsx(te,{sx:{backgroundColor:"primary.dark"},children:r}),(l&&s==="default"||s==="duplicate")&&(i!=null?i:0)>0&&t.jsx(te,{sx:{backgroundColor:"success.dark"},children:i})]})},cn=(e,n,o,r)=>{switch(e){case"default":case"source":case"duplicate":return"/manga/".concat(n,"/");case"migrate.search":return"/migrate/source/".concat(o,"/manga/").concat(n,"/search?query=").concat(r);case"migrate.select":return"";default:throw new Error('getMangaLinkTo: unexpected MangaCardMode "'.concat(e,'"'))}},ln=e=>{var F;const{manga:n,gridLayout:o,inLibraryIndicator:r,selected:i,handleSelection:s,mode:a="default"}=e,{id:d,latestReadChapter:u,firstUnreadChapter:l,chapters:c,downloadCount:g,unreadCount:m}=n,{options:{showContinueReadingButton:p}}=he(),{CategorySelectComponent:x,updateLibraryState:f,isInLibrary:j}=mt(n,a==="source"),v=cn(a,n.id,n.sourceId,n.title),k=(F=l==null?void 0:l.sourceOrder)!=null?F:1,S=(c==null?void 0:c.totalCount)===(u==null?void 0:u.sourceOrder),[$,M]=h.useState(!1),_=(R,T)=>{const b=a==="default",G=a==="source",E=a==="migrate.select",B=i!==null;if(E||B||(b||G)&&T){if(R.preventDefault(),G){f();return}if(B){s==null||s(d,!i,{selectRange:R.shiftKey});return}if(b){T==null||T();return}E&&M(!0)}},D=xt((R,{context:T})=>{R.shiftKey=!0,_(R,T)}),C=h.useMemo(()=>o===P.List?on:nn,[o]),w=h.useMemo(()=>t.jsx(rn,{showContinueReadingButton:p&&a==="default",isLatestChapterRead:S,nextChapterIndexToRead:k,mangaLinkTo:v}),[p,S,k,v]),y=h.useMemo(()=>t.jsx(an,{inLibraryIndicator:r,isInLibrary:j,unread:m,downloadCount:g,updateLibraryState:f,mode:a}),[r,j,m,g,f]);return t.jsxs(t.Fragment,{children:[$&&t.jsx(Jt,{mangaIdToMigrateTo:n.id,onClose:()=>M(!1)}),t.jsx(Ye,{variant:"popover",popupId:"manga-card-action-menu",children:R=>t.jsxs(t.Fragment,{children:[t.jsx(C,{...e,longPressBind:D,popupState:R,handleClick:_,mangaLinkTo:v,isInLibrary:j,inLibraryIndicator:r,continueReadingButton:w,mangaBadges:y}),!!s&&R.isOpen&&t.jsx(bt,{...Ze(R),children:(T,b)=>t.jsx(Xt,{manga:n,handleSelection:s,onClose:T,setHideMenu:b})}),x]})})]})},un=Qe.forwardRef(({children:e,...n},o)=>t.jsx(re,{...n,ref:o,container:!0,sx:{paddingLeft:"5px",paddingRight:"13px"},children:e})),dn=(e,n,o,r=12)=>{const i=Math.ceil(e/n),s=o===P.List?r:r/i;return({children:a,...d})=>t.jsx(re,{...d,item:!0,xs:s,sx:{width:"100%",paddingTop:"8px",paddingLeft:"8px"},children:a})},Ie=(e,n,o,r=!1,i,s,a)=>t.jsx(ln,{manga:e,gridLayout:n,inLibraryIndicator:o,selected:r?i==null?void 0:i.includes(e.id):null,handleSelection:s,mode:a},e.id),pn=h.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:r,gridLayout:i,isSelectModeActive:s,selectedMangaIds:a,handleSelection:d,mode:u},l)=>t.jsx(re,{ref:l,container:!0,spacing:1,style:{margin:0,width:"100%",padding:"5px",overflowX:"auto",display:"-webkit-inline-box",flexWrap:"nowrap"},children:e?t.jsx(me,{}):n.map(c=>t.jsx(r,{children:Ie(c,i,o,s,a,d,u)},c.id))})),fn=e=>"MangaGrid-snapshot-location-".concat(e.key),gn=h.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:r,gridLayout:i,hasNextPage:s,loadMore:a,isSelectModeActive:d,selectedMangaIds:u,handleSelection:l,mode:c},g)=>{const m=Xe(),p=fn(m),[x]=Je(p,void 0),f=h.useRef(),j=v=>{const k=window.location.href;clearTimeout(f.current),f.current=setTimeout(()=>{k===window.location.href&&et.session.setItem(p,v,!1)},250)};return h.useEffect(()=>clearTimeout(f.current),[m.key,f.current]),t.jsxs(t.Fragment,{children:[t.jsx(N,{ref:g,children:t.jsx(ot,{useWindowScroll:!0,overscan:window.innerHeight*.25,totalCount:n.length,components:{List:un,Item:r},restoreStateFrom:x,stateChanged:j,endReached:()=>a(),itemContent:v=>Ie(n[v],i,o,d,u,l,c)})}),d&&i===P.List?t.jsx(N,{sx:{paddingBottom:$t}}):e?t.jsx(me,{}):s?t.jsx("div",{style:{height:"75px"}}):null]})}),Dn=({mangas:e,isLoading:n,message:o,messageExtra:r,hasNextPage:i,loadMore:s,gridLayout:a,horizontal:d,noFaces:u,inLibraryIndicator:l,isSelectModeActive:c,selectedMangaIds:g,handleSelection:m,mode:p,retry:x})=>{const{t:f}=A(),j=h.useRef(null),[v,k]=h.useState(document.documentElement.offsetWidth),[S]=tt("ItemWidth",300),$=h.useRef(null),M=h.useMemo(()=>dn(v,S,a),[v,S,a]),_=()=>{k((()=>{var y;const w=(y=$.current)==null?void 0:y.offsetWidth;return w||document.documentElement.offsetWidth})())};return h.useLayoutEffect(_,[]),h.useLayoutEffect(()=>{let C;const w=y=>{C=setTimeout(()=>{if(document.body.style.overflow.includes("hidden")){w(250);return}document.body.style.overflowY=a===P.List?"auto":"scroll"},y)};return w(0),()=>{clearTimeout(C)}},[a]),h.useLayoutEffect(()=>()=>{document.body.style.overflowY="auto"},[]),h.useEffect(()=>{let C;const w=()=>{clearInterval(C),C=setTimeout(_,100)};return window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[]),h.useEffect(()=>{if(!j.current)return()=>{};if(j.current.offsetHeight>document.documentElement.clientHeight)return()=>{};const C=new ResizeObserver(w=>{const y=w[0].target.clientHeight,F=y>document.documentElement.clientHeight;if(!n&&y){if(F){C.disconnect();return}s(),C.disconnect()}});return C.observe(j.current),()=>C.disconnect()},[s,n]),!n&&e.length===0?t.jsx(nt,{noFaces:u,message:o!=null?o:f("manga.error.label.no_mangas_found"),messageExtra:r,retry:x}):t.jsx("div",{ref:$,style:{overflow:"hidden",paddingBottom:"13px"},children:d?t.jsx(pn,{ref:j,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:M,gridLayout:a,isSelectModeActive:c,selectedMangaIds:g,handleSelection:m,mode:p}):t.jsx(gn,{ref:j,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:M,hasNextPage:i,loadMore:s,gridLayout:a,isSelectModeActive:c,selectedMangaIds:g,handleSelection:m,mode:p})})};export{Dn as M,Xt as a,ln as b,fn as g};
