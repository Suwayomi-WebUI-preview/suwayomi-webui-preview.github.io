var J=Object.freeze,ce=Object.defineProperty;var Q=(e,t)=>J(ce(e,"raw",{value:J(t||e.slice())}));import{b as n,c as G,j as l,ax as ie,ay as le,p as ue,as as de,B,a6 as ge,dB as fe,f as D,Q as me,R as he,u as te,r as P,dC as ae,i as be,k as pe,n as ve,q as Ce,S as q,A as oe,L as ye,dD as xe,Y as Me,m as F,g as R,d as Se,bd as z,cn as Te,dE as we,az as Ie}from"./index-C3WByR-J.js";import{D as Le}from"./Chapters-uYytOo5J.js";import{a as U}from"./Mangas-CzPiCKE1.js";import{T as ke}from"./ThreeStateCheckboxInput-CuFA94O7.js";import{C as Ee}from"./CheckboxInput-XZcTpUoZ.js";import{F as Ae}from"./FormGroup-i1c66pxR.js";var O=(e=>(e.Mouse="mouse",e.Touch="touch",e.Pointer="pointer",e))(O||{}),N=(e=>(e.CancelledByMovement="cancelled-by-movement",e.CancelledByRelease="cancelled-by-release",e.CancelledOutsideElement="cancelled-outside-element",e))(N||{});const De=["mousedown","mousemove","mouseup","mouseleave","mouseout"],_e=["touchstart","touchmove","touchend","touchcancel"],je=["pointerdown","pointermove","pointerup","pointerleave","pointerout"];function Fe(e){return typeof e=="object"&&e!==null&&"pageX"in e&&typeof e.pageX=="number"&&"pageY"in e&&typeof e.pageY=="number"}function Re(e){var t;return De.includes((t=e==null?void 0:e.nativeEvent)==null?void 0:t.type)}function re(e){var t;return _e.includes((t=e==null?void 0:e.nativeEvent)==null?void 0:t.type)||"touches"in e}function Oe(e){const{nativeEvent:t}=e;return t?je.includes(t==null?void 0:t.type)||"pointerId"in t:!1}function $(e){return Re(e)||re(e)||Oe(e)}function Z(e){var t;const a=re(e)?(t=e==null?void 0:e.touches)==null?void 0:t[0]:e;return Fe(a)?{x:a.pageX,y:a.pageY}:null}function Ne(e){return{target:e.target,currentTarget:e.currentTarget,nativeEvent:e,persist:()=>{}}}function it(e,{threshold:t=400,captureEvent:a=!1,detect:s=O.Pointer,cancelOnMovement:c=!1,cancelOutsideElement:u=!0,filterEvents:i,onStart:d,onMove:T,onFinish:w,onCancel:I}={}){const C=n.useRef(!1),y=n.useRef(!1),h=n.useRef(),x=n.useRef(),b=n.useRef(e),p=n.useRef(null),L=n.useCallback(o=>r=>{y.current||$(r)&&(i!==void 0&&!i(r)||(a&&r.persist(),d==null||d(r,{context:o}),p.current=Z(r),y.current=!0,h.current=r.currentTarget,x.current=setTimeout(()=>{b.current&&(b.current(r,{context:o}),C.current=!0)},t)))},[a,i,d,t]),f=n.useCallback(o=>(r,g)=>{$(r)&&y.current&&(p.current=null,a&&r.persist(),C.current?w==null||w(r,{context:o}):y.current&&(I==null||I(r,{context:o,reason:g!=null?g:N.CancelledByRelease})),C.current=!1,y.current=!1,x.current!==void 0&&clearTimeout(x.current))},[a,w,I]),M=n.useCallback(o=>r=>{if($(r)&&(T==null||T(r,{context:o}),c!==!1&&p.current)){const g=Z(r);if(g){const v=c===!0?25:c,m={x:Math.abs(g.x-p.current.x),y:Math.abs(g.y-p.current.y)};(m.x>v||m.y>v)&&f(o)(r,N.CancelledByMovement)}}},[f,c,T]),S=n.useCallback(o=>{if(e===null)return{};switch(s){case O.Mouse:{const r={onMouseDown:L(o),onMouseMove:M(o),onMouseUp:f(o)};return u&&(r.onMouseLeave=g=>{f(o)(g,N.CancelledOutsideElement)}),r}case O.Touch:return{onTouchStart:L(o),onTouchMove:M(o),onTouchEnd:f(o)};case O.Pointer:{const r={onPointerDown:L(o),onPointerMove:M(o),onPointerUp:f(o)};return u&&(r.onPointerLeave=g=>f(o)(g,N.CancelledOutsideElement)),r}}},[e,f,u,s,M,L]);return n.useEffect(()=>{function o(r){const g=Ne(r);f()(g)}return window.addEventListener("mouseup",o),window.addEventListener("touchend",o),window.addEventListener("pointerup",o),()=>{window.removeEventListener("mouseup",o),window.removeEventListener("touchend",o),window.removeEventListener("pointerup",o)}},[f]),n.useEffect(()=>()=>{x.current!==void 0&&clearTimeout(x.current)},[]),n.useEffect(()=>{b.current=e},[e]),S}const lt=G(l.jsx("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"})),ut=G(l.jsx("path",{d:"m1.79 12 5.58 5.59L5.96 19 .37 13.41zm.45-7.78L12.9 14.89l-1.28 1.28L7.44 12l-1.41 1.41L11.62 19l2.69-2.69 4.89 4.89 1.41-1.41L3.65 2.81zm14.9 9.27L23.62 7 22.2 5.59l-6.48 6.48zM17.96 7l-1.41-1.41-3.65 3.66 1.41 1.41z"})),dt=G(l.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"})),gt=G(l.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"})),ft=({title:e,Icon:t,...a})=>l.jsxs(ie,{...a,children:[l.jsx(le,{children:l.jsx(t,{fontSize:"small"})}),l.jsx(ue,{children:e})]}),mt=(e,t)=>(a,s)=>{const c=s>0?" (".concat(s,")"):"";return"".concat(de(t[a].action[e?"single":"selected"])).concat(c)},ht=e=>(t=!1)=>e?t:!0,bt=e=>t=>e?!1:t,pt=({children:e,...t})=>l.jsx(B,{...t,sx:{minWidth:"unset",px:"10px",...t.sx},children:e}),vt=G(l.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),Ct=({children:e,onClose:t,...a})=>{const[s,c]=n.useState(!1);return l.jsx(ge,{...a,open:a.open,onClose:t,sx:{visibility:!a.open||s?"hidden":"visible"},children:e(()=>{t({},"backdropClick"),c(!1)},c)})},Ge={...Le},Be=e=>({...e,excludedScanlators:JSON.stringify(e.excludedScanlators)}),Ue=(e,t=Ge,a)=>me("manga",e,t,void 0,a),ne=(e,t,a)=>Ue({...e,meta:he(e.meta)},t,a),yt=(e,t)=>ne(e,t),Pe=(e,t)=>{const a=ne(e,t,n.useEffect);return n.useMemo(()=>a,[e,t])},qe=async(e,t,a)=>fe(e,[[t,Be({[t]:a})[t]]]),ze=(e,t=D())=>(a,s)=>qe(e,a,s).catch(t);function $e(e,{isRead:t}){switch(e){case!0:return!t;case!1:return t;default:return!0}}function He(e,{isDownloaded:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function Ve(e,{isBookmarked:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function Ye(e,{scanlator:t}){return!t||!e.includes(t)}const Ke=(e,{sortBy:t,reverse:a})=>{const s=[...e];switch(t){case"source":s.sort((c,u)=>c.sourceOrder-u.sourceOrder);break;case"fetchedAt":s.sort((c,u)=>{var i,d;return Number((i=c.fetchedAt)!=null?i:0)-Number((d=u.fetchedAt)!=null?d:0)});break;case"chapterNumber":s.sort((c,u)=>c.chapterNumber-u.chapterNumber);break;case"uploadedAt":s.sort((c,u)=>{var i,d;return Number((i=c.uploadDate)!=null?i:0)-Number((d=u.uploadDate)!=null?d:0)});break}return a&&s.reverse(),s};function Xe(e,t){return e.filter(a=>$e(t.unread,a)&&He(t.downloaded,a)&&Ve(t.bookmarked,a)&&Ye(t.excludedScanlators,a))}function xt(e,t){const a=Xe(e,t);return Ke(a,t)}const Mt=e=>{const{unread:t,downloaded:a,bookmarked:s,excludedScanlators:c}=e;return t!=null||a!=null||s!=null||!!c.length},St=e=>{const{unread:t,downloaded:a,bookmarked:s,reverse:c,sortBy:u,showChapterNumber:i,excludedScanlators:d}=Pe(e);return n.useMemo(()=>({unread:t,downloaded:a,bookmarked:s,reverse:c,sortBy:u,showChapterNumber:i,excludedScanlators:d}),[t,a,s,c,u,i,d])},Tt=(e,t=D())=>ze(e,t),We=(e,{itemIds:t=[],keyCount:a=e,currentKey:s,initialState:c={}})=>{var S;const[u,i]=n.useState(c),d=n.useRef(void 0),T=[...new Set(Object.values(u).flat())],w=T.length===e,I=!T.length,C=(S=u[s])!=null?S:[],y=C.length===a,h=C.length===0;h&&(d.current=void 0);const x=n.useCallback((o,r,{selectRange:g=!1,key:v=s}={})=>{var X;const m=!r,{id:k,key:H}=(X=d.current)!=null?X:{};d.current={id:o,key:v};const E=g&&v===H&&k!==void 0,V=E?t.indexOf(k):-1,Y=E?t.indexOf(o):-1,K=E?t.slice(Math.min(V,Y),Math.max(V,Y)+1):[o];if(m){i(_=>{var j,W;return{..._,[v]:(W=(j=_[v])==null?void 0:j.filter(se=>!K.includes(se)))!=null?W:[]}});return}i(_=>{var j;return{..._,[v]:[...new Set([...(j=_[v])!=null?j:[],...K])]}})},[s,t]),b=n.useCallback((o,r,g=s)=>{switch(o){case!0:i(v=>({...v,[g]:[...r]}));break;case!1:i(v=>({...v,[g]:[]}));break}},[s]),p=n.useCallback((o,r)=>{i(g=>({...g,[o]:[...r]}))},[]),L=n.useCallback(o=>u[o],[u]),f=n.useCallback(()=>{i({})},[]),M=n.useCallback(()=>{f(),i(c)},[f,c]);return{selectedItemIds:T,keySelectedItemIds:C,handleSelection:x,handleSelectAll:b,areAllItemsSelected:w,areNoItemsSelected:I,areAllItemsForKeySelected:y,areNoItemsForKeySelected:h,setSelectionForKey:p,getSelectionForKey:L,clearSelection:f,reset:M}},Je=0;class A{static getIds(t){return t.map(a=>a.id)}static getUserCreated(t){return t.filter(a=>a.id!==Je)}static getDefaults(t){return t.filter(a=>a.default)}}const Qe=e=>{const{data:t}=P.useGetManga(xe,e!=null?e:-1,{skip:e===void 0});return n.useMemo(()=>e===void 0||!t?[]:A.getIds(t.manga.categories.nodes),[t==null?void 0:t.manga.categories.nodes,e])},Ze=(e,t,a,s)=>{if(t.includes(e))return!0;if(!s&&a.includes(e))return!1};function et(e){const{t}=te(),{onDismiss:a,onSubmit:s,isVisible:c,onExitComplete:u,mangaId:i,mangaIds:d,addToLibrary:T=!1}=e,w=i!==void 0,I=d!=null?d:[i],[C,y]=n.useState(!1),h=Qe(i),{data:x}=P.useGetCategories(ae),b=x==null?void 0:x.categories.nodes,p=n.useMemo(()=>A.getUserCreated(b!=null?b:[]),[b]),L=n.useMemo(()=>T?A.getIds(A.getDefaults(p)):[],[p]),{handleSelection:f,setSelectionForKey:M,getSelectionForKey:S}=We(p.length,{currentKey:"categoriesToAdd",initialState:{categoriesToAdd:[...h,...L],categoriesToRemove:[]}});n.useEffect(()=>{M("categoriesToAdd",[...h,...L]),M("categoriesToRemove",[])},[h]);const o=S("categoriesToAdd"),r=S("categoriesToRemove"),g=()=>{M("categoriesToAdd",h),M("categoriesToRemove",[]),a()},v=()=>{const m=w?o.filter(E=>!h.includes(E)):o,k=w?h.filter(E=>!o.includes(E)):r;s({addToCategories:m,removeFromCategories:k}),C&&Me("showAddToLibraryCategorySelectDialog",!1).catch(E=>F(t("search.error.label.failed_to_save_settings"),"error",R(E))),(m.length||k.length)&&(T||U.performAction("change_categories",I,{changeCategoriesPatch:{addToCategories:m,removeFromCategories:k}}).catch(D()))};return l.jsxs(be,{sx:{".MuiDialog-paper":{maxHeight:435,width:"80%"}},maxWidth:"xs",open:c,onTransitionExited:u,onClose:g,children:[l.jsx(pe,{children:t("category.title.set_categories")}),l.jsx(ve,{dividers:!0,children:l.jsxs(Ae,{children:[p.length===0&&l.jsx("span",{children:t("category.error.no_categories_found.label.info")}),p.map(m=>l.jsx(ke,{checked:Ze(m.id,o,r,w),onChange:k=>{f(m.id,!1,{key:"categoriesToAdd"}),f(m.id,!1,{key:"categoriesToRemove"}),k&&f(m.id,!0,{key:"categoriesToAdd"}),k===!1&&f(m.id,!0,{key:"categoriesToRemove"})},label:m.name},m.id))]})}),l.jsx(Ce,{children:l.jsxs(q,{sx:{width:"100%"},children:[T&&l.jsx(Ee,{sx:{margin:0},size:"small",label:t("global.button.dont_show_dialog_again"),onChange:m=>y(m.target.checked)}),l.jsxs(q,{direction:"row",sx:{justifyContent:"space-between",alignItems:"end",width:"100%"},children:[l.jsx(B,{component:ye,to:oe.settings.childRoutes.categories.path,onClick:a,children:t(p.length?"global.button.edit":"global.button.create")}),l.jsxs(q,{direction:"row",children:[l.jsx(B,{autoFocus:!0,onClick:g,color:"primary",children:t("global.button.cancel")}),!!p.length&&l.jsx(B,{onClick:v,color:"primary",children:t("global.button.ok")})]})]})]})})]})}var ee;const wt=(e,t=!1)=>{var w,I;const{t:a}=te(),s=Se(),[c,u]=n.useState(!!e.inLibrary),i=n.useCallback((C=[],y=[])=>{P.updateManga(e.id,{updateManga:{inLibrary:!0},updateMangaCategories:{addToCategories:C,removeFromCategories:y}}).response.then(()=>F(a("library.info.label.added_to_library"),"success")).then(()=>u(!0)).catch(h=>{F(a("library.error.label.add_to_library"),"error",R(h))})},[e.id]),d=n.useCallback(async()=>{t&&await z.show({title:a("global.label.are_you_sure"),message:a("manga.action.library.remove.dialog.label.message",{title:e.title}),actions:{confirm:{title:a("global.button.remove")}}},{id:"manga-library-state-remove-".concat(e.id)}),await U.removeFromLibrary([e.id],!0),u(!1)},[e.id,t]);return{updateLibraryState:n.useCallback(()=>{const C=async()=>{if(c){d().catch(D());return}let y;try{y=(await we()).showAddToLibraryCategorySelectDialog}catch(S){F(a("global.error.label.failed_to_load_data"),"error",R(S));return}let h;try{h=await P.getCategories(ae).response}catch(S){F(a("category.error.label.request_failure"),"error",R(S));return}const x=A.getUserCreated(h.data.categories.nodes);let b;try{b=await U.getDuplicateLibraryMangas(e.title).response}catch(S){await z.show({title:a("global.error.label.failed_to_load_data"),message:a("manga.action.library.add.dialog.duplicate.label.failure",{error:R(S)}),actions:{extra:{show:!0,title:a("global.button.retry"),contain:!0},confirm:{title:a("global.button.add")}},onExtra:()=>C().catch(D())},{id:"manga-library-state-add-".concat(e.id)})}if((b==null?void 0:b.data.mangas.totalCount)&&await z.show({title:a("global.label.are_you_sure"),message:a("manga.action.library.add.dialog.duplicate.label.info"),actions:{extra:{show:!0,title:a("migrate.dialog.action.button.show_entry"),contain:!0},confirm:{title:a("global.button.add")}},onExtra:()=>s(oe.manga.path(b.data.mangas.nodes[0].id))},{id:"manga-library-state-add-duplicated-".concat(e.id)}),!(y&&!!x.length)){i(A.getIds(A.getDefaults(x)));return}const{addToCategories:f,removeFromCategories:M}=await Ie.show(et,{mangaId:e.id,addToLibrary:!0},{id:"manga-library-state-add-categories-".concat(e.id)});i(f,M)};C().catch(D())},[c,d,i]),isInLibrary:(I=(w=U.getFromCache(e.id,Te(ee||(ee=Q(["\n                    fragment MangaInLibraryState on MangaType {\n                        inLibrary\n                    }\n                "]))),"MangaInLibraryState"))==null?void 0:w.inLibrary)!=null?I:c}};export{pt as C,dt as D,gt as F,Ct as M,ut as R,it as V,St as a,Tt as b,wt as c,et as d,ht as e,xt as f,ft as g,lt as h,Mt as i,mt as j,bt as k,vt as l,yt as m,Xe as n,We as u};
