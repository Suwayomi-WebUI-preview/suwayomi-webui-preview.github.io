import{u as M,p as F,a as w,j as e,G as S,c as g,f as ee,I as ie,r as ce,i as de,s as ue,h as $,P as me,N as he,E as J,g as be}from"./index-Zl59rTnr.js";import{u as B,S as te,A as ge,N as pe}from"./AppbarSearch-CsotfqTa.js";import{T as fe,a as xe}from"./Tabs-MaMFqV8v.js";import{d as ye}from"./FilterList-Cm7vK8WS.js";import{C as A}from"./CheckboxInput-DqA77Hjg.js";import{S as Ce,R as O}from"./SortRadioInput-CQ7MdAfj.js";import{T as I}from"./ThreeStateCheckboxInput-wO9QFGNa.js";import{O as je,S as Se,a as ke}from"./SelectionFAB-UqmlMRzY.js";import{T as re,u as _e}from"./useManageMangaLibraryState-CawoFeDt.js";import{F as T}from"./TextField-lew-bJf8.js";import{R as Le}from"./ListPreference-B4Yqea6O.js";import{M as Te,a as we}from"./MangaGrid-sXgrtb3t.js";import{U as Me}from"./UpdateChecker-DMfFaOn7.js";import{C as Fe}from"./Checkbox-STjbDH5e.js";import{u as Ae}from"./metadataServerSettings-Bu9SBxLq.js";import{T as Ie,a as ve}from"./TabsMenu-VdEaLfXR.js";import{C as Ne}from"./Chip-DIc23AWH.js";import"./index-D03_UwGI.js";import"./StyledFab--ltFOeG8.js";import"./MenuItem-DWrnvo_k.js";import"./index-DQrhUqKj.js";import"./CardContent-RtU3w6b_.js";import"./Avatar-922Wk_ln.js";import"./InputAdornment-C6brfzM8.js";import"./SpinnerImage-DiQGN4Ou.js";import"./Collapse-NT65VyrV.js";import"./Link-DNDUF647.js";import"./NumberSetting-D95Za2Yx.js";import"./Info-CBdRtVcr.js";import"./dayjs.min-ByUHsGI2.js";import"./language-CcP_OM1B.js";import"./useMobilePicker-BrirqG1O.js";import"./SelectSetting-DVozOvvZ.js";import"./Select-BndaAxxl.js";import"./Mangas-D6kqk8_N.js";import"./Chapters-BDtuZBKt.js";import"./SwitchBase-B5dQFXOZ.js";import"./Delete-BgE5pKr0.js";import"./Sync-B5XFkS26.js";import"./PlayArrow-CEADbSL0.js";import"./Progress-BgVdFcJg.js";import"./metadata-3dsaWhfv.js";const Re={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},Oe=[["sortToRead","library.option.sort.label.by_unread_chapters"],["sortAlph","library.option.sort.label.alphabetically"],["sortDateAdded","library.option.sort.label.by_date_added"],["sortLastRead","library.option.sort.label.by_last_read"],["sortLatestFetchedChapter","library.option.sort.label.by_latest_fetched_chapter"],["sortLatestUploadedChapter","library.option.sort.label.by_latest_uploaded_chapter"]],Be=({open:r,onClose:a})=>{var h,y;const{t}=M(),{options:s,setOptions:i}=F(),c=w.useGetTrackerList(),d=re.getLoggedIn((y=(h=c.data)==null?void 0:h.trackers.nodes)!=null?y:[]),l=(b,o)=>{i(m=>({...m,[b]:o}))};return e.jsx(je,{open:r,onClose:a,tabs:["filter","sort","display"],tabTitle:b=>t(Re[b]),tabContent:b=>{if(b==="filter")return e.jsxs(e.Fragment,{children:[e.jsx(I,{label:t("global.filter.label.unread"),checked:s.unread,onChange:o=>l("unread",o)}),e.jsx(I,{label:t("global.filter.label.downloaded"),checked:s.downloaded,onChange:o=>l("downloaded",o)}),e.jsx(I,{label:t("global.filter.label.bookmarked"),checked:s.bookmarked,onChange:o=>l("bookmarked",o)}),e.jsx(T,{sx:{mt:2},children:t("global.filter.label.tracked")}),d.map(o=>e.jsx(I,{label:o.name,checked:s.tracker[o.id],onChange:m=>l("tracker",{...s.tracker,[o.id]:m})},o.id))]});if(b==="sort")return Oe.map(([o,m])=>e.jsx(Ce,{label:t(m),checked:s.sorts===o,sortDescending:s.sortDesc,onClick:()=>o!==s.sorts?l("sorts",o):l("sortDesc",!s.sortDesc)},o));if(b==="display"){const{gridLayout:o,showContinueReadingButton:m,showDownloadBadge:u,showUnreadBadge:k,showTabSize:_}=s;return e.jsxs(e.Fragment,{children:[e.jsx(T,{children:t("global.grid_layout.title")}),e.jsxs(Le,{onChange:v=>l("gridLayout",Number(v.target.value)),value:o,children:[e.jsx(O,{label:t("global.grid_layout.label.compact_grid"),value:S.Compact,checked:o==null||o===S.Compact}),e.jsx(O,{label:t("global.grid_layout.label.comfortable_grid"),value:S.Comfortable,checked:o===S.Comfortable}),e.jsx(O,{label:t("global.grid_layout.label.list"),value:S.List,checked:o===S.List})]}),e.jsx(T,{sx:{mt:2},children:t("library.option.display.badge.title")}),e.jsx(A,{label:t("library.option.display.badge.label.unread_badges"),checked:k,onChange:()=>l("showUnreadBadge",!k)}),e.jsx(A,{label:t("library.option.display.badge.label.download_badges"),checked:u,onChange:()=>l("showDownloadBadge",!u)}),e.jsx(T,{sx:{mt:2},children:t("library.option.display.tab.title")}),e.jsx(A,{label:t("library.option.display.tab.label.show_number_of_items"),checked:_,onChange:()=>l("showTabSize",!_)}),e.jsx(T,{sx:{mt:2},children:t("global.label.other")}),e.jsx(A,{label:t("library.option.display.other.label.show_continue_reading_button"),checked:m,onChange:()=>l("showContinueReadingButton",!m)})]})}return null}})},Pe=()=>{const{t:r}=M(),[a,t]=g.useState(!1),{options:s}=F(),i=s.downloaded!=null||s.unread!=null||Object.values(s.tracker).some(c=>c!=null);return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:r("settings.title"),children:e.jsx(ie,{onClick:()=>t(!a),color:i?"warning":"default",children:e.jsx(ye,{})})}),e.jsx(Be,{open:a,onClose:()=>t(!1)})]})},X=({showFilteredOutMessage:r,message:a,messageExtra:t,...s})=>{const{t:i}=M(),[c]=B("query",te),{options:d}=F(),{unread:l,downloaded:h}=d;return g.useEffect(()=>{window.scrollTo(0,0)},[c,l,h]),e.jsx(Te,{...s,hasNextPage:!1,loadMore:()=>{},message:r?i("library.error.label.no_matches"):a,messageExtra:r?void 0:t,gridLayout:d.gridLayout})};var P={},De=de;Object.defineProperty(P,"__esModule",{value:!0});var ae=P.default=void 0,Ee=De(ce()),Ge=e;ae=P.default=(0,Ee.default)((0,Ge.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");const Ue=({isActive:r,areAllItemsSelected:a,areNoItemsSelected:t,onSelectAll:s,onModeChange:i})=>{const{t:c}=M();return e.jsxs(e.Fragment,{children:[r&&e.jsx(Se,{areAllItemsSelected:a,areNoItemsSelected:t,onChange:s}),e.jsx(ee,{title:c(r?"global.button.cancel":"global.button.select_all"),children:e.jsx(Fe,{checkedIcon:e.jsx(ae,{}),sx:{padding:"8px"},checked:r,onChange:(d,l)=>i(l)})})]})},ze=(r,{unreadCount:a})=>{switch(r){case!0:return!!a&&a>=1;case!1:return a===0;default:return!0}},qe=(r,{downloadCount:a})=>{switch(r){case!0:return!!a&&a>=1;case!1:return a===0;default:return!0}},Ke=(r,{bookmarkCount:a})=>{switch(r){case!0:return!!a&&a>=1;case!1:return a===0;default:return!0}},Qe=(r,{title:a})=>r?a.toLowerCase().includes(r.toLowerCase()):!0,We=(r,{genre:a})=>r?r.split(",").map(s=>s.toLowerCase().trim()).every(s=>a.map(i=>i.toLowerCase()).includes(s)):!0,Ve=(r,a)=>Object.entries(r).map(([t,s])=>{const c=re.getTrackers(a.trackRecords.nodes).some(d=>d.id===Number(t));switch(s){case!0:return c;case!1:return!c;default:return!0}}).every(t=>t),He=(r,a,t,s,i,c,d)=>r.filter(l=>{const h=d&&(a==null?void 0:a.length),y=Qe(a,l)||We(a,l),b=h||qe(s,l)&&ze(t,l)&&Ke(i,l)&&Ve(c,l);return y&&b}),$e=(r,a)=>{var t,s;return((t=r.unreadCount)!=null?t:0)-((s=a.unreadCount)!=null?s:0)},Je=(r,a)=>r.title.localeCompare(a.title),Xe=(r,a)=>Number(r.inLibraryAt)-Number(a.inLibraryAt),Ye=(r,a)=>{var t,s,i,c;return Number((s=(t=a.lastReadChapter)==null?void 0:t.lastReadAt)!=null?s:0)-Number((c=(i=r.lastReadChapter)==null?void 0:i.lastReadAt)!=null?c:0)},Ze=(r,a)=>{var t,s,i,c;return Number((s=(t=r.latestUploadedChapter)==null?void 0:t.fetchedAt)!=null?s:0)-Number((c=(i=a.latestUploadedChapter)==null?void 0:i.fetchedAt)!=null?c:0)},et=(r,a)=>{var t,s,i,c;return Number((s=(t=r.latestFetchedChapter)==null?void 0:t.fetchedAt)!=null?s:0)-Number((c=(i=a.latestFetchedChapter)==null?void 0:i.fetchedAt)!=null?c:0)},tt=(r,a,t)=>{const s=[...r];switch(a){case"sortAlph":s.sort(Je);break;case"sortDateAdded":s.sort(Xe);break;case"sortToRead":s.sort($e);break;case"sortLastRead":s.sort(Ye);break;case"sortLatestUploadedChapter":s.sort(Ze);break;case"sortLatestFetchedChapter":s.sort(et);break}return t===!0&&s.reverse(),s},rt=r=>{const[a]=B("query",te),{options:t}=F(),{unread:s,downloaded:i,bookmarked:c,tracker:d}=t,{settings:l}=Ae(),h=g.useMemo(()=>He(r,a,s,i,c,d,l.ignoreFilters),[r,a,s,i,c,d,l.ignoreFilters]),y=g.useMemo(()=>tt(h,t.sorts,t.sortDesc),[h,t.sorts,t.sortDesc]),b=Object.values(t.tracker).some(m=>m!=null),o=(s!=null||i!=null||c!=null||!!a||b)&&h.length===0&&r.length>0;return{visibleMangas:y,showFilteredOutMessage:o}},Y=ue("span")({display:"flex",alignItems:"center"}),Z=r=>e.jsx(Ne,{...r,size:"small",sx:{marginLeft:"5px"}});function Qt(){var V,H;const{t:r}=M(),{options:a}=F(),{data:t,error:s,loading:i,refetch:c}=w.useGetCategories({notifyOnNetworkStatusChange:!0}),d=t==null?void 0:t.categories.nodes.filter(n=>n.id!==0||n.id===0&&n.mangas.totalCount),l=d!=null?d:[],h=g.useMemo(()=>l.map(n=>n.mangas.totalCount).reduce((n,p)=>n+p,0),[l]),[y,b]=B("tab",pe),o=(V=l.find(n=>n.order===y))!=null?V:l[0],{data:m,error:u,loading:k,refetch:_}=w.useGetCategoryMangas(o==null?void 0:o.id,{skip:!o,notifyOnNetworkStatusChange:!0}),v=(H=m==null?void 0:m.mangas.nodes)!=null?H:[],{visibleMangas:f,showFilteredOutMessage:D}=rt(v),E=g.useCallback(()=>_().catch($()),[_,o]),se=g.useMemo(()=>f.map(n=>n.id),[f]),[C,N]=g.useState(!1),{areNoItemsForKeySelected:G,areAllItemsForKeySelected:U,selectedItemIds:j,handleSelectAll:R,handleSelection:oe,clearSelection:le}=_e(f.length,{itemIds:se,currentKey:o==null?void 0:o.id.toString()}),z=(n,p,x)=>{N(!!(j.length+(p?1:-1))),oe(n,p,x)},q=g.useMemo(()=>j.map(n=>w.graphQLClient.client.cache.readFragment({id:w.graphQLClient.client.cache.identify({__typename:"MangaType",id:n}),fragment:me,fragmentName:"PARTIAL_MANGA_FIELDS"})),[j.length,f]),K=g.useMemo(()=>C?e.jsx(ke,{selectedItemsCount:j.length,title:"manga.title",children:(n,p)=>e.jsx(we,{selectedMangas:q,onClose:x=>{n(),N(x),x||le()},setHideMenu:p})}):null,[C,q]),{setTitle:Q,setAction:W}=g.useContext(he);g.useEffect(()=>{const n=r("library.title"),p=e.jsxs(Y,{children:[n,a.showTabSize&&e.jsx(Z,{label:h})]});return Q(p,n),W(e.jsxs(e.Fragment,{children:[!C&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{}),e.jsx(Pe,{}),e.jsx(Me,{})]}),e.jsx(Ue,{isActive:C,areAllItemsSelected:U,areNoItemsSelected:G,onSelectAll:x=>R(x,[...new Set(f.map(L=>L.id))]),onModeChange:x=>{N(x),x?R(!0,[...new Set(f.map(L=>L.id))]):l.forEach(L=>R(!1,[],L.id.toString()))}})]})),()=>{Q(""),W(null)}},[r,h,i,a,C,G,U,j.length,f.length]);const ne=n=>{b(n)};return s!=null?e.jsx(J,{message:r("category.error.label.request_failure"),messageExtra:s.message,retry:()=>c().catch($())}):i?e.jsx(be,{}):l.length===0?e.jsx(J,{message:r("library.error.label.empty")}):l.length===1?e.jsxs(e.Fragment,{children:[e.jsx(X,{mangas:f,message:r(u?"manga.error.label.request_failure":"library.error.label.empty"),messageExtra:u==null?void 0:u.message,isLoading:k,selectedMangaIds:j,isSelectModeActive:C,handleSelection:z,showFilteredOutMessage:!u&&D,retry:u&&E}),K]}):e.jsxs(Ie,{children:[e.jsx(ve,{value:o.order,onChange:(n,p)=>ne(p),tabsCount:l.length,children:l.map(n=>e.jsx(fe,{sx:{display:"flex"},label:e.jsxs(Y,{children:[n.name,a.showTabSize?e.jsx(Z,{label:n.mangas.totalCount}):null]}),value:n.order},n.id))}),l.map(n=>e.jsx(xe,{index:n.order,currentIndex:o.order,children:n===o&&e.jsx(X,{mangas:f,message:r(u?"manga.error.label.request_failure":"library.error.label.empty"),messageExtra:u==null?void 0:u.message,isLoading:k,selectedMangaIds:j,isSelectModeActive:C,handleSelection:z,showFilteredOutMessage:!u&&D,retry:u&&E})},n.order)),K]})}export{Qt as Library};
