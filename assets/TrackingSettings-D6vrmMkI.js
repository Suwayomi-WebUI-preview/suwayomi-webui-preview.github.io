import{bV as w,bW as A,a1 as M,f as u,bX as R,bY as F,j as t,a_ as P,bZ as U,u as y,c as I,ae as E,aP as N,af as D,az as L,b_ as W,an as $,ao as O,aI as V,aJ as q,aZ as B,b$ as G,aL as J,e as C,n as j,N as K,q as Z,Q as z,E as H,m as T,l as Q,v as k,aK as S,aV as X,y as Y}from"./index-CsKI2UB9.js";import{T as x}from"./Trackers-D4pSmk7a.js";import{A as ee}from"./Avatar-DwatiGVC.js";import{C as te}from"./Chip-CghheuL1.js";import{S as _}from"./Switch-BSAm-ui8.js";function se(e){return w("MuiListItemAvatar",e)}A("MuiListItemAvatar",["root","alignItemsFlexStart"]);const ae=e=>{const{alignItems:s,classes:n}=e;return U({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},se,n)},ne=M("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[s.root,n.alignItems==="flex-start"&&s.alignItemsFlexStart]}})({minWidth:56,flexShrink:0,variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}),re=u.forwardRef(function(s,n){const o=R({props:s,name:"MuiListItemAvatar"}),{className:m,...r}=o,h=u.useContext(F),i={...o,alignItems:h.alignItems},l=ae(i);return t.jsx(ne,{className:P(l.root,m),ownerState:i,ref:n,...r})}),ie=({tracker:e})=>{const{t:s}=y(),[n,{loading:o}]=I.useLoginToTrackerCredentials(),[m]=I.useLogoutFromTracker(),[r,h]=u.useState(""),[i,l]=u.useState(""),g=!e.isLoggedIn&&!!e.authUrl,f=async()=>{try{await m({variables:{trackerId:e.id}})}catch(a){j(s("tracking.action.logout.label.failure",{name:e.name}),"error")}},p=async()=>{if(g){const a={redirectUrl:"".concat(window.location.origin,"/tracker/login/oauth"),clientName:"Suwayomi-WebUI",trackerId:e.id,trackerName:e.name};window.open("".concat(e.authUrl,"&state=").concat(JSON.stringify(a)),"_self");return}try{await n({variables:{input:{trackerId:e.id,username:r,password:i}}})}catch(a){j(s("tracking.action.login.label.failure",{name:e.name}),"error")}},b=a=>{if(!g){a();return}p()};return t.jsx(E,{variant:"popover",popupId:"tracker-dialog",children:a=>t.jsxs(t.Fragment,{children:[t.jsxs(N,{...D(a),onClick:()=>b(a.open),onTouchStart:()=>b(a.open),children:[t.jsx(re,{sx:{paddingRight:"20px"},children:t.jsx(ee,{alt:"".concat(e.name),src:I.getValidImgUrlFor(e.icon),variant:"rounded",sx:{width:64,height:64}})}),t.jsx(L,{primary:e.name}),x.isLoggedIn(e)&&t.jsx(W,{children:t.jsx(te,{label:s("global.label.logged_in"),color:"success"})})]}),t.jsxs($,{...O(a),open:(x.isLoggedIn(e)||!e.authUrl)&&a.isOpen,disableRestoreFocus:!0,children:[t.jsx(V,{children:s(x.isLoggedIn(e)?"tracking.settings.dialog.title.log_out":"tracking.settings.dialog.title.log_in",{name:e.name})}),!g&&!e.isLoggedIn&&t.jsxs(q,{children:[t.jsx(B,{autoFocus:!0,margin:"dense",id:"username",name:"username",label:s("global.label.username"),type:"text",fullWidth:!0,variant:"standard",onChange:d=>h(d.target.value)}),t.jsx(G,{margin:"dense",fullWidth:!0,variant:"standard",onChange:d=>l(d.target.value)})]}),t.jsxs(J,{children:[t.jsx(C,{onClick:a.close,children:s("global.button.cancel")}),t.jsx(C,{variant:"contained",disabled:!g&&!e.isLoggedIn&&(o||!r.length||!i.length),onClick:()=>x.isLoggedIn(e)?f():p(),children:s(x.isLoggedIn(e)?"global.button.log_out":"global.button.log_in")})]})]})]})})},ue=()=>{var v;const{t:e}=y(),{setTitle:s}=u.useContext(K);u.useLayoutEffect(()=>{s(e("tracking.settings.title.settings"))},[e]);const{settings:{updateProgressAfterReading:n,updateProgressManualMarkRead:o},loading:m,request:{error:r,refetch:h}}=Z(),i=Y(()=>j(e("global.error.label.failed_to_save_changes"),"error")),{data:l,loading:g,error:f,refetch:p}=I.useGetTrackerList(z,{notifyOnNetworkStatusChange:!0}),b=(v=l==null?void 0:l.trackers.nodes)!=null?v:[],a=m||g,d=r!=null?r:f;return d?t.jsx(H,{message:e("global.error.label.failed_to_load_data"),messageExtra:d.message,retry:()=>{r&&h().catch(T()),f&&p().catch(T())}}):a?t.jsx(Q,{}):t.jsxs(t.Fragment,{children:[t.jsxs(k,{sx:{pt:0},children:[t.jsxs(S,{children:[t.jsx(L,{primary:e("tracking.settings.label.update_progress_reading")}),t.jsx(_,{edge:"end",checked:n,onChange:c=>i("updateProgressAfterReading",c.target.checked)})]}),t.jsxs(S,{children:[t.jsx(L,{primary:e("tracking.settings.label.update_progress_manual"),secondary:e("tracking.settings.label.update_progress_reading_description")}),t.jsx(_,{edge:"end",checked:o,onChange:c=>i("updateProgressManualMarkRead",c.target.checked)})]})]}),t.jsx(k,{subheader:t.jsx(X,{component:"div",id:"tracking-trackers",children:e("tracking.settings.title.trackers")}),children:b.map(c=>t.jsx(ie,{tracker:c},c.id))})]})};export{ue as TrackingSettings};
