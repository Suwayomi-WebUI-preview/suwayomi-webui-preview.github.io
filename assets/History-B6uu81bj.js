import{i as n,j as e,C as j,a as I,ag as g,A as R,L as w,b as E,B as T,bO as G,bQ as L,b9 as M,R as O,u as P,g as S,r as v,E as h,n as A,o as U,T as k,m as B}from"./index-Bz3VJLLH.js";import{V as i,a as F,S as N,b as _}from"./Virtuoso.util-D6YwAqjZ.js";import{C as V,a as D,b as K}from"./ChapterDownloadRetryButton-CRGHHekn.js";import"./Avatar-C-nH7vkf.js";const $=n.memo(({chapter:t})=>{const{manga:r}=t;return e.jsx(j,{children:e.jsx(I,{component:w,to:R.reader.path(t.manga.id,t.sourceOrder),state:g.getReaderOpenChapterLocationState(t),sx:{color:a=>a.palette.text[t.isRead?"disabled":"primary"]},children:e.jsxs(E,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5},children:[e.jsxs(T,{sx:{display:"flex",flexGrow:1},children:[e.jsx(V,{mangaId:r.id,mangaTitle:r.title,thumbnailUrl:r.thumbnailUrl,thumbnailUrlLastFetched:r.thumbnailUrlLastFetched}),e.jsx(G,{title:r.title,secondaryText:"".concat(t.name," â€” ").concat(L.format(M(Number(t.lastReadAt)).valueOf()))})]}),e.jsx(O,{chapterId:t.id}),e.jsx(D,{chapterId:t.id}),e.jsx(K,{chapterId:t.id,isDownloaded:t.isDownloaded})]})})})}),z=()=>{var p;const{t}=P(),{setTitle:r}=S(),{data:a,loading:l,error:u,fetchMore:x,refetch:C}=v.useGetRecentlyReadChapters(void 0,{fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),c=!!(a!=null&&a.chapters.pageInfo.hasNextPage),f=a==null?void 0:a.chapters.pageInfo.endCursor,o=(p=a==null?void 0:a.chapters.nodes)!=null?p:[],d=n.useMemo(()=>Object.entries(g.groupByDate(o,"lastReadAt")),[o]),m=n.useMemo(()=>d.map(s=>s[i.ITEMS].length),[d]),b=i.useCreateGroupedComputeItemKey(m,n.useCallback(s=>d[s][i.GROUP],[d]),n.useCallback(s=>o[s].id,[o]));n.useLayoutEffect(()=>(r(t("history.title")),()=>{r("")}),[t]);const y=n.useCallback(()=>{c&&x({variables:{offset:o.length}})},[c,f]);return u?e.jsx(h,{message:t("global.error.label.failed_to_load_data"),messageExtra:A(u),retry:()=>C().catch(U())}):!l&&o.length===0?e.jsx(h,{message:t("history.error.label.no_history_available")}):e.jsx(F,{style:{height:"undefined"},components:{Footer:()=>l?e.jsx(B,{usePadding:!0}):null},overscan:window.innerHeight*.5,endReached:y,groupCounts:m,groupContent:s=>e.jsx(_,{isFirstItem:s===0,children:e.jsx(k,{variant:"h5",component:"h2",children:d[s][i.GROUP]})}),computeItemKey:b,itemContent:s=>e.jsx(N,{children:e.jsx($,{chapter:o[s]})})})};export{z as History};
