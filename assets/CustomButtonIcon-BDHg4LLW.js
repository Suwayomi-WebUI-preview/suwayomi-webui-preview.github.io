import{c as T,j as e,u as S,r as W,ab as q,a as Q,b as w,a1 as l,dd as Z,f as J,ag as X,aa as z,a7 as Y,S as _,ap as j,L as ee,dZ as te,C as E,I as ae,a5 as re,a9 as oe,w as U,T as se,B as ne}from"./index-uuLFyWjH.js";import{c as le,d as C,C as ie,e as de,f as ce,D as me,R as pe,V as he,g as xe,M as ue}from"./useManageMangaLibraryState-BsZvXNpP.js";import{C as Ce,D as ke}from"./ChapterCardMetadata-DpBNY9qB.js";import{D as ge}from"./Delete-CT9ozx7M.js";import{D as be}from"./Download-BoRIdzjV.js";import{D as fe}from"./DoneAll-CPaoUM4v.js";import{M as Ie}from"./MUI.util-CYBuX_Wz.js";import{L as je}from"./ListCardContent-DmDL0s6p.js";import{C as Me}from"./Card-BMGU0hB5.js";import{C as ye}from"./CardActionArea-BVD5k2pE.js";import{C as De}from"./Checkbox-rBalqFKJ.js";const we=T(e.jsx("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"})),_e=T(e.jsx("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"})),Te=T(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),ve=({chapter:t,handleSelection:s,canBeDownloaded:o=!1,selectedChapters:d=[],onClose:c,selectable:i=!0})=>{var P,V,L;const{t:a}=S(),m=!!t,{isDownloaded:I,isRead:p,isBookmarked:M}=t!=null?t:{},b=(L=(V=W.useGetMangaChapters(q,(P=t==null?void 0:t.mangaId)!=null?P:-1,{skip:!t,fetchPolicy:"cache-only"}).data)==null?void 0:V.chapters.nodes)!=null?L:[],{settings:{deleteChaptersWithBookmark:y}}=Q(),h=de(m,Z),x=le(m),g=ce(m),{downloadableChapters:r,downloadedChapters:n,unbookmarkedChapters:u,bookmarkedChapters:v,unreadChapters:R,readChapters:B}=w.useMemo(()=>({downloadableChapters:l.getDownloadable(d),downloadedChapters:l.getDownloaded(d),unbookmarkedChapters:l.getNonBookmarked(d),bookmarkedChapters:l.getBookmarked(d),unreadChapters:l.getNonRead(d),readChapters:l.getRead(d)}),[d]),$=()=>{s==null||s(t.id,!0),c()},f=(N,F)=>{var O;const G=N==="mark_prev_as_read",H=G?"mark_as_read":N;if(H==="delete"&&t&&!l.isDeletable(t,y)){c();return}const D=(()=>{if(!t)return F;if(!G)return[t];const A=b.findIndex(({id:K})=>K===t.id);return A+1>b.length-1?[]:b.slice(A+1)})();if(!D.length){c();return}l.performAction(H,l.getIds(D),{chapters:D,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(O=D[0])==null?void 0:O.mangaId}).catch(J()),c()};return e.jsxs(e.Fragment,{children:[m&&i&&e.jsx(C,{onClick:$,Icon:ie,title:a("chapter.action.label.select")}),m&&e.jsx(C,{Icon:Te,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),c()},title:a("chapter.action.label.open_on_source")}),x(o)&&e.jsx(C,{Icon:be,disabled:g(!r.length),onClick:()=>f("download",r),title:h("download",r.length)}),x(I)&&e.jsx(C,{Icon:ge,disabled:g(!n.length),onClick:()=>f("delete",l.getDeletable(n,y)),title:h("delete",n.length)}),x(!M)&&e.jsx(C,{Icon:_e,disabled:g(!u.length),onClick:()=>f("bookmark",u),title:h("bookmark",u.length)}),x(M)&&e.jsx(C,{Icon:we,disabled:g(!v.length),onClick:()=>f("unbookmark",v),title:h("unbookmark",v.length)}),x(!p)&&e.jsx(C,{Icon:me,disabled:g(!R.length),onClick:()=>f("mark_as_read",R),title:h("mark_as_read",R.length)}),x(p)&&e.jsx(C,{Icon:pe,disabled:g(!B.length),onClick:()=>f("mark_as_unread",B),title:h("mark_as_unread",B.length)}),m&&e.jsx(C,{onClick:()=>f("mark_prev_as_read",[]),Icon:fe,title:a("chapter.action.mark_as_read.add.label.action.previous")})]})},Re=T(e.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"})),Be=w.memo(t=>{const{t:s}=S(),o=X(),d=z.usePreventMobileContextMenu(),c=w.useRef(null),{mode:i="manga.page",chapter:a,showChapterNumber:m,onSelect:I,selected:p,selectable:M=!0,isActiveChapter:k=!1}=t,b=p!==null,{isDownloaded:y}=a,h=r=>{b&&(r.preventDefault(),r.stopPropagation(),I(a.id,!p,r.shiftKey))},x=(r,n)=>{r.stopPropagation(),r.preventDefault(),n==null||n(r)},g=he((r,{context:n})=>{if(!b&&c.current){x(r,()=>n==null?void 0:n(c.current));return}r.shiftKey=!0,h(r)});return e.jsx(Y,{variant:"popover",popupId:"chapter-card-action-menu",children:r=>{var n;return e.jsxs(_,{sx:{pt:1,px:1},children:[e.jsx(Me,{sx:{...j(i==="reader"&&k,{backgroundColor:"primary.main"})},children:e.jsx(ye,{component:ee,to:l.getReaderUrl(a),onContextMenu:d,sx:z.preventMobileContextMenuSx(),style:{color:o.palette.text[a.isRead?"disabled":"primary"]},state:l.getReaderOpenChapterLocationState(a,!0),replace:i==="reader",onClick:u=>h(u),...g(r.open),children:e.jsxs(je,{children:[e.jsx(Ce,{title:m?"".concat(s("chapter.title_one")," ").concat(a.chapterNumber):a.name,secondaryText:a.scanlator,ternaryText:"".concat(te(Number((n=a.uploadDate)!=null?n:0),!0)).concat(y?" â€¢ ".concat(s("chapter.status.label.downloaded")):""),infoIcons:a.isBookmarked&&e.jsx(Re,{color:i==="reader"&&k?"secondary":"primary"}),slotProps:{title:{variant:"h6",component:"h3",sx:j(i==="reader"&&k,{color:o.palette.primary.contrastText})},secondaryText:{sx:j(i==="reader"&&k,{color:o.palette.primary.contrastText})},ternaryText:{sx:j(i==="reader"&&k,{color:o.palette.primary.contrastText})}}}),e.jsx(ke,{chapterId:a.id,color:i==="reader"&&k?o.palette.primary.contrastText:void 0}),e.jsx(_,{sx:{minHeight:"48px"},children:p===null?e.jsx(E,{title:s("global.button.options"),children:e.jsx(ae,{ref:c,...Ie.preventRippleProp(re(r),{onClick:u=>x(u)}),"aria-label":"more",sx:{color:"inherit",...j(i==="reader"&&k,{color:"primary.contrastText"})},children:e.jsx(xe,{})})}):e.jsx(E,{title:s(p?"global.button.deselect":"global.button.select"),children:e.jsx(De,{checked:p})})})]})})}),!b&&r.isOpen&&e.jsx(ue,{...oe(r),children:u=>e.jsx(ve,{onClose:u,chapter:a,handleSelection:()=>I(a.id,!0),canBeDownloaded:l.isDownloadable(a),selectable:M})})]})}})}),Ae=({missingChaptersGap:t})=>{const{t:s}=S();return e.jsxs(_,{sx:{width:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",p:2,pt:3.5,pb:2.5},children:[e.jsx(U,{sx:{flexGrow:1,border:"1px solid",borderColor:o=>o.palette.text.secondary}}),e.jsx(se,{sx:{px:2},variant:"body2",color:"textSecondary",children:s("chapter.missing",{count:t})}),e.jsx(U,{sx:{flexGrow:1,border:"1px solid",borderColor:o=>o.palette.text.secondary}})]})},Ke=({index:t,isSortDesc:s,chapters:o,...d})=>{var p;const c=s?t+1:t-1,i=o[t],a=(p=o[c])!=null?p:{chapterNumber:0},m=l.getGap(i,a),I=m>0;return e.jsxs(_,{sx:j(!s,{flexDirection:"column-reverse"}),children:[e.jsx(Be,{...d,chapter:o[t]}),I&&e.jsx(Ae,{missingChaptersGap:m})]})},We=w.forwardRef(({children:t,...s},o)=>e.jsx(ne,{ref:o,...s,sx:{minWidth:"unset",px:"10px",...s.sx},children:t}));export{Re as B,Ke as C,Te as L,ve as a,We as b};
