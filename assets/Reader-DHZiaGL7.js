import{cQ as Es,b as d,cR as ft,cS as We,cL as L,j as s,i as Wt,ay as m,n as Ft,cT as Js,cU as U,cV as rt,y as $e,cW as Lt,cX as we,cY as Ne,cZ as Qs,c_ as ct,c$ as Ut,S as B,x as Y,T as et,aX as er,d0 as tr,aZ as sr,co as Nt,a1 as Xe,aa as $t,d1 as Se,C as F,d2 as Ts,d3 as le,J as Ye,d4 as V,bW as ce,d5 as Te,d6 as rr,a as nr,cz as or,d7 as ar,d8 as ir,d9 as cr,cA as lr,ap as nt,da as Qt,an as tt,db as es,dc as js,bx as gt,A as Xt,L as Dt,c as Re,u as G,c3 as Cs,dd as ws,aD as ht,a3 as jt,a4 as Ct,c5 as dr,au as ur,B as st,de as gr,df as ts,dg as As,dh as Gt,di as Os,dj as hr,dk as fr,dl as ss,dm as Ls,dn as pt,dp as ke,dq as it,dr as Me,s as Ds,I as te,a2 as ze,ce as zt,ds as He,dt as Is,r as xt,c4 as xr,aK as pr,bh as mr,e as It,aU as vr,du as Yt,a7 as Sr,a8 as Rr,m as Bs,dv as ut,dw as Bt,ao as rs,dx as _t,dy as br,dz as Mt,dA as Er,dB as wt,dC as Tr,dD as _s,bl as jr,dE as je,b6 as ye,dF as Cr,dG as Ce,dH as Ve,dI as wr,dJ as Ps,dK as Ar,dL as Or,dM as vt,dN as Lr,dO as Dr,f as bt,dP as Ir,dQ as Br,g as ys,dR as ks,dS as Ns,dT as _r,dU as Pr,aG as Ms,dV as ns,M as os,dW as yr,dX as kr,dY as dt,dZ as J,d_ as St,d$ as as,bk as Nr,e0 as Et,e1 as Mr,e2 as Hr,e3 as is,e4 as Vr,e5 as Wr,d as Fr,e6 as Ur,e7 as Gr,aF as zr,e8 as $r,e9 as Xr,ea as Yr}from"./index-BaWGPKM1.js";import{R as Zr,S as Kr,D as qr,a as Jr,b as Qr,c as en}from"./ReaderSettingsTabs-CDXXHKEs.js";import{P as tn}from"./PushPin-Cl8HODun.js";import{P as sn}from"./PushPinOutlined-DXC1suNx.js";import{L as Tt}from"./Link-3LuJ9p-8.js";import{S as Hs}from"./Select-DLmYQD6I.js";import{C as Vs,c as rn,F as nn,l as on,n as an,a as cn}from"./useManageMangaLibraryState-DqaL4c0x.js";import{a as Ws,I as Fs,T as ln}from"./TextField-BN48zilc.js";import{j as dn}from"./index-AREapRdO.js";import{C as un,B as gn,I as hn,b as fn}from"./ChapterListCard-B52tuA49.js";import{I as xn}from"./InputAdornment-DUmF6IzA.js";import{D as pn}from"./Download-7ioTnZwO.js";import{D as mn}from"./Delete-DcB8xZPK.js";import{D as vn}from"./ChapterCardMetadata-CTrt7JB_.js";import{F as Sn}from"./Favorite-tp6yWAPm.js";import{C as Rn}from"./CheckboxInput-BsIMPbzt.js";import{E as At}from"./EmptyViewAbsoluteCentered-DnPdpgR5.js";import{u as bn}from"./use-window-event-B8If6RTA.js";import{u as En}from"./use-merged-ref-CobR9ZG_.js";import{u as Tn}from"./useAppTitle-Dcm0LIbe.js";import"./TabsMenu-BDBJ-_iZ.js";import"./Tabs-Be6Woi3f.js";import"./Trans-BCkbobz4.js";import"./Slider-uTVoD1Yh.js";import"./ListSubheader-Bki3TE8H.js";import"./Add-CNAcr3vY.js";import"./ThreeStateCheckboxInput-4-JX7UgI.js";import"./Checkbox-DAfp49Nu.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-DbCOf7iq.js";import"./SwitchBase-CKrmdXP1.js";import"./FormGroup-Du6-GYhS.js";import"./DoneAll-D65iiGBU.js";import"./MUI.util-CEodEA2f.js";import"./ListCardContent-C-BKbxXo.js";import"./Card-5WTePYpb.js";import"./CardActionArea-8d4Iz1a4.js";const jn=e=>{const{activeScopes:r,enableScope:n,disableScope:o}=Es(),t=d.useRef([]);d.useEffect(()=>e?(t.current=[...r],n(ft.NONE),t.current.forEach(o),()=>{o(ft.NONE),t.current.forEach(n)}):()=>{},[e])},Cn=({isOpen:e,close:r})=>{const{manga:n}=We(),o=L.useSettings();jn(e);const[t,a]=d.useState(0),[l,c]=d.useState(!1);return!n||!e?null:s.jsx(Wt,{open:e,maxWidth:"md",fullWidth:!0,onClose:r,hideBackdrop:t===Js.FILTER,sx:{...m(l,{opacity:.75})},children:s.jsx(Ft,{sx:{p:0},children:s.jsx(Zr,{activeTab:t,setActiveTab:a,settings:o,updateSetting:(...i)=>L.updateSetting(n,...i),deleteSetting:(...i)=>L.deleteSetting(n,...i),setTransparent:c})})})},wn=({isDesktop:e,scrollbarXSize:r,readerNavBarWidth:n,isMaximized:o,currentPageIndex:t,pages:a,totalPages:l,progressBarType:c,shouldShowPageNumber:i,readingDirection:f})=>{const u=d.useMemo(()=>{const h=Ne(t,a).name,g="/",p="".concat(h).concat(g).concat(l);return f===ct.LTR?p:Qs(p,g)},[t,a,l,f]);return!i||o||e&&c===Ut.STANDARD||o&&c===Ut.HIDDEN?null:s.jsx(B,{sx:{position:"fixed",left:n,right:0,bottom:h=>"max(calc(".concat(h.spacing(1)," + ").concat(r,"px), env(safe-area-inset-bottom))"),alignItems:"center",transition:h=>"left 0.".concat(h.transitions.duration.shortest,"s")},children:s.jsx(Y,{sx:{p:.5,borderRadius:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:s.jsx(et,{sx:{color:"white"},children:u})})})},An=U(wn,[L.useOverlayMode,rt,$e,Lt,we,L.useSettingsWithoutDefaultFlag],["isDesktop","scrollbarXSize","readerNavBarWidth","isMaximized","currentPageIndex","pages","totalPages","progressBarType","shouldShowPageNumber","readingDirection"]);function cs(e){return e.substring(2).toLowerCase()}function On(e,r){return r.documentElement.clientWidth<e.clientX||r.documentElement.clientHeight<e.clientY}function Ln(e){const{children:r,disableReactTree:n=!1,mouseEvent:o="onClick",onClickAway:t,touchEvent:a="onTouchEnd"}=e,l=d.useRef(!1),c=d.useRef(null),i=d.useRef(!1),f=d.useRef(!1);d.useEffect(()=>(setTimeout(()=>{i.current=!0},0),()=>{i.current=!1}),[]);const u=er(tr(r),c),h=sr(x=>{const S=f.current;f.current=!1;const v=Nt(c.current);if(!i.current||!c.current||"clientX"in x&&On(x,v))return;if(l.current){l.current=!1;return}let C;x.composedPath?C=x.composedPath().includes(c.current):C=!v.documentElement.contains(x.target)||c.current.contains(x.target),!C&&(n||!S)&&t(x)}),g=x=>S=>{f.current=!0;const v=r.props[x];v&&v(S)},p={ref:u};return a!==!1&&(p[a]=g(a)),d.useEffect(()=>{if(a!==!1){const x=cs(a),S=Nt(c.current),v=()=>{l.current=!0};return S.addEventListener(x,h),S.addEventListener("touchmove",v),()=>{S.removeEventListener(x,h),S.removeEventListener("touchmove",v)}}},[h,a]),o!==!1&&(p[o]=g(o)),d.useEffect(()=>{if(o!==!1){const x=cs(o),S=Nt(c.current);return S.addEventListener(x,h),()=>{S.removeEventListener(x,h)}}},[h,o]),d.cloneElement(r,p)}const ls=Xe(et)({boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",textAlign:"center",userSelect:"none",cursor:"pointer"}),Dn=Xe(B,{shouldForwardProp:$t(["progressBarPosition"])})(({theme:e,progressBarPosition:r})=>({position:"fixed",pointerEvents:"all",touchAction:"none",...m(Se(r).isHorizontal,{justifyContent:"flex-end",bottom:0,right:0}),...m(Se(r).isVertical,{top:0,bottom:0}),...m(Se(r).isLeft,{alignItems:e.direction==="ltr"?"flex-start":"flex-end"}),...m(Se(r).isRight,{alignItems:e.direction==="ltr"?"flex-end":"flex-start"})})),In=Xe(B)(({theme:e})=>({flexDirection:"row",justifyContent:"center",alignItems:"center",gap:e.spacing(.5)})),Bn=Xe(B)({flexDirection:"row",flexGrow:1,overflow:"hidden"}),_n=Xe(Y,{shouldForwardProp:$t(["currentPagesIndex","pagesLength","progressBarPosition"])})(({currentPagesIndex:e,pagesLength:r,progressBarPosition:n})=>({position:"absolute",pointerEvents:"none",...m(Se(n).isHorizontal,{left:0,width:"".concat((e+1)/r*100,"%"),height:"100%"}),...m(Se(n).isVertical,{top:0,width:"100%",height:"".concat((e+1)/r*100,"%")})})),Pn=({pageName:e,currentPagesIndex:r,pagesLength:n,isDragging:o,boxProps:t,children:a,progressBarPosition:l})=>s.jsx(F,{title:e,slotProps:{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}},placement:Ts[l],children:s.jsx(Y,{...t,sx:{position:"absolute",cursor:o?"grabbing":"grab",...m(Se(l).isHorizontal,{left:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"calc(100% / ".concat(n-1,")"),height:"100%"}),...m(Se(l).isVertical,{top:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"100%",height:"calc(100% / ".concat(n-1,")")}),...t==null?void 0:t.sx},children:a})}),yn=Xe(B)({position:"relative",flexDirection:"row",flexGrow:1}),kn=d.memo(Xe(Y,{shouldForwardProp:$t(["isFirstPage","isLastPage"])})(({isFirstPage:e,isLastPage:r})=>({flexGrow:1,height:"100%",cursor:"pointer",borderLeftWidth:e?0:void 0,borderRightWidth:r?0:void 0}))),Nn=d.memo(({page:e,pagesIndex:r,isCurrentPage:n,isLeadingPage:o,isTrailingPage:t,totalPages:a,showDraggingStyle:l,primaryPageLoadState:c,secondaryPageLoadState:i,createProgressBarSlot:f,...u})=>{const h=d.useMemo(()=>f(e,r,c,i,n,o,t,a,l),[f,e,r,c,i,n,o,t,a,l]);return s.jsx(kn,{...u,isFirstPage:r===0,isLastPage:r===a-1,children:h})}),Mn=({totalPages:e,pages:r,pageLoadStates:n,currentPageIndex:o,slotProps:t,slots:a,createProgressBarSlot:l,progressBarPosition:c,readingMode:i,isDragging:f,setIsDragging:u,openPage:h,direction:g,fullSegmentClicks:p})=>{var O,I,_,H,q,Z,k,N,W,M,fe,xe,$,z,be,X,de,pe,ue,me,ve,ge,se,ee,Ae,he,Fe,Oe,Ue,Le,Ze,De;const x=d.useRef(null),S=d.useRef(void 0),[v,C]=d.useState(0),R=d.useRef(null);Ye(R,d.useCallback(()=>{const P=R.current;if(!P)return;const{paddingLeft:y,paddingRight:Ie}=getComputedStyle(P),Ke=6,Be=P.clientWidth-parseFloat(y)-parseFloat(Ie),re=i===V.DOUBLE_PAGE?Be*2+Ke:Be;C(re)},[i]));const b=d.useMemo(()=>Ne(o,r).pagesIndex,[o,r]),w=Se(c).isHorizontal,T=d.useMemo(()=>Ne(o,r),[o,r]),E=d.useCallback((...P)=>ce(P[0],P[1],g),[g]);le.useHandleProgressDragging(h,x,f,T,r,c,E,p);const D=P=>{if(!x.current)return;const y="touches"in P;h(Te(rr(y?P.touches[0]:P,x.current,r,w,p,E)),void 0,!1),clearTimeout(S.current),S.current=setTimeout(()=>u(!0),250)},j=()=>{u(!1),clearTimeout(S.current)};return s.jsx(Dn,{...t==null?void 0:t.container,progressBarPosition:c,children:s.jsxs(In,{...t==null?void 0:t.progressBarRoot,children:[s.jsx(ls,{...(O=t==null?void 0:t.progressBarPageTexts)==null?void 0:O.base,...(I=t==null?void 0:t.progressBarPageTexts)==null?void 0:I.current,sx:[{width:"".concat(v,"px")},...Array.isArray((H=(_=t==null?void 0:t.progressBarPageTexts)==null?void 0:_.base)==null?void 0:H.sx)?(k=(Z=(q=t==null?void 0:t.progressBarPageTexts)==null?void 0:q.base)==null?void 0:Z.sx)!=null?k:[]:[(W=(N=t==null?void 0:t.progressBarPageTexts)==null?void 0:N.base)==null?void 0:W.sx],...Array.isArray((fe=(M=t==null?void 0:t.progressBarPageTexts)==null?void 0:M.current)==null?void 0:fe.sx)?(z=($=(xe=t==null?void 0:t.progressBarPageTexts)==null?void 0:xe.current)==null?void 0:$.sx)!=null?z:[]:[(X=(be=t==null?void 0:t.progressBarPageTexts)==null?void 0:be.current)==null?void 0:X.sx]],onClick:()=>h("previous","ltr",!1),children:T.name}),s.jsx(Ln,{onClickAway:()=>u(!1),children:s.jsxs(yn,{...t==null?void 0:t.progressBarSlotsActionArea,onMouseDown:D,onMouseUp:j,onTouchStart:D,onTouchEnd:j,children:[s.jsxs(Bn,{ref:x,...t==null?void 0:t.progressBarSlotsContainer,children:[r.map((P,y)=>d.createElement(Nn,{...t==null?void 0:t.progressBarSlot,key:P.primary.index,page:P,pagesIndex:y,isCurrentPage:y===b,isLeadingPage:y<b,isTrailingPage:y>b,totalPages:r.length,primaryPageLoadState:n[P.primary.index].loaded,secondaryPageLoadState:P.secondary?n[P.secondary.index].loaded:void 0,createProgressBarSlot:l,showDraggingStyle:y===b&&f})),s.jsx(_n,{...t==null?void 0:t.progressBarReadPages,currentPagesIndex:T.pagesIndex,pagesLength:r.length,progressBarPosition:c})]}),s.jsx(Pn,{boxProps:t==null?void 0:t.progressBarCurrentPageSlot,pageName:T.name,currentPagesIndex:T.pagesIndex,pagesLength:r.length,isDragging:f,progressBarPosition:c,children:a==null?void 0:a.progressBarCurrentPage})]})}),s.jsx(ls,{ref:R,...(de=t==null?void 0:t.progressBarPageTexts)==null?void 0:de.base,...(pe=t==null?void 0:t.progressBarPageTexts)==null?void 0:pe.total,sx:[{minWidth:"unset"},...Array.isArray((me=(ue=t==null?void 0:t.progressBarPageTexts)==null?void 0:ue.base)==null?void 0:me.sx)?(se=(ge=(ve=t==null?void 0:t.progressBarPageTexts)==null?void 0:ve.base)==null?void 0:ge.sx)!=null?se:[]:[(Ae=(ee=t==null?void 0:t.progressBarPageTexts)==null?void 0:ee.base)==null?void 0:Ae.sx],...Array.isArray((Fe=(he=t==null?void 0:t.progressBarPageTexts)==null?void 0:he.total)==null?void 0:Fe.sx)?(Le=(Ue=(Oe=t==null?void 0:t.progressBarPageTexts)==null?void 0:Oe.total)==null?void 0:Ue.sx)!=null?Le:[]:[(De=(Ze=t==null?void 0:t.progressBarPageTexts)==null?void 0:Ze.total)==null?void 0:De.sx]],onClick:()=>h("next","ltr",!1),children:e})]})})},Us=U(d.memo(Mn),[Lt,()=>({openPage:le.useOpenPage()}),we,L.useSettingsWithoutDefaultFlag],["isDragging","setIsDragging","openPage","pages","pageLoadStates","totalPages","currentPageIndex","readingMode"]),Hn=d.forwardRef(({direction:e,...r},n)=>{const{settings:{customThemes:o,appTheme:t,themeMode:a,shouldUsePureBlackMode:l}}=nr(),c=d.useMemo(()=>or(a,ar(t,o),l,e),[a,t,o,l,e]);return s.jsx(ir,{value:cr[e],children:s.jsx(lr,{theme:c,children:s.jsx(Y,{...r,ref:n,dir:e})})})}),Gs=U(Hn,[()=>({direction:L.useGetThemeDirection()})],["direction"]),zs=d.memo(({pageName:e,progressBarPosition:r,slotProps:n,children:o})=>{var t;return s.jsx(F,{...n==null?void 0:n.tooltip,title:e,placement:Ts[r],children:s.jsx(Y,{...n==null?void 0:n.box,sx:{width:"100%",height:"100%",...(t=n==null?void 0:n.box)==null?void 0:t.sx},children:o})})}),Vn=d.memo(({pageName:e,primaryPageLoadState:r,secondaryPageLoadState:n,progressBarPosition:o,isCurrentPage:t,isLeadingPage:a,showDraggingStyle:l})=>{const c=nt();return s.jsx(zs,{pageName:e,progressBarPosition:o,slotProps:{box:{sx:{cursor:"pointer",backgroundColor:Qt(c.palette.background.paper,.2),...c.applyStyles("dark",{backgroundColor:es(c.palette.background.paper,.1)}),...m(r&&(n==null||n),{backgroundColor:Qt(c.palette.background.paper,.35),...c.applyStyles("dark",{backgroundColor:es(c.palette.background.paper,.25)})})}},tooltip:{slotProps:t?{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}}:void 0}},children:s.jsx(Y,{sx:{width:"100%",height:"100%",...m(a,{backgroundColor:tt(c.palette.primary.main,.5)}),...m(t,{cursor:l?"grabbing":"grab",pointer:"grabbing",borderRadius:2,backgroundColor:"primary.dark",...c.applyStyles("dark",{backgroundColor:"primary.light"})})}})})}),Wn=({readerNavBarWidth:e,isMaximized:r,setIsMaximized:n,isDragging:o,progressBarType:t,progressBarSize:a,progressBarPosition:l,progressBarPositionAutoVertical:c,readerDirection:i,scrollbarXSize:f,scrollbarYSize:u,totalPages:h})=>{const g=nt(),[,p]=d.useState({});Ye(window.document.documentElement,d.useCallback(()=>p({}),[]));const x=js(l,c,u,e+f),{isBottom:S,isLeft:v,isRight:C,isVertical:R,isHorizontal:b}=Se(x),w=!!h,T=t===Ut.HIDDEN,E=!r&&!o;return s.jsx(Gs,{children:s.jsx(Us,{direction:b?i:"ltr",progressBarPosition:x,fullSegmentClicks:!0,createProgressBarSlot:d.useCallback((D,j,O,I,_,H,q,Z,k)=>s.jsx(Vn,{pageName:D.name,primaryPageLoadState:O,secondaryPageLoadState:I,progressBarPosition:x,isCurrentPage:_,isLeadingPage:H,showDraggingStyle:k}),[x]),slotProps:{container:{sx:{overflow:"hidden",transition:"all 0.".concat(g.transitions.duration.shortest,"s"),...m(b,{minHeight:"100px",...m(g.direction==="ltr",{left:i==="ltr"?e:u,right:i==="rtl"?e:u}),...m(g.direction==="rtl",{left:i==="rtl"?e:u,right:i==="ltr"?e:u})}),...m(R,{minWidth:"100px",bottom:"".concat(f,"px")}),...m(S,{bottom:"".concat(f,"px")}),...m(v,{...m(g.direction==="ltr",{left:i==="ltr"?e:"unset",right:i==="rtl"?e:"unset"}),...m(g.direction==="rtl",{right:i==="rtl"?u:"unset",left:i==="ltr"?u:"unset"})}),...m(C,{...m(g.direction==="ltr",{right:i==="ltr"?u:"unset",left:i==="rtl"?u:"unset"}),...m(g.direction==="rtl",{left:i==="rtl"?e:"unset",right:i==="ltr"?e:"unset"})}),...m(E,{opacity:T?0:.85}),...m(!w,{pointerEvents:"none"})},onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},progressBarRoot:{sx:{gap:0,transition:"all 0.1s ease-in-out",backgroundColor:"background.paper",...m(R,{flexDirection:"column",height:"100%"}),...m(E,{backgroundColor:"unset",pointerEvents:"none",...m(b,{px:2}),...m(R,{py:2}),...m(S,{pb:.25}),...m(v,{...m(g.direction==="ltr",{pl:i==="ltr"?.25:0,pr:i==="rtl"?.25:0}),...m(g.direction==="rtl",{pr:i==="rtl"?.25:0,pl:i==="ltr"?.25:0})}),...m(C,{...m(g.direction==="ltr",{pr:i==="ltr"?.25:0,pl:i==="rtl"?.25:0}),...m(g.direction==="rtl",{pl:i==="rtl"?.25:0,pr:i==="ltr"?.25:0})})})}},progressBarSlotsContainer:{sx:{gap:.25,borderRadius:2,transition:"height 0.1s ease-in-out",...m(b,{height:"20px"}),...m(R,{flexDirection:"column",width:"20px"}),...m(E,{...m(b,{height:"".concat(a,"px")}),...m(R,{width:"".concat(a,"px")})})}},progressBarReadPages:{sx:{display:"none"}},progressBarCurrentPageSlot:{sx:{display:"none"}},progressBarPageTexts:{base:{sx:{px:1,py:1.5,transition:"all 0.1s ease-in-out",...m(E,{transform:"scale(0)",p:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})}}}}})})},Fn=U(d.memo(Wn),[$e,Lt,L.useSettingsWithoutDefaultFlag,()=>({readerDirection:L.useGetThemeDirection()}),rt,we],["readerNavBarWidth","isMaximized","setIsMaximized","isDragging","progressBarType","progressBarSize","progressBarPosition","progressBarPositionAutoVertical","readerDirection","scrollbarXSize","scrollbarYSize","totalPages"]),Un=Xe(B)({width:"400px",minWidth:"400px",maxWidth:"400px",height:"100vh",overflowY:"auto"}),Gn=d.memo(({mangaId:e,mangaTitle:r,chapterTitle:n,scanlator:o})=>s.jsxs(B,{children:[s.jsx(F,{title:r,placement:"right",children:s.jsx(gt,{lines:3,variant:"h6",component:"h1",sx:{textAlign:"center"},children:s.jsx(Tt,{component:Dt,to:Xt.manga.path(e),sx:{textDecoration:"none",color:"inherit"},children:r})})}),s.jsx(F,{title:n,placement:"right",children:s.jsx(gt,{lines:4,variant:"body1",component:"h2",sx:{textAlign:"center"},children:n})}),o&&s.jsx(F,{title:o,placement:"right",children:s.jsx(gt,{lines:4,variant:"body2",component:"h3",color:"textDisabled",sx:{textAlign:"center"},children:o})})]})),zn=Re(s.jsx("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"})),$n=Re(s.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),Ot=({title:e,type:r,disabled:n,...o})=>s.jsx(F,{title:e,disabled:n,children:s.jsx(Vs,{sx:{flexBasis:"15%"},variant:"contained",disabled:n,...o,children:r==="previous"?s.jsx(zn,{}):s.jsx($n,{})})}),Xn=({currentPageIndex:e,pages:r,readingDirection:n,openPage:o})=>{const{t}=G(),a=Cs(),l=d.useMemo(()=>Ne(e,r),[e,r]),c=ws[n];return s.jsxs(B,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(Ot,{type:"previous",title:t(a("reader.button.previous_page","reader.button.next_page",c)),disabled:a(!l.primary.index,Te(l)===Te(r.slice(-1)[0]),c),onClick:()=>o("previous",void 0,!1)}),s.jsxs(Ws,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(Fs,{id:"reader-nav-bar-desktop-page-select",children:t("reader.page_info.label.page")}),s.jsx(Hs,{labelId:"reader-nav-bar-desktop-page-select",label:t("reader.page_info.label.page"),value:Te(l),onChange:i=>o(i.target.value,void 0,!1),children:r.map(i=>s.jsx(ht,{value:Te(i),children:i.name},Te(i)))})]}),s.jsx(Ot,{type:"next",title:t(a("reader.button.next_page","reader.button.previous_page",c)),disabled:a(Te(l)===Te(r.slice(-1)[0]),!l.primary.index,c),onClick:()=>o("next",void 0,!1)})]})},Yn=U(d.memo(Xn),[we,()=>({openPage:le.useOpenPage()}),L.useSettingsWithoutDefaultFlag],["currentPageIndex","pages","readingDirection","openPage"]),Zn=()=>{},$s=({currentChapter:e,chapters:r,style:n})=>{const o=d.useMemo(()=>e&&r.findIndex(t=>t.id===e.id),[e,r]);return s.jsx(dn,{style:{height:"calc(".concat(r.length," * 100px)"),...n},initialTopMostItemIndex:o!=null?o:0,totalCount:r.length,computeItemKey:t=>r[t].id,itemContent:t=>s.jsx(un,{index:t,chapters:r,isSortDesc:!0,mode:"reader",showChapterNumber:!1,selected:null,onSelect:Zn,selectable:!1,isActiveChapter:t===o}),increaseViewportBy:400})},Kn=({currentChapter:e,previousChapter:r,nextChapter:n,chapters:o=[],readerThemeDirection:t,openChapter:a})=>{var i,f;const{t:l}=G(),c=jt({variant:"popover",popupId:"reader-nav-bar-desktop-chapter-list"});return d.useLayoutEffect(()=>{c.close()},[e==null?void 0:e.id]),s.jsxs(B,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(Ot,{type:"previous",title:l(ce("reader.button.previous_chapter","reader.button.next_chapter",t)),onClick:()=>{a(ce("previous","next",t))},disabled:ce(!r,!n,t)}),s.jsxs(Ws,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(Fs,{id:"reader-nav-bar-desktop-chapter-select",children:l("chapter.title_one")}),s.jsx(Hs,{...Ct(c),open:c.isOpen,value:(i=e==null?void 0:e.id)!=null?i:0,MenuProps:{sx:{visibility:"hidden"}},label:l("chapter.title_one"),labelId:"reader-nav-bar-desktop-chapter-select",children:s.jsx(ht,{value:(f=e==null?void 0:e.id)!=null?f:0,children:e?"#".concat(e.chapterNumber," ").concat(e.name):""},e==null?void 0:e.id)})]}),s.jsx(Ot,{component:Dt,type:"next",title:l(ce("reader.button.next_chapter","reader.button.previous_chapter",t)),onClick:()=>{a(ce("next","previous",t))},disabled:ce(!n,!r,t)}),s.jsx(dr,{...ur(c),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:s.jsx(Y,{sx:{mb:1},children:s.jsx($s,{style:{width:"500px",maxWidth:"90vw",minHeight:"150px",maxHeight:"300px"},currentChapter:e,chapters:o})})})]})},qn=U(d.memo(Kn),[()=>({readerThemeDirection:L.useGetThemeDirection()}),()=>({openChapter:le.useOpenChapter()})],["readerThemeDirection","openChapter"]),Jn=Re(s.jsx("path",{d:"M17 4h3c1.1 0 2 .9 2 2v2h-2V6h-3zM4 8V6h3V4H4c-1.1 0-2 .9-2 2v2zm16 8v2h-3v2h3c1.1 0 2-.9 2-2v-2zM7 18H4v-2H2v2c0 1.1.9 2 2 2h3zM18 8H6v8h12z"})),Xs=(e,r,n)=>{const t=(e+1)%r.length===0;if(!(n&&t))return r[(e+1)%r.length]},Zt=({tooltip:e,value:r,defaultValue:n,values:o,setValue:t,valueToDisplayData:a,isDefaultable:l,onDefault:c,defaultIcon:i})=>{const{t:f}=G(),u=r===void 0,h=d.useMemo(()=>u?-1:o.indexOf(r),[r,o]);return s.jsx(F,{title:e,children:u?s.jsx(st,{onClick:()=>t(o[0]),sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:i,size:"large",children:n===void 0?f("global.label.default"):s.jsx(Kr,{i18nKey:"settings.default_value",value:a[n].isTitleString?a[n].title:f(a[n].title)})}):s.jsx(st,{onClick:()=>{const g=Xs(h,o,l);if(g===void 0){c==null||c();return}t(g)},sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:a[r].icon,size:"large",children:a[r].isTitleString?a[r].title:f(a[r].title)})})},Qn=({pageScaleMode:e,shouldStretchPage:r,updateSetting:n,...o})=>{const{t}=G();return s.jsxs(B,{sx:{flexDirection:"row",gap:1},children:[s.jsx(Zt,{...o,tooltip:t("reader.settings.page_scale.title"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:As,setValue:a=>n("pageScaleMode",a),valueToDisplayData:ts,defaultIcon:ts[e.value].icon}),gr[e.value]&&s.jsx(F,{title:t("reader.settings.page_scale.stretch"),children:s.jsx(Vs,{onClick:()=>n("shouldStretchPage",!r.value),sx:{px:void 0},variant:"contained",color:r.value?"secondary":"primary",children:s.jsx(Jn,{})})})]})},eo=({readingMode:e,setReadingMode:r,...n})=>{const{t:o}=G();return s.jsx(Zt,{...n,tooltip:o("reader.settings.label.reading_mode"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Os,setValue:r,valueToDisplayData:Gt,defaultIcon:Gt[e.value].icon})},to=()=>s.jsx(hr,{children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M2 4h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2m20 0h-6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6M2 12h20m-3-3 3 3-3 3M5 9l-3 3 3 3"})})}),so=({readingMode:e,shouldOffsetDoubleSpreads:r,setShouldOffsetDoubleSpreads:n})=>{const{t:o}=G();return fr(e)?s.jsx(st,{sx:{justifyContent:"start",textTransform:"unset"},size:"large",onClick:()=>n(!r),color:r?"secondary":"primary",variant:"contained",startIcon:s.jsx(to,{}),children:o("reader.settings.label.offset_double_spread")}):null},ro=({readingDirection:e,setReadingDirection:r,...n})=>{const{t:o}=G();return s.jsx(Zt,{...n,tooltip:o("reader.settings.label.reading_direction"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Ls,setValue:r,valueToDisplayData:ss,defaultIcon:ss[e.value].icon})},no=Re(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 14H9V8h2zm4 0h-2V8h2z"})),oo=Re(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 14.5v-9l6 4.5z"})),ao=({autoScroll:e,setAutoScroll:r})=>{const{t:n}=G(),{isActive:o,toggleActive:t}=pt(),a=d.useRef(void 0);return s.jsxs(B,{sx:{flexDirection:"row",gap:1},children:[s.jsx(st,{sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},size:"large",onClick:t,color:o?"secondary":"primary",variant:"contained",startIcon:o?s.jsx(no,{}):s.jsx(oo,{}),children:n("reader.settings.auto_scroll.title")}),s.jsx(ln,{value:e.value,type:"number",size:"small",onBlur:l=>{const c=it(+l.target.value,ke.min,ke.max);c!==e.value&&(clearTimeout(a.current),r({...e,value:c},!0))},onChange:l=>{const c=it(+l.target.value,ke.min,ke.max);r({...e,value:c},!1),clearTimeout(a.current),a.current=setTimeout(()=>r({...e,value:c},!0),1e3)},slotProps:{input:{inputProps:ke,endAdornment:s.jsx(xn,{position:"end",children:n("global.time.seconds.second",{count:e.value})})}}})]})},io=({manga:e,readingMode:r,shouldOffsetDoubleSpreads:n,pageScaleMode:o,shouldStretchPage:t,readingDirection:a,autoScroll:l,openSettings:c})=>{const{t:i}=G(),f=L.useCreateUpdateSetting(e!=null?e:Me),u=L.useCreateDeleteSetting(e!=null?e:Me);return s.jsxs(B,{sx:{gap:1},children:[s.jsx(eo,{readingMode:r,setReadingMode:h=>f("readingMode",h),isDefaultable:!0,onDefault:()=>u("readingMode")}),s.jsx(so,{readingMode:r.value,shouldOffsetDoubleSpreads:n.value,setShouldOffsetDoubleSpreads:h=>f("shouldOffsetDoubleSpreads",h)}),s.jsx(Qn,{pageScaleMode:o,shouldStretchPage:t,updateSetting:f,isDefaultable:!0,onDefault:()=>u("pageScaleMode")}),s.jsx(ro,{readingDirection:a,setReadingDirection:h=>f("readingDirection",h),isDefaultable:!0,onDefault:()=>u("readingDirection")}),s.jsx(ao,{autoScroll:l,setAutoScroll:(...h)=>f("autoScroll",...h)}),s.jsx(st,{onClick:()=>c(),size:"large",sx:{justifyContent:"start",textTransform:"none"},variant:"contained",startIcon:s.jsx(Ds,{}),children:i("settings.title")})]})},co=U(io,[We,L.useSettings],["manga","readingMode","shouldOffsetDoubleSpreads","pageScaleMode","shouldStretchPage","readingDirection","autoScroll"]),lo=Re(s.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"})),ds={...Me,title:"Fallback",inLibrary:!1},uo=({manga:e})=>{const{inLibrary:r}=e!=null?e:ds,{t:n}=G(),{CategorySelectComponent:o,updateLibraryState:t}=rn(e!=null?e:ds,!0);return s.jsxs(s.Fragment,{children:[s.jsx(F,{title:n(r?"manga.action.library.remove.label.action":"manga.button.add_to_library"),children:s.jsx(te,{onClick:t,color:"inherit",children:r?s.jsx(Sn,{}):s.jsx(nn,{})})}),o]})},Ys=U(d.memo(uo),[We],["manga"]),go=Re(s.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),ho=({id:e,isBookmarked:r})=>{const{t:n}=G(),o=r?"unbookmark":"bookmark";return s.jsx(F,{title:n(zt[o].action.single),children:s.jsx(te,{onClick:()=>ze.performAction(o,[e],{}),color:"inherit",children:r?s.jsx(gn,{}):s.jsx(go,{})})})},Zs=d.memo(ho),fo=({currentChapter:e})=>{var o;const{t:r}=G(),n=ze.useDownloadStatusFromCache((o=e==null?void 0:e.id)!=null?o:-1);return e&&ze.isDownloaded(e)?s.jsx(F,{title:r(zt.delete.action.single),children:s.jsx(te,{onClick:()=>ze.performAction("delete",[e.id],{}),color:"inherit",children:s.jsx(mn,{})})}):n?s.jsx(vn,{chapterId:n.chapter.id}):s.jsx(F,{title:r(zt.download.action.single),disabled:!e,children:s.jsx(te,{disabled:!e,onClick:()=>{var t;return ze.performAction("download",[(t=e==null?void 0:e.id)!=null?t:-1],{})},color:"inherit",children:s.jsx(pn,{})})})},xo=d.memo(({currentChapter:e,pageLoadStates:r,setPageLoadStates:n,setRetryFailedPagesKeyPrefix:o})=>{const{id:t,isBookmarked:a,realUrl:l}=e!=null?e:Is,{t:c}=G(),i=d.useRef(0),f=d.useMemo(()=>r.some(u=>u.error),[r]);return s.jsxs(B,{sx:{flexDirection:"row",justifyContent:"center",gap:1},children:[s.jsx(Ys,{}),s.jsx(Zs,{id:t,isBookmarked:a}),s.jsx(F,{title:c("reader.button.retry_load_pages"),disabled:!f,children:s.jsx(te,{onClick:()=>{n(u=>u.map(h=>({url:h.url,loaded:h.loaded}))),o("".concat(i.current)),i.current=(i.current+1)%1e3},disabled:!f,color:"inherit",children:s.jsx(lo,{})})}),s.jsx(fo,{currentChapter:e}),s.jsx(F,{title:c("global.button.open_browser"),disabled:!l,children:s.jsx(te,{disabled:!l,href:l!=null?l:"",rel:"noreferrer",target:"_blank",color:"inherit",children:s.jsx(hn,{})})}),s.jsx(F,{title:c("global.button.open_webview"),disabled:!l,children:s.jsx(te,{disabled:!l,href:l?xt.getWebviewUrl(l):"",rel:"noreferrer",target:"_blank",color:"inherit",children:s.jsx(fn,{})})})]})}),po=U(xo,[He,we],["currentChapter","pageLoadStates","setPageLoadStates","setRetryFailedPagesKeyPrefix"]),mo=({exit:e})=>{const{t:r}=G(),n=Cs();return s.jsx(F,{title:r("reader.button.exit"),children:s.jsx(te,{sx:{marginRight:2},onClick:e,color:"inherit",children:n(s.jsx(xr,{}),s.jsx(pr,{}))})})},Ks=U(d.memo(mo),[()=>({exit:L.useExit()})],["exit"]),vo=(e,r)=>{const n=d.useRef(r),o=d.useRef(r);return o.current!==n.current&&!e&&(n.current=!1),o.current!==r&&(n.current=o.current,o.current=r),n.current},So=({isVisible:e,openSettings:r,setReaderNavBarWidth:n,manga:o,chapters:t,currentChapter:a,previousChapter:l,nextChapter:c,isStaticNav:i})=>{const{t:f}=G(),u=L.useCreateUpdateSetting(o!=null?o:Me),[h,g]=d.useState();Ye(h,d.useCallback(()=>{i&&n(h.offsetWidth)},[h,i])),d.useLayoutEffect(()=>()=>n(0),[]);const S=vo(e,i)&&e?0:void 0;return s.jsx(mr,{variant:i?"permanent":"persistent",open:e||i,transitionDuration:S,SlideProps:{unmountOnExit:!0},PaperProps:{ref:v=>g(v)},children:s.jsxs(Un,{sx:{backgroundColor:"background.paper",pointerEvents:"all"},children:[s.jsxs(B,{sx:{p:2,gap:2,backgroundColor:"action.hover"},children:[s.jsxs(B,{sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(Ks,{}),s.jsx(F,{title:f("reader.settings.label.static_navigation"),children:s.jsx(te,{onClick:()=>{n(0),u("isStaticNav",!i)},color:i?"primary":"inherit",children:i?s.jsx(tn,{}):s.jsx(sn,{})})})]}),o&&a?s.jsxs(s.Fragment,{children:[s.jsx(Gn,{mangaId:o.id,mangaTitle:o.title,chapterTitle:a.name,scanlator:a.scanlator}),s.jsx(po,{})]}):s.jsx(It,{})]}),s.jsxs(B,{sx:{p:2,gap:2},children:[s.jsxs(B,{sx:{gap:1},children:[s.jsx(Yn,{}),s.jsx(qn,{chapters:t,currentChapter:a,nextChapter:c,previousChapter:l})]}),s.jsx(vr,{}),s.jsx(co,{openSettings:r})]})]})})},Ro=U(d.memo(So),[$e,We,He,we,L.useSettingsWithoutDefaultFlag],["setReaderNavBarWidth","manga","chapters","currentChapter","previousChapter","nextChapter","isStaticNav"]),bo={...Me,title:""},Eo=d.forwardRef(({isVisible:e,manga:r,currentChapter:n,scrollbarYSize:o},t)=>{const{t:a}=G(),l=jt({popupId:"reader-overlay-more-menu",variant:"popover"}),{id:c,title:i}=r!=null?r:bo,{id:f,name:u,realUrl:h,isBookmarked:g}=n!=null?n:Is;return s.jsx(Yt,{direction:"down",in:e,ref:t,children:s.jsxs(B,{sx:{flexDirection:"row",alignItems:"center",position:"fixed",top:0,left:0,right:"".concat(o,"px"),p:2,pt:p=>"max(env(safe-area-inset-top), ".concat(p.spacing(2),")"),backgroundColor:p=>tt(p.palette.background.paper,.95),pointerEvents:"all",boxShadow:2},children:[s.jsx(Ks,{}),s.jsx(B,{sx:{flexGrow:1},children:r&&n?s.jsxs(s.Fragment,{children:[s.jsx(F,{title:i,children:s.jsx(gt,{lines:1,component:"h1",variant:"h5",children:s.jsx(Tt,{component:Dt,to:Xt.manga.path(c),sx:{textDecoration:"none",color:"inherit"},children:i})})}),s.jsx(F,{title:u,children:s.jsx(gt,{lines:1,children:u})})]}):s.jsx(It,{})}),s.jsx(Ys,{}),s.jsx(Zs,{id:f,isBookmarked:g}),s.jsx(te,{...Ct(l),color:"inherit",children:s.jsx(on,{})}),s.jsxs(Sr,{...Rr(l),children:[s.jsx(ht,{component:Tt,disabled:!h,href:h!=null?h:"",rel:"noreferrer",target:"_blank",children:a("global.button.open_browser")}),s.jsx(ht,{component:Tt,disabled:!h,href:h?xt.getWebviewUrl(h):"",rel:"noreferrer",target:"_blank",children:a("global.button.open_webview")}),s.jsx(ht,{disabled:!h,onClick:async()=>{await navigator.clipboard.writeText(i),Bs(a("global.label.copied_clipboard"),"info")},children:a("global.label.share")})]})]})})}),To=U(d.memo(Eo),[We,He,rt],["manga","currentChapter","scrollbarYSize"]),jo=Re(s.jsx("path",{d:"m21.81 12.74-.82-.63v-.22l.8-.63c.16-.12.2-.34.1-.51l-.85-1.48c-.07-.13-.21-.2-.35-.2q-.075 0-.15.03l-.95.38c-.08-.05-.11-.07-.19-.11l-.15-1.01c-.03-.21-.2-.36-.4-.36h-1.71c-.2 0-.37.15-.4.34l-.14 1.01c-.03.02-.07.03-.1.05l-.09.06-.95-.38q-.075-.03-.15-.03c-.14 0-.27.07-.35.2l-.85 1.48c-.1.17-.06.39.1.51l.8.63v.23l-.8.63c-.16.12-.2.34-.1.51l.85 1.48c.07.13.21.2.35.2q.075 0 .15-.03l.95-.37c.08.05.12.07.2.11l.15 1.01c.03.2.2.34.4.34h1.71c.2 0 .37-.15.4-.34l.15-1.01c.03-.02.07-.03.1-.05l.09-.06.95.38q.075.03.15.03c.14 0 .27-.07.35-.2l.85-1.48c.1-.17.06-.39-.1-.51M18 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M17 17h2v4c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v4h-2V6H7v12h10z"})),Co=Re(s.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5M7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"})),us=Re(s.jsx("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})),gs=Re(s.jsx("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"})),wo={display:"flex",alignItems:"center",justifyContent:"end",position:"relative",backgroundColor:"background.default"},hs="3px",Ao=d.memo(({isTrailingPage:e,pagesIndex:r,totalPages:n,isVertical:o,isHorizontal:t})=>{const a="".concat(r/(n-1)*100,"%");return s.jsx(Y,{sx:{position:"absolute",...m(o,{top:a,left:"50%"}),...m(t,{top:"50%",left:a}),transform:"translate(-50%, -50%)",width:hs,height:hs,borderRadius:100,backgroundColor:"background.paper",...m(e,{backgroundColor:"primary.main"}),zIndex:1}})}),Oo=d.memo(({pageName:e,isTrailingPage:r,isCurrentPage:n,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:l})=>s.jsx(zs,{pageName:e,progressBarPosition:ut.BOTTOM,slotProps:{box:{sx:wo}},children:!n&&s.jsx(Ao,{isTrailingPage:r,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:l})})),Lo={[ut.BOTTOM]:"up",[ut.LEFT]:"right",[ut.RIGHT]:"left",[ut.AUTO]:"left"},Do=({previousChapter:e,nextChapter:r,isVisible:n,setIsMaximized:o,isDragging:t,currentPageIndex:a,pages:l,direction:c,progressBarPosition:i,progressBarPositionAutoVertical:f,topOffset:u=0,bottomOffset:h=0,scrollbarXSize:g})=>{const p=le.useOpenChapter(),[,x]=d.useState({});Ye(window.document.documentElement,d.useCallback(()=>x({}),[]));const S=js(i,f,u+h,g),{isLeft:v,isRight:C,isVertical:R,isHorizontal:b}=Se(S),w=b?c:"ltr",T=d.useMemo(()=>Ne(a,l).pagesIndex,[a,l]),E=d.useMemo(()=>({container:{sx:{flexGrow:1,position:"relative",display:"flex",justifyItems:"center",alignItems:"stretch",backgroundColor:j=>tt(j.palette.background.paper,.85),borderRadius:100,boxShadow:2}},progressBarRoot:{sx:{flexGrow:1,gap:0,...m(R,{flexDirection:"column"}),...m(b,{alignItems:"stretch"})}},progressBarSlotsActionArea:{sx:{alignItems:"center",cursor:"pointer",...m(R,{width:"100%",flexDirection:"column",px:2}),...m(b,{height:"100%",py:2})}},progressBarSlotsContainer:{sx:{borderRadius:100,backgroundColor:"background.default",...m(R,{flexDirection:"column",py:1}),...m(b,{px:1})}},progressBarSlot:{sx:{...m(R,{width:"20px"}),...m(b,{height:"20px"})}},progressBarCurrentPageSlot:{sx:{display:"flex",zIndex:1,cursor:"inherit",...m(R,{justifyContent:"center"}),...m(b,{alignItems:"center"})}},progressBarPageTexts:{base:{sx:{...m(R,{py:1}),...m(b,{px:1})}}}}),[R,b]),D=d.useMemo(()=>({progressBarCurrentPage:s.jsx(Y,{sx:{position:"absolute",...m(R,{top:"calc(100% - 6px)",...m(T===0,{top:"0"}),width:"75%",height:"6px"}),...m(b,{left:"calc(100% - 0px)",...m(T===0,{left:"0"}),width:"6px",height:"75%"}),backgroundColor:"primary.main",borderRadius:100,cursor:t?"grabbing":"grab"}})}),[T,l.length,t,R,b]);return d.useLayoutEffect(()=>(o(n),()=>o(!1)),[n]),s.jsx(Yt,{direction:Lo[S],in:n,children:s.jsx(Gs,{sx:{position:"relative",display:"flex",alignItems:"end",height:"100%",pointerEvents:"none",...m(v,{justifyContent:c==="ltr"?"start":"end"}),...m(C,{justifyContent:c==="ltr"?"end":"start"})},children:s.jsxs(B,{sx:{p:2,gap:1,pointerEvents:"all",alignItems:"center",...m(R,{height:"100%",flexDirection:"column"}),...m(b,{width:"100%",flexDirection:"row"})},children:[s.jsx(te,{onClick:()=>p("previous"),disabled:!e,sx:{backgroundColor:j=>tt(j.palette.background.paper,.85),boxShadow:2},children:ce(s.jsx(us,{sx:{...m(R,{transform:"rotate(90deg)"})}}),s.jsx(gs,{sx:{...m(R,{transform:"rotate(90deg)"})}}),w)}),s.jsx(Us,{direction:w,progressBarPosition:S,fullSegmentClicks:!1,createProgressBarSlot:d.useCallback((j,O,I,_,H,q,Z,k)=>s.jsx(Oo,{pageName:j.name,isTrailingPage:Z,isCurrentPage:H,pagesIndex:O,totalPages:k,isVertical:R,isHorizontal:b}),[R,b]),slotProps:{...E,progressBarReadPages:{sx:{backgroundColor:"primary.main",...m(R,{width:"20px",height:"".concat(Math.max(0,Ne(a,l).pagesIndex)/(l.length-1)*100,"%"),borderRadius:"400px 400px 0 0"}),...m(b,{width:"".concat(Math.max(0,Ne(a,l).pagesIndex)/(l.length-1)*100,"%"),height:"20px",borderRadius:"400px 0 0 400px"})}}},slots:D}),s.jsx(te,{onClick:()=>p("next"),disabled:!r,sx:{backgroundColor:j=>tt(j.palette.background.paper,.85),boxShadow:2},children:ce(s.jsx(gs,{sx:{...m(R,{transform:"rotate(90deg)"})}}),s.jsx(us,{sx:{...m(R,{transform:"rotate(90deg)"})}}),w)})]})})})},Io=U(d.memo(Do),[He,Bt,Lt,we,()=>({direction:L.useGetThemeDirection()}),L.useSettingsWithoutDefaultFlag,rt],["previousChapter","nextChapter","isVisible","setIsMaximized","isDragging","currentPageIndex","pages","direction","progressBarPosition","progressBarPositionAutoVertical","scrollbarXSize"]),Bo=({manga:e,readingMode:r,readingDirection:n,autoScroll:o,isActive:t,toggleActive:a})=>{const{t:l}=G(),c=L.useCreateDeleteSetting(e!=null?e:Me);return e?s.jsxs(B,{sx:{gap:2},children:[s.jsx(qr,{}),s.jsx(Jr,{readingMode:r,setReadingMode:i=>L.updateSetting(e,"readingMode",i),isDefaultable:!0,onDefault:()=>c("readingMode")}),s.jsx(Qr,{readingDirection:n,setReadingDirection:i=>L.updateSetting(e,"readingDirection",i),isDefaultable:!0,onDefault:()=>c("readingDirection")}),s.jsx(Rn,{label:l("reader.settings.auto_scroll.title"),checked:t,onChange:()=>a()}),s.jsx(en,{autoScroll:o,setAutoScroll:(...i)=>L.updateSetting(e,"autoScroll",...i)})]}):null},_o=U(d.memo(Bo),[We,L.useSettings,pt],["manga","readingMode","readingDirection","autoScroll","isActive","toggleActive"]),Po=({openSettings:e,isVisible:r,currentChapter:n,chapters:o,scrollbarXSize:t,scrollbarYSize:a,topOffset:l=0})=>{const{t:c}=G(),i=jt({variant:"dialog",popupId:"reader-chapter-list-dialog"}),f=jt({variant:"dialog",popupId:"reader-quick-settings-dialog"}),[u,h]=d.useState(0),g=d.useRef(null);return Ye(g,d.useCallback(()=>{var p,x;return h((x=(p=g.current)==null?void 0:p.clientHeight)!=null?x:0)},[u])),d.useLayoutEffect(()=>{i.close()},[n==null?void 0:n.id]),s.jsxs(s.Fragment,{children:[s.jsxs(B,{sx:{position:"fixed",right:"".concat(a,"px"),bottom:0,left:0,height:"calc(100% - ".concat(l,"px)")},children:[s.jsx(Io,{topOffset:l,bottomOffset:u}),s.jsx(Yt,{direction:"up",in:r,children:s.jsx(B,{ref:g,sx:{alignItems:"center",backgroundColor:p=>tt(p.palette.background.paper,.95),pb:"max(".concat(t,"px, env(safe-area-inset-bottom))"),boxShadow:2,pointerEvents:"all"},children:s.jsxs(B,{sx:{width:"50%",flexDirection:"row",p:2,gap:1,justifyContent:"space-evenly",alignItems:"center"},children:[s.jsx(F,{title:c("reader.button.chapter_list"),children:s.jsx(te,{...Ct(i),color:"inherit",children:s.jsx(Co,{})})}),s.jsx(F,{title:c("reader.settings.title.quick_settings"),children:s.jsx(te,{...Ct(f),color:"inherit",children:s.jsx(jo,{})})}),s.jsx(F,{title:c("settings.title"),children:s.jsx(te,{onClick:e,color:"inherit",children:s.jsx(Ds,{})})})]})})})]}),i.isOpen&&s.jsx(Wt,{...rs(i),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Ft,{sx:{p:0,pb:1},children:s.jsx($s,{style:{minHeight:"15vh",maxHeight:"75vh"},currentChapter:n,chapters:o})})}),f.isOpen&&s.jsx(Wt,{...rs(f),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Ft,{children:s.jsx(_o,{})})})]})},yo=U(d.memo(Po),[He,rt],["currentChapter","chapters","scrollbarXSize","scrollbarYSize"]),ko=({isVisible:e,isDesktop:r,isMobile:n})=>{const[o,t]=d.useState(!1),[a,l]=d.useState(0),c=d.useRef(null);return Ye(c,d.useCallback(()=>{var i,f;return l((f=(i=c.current)==null?void 0:i.clientHeight)!=null?f:0)},[n])),s.jsxs(Y,{sx:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none",zIndex:1},children:[r&&s.jsxs(s.Fragment,{children:[s.jsx(Fn,{}),s.jsx(Ro,{isVisible:e,openSettings:()=>t(!0)})]}),n&&s.jsxs(s.Fragment,{children:[s.jsx(To,{ref:c,isVisible:e}),s.jsx(yo,{openSettings:()=>t(!0),isVisible:e,topOffset:a})]}),s.jsx(Cn,{isOpen:o,close:()=>t(!1)}),s.jsx(An,{})]})},No=U(d.memo(ko),[L.useOverlayMode],["isDesktop","isMobile"]),fs="reader-tap-zone-layout-canvas",Mo=({readerNavBarWidth:e,showPreview:r,tapZoneLayout:n,tapZoneInvertMode:o,readingDirection:t})=>{const a=nt(),[l,c]=d.useState(0),[i,f]=d.useState(0),[u,h]=d.useState(null);Ye(u,d.useCallback(()=>{var p,x;c((p=u==null?void 0:u.clientWidth)!=null?p:0),f((x=u==null?void 0:u.clientHeight)!=null?x:0)},[u]));const g=br.getOrCreateCanvas(n,l,i,a.typography.h3,{vertical:o.vertical,horizontal:o.horizontal,isRTL:t===ct.RTL});return d.useLayoutEffect(()=>{const p=document.getElementById(fs);p==null||p.replaceChildren(g)},[g,r]),s.jsx(Y,{ref:h,sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none"},children:r&&s.jsx("div",{id:fs})})},Ho=U(Mo,[$e,_t,L.useSettingsWithoutDefaultFlag],["readerNavBarWidth","showPreview","tapZoneLayout","tapZoneInvertMode","readingDirection"]),Vo=({readerNavBarWidth:e,customFilter:{rgba:{value:{red:r,green:n,blue:o,alpha:t,blendMode:a},enabled:l}}})=>l?s.jsx(Y,{sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none",background:"rgba(".concat(r," ").concat(n," ").concat(o," / ").concat(t,"%)"),mixBlendMode:"".concat(a)}}):null,Wo=U(Vo,[$e,L.useSettingsWithoutDefaultFlag],["readerNavBarWidth","customFilter"]),xs=2,ps=1,Qe=0,oe=0,ae=1,Fo=(e,r=Mt.XY)=>{const[n,o]=d.useState(!1),t=d.useRef(void 0),a=d.useRef([0,0,0]),l=d.useRef([0,0,0]),c=d.useRef([0,0,0]),i=d.useRef([0,0]),f=d.useRef(void 0);return d.useEffect(()=>{const u=e==null?void 0:e.current;if(!u)return()=>{};const h=()=>{t.current||(t.current=getComputedStyle(u));const E=t.current.direction==="rtl",D=t.current.flexDirection==="row-reverse";return E||!E&&D},g=()=>(t.current||(t.current=getComputedStyle(u)),t.current.flexDirection==="column-reverse"),p=r!==Mt.Y,x=r!==Mt.X,S=()=>clearInterval(f.current),v=()=>{const E=($,z,be)=>($[Qe]-$[xs])/(z[Qe]-z[xs])*1e3/be,D=[p?E(a.current,c.current,u.clientWidth):0,x?E(l.current,c.current,u.clientHeight):0],j=p&&x?Math.sqrt(D[oe]**2+D[ae]**2):Math.abs(x?D[ae]:D[oe]),O=[D[oe]/j,D[ae]/j],I=it(1.2*j,-12,12),_=(Date.now()-c.current[Qe])/1e3,H=I-14.278*_+75.24*_**2/I-149.72*_**3/I/I;if(!(I!==0&&H>0&&!Number.isNaN(I))){S();return}const Z=($,z)=>$*z*(I*_-7.1397*_**2+25.08*_**3/I-37.43*_**4/I/I),k=[Z(u.clientWidth,O[oe]),Z(u.clientHeight,O[ae])],N=[u.scrollWidth-u.clientWidth,u.scrollHeight-u.clientHeight],W=[it(i.current[oe]-k[oe],h()?-N[oe]:0,N[oe]),it(i.current[ae]-k[ae],g()?-N[ae]:0,N[ae])],M=W[oe]!==0||W[oe]!==N[oe],fe=W[ae]!==0||W[ae]!==N[ae];M||fe||S(),p&&(u.scrollLeft=W[oe]),x&&(u.scrollTop=W[ae])};let C=!1;const R=E=>{if(C)return!0;const D=[u.clientHeight<u.scrollHeight,u.clientWidth<u.scrollWidth],j=[Math.abs(a.current[Qe]-E.pageX)>0,Math.abs(l.current[Qe]-E.pageY)>0];return D[oe]&&j[oe]||D[ae]&&j[ae]},b=E=>{R(E)&&(C=!0,o(!0),a.current=[...a.current.slice(1),E.pageX],l.current=[...l.current.slice(1),E.pageY],c.current=[...c.current.slice(1),Date.now()],p&&(u.scrollLeft+=a.current[Qe]-a.current[ps]),x&&(u.scrollTop+=l.current[Qe]-l.current[ps]))},w=()=>{u.removeEventListener("mousemove",b),u.removeEventListener("mouseup",w),setTimeout(()=>{C=!1,o(!1)},0),i.current=[u.scrollLeft,u.scrollTop],f.current=setInterval(v,16)},T=E=>{E.button===0&&(E.preventDefault(),a.current=[E.pageX,E.pageX,E.pageX],l.current=[E.pageY,E.pageY,E.pageY],c.current=[Date.now()-2,Date.now()-1,Date.now()],u.addEventListener("mousemove",b),u.addEventListener("mouseup",w),S())};return u.addEventListener("mousedown",T),u.addEventListener("wheel",S),()=>{u.removeEventListener("mousedown",T),u.removeEventListener("wheel",S),S()}},[e,r]),n},Uo=(e,r,n)=>{d.useEffect(()=>{if(e&&!n){r.pause();return}r.resume()},[e,r.isPaused,n])},Go=(e,r,n,o,t)=>{d.useEffect(()=>{var l,c;const a=()=>{e&&r(!1),n&&o(!1)};return(l=t.current)==null||l.addEventListener("wheel",a),(c=t.current)==null||c.addEventListener("touchmove",a),()=>{var i,f;(i=t.current)==null||i.removeEventListener("wheel",a),(f=t.current)==null||f.removeEventListener("touchmove",a)}},[e,n])},zo=(e,r,n)=>{d.useEffect(()=>{if(e!==V.CONTINUOUS_HORIZONTAL)return()=>{};if(!n.current)return()=>{};let o,t,a;const l=c=>{var h,g;if(a===!0)return;c.preventDefault();const i=!Math.abs(Math.abs(o!=null?o:c.deltaX)-Math.abs(c.deltaX)),f=!Math.abs(Math.abs(t!=null?t:c.deltaY)-Math.abs(c.deltaY));if(o=c.deltaX,t=c.deltaY,a||(a=!i||!f),a!==void 0){if(c.shiftKey){(h=n.current)==null||h.scrollBy({top:c.deltaY});return}(g=n.current)==null||g.scrollBy({left:r===ct.LTR?c.deltaY:c.deltaY*-1})}};return n.current.addEventListener("wheel",l),()=>{var c;return(c=n.current)==null?void 0:c.removeEventListener("wheel",l)}},[e,r])},$o=e=>{const r=d.useRef(void 0);d.useEffect(()=>{const n=t=>{const a=e.current;a&&(a.style.cursor=t?"default":"none")},o=()=>{n(!0),clearTimeout(r.current),r.current=setTimeout(()=>{n(!1)},5e3)};return o(),window.addEventListener("mousemove",o),()=>{n(!0),window.removeEventListener("mousemove",o),clearTimeout(r.current)}},[])},Xo=(e,r,n,o,t)=>{d.useLayoutEffect(()=>{var a;r||(a=t.current)==null||a.scrollTo(Er(t.current,n,o),0)},[e])},Yo=(e,r,n,o,t,a,l,c,i,f)=>{d.useLayoutEffect(()=>{if(e==null)return;const u=Ne(e,n);if(l){const p=e>r?wt.PREVIOUS:wt.NEXT,x=c.current[u.pagesIndex];x==null||x.scrollIntoView({block:"start",inline:Tr(p,i,f)})}const h=Te(u),g=h===o-1;t(null),a(h,!g,g)},[e])},Zo=(e,r,n,o,t,a,l)=>{const[c,i]=d.useState(l===V.DOUBLE_PAGE);d.useLayoutEffect(()=>{if(c&&l!==V.DOUBLE_PAGE){i(!1);const h=_s(n);o(h),t(h.map(({primary:{url:g}})=>({url:g,isSpread:!1})));return}l===V.DOUBLE_PAGE&&(c||a(Te(Ne(e,r))),o(r),i(l===V.DOUBLE_PAGE))},[r,l])},Ht=({title:e,name:r,scanlator:n,backgroundColor:o})=>{const t=nt(),a=t.palette.getContrastText(wr(t.palette,Ps[o])),l=tt(a,.5);return r?s.jsxs(B,{children:[s.jsx(et,{color:a,children:e}),s.jsx(et,{color:a,variant:"h6",component:"h1",children:r}),n&&s.jsx(et,{variant:"body2",color:l,children:n})]}):null},Ko=({type:e,transitionPageMode:r,readingMode:n,backgroundColor:o,shouldShowTransitionPage:t,manga:a,currentChapterName:l,currentChapterScanlator:c,previousChapterName:i,previousChapterScanlator:f,nextChapterName:u,nextChapterScanlator:h,scrollbarXSize:g,scrollbarYSize:p,readerNavBarWidth:x,handleBack:S})=>{var j;const{t:v}=G(),C=e===je.PREVIOUS,R=e===je.NEXT,b=!!l&&!i,w=!!l&&!u,T=b&&e===je.PREVIOUS,E=w&&e===je.NEXT;return!t&&!(T||E)||!Cr(e,r,n)?null:s.jsx(B,{sx:{justifyContent:"center",alignItems:"center",...m(!Ve(n),{width:"100%",height:"100%"}),...m(Ve(n),{position:"sticky",...m(Ce(n),{left:0,maxWidth:"calc(100vw - ".concat(p,"px - ").concat(x,"px)"),minHeight:"calc(100vh - ".concat(g,"px)")}),...m(n===V.CONTINUOUS_HORIZONTAL,{top:0,minWidth:"calc(100vw - ".concat(p,"px - ").concat(x,"px)"),maxHeight:"calc(100vh - ".concat(g,"px)")})})},children:s.jsxs(B,{sx:{gap:2,maxWidth:O=>"calc(100vw - ".concat(p,"px - ").concat(x,"px - ").concat(O.spacing(2),")"),maxHeight:"calc(100vh - ".concat(g,"px)"),width:"max-content",p:1},children:[C&&b&&s.jsx(et,{variant:"h6",children:v("reader.transition_page.first_chapter")}),s.jsxs(B,{sx:{gap:5},children:[C&&!b&&s.jsx(Ht,{title:v("reader.transition_page.previous"),name:i,scanlator:f,backgroundColor:o}),!!l&&s.jsx(Ht,{title:v(C?"reader.transition_page.current":"reader.transition_page.finished"),name:l,scanlator:c,backgroundColor:o}),R&&!w&&s.jsx(Ht,{title:v("reader.transition_page.next"),name:u,scanlator:h,backgroundColor:o})]}),R&&w&&s.jsx(et,{variant:"h6",children:v("reader.transition_page.last_chapter")}),(C&&b||R&&w)&&s.jsxs(B,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:[s.jsx(st,{sx:{flexGrow:1},onClick:O=>{O.stopPropagation(),S()},variant:"contained",children:v("reader.transition_page.exit.previous_page")}),s.jsx(st,{sx:{flexGrow:1},component:Dt,onClick:O=>{O.stopPropagation()},variant:"contained",to:Xt.manga.path((j=a==null?void 0:a.id)!=null?j:-1),children:v("reader.transition_page.exit.manga_page")})]})]})})},ms=U(d.memo(Ko),[We,({chapterId:e})=>{const{chapters:r}=He(),n=d.useMemo(()=>r.findIndex(l=>l.id===e),[e,r]),o=r[n],t=d.useMemo(()=>r[n+1],[n,r]),a=d.useMemo(()=>r[n-1],[n,r]);return{currentChapterName:o==null?void 0:o.name,currentChapterScanlator:o==null?void 0:o.scanlator,previousChapterName:t==null?void 0:t.name,previousChapterScanlator:t==null?void 0:t.name,nextChapterName:a==null?void 0:a.name,nextChapterScanlator:a==null?void 0:a.scanlator}},rt,$e,we,L.useSettingsWithoutDefaultFlag,({chapterId:e,type:r})=>{const n=jr(),{chapters:o}=He(),t=d.useMemo(()=>o.findIndex(u=>u.id===e),[e,o]),a=t===0,l=t===o.length-1,c=r===je.PREVIOUS&&l,i=r===je.NEXT&&a;return{handleBack:c||i?n:ye}}],["manga","currentChapterName","currentChapterScanlator","previousChapterName","previousChapterScanlator","nextChapterName","nextChapterScanlator","scrollbarXSize","scrollbarYSize","readerNavBarWidth","backgroundColor","transitionPageMode","readingMode","handleBack","shouldShowTransitionPage"]),qo=(e,r,n,o,t,a,l,c,i,f,u,h,g,p,x,S,v,C)=>{var b,w;const R=d.useRef(void 0);d.useLayoutEffect(()=>{var I;const T=(I=r.data)==null?void 0:I.fetchChapterPages;if(!T)return;const{pages:E}=T,D=E.length?E:[""],j=Ar(n,o!=null?o:0,D.length-1),O=R.current!==(T==null?void 0:T.pages);if(O){R.current=T.pages;const _=_s(D);i(!0),h(_),g(D),p(_.map(({primary:{url:H}})=>({url:H,loaded:!1}))),x(_.map(({primary:{url:H}})=>({url:H,isSpread:!1})))}else h(t),p(a),x(l);u(T.pages.length),g(D),S(j),v(j),f(_=>({..._,isCurrentChapterReady:c||O})),C(je.NONE)},[(w=(b=r.data)==null?void 0:b.fetchChapterPages)==null?void 0:w.pages,e])},vs=0,Rt="-10px",Jo=(e,r,n)=>{if(!Ve(r))return;const o=ws[n],t="0px ".concat(Rt," 0px 0px"),a="0px 0px 0px ".concat(Rt);return Ce(r)?e==="first"?"0px 0px ".concat(Rt," 0px"):"".concat(Rt," 0px 0px 0px"):e==="first"?ce(t,a,o):ce(a,t,o)},Qo=(e,r,n,o)=>e===ct.LTR?{start:n>=o,end:r<0}:{start:r<0,end:n>=o},ea=(e,{top:r,right:n,bottom:o,left:t},a,l)=>{const c=window.innerWidth-l,i=window.innerHeight-a;return{[V.CONTINUOUS_VERTICAL]:{start:o>=i,end:r<0},[V.CONTINUOUS_HORIZONTAL]:Qo(e,t,n,c)}},ta=({[V.CONTINUOUS_VERTICAL]:e,[V.CONTINUOUS_HORIZONTAL]:r},n)=>Ce(n)?e.start||e.end:r.start||r.end,sa=({[V.CONTINUOUS_VERTICAL]:e,[V.CONTINUOUS_HORIZONTAL]:r},n)=>Ce(n)?e:r,Ss=(e,r,n,o,t,a,l,c,i,f,u,h,g,p)=>{d.useEffect(()=>{const x=Ve(a),S=Ce(a);if(p||!g||!x||!c||!o||t||n===void 0)return()=>{};const v=()=>{const C=g.scrollLeft===0,R=g.scrollLeft===g.scrollWidth-g.clientWidth,b=g.scrollTop===0,w=g.scrollTop===g.scrollHeight-g.clientHeight;(e==="first"&&(S?b:C)||e==="last"&&(S?w:R))&&i(n,void 0,!1)};return g.addEventListener("scroll",v),()=>g.removeEventListener("scroll",v)},[a,g,p,c,o,t,n,i]),Or(f,d.useCallback(x=>{if(!c||!Ve(a)||n===void 0||!p&&!t)return;const S=x[x.length-1],v=ea(l,S.target.getBoundingClientRect(),u,h),{start:C,end:R}=sa(v,a),b=S.intersectionRatio<=vs;if(!ta(v,a))return;const w=e==="first"&&C&&!t,T=e==="last"&&!o&&R;if(w||e==="last"&&R&&b){i(n,!t,!1);return}T&&i(r,!1,!1)},[e,r,n,o,t,a,l,c,p,i,u,h]),d.useMemo(()=>({root:g,threshold:[vs],rootMargin:Jo(e,a,l),ignoreInitialObserve:!0}),[e,a,l]))},ra=({readingMode:e,readingDirection:r,shouldUseInfiniteScroll:n,chapterId:o,previousChapterId:t,nextChapterId:a,isPreviousChapterVisible:l,isCurrentChapter:c,isNextChapterVisible:i,imageWrapper:f,openChapter:u,scrollbarXSize:h,scrollbarYSize:g,scrollElement:p,shouldShowTransitionPage:x})=>(Ss("first",o,t,c,l,e,r,n,u,f,h,g,p,x),Ss("last",o,a,c,i,e,r,n,u,f,h,g,p,x),null),na=U(d.memo(ra),[()=>({openChapter:le.useOpenChapter()}),L.useSettingsWithoutDefaultFlag],["openChapter","shouldShowTransitionPage"]),oa=({currentPageIndex:e,setPages:r,setPageLoadStates:n,setTotalPages:o,setCurrentPageIndex:t,updateCurrentPageIndex:a,setPageToScrollToIndex:l,transitionPageMode:c,retryFailedPagesKeyPrefix:i,setTransitionPageMode:f,readingMode:u,readerWidth:h,pageScaleMode:g,shouldOffsetDoubleSpreads:p,readingDirection:x,shouldUseInfiniteScroll:S,imagePreLoadAmount:v,pageGap:C,chapterId:R,previousChapterId:b,nextChapterId:w,isPreviousChapterVisible:T,isNextChapterVisible:E,lastPageRead:D,isInitialChapter:j,isCurrentChapter:O,isPreviousChapter:I,isNextChapter:_,isLeadingChapter:H,isTrailingChapter:q,isPreloadMode:Z,imageRefs:k,scrollIntoView:N,setReaderStateChapters:W,resumeMode:M,customFilter:fe,shouldStretchPage:xe,scrollbarXSize:$,scrollbarYSize:z,readerNavBarWidth:be,onSizeChange:X,minWidth:de,minHeight:pe,scrollElement:ue})=>{const{t:me}=G(),{direction:ve}=nt(),[ge,se]=xt.useGetChapterPagesFetch(R!=null?R:-1),[ee,Ae]=d.useState(!1),[he,Fe]=d.useState(vt.totalPages),[Oe,Ue]=d.useState(vt.pageUrls),[Le,Ze]=d.useState(vt.pages),[De,P]=d.useState(vt.pageLoadStates),[y,Ie]=d.useState(De.map(({url:A})=>({url:A,isSpread:!1}))),Ke=d.useRef(null),Be=d.useRef(O),re=d.useRef(Le.map(()=>null)),qe=d.useRef(null),ne=d.useMemo(()=>!!!he||!(he===y.length)?Le:u===V.DOUBLE_PAGE?Lr(Oe,y,p,x):Le,[y,u,p,x,he]),K=d.useMemo(()=>Dr(u),[u]),ot=x===ct.LTR,_e=Ve(u),Pe=!_e&&!O||Z,Ge=!_e&&O,Pt=!Pe&&(Ge||_e&&(j||H)),yt=!Pe&&(Ge||_e&&(j||q));Be.current=O,O&&(k.current=re.current);const Je=d.useCallback(()=>{R&&(Ae(!1),ge({variables:{input:{chapterId:R}}}).catch(bt()))},[ge,R]),lt=d.useMemo(()=>Ir(ne,Ie,A=>{Be.current&&n(A),P(A)},u),[ne,u]),kt=d.useMemo(()=>Br(A=>{Be.current&&n(A),P(A)}),[]);d.useEffect(()=>{Je()},[R]),Ye(Ke,d.useCallback(A=>{const{clientWidth:Ee,clientHeight:at}=A[0].target;X(Ee,at,R)},[X,Ke.current,R]));const ie=(A,Ee,at,mt=!1)=>{(mt||!ee)&&Ee(A),O&&at(A)};return qo(O,se,M,D,ne,De,y,ee,Ae,A=>ie(A,ye,W),A=>ie(A,Fe,o),A=>ie(A,Ze,r),A=>ie(A,Ue,ye),A=>ie(A,P,n),A=>ie(A,Ie,ye),A=>ie(A,ye,t),A=>{(j&&!ee||N)&&(l(A),W(Ee=>({...Ee,visibleChapters:{...Ee.visibleChapters,scrollIntoView:!1,resumeMode:void 0}})))},A=>ie(A,ye,f)),Zo(e,ne,Oe,A=>ie(A,Ze,r,!0),A=>ie(A,Ie,ye,!0),A=>ie(A,ye,a),u),_e||O||I||_?se.error?Pe?null:s.jsx(Y,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center",position:"relative"},children:s.jsx(At,{message:me("global.error.label.failed_to_load_data"),messageExtra:ys(se.error),retry:()=>{Je()}})}):se.loading||!ee?Pe?null:s.jsx(Y,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center"},children:s.jsx(It,{})}):R!=null&&!he?Pe?null:s.jsx(Y,{sx:{minWidth:"100%",minHeight:"100%",position:"relative"},children:s.jsx(At,{message:me("reader.error.label.no_pages_found"),retry:Je})}):s.jsxs(B,{ref:Ke,sx:{width:"fit-content",height:"fit-content",margin:"auto",flexWrap:"nowrap",...m(u===V.CONTINUOUS_HORIZONTAL,{minHeight:pe}),...m(Ce(u),{minWidth:de}),...m(Pe,{maxWidth:0,maxHeight:0,minWidth:"unset",minHeight:"unset",overflow:"hidden",margin:"unset"}),...m(Ce(u)&&ks(h,g),{alignItems:"center"}),...m(u===V.CONTINUOUS_HORIZONTAL,{...m(ve==="ltr",{flexDirection:ot?"row":"row-reverse"}),...m(ve==="rtl",{flexDirection:ot?"row-reverse":"row"})})},children:[!Z&&s.jsx(na,{readingMode:u,readingDirection:x,shouldUseInfiniteScroll:S,chapterId:R,previousChapterId:b,nextChapterId:w,isCurrentChapter:O,isPreviousChapterVisible:T,isNextChapterVisible:E,imageWrapper:qe.current,scrollbarXSize:$,scrollbarYSize:z,scrollElement:ue}),Pt&&s.jsx(ms,{chapterId:R,type:je.PREVIOUS}),s.jsx(K,{ref:qe,totalPages:he,currentPageIndex:e,pages:ne,transitionPageMode:c,pageLoadStates:De,retryFailedPagesKeyPrefix:i,imageRefs:re,onLoad:lt,onError:kt,isCurrentChapter:O,isPreviousChapter:I,isNextChapter:_,readingMode:u,imagePreLoadAmount:v,readingDirection:x,pageScaleMode:g,pageGap:C,customFilter:fe,shouldStretchPage:xe,readerWidth:h,scrollbarXSize:$,scrollbarYSize:z,readerNavBarWidth:be,isPreloadMode:Z,resumeMode:M,handleAsInitialRender:N}),yt&&s.jsx(ms,{chapterId:R,type:je.NEXT})]}):null},aa=d.memo(oa),ia=(e,r,n,o)=>{const t=_r(r),a=Pr(r),l=n!==window.innerWidth,c=o!==window.innerHeight,i=t&&l,f=a&&c;return!Ce(e)&&l?!0:i||f},Rs=(e,r,n)=>{d.useLayoutEffect(()=>{n(r)},[e])},ca=(e,r,n,o)=>{const t=d.useRef({width:window.innerWidth,height:window.innerHeight}),a=d.useCallback(()=>{const{width:l,height:c}=t.current;t.current={width:window.innerWidth,height:window.innerHeight},ia(e,r,l,c)&&n(o)},[e,r,o]);bn("resize",a)},qs=e=>{const r=d.useRef({left:0,top:0,visibleElement:void 0,visibleElementLeft:0,visibleElementTop:0});return d.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=()=>{var a,l;const{visibleElement:t}=r.current;r.current={...r.current,left:n.scrollLeft,top:n.scrollTop,visibleElementLeft:(a=t==null?void 0:t.offsetLeft)!=null?a:0,visibleElementTop:(l=t==null?void 0:t.offsetTop)!=null?l:0}};return n.addEventListener("scroll",o),()=>n.removeEventListener("scroll",o)},[]),d.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=(l,c)=>Array.from(l).filter(i=>i instanceof HTMLElement).flatMap(i=>i instanceof HTMLImageElement?[i]:Array.from(i.querySelectorAll("img"))).forEach(c),t=new IntersectionObserver(l=>{const c=l.find(i=>i.isIntersecting);(c==null?void 0:c.target)instanceof HTMLElement&&(r.current={...r.current,visibleElement:c.target,visibleElementLeft:c.target.offsetLeft,visibleElementTop:c.target.offsetTop})}),a=new MutationObserver(l=>{for(const c of l)o(c.addedNodes,i=>t.observe(i)),o(c.removedNodes,i=>t.unobserve(i))});return a.observe(n,{childList:!0,subtree:!0}),()=>{a.disconnect(),t.disconnect()}},[]),r},la=(e,r)=>{const n=qs(e),o=Ve(r),t=Ce(r);d.useEffect(()=>{const a=e.current;if(!a||!o)return()=>{};const l=u=>{const{left:h,top:g,visibleElement:p,visibleElementLeft:x,visibleElementTop:S}=n.current;if(!p||!!!u.filter(w=>!(w.target instanceof HTMLElement)||!w.target.clientWidth&&!w.target.clientHeight?!1:t?w.target.offsetTop<g:Math.abs(w.target.offsetLeft)<Math.abs(h)).length)return;const R=h-x+p.offsetLeft,b=g-S+p.offsetTop;a.scrollTo(R,b)},c=(u,h)=>Array.from(u).filter(g=>g instanceof HTMLElement).flatMap(g=>g instanceof HTMLImageElement?[g]:Array.from(g.querySelectorAll("img"))).forEach(h),i=new ResizeObserver(l),f=new MutationObserver(u=>{for(const h of u)c(h.addedNodes,g=>i.observe(g)),c(h.removedNodes,g=>i.unobserve(g))});return f.observe(a,{childList:!0,subtree:!0}),()=>{f.disconnect(),i.disconnect()}},[o,t])},da=(e,r,n,o,t,a,l)=>{const c=qs(e),i=()=>{const f=e.current,{left:u,top:h,visibleElementLeft:g,visibleElementTop:p,visibleElement:x}=c.current;if(!f||!l||!x)return!1;const S=Ns(n,t,a),v=o===0;if(!(!S.previous&&v))return!1;const R=u-g+x.offsetLeft,b=h-p+x.offsetTop;return f.scrollTo(R,b),!0};d.useEffect(()=>{const f=e.current;if(!f||!l)return()=>{};let u=!1;const h=(x,S)=>{Array.from(x).filter(v=>v instanceof HTMLElement).flatMap(v=>v instanceof HTMLImageElement?[v]:Array.from(v.querySelectorAll("img"))).forEach(S)},g=new ResizeObserver(()=>{u||(u=i(),u&&g.disconnect())}),p=new MutationObserver(x=>{for(const S of x)h(S.addedNodes,v=>g.observe(v)),h(S.removedNodes,v=>g.unobserve(v))});return p.observe(f,{childList:!0,subtree:!0}),()=>{p.disconnect(),g.disconnect()}},[r]),d.useLayoutEffect(()=>{i()},[r])},ua=(e,r,n,o,t,a,l,c,i,f)=>{da(e,r,n,o,t,a,Ve(l)),la(e,l),ca(l,f,i,o),Rs(c,o,i),Rs(l,o,i)},ga={[V.SINGLE_PAGE]:dt.X,[V.DOUBLE_PAGE]:dt.X,[V.CONTINUOUS_VERTICAL]:dt.Y,[V.CONTINUOUS_HORIZONTAL]:dt.X,[V.WEBTOON]:dt.Y},ha=d.forwardRef(({currentPageIndex:e,pageToScrollToIndex:r,setPageToScrollToIndex:n,pages:o,totalPages:t,setPages:a,setPageLoadStates:l,setTotalPages:c,setCurrentPageIndex:i,transitionPageMode:f,retryFailedPagesKeyPrefix:u,setTransitionPageMode:h,readingMode:g,readingDirection:p,shouldUseInfiniteScroll:x,readerWidth:S,pageScaleMode:v,shouldOffsetDoubleSpreads:C,imagePreLoadAmount:R,pageGap:b,customFilter:w,shouldStretchPage:T,isStaticNav:E,readerNavBarWidth:D,setScrollbarXSize:j,setScrollbarYSize:O,isVisible:I,setIsVisible:_,updateCurrentPageIndex:H,showPreview:q,setShowPreview:Z,initialChapter:k,currentChapter:N,chapters:W,visibleChapters:M,setReaderStateChapters:fe,isCurrentChapterReady:xe},$)=>{var Be;const{direction:z}=nt(),{resumeMode:be=ns.START}=(Be=Ms().state)!=null?Be:{resumeMode:ns.START},X=d.useRef(null),de=En($,X),pe=Ce(g),ue=Ve(g),me=Fo(X),ve=pt();d.useEffect(()=>ve.setScrollRef(X),[]);const ge=os.useGetScrollbarSize("width",X.current),se=os.useGetScrollbarSize("height",X.current);d.useLayoutEffect(()=>{j(ge),O(se)},[ge,se]);const ee=le.useHandleClick(X.current),Ae=d.useRef(o.map(()=>null)),[{minChapterViewWidth:he,minChapterViewHeight:Fe,minChapterSizeSourceChapterId:Oe},Ue]=d.useState({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),[,Le]=d.useState({}),Ze=ga[g],De=p===ct.LTR,P=d.useMemo(()=>W.findIndex(re=>re.id===(k==null?void 0:k.id)),[W,k==null?void 0:k.id]),y=d.useMemo(()=>W.slice(Math.max(0,P-M.trailing),Math.min(W.length,P+M.leading+1)),[W,P,M.trailing,M.leading]),Ie=d.useMemo(()=>y.findIndex(re=>re.id===(N==null?void 0:N.id)),[N,y]),Ke=d.useCallback((re,qe,ne)=>{if(!ue)return;const K=ne===Oe;if(pe){if(!K&&he>=re)return;Ue({minChapterViewWidth:re,minChapterViewHeight:0,minChapterSizeSourceChapterId:ne});return}(K||Fe<qe)&&Ue({minChapterViewWidth:0,minChapterViewHeight:qe,minChapterSizeSourceChapterId:ne})},[ue,pe,he,Fe,Oe]);if(Yo(r,e,o,t,n,H,ue,Ae,z,p),Xo(e,ue,z,p,X),$o(X),zo(g,p,X),Go(I,_,q,Z,X),Uo(I,ve,E),ua(X,N==null?void 0:N.id,Ie,e,y,M,g,p,n,v),d.useLayoutEffect(()=>{Ue({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),Le({})},[g]),!k||!N)throw new Error("ReaderViewer: illegal state - initialChapter and currentChapter should not be undefined");return s.jsx(B,{ref:de,sx:{width:"100%",height:"100%",overflow:"auto",flexWrap:"nowrap",...m(pe&&ks(S,v),{alignItems:"center"}),...m(!pe,{...m(z==="ltr",{flexDirection:De?"row":"row-reverse"}),...m(z==="rtl",{flexDirection:De?"row-reverse":"row"})})},onClick:re=>!me&&ee(re),onScroll:()=>le.updateCurrentPageOnScroll(Ae,t-1,H,Ze,p),children:y.map((re,qe)=>{var at,mt,qt,Jt;const ne=Math.max(0,y.length-qe-1),K=y[ne],ot=(at=y[ne+1])!=null?at:W[P+M.leading+1],_e=(mt=y[ne-1])!=null?mt:W[P-M.trailing-1],Pe=K.id===k.id,Ge=K.id===N.id,Pt=K.id===((qt=y[Ie+1])==null?void 0:qt.id),yt=K.id===((Jt=y[Ie-1])==null?void 0:Jt.id),Je=k.sourceOrder>K.sourceOrder,lt=k.sourceOrder<K.sourceOrder,kt=M.lastLeadingChapterSourceOrder===K.sourceOrder,ie=M.lastTrailingChapterSourceOrder===K.sourceOrder,Kt=kt&&M.isLeadingChapterPreloadMode||ie&&M.isTrailingChapterPreloadMode,A=Ns(ne,y,M),Ee=K.id===Oe;return s.jsx(aa,{chapterId:K.id,previousChapterId:ot==null?void 0:ot.id,nextChapterId:_e==null?void 0:_e.id,isPreviousChapterVisible:A.previous,isNextChapterVisible:A.next,lastPageRead:it(K.lastPageRead,0,K.pageCount-1),currentPageIndex:kr(e,K,N,Ge,xe,Je,lt,M),isInitialChapter:Pe,isCurrentChapter:Ge,isPreviousChapter:Pt,isNextChapter:yt,isLeadingChapter:Je,isTrailingChapter:lt,isPreloadMode:Kt,imageRefs:Ae,setPages:a,setPageLoadStates:l,setTotalPages:c,setCurrentPageIndex:i,setPageToScrollToIndex:n,transitionPageMode:f,retryFailedPagesKeyPrefix:u,readingMode:g,readerWidth:S,pageScaleMode:v,shouldOffsetDoubleSpreads:C,readingDirection:p,shouldUseInfiniteScroll:x,updateCurrentPageIndex:Ge?H:ye,scrollIntoView:Ge&&M.scrollIntoView,resumeMode:yr(Ge,Pe,Je,lt,M.resumeMode,be),setReaderStateChapters:fe,setTransitionPageMode:h,pageGap:b,imagePreLoadAmount:R,customFilter:w,shouldStretchPage:T,scrollbarXSize:ge,scrollbarYSize:se,readerNavBarWidth:D,onSizeChange:Ke,minWidth:Ee?0:he,minHeight:Ee?0:Fe,scrollElement:X.current},K.id)})})}),fa=U(d.memo(ha),[we,L.useSettingsWithoutDefaultFlag,rt,Bt,()=>({updateCurrentPageIndex:le.useUpdateCurrentPageIndex()}),_t,He,$e],["currentPageIndex","pageToScrollToIndex","setPageToScrollToIndex","pages","totalPages","setPages","setPageLoadStates","setTotalPages","setCurrentPageIndex","retryFailedPagesKeyPrefix","setTransitionPageMode","readingMode","readingDirection","shouldUseInfiniteScroll","readerWidth","pageScaleMode","shouldOffsetDoubleSpreads","imagePreLoadAmount","pageGap","customFilter","shouldStretchPage","isStaticNav","readerNavBarWidth","transitionPageMode","setScrollbarXSize","setScrollbarYSize","isVisible","setIsVisible","updateCurrentPageIndex","showPreview","setShowPreview","initialChapter","currentChapter","chapters","visibleChapters","setReaderStateChapters","isCurrentChapterReady"]),xa=Object.fromEntries(Object.values(ft).map(e=>[e,{scopes:e}])),Q=(...e)=>{const[r,n,o,t]=e;return Nr(r,n,{...o,...xa.reader},t)},Vt=(e,r,n,o,t,a,l)=>{if(a){e(n,t[0]);return}const c=Xs(t.indexOf(o),t,l);if(c===void 0){r(n);return}e(n,c)},pa=({scrollElementRef:e})=>{const{direction:r}=nt(),n=L.useGetThemeDirection(),{enableScope:o,disableScope:t}=Es(),{manga:a}=We(),{isVisible:l,setIsVisible:c}=Bt(),{hotkeys:i,pageScaleMode:f,shouldStretchPage:u,shouldOffsetDoubleSpreads:h,readingMode:g,readingDirection:p,autoScroll:x,scrollAmount:S}=L.useSettings(),v=pt(),{setShowPreview:C}=_t(),R=L.useExit(),b=le.useOpenChapter(),w=le.useOpenPage(),T=L.useCreateUpdateSetting(a!=null?a:Me),E=L.useCreateDeleteSetting(a!=null?a:Me);return Q(i[J.PREVIOUS_PAGE],()=>w("previous"),[w]),Q(i[J.NEXT_PAGE],()=>w("next"),[w]),Q(i[J.SCROLL_BACKWARD],()=>{if(v.isActive){v.setDirection(St.BACKWARD);return}e.current&&le.scroll(St.BACKWARD,as[g.value],g.value,p.value,r,e.current,b,c,C,S)},{preventDefault:!0},[g.value,p.value,r,b,S,v.isActive]),Q(i[J.SCROLL_FORWARD],()=>{if(v.isActive){v.setDirection(St.FORWARD);return}e.current&&le.scroll(St.FORWARD,as[g.value],g.value,p.value,r,e.current,b,c,C,S)},{preventDefault:!0},[g.value,p.value,r,b,S,v.isActive]),Q(i[J.PREVIOUS_CHAPTER],()=>b(ce("previous","next",n)),[b,n]),Q(i[J.NEXT_CHAPTER],()=>b(ce("next","previous",n)),[b,n]),Q(i[J.TOGGLE_MENU],()=>c(!l),[l]),Q(i[J.CYCLE_SCALE_TYPE],()=>{Vt(T,E,"pageScaleMode",f.value,As,f.isDefault,!0)},[T,E,f.value,f.isDefault]),Q(i[J.STRETCH_IMAGE],()=>T("shouldStretchPage",!u.value),[T,u.value]),Q(i[J.OFFSET_SPREAD_PAGES],()=>T("shouldOffsetDoubleSpreads",!h.value),[T,h.value]),Q(i[J.CYCLE_READING_MODE],()=>{Vt(T,E,"readingMode",g.value,Os,g.isDefault,!0)},[T,E,g.value,g.isDefault]),Q(i[J.CYCLE_READING_DIRECTION],()=>{Vt(T,E,"readingDirection",p.value,Ls,p.isDefault,!0)},[T,E,p.value,p.isDefault]),Q(i[J.TOGGLE_AUTO_SCROLL],v.toggleActive,{preventDefault:!0},[v.toggleActive]),Q(i[J.AUTO_SCROLL_SPEED_DECREASE],()=>T("autoScroll",{...x,value:Math.min(ke.max,x.value+ke.step)}),[T,x.value]),Q(i[J.AUTO_SCROLL_SPEED_INCREASE],()=>T("autoScroll",{...x,value:Math.max(ke.min,x.value-ke.step)}),[T,x.value]),Q(i[J.EXIT_READER],R,[R]),d.useEffect(()=>(o(ft.READER),()=>t(ft.READER)),[]),null},ma=(e,r,n,o,t,a,l,c,i,f,u,h)=>{d.useEffect(()=>()=>{e(void 0),r(Et),n(0),o(null),t(0),a([Mr("",0)]),l([]),c([{url:"",loaded:!1}]),i(je.NONE),f(!1),u(Hr),h()},[])},va=(e,r,n,o,t,a)=>{var l;d.useEffect(()=>{var x;const c=(x=e.data)==null?void 0:x.manga;if(!c||r.loading||r.error)return;const i=is(c,n),f=Vr(c,i.shouldUseAutoWebtoonMode,i.readingMode),u={...n,readingMode:f?V.WEBTOON:n.readingMode},h=f?V.WEBTOON:i.readingMode.value,g=Wr("global",{meta:o},u,void 0,h),p=is(c,g);t(p),a(!0)},[(l=e.data)==null?void 0:l.manga,n])},bs=5e3,Sa=(e,r,n,o,t,a,l,c,i)=>{const{t:f}=G(),u=d.useRef(void 0),h=d.useRef(void 0),g=d.useRef(void 0),p=d.useRef(!0);d.useEffect(()=>{if(e||r||!n)return;const x=JSON.stringify(o)!==JSON.stringify(u.current);l&&x&&Bs(f(Gt[o.value].title),{autoHideDuration:bs}),u.current=o;const v=JSON.stringify(t)!==JSON.stringify(h.current)||JSON.stringify(a)!==JSON.stringify(g.current);c&&v&&(i(!0),p.current&&setTimeout(()=>i(!1),bs)),h.current=t,g.current=a,p.current=!1},[e,r,n,o.value,o.isDefault,t.value,t.isDefault,a.value,a.isDefault])},Ra=(e,r,n,o,t,a,l,c,i)=>{var p;const f=Fr(),u=Ms().state,{updateInitialChapter:h}=u!=null?u:{},g=h?void 0:o;d.useEffect(()=>{var E,D;const x=(E=e.data)==null?void 0:E.chapters.nodes,S=x?(D=x[x.length-r])!=null?D:null:void 0,v=g!=null?g:S,C=t!=null?t:S,R=(()=>{if(!x||!C)return[];const j=c?an(n!=null?n:x,i):x;return(l?ze.removeDuplicates(C,j):j).map(I=>Ur(I.id))})(),b=S&&ze.getNextChapter(S,R,{offset:wt.NEXT}),w=S&&ze.getNextChapter(S,R,{offset:wt.PREVIOUS}),T=v!=null&&v.id!==(g==null?void 0:g.id);T&&f("",{replace:!0,state:{...u,updateInitialChapter:void 0}}),a(j=>{var I,_,H,q;const O=(S==null?void 0:S.id)!==((I=j.currentChapter)==null?void 0:I.id);return{...j,mangaChapters:(_=j.mangaChapters)!=null?_:x,chapters:R,initialChapter:v,chapterForDuplicatesHandling:C,currentChapter:S,nextChapter:b,previousChapter:w,isCurrentChapterReady:O?!1:j.isCurrentChapterReady,visibleChapters:T?{...Et.visibleChapters,lastLeadingChapterSourceOrder:(H=v==null?void 0:v.sourceOrder)!=null?H:Et.visibleChapters.lastLeadingChapterSourceOrder,lastTrailingChapterSourceOrder:(q=v==null?void 0:v.sourceOrder)!=null?q:Et.visibleChapters.lastTrailingChapterSourceOrder,isLeadingChapterPreloadMode:!1,isTrailingChapterPreloadMode:!1,scrollIntoView:!!j.initialChapter}:j.visibleChapters}})},[(p=e.data)==null?void 0:p.chapters.nodes,r,l,c,g,i])},ba=({setOverride:e,readerNavBarWidth:r,isVisible:n,setIsVisible:o,manga:t,setManga:a,shouldSkipDupChapters:l,shouldSkipFilteredChapters:c,backgroundColor:i,readingMode:f,tapZoneLayout:u,tapZoneInvertMode:h,shouldShowReadingModePreview:g,shouldShowTapZoneLayoutPreview:p,setSettings:x,mangaChapters:S,initialChapter:v,chapterForDuplicatesHandling:C,currentChapter:R,setReaderStateChapters:b,setTotalPages:w,setCurrentPageIndex:T,setPageToScrollToIndex:E,setPages:D,setPageUrls:j,setPageLoadStates:O,setTransitionPageMode:I,cancelAutoScroll:_,setShowPreview:H})=>{var ve,ge,se;const{t:q}=G(),Z=d.useRef(null),[k,N]=d.useState(!1),{chapterSourceOrder:W,mangaId:M}=zr(),fe=Number(W),xe=Number(M),$=xt.useGetManga($r,xe),z=xt.useGetMangaChapters(Xr,xe);Tn(!t||!R?q("reader.title",{mangaId:xe,chapterIndex:fe}):"".concat(t.title,": ").concat(R.name));const{metadata:be,settings:X,request:de}=Yr(),pe=cn(t!=null?t:Me),ue=R===void 0||!k||$.loading||z.loading||de.loading,me=(ge=(ve=$.error)!=null?ve:z.error)!=null?ge:de.error;return d.useEffect(()=>{var ee;a((ee=$.data)==null?void 0:ee.manga)},[(se=$.data)==null?void 0:se.manga]),ma(a,b,T,E,w,D,j,O,I,o,x,_),va($,de,X,be,x,N),Sa(ue,me,k,f,u,h,g,p,H),Ra(z,fe,S,v,C,b,l,c,pe),d.useLayoutEffect(()=>(e({status:!0,value:s.jsxs(Y,{sx:{position:"absolute"},children:[s.jsx(pa,{scrollElementRef:Z}),s.jsx(No,{isVisible:n}),!Z.current&&s.jsx(Y,{onClick:()=>o(!n),sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"transparent"}})]})}),()=>e({status:!1,value:null})),[n,o,Z.current]),me?s.jsx(At,{message:q("global.error.label.failed_to_load_data"),messageExtra:ys(me),retry:()=>{$.error&&$.refetch().catch(bt()),de.error&&de.refetch().catch(bt()),z.error&&z.refetch().catch(bt())}}):ue?s.jsx(Y,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:s.jsx(It,{})}):R===null?s.jsx(At,{message:q("reader.error.label.chapter_not_found")}):!t||!R?null:s.jsxs(Y,{sx:{position:"relative",display:"flex",flexDirection:"column",width:"calc(100vw - ".concat(r,"px)"),height:"100vh",marginLeft:"".concat(r,"px"),transition:ee=>"width 0.".concat(ee.transitions.duration.shortest,"s, margin-left 0.").concat(ee.transitions.duration.shortest,"s"),overflow:"auto",backgroundColor:Ps[i]},children:[s.jsx(fa,{ref:Z}),s.jsx(Ho,{}),s.jsx(Wo,{})]})},oi=U(d.memo(ba),[$e,Bt,We,He,Gr,()=>{const{shouldSkipDupChapters:e,shouldSkipFilteredChapters:r,backgroundColor:n,shouldShowReadingModePreview:o,shouldShowTapZoneLayoutPreview:t}=L.useSettingsWithoutDefaultFlag();return{shouldSkipDupChapters:e,shouldSkipFilteredChapters:r,backgroundColor:n,shouldShowReadingModePreview:o,shouldShowTapZoneLayoutPreview:t}},()=>{const{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}=L.useSettings();return{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}},we,()=>({cancelAutoScroll:pt().cancel}),_t],["setOverride","readerNavBarWidth","isVisible","setIsVisible","manga","setManga","shouldSkipDupChapters","shouldSkipFilteredChapters","backgroundColor","readingMode","tapZoneLayout","tapZoneInvertMode","shouldShowReadingModePreview","shouldShowTapZoneLayoutPreview","setSettings","mangaChapters","initialChapter","chapterForDuplicatesHandling","currentChapter","setReaderStateChapters","setTotalPages","setCurrentPageIndex","setPageToScrollToIndex","setPages","setPageUrls","setPageLoadStates","setTransitionPageMode","cancelAutoScroll","setShowPreview"]);export{oi as Reader};
