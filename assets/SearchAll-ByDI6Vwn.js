import{u as N,d as G,q as H,e as D,s as I,f as O,r as P,g as i,j as r,i as Q,k as B,l as F,B as A,ao as V,A as W,L as z,T,ax as J}from"./index-YAtlvmGf.js";import{u as K,A as U,S as X}from"./AppbarSearch-BoByqyR3.js";import{L as Y,t as Z}from"./LanguageSelect-DPX26cVP.js";import{u as _}from"./useDebounce-CORSGS3S.js";import{B as ee}from"./BaseMangaGrid-CNYby2rY.js";import{E as re}from"./EmptyViewAbsoluteCentered-6ui_Uq2m.js";import{S as q}from"./Sources-Cq496VEG.js";import{C as se}from"./Card-BU1dYrjx.js";import{C as te}from"./CardActionArea-C9R1S_-n.js";import"./ChaptersDownloadActionMenuItems-DxsIq9z5.js";import"./Trackers-D4pSmk7a.js";import"./CardContent-Ci5UNtd0.js";import"./Avatar-BjP32HBi.js";import"./TextField-mKvu1Dg7.js";import"./useFormControl-BmhXecYK.js";import"./formControlState-Dq1zat_P.js";import"./InputAdornment-tKPrVGyD.js";import"./CheckCircle-18eXhBAn.js";import"./MUI.util-CRrI--AY.js";import"./Link-CIhSeZ5W.js";import"./useManageMangaLibraryState-jBzPXQI2.js";import"./ThreeStateCheckboxInput-DiN_J2UZ.js";import"./Checkbox-BATqlhXZ.js";import"./SwitchBase-C2GwZp-q.js";import"./CheckboxInput-iNLKxaC_.js";import"./FormGroup-uVVQ9wpS.js";import"./ListPreference-Div6ZTTs.js";import"./NumberSetting-Bxnjr-8f.js";import"./Slider-BQ2AI3Nb.js";import"./useMobilePicker-D-mHO_iZ.js";import"./Chip-CkH1aU2a.js";import"./SelectSetting-BwxSN0wH.js";import"./Select-imZ-AwMv.js";import"./FilterList-DJRw70o2.js";import"./Switch-dYYnEC4v.js";import"./MangaGrid-8EA-mGYc.js";import"./Delete-CG4c_Wcp.js";import"./Download-pWaRfNBn.js";import"./Sync-BVNfPxVk.js";import"./PlayArrow-DRVnzrY2.js";import"./StyledFab-N8e6bxem.js";const oe=(a,m)=>a.displayName.localeCompare(m.displayName),ae=(a,m,e)=>{const t=e.get(a.id),s=e.get(m.id),p=!(t!=null&&t.isLoading),c=!!(t!=null&&t.error),l=!(t!=null&&t.hasResults)&&!c,S=!(s!=null&&s.isLoading),n=!!(s!=null&&s.error),d=!(s!=null&&s.hasResults)&&!n;return p&&!S?-1:!p&&S||l&&!d?1:d&&!l||!c&&n?-1:c&&!n?1:0},ne=1e3,ie=V.memo(({source:a,onSearchRequestFinished:m,searchString:e,emptyQuery:t,mode:s})=>{var E,b;const{t:p}=N(),{id:c,displayName:l,lang:S}=a,n=i.useRef(e),d=i.useRef(()=>{});n.current!==e&&(n.current=e,d.current(new Error("SourceSearchPreview(".concat(c,", ").concat(l,"): search string changed"))));const[g,j]=P.useSourceSearch(c,e!=null?e:"",void 0,1,{skipRequest:!e,addAbortSignal:!0}),{data:x,isLoading:f,error:o,abortRequest:M}=j[0];d.current=M;const L=(b=(E=x==null?void 0:x.fetchSourceManga)==null?void 0:E.mangas)!=null?b:[],y=!o&&!f&&!L.length;i.useEffect(()=>{m(a,{isLoading:f,hasResults:!y,emptySearch:!e,error:o})},[f,y,e,o]);let h;return o?h=p("search.error.label.source_search_failed"):y&&(h=p("manga.error.label.no_mangas_found")),!f&&!e||t?null:r.jsxs(r.Fragment,{children:[r.jsx(se,{sx:{mb:1},children:r.jsxs(te,{component:z,to:"".concat(W.sources.childRoutes.browse.path(c),"?query=").concat(e),sx:{p:3},children:[r.jsx(T,{variant:"h5",children:l}),r.jsx(T,{variant:"caption",children:Z(S)})]})}),h?r.jsx(J,{sx:{alignItems:"start",height:void 0},noFaces:!0,message:h,messageExtra:B(o),retry:o?()=>g(1).catch(F("SourceSearchPreview(".concat(a.id,")::refetch"))):void 0}):r.jsx(ee,{gridWrapperProps:{sx:{px:0}},mangas:L,isLoading:f,hasNextPage:!1,loadMore:()=>{},horizontal:!0,noFaces:!0,message:h,inLibraryIndicator:!0,mode:s})]})}),Ke=()=>{const{t:a}=N(),{setTitle:m,setAction:e}=G(),{pathname:t,state:s}=H(),p=t.startsWith("/migrate/source"),c=s==null?void 0:s.mangaTitle,[l]=K("query",X),S=_(l,ne),[n,d]=D("shownSourceLangs",I()),{settings:{showNsfw:w}}=O(),{data:g,loading:j,error:x,refetch:f}=P.useGetSourceList({notifyOnNetworkStatusChange:!0}),o=i.useMemo(()=>{var u;return(u=g==null?void 0:g.sources.nodes)!=null?u:[]},[g==null?void 0:g.sources.nodes]),M=i.useMemo(()=>q.filter(o,{showNsfw:w,languages:n,keepLocalSource:!0}),[o,n]),L=i.useMemo(()=>[...M].toSorted(oe),[M]),[y,h]=i.useState(new Map),E=_(y,500),b=i.useMemo(()=>q.getLanguages(o),[o]),C=i.useMemo(()=>[...L].sort((u,R)=>ae(u,R,E)),[L,E]),k=i.useCallback(({id:u},R)=>{h($=>{const v=new Map($);return v.set(u,R),v})},[h]);return i.useLayoutEffect(()=>(m(a(p?"migrate.search.title":"search.title.global_search",{title:c})),e(r.jsxs(r.Fragment,{children:[r.jsx(U,{isClosable:!1}),r.jsx(Y,{selectedLanguages:n,setSelectedLanguages:d,languages:b})]})),()=>{m(""),e(null)}),[a,n,d,o]),j?r.jsx(Q,{}):x?r.jsx(re,{message:a("global.error.label.failed_to_load_data"),messageExtra:B(x),retry:()=>f().catch(F())}):r.jsx(A,{sx:{p:1},children:C.map((u,R)=>r.jsx(A,{sx:{pb:R+1!==C.length?2:0},children:r.jsx(ie,{source:u,onSearchRequestFinished:k,searchString:S,emptyQuery:!l,mode:p?"migrate.select":"source"})},u.id))})};export{Ke as SearchAll};
