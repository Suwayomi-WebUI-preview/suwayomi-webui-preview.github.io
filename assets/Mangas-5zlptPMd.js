import{bN as T,bO as D,r as u,bP as U,bQ as v,bM as I,aD as L,G as O,m as k,g as G,bR as B}from"./index-BgB0VFLg.js";import{b as _,C as W,a as m}from"./Chapters-BlNkX6Vj.js";import{a as P}from"./Asserts-xItX73wb.js";var o=function(g){return g[g.MANGA=0]="MANGA",g[g.COMIC=1]="COMIC",g[g.WEBTOON=2]="WEBTOON",g[g.MANHWA=3]="MANHWA",g[g.MANHUA=4]="MANHUA",g}({});const V={id:-1},Y={id:-2},K="1 / 1.5",X={[T.Cancelled]:{id:"vv7kpg"},[T.Completed]:{id:"qqWcBV"},[T.Licensed]:{id:"TEl87L"},[T.Ongoing]:{id:"J6n7sl"},[T.OnHiatus]:{id:"VIPoy2"},[T.PublishingFinished]:{id:"bVVRMk"},[T.Unknown]:{id:"Ef7StM"}},F={..._,remove_from_library:{always:!0,bulkAction:!0},change_categories:{always:!1,bulkAction:!1},migrate:{always:!1,bulkAction:!1},track:{always:!1,bulkAction:!1}},R={...W,remove_from_library:{action:{single:{id:"mfwy3x"},selected:{id:"KxYWvv"}},confirmation:{id:"4e5fWk"},success:{id:"weSL4s"},error:{id:"ScjE3w"}},change_categories:{action:{single:{id:"8q9LgC"},selected:{id:"X9czI3"}},confirmation:{id:"huuRa7"},success:{id:"mSZq9u"},error:{id:"tdyb5X"}},migrate:{action:{single:{id:"y5rS9U"},selected:{id:"y5rS9U"}},success:{id:"sogdbA"},error:{id:"bZ8iYS"}},track:{action:{single:{id:"J2ZTMa"},selected:{id:"J2ZTMa"}},success:{id:"hg1vrh"},error:{id:"t0VaCQ"}}},H={[o.MANGA]:[],[o.COMIC]:["8muses","allporncomic","ciayo comics","comicextra","comicpunch","cyanide","dilbert","eggporncomics","existential comics","hiveworks comics","milftoon","myhentaicomics","myhentaigallery","gunnerkrigg","oglaf","patch friday","porncomix","questionable content","readcomiconline","read comics online","swords comic","teabeer comics","xkcd"],[o.WEBTOON]:["mangatoon","manmanga","toomics","webcomics","webtoons","webtoon"],[o.MANHWA]:["hiperdex","hmanhwa","instamanhwa","manhwa18","manhwa68","manhwa365","manhwahentaime","manhwamanga","manhwatop","manhwa","manytoon","manwha","readmanhwa","skymanga","toonily","webtoonxyz"],[o.MANHUA]:["1st kiss manhua","hero manhua","manhuabox","manhuaus","manhuas","manhuas","readmanhua","wuxiaworld","manhua"]},x={[o.MANGA]:[{id:"uB8LjK"}],[o.COMIC]:[{id:"bNwUml"}],[o.WEBTOON]:[{id:"xU2hUU"},{id:"/frIrr"}],[o.MANHWA]:[{id:"pKMQbg"},{id:"/frIrr"}],[o.MANHUA]:[{id:"XBEQli"},{id:"/frIrr"}]},M=/\s*[,|ã€]\s*/;class a{static getIds(e){return e.map(t=>t.id)}static getFromCache(e,t=D,r="MANGA_BASE_FIELDS"){return u.graphQLClient.client.cache.readFragment({id:u.graphQLClient.client.cache.identify({__typename:"MangaType",id:e}),fragment:t,fragmentName:r})}static isNotDownloaded({downloadCount:e}){return e===0}static getNotDownloaded(e){return e.filter(a.isNotDownloaded)}static isFullyDownloaded({downloadCount:e,chapters:{totalCount:t}}){return e===t}static getFullyDownloaded(e){return e.filter(a.isFullyDownloaded)}static isPartiallyDownloaded(e){return!a.isNotDownloaded(e)&&!a.isFullyDownloaded(e)}static getPartiallyDownloaded(e){return e.filter(a.isPartiallyDownloaded)}static isUnread({unreadCount:e,chapters:{totalCount:t}}){return e===t}static getUnread(e){return e.filter(a.isUnread)}static isFullyRead({unreadCount:e}){return e===0}static getFullyRead(e){return e.filter(a.isFullyRead)}static isPartiallyRead(e){return!a.isUnread(e)&&!a.isFullyRead(e)}static getPartiallyRead(e){return e.filter(a.isPartiallyRead)}static getThumbnailUrl(e){var r;const t=U.addParams((r=e.thumbnailUrl)!=null?r:"",{fetchedAt:e.thumbnailUrlLastFetched,sourceId:e.sourceId});return u.getValidImgUrlFor(t)}static getDuplicateLibraryMangas(e){return u.getMangas(v,{condition:{inLibrary:!0},filter:{title:{likeInsensitive:e}}})}static async getChapterIdsWithState(e,t){const{data:r}=await u.getMangasChapterIdsWithState(e,t).response;return r.chapters.nodes}static async downloadChapters(e,{size:t,onlyUnread:r,downloadAhead:n=!1}={},i){const[c,d]=await Promise.all([a.getChapterIdsWithState(e,{isRead:r?!1:void 0,isDownloaded:!1}),n?a.getChapterIdsWithState(e,{isRead:!1,isDownloaded:!0}):[]]),h=e.map(A=>[String(A),t]),l=Object.groupBy(c,({mangaId:A})=>A),s=Object.groupBy(d,({mangaId:A})=>A),C=Object.entries(s).map(([A,y=[]])=>{const f=Math.max(0,(t!=null?t:y.length)-y.length);return[A,n?f:t]}),w=Object.entries(Object.fromEntries([...h,...C])).map(([A,y])=>{var S;const f=(S=l[Number(A)])!=null?S:[];if(!f.length)return[];if(y===void 0)return f;const N=m.removeDuplicates(f[0],f).slice(0,y);return m.addDuplicates(N,f)}).flat();return w.length?m.download(m.getIds(w),i):Promise.resolve()}static async deleteChapters(e,t){const r=await a.getChapterIdsWithState(e,{isDownloaded:!0});return m.delete(m.getIds(r),t)}static async markAsRead(e,t=!1,r){const n=await a.getChapterIdsWithState(e,{isRead:!1});return m.markAsRead(n,t,e.length===1?e[0]:void 0,r)}static async markAsUnread(e,t){const r=await a.getChapterIdsWithState(e,{isRead:!0});return m.markAsUnread(m.getIds(r),t)}static async removeFromLibrary(e,t){const{removeMangaFromCategories:r}=await I();return a.executeAction("remove_from_library",e.length,()=>u.updateMangas(e,{updateMangas:{inLibrary:!1},updateMangasCategories:r?{clearCategories:!0}:void 0}).response,t)}static async changeCategories(e,t,r){return a.executeAction("change_categories",e.length,()=>u.updateMangasCategories(e,t).response,r)}static migrateChapters(e,t,r,n){var s,C;if(!t.chapters||!((s=r.fetchChapters)!=null&&s.chapters))throw new Error("Chapters are missing");const i=t.chapters.nodes,c=(C=r.fetchChapters)==null?void 0:C.chapters,d=m.getMatchingChapterNumberChapters(i,c),h=[],l=[];return d.forEach(([p,w])=>{const{isRead:A,isBookmarked:y}=p;A&&h.push(w.id),y&&l.push(w.id)}),{copy:()=>[h.length&&u.updateChapters(h,{isRead:!0}).response,l.length&&u.updateChapters(l,{isBookmarked:!0}).response].filter(p=>!!p),cleanup:()=>{var p,w;return e==="migrate"?[n?u.deleteDownloadedChapters(m.getIds(m.getDownloaded((w=(p=t.chapters)==null?void 0:p.nodes)!=null?w:[]))).response:Promise.resolve()]:[]}}}static migrateTracking(e,t,r){if(!t.trackRecords)throw new Error("TrackRecords of manga to migrate are missing");if(!r.trackRecords)throw new Error("TrackRecords of manga to migrate to are missing");const n=t.trackRecords.nodes.filter(i=>{var c;return(c=r.trackRecords)==null?void 0:c.nodes.every(d=>i.remoteId!==d.remoteId)});return{copy:()=>n.map(i=>u.bindTracker(r.id,i.trackerId,i.remoteId,i.private).response),cleanup:()=>{var i,c;return e==="migrate"?(c=(i=t.trackRecords)==null?void 0:i.nodes.map(d=>u.unbindTracker(d.id).response))!=null?c:[]:[]}}}static migrateManga(e,t,r,n,i){if(n&&!(t!=null&&t.categories))throw new Error("Categories are missing");return{copy:()=>{var c;return[u.updateManga(r.id,{updateManga:{inLibrary:!0},updateMangaCategories:n?{addToCategories:(c=t.categories)==null?void 0:c.nodes.map(d=>d.id)}:void 0}).response]},cleanup:()=>e==="migrate"?[u.updateManga(t.id,{updateManga:{inLibrary:!1},updateMangaCategories:i?{clearCategories:!0}:void 0}).response]:[]}}static async migrate(e,t,{mode:r,migrateChapters:n,migrateCategories:i,migrateTracking:c,deleteChapters:d},h){return a.executeAction("migrate",1,async()=>{var A,y;const[{data:l},{data:s},{removeMangaFromCategories:C}]=await Promise.all([u.getMangaToMigrate(e,{migrateChapters:n,migrateCategories:i,migrateTracking:c,deleteChapters:d}).response,u.getMangaToMigrateToFetch(t,{migrateChapters:n,migrateCategories:i,migrateTracking:c,apolloOptions:{errorPolicy:"all"}}).response,I()]);if(!l.manga||!((A=s==null?void 0:s.fetchManga)!=null&&A.manga))throw new Error("Mangas::migrate: missing manga data");if(n&&!l.manga.chapters)throw new Error("Mangas::migrate: missing chapters data");(y=s.fetchChapters)!=null&&y.chapters||(s.fetchChapters={chapters:[]});const p=async(f,...b)=>Promise.all(b.map(E=>E[f]()).flat());await(async(...f)=>{const b=["copy","cleanup"],E=f.filter(([N])=>N).map(([,N])=>N());for(const N of b)await p(N,...E)})([n,()=>a.migrateChapters(r,l.manga,s,!!d)],[c,()=>a.migrateTracking(r,l.manga,s.fetchManga.manga)],[!0,()=>a.migrateManga(r,l.manga,s.fetchManga.manga,!!i,C)])},h)}static async executeAction(e,t,r,n){const{always:i,bulkAction:c,bulkActionCountForce:d}=F[e],h=!n&&(i||c&&t>1||d&&t>=d),l=R[e].confirmation;try{if(h){P(l);try{await L.show({title:O._({id:"6foA8n"}),message:O.t({...l,values:{count:t}}),actions:{confirm:{title:O._({id:"aP3N/0"})}}})}catch(s){return}}await r(),k(O.t({...R[e].success,values:{count:t}}),"success")}catch(s){throw k(O.t({...R[e].error,values:{count:t}}),"error",G(s)),s}}static async performAction(e,t,{wasManuallyMarkedAsRead:r,changeCategoriesPatch:n,mangaIdToMigrateTo:i,downloadAhead:c,onlyUnread:d,size:h,...l},s){switch(e){case"download":return a.downloadChapters(t,{downloadAhead:c,onlyUnread:d,size:h},s);case"delete":return a.deleteChapters(t,s);case"mark_as_read":return a.markAsRead(t,r,s);case"mark_as_unread":return a.markAsUnread(t,s);case"remove_from_library":return a.removeFromLibrary(t,s);case"change_categories":return a.changeCategories(t,n,s);case"migrate":return a.migrate(t[0],i,l,s);default:throw new Error('Mangas::performAction: unknown action "'.concat(e,'"'))}}static getType(e){return a.isType(e,o.MANGA)?o.MANGA:a.isType(e,o.COMIC)?o.COMIC:a.isType(e,o.WEBTOON)?o.WEBTOON:a.isType(e,o.MANHWA)?o.MANHWA:a.isType(e,o.MANHUA)?o.MANHUA:o.MANGA}static isType(e,t){var d,h;const r=Object.entries(x).map(([l,s])=>{var C;return[l,[B,O.locale,(C=e.source)==null?void 0:C.lang].filter(p=>!!p).flatMap(p=>s.flatMap(w=>O.t({...w,values:{lng:p}})))]}),n=Object.fromEntries(r),i=e.genre.some(l=>n[t].some(s=>l.toLowerCase().includes(s.toLowerCase()))),c=H[t].includes((h=(d=e.source)==null?void 0:d.name.toLowerCase())!=null?h:"");return i||c}static isLongStripType(e){return a.isType(e,o.WEBTOON)||a.isType(e,o.MANHWA)||a.isType(e,o.MANHUA)}static getArtists(e){var t;return(t=e.artist)==null?void 0:t.split(M)}static getAuthors(e){var t;return(t=e.author)==null?void 0:t.split(M)}static createLocationState(e,t){return{mangaTitle:e.title,mode:t}}}export{V as F,Y as G,K as M,a,R as b,X as c};
