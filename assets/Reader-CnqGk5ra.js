import{cA as Es,d as c,cB as gt,cC as Me,cv as A,j as s,D as Vt,ad as m,n as Wt,cD as Js,cE as F,cF as et,s as ze,cG as wt,cH as Ce,cI as ye,cJ as Qs,cK as at,cL as Ft,S as _,o as $,T as qe,aV as er,cM as tr,aX as sr,c9 as yt,Z as $e,a7 as Xt,cN as Se,C as z,cO as Ts,cP as de,z as Xe,cQ as V,bI as le,cR as Ee,cS as rr,a as kt,b as nr,cl as or,cT as ar,cU as ir,cV as cr,cm as lr,cr as dr,ae as tt,cW as Jt,aY as Je,cX as Qt,cY as js,c as ue,bM as ut,A as Yt,L as Ot,u as U,bV as Cs,cZ as ws,ap as Rt,ag as bt,a4 as Et,bY as ur,aj as gr,B as Qe,c_ as hr,c$ as es,d0 as Os,d1 as Ut,d2 as As,d3 as fr,d4 as xr,d5 as ts,d6 as Ls,d7 as ht,d8 as Pe,ct as ot,d9 as Ge,k as Ds,I as re,_ as Ue,da as Gt,db as ke,dc as Is,bW as pr,bX as mr,bh as vr,f as At,aO as Sr,dd as Kt,a5 as Rr,a6 as br,m as Bs,de as dt,df as Lt,aa as ss,dg as Dt,dh as Er,di as Nt,dj as Tr,dk as Tt,dl as jr,dm as _s,dn as Cr,dp as Te,b4 as _e,dq as wr,dr as je,ds as Ne,dt as Or,du as Ps,dv as Ar,dw as Lr,r as zt,dx as pt,dy as Dr,dz as Ir,i as vt,dA as Br,dB as _r,h as ys,dC as ks,dD as Ns,dE as Pr,dF as yr,p as Ms,dG as rs,M as ns,dH as kr,dI as Nr,dJ as lt,dK as q,dL as os,dM as as,bk as Mr,dN as St,dO as Hr,dP as Vr,dQ as is,dR as Wr,dS as Fr,e as Ur,dT as Gr,as as zr,dU as $r,dV as Xr,dW as Yr}from"./index-D2_dCMBF.js";import{R as Kr,S as Zr,D as qr,a as Jr,b as Qr,c as en}from"./ReaderSettingsTabs-CsV2EcoN.js";import{L as $t}from"./Link-Bg3AmDhN.js";import{S as Hs}from"./Select-D8FEiwW7.js";import{b as Vs,C as tn,B as sn}from"./CustomButtonIcon-DUh1a8vc.js";import{a as Ws,I as Fs,T as rn}from"./TextField-kswmo9A1.js";import{K as nn}from"./MUI.util-DDPpK_AC.js";import{I as on}from"./InputAdornment-Dl9od6QX.js";import{O as an}from"./OpenInNew-CtaOaRH0.js";import{D as cn}from"./Download-Bd4eVTbT.js";import{D as ln}from"./Delete-1cwdsCH_.js";import{D as dn}from"./ChapterCardMetadata-BTA0qdR2.js";import{F as un}from"./Favorite-U9daTCWE.js";import{a as gn,F as hn,g as fn}from"./useManageMangaLibraryState-D9P1Mjfm.js";import{C as xn}from"./CheckboxInput-BoA396dr.js";import{E as jt}from"./EmptyViewAbsoluteCentered-rO8MR0G-.js";import{u as pn}from"./use-window-event-Bej1hT64.js";import{u as mn}from"./use-merged-ref-Dg2Oxsao.js";import{u as vn}from"./useAppTitle-_3PqlVnx.js";import"./TabsMenu-B0jEY_7I.js";import"./Tabs-RSlghRpX.js";import"./Trans-B8OhCWzz.js";import"./Slider-Ds2-YWnr.js";import"./ListSubheader-DO3FARPZ.js";import"./Add-Bfc115A7.js";import"./ListCardContent-CUni8eKh.js";import"./Card-CKffCtS2.js";import"./CardActionArea-4qMvHVwC.js";import"./Checkbox-ngyJ9_M3.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-BBRgs61F.js";import"./SwitchBase-C-QbNHM0.js";import"./ThreeStateCheckboxInput-B96qeOI4.js";import"./FormGroup-CF4jN-FP.js";const Sn=e=>{const{activeScopes:r,enableScope:n,disableScope:o}=Es(),t=c.useRef([]);c.useEffect(()=>e?(t.current=[...r],n(gt.NONE),t.current.forEach(o),()=>{o(gt.NONE),t.current.forEach(n)}):()=>{},[e])},Rn=({isOpen:e,close:r})=>{const{manga:n}=Me(),o=A.useSettings();Sn(e);const[t,a]=c.useState(0),[l,d]=c.useState(!1);return!n||!e?null:s.jsx(Vt,{open:e,maxWidth:"md",fullWidth:!0,onClose:r,hideBackdrop:t===Js.FILTER,sx:{...m(l,{opacity:.75})},children:s.jsx(Wt,{sx:{p:0},children:s.jsx(Kr,{activeTab:t,setActiveTab:a,settings:o,updateSetting:(...i)=>A.updateSetting(n,...i),deleteSetting:(...i)=>A.deleteSetting(n,...i),setTransparent:d})})})},bn=({isDesktop:e,scrollbarXSize:r,readerNavBarWidth:n,isMaximized:o,currentPageIndex:t,pages:a,totalPages:l,progressBarType:d,shouldShowPageNumber:i,readingDirection:f})=>{const u=c.useMemo(()=>{const h=ye(t,a).name,g="/",x="".concat(h).concat(g).concat(l);return f===at.LTR?x:Qs(x,g)},[t,a,l,f]);return!i||o||e&&d===Ft.STANDARD||o&&d===Ft.HIDDEN?null:s.jsx(_,{sx:{position:"fixed",left:n,right:0,bottom:h=>"max(calc(".concat(h.spacing(1)," + ").concat(r,"px), env(safe-area-inset-bottom))"),alignItems:"center",transition:h=>"left 0.".concat(h.transitions.duration.shortest,"s")},children:s.jsx($,{sx:{p:.5,borderRadius:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:s.jsx(qe,{sx:{color:"white"},children:u})})})},En=F(bn,[A.useOverlayMode,et,ze,wt,Ce,A.useSettingsWithoutDefaultFlag],["isDesktop","scrollbarXSize","readerNavBarWidth","isMaximized","currentPageIndex","pages","totalPages","progressBarType","shouldShowPageNumber","readingDirection"]);function cs(e){return e.substring(2).toLowerCase()}function Tn(e,r){return r.documentElement.clientWidth<e.clientX||r.documentElement.clientHeight<e.clientY}function jn(e){const{children:r,disableReactTree:n=!1,mouseEvent:o="onClick",onClickAway:t,touchEvent:a="onTouchEnd"}=e,l=c.useRef(!1),d=c.useRef(null),i=c.useRef(!1),f=c.useRef(!1);c.useEffect(()=>(setTimeout(()=>{i.current=!0},0),()=>{i.current=!1}),[]);const u=er(tr(r),d),h=sr(p=>{const R=f.current;f.current=!1;const S=yt(d.current);if(!i.current||!d.current||"clientX"in p&&Tn(p,S))return;if(l.current){l.current=!1;return}let C;p.composedPath?C=p.composedPath().includes(d.current):C=!S.documentElement.contains(p.target)||d.current.contains(p.target),!C&&(n||!R)&&t(p)}),g=p=>R=>{f.current=!0;const S=r.props[p];S&&S(R)},x={ref:u};return a!==!1&&(x[a]=g(a)),c.useEffect(()=>{if(a!==!1){const p=cs(a),R=yt(d.current),S=()=>{l.current=!0};return R.addEventListener(p,h),R.addEventListener("touchmove",S),()=>{R.removeEventListener(p,h),R.removeEventListener("touchmove",S)}}},[h,a]),o!==!1&&(x[o]=g(o)),c.useEffect(()=>{if(o!==!1){const p=cs(o),R=yt(d.current);return R.addEventListener(p,h),()=>{R.removeEventListener(p,h)}}},[h,o]),c.cloneElement(r,x)}const ls=$e(qe)({boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",textAlign:"center",userSelect:"none",cursor:"pointer"}),Cn=$e(_,{shouldForwardProp:Xt(["progressBarPosition"])})(({theme:e,progressBarPosition:r})=>({position:"fixed",pointerEvents:"all",touchAction:"none",...m(Se(r).isHorizontal,{justifyContent:"flex-end",bottom:0,right:0}),...m(Se(r).isVertical,{top:0,bottom:0}),...m(Se(r).isLeft,{alignItems:e.direction==="ltr"?"flex-start":"flex-end"}),...m(Se(r).isRight,{alignItems:e.direction==="ltr"?"flex-end":"flex-start"})})),wn=$e(_)(({theme:e})=>({flexDirection:"row",justifyContent:"center",alignItems:"center",gap:e.spacing(.5)})),On=$e(_)({flexDirection:"row",flexGrow:1,overflow:"hidden"}),An=$e($,{shouldForwardProp:Xt(["currentPagesIndex","pagesLength","progressBarPosition"])})(({currentPagesIndex:e,pagesLength:r,progressBarPosition:n})=>({position:"absolute",pointerEvents:"none",...m(Se(n).isHorizontal,{left:0,width:"".concat((e+1)/r*100,"%"),height:"100%"}),...m(Se(n).isVertical,{top:0,width:"100%",height:"".concat((e+1)/r*100,"%")})})),Ln=({pageName:e,currentPagesIndex:r,pagesLength:n,isDragging:o,boxProps:t,children:a,progressBarPosition:l})=>s.jsx(z,{title:e,slotProps:{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}},placement:Ts[l],children:s.jsx($,{...t,sx:{position:"absolute",cursor:o?"grabbing":"grab",...m(Se(l).isHorizontal,{left:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"calc(100% / ".concat(n-1,")"),height:"100%"}),...m(Se(l).isVertical,{top:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"100%",height:"calc(100% / ".concat(n-1,")")}),...t==null?void 0:t.sx},children:a})}),Dn=$e(_)({position:"relative",flexDirection:"row",flexGrow:1}),In=c.memo($e($,{shouldForwardProp:Xt(["isFirstPage","isLastPage"])})(({isFirstPage:e,isLastPage:r})=>({flexGrow:1,height:"100%",cursor:"pointer",borderLeftWidth:e?0:void 0,borderRightWidth:r?0:void 0}))),Bn=c.memo(({page:e,pagesIndex:r,isCurrentPage:n,isLeadingPage:o,isTrailingPage:t,totalPages:a,showDraggingStyle:l,primaryPageLoadState:d,secondaryPageLoadState:i,createProgressBarSlot:f,...u})=>{const h=c.useMemo(()=>f(e,r,d,i,n,o,t,a,l),[f,e,r,d,i,n,o,t,a,l]);return s.jsx(In,{...u,isFirstPage:r===0,isLastPage:r===a-1,children:h})}),_n=({totalPages:e,pages:r,pageLoadStates:n,currentPageIndex:o,slotProps:t,slots:a,createProgressBarSlot:l,progressBarPosition:d,readingMode:i,isDragging:f,setIsDragging:u,openPage:h,direction:g,fullSegmentClicks:x})=>{var O,y,P,G,ge,k,M,W,B,ne,K,oe,Y,ee,N,Re,ae,he,we,pe,Q,Oe,Ae,me,Le,fe,He,De,st,Ie,Ve,ie;const p=c.useRef(null),R=c.useRef(void 0),[S,C]=c.useState(0),v=c.useRef(null);Xe(v,c.useCallback(()=>{const I=v.current;if(!I)return;const{paddingLeft:X,paddingRight:Ye}=getComputedStyle(I),We=6,Z=I.clientWidth-parseFloat(X)-parseFloat(Ye),Be=i===V.DOUBLE_PAGE?Z*2+We:Z;C(Be)},[i]));const b=c.useMemo(()=>ye(o,r).pagesIndex,[o,r]),j=Se(d).isHorizontal,E=c.useMemo(()=>ye(o,r),[o,r]),T=c.useCallback((...I)=>le(I[0],I[1],g),[g]);de.useHandleProgressDragging(h,p,f,E,r,d,T,x);const L=I=>{if(!p.current)return;const X="touches"in I;h(Ee(rr(X?I.touches[0]:I,p.current,r,j,x,T)),void 0,!1),clearTimeout(R.current),R.current=setTimeout(()=>u(!0),250)},D=()=>{u(!1),clearTimeout(R.current)};return s.jsx(Cn,{...t==null?void 0:t.container,progressBarPosition:d,children:s.jsxs(wn,{...t==null?void 0:t.progressBarRoot,children:[s.jsx(ls,{...(O=t==null?void 0:t.progressBarPageTexts)==null?void 0:O.base,...(y=t==null?void 0:t.progressBarPageTexts)==null?void 0:y.current,sx:[{width:"".concat(S,"px")},...Array.isArray((G=(P=t==null?void 0:t.progressBarPageTexts)==null?void 0:P.base)==null?void 0:G.sx)?(M=(k=(ge=t==null?void 0:t.progressBarPageTexts)==null?void 0:ge.base)==null?void 0:k.sx)!=null?M:[]:[(B=(W=t==null?void 0:t.progressBarPageTexts)==null?void 0:W.base)==null?void 0:B.sx],...Array.isArray((K=(ne=t==null?void 0:t.progressBarPageTexts)==null?void 0:ne.current)==null?void 0:K.sx)?(ee=(Y=(oe=t==null?void 0:t.progressBarPageTexts)==null?void 0:oe.current)==null?void 0:Y.sx)!=null?ee:[]:[(Re=(N=t==null?void 0:t.progressBarPageTexts)==null?void 0:N.current)==null?void 0:Re.sx]],onClick:()=>h("previous","ltr",!1),children:E.name}),s.jsx(jn,{onClickAway:()=>u(!1),children:s.jsxs(Dn,{...t==null?void 0:t.progressBarSlotsActionArea,onMouseDown:L,onMouseUp:D,onTouchStart:L,onTouchEnd:D,children:[s.jsxs(On,{ref:p,...t==null?void 0:t.progressBarSlotsContainer,children:[r.map((I,X)=>c.createElement(Bn,{...t==null?void 0:t.progressBarSlot,key:I.primary.index,page:I,pagesIndex:X,isCurrentPage:X===b,isLeadingPage:X<b,isTrailingPage:X>b,totalPages:r.length,primaryPageLoadState:n[I.primary.index].loaded,secondaryPageLoadState:I.secondary?n[I.secondary.index].loaded:void 0,createProgressBarSlot:l,showDraggingStyle:X===b&&f})),s.jsx(An,{...t==null?void 0:t.progressBarReadPages,currentPagesIndex:E.pagesIndex,pagesLength:r.length,progressBarPosition:d})]}),s.jsx(Ln,{boxProps:t==null?void 0:t.progressBarCurrentPageSlot,pageName:E.name,currentPagesIndex:E.pagesIndex,pagesLength:r.length,isDragging:f,progressBarPosition:d,children:a==null?void 0:a.progressBarCurrentPage})]})}),s.jsx(ls,{ref:v,...(ae=t==null?void 0:t.progressBarPageTexts)==null?void 0:ae.base,...(he=t==null?void 0:t.progressBarPageTexts)==null?void 0:he.total,sx:[{minWidth:"unset"},...Array.isArray((pe=(we=t==null?void 0:t.progressBarPageTexts)==null?void 0:we.base)==null?void 0:pe.sx)?(Ae=(Oe=(Q=t==null?void 0:t.progressBarPageTexts)==null?void 0:Q.base)==null?void 0:Oe.sx)!=null?Ae:[]:[(Le=(me=t==null?void 0:t.progressBarPageTexts)==null?void 0:me.base)==null?void 0:Le.sx],...Array.isArray((He=(fe=t==null?void 0:t.progressBarPageTexts)==null?void 0:fe.total)==null?void 0:He.sx)?(Ie=(st=(De=t==null?void 0:t.progressBarPageTexts)==null?void 0:De.total)==null?void 0:st.sx)!=null?Ie:[]:[(ie=(Ve=t==null?void 0:t.progressBarPageTexts)==null?void 0:Ve.total)==null?void 0:ie.sx]],onClick:()=>h("next","ltr",!1),children:e})]})})},Us=F(c.memo(_n),[wt,()=>({openPage:de.useOpenPage()}),Ce,A.useSettingsWithoutDefaultFlag],["isDragging","setIsDragging","openPage","pages","pageLoadStates","totalPages","currentPageIndex","readingMode"]),Pn=c.forwardRef(({direction:e,...r},n)=>{const[o]=kt("appTheme","default"),[t]=kt("themeMode",dr.SYSTEM),[a]=kt("pureBlackMode",!1),{settings:{customThemes:l}}=nr(),d=c.useMemo(()=>or(t,ar(o,l),a,e),[t,o,l,a,e]);return s.jsx(ir,{value:cr[e],children:s.jsx(lr,{theme:d,children:s.jsx($,{...r,ref:n,dir:e})})})}),Gs=F(Pn,[()=>({direction:A.useGetThemeDirection()})],["direction"]),zs=c.memo(({pageName:e,progressBarPosition:r,slotProps:n,children:o})=>{var t;return s.jsx(z,{...n==null?void 0:n.tooltip,title:e,placement:Ts[r],children:s.jsx($,{...n==null?void 0:n.box,sx:{width:"100%",height:"100%",...(t=n==null?void 0:n.box)==null?void 0:t.sx},children:o})})}),yn=c.memo(({pageName:e,primaryPageLoadState:r,secondaryPageLoadState:n,progressBarPosition:o,isCurrentPage:t,isLeadingPage:a,showDraggingStyle:l})=>{const d=tt();return s.jsx(zs,{pageName:e,progressBarPosition:o,slotProps:{box:{sx:{cursor:"pointer",backgroundColor:Jt(d.palette.background.paper,.2),...d.applyStyles("dark",{backgroundColor:Qt(d.palette.background.paper,.1)}),...m(r&&(n==null||n),{backgroundColor:Jt(d.palette.background.paper,.35),...d.applyStyles("dark",{backgroundColor:Qt(d.palette.background.paper,.25)})})}},tooltip:{slotProps:t?{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}}:void 0}},children:s.jsx($,{sx:{width:"100%",height:"100%",...m(a,{backgroundColor:Je(d.palette.primary.main,.5)}),...m(t,{cursor:l?"grabbing":"grab",pointer:"grabbing",borderRadius:2,backgroundColor:"primary.dark",...d.applyStyles("dark",{backgroundColor:"primary.light"})})}})})}),kn=({readerNavBarWidth:e,isMaximized:r,setIsMaximized:n,isDragging:o,progressBarType:t,progressBarSize:a,progressBarPosition:l,progressBarPositionAutoVertical:d,readerDirection:i,scrollbarXSize:f,scrollbarYSize:u,totalPages:h})=>{const g=tt(),[,x]=c.useState({});Xe(window.document.documentElement,c.useCallback(()=>x({}),[]));const p=js(l,d,u,e+f),{isBottom:R,isLeft:S,isRight:C,isVertical:v,isHorizontal:b}=Se(p),j=!!h,E=t===Ft.HIDDEN,T=!r&&!o;return s.jsx(Gs,{children:s.jsx(Us,{direction:b?i:"ltr",progressBarPosition:p,fullSegmentClicks:!0,createProgressBarSlot:c.useCallback((L,D,O,y,P,G,ge,k,M)=>s.jsx(yn,{pageName:L.name,primaryPageLoadState:O,secondaryPageLoadState:y,progressBarPosition:p,isCurrentPage:P,isLeadingPage:G,showDraggingStyle:M}),[p]),slotProps:{container:{sx:{overflow:"hidden",transition:"all 0.".concat(g.transitions.duration.shortest,"s"),...m(b,{minHeight:"100px",...m(g.direction==="ltr",{left:i==="ltr"?e:u,right:i==="rtl"?e:u}),...m(g.direction==="rtl",{left:i==="rtl"?e:u,right:i==="ltr"?e:u})}),...m(v,{minWidth:"100px",bottom:"".concat(f,"px")}),...m(R,{bottom:"".concat(f,"px")}),...m(S,{...m(g.direction==="ltr",{left:i==="ltr"?e:"unset",right:i==="rtl"?e:"unset"}),...m(g.direction==="rtl",{right:i==="rtl"?u:"unset",left:i==="ltr"?u:"unset"})}),...m(C,{...m(g.direction==="ltr",{right:i==="ltr"?u:"unset",left:i==="rtl"?u:"unset"}),...m(g.direction==="rtl",{left:i==="rtl"?e:"unset",right:i==="ltr"?e:"unset"})}),...m(T,{opacity:E?0:.85}),...m(!j,{pointerEvents:"none"})},onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},progressBarRoot:{sx:{gap:0,transition:"all 0.1s ease-in-out",backgroundColor:"background.paper",...m(v,{flexDirection:"column",height:"100%"}),...m(T,{backgroundColor:"unset",pointerEvents:"none",...m(b,{px:2}),...m(v,{py:2}),...m(R,{pb:.25}),...m(S,{...m(g.direction==="ltr",{pl:i==="ltr"?.25:0,pr:i==="rtl"?.25:0}),...m(g.direction==="rtl",{pr:i==="rtl"?.25:0,pl:i==="ltr"?.25:0})}),...m(C,{...m(g.direction==="ltr",{pr:i==="ltr"?.25:0,pl:i==="rtl"?.25:0}),...m(g.direction==="rtl",{pl:i==="rtl"?.25:0,pr:i==="ltr"?.25:0})})})}},progressBarSlotsContainer:{sx:{gap:.25,borderRadius:2,transition:"height 0.1s ease-in-out",...m(b,{height:"20px"}),...m(v,{flexDirection:"column",width:"20px"}),...m(T,{...m(b,{height:"".concat(a,"px")}),...m(v,{width:"".concat(a,"px")})})}},progressBarReadPages:{sx:{display:"none"}},progressBarCurrentPageSlot:{sx:{display:"none"}},progressBarPageTexts:{base:{sx:{px:1,py:1.5,transition:"all 0.1s ease-in-out",...m(T,{transform:"scale(0)",p:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})}}}}})})},Nn=F(c.memo(kn),[ze,wt,A.useSettingsWithoutDefaultFlag,()=>({readerDirection:A.useGetThemeDirection()}),et,Ce],["readerNavBarWidth","isMaximized","setIsMaximized","isDragging","progressBarType","progressBarSize","progressBarPosition","progressBarPositionAutoVertical","readerDirection","scrollbarXSize","scrollbarYSize","totalPages"]),Mn=ue(s.jsx("path",{fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3"})),Hn=ue(s.jsx("path",{d:"M14 4v5c0 1.12.37 2.16 1 3H9c.65-.86 1-1.9 1-3V4zm3-2H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3V4h1c.55 0 1-.45 1-1s-.45-1-1-1"})),Vn=$e(_)({width:"400px",minWidth:"400px",maxWidth:"400px",height:"100vh",overflowY:"auto"}),Wn=c.memo(({mangaId:e,mangaTitle:r,chapterTitle:n,scanlator:o})=>s.jsxs(_,{children:[s.jsx(z,{title:r,placement:"right",children:s.jsx(ut,{lines:3,variant:"h6",component:"h1",sx:{textAlign:"center"},children:s.jsx($t,{component:Ot,to:Yt.manga.path(e),sx:{textDecoration:"none",color:"inherit"},children:r})})}),s.jsx(z,{title:n,placement:"right",children:s.jsx(ut,{lines:4,variant:"body1",component:"h2",sx:{textAlign:"center"},children:n})}),o&&s.jsx(z,{title:o,placement:"right",children:s.jsx(ut,{lines:4,variant:"body2",component:"h3",color:"textDisabled",sx:{textAlign:"center"},children:o})})]})),Fn=ue(s.jsx("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"})),Un=ue(s.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),Ct=({title:e,type:r,disabled:n,...o})=>s.jsx(z,{title:e,disabled:n,children:s.jsx(Vs,{sx:{flexBasis:"15%"},variant:"contained",disabled:n,...o,children:r==="previous"?s.jsx(Fn,{}):s.jsx(Un,{})})}),Gn=({currentPageIndex:e,pages:r,readingDirection:n,openPage:o})=>{const{t}=U(),a=Cs(),l=c.useMemo(()=>ye(e,r),[e,r]),d=ws[n];return s.jsxs(_,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(Ct,{type:"previous",title:t(a("reader.button.previous_page","reader.button.next_page",d)),disabled:a(!l.primary.index,Ee(l)===Ee(r.slice(-1)[0]),d),onClick:()=>o("previous",void 0,!1)}),s.jsxs(Ws,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(Fs,{id:"reader-nav-bar-desktop-page-select",children:t("reader.page_info.label.page")}),s.jsx(Hs,{labelId:"reader-nav-bar-desktop-page-select",label:t("reader.page_info.label.page"),value:Ee(l),onChange:i=>o(i.target.value,void 0,!1),children:r.map(i=>s.jsx(Rt,{value:Ee(i),children:i.name},Ee(i)))})]}),s.jsx(Ct,{type:"next",title:t(a("reader.button.next_page","reader.button.previous_page",d)),disabled:a(Ee(l)===Ee(r.slice(-1)[0]),!l.primary.index,d),onClick:()=>o("next",void 0,!1)})]})},zn=F(c.memo(Gn),[Ce,()=>({openPage:de.useOpenPage()}),A.useSettingsWithoutDefaultFlag],["currentPageIndex","pages","readingDirection","openPage"]),$n=()=>{},$s=({currentChapter:e,chapters:r,style:n})=>{const o=c.useMemo(()=>e&&r.findIndex(t=>t.id===e.id),[e,r]);return s.jsx(nn,{style:{height:"calc(".concat(r.length," * 100px)"),...n},initialTopMostItemIndex:o!=null?o:0,totalCount:r.length,computeItemKey:t=>r[t].id,itemContent:t=>s.jsx(tn,{mode:"reader",chapter:r[t],showChapterNumber:!1,selected:null,onSelect:$n,selectable:!1,isActiveChapter:t===o},r[t].id),increaseViewportBy:400})},Xn=({currentChapter:e,previousChapter:r,nextChapter:n,chapters:o=[],readerThemeDirection:t,openChapter:a})=>{var i,f;const{t:l}=U(),d=bt({variant:"popover",popupId:"reader-nav-bar-desktop-chapter-list"});return c.useLayoutEffect(()=>{d.close()},[e==null?void 0:e.id]),s.jsxs(_,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(Ct,{type:"previous",title:l(le("reader.button.previous_chapter","reader.button.next_chapter",t)),onClick:()=>{a(le("previous","next",t))},disabled:le(!r,!n,t)}),s.jsxs(Ws,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(Fs,{id:"reader-nav-bar-desktop-chapter-select",children:l("chapter.title_one")}),s.jsx(Hs,{...Et(d),open:d.isOpen,value:(i=e==null?void 0:e.id)!=null?i:0,MenuProps:{sx:{visibility:"hidden"}},label:l("chapter.title_one"),labelId:"reader-nav-bar-desktop-chapter-select",children:s.jsx(Rt,{value:(f=e==null?void 0:e.id)!=null?f:0,children:e?"#".concat(e.chapterNumber," ").concat(e.name):""},e==null?void 0:e.id)})]}),s.jsx(Ct,{component:Ot,type:"next",title:l(le("reader.button.next_chapter","reader.button.previous_chapter",t)),onClick:()=>{a(le("next","previous",t))},disabled:le(!n,!r,t)}),s.jsx(ur,{...gr(d),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:s.jsx($,{sx:{mb:1},children:s.jsx($s,{style:{width:"500px",maxWidth:"90vw",minHeight:"150px",maxHeight:"300px"},currentChapter:e,chapters:o})})})]})},Yn=F(c.memo(Xn),[()=>({readerThemeDirection:A.useGetThemeDirection()}),()=>({openChapter:de.useOpenChapter()})],["readerThemeDirection","openChapter"]),Kn=ue(s.jsx("path",{d:"M17 4h3c1.1 0 2 .9 2 2v2h-2V6h-3zM4 8V6h3V4H4c-1.1 0-2 .9-2 2v2zm16 8v2h-3v2h3c1.1 0 2-.9 2-2v-2zM7 18H4v-2H2v2c0 1.1.9 2 2 2h3zM18 8H6v8h12z"})),Xs=(e,r,n)=>{const t=(e+1)%r.length===0;if(!(n&&t))return r[(e+1)%r.length]},Zt=({tooltip:e,value:r,defaultValue:n,values:o,setValue:t,valueToDisplayData:a,isDefaultable:l,onDefault:d,defaultIcon:i})=>{const{t:f}=U(),u=r===void 0,h=c.useMemo(()=>u?-1:o.indexOf(r),[r,o]);return s.jsx(z,{title:e,children:u?s.jsx(Qe,{onClick:()=>t(o[0]),sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:i,size:"large",children:n===void 0?f("global.label.default"):s.jsx(Zr,{i18nKey:"settings.default_value",value:a[n].isTitleString?a[n].title:f(a[n].title)})}):s.jsx(Qe,{onClick:()=>{const g=Xs(h,o,l);if(g===void 0){d==null||d();return}t(g)},sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:a[r].icon,size:"large",children:a[r].isTitleString?a[r].title:f(a[r].title)})})},Zn=({pageScaleMode:e,shouldStretchPage:r,updateSetting:n,...o})=>{const{t}=U();return s.jsxs(_,{sx:{flexDirection:"row",gap:1},children:[s.jsx(Zt,{...o,tooltip:t("reader.settings.page_scale.title"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Os,setValue:a=>n("pageScaleMode",a),valueToDisplayData:es,defaultIcon:es[e.value].icon}),hr[e.value]&&s.jsx(z,{title:t("reader.settings.page_scale.stretch"),children:s.jsx(Vs,{onClick:()=>n("shouldStretchPage",!r.value),sx:{px:void 0},variant:"contained",color:r.value?"secondary":"primary",children:s.jsx(Kn,{})})})]})},qn=({readingMode:e,setReadingMode:r,...n})=>{const{t:o}=U();return s.jsx(Zt,{...n,tooltip:o("reader.settings.label.reading_mode"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:As,setValue:r,valueToDisplayData:Ut,defaultIcon:Ut[e.value].icon})},Jn=()=>s.jsx(fr,{children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M2 4h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2m20 0h-6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6M2 12h20m-3-3 3 3-3 3M5 9l-3 3 3 3"})})}),Qn=({readingMode:e,shouldOffsetDoubleSpreads:r,setShouldOffsetDoubleSpreads:n})=>{const{t:o}=U();return xr(e)?s.jsx(Qe,{sx:{justifyContent:"start",textTransform:"unset"},size:"large",onClick:()=>n(!r),color:r?"secondary":"primary",variant:"contained",startIcon:s.jsx(Jn,{}),children:o("reader.settings.label.offset_double_spread")}):null},eo=({readingDirection:e,setReadingDirection:r,...n})=>{const{t:o}=U();return s.jsx(Zt,{...n,tooltip:o("reader.settings.label.reading_direction"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Ls,setValue:r,valueToDisplayData:ts,defaultIcon:ts[e.value].icon})},to=ue(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 14H9V8h2zm4 0h-2V8h2z"})),so=ue(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 14.5v-9l6 4.5z"})),ro=({autoScroll:e,setAutoScroll:r})=>{const{t:n}=U(),{isActive:o,toggleActive:t}=ht(),a=c.useRef(void 0);return s.jsxs(_,{sx:{flexDirection:"row",gap:1},children:[s.jsx(Qe,{sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},size:"large",onClick:t,color:o?"secondary":"primary",variant:"contained",startIcon:o?s.jsx(to,{}):s.jsx(so,{}),children:n("reader.settings.auto_scroll.title")}),s.jsx(rn,{value:e.value,type:"number",size:"small",onBlur:l=>{const d=ot(+l.target.value,Pe.min,Pe.max);d!==e.value&&(clearTimeout(a.current),r({...e,value:d},!0))},onChange:l=>{const d=ot(+l.target.value,Pe.min,Pe.max);r({...e,value:d},!1),clearTimeout(a.current),a.current=setTimeout(()=>r({...e,value:d},!0),1e3)},slotProps:{input:{inputProps:Pe,endAdornment:s.jsx(on,{position:"end",children:n("global.time.seconds.second",{count:e.value})})}}})]})},no=({manga:e,readingMode:r,shouldOffsetDoubleSpreads:n,pageScaleMode:o,shouldStretchPage:t,readingDirection:a,autoScroll:l,openSettings:d})=>{const{t:i}=U(),f=A.useCreateUpdateSetting(e!=null?e:Ge),u=A.useCreateDeleteSetting(e!=null?e:Ge);return s.jsxs(_,{sx:{gap:1},children:[s.jsx(qn,{readingMode:r,setReadingMode:h=>f("readingMode",h),isDefaultable:!0,onDefault:()=>u("readingMode")}),s.jsx(Qn,{readingMode:r.value,shouldOffsetDoubleSpreads:n.value,setShouldOffsetDoubleSpreads:h=>f("shouldOffsetDoubleSpreads",h)}),s.jsx(Zn,{pageScaleMode:o,shouldStretchPage:t,updateSetting:f,isDefaultable:!0,onDefault:()=>u("pageScaleMode")}),s.jsx(eo,{readingDirection:a,setReadingDirection:h=>f("readingDirection",h),isDefaultable:!0,onDefault:()=>u("readingDirection")}),s.jsx(ro,{autoScroll:l,setAutoScroll:(...h)=>f("autoScroll",...h)}),s.jsx(Qe,{onClick:()=>d(),size:"large",sx:{justifyContent:"start",textTransform:"none"},variant:"contained",startIcon:s.jsx(Ds,{}),children:i("reader.settings.title.reader")})]})},oo=F(no,[Me,A.useSettings],["manga","readingMode","shouldOffsetDoubleSpreads","pageScaleMode","shouldStretchPage","readingDirection","autoScroll"]),ao=ue(s.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"})),ds={...Ge,title:"Fallback",inLibrary:!1},io=({manga:e})=>{const{inLibrary:r}=e!=null?e:ds,{t:n}=U(),{CategorySelectComponent:o,updateLibraryState:t}=gn(e!=null?e:ds,!0);return s.jsxs(s.Fragment,{children:[s.jsx(z,{title:n(r?"manga.action.library.remove.label.action":"manga.button.add_to_library"),children:s.jsx(re,{onClick:t,color:"inherit",children:r?s.jsx(un,{}):s.jsx(hn,{})})}),o]})},Ys=F(c.memo(io),[Me],["manga"]),co=ue(s.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),lo=({id:e,isBookmarked:r})=>{const{t:n}=U(),o=r?"unbookmark":"bookmark";return s.jsx(z,{title:n(Gt[o].action.single),children:s.jsx(re,{onClick:()=>Ue.performAction(o,[e],{}),color:"inherit",children:r?s.jsx(sn,{}):s.jsx(co,{})})})},Ks=c.memo(lo),uo=({currentChapter:e})=>{var o;const{t:r}=U(),n=Ue.useDownloadStatusFromCache((o=e==null?void 0:e.id)!=null?o:-1);return e&&Ue.isDownloaded(e)?s.jsx(z,{title:r(Gt.delete.action.single),children:s.jsx(re,{onClick:()=>Ue.performAction("delete",[e.id],{}),color:"inherit",children:s.jsx(ln,{})})}):n?s.jsx(dn,{chapterId:n.chapter.id}):s.jsx(z,{title:r(Gt.download.action.single),disabled:!e,children:s.jsx(re,{disabled:!e,onClick:()=>{var t;return Ue.performAction("download",[(t=e==null?void 0:e.id)!=null?t:-1],{})},color:"inherit",children:s.jsx(cn,{})})})},go=c.memo(({currentChapter:e,pageLoadStates:r,setPageLoadStates:n,setRetryFailedPagesKeyPrefix:o})=>{const{id:t,isBookmarked:a,realUrl:l}=e!=null?e:Is,{t:d}=U(),i=c.useRef(0),f=c.useMemo(()=>r.some(u=>u.error),[r]);return s.jsxs(_,{sx:{flexDirection:"row",justifyContent:"center",gap:1},children:[s.jsx(Ys,{}),s.jsx(Ks,{id:t,isBookmarked:a}),s.jsx(z,{title:d("reader.button.retry_load_pages"),disabled:!f,children:s.jsx(re,{onClick:()=>{n(u=>u.map(h=>({url:h.url,loaded:h.loaded}))),o("".concat(i.current)),i.current=(i.current+1)%1e3},disabled:!f,color:"inherit",children:s.jsx(ao,{})})}),s.jsx(uo,{currentChapter:e}),s.jsx(z,{title:d("chapter.action.label.open_on_source"),disabled:!l,children:s.jsx(re,{disabled:!l,href:l!=null?l:"",rel:"noreferrer",target:"_blank",color:"inherit",children:s.jsx(an,{})})})]})}),ho=F(go,[ke,Ce],["currentChapter","pageLoadStates","setPageLoadStates","setRetryFailedPagesKeyPrefix"]),fo=({exit:e})=>{const{t:r}=U(),n=Cs();return s.jsx(z,{title:r("reader.button.exit"),children:s.jsx(re,{sx:{marginRight:2},onClick:e,color:"inherit",children:n(s.jsx(pr,{}),s.jsx(mr,{}))})})},Zs=F(c.memo(fo),[()=>({exit:A.useExit()})],["exit"]),xo=(e,r)=>{const n=c.useRef(r),o=c.useRef(r);return o.current!==n.current&&!e&&(n.current=!1),o.current!==r&&(n.current=o.current,o.current=r),n.current},po=({isVisible:e,openSettings:r,setReaderNavBarWidth:n,manga:o,chapters:t,currentChapter:a,previousChapter:l,nextChapter:d,isStaticNav:i})=>{const{t:f}=U(),u=A.useCreateUpdateSetting(o!=null?o:Ge),[h,g]=c.useState();Xe(h,c.useCallback(()=>{i&&n(h.offsetWidth)},[h,i])),c.useLayoutEffect(()=>()=>n(0),[]);const R=xo(e,i)&&e?0:void 0;return s.jsx(vr,{variant:i?"permanent":"persistent",open:e||i,transitionDuration:R,SlideProps:{unmountOnExit:!0},PaperProps:{ref:S=>g(S)},children:s.jsxs(Vn,{sx:{backgroundColor:"background.paper",pointerEvents:"all"},children:[s.jsxs(_,{sx:{p:2,gap:2,backgroundColor:"action.hover"},children:[s.jsxs(_,{sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(Zs,{}),s.jsx(z,{title:f("reader.settings.label.static_navigation"),children:s.jsx(re,{onClick:()=>{n(0),u("isStaticNav",!i)},color:i?"primary":"inherit",children:i?s.jsx(Mn,{}):s.jsx(Hn,{})})})]}),o&&a?s.jsxs(s.Fragment,{children:[s.jsx(Wn,{mangaId:o.id,mangaTitle:o.title,chapterTitle:a.name,scanlator:a.scanlator}),s.jsx(ho,{})]}):s.jsx(At,{})]}),s.jsxs(_,{sx:{p:2,gap:2},children:[s.jsxs(_,{sx:{gap:1},children:[s.jsx(zn,{}),s.jsx(Yn,{chapters:t,currentChapter:a,nextChapter:d,previousChapter:l})]}),s.jsx(Sr,{}),s.jsx(oo,{openSettings:r})]})]})})},mo=F(c.memo(po),[ze,Me,ke,Ce,A.useSettingsWithoutDefaultFlag],["setReaderNavBarWidth","manga","chapters","currentChapter","previousChapter","nextChapter","isStaticNav"]),vo={...Ge,title:""},So=c.forwardRef(({isVisible:e,manga:r,currentChapter:n,scrollbarYSize:o},t)=>{const{t:a}=U(),l=bt({popupId:"reader-overlay-more-menu",variant:"popover"}),{id:d,title:i}=r!=null?r:vo,{id:f,name:u,realUrl:h,isBookmarked:g}=n!=null?n:Is;return s.jsx(Kt,{direction:"down",in:e,ref:t,children:s.jsxs(_,{sx:{flexDirection:"row",alignItems:"center",position:"fixed",top:0,left:0,right:"".concat(o,"px"),p:2,pt:x=>"max(env(safe-area-inset-top), ".concat(x.spacing(2),")"),backgroundColor:x=>Je(x.palette.background.paper,.95),pointerEvents:"all",boxShadow:2},children:[s.jsx(Zs,{}),s.jsx(_,{sx:{flexGrow:1},children:r&&n?s.jsxs(s.Fragment,{children:[s.jsx(z,{title:i,children:s.jsx(ut,{lines:1,component:"h1",variant:"h5",children:s.jsx($t,{component:Ot,to:Yt.manga.path(d),sx:{textDecoration:"none",color:"inherit"},children:i})})}),s.jsx(z,{title:u,children:s.jsx(ut,{lines:1,children:u})})]}):s.jsx(At,{})}),s.jsx(Ys,{}),s.jsx(Ks,{id:f,isBookmarked:g}),s.jsx(re,{...Et(l),color:"inherit",children:s.jsx(fn,{})}),s.jsxs(Rr,{...br(l),children:[s.jsx(Rt,{component:$t,disabled:!h,href:h!=null?h:"",rel:"noreferrer",target:"_blank",children:a("chapter.action.label.open_on_source")}),s.jsx(Rt,{disabled:!h,onClick:async()=>{await navigator.clipboard.writeText(i),Bs(a("global.label.copied_clipboard"),"info")},children:a("global.label.share")})]})]})})}),Ro=F(c.memo(So),[Me,ke,et],["manga","currentChapter","scrollbarYSize"]),bo=ue(s.jsx("path",{d:"m21.81 12.74-.82-.63v-.22l.8-.63c.16-.12.2-.34.1-.51l-.85-1.48c-.07-.13-.21-.2-.35-.2q-.075 0-.15.03l-.95.38c-.08-.05-.11-.07-.19-.11l-.15-1.01c-.03-.21-.2-.36-.4-.36h-1.71c-.2 0-.37.15-.4.34l-.14 1.01c-.03.02-.07.03-.1.05l-.09.06-.95-.38q-.075-.03-.15-.03c-.14 0-.27.07-.35.2l-.85 1.48c-.1.17-.06.39.1.51l.8.63v.23l-.8.63c-.16.12-.2.34-.1.51l.85 1.48c.07.13.21.2.35.2q.075 0 .15-.03l.95-.37c.08.05.12.07.2.11l.15 1.01c.03.2.2.34.4.34h1.71c.2 0 .37-.15.4-.34l.15-1.01c.03-.02.07-.03.1-.05l.09-.06.95.38q.075.03.15.03c.14 0 .27-.07.35-.2l.85-1.48c.1-.17.06-.39-.1-.51M18 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M17 17h2v4c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v4h-2V6H7v12h10z"})),Eo=ue(s.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5M7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"})),us=ue(s.jsx("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})),gs=ue(s.jsx("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"})),To={display:"flex",alignItems:"center",justifyContent:"end",position:"relative",backgroundColor:"background.default"},hs="3px",jo=c.memo(({isTrailingPage:e,pagesIndex:r,totalPages:n,isVertical:o,isHorizontal:t})=>{const a="".concat(r/(n-1)*100,"%");return s.jsx($,{sx:{position:"absolute",...m(o,{top:a,left:"50%"}),...m(t,{top:"50%",left:a}),transform:"translate(-50%, -50%)",width:hs,height:hs,borderRadius:100,backgroundColor:"background.paper",...m(e,{backgroundColor:"primary.main"}),zIndex:1}})}),Co=c.memo(({pageName:e,isTrailingPage:r,isCurrentPage:n,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:l})=>s.jsx(zs,{pageName:e,progressBarPosition:dt.BOTTOM,slotProps:{box:{sx:To}},children:!n&&s.jsx(jo,{isTrailingPage:r,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:l})})),wo={[dt.BOTTOM]:"up",[dt.LEFT]:"right",[dt.RIGHT]:"left",[dt.AUTO]:"left"},Oo=({previousChapter:e,nextChapter:r,isVisible:n,setIsMaximized:o,isDragging:t,currentPageIndex:a,pages:l,direction:d,progressBarPosition:i,progressBarPositionAutoVertical:f,topOffset:u=0,bottomOffset:h=0,scrollbarXSize:g})=>{const x=de.useOpenChapter(),[,p]=c.useState({});Xe(window.document.documentElement,c.useCallback(()=>p({}),[]));const R=js(i,f,u+h,g),{isLeft:S,isRight:C,isVertical:v,isHorizontal:b}=Se(R),j=b?d:"ltr",E=c.useMemo(()=>ye(a,l).pagesIndex,[a,l]),T=c.useMemo(()=>({container:{sx:{flexGrow:1,position:"relative",display:"flex",justifyItems:"center",alignItems:"stretch",backgroundColor:D=>Je(D.palette.background.paper,.85),borderRadius:100,boxShadow:2}},progressBarRoot:{sx:{flexGrow:1,gap:0,...m(v,{flexDirection:"column"}),...m(b,{alignItems:"stretch"})}},progressBarSlotsActionArea:{sx:{alignItems:"center",cursor:"pointer",...m(v,{width:"100%",flexDirection:"column",px:2}),...m(b,{height:"100%",py:2})}},progressBarSlotsContainer:{sx:{borderRadius:100,backgroundColor:"background.default",...m(v,{flexDirection:"column",py:1}),...m(b,{px:1})}},progressBarSlot:{sx:{...m(v,{width:"20px"}),...m(b,{height:"20px"})}},progressBarCurrentPageSlot:{sx:{display:"flex",zIndex:1,cursor:"inherit",...m(v,{justifyContent:"center"}),...m(b,{alignItems:"center"})}},progressBarPageTexts:{base:{sx:{...m(v,{py:1}),...m(b,{px:1})}}}}),[v,b]),L=c.useMemo(()=>({progressBarCurrentPage:s.jsx($,{sx:{position:"absolute",...m(v,{top:"calc(100% - 6px)",...m(E===0,{top:"0"}),width:"75%",height:"6px"}),...m(b,{left:"calc(100% - 0px)",...m(E===0,{left:"0"}),width:"6px",height:"75%"}),backgroundColor:"primary.main",borderRadius:100,cursor:t?"grabbing":"grab"}})}),[E,l.length,t,v,b]);return c.useLayoutEffect(()=>(o(n),()=>o(!1)),[n]),s.jsx(Kt,{direction:wo[R],in:n,children:s.jsx(Gs,{sx:{position:"relative",display:"flex",alignItems:"end",height:"100%",pointerEvents:"none",...m(S,{justifyContent:d==="ltr"?"start":"end"}),...m(C,{justifyContent:d==="ltr"?"end":"start"})},children:s.jsxs(_,{sx:{p:2,gap:1,pointerEvents:"all",alignItems:"center",...m(v,{height:"100%",flexDirection:"column"}),...m(b,{width:"100%",flexDirection:"row"})},children:[s.jsx(re,{onClick:()=>x("previous"),disabled:!e,sx:{backgroundColor:D=>Je(D.palette.background.paper,.85),boxShadow:2},children:le(s.jsx(us,{sx:{...m(v,{transform:"rotate(90deg)"})}}),s.jsx(gs,{sx:{...m(v,{transform:"rotate(90deg)"})}}),j)}),s.jsx(Us,{direction:j,progressBarPosition:R,fullSegmentClicks:!1,createProgressBarSlot:c.useCallback((D,O,y,P,G,ge,k,M)=>s.jsx(Co,{pageName:D.name,isTrailingPage:k,isCurrentPage:G,pagesIndex:O,totalPages:M,isVertical:v,isHorizontal:b}),[v,b]),slotProps:{...T,progressBarReadPages:{sx:{backgroundColor:"primary.main",...m(v,{width:"20px",height:"".concat(Math.max(0,ye(a,l).pagesIndex)/(l.length-1)*100,"%"),borderRadius:"400px 400px 0 0"}),...m(b,{width:"".concat(Math.max(0,ye(a,l).pagesIndex)/(l.length-1)*100,"%"),height:"20px",borderRadius:"400px 0 0 400px"})}}},slots:L}),s.jsx(re,{onClick:()=>x("next"),disabled:!r,sx:{backgroundColor:D=>Je(D.palette.background.paper,.85),boxShadow:2},children:le(s.jsx(gs,{sx:{...m(v,{transform:"rotate(90deg)"})}}),s.jsx(us,{sx:{...m(v,{transform:"rotate(90deg)"})}}),j)})]})})})},Ao=F(c.memo(Oo),[ke,Lt,wt,Ce,()=>({direction:A.useGetThemeDirection()}),A.useSettingsWithoutDefaultFlag,et],["previousChapter","nextChapter","isVisible","setIsMaximized","isDragging","currentPageIndex","pages","direction","progressBarPosition","progressBarPositionAutoVertical","scrollbarXSize"]),Lo=({manga:e,readingMode:r,readingDirection:n,autoScroll:o,isActive:t,toggleActive:a})=>{const{t:l}=U(),d=A.useCreateDeleteSetting(e!=null?e:Ge);return e?s.jsxs(_,{sx:{gap:2},children:[s.jsx(qr,{}),s.jsx(Jr,{readingMode:r,setReadingMode:i=>A.updateSetting(e,"readingMode",i),isDefaultable:!0,onDefault:()=>d("readingMode")}),s.jsx(Qr,{readingDirection:n,setReadingDirection:i=>A.updateSetting(e,"readingDirection",i),isDefaultable:!0,onDefault:()=>d("readingDirection")}),s.jsx(xn,{label:l("reader.settings.auto_scroll.title"),checked:t,onChange:()=>a()}),s.jsx(en,{autoScroll:o,setAutoScroll:(...i)=>A.updateSetting(e,"autoScroll",...i)})]}):null},Do=F(c.memo(Lo),[Me,A.useSettings,ht],["manga","readingMode","readingDirection","autoScroll","isActive","toggleActive"]),Io=({openSettings:e,isVisible:r,currentChapter:n,chapters:o,scrollbarXSize:t,scrollbarYSize:a,topOffset:l=0})=>{const{t:d}=U(),i=bt({variant:"dialog",popupId:"reader-chapter-list-dialog"}),f=bt({variant:"dialog",popupId:"reader-quick-settings-dialog"}),[u,h]=c.useState(0),g=c.useRef(null);return Xe(g,c.useCallback(()=>{var x,p;return h((p=(x=g.current)==null?void 0:x.clientHeight)!=null?p:0)},[u])),c.useLayoutEffect(()=>{i.close()},[n==null?void 0:n.id]),s.jsxs(s.Fragment,{children:[s.jsxs(_,{sx:{position:"fixed",right:"".concat(a,"px"),bottom:0,left:0,height:"calc(100% - ".concat(l,"px)")},children:[s.jsx(Ao,{topOffset:l,bottomOffset:u}),s.jsx(Kt,{direction:"up",in:r,children:s.jsx(_,{ref:g,sx:{alignItems:"center",backgroundColor:x=>Je(x.palette.background.paper,.95),pb:"max(".concat(t,"px, env(safe-area-inset-bottom))"),boxShadow:2,pointerEvents:"all"},children:s.jsxs(_,{sx:{width:"50%",flexDirection:"row",p:2,gap:1,justifyContent:"space-evenly",alignItems:"center"},children:[s.jsx(z,{title:d("reader.button.chapter_list"),children:s.jsx(re,{...Et(i),color:"inherit",children:s.jsx(Eo,{})})}),s.jsx(z,{title:d("reader.settings.title.quick_settings"),children:s.jsx(re,{...Et(f),color:"inherit",children:s.jsx(bo,{})})}),s.jsx(z,{title:d("settings.title"),children:s.jsx(re,{onClick:e,color:"inherit",children:s.jsx(Ds,{})})})]})})})]}),i.isOpen&&s.jsx(Vt,{...ss(i),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Wt,{sx:{p:0,pb:1},children:s.jsx($s,{style:{minHeight:"15vh",maxHeight:"75vh"},currentChapter:n,chapters:o})})}),f.isOpen&&s.jsx(Vt,{...ss(f),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Wt,{children:s.jsx(Do,{})})})]})},Bo=F(c.memo(Io),[ke,et],["currentChapter","chapters","scrollbarXSize","scrollbarYSize"]),_o=({isVisible:e,isDesktop:r,isMobile:n})=>{const[o,t]=c.useState(!1),[a,l]=c.useState(0),d=c.useRef(null);return Xe(d,c.useCallback(()=>{var i,f;return l((f=(i=d.current)==null?void 0:i.clientHeight)!=null?f:0)},[n])),s.jsxs($,{sx:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none",zIndex:1},children:[r&&s.jsxs(s.Fragment,{children:[s.jsx(Nn,{}),s.jsx(mo,{isVisible:e,openSettings:()=>t(!0)})]}),n&&s.jsxs(s.Fragment,{children:[s.jsx(Ro,{ref:d,isVisible:e}),s.jsx(Bo,{openSettings:()=>t(!0),isVisible:e,topOffset:a})]}),s.jsx(Rn,{isOpen:o,close:()=>t(!1)}),s.jsx(En,{})]})},Po=F(c.memo(_o),[A.useOverlayMode],["isDesktop","isMobile"]),fs="reader-tap-zone-layout-canvas",yo=({readerNavBarWidth:e,showPreview:r,tapZoneLayout:n,tapZoneInvertMode:o,readingDirection:t})=>{const a=tt(),[l,d]=c.useState(0),[i,f]=c.useState(0),[u,h]=c.useState(null);Xe(u,c.useCallback(()=>{var x,p;d((x=u==null?void 0:u.clientWidth)!=null?x:0),f((p=u==null?void 0:u.clientHeight)!=null?p:0)},[u]));const g=Er.getOrCreateCanvas(n,l,i,a.typography.h3,{vertical:o.vertical,horizontal:o.horizontal,isRTL:t===at.RTL});return c.useLayoutEffect(()=>{const x=document.getElementById(fs);x==null||x.replaceChildren(g)},[g,r]),s.jsx($,{ref:h,sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none"},children:r&&s.jsx("div",{id:fs})})},ko=F(yo,[ze,Dt,A.useSettingsWithoutDefaultFlag],["readerNavBarWidth","showPreview","tapZoneLayout","tapZoneInvertMode","readingDirection"]),No=({readerNavBarWidth:e,customFilter:{rgba:{value:{red:r,green:n,blue:o,alpha:t,blendMode:a},enabled:l}}})=>l?s.jsx($,{sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none",background:"rgba(".concat(r," ").concat(n," ").concat(o," / ").concat(t,"%)"),mixBlendMode:"".concat(a)}}):null,Mo=F(No,[ze,A.useSettingsWithoutDefaultFlag],["readerNavBarWidth","customFilter"]),xs=2,ps=1,Ze=0,te=0,se=1,Ho=(e,r=Nt.XY)=>{const[n,o]=c.useState(!1),t=c.useRef(void 0),a=c.useRef([0,0,0]),l=c.useRef([0,0,0]),d=c.useRef([0,0,0]),i=c.useRef([0,0]),f=c.useRef(void 0);return c.useEffect(()=>{const u=e==null?void 0:e.current;if(!u)return()=>{};const h=()=>{t.current||(t.current=getComputedStyle(u));const T=t.current.direction==="rtl",L=t.current.flexDirection==="row-reverse";return T||!T&&L},g=()=>(t.current||(t.current=getComputedStyle(u)),t.current.flexDirection==="column-reverse"),x=r!==Nt.Y,p=r!==Nt.X,R=()=>clearInterval(f.current),S=()=>{const T=(Y,ee,N)=>(Y[Ze]-Y[xs])/(ee[Ze]-ee[xs])*1e3/N,L=[x?T(a.current,d.current,u.clientWidth):0,p?T(l.current,d.current,u.clientHeight):0],D=x&&p?Math.sqrt(L[te]**2+L[se]**2):Math.abs(p?L[se]:L[te]),O=[L[te]/D,L[se]/D],y=ot(1.2*D,-12,12),P=(Date.now()-d.current[Ze])/1e3,G=y-14.278*P+75.24*P**2/y-149.72*P**3/y/y;if(!(y!==0&&G>0&&!Number.isNaN(y))){R();return}const k=(Y,ee)=>Y*ee*(y*P-7.1397*P**2+25.08*P**3/y-37.43*P**4/y/y),M=[k(u.clientWidth,O[te]),k(u.clientHeight,O[se])],W=[u.scrollWidth-u.clientWidth,u.scrollHeight-u.clientHeight],B=[ot(i.current[te]-M[te],h()?-W[te]:0,W[te]),ot(i.current[se]-M[se],g()?-W[se]:0,W[se])],ne=B[te]!==0||B[te]!==W[te],K=B[se]!==0||B[se]!==W[se];ne||K||R(),x&&(u.scrollLeft=B[te]),p&&(u.scrollTop=B[se])};let C=!1;const v=T=>{if(C)return!0;const L=[u.clientHeight<u.scrollHeight,u.clientWidth<u.scrollWidth],D=[Math.abs(a.current[Ze]-T.pageX)>0,Math.abs(l.current[Ze]-T.pageY)>0];return L[te]&&D[te]||L[se]&&D[se]},b=T=>{v(T)&&(C=!0,o(!0),a.current=[...a.current.slice(1),T.pageX],l.current=[...l.current.slice(1),T.pageY],d.current=[...d.current.slice(1),Date.now()],x&&(u.scrollLeft+=a.current[Ze]-a.current[ps]),p&&(u.scrollTop+=l.current[Ze]-l.current[ps]))},j=()=>{u.removeEventListener("mousemove",b),u.removeEventListener("mouseup",j),setTimeout(()=>{C=!1,o(!1)},0),i.current=[u.scrollLeft,u.scrollTop],f.current=setInterval(S,16)},E=T=>{T.button===0&&(T.preventDefault(),a.current=[T.pageX,T.pageX,T.pageX],l.current=[T.pageY,T.pageY,T.pageY],d.current=[Date.now()-2,Date.now()-1,Date.now()],u.addEventListener("mousemove",b),u.addEventListener("mouseup",j),R())};return u.addEventListener("mousedown",E),u.addEventListener("wheel",R),()=>{u.removeEventListener("mousedown",E),u.removeEventListener("wheel",R),R()}},[e,r]),n},Vo=(e,r)=>{c.useEffect(()=>{if(e){r.pause();return}r.resume()},[e,r.isPaused])},Wo=(e,r,n,o,t)=>{c.useEffect(()=>{var l,d;const a=()=>{e&&r(!1),n&&o(!1)};return(l=t.current)==null||l.addEventListener("wheel",a),(d=t.current)==null||d.addEventListener("touchmove",a),()=>{var i,f;(i=t.current)==null||i.removeEventListener("wheel",a),(f=t.current)==null||f.removeEventListener("touchmove",a)}},[e,n])},Fo=(e,r,n)=>{c.useEffect(()=>{if(e!==V.CONTINUOUS_HORIZONTAL)return()=>{};if(!n.current)return()=>{};const o=t=>{var a,l;if(t.preventDefault(),t.shiftKey){(a=n.current)==null||a.scrollBy({top:t.deltaY});return}(l=n.current)==null||l.scrollBy({left:r===at.LTR?t.deltaY:t.deltaY*-1})};return n.current.addEventListener("wheel",o),()=>{var t;return(t=n.current)==null?void 0:t.removeEventListener("wheel",o)}},[e,r])},Uo=e=>{const r=c.useRef(void 0);c.useEffect(()=>{const n=t=>{const a=e.current;a&&(a.style.cursor=t?"default":"none")},o=()=>{n(!0),clearTimeout(r.current),r.current=setTimeout(()=>{n(!1)},5e3)};return o(),window.addEventListener("mousemove",o),()=>{n(!0),window.removeEventListener("mousemove",o),clearTimeout(r.current)}},[])},Go=(e,r,n,o,t)=>{c.useLayoutEffect(()=>{var a;r||(a=t.current)==null||a.scrollTo(Tr(t.current,n,o),0)},[e])},zo=(e,r,n,o,t,a,l,d,i,f)=>{c.useLayoutEffect(()=>{if(e==null)return;const u=ye(e,n);if(l){const x=e>r?Tt.PREVIOUS:Tt.NEXT,p=d.current[u.pagesIndex];p==null||p.scrollIntoView({block:"start",inline:jr(x,i,f)})}const h=Ee(u),g=h===o-1;t(null),a(h,!g,g)},[e])},$o=(e,r,n,o,t,a,l)=>{const[d,i]=c.useState(l===V.DOUBLE_PAGE);c.useLayoutEffect(()=>{if(d&&l!==V.DOUBLE_PAGE){i(!1);const h=_s(n);o(h),t(h.map(({primary:{url:g}})=>({url:g,isSpread:!1})));return}l===V.DOUBLE_PAGE&&(d||a(Ee(ye(e,r))),o(r),i(l===V.DOUBLE_PAGE))},[r,l])},Mt=({title:e,name:r,scanlator:n,backgroundColor:o})=>{const t=tt(),a=t.palette.getContrastText(Or(t.palette,Ps[o])),l=Je(a,.5);return r?s.jsxs(_,{children:[s.jsx(qe,{color:a,children:e}),s.jsx(qe,{color:a,variant:"h6",component:"h1",children:r}),n&&s.jsx(qe,{variant:"body2",color:l,children:n})]}):null},Xo=({type:e,transitionPageMode:r,readingMode:n,backgroundColor:o,shouldShowTransitionPage:t,manga:a,currentChapterName:l,currentChapterScanlator:d,previousChapterName:i,previousChapterScanlator:f,nextChapterName:u,nextChapterScanlator:h,scrollbarXSize:g,scrollbarYSize:x,readerNavBarWidth:p,handleBack:R})=>{var D;const{t:S}=U(),C=e===Te.PREVIOUS,v=e===Te.NEXT,b=!!l&&!i,j=!!l&&!u,E=b&&e===Te.PREVIOUS,T=j&&e===Te.NEXT;return!t&&!(E||T)||!wr(e,r,n)?null:s.jsx(_,{sx:{justifyContent:"center",alignItems:"center",...m(!Ne(n),{width:"100%",height:"100%"}),...m(Ne(n),{position:"sticky",...m(je(n),{left:0,maxWidth:"calc(100vw - ".concat(x,"px - ").concat(p,"px)"),minHeight:"calc(100vh - ".concat(g,"px)")}),...m(n===V.CONTINUOUS_HORIZONTAL,{top:0,minWidth:"calc(100vw - ".concat(x,"px - ").concat(p,"px)"),maxHeight:"calc(100vh - ".concat(g,"px)")})})},children:s.jsxs(_,{sx:{gap:2,maxWidth:O=>"calc(100vw - ".concat(x,"px - ").concat(p,"px - ").concat(O.spacing(2),")"),maxHeight:"calc(100vh - ".concat(g,"px)"),width:"max-content",p:1},children:[C&&b&&s.jsx(qe,{variant:"h6",children:S("reader.transition_page.first_chapter")}),s.jsxs(_,{sx:{gap:5},children:[C&&!b&&s.jsx(Mt,{title:S("reader.transition_page.previous"),name:i,scanlator:f,backgroundColor:o}),!!l&&s.jsx(Mt,{title:S(C?"reader.transition_page.current":"reader.transition_page.finished"),name:l,scanlator:d,backgroundColor:o}),v&&!j&&s.jsx(Mt,{title:S("reader.transition_page.next"),name:u,scanlator:h,backgroundColor:o})]}),v&&j&&s.jsx(qe,{variant:"h6",children:S("reader.transition_page.last_chapter")}),(C&&b||v&&j)&&s.jsxs(_,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:[s.jsx(Qe,{sx:{flexGrow:1},onClick:O=>{O.stopPropagation(),R()},variant:"contained",children:S("reader.transition_page.exit.previous_page")}),s.jsx(Qe,{sx:{flexGrow:1},component:Ot,onClick:O=>{O.stopPropagation()},variant:"contained",to:Yt.manga.path((D=a==null?void 0:a.id)!=null?D:-1),children:S("reader.transition_page.exit.manga_page")})]})]})})},ms=F(c.memo(Xo),[Me,({chapterId:e})=>{const{chapters:r}=ke(),n=c.useMemo(()=>r.findIndex(l=>l.id===e),[e,r]),o=r[n],t=c.useMemo(()=>r[n+1],[n,r]),a=c.useMemo(()=>r[n-1],[n,r]);return{currentChapterName:o==null?void 0:o.name,currentChapterScanlator:o==null?void 0:o.scanlator,previousChapterName:t==null?void 0:t.name,previousChapterScanlator:t==null?void 0:t.name,nextChapterName:a==null?void 0:a.name,nextChapterScanlator:a==null?void 0:a.scanlator}},et,ze,Ce,A.useSettingsWithoutDefaultFlag,({chapterId:e,type:r})=>{const n=Cr(),{chapters:o}=ke(),t=c.useMemo(()=>o.findIndex(u=>u.id===e),[e,o]),a=t===0,l=t===o.length-1,d=r===Te.PREVIOUS&&l,i=r===Te.NEXT&&a;return{handleBack:d||i?n:_e}}],["manga","currentChapterName","currentChapterScanlator","previousChapterName","previousChapterScanlator","nextChapterName","nextChapterScanlator","scrollbarXSize","scrollbarYSize","readerNavBarWidth","backgroundColor","transitionPageMode","readingMode","handleBack","shouldShowTransitionPage"]),Yo=(e,r,n,o,t,a,l,d,i,f,u,h,g,x,p,R,S,C)=>{var b,j;const v=c.useRef(void 0);c.useLayoutEffect(()=>{var y;const E=(y=r.data)==null?void 0:y.fetchChapterPages;if(!E)return;const{pages:T}=E,L=T.length?T:[""],D=Ar(n,o!=null?o:0,L.length-1),O=v.current!==(E==null?void 0:E.pages);if(O){v.current=E.pages;const P=_s(L);i(!0),h(P),g(L),x(P.map(({primary:{url:G}})=>({url:G,loaded:!1}))),p(P.map(({primary:{url:G}})=>({url:G,isSpread:!1})))}else h(t),x(a),p(l);u(E.pages.length),g(L),R(D),S(D),f(P=>({...P,isCurrentChapterReady:d||O})),C(Te.NONE)},[(j=(b=r.data)==null?void 0:b.fetchChapterPages)==null?void 0:j.pages,e])},vs=0,mt="-10px",Ko=(e,r,n)=>{if(!Ne(r))return;const o=ws[n],t="0px ".concat(mt," 0px 0px"),a="0px 0px 0px ".concat(mt);return je(r)?e==="first"?"0px 0px ".concat(mt," 0px"):"".concat(mt," 0px 0px 0px"):e==="first"?le(t,a,o):le(a,t,o)},Zo=(e,r,n,o)=>e===at.LTR?{start:n>=o,end:r<0}:{start:r<0,end:n>=o},qo=(e,{top:r,right:n,bottom:o,left:t},a,l)=>{const d=window.innerWidth-l,i=window.innerHeight-a;return{[V.CONTINUOUS_VERTICAL]:{start:o>=i,end:r<0},[V.CONTINUOUS_HORIZONTAL]:Zo(e,t,n,d)}},Jo=({[V.CONTINUOUS_VERTICAL]:e,[V.CONTINUOUS_HORIZONTAL]:r},n)=>je(n)?e.start||e.end:r.start||r.end,Qo=({[V.CONTINUOUS_VERTICAL]:e,[V.CONTINUOUS_HORIZONTAL]:r},n)=>je(n)?e:r,Ss=(e,r,n,o,t,a,l,d,i,f,u,h,g,x)=>{c.useEffect(()=>{const p=Ne(a),R=je(a);if(x||!g||!p||!d||!o||t||n===void 0)return()=>{};const S=()=>{const C=g.scrollLeft===0,v=g.scrollLeft===g.scrollWidth-g.clientWidth,b=g.scrollTop===0,j=g.scrollTop===g.scrollHeight-g.clientHeight;(e==="first"&&(R?b:C)||e==="last"&&(R?j:v))&&i(n,void 0,!1)};return g.addEventListener("scroll",S),()=>g.removeEventListener("scroll",S)},[a,g,x,d,o,t,n,i]),Lr(f,c.useCallback(p=>{if(!d||!Ne(a)||n===void 0||!x&&!t)return;const R=p[p.length-1],S=qo(l,R.target.getBoundingClientRect(),u,h),{start:C,end:v}=Qo(S,a),b=R.intersectionRatio<=vs;if(!Jo(S,a))return;const j=e==="first"&&C&&!t,E=e==="last"&&!o&&v;if(j||e==="last"&&v&&b){i(n,!t,!1);return}E&&i(r,!1,!1)},[e,r,n,o,t,a,l,d,x,i,u,h]),c.useMemo(()=>({root:g,threshold:[vs],rootMargin:Ko(e,a,l),ignoreInitialObserve:!0}),[e,a,l]))},ea=({readingMode:e,readingDirection:r,shouldUseInfiniteScroll:n,chapterId:o,previousChapterId:t,nextChapterId:a,isPreviousChapterVisible:l,isCurrentChapter:d,isNextChapterVisible:i,imageWrapper:f,openChapter:u,scrollbarXSize:h,scrollbarYSize:g,scrollElement:x,shouldShowTransitionPage:p})=>(Ss("first",o,t,d,l,e,r,n,u,f,h,g,x,p),Ss("last",o,a,d,i,e,r,n,u,f,h,g,x,p),null),ta=F(c.memo(ea),[()=>({openChapter:de.useOpenChapter()}),A.useSettingsWithoutDefaultFlag],["openChapter","shouldShowTransitionPage"]),sa=({currentPageIndex:e,setPages:r,setPageLoadStates:n,setTotalPages:o,setCurrentPageIndex:t,updateCurrentPageIndex:a,setPageToScrollToIndex:l,transitionPageMode:d,retryFailedPagesKeyPrefix:i,setTransitionPageMode:f,readingMode:u,readerWidth:h,pageScaleMode:g,shouldOffsetDoubleSpreads:x,readingDirection:p,shouldUseInfiniteScroll:R,imagePreLoadAmount:S,pageGap:C,chapterId:v,previousChapterId:b,nextChapterId:j,isPreviousChapterVisible:E,isNextChapterVisible:T,lastPageRead:L,isInitialChapter:D,isCurrentChapter:O,isPreviousChapter:y,isNextChapter:P,isLeadingChapter:G,isTrailingChapter:ge,isPreloadMode:k,imageRefs:M,scrollIntoView:W,setReaderStateChapters:B,resumeMode:ne,customFilter:K,shouldStretchPage:oe,scrollbarXSize:Y,scrollbarYSize:ee,readerNavBarWidth:N,onSizeChange:Re,minWidth:ae,minHeight:he,scrollElement:we})=>{const{t:pe}=U(),{direction:Q}=tt(),[Oe,Ae]=zt.useGetChapterPagesFetch(v!=null?v:-1),[me,Le]=c.useState(!1),[fe,He]=c.useState(pt.totalPages),[De,st]=c.useState(pt.pageUrls),[Ie,Ve]=c.useState(pt.pages),[ie,I]=c.useState(pt.pageLoadStates),[X,Ye]=c.useState(ie.map(({url:w})=>({url:w,isSpread:!1}))),We=c.useRef(null),Z=c.useRef(O),Be=c.useRef(Ie.map(()=>null)),ve=c.useRef(null),H=c.useMemo(()=>!!!fe||!(fe===X.length)?Ie:u===V.DOUBLE_PAGE?Dr(De,X,x,p):Ie,[X,u,x,p,fe]),it=c.useMemo(()=>Ir(u),[u]),rt=p===at.LTR,Fe=Ne(u),xe=!Fe&&!O||k,ft=!Fe&&O,It=!xe&&(ft||Fe&&(D||G)),ct=!xe&&(ft||Fe&&(D||ge));Z.current=O,O&&(M.current=Be.current);const Ke=c.useCallback(()=>{v&&(Le(!1),Oe({variables:{input:{chapterId:v}}}).catch(vt()))},[Oe,v]),Bt=c.useMemo(()=>Br(H,X,Ye,ie,w=>{Z.current&&n(w),I(w)},u),[H,u]),_t=c.useMemo(()=>_r(w=>{Z.current&&n(w),I(w)}),[]);c.useEffect(()=>{Ke()},[v]),Xe(We,c.useCallback(w=>{const{clientWidth:be,clientHeight:nt}=w[0].target;Re(be,nt,v)},[Re,We.current,v]));const ce=(w,be,nt,xt=!1)=>{(xt||!me)&&be(w),O&&nt(w)};return Yo(O,Ae,ne,L,H,ie,X,me,Le,w=>ce(w,_e,B),w=>ce(w,He,o),w=>ce(w,Ve,r),w=>ce(w,st,_e),w=>ce(w,I,n),w=>ce(w,Ye,_e),w=>ce(w,_e,t),w=>{(D&&!me||W)&&(l(w),B(be=>({...be,visibleChapters:{...be.visibleChapters,scrollIntoView:!1,resumeMode:void 0}})))},w=>ce(w,_e,f)),$o(e,H,De,w=>ce(w,Ve,r,!0),w=>ce(w,Ye,_e,!0),w=>ce(w,_e,a),u),Fe||O||y||P?Ae.error?xe?null:s.jsx($,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center",position:"relative"},children:s.jsx(jt,{message:pe("global.error.label.failed_to_load_data"),messageExtra:ys(Ae.error),retry:()=>{Ke()}})}):Ae.loading||!me?xe?null:s.jsx($,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center"},children:s.jsx(At,{})}):v!=null&&!fe?xe?null:s.jsx($,{sx:{minWidth:"100%",minHeight:"100%",position:"relative"},children:s.jsx(jt,{message:pe("reader.error.label.no_pages_found"),retry:Ke})}):s.jsxs(_,{ref:We,sx:{width:"fit-content",height:"fit-content",margin:"auto",flexWrap:"nowrap",...m(u===V.CONTINUOUS_HORIZONTAL,{minHeight:he}),...m(je(u),{minWidth:ae}),...m(xe,{maxWidth:0,maxHeight:0,minWidth:"unset",minHeight:"unset",overflow:"hidden",margin:"unset"}),...m(je(u)&&ks(h,g),{alignItems:"center"}),...m(u===V.CONTINUOUS_HORIZONTAL,{...m(Q==="ltr",{flexDirection:rt?"row":"row-reverse"}),...m(Q==="rtl",{flexDirection:rt?"row-reverse":"row"})})},children:[!k&&s.jsx(ta,{readingMode:u,readingDirection:p,shouldUseInfiniteScroll:R,chapterId:v,previousChapterId:b,nextChapterId:j,isCurrentChapter:O,isPreviousChapterVisible:E,isNextChapterVisible:T,imageWrapper:ve.current,scrollbarXSize:Y,scrollbarYSize:ee,scrollElement:we}),It&&s.jsx(ms,{chapterId:v,type:Te.PREVIOUS}),s.jsx(it,{ref:ve,totalPages:fe,currentPageIndex:e,pages:H,transitionPageMode:d,pageLoadStates:ie,retryFailedPagesKeyPrefix:i,imageRefs:Be,onLoad:Bt,onError:_t,isCurrentChapter:O,isPreviousChapter:y,isNextChapter:P,readingMode:u,imagePreLoadAmount:S,readingDirection:p,pageScaleMode:g,pageGap:C,customFilter:K,shouldStretchPage:oe,readerWidth:h,scrollbarXSize:Y,scrollbarYSize:ee,readerNavBarWidth:N,isPreloadMode:k,resumeMode:ne,handleAsInitialRender:W}),ct&&s.jsx(ms,{chapterId:v,type:Te.NEXT})]}):null},ra=c.memo(sa),na=(e,r,n,o)=>{const t=Pr(r),a=yr(r),l=n!==window.innerWidth,d=o!==window.innerHeight,i=t&&l,f=a&&d;return!je(e)&&l?!0:i||f},Rs=(e,r,n)=>{c.useLayoutEffect(()=>{n(r)},[e])},oa=(e,r,n,o)=>{const t=c.useRef({width:window.innerWidth,height:window.innerHeight}),a=c.useCallback(()=>{const{width:l,height:d}=t.current;t.current={width:window.innerWidth,height:window.innerHeight},na(e,r,l,d)&&n(o)},[e,r,o]);pn("resize",a)},qs=e=>{const r=c.useRef({left:0,top:0,visibleElement:void 0,visibleElementLeft:0,visibleElementTop:0});return c.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=()=>{var a,l;const{visibleElement:t}=r.current;r.current={...r.current,left:n.scrollLeft,top:n.scrollTop,visibleElementLeft:(a=t==null?void 0:t.offsetLeft)!=null?a:0,visibleElementTop:(l=t==null?void 0:t.offsetTop)!=null?l:0}};return n.addEventListener("scroll",o),()=>n.removeEventListener("scroll",o)},[]),c.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=(l,d)=>Array.from(l).filter(i=>i instanceof HTMLElement).flatMap(i=>i instanceof HTMLImageElement?[i]:Array.from(i.querySelectorAll("img"))).forEach(d),t=new IntersectionObserver(l=>{const d=l.find(i=>i.isIntersecting);(d==null?void 0:d.target)instanceof HTMLElement&&(r.current={...r.current,visibleElement:d.target,visibleElementLeft:d.target.offsetLeft,visibleElementTop:d.target.offsetTop})}),a=new MutationObserver(l=>{for(const d of l)o(d.addedNodes,i=>t.observe(i)),o(d.removedNodes,i=>t.unobserve(i))});return a.observe(n,{childList:!0,subtree:!0}),()=>{a.disconnect(),t.disconnect()}},[]),r},aa=(e,r)=>{const n=qs(e),o=Ne(r),t=je(r);c.useEffect(()=>{const a=e.current;if(!a||!o)return()=>{};const l=u=>{const{left:h,top:g,visibleElement:x,visibleElementLeft:p,visibleElementTop:R}=n.current;if(!x||!!!u.filter(j=>!(j.target instanceof HTMLElement)||!j.target.clientWidth&&!j.target.clientHeight?!1:t?j.target.offsetTop<g:Math.abs(j.target.offsetLeft)<Math.abs(h)).length)return;const v=h-p+x.offsetLeft,b=g-R+x.offsetTop;a.scrollTo(v,b)},d=(u,h)=>Array.from(u).filter(g=>g instanceof HTMLElement).flatMap(g=>g instanceof HTMLImageElement?[g]:Array.from(g.querySelectorAll("img"))).forEach(h),i=new ResizeObserver(l),f=new MutationObserver(u=>{for(const h of u)d(h.addedNodes,g=>i.observe(g)),d(h.removedNodes,g=>i.unobserve(g))});return f.observe(a,{childList:!0,subtree:!0}),()=>{f.disconnect(),i.disconnect()}},[o,t])},ia=(e,r,n,o,t,a,l)=>{const d=qs(e),i=()=>{const f=e.current,{left:u,top:h,visibleElementLeft:g,visibleElementTop:x,visibleElement:p}=d.current;if(!f||!l||!p)return!1;const R=Ns(n,t,a),S=o===0;if(!(!R.previous&&S))return!1;const v=u-g+p.offsetLeft,b=h-x+p.offsetTop;return f.scrollTo(v,b),!0};c.useEffect(()=>{const f=e.current;if(!f||!l)return()=>{};let u=!1;const h=(p,R)=>{Array.from(p).filter(S=>S instanceof HTMLElement).flatMap(S=>S instanceof HTMLImageElement?[S]:Array.from(S.querySelectorAll("img"))).forEach(R)},g=new ResizeObserver(()=>{u||(u=i(),u&&g.disconnect())}),x=new MutationObserver(p=>{for(const R of p)h(R.addedNodes,S=>g.observe(S)),h(R.removedNodes,S=>g.unobserve(S))});return x.observe(f,{childList:!0,subtree:!0}),()=>{x.disconnect(),g.disconnect()}},[r]),c.useLayoutEffect(()=>{i()},[r])},ca=(e,r,n,o,t,a,l,d,i,f)=>{ia(e,r,n,o,t,a,Ne(l)),aa(e,l),oa(l,f,i,o),Rs(d,o,i),Rs(l,o,i)},la={[V.SINGLE_PAGE]:lt.X,[V.DOUBLE_PAGE]:lt.X,[V.CONTINUOUS_VERTICAL]:lt.Y,[V.CONTINUOUS_HORIZONTAL]:lt.X,[V.WEBTOON]:lt.Y},da=c.forwardRef(({currentPageIndex:e,pageToScrollToIndex:r,setPageToScrollToIndex:n,pages:o,totalPages:t,setPages:a,setPageLoadStates:l,setTotalPages:d,setCurrentPageIndex:i,transitionPageMode:f,retryFailedPagesKeyPrefix:u,setTransitionPageMode:h,readingMode:g,readingDirection:x,shouldUseInfiniteScroll:p,readerWidth:R,pageScaleMode:S,shouldOffsetDoubleSpreads:C,imagePreLoadAmount:v,pageGap:b,customFilter:j,shouldStretchPage:E,readerNavBarWidth:T,setScrollbarXSize:L,setScrollbarYSize:D,isVisible:O,setIsVisible:y,updateCurrentPageIndex:P,showPreview:G,setShowPreview:ge,initialChapter:k,currentChapter:M,chapters:W,visibleChapters:B,setReaderStateChapters:ne,isCurrentChapterReady:K},oe)=>{var We;const{direction:Y}=tt(),{resumeMode:ee=rs.START}=(We=Ms().state)!=null?We:{resumeMode:rs.START},N=c.useRef(null),Re=mn(oe,N),ae=je(g),he=Ne(g),we=Ho(N),pe=ht();c.useEffect(()=>pe.setScrollRef(N),[]);const Q=ns.useGetScrollbarSize("width",N.current),Oe=ns.useGetScrollbarSize("height",N.current);c.useLayoutEffect(()=>{L(Q),D(Oe)},[Q,Oe]);const Ae=de.useHandleClick(N.current),me=c.useRef(o.map(()=>null)),[{minChapterViewWidth:Le,minChapterViewHeight:fe,minChapterSizeSourceChapterId:He},De]=c.useState({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),[,st]=c.useState({}),Ie=la[g],Ve=x===at.LTR,ie=c.useMemo(()=>W.findIndex(Z=>Z.id===(k==null?void 0:k.id)),[W,k==null?void 0:k.id]),I=c.useMemo(()=>W.slice(Math.max(0,ie-B.trailing),Math.min(W.length,ie+B.leading+1)),[W,ie,B.trailing,B.leading]),X=c.useMemo(()=>I.findIndex(Z=>Z.id===(M==null?void 0:M.id)),[M,I]),Ye=c.useCallback((Z,Be,ve)=>{if(!he)return;const H=ve===He;if(ae){if(!H&&Le>=Z)return;De({minChapterViewWidth:Z,minChapterViewHeight:0,minChapterSizeSourceChapterId:ve});return}(H||fe<Be)&&De({minChapterViewWidth:0,minChapterViewHeight:Be,minChapterSizeSourceChapterId:ve})},[he,ae,Le,fe,He]);if(zo(r,e,o,t,n,P,he,me,Y,x),Go(e,he,Y,x,N),Uo(N),Fo(g,x,N),Wo(O,y,G,ge,N),Vo(O,pe),ca(N,M==null?void 0:M.id,X,e,I,B,g,x,n,S),c.useLayoutEffect(()=>{De({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),st({})},[g]),!k||!M)throw new Error("ReaderViewer: illegal state - initialChapter and currentChapter should not be undefined");return s.jsx(_,{ref:Re,sx:{width:"100%",height:"100%",overflow:"auto",flexWrap:"nowrap",...m(ae&&ks(R,S),{alignItems:"center"}),...m(!ae,{...m(Y==="ltr",{flexDirection:Ve?"row":"row-reverse"}),...m(Y==="rtl",{flexDirection:Ve?"row-reverse":"row"})})},onClick:Z=>!we&&Ae(Z),onScroll:()=>de.updateCurrentPageOnScroll(me,t-1,P,Ie,x),children:I.map((Z,Be)=>{var be,nt,xt,qt;const ve=Math.max(0,I.length-Be-1),H=I[ve],it=(be=I[ve+1])!=null?be:W[ie+B.leading+1],rt=(nt=I[ve-1])!=null?nt:W[ie-B.trailing-1],Fe=H.id===k.id,xe=H.id===M.id,ft=H.id===((xt=I[X+1])==null?void 0:xt.id),It=H.id===((qt=I[X-1])==null?void 0:qt.id),ct=k.sourceOrder>H.sourceOrder,Ke=k.sourceOrder<H.sourceOrder,Bt=B.lastLeadingChapterSourceOrder===H.sourceOrder,_t=B.lastTrailingChapterSourceOrder===H.sourceOrder,ce=Bt&&B.isLeadingChapterPreloadMode||_t&&B.isTrailingChapterPreloadMode,Pt=Ns(ve,I,B),w=H.id===He;return s.jsx(ra,{chapterId:H.id,previousChapterId:it==null?void 0:it.id,nextChapterId:rt==null?void 0:rt.id,isPreviousChapterVisible:Pt.previous,isNextChapterVisible:Pt.next,lastPageRead:ot(H.lastPageRead,0,H.pageCount-1),currentPageIndex:Nr(e,H,M,xe,K,ct,Ke,B),isInitialChapter:Fe,isCurrentChapter:xe,isPreviousChapter:ft,isNextChapter:It,isLeadingChapter:ct,isTrailingChapter:Ke,isPreloadMode:ce,imageRefs:me,setPages:a,setPageLoadStates:l,setTotalPages:d,setCurrentPageIndex:i,setPageToScrollToIndex:n,transitionPageMode:f,retryFailedPagesKeyPrefix:u,readingMode:g,readerWidth:R,pageScaleMode:S,shouldOffsetDoubleSpreads:C,readingDirection:x,shouldUseInfiniteScroll:p,updateCurrentPageIndex:xe?P:_e,scrollIntoView:xe&&B.scrollIntoView,resumeMode:kr(xe,Fe,ct,Ke,B.resumeMode,ee),setReaderStateChapters:ne,setTransitionPageMode:h,pageGap:b,imagePreLoadAmount:v,customFilter:j,shouldStretchPage:E,scrollbarXSize:Q,scrollbarYSize:Oe,readerNavBarWidth:T,onSizeChange:Ye,minWidth:w?0:Le,minHeight:w?0:fe,scrollElement:N.current},H.id)})})}),ua=F(c.memo(da),[Ce,A.useSettingsWithoutDefaultFlag,et,Lt,()=>({updateCurrentPageIndex:de.useUpdateCurrentPageIndex()}),Dt,ke,ze],["currentPageIndex","pageToScrollToIndex","setPageToScrollToIndex","pages","totalPages","setPages","setPageLoadStates","setTotalPages","setCurrentPageIndex","retryFailedPagesKeyPrefix","setTransitionPageMode","readingMode","readingDirection","shouldUseInfiniteScroll","readerWidth","pageScaleMode","shouldOffsetDoubleSpreads","imagePreLoadAmount","pageGap","customFilter","shouldStretchPage","readerNavBarWidth","transitionPageMode","setScrollbarXSize","setScrollbarYSize","isVisible","setIsVisible","updateCurrentPageIndex","showPreview","setShowPreview","initialChapter","currentChapter","chapters","visibleChapters","setReaderStateChapters","isCurrentChapterReady"]),ga=Object.fromEntries(Object.values(gt).map(e=>[e,{scopes:e}])),J=(...e)=>{const[r,n,o,t]=e;return Mr(r,n,{...o,...ga.reader},t)},Ht=(e,r,n,o,t,a,l)=>{if(a){e(n,t[0]);return}const d=Xs(t.indexOf(o),t,l);if(d===void 0){r(n);return}e(n,d)},ha=({scrollElementRef:e})=>{const{direction:r}=tt(),n=A.useGetThemeDirection(),{enableScope:o,disableScope:t}=Es(),{manga:a}=Me(),{isVisible:l,setIsVisible:d}=Lt(),{hotkeys:i,pageScaleMode:f,shouldStretchPage:u,shouldOffsetDoubleSpreads:h,readingMode:g,readingDirection:x,autoScroll:p,scrollAmount:R}=A.useSettings(),S=ht(),{setShowPreview:C}=Dt(),v=A.useExit(),b=de.useOpenChapter(),j=de.useOpenPage(),E=A.useCreateUpdateSetting(a!=null?a:Ge),T=A.useCreateDeleteSetting(a!=null?a:Ge);return J(i[q.PREVIOUS_PAGE],()=>j("previous"),[j]),J(i[q.NEXT_PAGE],()=>j("next"),[j]),J(i[q.SCROLL_BACKWARD],()=>e.current&&de.scroll(os.BACKWARD,as[g.value],g.value,x.value,r,e.current,b,d,C,R),{preventDefault:!0},[g.value,x.value,r,b,R]),J(i[q.SCROLL_FORWARD],()=>e.current&&de.scroll(os.FORWARD,as[g.value],g.value,x.value,r,e.current,b,d,C,R),{preventDefault:!0},[g.value,x.value,r,b,R]),J(i[q.PREVIOUS_CHAPTER],()=>b(le("previous","next",n)),[b,n]),J(i[q.NEXT_CHAPTER],()=>b(le("next","previous",n)),[b,n]),J(i[q.TOGGLE_MENU],()=>d(!l),[l]),J(i[q.CYCLE_SCALE_TYPE],()=>{Ht(E,T,"pageScaleMode",f.value,Os,f.isDefault,!0)},[E,T,f.value,f.isDefault]),J(i[q.STRETCH_IMAGE],()=>E("shouldStretchPage",!u.value),[E,u.value]),J(i[q.OFFSET_SPREAD_PAGES],()=>E("shouldOffsetDoubleSpreads",!h.value),[E,h.value]),J(i[q.CYCLE_READING_MODE],()=>{Ht(E,T,"readingMode",g.value,As,g.isDefault,!0)},[E,T,g.value,g.isDefault]),J(i[q.CYCLE_READING_DIRECTION],()=>{Ht(E,T,"readingDirection",x.value,Ls,x.isDefault,!0)},[E,T,x.value,x.isDefault]),J(i[q.TOGGLE_AUTO_SCROLL],S.toggleActive,{preventDefault:!0},[S.toggleActive]),J(i[q.AUTO_SCROLL_SPEED_DECREASE],()=>E("autoScroll",{...p,value:Math.min(Pe.max,p.value+Pe.step)}),[E,p.value]),J(i[q.AUTO_SCROLL_SPEED_INCREASE],()=>E("autoScroll",{...p,value:Math.max(Pe.min,p.value-Pe.step)}),[E,p.value]),J(i[q.EXIT_READER],v,[v]),c.useEffect(()=>(o(gt.READER),()=>t(gt.READER)),[]),null},fa=(e,r,n,o,t,a,l,d,i,f,u,h)=>{c.useEffect(()=>()=>{e(void 0),r(St),n(0),o(null),t(0),a([Hr("",0)]),l([]),d([{url:"",loaded:!1}]),i(Te.NONE),f(!1),u(Vr),h()},[])},xa=(e,r,n,o,t,a)=>{var l;c.useEffect(()=>{var p;const d=(p=e.data)==null?void 0:p.manga;if(!d||r.loading||r.error)return;const i=is(d,n),f=Wr(d,i.shouldUseAutoWebtoonMode,i.readingMode),u={...n,readingMode:f?V.WEBTOON:n.readingMode},h=f?V.WEBTOON:i.readingMode.value,g=Fr("global",{meta:o},u,void 0,h),x=is(d,g);t(x),a(!0)},[(l=e.data)==null?void 0:l.manga,n])},bs=5e3,pa=(e,r,n,o,t,a,l,d,i)=>{const{t:f}=U(),u=c.useRef(void 0),h=c.useRef(void 0),g=c.useRef(void 0),x=c.useRef(!0);c.useEffect(()=>{if(e||r||!n)return;const p=JSON.stringify(o)!==JSON.stringify(u.current);l&&p&&Bs(f(Ut[o.value].title),{autoHideDuration:bs}),u.current=o;const S=JSON.stringify(t)!==JSON.stringify(h.current)||JSON.stringify(a)!==JSON.stringify(g.current);d&&S&&(i(!0),x.current&&setTimeout(()=>i(!1),bs)),h.current=t,g.current=a,x.current=!1},[e,r,n,o.value,o.isDefault,t.value,t.isDefault,a.value,a.isDefault])},ma=(e,r,n,o,t,a)=>{var u;const l=Ur(),d=Ms().state,{updateInitialChapter:i}=d!=null?d:{},f=i?void 0:n;c.useEffect(()=>{var b,j;const h=(b=e.data)==null?void 0:b.chapters.nodes,g=h?(j=h[h.length-r])!=null?j:null:void 0,x=f!=null?f:g,p=o!=null?o:g,R=h&&g&&Ue.getNextChapter(g,h,{offset:Tt.NEXT,skipDupe:a,skipDupeChapter:p}),S=h&&g&&Ue.getNextChapter(g,h,{offset:Tt.PREVIOUS,skipDupe:a,skipDupeChapter:p}),C=!h||!p?[]:a?Ue.removeDuplicates(p,h):h,v=x!=null&&x.id!==(f==null?void 0:f.id);v&&l("",{replace:!0,state:{...d,updateInitialChapter:void 0}}),t(E=>{var L,D,O;const T=(g==null?void 0:g.id)!==((L=E.currentChapter)==null?void 0:L.id);return{...E,mangaChapters:h!=null?h:[],chapters:C,initialChapter:x,chapterForDuplicatesHandling:p,currentChapter:g,nextChapter:R,previousChapter:S,isCurrentChapterReady:T?!1:E.isCurrentChapterReady,visibleChapters:v?{...St.visibleChapters,lastLeadingChapterSourceOrder:(D=x==null?void 0:x.sourceOrder)!=null?D:St.visibleChapters.lastLeadingChapterSourceOrder,lastTrailingChapterSourceOrder:(O=x==null?void 0:x.sourceOrder)!=null?O:St.visibleChapters.lastTrailingChapterSourceOrder,isLeadingChapterPreloadMode:!1,isTrailingChapterPreloadMode:!1,scrollIntoView:!!E.initialChapter}:E.visibleChapters}})},[(u=e.data)==null?void 0:u.chapters.nodes,r,a,f])},va=({setOverride:e,readerNavBarWidth:r,isVisible:n,setIsVisible:o,manga:t,setManga:a,shouldSkipDupChapters:l,backgroundColor:d,readingMode:i,tapZoneLayout:f,tapZoneInvertMode:u,shouldShowReadingModePreview:h,shouldShowTapZoneLayoutPreview:g,setSettings:x,initialChapter:p,chapterForDuplicatesHandling:R,currentChapter:S,setReaderStateChapters:C,setTotalPages:v,setCurrentPageIndex:b,setPageToScrollToIndex:j,setPages:E,setPageUrls:T,setPageLoadStates:L,setTransitionPageMode:D,cancelAutoScroll:O,setShowPreview:y})=>{var he,we,pe;const{t:P}=U(),G=c.useRef(null),[ge,k]=c.useState(!1),{chapterSourceOrder:M,mangaId:W}=zr(),B=Number(M),ne=Number(W),K=zt.useGetManga($r,ne),oe=zt.useGetMangaChapters(Xr,ne);vn(!t||!S?P("reader.title",{mangaId:ne,chapterIndex:B}):"".concat(t.title,": ").concat(S.name));const{metadata:Y,settings:ee,request:N}=Yr(),Re=S===void 0||!ge||K.loading||oe.loading||N.loading,ae=(we=(he=K.error)!=null?he:oe.error)!=null?we:N.error;return c.useEffect(()=>{var Q;a((Q=K.data)==null?void 0:Q.manga)},[(pe=K.data)==null?void 0:pe.manga]),fa(a,C,b,j,v,E,T,L,D,o,x,O),xa(K,N,ee,Y,x,k),pa(Re,ae,ge,i,f,u,h,g,y),ma(oe,B,p,R,C,l),c.useLayoutEffect(()=>(e({status:!0,value:s.jsxs($,{sx:{position:"absolute"},children:[s.jsx(ha,{scrollElementRef:G}),s.jsx(Po,{isVisible:n}),!G.current&&s.jsx($,{onClick:()=>o(!n),sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"transparent"}})]})}),()=>e({status:!1,value:null})),[n,o,G.current]),ae?s.jsx(jt,{message:P("global.error.label.failed_to_load_data"),messageExtra:ys(ae),retry:()=>{K.error&&K.refetch().catch(vt()),N.error&&N.refetch().catch(vt()),oe.error&&oe.refetch().catch(vt())}}):Re?s.jsx($,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:s.jsx(At,{})}):S===null?s.jsx(jt,{message:P("reader.error.label.chapter_not_found")}):!t||!S?null:s.jsxs($,{sx:{position:"relative",display:"flex",flexDirection:"column",width:"calc(100vw - ".concat(r,"px)"),height:"100vh",marginLeft:"".concat(r,"px"),transition:Q=>"width 0.".concat(Q.transitions.duration.shortest,"s, margin-left 0.").concat(Q.transitions.duration.shortest,"s"),overflow:"auto",backgroundColor:Ps[d]},children:[s.jsx(ua,{ref:G}),s.jsx(ko,{}),s.jsx(Mo,{})]})},Qa=F(c.memo(va),[ze,Lt,Me,ke,Gr,()=>{const{shouldSkipDupChapters:e,backgroundColor:r,shouldShowReadingModePreview:n,shouldShowTapZoneLayoutPreview:o}=A.useSettingsWithoutDefaultFlag();return{shouldSkipDupChapters:e,backgroundColor:r,shouldShowReadingModePreview:n,shouldShowTapZoneLayoutPreview:o}},()=>{const{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}=A.useSettings();return{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}},Ce,()=>({cancelAutoScroll:ht().cancel}),Dt],["setOverride","readerNavBarWidth","isVisible","setIsVisible","manga","setManga","shouldSkipDupChapters","backgroundColor","readingMode","tapZoneLayout","tapZoneInvertMode","shouldShowReadingModePreview","shouldShowTapZoneLayoutPreview","setSettings","initialChapter","chapterForDuplicatesHandling","currentChapter","setReaderStateChapters","setTotalPages","setCurrentPageIndex","setPageToScrollToIndex","setPages","setPageUrls","setPageLoadStates","setTransitionPageMode","cancelAutoScroll","setShowPreview"]);export{Qa as Reader};
