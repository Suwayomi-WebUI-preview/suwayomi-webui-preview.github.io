import{u as F,w as A,a as M,j as e,G as S,c as h,g as ae,I as ue,r as ge,i as me,x as be,s as he,k as X,P as pe,N as fe,E as Y,h as xe}from"./index-BUTliqEp.js";import{u as E,S as re,A as Ce,N as ye}from"./AppbarSearch-BVJ3gk3O.js";import{T as je,a as Se}from"./Tabs-DN_4D6Vn.js";import{d as ke}from"./FilterList-qCf49hRW.js";import{C as I}from"./CheckboxInput-D0NBHOj-.js";import{S as _e,R as D}from"./SortRadioInput-BJASs-QB.js";import{T as v}from"./ThreeStateCheckboxInput-xSheYoqN.js";import{O as Le,S as Te,a as we}from"./SelectionFAB-mBf6W7yC.js";import{T as se,u as Me}from"./useManageMangaLibraryState-BUGa0-bZ.js";import{F as T}from"./TextField-DbHHfP2S.js";import{R as Fe}from"./ListPreference-DASd32F-.js";import{M as Ae,a as Ie}from"./MangaGrid-CctotpaR.js";import{U as ve}from"./UpdateChecker-DOpARWxp.js";import{C as Re}from"./Checkbox-BXHsH9ah.js";import{T as Ne,a as Oe}from"./TabsMenu-xgM_AVqx.js";import{C as De}from"./Chip-DzSTQGO0.js";import"./StyledFab-CN-LTDpG.js";import"./index-C4PQTfe1.js";import"./CardContent-pkhIyWfQ.js";import"./Avatar-BIrxdbC_.js";import"./InputAdornment-bcAWJ8-X.js";import"./SpinnerImage-DQfmQFcX.js";import"./Collapse-B9zsy7BA.js";import"./Link-9UOP0Cjh.js";import"./NumberSetting-B8TM0m7L.js";import"./Info-BrtZR6Cd.js";import"./useMobilePicker-BX50eNVm.js";import"./SelectSetting-D2-cKEhu.js";import"./Select-C_w8L7KK.js";import"./Mangas-03KFrsgc.js";import"./Chapters-Dpy1CPbF.js";import"./SwitchBase-DE0T-I9x.js";import"./Delete-BRnlyXvT.js";import"./Sync-BUVITt95.js";import"./PlayArrow-FE9FexWu.js";import"./Progress-CekEjKoP.js";import"./date-bUAEMM6q.js";const Pe={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},Ee=[["sortToRead","library.option.sort.label.by_unread_chapters"],["sortAlph","library.option.sort.label.alphabetically"],["sortDateAdded","library.option.sort.label.by_date_added"],["sortLastRead","library.option.sort.label.by_last_read"],["sortLatestFetchedChapter","library.option.sort.label.by_latest_fetched_chapter"],["sortLatestUploadedChapter","library.option.sort.label.by_latest_uploaded_chapter"]],Be=({open:a,onClose:o})=>{var m,C;const{t}=F(),{options:s,setOptions:i}=A(),c=M.useGetTrackerList(),d=se.getLoggedIn((C=(m=c.data)==null?void 0:m.trackers.nodes)!=null?C:[]),r=(b,l)=>{i(g=>({...g,[b]:l}))};return e.jsx(Le,{open:a,onClose:o,tabs:["filter","sort","display"],tabTitle:b=>t(Pe[b]),tabContent:b=>{if(b==="filter")return e.jsxs(e.Fragment,{children:[e.jsx(v,{label:t("global.filter.label.unread"),checked:s.unread,onChange:l=>r("unread",l)}),e.jsx(v,{label:t("global.filter.label.downloaded"),checked:s.downloaded,onChange:l=>r("downloaded",l)}),e.jsx(v,{label:t("global.filter.label.bookmarked"),checked:s.bookmarked,onChange:l=>r("bookmarked",l)}),e.jsx(T,{sx:{mt:2},children:t("global.filter.label.tracked")}),d.map(l=>e.jsx(v,{label:l.name,checked:s.tracker[l.id],onChange:g=>r("tracker",{...s.tracker,[l.id]:g})},l.id))]});if(b==="sort")return Ee.map(([l,g])=>e.jsx(_e,{label:t(g),checked:s.sorts===l,sortDescending:s.sortDesc,onClick:()=>l!==s.sorts?r("sorts",l):r("sortDesc",!s.sortDesc)},l));if(b==="display"){const{gridLayout:l,showContinueReadingButton:g,showDownloadBadge:u,showUnreadBadge:k,showTabSize:_}=s;return e.jsxs(e.Fragment,{children:[e.jsx(T,{children:t("global.grid_layout.title")}),e.jsxs(Fe,{onChange:R=>r("gridLayout",Number(R.target.value)),value:l,children:[e.jsx(D,{label:t("global.grid_layout.label.compact_grid"),value:S.Compact,checked:l==null||l===S.Compact}),e.jsx(D,{label:t("global.grid_layout.label.comfortable_grid"),value:S.Comfortable,checked:l===S.Comfortable}),e.jsx(D,{label:t("global.grid_layout.label.list"),value:S.List,checked:l===S.List})]}),e.jsx(T,{sx:{mt:2},children:t("library.option.display.badge.title")}),e.jsx(I,{label:t("library.option.display.badge.label.unread_badges"),checked:k,onChange:()=>r("showUnreadBadge",!k)}),e.jsx(I,{label:t("library.option.display.badge.label.download_badges"),checked:u,onChange:()=>r("showDownloadBadge",!u)}),e.jsx(T,{sx:{mt:2},children:t("library.option.display.tab.title")}),e.jsx(I,{label:t("library.option.display.tab.label.show_number_of_items"),checked:_,onChange:()=>r("showTabSize",!_)}),e.jsx(T,{sx:{mt:2},children:t("global.label.other")}),e.jsx(I,{label:t("library.option.display.other.label.show_continue_reading_button"),checked:g,onChange:()=>r("showContinueReadingButton",!g)})]})}return null}})},Ge=()=>{const{t:a}=F(),[o,t]=h.useState(!1),{options:s}=A(),i=s.downloaded!=null||s.unread!=null||Object.values(s.tracker).some(c=>c!=null);return e.jsxs(e.Fragment,{children:[e.jsx(ae,{title:a("settings.title"),children:e.jsx(ue,{onClick:()=>t(!o),color:i?"warning":"default",children:e.jsx(ke,{})})}),e.jsx(Be,{open:o,onClose:()=>t(!1)})]})},Z=({showFilteredOutMessage:a,message:o,messageExtra:t,...s})=>{const{t:i}=F(),[c]=E("query",re),{options:d}=A(),{unread:r,downloaded:m}=d;return h.useEffect(()=>{window.scrollTo(0,0)},[c,r,m]),e.jsx(Ae,{...s,hasNextPage:!1,loadMore:()=>{},message:a?i("library.error.label.no_matches"):o,messageExtra:a?void 0:t,gridLayout:d.gridLayout})};var B={},ze=me;Object.defineProperty(B,"__esModule",{value:!0});var oe=B.default=void 0,Ue=ze(ge()),qe=e;oe=B.default=(0,Ue.default)((0,qe.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");const Ke=({isActive:a,areAllItemsSelected:o,areNoItemsSelected:t,onSelectAll:s,onModeChange:i})=>{const{t:c}=F();return e.jsxs(e.Fragment,{children:[a&&e.jsx(Te,{areAllItemsSelected:o,areNoItemsSelected:t,onChange:s}),e.jsx(ae,{title:c(a?"global.button.cancel":"global.button.select_all"),children:e.jsx(Re,{checkedIcon:e.jsx(oe,{}),sx:{padding:"8px"},checked:a,onChange:(d,r)=>i(r)})})]})},le=(a,o,t)=>{switch(a){case!0:return o();case!1:return t();default:return!0}},P=(a,o)=>le(a,()=>!!o&&o>=1,()=>o===0),Qe=(a,{title:o})=>a?o.toLowerCase().includes(a.toLowerCase()):!0,We=(a,{genre:o})=>a?a.split(",").map(s=>s.toLowerCase().trim()).every(s=>o.map(i=>i.toLowerCase()).includes(s)):!0,Ve=(a,o)=>Object.entries(a).map(([t,s])=>{const c=se.getTrackers(o.trackRecords.nodes).some(d=>d.id===Number(t));return le(s,()=>c,()=>!c)}).every(t=>t),He=(a,o,t,s,i,c,d)=>a.filter(r=>{const m=d&&(o==null?void 0:o.length),C=Qe(o,r)||We(o,r),b=m||P(s,r.downloadCount)&&P(t,r.unreadCount)&&P(i,r.bookmarkCount)&&Ve(c,r);return C&&b}),w=(a=0,o=0)=>Number(a)-Number(o),$e=(a,o)=>a.localeCompare(o),Je=(a,o,t)=>{const s=[...a];switch(o){case"sortAlph":s.sort((i,c)=>$e(i.title,c.title));break;case"sortDateAdded":s.sort((i,c)=>w(i.inLibraryAt,c.inLibraryAt));break;case"sortToRead":s.sort((i,c)=>w(i.unreadCount,c.unreadCount));break;case"sortLastRead":s.sort((i,c)=>{var d,r;return w((d=i.lastReadChapter)==null?void 0:d.lastReadAt,(r=c.lastReadChapter)==null?void 0:r.lastReadAt)});break;case"sortLatestUploadedChapter":s.sort((i,c)=>{var d,r;return w((d=i.latestUploadedChapter)==null?void 0:d.uploadDate,(r=c.latestUploadedChapter)==null?void 0:r.uploadDate)});break;case"sortLatestFetchedChapter":s.sort((i,c)=>{var d,r;return w((d=i.latestFetchedChapter)==null?void 0:d.fetchedAt,(r=c.latestFetchedChapter)==null?void 0:r.fetchedAt)});break}return t&&s.reverse(),s},Xe=a=>{const[o]=E("query",re),{options:t}=A(),{unread:s,downloaded:i,bookmarked:c,tracker:d}=t,{settings:r}=be(),m=h.useMemo(()=>He(a,o,s,i,c,d,r.ignoreFilters),[a,o,s,i,c,d,r.ignoreFilters]),C=h.useMemo(()=>Je(m,t.sorts,t.sortDesc),[m,t.sorts,t.sortDesc]),b=Object.values(t.tracker).some(g=>g!=null),l=(s!=null||i!=null||c!=null||!!o||b)&&m.length===0&&a.length>0;return{visibleMangas:C,showFilteredOutMessage:l}},ee=he("span")({display:"flex",alignItems:"center"}),te=a=>e.jsx(De,{...a,size:"small",sx:{marginLeft:"5px"}});function Ot(){var $,J;const{t:a}=F(),{options:o}=A(),{data:t,error:s,loading:i,refetch:c}=M.useGetCategories({notifyOnNetworkStatusChange:!0}),d=t==null?void 0:t.categories.nodes.filter(n=>n.id!==0||n.id===0&&n.mangas.totalCount),r=d!=null?d:[],m=h.useMemo(()=>r.map(n=>n.mangas.totalCount).reduce((n,p)=>n+p,0),[r]),[C,b]=E("tab",ye),l=($=r.find(n=>n.order===C))!=null?$:r[0],{data:g,error:u,loading:k,refetch:_}=M.useGetCategoryMangas(l==null?void 0:l.id,{skip:!l,notifyOnNetworkStatusChange:!0}),R=(J=g==null?void 0:g.mangas.nodes)!=null?J:[],{visibleMangas:f,showFilteredOutMessage:G}=Xe(R),z=h.useCallback(()=>_().catch(X()),[_,l]),ne=h.useMemo(()=>f.map(n=>n.id),[f]),[y,N]=h.useState(!1),{areNoItemsForKeySelected:U,areAllItemsForKeySelected:q,selectedItemIds:j,handleSelectAll:O,handleSelection:ie,clearSelection:ce}=Me(f.length,{itemIds:ne,currentKey:l==null?void 0:l.id.toString()}),K=(n,p,x)=>{N(!!(j.length+(p?1:-1))),ie(n,p,x)},Q=h.useMemo(()=>j.map(n=>M.graphQLClient.client.cache.readFragment({id:M.graphQLClient.client.cache.identify({__typename:"MangaType",id:n}),fragment:pe,fragmentName:"PARTIAL_MANGA_FIELDS"})),[j.length,f]),W=h.useMemo(()=>y?e.jsx(we,{selectedItemsCount:j.length,title:"manga.title",children:(n,p)=>e.jsx(Ie,{selectedMangas:Q,onClose:x=>{n(),N(x),x||ce()},setHideMenu:p})}):null,[y,Q]),{setTitle:V,setAction:H}=h.useContext(fe);h.useEffect(()=>{const n=a("library.title"),p=e.jsxs(ee,{children:[n,o.showTabSize&&e.jsx(te,{label:m})]});return V(p,n),H(e.jsxs(e.Fragment,{children:[!y&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{}),e.jsx(Ge,{}),e.jsx(ve,{})]}),e.jsx(Ke,{isActive:y,areAllItemsSelected:q,areNoItemsSelected:U,onSelectAll:x=>O(x,[...new Set(f.map(L=>L.id))]),onModeChange:x=>{N(x),x?O(!0,[...new Set(f.map(L=>L.id))]):r.forEach(L=>O(!1,[],L.id.toString()))}})]})),()=>{V(""),H(null)}},[a,m,i,o,y,U,q,j.length,f.length]);const de=n=>{b(n)};return s!=null?e.jsx(Y,{message:a("category.error.label.request_failure"),messageExtra:s.message,retry:()=>c().catch(X())}):i?e.jsx(xe,{}):r.length===0?e.jsx(Y,{message:a("library.error.label.empty")}):r.length===1?e.jsxs(e.Fragment,{children:[e.jsx(Z,{mangas:f,message:a(u?"manga.error.label.request_failure":"library.error.label.empty"),messageExtra:u==null?void 0:u.message,isLoading:k,selectedMangaIds:j,isSelectModeActive:y,handleSelection:K,showFilteredOutMessage:!u&&G,retry:u&&z}),W]}):e.jsxs(Ne,{children:[e.jsx(Oe,{value:l.order,onChange:(n,p)=>de(p),tabsCount:r.length,children:r.map(n=>e.jsx(je,{sx:{display:"flex"},label:e.jsxs(ee,{children:[n.name,o.showTabSize?e.jsx(te,{label:n.mangas.totalCount}):null]}),value:n.order},n.id))}),r.map(n=>e.jsx(Se,{index:n.order,currentIndex:l.order,children:n===l&&e.jsx(Z,{mangas:f,message:a(u?"manga.error.label.request_failure":"library.error.label.empty"),messageExtra:u==null?void 0:u.message,isLoading:k,selectedMangaIds:j,isSelectModeActive:y,handleSelection:K,showFilteredOutMessage:!u&&G,retry:u&&z})},n.order)),W]})}export{Ot as Library};
