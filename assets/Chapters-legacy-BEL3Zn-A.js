!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}var t=["isBookmarked"],r=["offset"];function n(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e,t,r){return(t=p(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var i=n&&n.prototype instanceof l?n:l,s=Object.create(i.prototype);return c(s,"_invoke",function(r,n,a){var o,i,c,l=0,s=a||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return o=t,i=0,c=e,f.n=r,u}};function p(r,n){for(i=r,c=n,t=0;!d&&l&&!a&&t<s.length;t++){var a,o=s[t],p=f.p,m=o[2];r>3?(a=m===n)&&(c=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=p&&((a=r<2&&p<o[1])?(i=0,f.v=n,f.n=o[1]):p<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,f.n=m,i=0))}if(a||r>1)return u;throw d=!0,n}return function(a,s,m){if(l>1)throw TypeError("Generator is already running");for(d&&1===s&&p(s,m),i=s,c=m;(t=i<2?e:c)||!d;){o||(i?i<3?(i>1&&(f.n=-1),p(i,c)):f.n=c:f.v=c);try{if(l=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(d=f.n<0)?c:r.call(n,f))!==u)break}catch(t){o=e,i=1,c=t}finally{l=1}}return{value:t,done:d}}}(r,a,o),!0),s}var u={};function l(){}function s(){}function d(){}t=Object.getPrototypeOf;var f=[][n]?t(t([][n]())):(c(t={},n,function(){return this}),t),p=d.prototype=l.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return s.prototype=d,c(p,"constructor",d),c(d,"constructor",s),s.displayName="GeneratorFunction",c(d,a,"GeneratorFunction"),c(p),c(p,a,"Generator"),c(p,n,function(){return this}),c(p,"toString",function(){return"[object Generator]"}),(i=function(){return{w:o,m:m}})()}function c(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}c=function(e,t,r,n){function o(t,r){c(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},c(e,t,r,n)}function l(e,t,r,n,a,o,u){try{var i=e[o](u),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function s(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function u(e){l(o,n,a,u,i,"next",e)}function i(e){l(o,n,a,u,i,"throw",e)}u(void 0)})}}function d(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function p(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,r||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:r+""}System.register(["./index-legacy-Ccd0e-Gb.js","./DateHelper-legacy-aOaHVOVs.js","./Asserts-legacy-9zTzPVw_.js"],function(e,a){"use strict";var c,l,p,m,b,h,y,k,v,g,w,_,O,D,C,A,j,S,N,P,T,R,x,E;return{setters:[function(e){c=e.ea,l=e.eb,p=e.ec,m=e.ed,b=e.ee,h=e.ef,y=e.eg,k=e.eh,v=e.ei,g=e.ej,w=e.r,_=e.ek,O=e.A,D=e.bj,C=e.dA,A=e.az,j=e.as,S=e.m,N=e.g,P=e.d4,T=e.dr},function(e){R=e.g,x=e.e},function(e){E=e.a}],execute:function(){function a(e){var t=l(e.client),r=t.cache,n=e.from,a=p(e,["from"]),o=m.useMemo(function(){return"string"==typeof n?n:null===n?null:r.identify(n)},[r,n]),u=b(function(){return h(h({},a),{from:o})},[a,o]),i=m.useMemo(function(){var e=u.fragment,r=u.fragmentName,n=u.from,a=u.optimistic,o=void 0===a||a;if(null===n)return{result:M({result:{},complete:!1})};var i=t.cache,c=i.diff(h(h({},u),{returnPartialData:!0,id:n,query:i.getFragmentDoc(e,r),optimistic:o}));return{result:M(h(h({},c),{result:t.queryManager.maskFragment({fragment:e,fragmentName:r,data:c.result})}))}},[t,u]),c=m.useCallback(function(){return i.result},[i]);return y(m.useCallback(function(e){var r=0,n=null===u.from?null:t.watchFragment(u).subscribe({next:function(t){k(t,i.result)||(i.result=t,clearTimeout(r),r=setTimeout(e))}});return function(){null==n||n.unsubscribe(),clearTimeout(r)}},[t,u,i]),c,c)}function M(e){var t={data:e.result,complete:!!e.complete};return e.missing&&(t.missing=v(e.missing.map(function(e){return e.missing}))),t}e("F",{id:-1,name:"",realUrl:"",isBookmarked:!1}),e("D",{unread:void 0,downloaded:void 0,bookmarked:void 0,reverse:!0,sortBy:"source",showChapterNumber:!1,excludedScanlators:[]}),e("a",{source:"global.sort.label.by_source",chapterNumber:"global.sort.label.by_chapter_number",uploadedAt:"global.sort.label.by_upload_date",fetchedAt:"global.sort.label.by_fetch_date"});var F=e("c",{download:{always:!1,bulkAction:!1,bulkActionCountForce:300},delete:{always:!0,bulkAction:!0},bookmark:{always:!1,bulkAction:!1},unbookmark:{always:!1,bulkAction:!0},mark_as_read:{always:!1,bulkAction:!0},mark_as_unread:{always:!1,bulkAction:!0}}),B=e("b",{download:{action:{single:"chapter.action.download.add.label.action",selected:"chapter.action.download.add.button.selected"},confirmation:"chapter.action.download.add.label.confirmation",success:"chapter.action.download.add.label.success",error:"chapter.action.download.add.label.error"},delete:{action:{single:"chapter.action.download.delete.label.action",selected:"chapter.action.download.delete.button.selected"},confirmation:"chapter.action.download.delete.label.confirmation",success:"chapter.action.download.delete.label.success",error:"chapter.action.download.delete.label.error"},bookmark:{action:{single:"chapter.action.bookmark.add.label.action",selected:"chapter.action.bookmark.add.button.selected"},success:"chapter.action.bookmark.add.label.success",error:"chapter.action.bookmark.add.label.error"},unbookmark:{action:{single:"chapter.action.bookmark.remove.label.action",selected:"chapter.action.bookmark.remove.button.selected"},confirmation:"chapter.action.bookmark.remove.label.confirmation",success:"chapter.action.bookmark.remove.label.success",error:"chapter.action.bookmark.remove.label.error"},mark_as_read:{action:{single:"chapter.action.mark_as_read.add.label.action.current",selected:"chapter.action.mark_as_read.add.button.selected"},confirmation:"chapter.action.mark_as_read.add.label.confirmation",success:"chapter.action.mark_as_read.add.label.success",error:"chapter.action.mark_as_read.add.label.error"},mark_as_unread:{action:{single:"chapter.action.mark_as_read.remove.label.action",selected:"chapter.action.mark_as_read.remove.button.selected"},confirmation:"chapter.action.mark_as_read.remove.label.confirmation",success:"chapter.action.mark_as_read.remove.label.success",error:"chapter.action.mark_as_read.remove.label.error"}}),I=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}(e,null,[{key:"getIds",value:function(e){return e.map(function(e){return e.id})}},{key:"getFromCache",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"CHAPTER_LIST_FIELDS";return w.graphQLClient.client.cache.readFragment({id:w.graphQLClient.client.cache.identify({__typename:"ChapterType",id:e}),fragment:t,fragmentName:r})}},{key:"getDownloadStatusFromCache",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"DOWNLOAD_TYPE_FIELDS";return w.graphQLClient.client.cache.readFragment({id:w.graphQLClient.client.cache.identify({__typename:"DownloadType",chapter:{__ref:w.graphQLClient.client.cache.identify({__typename:"ChapterType",id:e})}}),fragment:t,fragmentName:r})}},{key:"useDownloadStatusFromCache",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"DOWNLOAD_TYPE_FIELDS",u=(r={from:{__typename:"DownloadType",chapter:{__ref:w.graphQLClient.client.cache.identify({__typename:"ChapterType",id:e})}},fragment:n,fragmentName:o,client:w.graphQLClient.client},c("useFragment",a,l(r.client))(r));return u.complete&&Object.keys(null!==(t=u.data)&&void 0!==t?t:{}).length?u.data:null}},{key:"getReaderUrl",value:function(e){return O.reader.path(e.mangaId,e.sourceOrder)}},{key:"isDownloading",value:function(t){var r=[D.Downloading,D.Queued],n=e.getDownloadStatusFromCache(t);return r.includes(null==n?void 0:n.state)}},{key:"isDownloaded",value:function(e){return e.isDownloaded}},{key:"getDownloaded",value:function(t){return t.filter(e.isDownloaded)}},{key:"isDownloadable",value:function(t){var r=e.getDownloadStatusFromCache(t.id);return!(e.isDownloaded(t)||r&&r.state!==D.Error)}},{key:"getDownloadable",value:function(e){return e.filter(this.isDownloadable)}},{key:"isDeletable",value:function(r){var n=r.isBookmarked,a=d(r,t),o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.isDownloaded(a)&&(!n||o)}},{key:"getDeletable",value:function(t,r){return t.filter(function(t){return e.isDeletable(t,r)})}},{key:"isBookmarked",value:function(e){return e.isBookmarked}},{key:"getBookmarked",value:function(t){return t.filter(e.isBookmarked)}},{key:"getNonBookmarked",value:function(t){return t.filter(function(t){return!e.isBookmarked(t)})}},{key:"isRead",value:function(e){return e.isRead}},{key:"getRead",value:function(t){return t.filter(e.isRead)}},{key:"getNonRead",value:function(t){return t.filter(function(t){return!e.isRead(t)})}},{key:"getMatchingChapterNumberChapters",value:function(e,t){return e.map(function(e){var r=t.find(function(t){return e.chapterNumber===t.chapterNumber});return r?[e,r]:null}).filter(function(e){return null!==e})}},{key:"download",value:(M=s(i().m(function t(r,n){return i().w(function(t){for(;;)if(0===t.n)return t.a(2,e.executeAction("download",r.length,function(){return w.addChaptersToDownloadQueue(r).response},n))},t)})),function(e,t){return M.apply(this,arguments)})},{key:"delete",value:(v=s(i().m(function t(r,n){return i().w(function(t){for(;;)if(0===t.n)return t.a(2,e.executeAction("delete",r.length,function(){return w.deleteDownloadedChapters(r).response},n))},t)})),function(e,t){return v.apply(this,arguments)})},{key:"markAsRead",value:(k=s(i().m(function t(r){var n,a,o,u,c,l,s,d,f=arguments;return i().w(function(t){for(;;)switch(t.n){case 0:return n=f.length>1&&void 0!==f[1]&&f[1],a=f.length>2?f[2]:void 0,o=f.length>3?f[3]:void 0,t.n=1,C();case 1:return u=t.v,c=u.deleteChaptersManuallyMarkedRead,l=u.deleteChaptersWithBookmark,s=u.updateProgressManualMarkRead,d=c&&n?e.getIds(e.getDeletable(r,l)):[],t.a(2,e.executeAction("mark_as_read",r.length,function(){return w.updateChapters(e.getIds(r),{isRead:!0,lastPageRead:0,chapterIdsToDelete:d,trackProgressMangaId:s&&n?a:void 0}).response},o))}},t)})),function(e){return k.apply(this,arguments)})},{key:"markAsUnread",value:(y=s(i().m(function t(r,n){return i().w(function(t){for(;;)if(0===t.n)return t.a(2,e.executeAction("mark_as_unread",r.length,function(){return w.updateChapters(r,{isRead:!1}).response},n))},t)})),function(e,t){return y.apply(this,arguments)})},{key:"bookmark",value:(h=s(i().m(function t(r){return i().w(function(t){for(;;)if(0===t.n)return t.a(2,e.executeAction("bookmark",r.length,function(){return w.updateChapters(r,{isBookmarked:!0}).response}))},t)})),function(e){return h.apply(this,arguments)})},{key:"unBookmark",value:(b=s(i().m(function t(r){return i().w(function(t){for(;;)if(0===t.n)return t.a(2,e.executeAction("unbookmark",r.length,function(){return w.updateChapters(r,{isBookmarked:!1}).response}))},t)})),function(e){return b.apply(this,arguments)})},{key:"executeAction",value:(m=s(i().m(function e(t,r,n,a){var o,u,c,l,s,d,f;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(o=F[t],u=o.always,c=o.bulkAction,l=o.bulkActionCountForce,s=!a&&(u||c&&r>1)||l&&r>=l,d=B[t].confirmation,e.p=1,!s){e.n=5;break}return E(d),e.p=2,e.n=3,A.confirm({title:j("global.label.are_you_sure"),message:j(d,{count:r}),actions:{confirm:{title:j("global.button.ok")}}});case 3:e.n=5;break;case 4:return e.p=4,e.v,e.a(2);case 5:return e.n=6,n();case 6:S(j(B[t].success,{count:r}),"success"),e.n=8;break;case 7:throw e.p=7,f=e.v,S(j(B[t].error,{count:r}),"error",N(f)),f;case 8:return e.a(2)}},e,null,[[2,4],[1,7]])})),function(e,t,r,n){return m.apply(this,arguments)})},{key:"performAction",value:(p=s(i().m(function t(r,n,a){var o,u,c,l;return i().w(function(t){for(;;)switch(t.n){case 0:o=a.wasManuallyMarkedAsRead,u=a.trackProgressMangaId,c=a.chapters,l=r,t.n="download"===l?1:"delete"===l?2:"mark_as_read"===l?3:"mark_as_unread"===l?4:"bookmark"===l?5:"unbookmark"===l?6:7;break;case 1:return t.a(2,e.download(n));case 2:return t.a(2,e.delete(n));case 3:return t.a(2,e.markAsRead(c,o,u));case 4:return t.a(2,e.markAsUnread(n));case 5:return t.a(2,e.bookmark(n));case 6:return t.a(2,e.unBookmark(n));case 7:throw new Error('Chapters::performAction: unknown action "'.concat(r,'"'));case 8:return t.a(2)}},t)})),function(e,t,r){return p.apply(this,arguments)})},{key:"addDuplicates",value:function(e,t){var r=Object.groupBy(t,function(e){return e.chapterNumber});return e.map(function(e){var t;return null!==(t=r[e.chapterNumber])&&void 0!==t?t:[e]}).flat()}},{key:"removeDuplicates",value:function(e,t){var r=Object.groupBy(t,function(e){return e.chapterNumber}),n=Object.values(r).map(function(t){var r,n;return null!==(r=null!==(n=t.find(function(t){return t.id===e.id}))&&void 0!==n?n:t.findLast(function(t){return t.scanlator===e.scanlator}))&&void 0!==r?r:t.slice(-1)[0]});return t.map(function(e){var t=e.id;return n.find(function(e){return e.id===t})}).filter(function(e){return!!e})}},{key:"getNextChapter",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=a.offset,c=void 0===i?P.NEXT:i,l=d(a,r),s=e.getNextChapters(t,n,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach(function(t){u(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({offset:c},l)),f=c===P.NEXT,p=f?-1:0,m=f?void 0:1;return s.slice(p,m)[0]}},{key:"getNextChapters",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.offset,o=void 0===a?P.NEXT:a,u=n.onlyUnread,i=void 0!==u&&u,c=n.skipDupe,l=void 0!==c&&c,s=n.skipDupeChapter,d=void 0===s?t:s,f=r.findIndex(function(e){return e.id===t.id}),p=o===P.NEXT,m=p?0:f,b=p?f+1:void 0,h=r.slice(m,b),y=(l?e.removeDuplicates(d,h):h).toSpliced(p?-1:0,1);return i?e.getNonRead(y):y}},{key:"getReaderResumeMode",value:function(e){return e.isRead?T.START:T.LAST_READ}},{key:"getReaderOpenChapterLocationState",value:function(t,r){return{resumeMode:e.getReaderResumeMode(t),updateInitialChapter:r}}},{key:"groupByDate",value:function(e,t){return Object.groupBy(e,function(e){return R(x(Number(e[t])))})}},{key:"getMissingCount",value:function(t){var r=t.toSorted(function(e,t){return e.chapterNumber-t.chapterNumber});return r.reduce(function(t,n,a){return t+e.getGap(n,r[a-1])},0)}},{key:"getGap",value:function(e,t){if(!e||!t)return 0;if(-1===e.chapterNumber||-1===t.chapterNumber)return 0;var r=Math.max(e.chapterNumber,t.chapterNumber),n=Math.min(e.chapterNumber,t.chapterNumber);return Math.max(0,Math.floor(r)-Math.floor(n)-1)}},{key:"getScanlators",value:function(e){return n(new Set(e.map(function(e){return e.scanlator}).filter(function(e){return"string"==typeof e})))}}]);var p,m,b,h,y,k,v,M}();e("C",I)}}})}();
