import{c as j,j as e,u as E,r as F,a2 as K,b as W,d as T,_ as n,da as q,i as X,ae as J,a3 as Q,S as H,ad as f,L as Y,dX as Z,C as O,I as ee,a4 as te,a6 as ae,B as oe}from"./index-D2_dCMBF.js";import{c as re,d as u,C as se,e as ne,f as le,D as de,R as ie,V as ce,g as me,M as he}from"./useManageMangaLibraryState-D9P1Mjfm.js";import{C as pe,D as ue}from"./ChapterCardMetadata-BTA0qdR2.js";import{D as ke}from"./Delete-1cwdsCH_.js";import{D as xe}from"./Download-Bd4eVTbT.js";import{M as ge}from"./MUI.util-DDPpK_AC.js";import{L as Ce}from"./ListCardContent-CUni8eKh.js";import{C as be}from"./Card-CKffCtS2.js";import{C as Ie}from"./CardActionArea-4qMvHVwC.js";import{C as fe}from"./Checkbox-ngyJ9_M3.js";const je=j(e.jsx("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"})),_e=j(e.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"})),De=j(e.jsx("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"})),Me=j(e.jsx("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"})),Te=j(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),we=({chapter:a,handleSelection:l,canBeDownloaded:c=!1,selectedChapters:d=[],onClose:r,selectable:o=!0})=>{var v,L,S;const{t:C}=E(),m=!!a,{isDownloaded:x,isRead:_,isBookmarked:i}=a!=null?a:{},b=(S=(L=F.useGetMangaChapters(K,(v=a==null?void 0:a.mangaId)!=null?v:-1,{skip:!a,fetchPolicy:"cache-only"}).data)==null?void 0:L.chapters.nodes)!=null?S:[],{settings:{deleteChaptersWithBookmark:I}}=W(),h=ne(m,q),k=re(m),t=le(m),{downloadableChapters:s,downloadedChapters:p,unbookmarkedChapters:w,bookmarkedChapters:y,unreadChapters:R,readChapters:A}=T.useMemo(()=>({downloadableChapters:n.getDownloadable(d),downloadedChapters:n.getDownloaded(d),unbookmarkedChapters:n.getNonBookmarked(d),bookmarkedChapters:n.getBookmarked(d),unreadChapters:n.getNonRead(d),readChapters:n.getRead(d)}),[d]),U=()=>{l==null||l(a.id,!0),r()},g=(P,$)=>{var N;const V=P==="mark_prev_as_read",z=V?"mark_as_read":P;if(z==="delete"&&a&&!n.isDeletable(a,I)){r();return}const M=(()=>{if(!a)return $;if(!V)return[a];const B=b.findIndex(({id:G})=>G===a.id);return B+1>b.length-1?[]:b.slice(B+1)})();if(!M.length){r();return}n.performAction(z,n.getIds(M),{chapters:M,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(N=M[0])==null?void 0:N.mangaId}).catch(X()),r()};return e.jsxs(e.Fragment,{children:[m&&o&&e.jsx(u,{onClick:U,Icon:se,title:C("chapter.action.label.select")}),m&&e.jsx(u,{Icon:Te,disabled:!a.realUrl,onClick:()=>{window.open(a.realUrl,"_blank","noopener,noreferrer"),r()},title:C("chapter.action.label.open_on_source")}),k(c)&&e.jsx(u,{Icon:xe,disabled:t(!s.length),onClick:()=>g("download",s),title:h("download",s.length)}),k(x)&&e.jsx(u,{Icon:ke,disabled:t(!p.length),onClick:()=>g("delete",n.getDeletable(p,I)),title:h("delete",p.length)}),k(!i)&&e.jsx(u,{Icon:Me,disabled:t(!w.length),onClick:()=>g("bookmark",w),title:h("bookmark",w.length)}),k(i)&&e.jsx(u,{Icon:De,disabled:t(!y.length),onClick:()=>g("unbookmark",y),title:h("unbookmark",y.length)}),k(!_)&&e.jsx(u,{Icon:de,disabled:t(!R.length),onClick:()=>g("mark_as_read",R),title:h("mark_as_read",R.length)}),k(_)&&e.jsx(u,{Icon:ie,disabled:t(!A.length),onClick:()=>g("mark_as_unread",A),title:h("mark_as_unread",A.length)}),m&&e.jsx(u,{onClick:()=>g("mark_prev_as_read",[]),Icon:je,title:C("chapter.action.mark_as_read.add.label.action.previous")})]})},Oe=T.memo(a=>{const{t:l}=E(),c=J(),d=T.useRef(null),{mode:r="manga.page",chapter:o,showChapterNumber:C,onSelect:m,selected:x,selectable:_=!0,isActiveChapter:i=!1}=a,D=x!==null,{isDownloaded:b}=o,I=t=>{D&&(t.preventDefault(),t.stopPropagation(),m(o.id,!x,t.shiftKey))},h=(t,s)=>{t.stopPropagation(),t.preventDefault(),s==null||s(t)},k=ce((t,{context:s})=>{if(!D&&d.current){h(t,()=>s==null?void 0:s(d.current));return}t.shiftKey=!0,I(t)});return e.jsx(Q,{variant:"popover",popupId:"chapter-card-action-menu",children:t=>{var s;return e.jsxs(H,{sx:{pt:1,px:1},children:[e.jsx(be,{sx:{touchCallout:"none",...f(r==="reader"&&i,{backgroundColor:"primary.main"})},children:e.jsx(Ie,{component:Y,to:n.getReaderUrl(o),style:{color:c.palette.text[o.isRead?"disabled":"primary"]},state:n.getReaderOpenChapterLocationState(o,!0),replace:r==="reader",onClick:p=>I(p),...k(t.open),children:e.jsxs(Ce,{children:[e.jsx(pe,{title:C?"".concat(l("chapter.title_one")," ").concat(o.chapterNumber):o.name,secondaryText:o.scanlator,ternaryText:"".concat(Z(Number((s=o.uploadDate)!=null?s:0),!0)).concat(b?" â€¢ ".concat(l("chapter.status.label.downloaded")):""),infoIcons:o.isBookmarked&&e.jsx(_e,{color:r==="reader"&&i?"secondary":"primary"}),slotProps:{title:{variant:"h6",component:"h3",sx:f(r==="reader"&&i,{color:c.palette.primary.contrastText})},secondaryText:{sx:f(r==="reader"&&i,{color:c.palette.primary.contrastText})},ternaryText:{sx:f(r==="reader"&&i,{color:c.palette.primary.contrastText})}}}),e.jsx(ue,{chapterId:o.id,color:r==="reader"&&i?c.palette.primary.contrastText:void 0}),e.jsx(H,{sx:{minHeight:"48px"},children:x===null?e.jsx(O,{title:l("global.button.options"),children:e.jsx(ee,{ref:d,...ge.preventRippleProp(te(t),{onClick:p=>h(p)}),"aria-label":"more",sx:{color:"inherit",...f(r==="reader"&&i,{color:"primary.contrastText"})},children:e.jsx(me,{})})}):e.jsx(O,{title:l(x?"global.button.deselect":"global.button.select"),children:e.jsx(fe,{checked:x})})})]})})}),!D&&t.isOpen&&e.jsx(he,{...ae(t),children:p=>e.jsx(we,{onClose:p,chapter:o,handleSelection:()=>m(o.id,!0),canBeDownloaded:n.isDownloadable(o),selectable:_})})]})}})}),Ee=T.forwardRef(({children:a,...l},c)=>e.jsx(oe,{ref:c,...l,sx:{minWidth:"unset",px:"10px",...l.sx},children:a}));export{_e as B,Oe as C,je as D,Te as L,we as a,Ee as b};
