import{u as f,j as t,o as u,aC as i,a7 as h,bt as I,m as j,c as T,N as U,a as x,b2 as M,l as R,g as P,h as b,t as V}from"./index-G18IN795.js";import{T as W}from"./TextSetting-CA_wMgg2.js";import{N}from"./NumberSetting-CHkyDFFa.js";import{u as z,g as O}from"./usePersistedValue-ruqdsm2r.js";import{S as c}from"./Switch-CIOSGRwv.js";import{S as G}from"./SelectSetting-yfJQ6hxN.js";import{a as H}from"./CategoriesInclusionSetting-D8F9KylQ.js";import{E as B}from"./EmptyViewAbsoluteCentered-BYw38H0A.js";import{L as C}from"./ListSubheader-Bbx-eHU4.js";import"./PasswordTextField-NwQ0e7te.js";import"./TextField-Bws0qK-H.js";import"./InputAdornment-Be-wuiYS.js";import"./Info-B4mhTGOz.js";import"./SwitchBase-Bw-7GSmT.js";import"./Select-DszgPRW6.js";import"./ThreeStateCheckboxInput-Z37WI6oh.js";import"./Checkbox-D4S952Xx.js";const k=2,q=10,v=k,F=({downloadAheadLimit:e})=>{const{t:d}=f(),n=!!e,[s,r]=z("lastDownloadAheadLimit",v,e,O),w=l=>{r(l===0?s:l),I("downloadAheadLimit",l).catch(()=>j(d("global.error.label.failed_to_save_changes"),"error"))},g=l=>{w(l?s:0)};return t.jsxs(u,{children:[t.jsxs(i,{children:[t.jsx(h,{primary:d("download.settings.download_ahead.label.while_reading")}),t.jsx(c,{edge:"end",checked:n,onChange:l=>g(l.target.checked)})]}),t.jsx(N,{settingTitle:d("download.settings.download_ahead.label.unread_chapters_to_download"),settingValue:d("download.settings.download_ahead.label.value",{chapters:s,count:s}),value:s,minValue:k,maxValue:q,defaultValue:v,showSlider:!0,dialogDescription:d("download.settings.download_ahead.label.description"),dialogDisclaimer:d("download.settings.download_ahead.label.disclaimer"),valueUnit:d("chapter.title_one"),handleUpdate:w,disabled:!n})]})},K=[0,1,2,3,4,5],X={0:{text:"global.label.disabled"},1:{text:"download.settings.delete_chapters.while_reading.option.label.first"},2:{text:"download.settings.delete_chapters.while_reading.option.label.second"},3:{text:"download.settings.delete_chapters.while_reading.option.label.third"},4:{text:"download.settings.delete_chapters.while_reading.option.label.fourth"},5:{text:"download.settings.delete_chapters.while_reading.option.label.fifth"}},Y=K.map(e=>[e,X[e]]),J=e=>typeof e=="boolean"?Number(e):e,Q=({chapterToDelete:e,handleChange:d})=>{const{t:n}=f(),s=J(e);return t.jsx(G,{settingName:n("download.settings.delete_chapters.while_reading.label.title"),value:s,values:Y,handleChange:d})},Z=e=>({downloadAsCbz:e.downloadAsCbz,downloadsPath:e.downloadsPath,autoDownloadNewChapters:e.autoDownloadNewChapters,autoDownloadNewChaptersLimit:e.autoDownloadNewChaptersLimit,excludeEntryWithUnreadChapters:e.excludeEntryWithUnreadChapters,autoDownloadIgnoreReUploads:e.autoDownloadIgnoreReUploads}),me=()=>{var E,L,S;const{t:e}=f(),{setTitle:d,setAction:n}=T.useContext(U);T.useLayoutEffect(()=>(d(e("download.settings.title")),n(null),()=>{d(""),n(null)}),[e]);const s=x.useGetCategories(M),r=x.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[w]=x.useUpdateServerSettings(),{settings:g,loading:l,request:{error:_,refetch:A}}=R();if(r.loading||l||s.loading)return t.jsx(P,{});const D=(L=(E=r.error)!=null?E:_)!=null?L:s.error;if(D)return t.jsx(B,{message:e("global.error.label.failed_to_load_data"),messageExtra:D.message,retry:()=>{r.error&&r.refetch().catch(b()),_&&A().catch(b()),s.error&&s.refetch().catch(b())}});const a=Z(r.data.settings),p=(o,y)=>{w({variables:{input:{settings:{[o]:y}}}}).catch(()=>j(e("global.error.label.failed_to_save_changes"),"error"))},m=V(()=>j(e("global.error.label.failed_to_save_changes"),"error"));return t.jsxs(u,{sx:{pt:0},children:[t.jsx(W,{settingName:e("download.settings.download_path.label.title"),dialogDescription:e("download.settings.download_path.label.description"),value:a==null?void 0:a.downloadsPath,settingDescription:a!=null&&a.downloadsPath.length?a.downloadsPath:e("global.label.default"),handleChange:o=>p("downloadsPath",o)}),t.jsxs(i,{children:[t.jsx(h,{primary:e("download.settings.file_type.label.cbz")}),t.jsx(c,{edge:"end",checked:!!(a!=null&&a.downloadAsCbz),onChange:o=>p("downloadAsCbz",o.target.checked)})]}),t.jsxs(u,{subheader:t.jsx(C,{component:"div",id:"download-settings-auto-delete-downloads",children:e("download.settings.delete_chapters.title")}),children:[t.jsxs(i,{children:[t.jsx(h,{primary:e("download.settings.delete_chapters.label.manually_marked_as_read")}),t.jsx(c,{edge:"end",checked:g.deleteChaptersManuallyMarkedRead,onChange:o=>m("deleteChaptersManuallyMarkedRead",o.target.checked)})]}),t.jsx(Q,{chapterToDelete:g.deleteChaptersWhileReading,handleChange:o=>m("deleteChaptersWhileReading",o)}),t.jsxs(i,{children:[t.jsx(h,{primary:e("download.settings.delete_chapters.label.allow_deletion_of_bookmarked")}),t.jsx(c,{edge:"end",checked:g.deleteChaptersWithBookmark,onChange:o=>m("deleteChaptersWithBookmark",o.target.checked)})]})]}),t.jsxs(u,{subheader:t.jsx(C,{component:"div",id:"download-settings-auto-download",children:e("download.settings.auto_download.title")}),children:[t.jsxs(i,{children:[t.jsx(h,{primary:e("download.settings.auto_download.label.new_chapters")}),t.jsx(c,{edge:"end",checked:!!(a!=null&&a.autoDownloadNewChapters),onChange:o=>p("autoDownloadNewChapters",o.target.checked)})]}),t.jsx(N,{disabled:!(a!=null&&a.autoDownloadNewChapters),settingTitle:e("download.settings.auto_download.download_limit.label.title"),dialogDescription:e("download.settings.auto_download.download_limit.label.description"),value:(S=a==null?void 0:a.autoDownloadNewChaptersLimit)!=null?S:0,settingValue:a.autoDownloadNewChaptersLimit?e("download.settings.download_ahead.label.value",{chapters:a.autoDownloadNewChaptersLimit,count:a.autoDownloadNewChaptersLimit}):e("global.label.none"),defaultValue:0,minValue:0,maxValue:20,showSlider:!0,valueUnit:e("chapter.title_one"),handleUpdate:o=>p("autoDownloadNewChaptersLimit",o)}),t.jsxs(i,{children:[t.jsx(h,{primary:e("download.settings.auto_download.label.ignore_with_unread_chapters")}),t.jsx(c,{edge:"end",checked:!!(a!=null&&a.excludeEntryWithUnreadChapters),onChange:o=>p("excludeEntryWithUnreadChapters",o.target.checked),disabled:!(a!=null&&a.autoDownloadNewChapters)})]}),t.jsxs(i,{children:[t.jsx(h,{primary:e("download.settings.auto_download.label.ignore_re_uploads")}),t.jsx(c,{edge:"end",checked:!!(a!=null&&a.autoDownloadIgnoreReUploads),onChange:o=>p("autoDownloadIgnoreReUploads",o.target.checked),disabled:!(a!=null&&a.autoDownloadNewChapters)})]}),t.jsx(H,{categories:s.data.categories.nodes,includeField:"includeInDownload",dialogText:e("download.settings.auto_download.categories.label.include_in_download")})]}),t.jsx(u,{subheader:t.jsx(C,{component:"div",id:"download-settings-download-ahead",children:e("download.settings.download_ahead.title")}),children:t.jsx(F,{downloadAheadLimit:g.downloadAheadLimit})})]})};export{me as DownloadSettings};
