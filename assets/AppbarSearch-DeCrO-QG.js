import{bh as I,e as p,bi as U,c as _,j as v,ac as E,u as F,q as R,an as q,bj as A,C as B,I as z}from"./index-DBNA43rc.js";import{a as G}from"./ChaptersDownloadActionMenuItems-DUTV9Lny.js";function Q(e,t){if(e==null)return e;if(e.length===0&&(!t||t&&e!==""))return null;const r=e instanceof Array?e[0]:e;return r==null?r:!t&&r===""?null:r}function $(e){return e==null?e:String(e)}function W(e){const t=Q(e);return t==null?t:t===""?null:+t}function H(e){return e==null?e:String(e)}function J(e){const t=Q(e,!0);return t==null?t:String(t)}const N={encode:H,decode:J},ye={encode:$,decode:W};function X(e,t){const r={},n=Object.keys(t);for(const s of n){const a=t[s];e[s]?r[s]=e[s].encode(t[s]):r[s]=a==null?a:String(a)}return r}class Y{constructor(){this.paramsMap=new Map,this.registeredParams=new Map}set(t,r,n,s){this.paramsMap.set(t,{stringified:r,decoded:n,decode:s})}has(t,r,n){if(!this.paramsMap.has(t))return!1;const s=this.paramsMap.get(t);return s?s.stringified===r&&(n==null||s.decode===n):!1}get(t){var r;if(this.paramsMap.has(t))return(r=this.paramsMap.get(t))==null?void 0:r.decoded}registerParams(t){for(const r of t){const n=this.registeredParams.get(r)||0;this.registeredParams.set(r,n+1)}}unregisterParams(t){for(const r of t){const n=(this.registeredParams.get(r)||0)-1;n<=0?(this.registeredParams.delete(r),this.paramsMap.has(r)&&this.paramsMap.delete(r)):this.registeredParams.set(r,n)}}clear(){this.paramsMap.clear(),this.registeredParams.clear()}}const k=new Y;function Z(e,t){var r,n,s;const a={};let c=!1;const o=Object.keys(e);let i=o;if(t.includeKnownParams||t.includeKnownParams!==!1&&o.length===0){const u=Object.keys((r=t.params)!=null?r:{});i.push(...u)}for(const u of i){const l=e[u];if(l!=null&&typeof l=="object"){a[u]=l;continue}c=!0,a[u]=(s=(n=t.params)==null?void 0:n[u])!=null?s:N}return c?a:e}function T(e,t,r,n){var s;if(!r||!t.length)return e;let a={...e},c=!1;for(const o of t)Object.prototype.hasOwnProperty.call(a,o)||(a[o]=(s=r[o])!=null?s:n,c=!0);return c?a:e}const ee=Object.prototype.hasOwnProperty;function C(e,t){return e===t?e!==0||t!==0||1/e===1/t:e!==e&&t!==t}function K(e,t,r){var n,s;if(C(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const a=Object.keys(e),c=Object.keys(t);if(a.length!==c.length)return!1;for(let o=0;o<a.length;o++){const i=(s=(n=void 0)==null?void 0:n.equals)!=null?s:C;if(!ee.call(t,a[o])||!i(e[a[o]],t[a[o]]))return!1}return!0}function L(e,t,r){const n={},s=Object.keys(t);for(const a of s){const c=t[a],o=e[a];let i;if(r.has(a,o,c.decode))i=r.get(a);else{if(i=c.decode(o),c.equals&&r.has(a,o)){const f=r.get(a);c.equals(i,f)&&(i=f)}i!==void 0&&r.set(a,o,i,c.decode)}i===void 0&&c.default!==void 0&&(i=c.default),n[a]=i}return n}function te(){let e;function t(r,n,s){const a=L(r,n,s);return e!=null&&K(e,a)?e:(e=a,a)}return t}function re(e){let t;for(const r in e)if(e[r].urlName){const n=e[r].urlName,s="".concat(n,"\0").concat(r);t?t.push(s):t=[s]}return t?t.join("\n"):void 0}function ne(e){if(e)return Object.fromEntries(e.split("\n").map(t=>t.split("\0")))}function ae(e,t){var r;let n={};for(const s in e)((r=t[s])==null?void 0:r.urlName)!=null?n[t[s].urlName]=e[s]:n[s]=e[s];return n}let x,w,D,j={};const V=(e,t,r)=>{if(x===t&&D===e&&w===r)return j;x=t,D=e;const n=e(t!=null?t:"");w=r;const s=ne(r);for(let[a,c]of Object.entries(n)){s!=null&&s[a]&&(delete n[a],a=s[a],n[a]=c);const o=j[a];K(c,o)&&(n[a]=o)}return j=n,n};function se(e,t){var r;for(const n in e)((r=t[n])==null?void 0:r.default)!==void 0&&e[n]!==void 0&&t[n].encode(t[n].default)===e[n]&&(e[n]=void 0)}function oe({changes:e,updateType:t,currentSearchString:r,paramConfigMap:n,options:s}){const{searchStringToObject:a,objectToSearchString:c}=s;t==null&&(t=s.updateType);let o;const i=V(a,r),f=T(n,Object.keys(e),s.params);let u;if(typeof e=="function"){const g=L(i,f,k);u=e(g)}else u=e;o=X(f,u),s.removeDefaultsFromUrl&&se(o,f),o=ae(o,f);let l;return t==="push"||t==="replace"?l=c(o):l=c({...i,...o}),l!=null&&l.length&&l[0]!=="?"&&(l="?".concat(l)),l!=null?l:""}function ce({searchString:e,adapter:t,navigate:r,updateType:n}){const a={...t.location,search:e};typeof n=="string"&&n.startsWith("replace")?t.replace(a):t.push(a)}const ie=e=>e(),le=e=>setTimeout(()=>e(),0),b=[];function ue(e,{immediate:t}={}){b.push(e);let r=t?ie:le;b.length===1&&r(()=>{const n=b.slice();b.length=0;const s=n[0].currentSearchString;let a;for(let c=0;c<n.length;++c){const o=c===0?n[c]:{...n[c],currentSearchString:a};a=oe(o)}e.options.skipUpdateWhenNoChange&&a===s||ce({searchString:a!=null?a:"",adapter:n[n.length-1].adapter,navigate:!0,updateType:n[n.length-1].updateType})})}function fe(e,t){const{adapter:r,options:n}=I(),[s]=p.useState(te),{paramConfigMap:a,options:c}=pe(e,t),o=p.useMemo(()=>U(n,c),[n,c]);let i=Z(a,o);const f=V(o.searchStringToObject,r.location.search,re(i));o.includeAllParams&&(i=T(i,Object.keys(f),o.params,N));const u=s(f,i,k),l=Object.keys(i).join("\0");p.useEffect(()=>{const h=l.split("\0");return k.registerParams(h),()=>{k.unregisterParams(h)}},[l]);const g={adapter:r,paramConfigMap:i,options:o},m=p.useRef(g);m.current==null&&(m.current=g),p.useEffect(()=>{m.current.adapter=r,m.current.paramConfigMap=i,m.current.options=o},[r,i,o]);const[O]=p.useState(()=>(M,y)=>{const{adapter:P,paramConfigMap:d,options:S}=m.current;y==null&&(y=S.updateType),ue({changes:M,updateType:y,currentSearchString:P.location.search,paramConfigMap:d,options:S,adapter:P},{immediate:!S.enableBatching})});return[u,O]}var de=fe;function pe(e,t){let r,n;return e===void 0?(r={},n=t):Array.isArray(e)?(r=Object.fromEntries(e.map(s=>[s,"inherit"])),n=t):(r=e,n=t),{paramConfigMap:r,options:n}}const me=(e,t,r)=>{const n=p.useMemo(()=>({[e]:t!=null?t:"inherit"}),[e,t]),[s,a]=de(n,r),c=s[e],o=p.useCallback((i,f)=>a(typeof i=="function"?u=>{const l=i(u[e]);return{[e]:l}}:{[e]:i},f),[e,a]);return[c,o]},he=_(v.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"})),ve=e=>{const{isClosable:t=!0}=e,r=E(),{t:n}=F(),[s,a]=p.useState(),c=R(),[o,i]=me("query",N),[f,u]=p.useState(!t||!!o),l=q.useRef(void 0),[g,m]=p.useState(o!=null?o:"");s!==c.key&&(a(c.key),m(o!=null?o:""),u(!t||!!o));const O=f||!!o,h=d=>{var S;t&&(u(d),d&&((S=l.current)==null||S.focus()))};function M(d){d!==""&&(i(d),h(!1))}const y=()=>{m(""),i(void 0),h(!1)},P=()=>{g||h(!1)};return A("ctrl+f, F3",()=>{h(!0)},{preventDefault:!0}),O?v.jsx(G,{autoFocus:!0,variant:"standard",value:g,onCancel:y,onChange:d=>m(d.target.value),onKeyDown:d=>{d.key==="Enter"&&M(g)},onBlur:P,inputRef:l,sx:{...r.applyStyles("light",{"& .MuiInput-underline:before":{borderBottomColor:"primary.contrastText"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.contrastText"},"& .MuiInput-underline:after":{borderBottomColor:"primary.dark"}})},cancelButtonProps:{sx:{...r.applyStyles("light",{color:"primary.contrastText"})}}}):v.jsx(B,{title:n("search.title.search"),children:v.jsx(z,{onClick:()=>h(!0),color:"inherit",children:v.jsx(he,{})})})};export{ve as A,ye as N,N as S,he as a,me as u};
