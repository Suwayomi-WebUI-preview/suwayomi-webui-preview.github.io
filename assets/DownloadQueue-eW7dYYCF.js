import{c as _,j as e,f as c,u as H,B as v,C as Q,a as V,L as B,A as O,b as N,I as h,d as F,T as P,H as K,J as G,i as j,R as J,K as W,r as s,N as $,O as g,n as b,l as m,m as z,k as U,E as R,V as X}from"./index-Dace6NFD.js";import{D as Y,a as Z,S as ee,P as te}from"./StrictModeDroppable-kRHgp6uY.js";import{P as ae}from"./PlayArrow-DHb0v4Y2.js";const re=_(e.jsx("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause"),oe=_(e.jsx("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3zM14 5h-3l-1-1H6L5 5H2v2h12z"}),"DeleteSweep"),se=({children:r,...o})=>e.jsx(v,{...o,style:{height:o["data-known-size"]||void 0},children:r}),k=c.memo(({provided:r,item:o,handleDelete:w,handleRetry:u})=>{const{t:x}=H();return e.jsx(v,{...r.draggableProps,...r.dragHandleProps,ref:r.innerRef,sx:{p:1,pb:0},children:e.jsx(Q,{children:e.jsx(V,{component:B,to:O.manga.path(o.manga.id),children:e.jsxs(N,{sx:{display:"flex",alignItems:"center",p:1.5},children:[e.jsx(h,{sx:{pointerEvents:"none"},children:e.jsx(Y,{})}),e.jsxs(F,{sx:{flex:1,ml:1},direction:"column",children:[e.jsx(P,{variant:"h6",component:"h3",children:o.manga.title}),e.jsx(P,{variant:"caption",sx:{display:"block"},children:o.chapter.name})]}),e.jsx(K,{chapterId:o.chapter.id}),o.state===G.Error&&e.jsx(j,{title:x("global.button.retry"),children:e.jsx(h,{onClick:n=>{n.preventDefault(),n.stopPropagation(),u(o.chapter)},size:"large",children:e.jsx(J,{})})}),e.jsx(j,{title:x("chapter.action.download.delete.label.action"),children:e.jsx(h,{onClick:n=>{n.preventDefault(),n.stopPropagation(),w(o.chapter)},size:"large",children:e.jsx(W,{})})})]})})})})}),de=()=>{var S,E;const{t:r}=H(),[o,{reset:w}]=s.useReorderChapterInDownloadQueue(),{data:u,loading:x,error:n,refetch:q}=s.useGetDownloadStatus({notifyOnNetworkStatusChange:!0}),d=u==null?void 0:u.downloadStatus,i=(S=d==null?void 0:d.queue)!=null?S:[],p=(E=d==null?void 0:d.state)!=null?E:"STARTED",f=!i.length,{setTitle:D,setAction:C}=c.useContext($),T=async()=>{try{await s.clearDownloads().response}catch(t){b(r("download.queue.error.label.failed_delete_all"),"error",m(t))}},A=()=>{p===g.Stopped?s.startDownloads():s.stopDownloads()};c.useLayoutEffect(()=>(D(r("download.queue.title")),C(e.jsxs(e.Fragment,{children:[e.jsx(j,{title:r("download.queue.label.delete_all"),children:e.jsx(h,{onClick:T,size:"large",color:"inherit",children:e.jsx(oe,{})})}),e.jsx(j,{title:r(p===g.Started?"global.button.start":"global.button.stop"),children:e.jsx(h,{onClick:A,size:"large",disabled:f,color:"inherit",children:p===g.Stopped?e.jsx(ae,{}):e.jsx(re,{})})})]})),()=>{D(""),C(null)}),[r,p,f]),c.useEffect(()=>{const t=a=>{(a.message==="ResizeObserver loop completed with undelivered notifications."||a.message==="ResizeObserver loop limit exceeded")&&a.stopImmediatePropagation()};return window.addEventListener("error",t),()=>window.removeEventListener("error",t)},[]);const L=(t,a,l)=>{a!==l&&o({variables:{input:{chapterId:t[a].chapter.id,to:l}}}).catch(()=>{w()})},M=t=>{t.destination&&L(i,t.source.index,t.destination.index)},y=c.useCallback(async t=>{try{await s.addChapterToDownloadQueue(t.id).response}catch(a){b(r("download.queue.error.label.failed_to_remove"),"error",m(a))}},[]),I=c.useCallback(async t=>{const a=p===g.Started;try{a&&await s.stopDownloads().response,await Promise.all([s.removeChapterFromDownloadQueue(t.id).response,s.deleteDownloadedChapter(t.id).response])}catch(l){b(r("download.queue.error.label.failed_to_remove"),"error",m(l))}a&&s.startDownloads().response.catch(z())},[]);return x?e.jsx(U,{}):n?e.jsx(R,{message:r("global.error.label.failed_to_load_data"),messageExtra:m(n),retry:()=>q().catch(z())}):f?e.jsx(R,{message:r("download.queue.label.no_downloads")}):e.jsx(Z,{onDragEnd:M,children:e.jsx(ee,{droppableId:"droppable",mode:"virtual",renderClone:(t,a,l)=>e.jsx(k,{provided:t,item:i[l.source.index],handleDelete:I,handleRetry:y}),children:t=>e.jsx(v,{ref:t.innerRef,children:e.jsx(X,{useWindowScroll:!0,overscan:window.innerHeight*.5,components:{Item:se},totalCount:i.length,computeItemKey:a=>i[a].chapter.id,itemContent:a=>e.jsx(te,{draggableId:"".concat(i[a].chapter.id),index:a,children:l=>e.jsx(k,{provided:l,item:i[a],handleDelete:I,handleRetry:y})})})})})})};export{de as DownloadQueue};
