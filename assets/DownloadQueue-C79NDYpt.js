import{r as k,i as H,j as e,u as T,c as n,f as m,N,k as g,I as u,H as x,l as F,E as I,m as P,B as w,V as K,C as G,a as J,L as W,A as U,b as X,d as Y,T as z,J as Z,K as ee,O as te,P as ae,n as v}from"./index-DHLtiJ0j.js";import{D as re,S as oe,P as se,d as ne}from"./StrictModeDroppable-B9R3QdxO.js";import{d as le}from"./PlayArrow-Ddm6shGJ.js";var b={},de=H;Object.defineProperty(b,"__esModule",{value:!0});var $=b.default=void 0,ie=de(k()),ce=e;$=b.default=(0,ie.default)((0,ce.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause");var _={},ue=H;Object.defineProperty(_,"__esModule",{value:!0});var L=_.default=void 0,pe=ue(k()),he=e;L=_.default=(0,pe.default)((0,he.jsx)("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3zM14 5h-3l-1-1H6L5 5H2v2h12z"}),"DeleteSweep");const xe=({children:a,...o})=>e.jsx(w,{...o,style:{height:o["data-known-size"]||void 0},children:a}),q=({provided:a,item:o,handleDelete:f,handleRetry:i})=>{const{t:p}=T();return e.jsx(w,{...a.draggableProps,...a.dragHandleProps,ref:a.innerRef,sx:{p:1,pb:0},children:e.jsx(G,{children:e.jsx(J,{component:W,to:U.manga.path(o.manga.id),children:e.jsxs(X,{sx:{display:"flex",alignItems:"center",p:1.5},children:[e.jsx(u,{sx:{pointerEvents:"none"},children:e.jsx(ne,{})}),e.jsxs(Y,{sx:{flex:1,ml:1},direction:"column",children:[e.jsx(z,{variant:"h6",component:"h3",children:o.manga.title}),e.jsx(z,{variant:"caption",sx:{display:"block"},children:o.chapter.name})]}),e.jsx(Z,{download:o}),o.state===ee.Error&&e.jsx(g,{title:p("global.button.retry"),children:e.jsx(u,{onClick:l=>{l.preventDefault(),l.stopPropagation(),i(o.chapter)},size:"large",children:e.jsx(te,{})})}),e.jsx(g,{title:p("chapter.action.download.delete.label.action"),children:e.jsx(u,{onClick:l=>{l.preventDefault(),l.stopPropagation(),f(o.chapter)},size:"large",children:e.jsx(ae,{})})})]})})})})},me=()=>{var E,R;const{t:a}=T(),[o,{reset:f}]=n.useReorderChapterInDownloadQueue(),{data:i,loading:p,error:l,refetch:M}=n.useGetDownloadStatus({notifyOnNetworkStatusChange:!0}),d=i==null?void 0:i.downloadStatus,h=(E=d==null?void 0:d.queue)!=null?E:[],c=(R=d==null?void 0:d.state)!=null?R:"STARTED",j=!h.length,{setTitle:D,setAction:y}=m.useContext(N),A=async()=>{try{await n.clearDownloads().response}catch(t){v(a("download.queue.error.label.failed_delete_all"),"error")}},Q=()=>{c===x.Stopped?n.startDownloads():n.stopDownloads()};m.useLayoutEffect(()=>(D(a("download.queue.title")),y(e.jsxs(e.Fragment,{children:[e.jsx(g,{title:a("download.queue.label.delete_all"),children:e.jsx(u,{onClick:A,size:"large",color:"inherit",children:e.jsx(L,{})})}),e.jsx(g,{title:a(c===x.Started?"global.button.start":"global.button.stop"),children:e.jsx(u,{onClick:Q,size:"large",disabled:j,color:"inherit",children:c===x.Stopped?e.jsx(le,{}):e.jsx($,{})})})]})),()=>{D(""),y(null)}),[a,c,j]),m.useEffect(()=>{const t=r=>{(r.message==="ResizeObserver loop completed with undelivered notifications."||r.message==="ResizeObserver loop limit exceeded")&&r.stopImmediatePropagation()};return window.addEventListener("error",t),()=>window.removeEventListener("error",t)},[]);const O=(t,r,s)=>{r!==s&&o({variables:{input:{chapterId:t[r].chapter.id,to:s}}}).catch(()=>{f()})},V=t=>{t.destination&&O(h,t.source.index,t.destination.index)},C=async t=>{try{await n.addChapterToDownloadQueue(t.id).response}catch(r){v(a("download.queue.error.label.failed_to_remove"),"error")}},S=async t=>{const r=c===x.Started;try{r&&await n.stopDownloads().response,await Promise.all([n.removeChapterFromDownloadQueue(t.id).response,n.deleteDownloadedChapter(t.id).response])}catch(s){v(a("download.queue.error.label.failed_to_retry"),"error")}r&&n.startDownloads().response.catch(P())};return p?e.jsx(F,{}):l?e.jsx(I,{message:a("global.error.label.failed_to_load_data"),messageExtra:l.message,retry:()=>M().catch(P())}):j?e.jsx(I,{message:a("download.queue.label.no_downloads")}):e.jsx(re,{onDragEnd:V,children:e.jsx(oe,{droppableId:"droppable",mode:"virtual",renderClone:(t,r,s)=>e.jsx(q,{provided:t,item:h[s.source.index],handleDelete:S,handleRetry:C}),children:t=>e.jsx(w,{ref:t.innerRef,children:e.jsx(K,{useWindowScroll:!0,overscan:window.innerHeight*.5,data:h,components:{Item:xe},computeItemKey:(r,s)=>s.chapter.id,itemContent:(r,s)=>e.jsx(se,{draggableId:"".concat(s.chapter.id),index:r,children:B=>e.jsx(q,{provided:B,item:s,handleDelete:S,handleRetry:C})})})})})})};export{me as DownloadQueue};
