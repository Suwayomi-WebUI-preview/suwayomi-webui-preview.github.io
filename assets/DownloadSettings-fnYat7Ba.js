import{u as E,j as e,M as u,s as i,v as r,by as p,$ as R,m as D,g as _,r as j,b7 as M,e as U,i as V,k as C,b5 as I,aN as P,A as O,F as W}from"./index-D8Oh_qVq.js";import{N as A}from"./NumberSetting-y3kz1zEK.js";import{u as z,g as G}from"./usePersistedValue-CrK2gx8B.js";import{S as h}from"./Switch-DoyrbDvL.js";import{S as H}from"./SelectSetting-ZmBgvVuL.js";import{a as q}from"./CategoriesInclusionSetting-C97xW3HF.js";import{E as B}from"./EmptyViewAbsoluteCentered-31nAN-mp.js";import{u as F}from"./useAppTitle-LfOXXKjx.js";import{L as f}from"./ListSubheader-DQMHcHM8.js";import"./Slider-Dlmh94m5.js";import"./SwitchBase-Bp_PtR-Q.js";import"./Select-CeEAyCPy.js";import"./ThreeStateCheckboxInput-Dbiv8Xcy.js";import"./Checkbox-Dx_Xcwmq.js";const K=({downloadAheadLimit:t})=>{const{t:s}=E(),d=!!t,[l,c]=z("lastDownloadAheadLimit",p.default,t,G),w=n=>{c(n===0?l:n),R("downloadAheadLimit",n).catch(b=>D(s("global.error.label.failed_to_save_changes"),"error",_(b)))},m=n=>{w(n?l:0)};return e.jsxs(u,{children:[e.jsxs(i,{children:[e.jsx(r,{primary:s("download.settings.download_ahead.label.while_reading")}),e.jsx(h,{edge:"end",checked:d,onChange:n=>m(n.target.checked)})]}),e.jsx(A,{settingTitle:s("download.settings.download_ahead.label.unread_chapters_to_download"),settingValue:s("download.settings.download_ahead.label.value",{chapters:l,count:l}),value:l,minValue:p.min,maxValue:p.max,defaultValue:p.default,stepSize:p.step,showSlider:!0,dialogDescription:s("download.settings.download_ahead.label.description"),dialogDisclaimer:s("download.settings.download_ahead.label.disclaimer"),valueUnit:s("chapter.title_one"),handleUpdate:w,disabled:!d})]})},Y=[0,1,2,3,4,5],$={0:{text:"global.label.disabled"},1:{text:"download.settings.delete_chapters.while_reading.option.label.first"},2:{text:"download.settings.delete_chapters.while_reading.option.label.second"},3:{text:"download.settings.delete_chapters.while_reading.option.label.third"},4:{text:"download.settings.delete_chapters.while_reading.option.label.fourth"},5:{text:"download.settings.delete_chapters.while_reading.option.label.fifth"}},J=Y.map(t=>[t,$[t]]),Q=t=>typeof t=="boolean"?Number(t):t,X=({chapterToDelete:t,handleChange:s})=>{const{t:d}=E(),l=Q(t);return e.jsx(H,{settingName:d("download.settings.delete_chapters.while_reading.label.title"),value:l,values:J,handleChange:s})},pe=()=>{var v,k,L;const{t}=E();F(t("download.title.download"));const s=j.useGetCategories(M),d=j.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[l]=j.useUpdateServerSettings(),{settings:c,loading:w,request:{error:m,refetch:n}}=U();if(d.loading||w||s.loading)return e.jsx(V,{});const S=(k=(v=d.error)!=null?v:m)!=null?k:s.error;if(S)return e.jsx(B,{message:t("global.error.label.failed_to_load_data"),messageExtra:_(S),retry:()=>{d.error&&d.refetch().catch(C()),m&&n().catch(C()),s.error&&s.refetch().catch(C())}});const a=d.data.settings,g=(o,N)=>{const T=l({variables:{input:{settings:{[o]:N}}}});return T.catch(y=>D(t("global.error.label.failed_to_save_changes"),"error",_(y))),T},x=W(o=>D(t("global.error.label.failed_to_save_changes"),"error",_(o)));return e.jsxs(u,{sx:{pt:0},children:[e.jsx(I,{settingName:t("download.settings.download_path.label.title"),dialogDescription:t("download.settings.download_path.label.description"),value:a==null?void 0:a.downloadsPath,settingDescription:a!=null&&a.downloadsPath.length?a.downloadsPath:t("global.label.default"),handleChange:o=>g("downloadsPath",o)}),e.jsxs(i,{children:[e.jsx(r,{primary:t("download.settings.file_type.label.cbz")}),e.jsx(h,{edge:"end",checked:!!(a!=null&&a.downloadAsCbz),onChange:o=>g("downloadAsCbz",o.target.checked)})]}),e.jsx(P,{to:O.settings.childRoutes.images.childRoutes.processingDownloads.path,children:e.jsx(r,{primary:t("download.settings.conversion.title")})}),e.jsxs(u,{subheader:e.jsx(f,{component:"div",id:"download-settings-auto-delete-downloads",children:t("download.settings.delete_chapters.title")}),children:[e.jsxs(i,{children:[e.jsx(r,{primary:t("download.settings.delete_chapters.label.manually_marked_as_read")}),e.jsx(h,{edge:"end",checked:c.deleteChaptersManuallyMarkedRead,onChange:o=>x("deleteChaptersManuallyMarkedRead",o.target.checked)})]}),e.jsx(X,{chapterToDelete:c.deleteChaptersWhileReading,handleChange:o=>x("deleteChaptersWhileReading",o)}),e.jsxs(i,{children:[e.jsx(r,{primary:t("download.settings.delete_chapters.label.allow_deletion_of_bookmarked")}),e.jsx(h,{edge:"end",checked:c.deleteChaptersWithBookmark,onChange:o=>x("deleteChaptersWithBookmark",o.target.checked)})]})]}),e.jsxs(u,{subheader:e.jsx(f,{component:"div",id:"download-settings-auto-download",children:t("download.settings.auto_download.title")}),children:[e.jsxs(i,{children:[e.jsx(r,{primary:t("download.settings.auto_download.label.new_chapters")}),e.jsx(h,{edge:"end",checked:!!(a!=null&&a.autoDownloadNewChapters),onChange:o=>g("autoDownloadNewChapters",o.target.checked)})]}),e.jsx(A,{disabled:!(a!=null&&a.autoDownloadNewChapters),settingTitle:t("download.settings.auto_download.download_limit.label.title"),dialogDescription:t("download.settings.auto_download.download_limit.label.description"),value:(L=a==null?void 0:a.autoDownloadNewChaptersLimit)!=null?L:0,settingValue:a.autoDownloadNewChaptersLimit?t("download.settings.download_ahead.label.value",{chapters:a.autoDownloadNewChaptersLimit,count:a.autoDownloadNewChaptersLimit}):t("global.label.none"),defaultValue:0,minValue:0,maxValue:20,showSlider:!0,valueUnit:t("chapter.title_one"),handleUpdate:o=>g("autoDownloadNewChaptersLimit",o)}),e.jsxs(i,{children:[e.jsx(r,{primary:t("download.settings.auto_download.label.ignore_with_unread_chapters")}),e.jsx(h,{edge:"end",checked:!!(a!=null&&a.excludeEntryWithUnreadChapters),onChange:o=>g("excludeEntryWithUnreadChapters",o.target.checked),disabled:!(a!=null&&a.autoDownloadNewChapters)})]}),e.jsxs(i,{children:[e.jsx(r,{primary:t("download.settings.auto_download.label.ignore_re_uploads")}),e.jsx(h,{edge:"end",checked:!!(a!=null&&a.autoDownloadIgnoreReUploads),onChange:o=>g("autoDownloadIgnoreReUploads",o.target.checked),disabled:!(a!=null&&a.autoDownloadNewChapters)})]}),e.jsx(q,{categories:s.data.categories.nodes,includeField:"includeInDownload",dialogText:t("download.settings.auto_download.categories.label.include_in_download")})]}),e.jsx(u,{subheader:e.jsx(f,{component:"div",id:"download-settings-download-ahead",children:t("download.settings.download_ahead.title")}),children:e.jsx(K,{downloadAheadLimit:c.downloadAheadLimit})})]})};export{pe as DownloadSettings};
