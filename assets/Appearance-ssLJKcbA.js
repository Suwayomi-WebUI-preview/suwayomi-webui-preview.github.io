import{c as Re,j as r,u as Q,q as oe,h as k,ar as Ke,aV as $e,aW as Je,l as le,aU as Ie,m as M,n as ce,d as T,T as Qe,bT as qe,aE as ee,ba as ge,d3 as He,bA as Ze,aZ as Ge,e as ae,o as N,s as ue,az as _e,ai as Ye,k as te,cq as Me,as as Ee,ax as Xe,d4 as Ae,d5 as et,d6 as tt,C as nt,B as V,a as rt,I as me,N as st,a9 as at,d7 as it,d8 as ot,d9 as lt,da as ct,f as ut,M as dt,db as D,g as ht,E as gt,w as pe,aX as R,aM as K,b$ as fe,aK as Y,bF as mt,aY as se,dc as be,b8 as je}from"./index-vK5lg1Vd.js";import{N as pt}from"./NumberSetting-BvZB7dUu.js";import{b as ft}from"./Languages-soGtIzlK.js";import{C as bt}from"./CheckCircle-Bn92eDo4.js";import{E as jt}from"./Edit-D8hc1cNs.js";import"./Info-E8AWyAtl.js";const Ct=Re(r.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle");class U extends Error{constructor(t,n){super("".concat(t," at position ").concat(n)),this.position=n}}const De=32,wt=10,Oe=9,We=13,xt=160,yt=8192,St=8202,vt=8239,Tt=8287,kt=12288;function Nt(e){return/^[0-9A-Fa-f]$/.test(e)}function O(e){return e>="0"&&e<="9"}function It(e){return e>=" "}function X(e){return",:[]/{}()\n+".includes(e)}function Ce(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_"||e==="$"}function we(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_"||e==="$"||e>="0"&&e<="9"}const xe=/^(http|https|ftp|mailto|file|data|irc):\/\/$/,ye=/^[A-Za-z0-9-._~:/?#@!$&'()*+;=]$/;function Se(e){return",[]/{}\n+".includes(e)}function ve(e){return ne(e)||_t.test(e)}const _t=/^[[{\w-]$/;function Mt(e){return e==="\n"||e==="\r"||e==="	"||e==="\b"||e==="\f"}function W(e,t){const n=e.charCodeAt(t);return n===De||n===wt||n===Oe||n===We}function Et(e,t){const n=e.charCodeAt(t);return n===De||n===Oe||n===We}function At(e,t){const n=e.charCodeAt(t);return n===xt||n>=yt&&n<=St||n===vt||n===Tt||n===kt}function ne(e){return Le(e)||ie(e)}function Le(e){return e==='"'||e==="“"||e==="”"}function Te(e){return e==='"'}function ie(e){return e==="'"||e==="‘"||e==="’"||e==="`"||e==="´"}function ke(e){return e==="'"}function $(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const l=e.lastIndexOf(t);return l!==-1?e.substring(0,l)+(n?"":e.substring(l+1)):e}function v(e,t){let n=e.length;if(!W(e,n-1))return e+t;for(;W(e,n-1);)n--;return e.substring(0,n)+t+e.substring(n)}function Dt(e,t,n){return e.substring(0,t)+e.substring(t+n)}function Ot(e){return/[,\n][ \t\r]*$/.test(e)}const Wt={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},Lt={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"};function Bt(e){let t=0,n="";h(),b()||Fe(),h();const C=m(",");for(C&&i(),ve(e[t])&&Ot(n)?(C||(n=v(n,",")),B()):C&&(n=$(n,","));e[t]==="}"||e[t]==="]";)t++,i();if(t>=e.length)return n;Ve();function b(){i();const s=F()||L()||S()||j()||c()||I(!1)||q();return i(),s}function i(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const a=t;let o=d(s);do o=w(),o&&(o=d(s));while(o);return t>a}function d(s){const a=s?W:Et;let o="";for(;;)if(a(e,t))o+=e[t],t++;else if(At(e,t))o+=" ",t++;else break;return o.length>0?(n+=o,!0):!1}function w(){if(e[t]==="/"&&e[t+1]==="*"){for(;t<e.length&&!Ut(e,t);)t++;return t+=2,!0}if(e[t]==="/"&&e[t+1]==="/"){for(;t<e.length&&e[t]!=="\n";)t++;return!0}return!1}function h(){if(e.slice(t,t+3)==="```"){if(t+=3,Ce(e[t]))for(;t<e.length&&we(e[t]);)t++;return i(),!0}return!1}function m(s){return e[t]===s?(n+=e[t],t++,!0):!1}function p(s){return e[t]===s?(t++,!0):!1}function x(){return p("\\")}function y(){return i(),e[t]==="."&&e[t+1]==="."&&e[t+2]==="."?(t+=3,i(),p(","),!0):!1}function F(){if(e[t]==="{"){n+="{",t++,i(),p(",")&&i();let s=!0;for(;t<e.length&&e[t]!=="}";){let a;if(s?(a=!0,s=!1):(a=m(","),a||(n=v(n,",")),i()),y(),!(S()||I(!0))){e[t]==="}"||e[t]==="{"||e[t]==="]"||e[t]==="["||e[t]===void 0?n=$(n,","):ze();break}i();const G=m(":"),A=t>=e.length;G||(ve(e[t])||A?n=v(n,":"):de()),b()||(G||A?n+="null":de())}return e[t]==="}"?(n+="}",t++):n=v(n,"}"),!0}return!1}function L(){if(e[t]==="["){n+="[",t++,i(),p(",")&&i();let s=!0;for(;t<e.length&&e[t]!=="]";)if(s?s=!1:m(",")||(n=v(n,",")),y(),!b()){n=$(n,",");break}return e[t]==="]"?(n+="]",t++):n=v(n,"]"),!0}return!1}function B(){let s=!0,a=!0;for(;a;)s?s=!1:m(",")||(n=v(n,",")),a=b();a||(n=$(n,",")),n="[\n".concat(n,"\n]")}function S(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,o=e[t]==="\\";if(o&&(t++,o=!0),ne(e[t])){const G=Te(e[t])?Te:ke(e[t])?ke:ie(e[t])?ie:Le,A=t,P=n.length;let u='"';for(t++;;){if(t>=e.length){const f=H(t-1);return!s&&X(e.charAt(f))?(t=A,n=n.substring(0,P),S(!0)):(u=v(u,'"'),n+=u,!0)}else{if(t===a)return u=v(u,'"'),n+=u,!0;if(G(e[t])){const f=t,re=u.length;if(u+='"',t++,n+=u,i(!1),s||t>=e.length||X(e[t])||ne(e[t])||O(e[t]))return E(),!0;const _=H(f-1),he=e.charAt(_);if(he===",")return t=A,n=n.substring(0,P),S(!1,_);if(X(he))return t=A,n=n.substring(0,P),S(!0);n=n.substring(0,P),t=f+1,u="".concat(u.substring(0,re),"\\").concat(u.substring(re))}else if(s&&Se(e[t])){if(e[t-1]===":"&&xe.test(e.substring(A+1,t+2)))for(;t<e.length&&ye.test(e[t]);)u+=e[t],t++;return u=v(u,'"'),n+=u,E(),!0}else if(e[t]==="\\"){const f=e.charAt(t+1);if(Lt[f]!==void 0)u+=e.slice(t,t+2),t+=2;else if(f==="u"){let _=2;for(;_<6&&Nt(e[t+_]);)_++;_===6?(u+=e.slice(t,t+6),t+=6):t+_>=e.length?t=e.length:Pe()}else u+=f,t+=2}else{const f=e.charAt(t);f==='"'&&e[t-1]!=="\\"?(u+="\\".concat(f),t++):Mt(f)?(u+=Wt[f],t++):(It(f)||Ue(f),u+=f,t++)}}o&&x()}}return!1}function E(){let s=!1;for(i();e[t]==="+";){s=!0,t++,i(),n=$(n,'"',!0);const a=n.length;S()?n=Dt(n,a,1):n=v(n,'"')}return s}function j(){const s=t;if(e[t]==="-"){if(t++,z())return Z(s),!0;if(!O(e[t]))return t=s,!1}for(;O(e[t]);)t++;if(e[t]==="."){if(t++,z())return Z(s),!0;if(!O(e[t]))return t=s,!1;for(;O(e[t]);)t++}if(e[t]==="e"||e[t]==="E"){if(t++,(e[t]==="-"||e[t]==="+")&&t++,z())return Z(s),!0;if(!O(e[t]))return t=s,!1;for(;O(e[t]);)t++}if(!z())return t=s,!1;if(t>s){const a=e.slice(s,t),o=/^0\d/.test(a);return n+=o?'"'.concat(a,'"'):a,!0}return!1}function c(){return g("true","true")||g("false","false")||g("null","null")||g("True","true")||g("False","false")||g("None","null")}function g(s,a){return e.slice(t,t+s.length)===s?(n+=a,t+=s.length,!0):!1}function I(s){const a=t;if(Ce(e[t])){for(;t<e.length&&we(e[t]);)t++;let o=t;for(;W(e,o);)o++;if(e[o]==="(")return t=o+1,b(),e[t]===")"&&(t++,e[t]===";"&&t++),!0}for(;t<e.length&&!Se(e[t])&&!ne(e[t])&&(!s||e[t]!==":");)t++;if(e[t-1]===":"&&xe.test(e.substring(a,t+2)))for(;t<e.length&&ye.test(e[t]);)t++;if(t>a){for(;W(e,t-1)&&t>0;)t--;const o=e.slice(a,t);return n+=o==="undefined"?"null":JSON.stringify(o),e[t]==='"'&&t++,!0}}function q(){if(e[t]==="/"){const s=t;for(t++;t<e.length&&(e[t]!=="/"||e[t-1]==="\\");)t++;return t++,n+='"'.concat(e.substring(s,t),'"'),!0}}function H(s){let a=s;for(;a>0&&W(e,a);)a--;return a}function z(){return t>=e.length||X(e[t])||W(e,t)}function Z(s){n+="".concat(e.slice(s,t),"0")}function Ue(s){throw new U("Invalid character ".concat(JSON.stringify(s)),t)}function Ve(){throw new U("Unexpected character ".concat(JSON.stringify(e[t])),t)}function Fe(){throw new U("Unexpected end of json string",e.length)}function ze(){throw new U("Object key expected",t)}function de(){throw new U("Colon expected",t)}function Pe(){const s=e.slice(t,t+6);throw new U('Invalid unicode character "'.concat(s,'"'),t)}}function Ut(e,t){return e[t]==="*"&&e[t+1]==="/"}const Vt={id:"",isCustom:!0,getName:()=>"",muiTheme:{colorSchemes:{light:{palette:{primary:{main:"#1976d2"},secondary:{main:"#9c27b0"}}},dark:{palette:{primary:{main:"#1976d2"},secondary:{main:"#9c27b0"}}}}}},J={create:{title:"settings.appearance.theme.create.title",button:"global.button.ok",action:"settings.appearance.theme.create.action",success:"settings.appearance.theme.create.success",failure:"settings.appearance.theme.create.failure"},edit:{title:"settings.appearance.theme.edit.title",button:"global.button.save",action:"settings.appearance.theme.edit.action",success:"settings.appearance.theme.edit.success",failure:"settings.appearance.theme.edit.failure"}},Be=({bindDialogProps:e,mode:t,appTheme:n=Vt})=>{const{t:l}=Q(),{settings:{customThemes:C},request:{loading:b,error:i,refetch:d}}=oe(),w=ue(j=>{throw j}),[h,m]=k.useState(n),[p,x]=k.useState(!1),[y,F]=k.useState(!1),[L,B]=k.useState(!1),[S,E]=k.useState(t==="create");return r.jsxs(Ke,{...e,fullWidth:!0,maxWidth:"md",children:[r.jsx($e,{children:l(J[t].title)}),r.jsxs(Je,{children:[b&&r.jsx(le,{}),i&&r.jsx(Ie,{message:l("global.error.label.failed_to_load_data"),messageExtra:M(i),retry:()=>d().catch(ce())}),!i&&r.jsxs(T,{sx:{gap:2,whiteSpace:"pre-line"},children:[r.jsx(Qe,{children:r.jsxs(qe,{i18nKey:"settings.appearance.theme.create.dialog.description",children:[r.jsx(ee,{href:"https://mui.com/material-ui/customization/how-to-customize/",target:"_blank",rel:"noreferrer",children:"MUI documentation"}),r.jsx(ee,{href:"https://mui.com/material-ui/customization/palette/#color-schemes",target:"_blank",rel:"noreferrer",children:"MUI documentation"}),r.jsx(ee,{href:"https://zenoo.github.io/mui-theme-creator/",target:"_blank",rel:"noreferrer",children:"MUI Theme Creator"})," ",', copy everything after "themeOptions" from "',"{",'" to "',"}",'" and paste it into the "theme" text field.']})}),r.jsx(ge,{disabled:t==="edit",label:l("settings.appearance.theme.create.dialog.theme_name"),value:h.getName(),error:p,helperText:p&&l("settings.appearance.theme.create.dialog.error.invalid_name"),onChange:j=>{const c=j.target.value.trim(),g=c.length<=16,I=He(c,C);x(!g||!I),m({...h,id:j.target.value,getName:()=>j.target.value})}}),r.jsx(ge,{label:l("settings.appearance.theme.title"),multiline:!0,error:y,helperText:y&&l("settings.appearance.theme.create.dialog.error.invalid_json"),defaultValue:JSON.stringify(h.muiTheme,null,2),onChange:j=>{const c="invalid",g=(()=>{try{return Bt(j.target.value)}catch(Z){return c}})(),I=Ze(g),q=g===c||!I,H=JSON.stringify(I)!==JSON.stringify(n.muiTheme);E(t==="create"?!0:H),F(q),!q&&JSON.stringify(I)!==JSON.stringify(h.muiTheme)&&m({...h,muiTheme:I})}})]})]}),r.jsxs(Ge,{children:[r.jsx(ae,{autoFocus:!0,onClick:e.onClose,color:"primary",children:l("global.button.cancel")}),r.jsx(ae,{disabled:y||p||L||!S||!h.id.length,onClick:j=>{N(l(J[t].action,{theme:h.getName()}),"info"),B(!0),w("customThemes",{...C,[h.id]:h}).then(()=>{N(l(J[t].success,{theme:h.getName()}),"success"),e.onClose(j)}).catch(c=>N(l(J[t].failure,{theme:h.getName()}),"error",M(c))).finally(()=>B(!1))},color:"primary",children:l(J[t].button)})]})]})},Ft=()=>{const{t:e}=Q(),t=_e({variant:"popover",popupId:"theme-creation-dialog"});return r.jsxs(r.Fragment,{children:[r.jsxs(T,{sx:{alignItems:"center",gap:1,minWidth:"150px",maxWidth:"150px"},children:[r.jsx(ae,{sx:{width:"100%",height:"225px"},variant:"contained",size:"large",...Ye(t),children:r.jsx(Ct,{fontSize:"large"})}),r.jsx(te,{title:e("settings.appearance.theme.create.title"),placement:"top",children:r.jsx(Me,{sx:{maxWidth:"100%"},children:e("settings.appearance.theme.create.title")})})]}),t.isOpen&&r.jsx(Be,{bindDialogProps:Ee(t),mode:"create"})]})},Ne=at(V)(()=>({width:"15px",height:"20px"})),zt=({appTheme:e,onDelete:t})=>{const{getName:n}=e,{t:l}=Q(),C=Xe(),{themeMode:b,setAppTheme:i,appTheme:d,pureBlackMode:w}=k.useContext(Ae),h=_e({variant:"popover",popupId:"theme-edit-dialog-".concat(e.id)}),m=e.id===d,p=k.useMemo(()=>et(b,e,w),[e,b,w]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{sx:{justifyContent:"center",alignItems:"center",minWidth:"150px",maxWidth:"150px",gap:1},children:[r.jsx(tt,{theme:p,children:r.jsxs(nt,{sx:{width:"100%",height:"225px",position:"relative"},children:[r.jsx(V,{sx:{position:"absolute",top:0,right:0,bottom:0,left:0,border:"4px solid",borderColor:m?p.palette.primary.light:p.palette.grey[100],zIndex:1,pointerEvents:"none",borderRadius:1,...C.applyStyles("dark",{borderColor:m?p.palette.primary.light:p.palette.grey[900]})}}),r.jsx(rt,{sx:{height:"100%",backgroundColor:"background.default"},onClick:()=>{if(!it(e.muiTheme)){i(e.id);return}N(l("settings.appearance.theme.select.fonts.loading"),"info"),ot(e.muiTheme).then(()=>i(e.id)).catch(y=>N(l("settings.appearance.theme.select.fonts.error"),"error",M(y)))},children:r.jsxs(T,{sx:{height:"100%",m:0},children:[r.jsxs(T,{sx:{height:"100%",gap:2,p:2},children:[r.jsxs(T,{sx:{maxHeight:"20px",flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start"},children:[r.jsx(V,{sx:{width:"65%",height:"20px",backgroundColor:"primary.dark",borderRadius:1}}),r.jsxs(T,{sx:{alignItems:"center",gap:1,mt:-.25},children:[m&&r.jsx(bt,{sx:{visibility:m?"visible":"hidden",color:"primary.light"}}),!m&&e.isCustom&&r.jsx(me,{onClick:x=>{x.preventDefault(),x.stopPropagation(),t()},component:"div",size:"small",sx:{mt:-.5},children:r.jsx(te,{title:l("global.button.delete"),children:r.jsx(st,{})})}),e.isCustom&&r.jsx(me,{onClick:x=>{x.preventDefault(),x.stopPropagation(),h.open()},component:"div",size:"small",children:r.jsx(te,{title:l("global.button.edit"),children:r.jsx(jt,{})})})]})]}),r.jsx(V,{sx:{width:"55%",height:"65%",backgroundColor:"background.paper",p:1,borderRadius:1},children:r.jsxs(T,{sx:{width:"max-content",flexDirection:"row",overflow:"hidden",borderRadius:1},children:[r.jsx(Ne,{sx:{backgroundColor:"primary.main"}}),r.jsx(Ne,{sx:{backgroundColor:"secondary.main"}})]})})]}),r.jsxs(T,{sx:{height:"25%",backgroundColor:"background.paper",alignItems:"center",flexDirection:"row",gap:2,p:2},children:[r.jsx(V,{sx:{width:"20px",height:"20px",borderRadius:"50%",backgroundColor:"primary.main"}}),r.jsx(V,{sx:{flexGrow:1,height:"20px",borderRadius:1,backgroundColor:"primary.light"}})]})]})})]})}),r.jsx(te,{title:n(),placement:"top",children:r.jsx(Me,{sx:{maxWidth:"100%"},children:n()})})]}),r.jsx(Be,{bindDialogProps:Ee(h),mode:"edit",appTheme:e})]})},Pt=()=>{const{t:e}=Q(),{settings:{customThemes:t},request:{loading:n,error:l,refetch:C}}=oe(),b=k.useMemo(()=>[...lt,...Object.values(t).map(d=>({...d,getName:()=>d.id}))],[t]),i=ue(d=>{throw d});return n?r.jsx(le,{}):l?r.jsx(Ie,{message:e("global.error.label.failed_to_load_data"),messageExtra:M(l),retry:()=>C().catch(ce())}):r.jsxs(T,{sx:{flexDirection:"row",flexWrap:"no-wrap",alignItems:"start",overflowX:"auto",gap:1,mx:2},children:[r.jsx(Ft,{}),b.map(d=>r.jsx(zt,{appTheme:d,onDelete:()=>{N(e("settings.appearance.theme.delete.action",{theme:d.getName()}),"info"),i("customThemes",Object.fromEntries(Object.entries(t).filter(([w])=>w!==d.id))).then(()=>N(e("settings.appearance.theme.delete.success",{theme:d.getName()}),"success")).catch(w=>N(e("settings.appearance.theme.delete.failure",{theme:d.getName()}),"error",M(w)))}},d.id))]})},Ht=()=>{const{t:e,i18n:t}=Q(),{themeMode:n,setThemeMode:l,pureBlackMode:C,setPureBlackMode:b}=k.useContext(Ae),{mode:i,setMode:d}=ct(),w=i!=null?i:n,{setTitle:h,setAction:m}=ut();k.useLayoutEffect(()=>(h(e("settings.appearance.title")),m(null),()=>{h(""),m(null)}),[e]);const{settings:p,request:{loading:x,error:y,refetch:F}}=oe(),L=ue(c=>N(e("global.error.label.failed_to_save_changes"),"error",M(c))),B=dt.getThemeMode()===D.DARK,S=300,[E,j]=ht("ItemWidth",S);return x?r.jsx(le,{}):y?r.jsx(gt,{message:e("global.error.label.failed_to_load_data"),messageExtra:M(y),retry:()=>F().catch(ce())}):r.jsxs(pe,{subheader:r.jsx(je,{component:"div",id:"appearance-theme",children:e("settings.appearance.theme.title")}),children:[r.jsxs(R,{children:[r.jsx(K,{primary:e("settings.appearance.theme.mode")}),r.jsxs(fe,{value:w,onChange:c=>{const g=c.target.value;l(g),d(g),mt.local.setItem("mui-mode",g,!0,!1)},children:[r.jsx(Y,{value:D.SYSTEM,children:e("global.label.system")},D.SYSTEM),r.jsx(Y,{value:D.DARK,children:e("global.label.dark")},D.DARK),r.jsx(Y,{value:D.LIGHT,children:e("global.label.light")},D.LIGHT)]})]}),r.jsx(Pt,{}),B&&r.jsxs(R,{children:[r.jsx(K,{primary:e("settings.appearance.theme.pure_black_mode")}),r.jsx(se,{checked:C,onChange:(c,g)=>b(g)})]}),r.jsxs(pe,{subheader:r.jsx(je,{component:"div",id:"appearance-theme",children:e("global.label.display")}),children:[r.jsxs(R,{children:[r.jsx(K,{primary:e("global.language.label.language"),secondary:r.jsxs(r.Fragment,{children:[r.jsxs("span",{children:[e("settings.label.language_description")," "]}),r.jsx(ee,{href:"https://hosted.weblate.org/projects/suwayomi/suwayomi-webui",target:"_blank",rel:"noreferrer",children:e("global.language.title.weblate")})]})}),r.jsx(fe,{value:be.includes(t.language)?t.language:"en",onChange:({target:{value:c}})=>t.changeLanguage(c,g=>{g&&N(e("global.language.error.load"),"error",M(g))}),children:be.map(c=>r.jsx(Y,{value:c,children:ft(c)},c))})]}),r.jsx(pt,{settingTitle:e("settings.label.manga_item_width"),settingValue:"px: ".concat(E),value:E,defaultValue:S,minValue:100,maxValue:1e3,stepSize:10,valueUnit:"px",showSlider:!0,handleUpdate:j}),r.jsxs(R,{children:[r.jsx(K,{primary:e("settings.appearance.manga_thumbnail_backdrop.title"),secondary:e("settings.appearance.manga_thumbnail_backdrop.description")}),r.jsx(se,{edge:"end",checked:p.mangaThumbnailBackdrop,onChange:c=>L("mangaThumbnailBackdrop",c.target.checked)})]}),r.jsxs(R,{children:[r.jsx(K,{primary:e("settings.appearance.manga_dynamic_color_schemes.title"),secondary:e("settings.appearance.manga_dynamic_color_schemes.description")}),r.jsx(se,{edge:"end",checked:p.mangaDynamicColorSchemes,onChange:c=>L("mangaDynamicColorSchemes",c.target.checked)})]})]})]})};export{Ht as Appearance};
