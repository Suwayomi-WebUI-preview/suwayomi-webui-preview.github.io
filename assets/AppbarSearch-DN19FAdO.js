import{bz as U,f as p,bA as R,r as q,i as F,j as S,as as A,u as z,aI as B,ax as G,k as $,I as W}from"./index-DU51TenU.js";import{S as H}from"./useManageMangaLibraryState-B6a6Yvuk.js";function K(e,t){if(e==null)return e;if(e.length===0&&(!t||t&&e!==""))return null;const r=e instanceof Array?e[0]:e;return r==null?r:!t&&r===""?null:r}function J(e){return e==null?e:String(e)}function X(e){const t=K(e);return t==null?t:t===""?null:+t}function Y(e){return e==null?e:String(e)}function Z(e){const t=K(e,!0);return t==null?t:String(t)}const N={encode:Y,decode:Z},Oe={encode:J,decode:X};function ee(e,t){const r={},n=Object.keys(t);for(const s of n){const a=t[s];e[s]?r[s]=e[s].encode(t[s]):r[s]=a==null?a:String(a)}return r}class te{constructor(){this.paramsMap=new Map,this.registeredParams=new Map}set(t,r,n,s){this.paramsMap.set(t,{stringified:r,decoded:n,decode:s})}has(t,r,n){if(!this.paramsMap.has(t))return!1;const s=this.paramsMap.get(t);return s?s.stringified===r&&(n==null||s.decode===n):!1}get(t){var r;if(this.paramsMap.has(t))return(r=this.paramsMap.get(t))==null?void 0:r.decoded}registerParams(t){for(const r of t){const n=this.registeredParams.get(r)||0;this.registeredParams.set(r,n+1)}}unregisterParams(t){for(const r of t){const n=(this.registeredParams.get(r)||0)-1;n<=0?(this.registeredParams.delete(r),this.paramsMap.has(r)&&this.paramsMap.delete(r)):this.registeredParams.set(r,n)}}clear(){this.paramsMap.clear(),this.registeredParams.clear()}}const b=new te;function re(e,t){var r,n,s;const a={};let c=!1;const o=Object.keys(e);let i=o;if(t.includeKnownParams||t.includeKnownParams!==!1&&o.length===0){const f=Object.keys((r=t.params)!=null?r:{});i.push(...f)}for(const f of i){const u=e[f];if(u!=null&&typeof u=="object"){a[f]=u;continue}c=!0,a[f]=(s=(n=t.params)==null?void 0:n[f])!=null?s:N}return c?a:e}function L(e,t,r,n){var s;if(!r||!t.length)return e;let a={...e},c=!1;for(const o of t)Object.prototype.hasOwnProperty.call(a,o)||(a[o]=(s=r[o])!=null?s:n,c=!0);return c?a:e}const ne=Object.prototype.hasOwnProperty;function _(e,t){return e===t?e!==0||t!==0||1/e===1/t:e!==e&&t!==t}function Q(e,t,r){var n,s;if(_(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const a=Object.keys(e),c=Object.keys(t);if(a.length!==c.length)return!1;for(let o=0;o<a.length;o++){const i=(s=(n=void 0)==null?void 0:n.equals)!=null?s:_;if(!ne.call(t,a[o])||!i(e[a[o]],t[a[o]]))return!1}return!0}function T(e,t,r){const n={},s=Object.keys(t);for(const a of s){const c=t[a],o=e[a];let i;if(r.has(a,o,c.decode))i=r.get(a);else{if(i=c.decode(o),c.equals&&r.has(a,o)){const d=r.get(a);c.equals(i,d)&&(i=d)}i!==void 0&&r.set(a,o,i,c.decode)}i===void 0&&c.default!==void 0&&(i=c.default),n[a]=i}return n}function ae(){let e;function t(r,n,s){const a=T(r,n,s);return e!=null&&Q(e,a)?e:(e=a,a)}return t}function se(e){let t;for(const r in e)if(e[r].urlName){const n=e[r].urlName,s="".concat(n,"\0").concat(r);t?t.push(s):t=[s]}return t?t.join("\n"):void 0}function oe(e){if(e)return Object.fromEntries(e.split("\n").map(t=>t.split("\0")))}function ce(e,t){var r;let n={};for(const s in e)((r=t[s])==null?void 0:r.urlName)!=null?n[t[s].urlName]=e[s]:n[s]=e[s];return n}let C,D,E,j={};const I=(e,t,r)=>{if(C===t&&E===e&&D===r)return j;C=t,E=e;const n=e(t!=null?t:"");D=r;const s=oe(r);for(let[a,c]of Object.entries(n)){s!=null&&s[a]&&(delete n[a],a=s[a],n[a]=c);const o=j[a];Q(c,o)&&(n[a]=o)}return j=n,n};function ie(e,t){var r;for(const n in e)((r=t[n])==null?void 0:r.default)!==void 0&&e[n]!==void 0&&t[n].encode(t[n].default)===e[n]&&(e[n]=void 0)}function ue({changes:e,updateType:t,currentSearchString:r,paramConfigMap:n,options:s}){const{searchStringToObject:a,objectToSearchString:c}=s;t==null&&(t=s.updateType);let o;const i=I(a,r),d=L(n,Object.keys(e),s.params);let f;if(typeof e=="function"){const g=T(i,d,b);f=e(g)}else f=e;o=ee(d,f),s.removeDefaultsFromUrl&&ie(o,d),o=ce(o,d);let u;return t==="push"||t==="replace"?u=c(o):u=c({...i,...o}),u!=null&&u.length&&u[0]!=="?"&&(u="?".concat(u)),u!=null?u:""}function le({searchString:e,adapter:t,navigate:r,updateType:n}){const a={...t.location,search:e};r&&(typeof n=="string"&&n.startsWith("replace")?t.replace(a):t.push(a))}const fe=e=>e(),de=e=>setTimeout(()=>e(),0),P=[];function pe(e,{immediate:t}={}){P.push(e);let r=t?fe:de;P.length===1&&r(()=>{const n=P.slice();P.length=0;const s=n[0].currentSearchString;let a;for(let c=0;c<n.length;++c){const o=c===0?n[c]:{...n[c],currentSearchString:a};a=ue(o)}e.options.skipUpdateWhenNoChange&&a===s||le({searchString:a!=null?a:"",adapter:n[n.length-1].adapter,navigate:!0,updateType:n[n.length-1].updateType})})}function me(e,t){const{adapter:r,options:n}=U(),[s]=p.useState(ae),{paramConfigMap:a,options:c}=ge(e,t),o=p.useMemo(()=>R(n,c),[n,c]);let i=re(a,o);const d=I(o.searchStringToObject,r.location.search,se(i));o.includeAllParams&&(i=L(i,Object.keys(d),o.params,N));const f=s(d,i,b),u=Object.keys(i).join("\0");p.useEffect(()=>{const h=u.split("\0");return b.registerParams(h),()=>{b.unregisterParams(h)}},[u]);const g={adapter:r,paramConfigMap:i,options:o},m=p.useRef(g);m.current==null&&(m.current=g),p.useEffect(()=>{m.current.adapter=r,m.current.paramConfigMap=i,m.current.options=o},[r,i,o]);const[O]=p.useState(()=>(M,v)=>{const{adapter:k,paramConfigMap:y,options:l}=m.current;v==null&&(v=l.updateType),pe({changes:M,updateType:v,currentSearchString:k.location.search,paramConfigMap:y,options:l,adapter:k},{immediate:!l.enableBatching})});return[f,O]}var he=me;function ge(e,t){let r,n;return e===void 0?(r={},n=t):Array.isArray(e)?(r=Object.fromEntries(e.map(s=>[s,"inherit"])),n=t):(r=e,n=t),{paramConfigMap:r,options:n}}const ve=(e,t,r)=>{const n=p.useMemo(()=>({[e]:t!=null?t:"inherit"}),[e,t]),[s,a]=he(n,r),c=s[e],o=p.useCallback((i,d)=>a(typeof i=="function"?f=>{const u=i(f[e]);return{[e]:u}}:{[e]:i},d),[e,a]);return[c,o]};var w={},ye=F;Object.defineProperty(w,"__esModule",{value:!0});var V=w.default=void 0,Se=ye(q()),ke=S;V=w.default=(0,Se.default)((0,ke.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");const Me=e=>{const{isClosable:t=!0}=e,r=A(),{t:n}=z(),[s,a]=p.useState(),c=B(),[o,i]=ve("query",N),[d,f]=p.useState(!t||!!o),u=G.useRef(),[g,m]=p.useState(o!=null?o:"");s!==c.key&&(a(c.key),m(o!=null?o:""),f(!t||!!o));const O=d||!!o,h=l=>{var x;t&&(f(l),l&&((x=u.current)==null||x.focus()))};function M(l){l!==""&&(i(l),h(!1))}const v=()=>{m(""),i(void 0),h(!1)},k=()=>{g||h(!1)},y=l=>{(l.key==="F3"||l.ctrlKey&&l.key==="f")&&(l.preventDefault(),h(!0))};return p.useEffect(()=>(window.addEventListener("keydown",y),()=>{window.removeEventListener("keydown",y)}),[y]),O?S.jsx(H,{autoFocus:!0,variant:"standard",value:g,onCancel:v,onChange:l=>m(l.target.value),onKeyDown:l=>{l.key==="Enter"&&M(g)},onBlur:k,inputRef:u,sx:{...r.applyStyles("light",{"& .MuiInput-underline:before":{borderBottomColor:"primary.contrastText"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.contrastText"},"& .MuiInput-underline:after":{borderBottomColor:"primary.dark"}})},cancelButtonProps:{sx:{...r.applyStyles("light",{color:"primary.contrastText"})}}}):S.jsx($,{title:n("search.title.search"),children:S.jsx(W,{onClick:()=>h(!0),color:"inherit",children:S.jsx(V,{})})})};export{Me as A,Oe as N,N as S,V as d,ve as u};
