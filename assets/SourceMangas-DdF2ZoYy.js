import{w as ot,j as t,R as y,T as Lt,Q as Tt,r as it,i as lt,B as E,aB as ct,V as ut,S as U,c as h,aY as T,ao as Ft,u as H,b as q,s as z,N as It,W as Et,e as $t,ak as rt,X as kt,x as Mt,aZ as P,a_ as _t,a as I,g as Ot,I as Pt,a$ as wt,b0 as At,b1 as Rt}from"./index-ZNnErvSB.js";import{d as Dt,u as Gt,A as Bt,S as Nt}from"./AppbarSearch-ClHZ3vDQ.js";import{d as qt}from"./Favorite-CojAwe2f.js";import{d as pt}from"./FilterList-Dqvqdc9s.js";import{G as Ut}from"./GridLayouts-CvH6Oam_.js";import{S as Ht,O as zt}from"./SortRadioInput-HO-G8Xry.js";import{C as Vt}from"./CheckboxInput-C2tXpRuP.js";import{a as dt,I as mt,M as Kt,b as Yt}from"./TextField-BkmZjha1.js";import{C as gt}from"./Collapse-BC8BBmfY.js";import{u as Qt}from"./useDebounce-DXSAfEbs.js";import{I as Wt}from"./InputAdornment-D9it-gN0.js";import{T as Xt}from"./ThreeStateCheckboxInput-B_xE-UA2.js";import{S as Zt}from"./StyledFab-DXKJX5_n.js";import{M as Jt,g as te}from"./MangaGrid-BdgnIA29.js";import{L as ee}from"./Link-DEL1POSg.js";import"./useManageMangaLibraryState-ZPQgNuMC.js";import"./index-7RbFD7AL.js";import"./CardContent-EE57nb4F.js";import"./Avatar-JougP0-9.js";import"./SpinnerImage-BHRmMd4H.js";import"./ListPreference-CzEYRS4i.js";import"./Checkbox-Bf46Ok7a.js";import"./SwitchBase-66kKQ1ZF.js";import"./NumberSetting-DpJEb6Ln.js";import"./Info-CdODygfp.js";import"./useMobilePicker-Be_4UWWV.js";import"./Chip-p98Qvmkx.js";import"./SelectSetting-BntQCtTG.js";import"./Select-Xg1Y7MZ6.js";import"./Mangas-Dhi4NOss.js";import"./Chapters-LCVkOA02.js";import"./ViewModule-D1iCm5qI.js";import"./Delete-wFHFAXKw.js";import"./Sync-Dyd3O42O.js";import"./PlayArrow-CZDBVSyS.js";function se(){const{options:{SourcegridLayout:e},setOptions:r}=ot();function o(a){r(s=>({...s,SourcegridLayout:a}))}return t.jsx(Ut,{gridLayout:e,onChange:o})}const ae=e=>{const{state:r,name:o,position:a,group:s,updateFilterValue:i,update:n}=e,[l,p]=y.useState(r),c=d=>{p(d.target.checked);const m=n.filter(S=>!(a===S.position&&s===S.group));i([...m,{type:"checkBoxState",position:a,state:d.target.checked,group:s}])};return r!==void 0?t.jsx(Vt,{label:o,checked:l,onChange:c}):null},ne=({name:e})=>t.jsx(Lt,{sx:{mt:2},variant:"subtitle2",children:e},e);function re(e,r,o,a,s,i,n){const[l,p]=y.useState(o);if(e){const c=m=>{const S=e.indexOf("".concat(m.target.value));p(S);const x=i.filter(u=>!(a===u.position&&n===u.group));s([...x,{type:"selectState",position:a,state:S,group:n}])},d=e.map(m=>t.jsx(Tt,{value:m,children:m},"".concat(r," ").concat(m)));return t.jsxs(dt,{sx:{my:1},variant:"standard",children:[t.jsx(mt,{children:r}),t.jsx(Kt,{name:r,value:e[l],label:r,onChange:c,children:d})]})}return null}const oe=({values:e,name:r,state:o,position:a,updateFilterValue:s,update:i,group:n})=>re(e,r,o,a,s,i,n);var V={},ie=lt;Object.defineProperty(V,"__esModule",{value:!0});var K=V.default=void 0,le=ie(it()),ce=t;K=V.default=(0,le.default)((0,ce.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var Y={},ue=lt;Object.defineProperty(Y,"__esModule",{value:!0});var Q=Y.default=void 0,pe=ue(it()),de=t;Q=Y.default=(0,pe.default)((0,de.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");const me=e=>{const{values:r,name:o,state:a,position:s,group:i,updateFilterValue:n,update:l}=e,[p,c]=y.useState(a),[d,m]=y.useState(!1),S=()=>{m(!d)};if(r){const x=u=>{const g=p;g.index===u?g.ascending=!g.ascending:g.ascending=!0,g.index=u,c(g);const v=l.filter(C=>!(s===C.position&&i===C.group));n([...v,{type:"sortState",position:s,state:g,group:i}])};return t.jsxs(E,{sx:{mx:-2},children:[t.jsxs(ct,{onClick:S,children:[t.jsx(ut,{primary:o}),d?t.jsx(K,{}):t.jsx(Q,{})]}),t.jsx(gt,{in:d,children:t.jsx(U,{sx:{mx:4},children:r.map((u,g)=>t.jsx(Ht,{label:u,checked:p.index===g,sortDescending:!p.ascending,onClick:()=>x(g)},"".concat(o," ").concat(u)))})})]})}return null},ge=e=>{const{state:r,name:o,position:a,group:s,updateFilterValue:i,update:n}=e,[l,p]=y.useState(r||""),c=Qt(l,500);return h.useEffect(()=>{const d=n.filter(m=>!(a===m.position&&s===m.group));i([...d,{type:"textState",position:a,state:c,group:s}])},[c]),r!==void 0?t.jsxs(dt,{sx:{my:1},variant:"standard",children:[t.jsx(mt,{children:o}),t.jsx(Yt,{name:o,value:l,onChange:({target:{value:d}})=>p(d),endAdornment:t.jsx(Wt,{position:"end",children:t.jsx(Dt,{})})})]}):null},xe=e=>{switch(e){case T.Ignore:return 0;case T.Include:return 1;case T.Exclude:return 2;default:throw new Error("Unexpected TriState ".concat(e))}},fe=e=>{switch(e){case 0:return T.Ignore;case 1:return T.Include;case 2:return T.Exclude;default:throw new Error("Unexpected state number ".concat(e))}},he=e=>{const{state:r,name:o,position:a,group:s,updateFilterValue:i,update:n}=e,[l,p]=y.useState(xe(r)),c=d=>{const m=d===void 0?0:d?1:2;p(m);const S=n.filter(x=>!(a===x.position&&s===x.group));i([...S,{type:"triState",position:a,state:fe(m),group:s}])};return r!==void 0?t.jsx(Xt,{label:o,checked:[void 0,!0,!1][l],onChange:d=>c(d)}):null},Se=e=>{const{state:r,name:o,position:a,updateFilterValue:s,update:i}=e,[n,l]=y.useState(!1);return t.jsxs(E,{sx:{mx:-2},children:[t.jsxs(ct,{onClick:()=>l(!n),children:[t.jsx(ut,{primary:o}),n?t.jsx(K,{}):t.jsx(Q,{})]}),t.jsx(gt,{in:n,children:t.jsx(U,{sx:{mx:4},children:t.jsx(xt,{sourceFilter:r,group:a,updateFilterValue:s,update:i})})})]})},je=({name:e})=>t.jsx(Ft,{sx:{my:1},textAlign:"center",children:e},e);function xt({sourceFilter:e,group:r,updateFilterValue:o,update:a}){return t.jsx(U,{children:e.map((s,i)=>{var l,p;let n=a.find(c=>c.group===r&&c.position===i);switch(n=n&&n.state,s.type){case"CheckBoxFilter":return t.jsx(ae,{name:s.name,state:n!=null?n:s.CheckBoxFilterDefault,position:i,group:r,updateFilterValue:o,update:a},"filters ".concat(s.name));case"GroupFilter":return t.jsx(Se,{name:s.name,state:s.filters,position:i,updateFilterValue:o,update:a},"filters ".concat(s.name));case"HeaderFilter":return t.jsx(ne,{name:s.name},"filters ".concat(s.name));case"SelectFilter":return t.jsx(oe,{name:s.name,values:s.values,state:n!=null?parseInt(n,10):s.SelectFilterDefault,position:i,group:r,updateFilterValue:o,update:a},"filters ".concat(s.name));case"SeparatorFilter":return t.jsx(je,{name:s.name},"filters ".concat(s.name));case"SortFilter":return t.jsx(me,{name:s.name,values:s.values,state:n!=null?n:{ascending:(l=s.SortFilterDefault)==null?void 0:l.ascending,index:(p=s.SortFilterDefault)==null?void 0:p.index},position:i,group:r,updateFilterValue:o,update:a},"filters ".concat(s.name));case"TextFilter":return t.jsx(ge,{name:s.name,state:n!=null?n:s.TextFilterDefault,position:i,group:r,updateFilterValue:o,update:a},"filters ".concat(s.name));case"TriStateFilter":return t.jsx(he,{name:s.name,state:n!=null?n:s.TriStateFilterDefault,position:i,group:r,updateFilterValue:o,update:a},"filters ".concat(s.name));default:throw new Error('Unknown source filter "'.concat(s,'"'))}})},"filters ".concat(r))}function be({sourceFilter:e,updateFilterValue:r,resetFilterValue:o,setTriggerUpdate:a,update:s}){const{t:i}=H(),[n,l]=h.useState(!1);function p(){o(0),l(!1)}function c(){a(0),l(!1)}return t.jsxs(t.Fragment,{children:[t.jsxs(Zt,{onClick:()=>l(!n),variant:"extended",color:"primary",children:[t.jsx(pt,{}),i("global.button.filter")]}),t.jsxs(zt,{open:n,onClose:()=>l(!1),children:[t.jsxs(E,{sx:{display:"flex",p:2,pb:0},children:[t.jsx(q,{onClick:p,children:i("global.button.reset")}),t.jsx(q,{sx:{marginLeft:"auto"},variant:"contained",onClick:c,children:i("global.button.submit")})]}),t.jsx(E,{sx:{pb:2,mx:2},children:t.jsx(xt,{sourceFilter:e,updateFilterValue:r,group:void 0,update:s})})]})]})}function ve(e){const{t:r}=H(),{mangas:o,isLoading:a,hasNextPage:s,loadMore:i,message:n,messageExtra:l,gridLayout:p}=e,c=o,d=c.length===0&&o.length>0;return t.jsx(Jt,{mangas:c,isLoading:a,hasNextPage:s,loadMore:i,message:d?r("manga.error.label.no_matches"):n,messageExtra:l,gridLayout:p,inLibraryIndicator:!0,mode:"source"})}const Ce=z("div")(({theme:e})=>({display:"flex",position:"fixed",top:"64px",width:"100%",zIndex:1,backgroundColor:e.palette.background.default,[e.breakpoints.down("sm")]:{top:"56px"}})),N=z(q)(()=>({marginTop:"13px",marginBottom:"13px",marginLeft:"13px"})),ye=z(E,{shouldForwardProp:e=>e!=="hasContent"})(({theme:e,hasContent:r})=>({marginTop:"calc(62.5px ".concat(r?"- 8px":"",")"),minHeight:"calc(100vh - 64px - 62.5px)",position:"relative",[e.breakpoints.down("sm")]:{marginTop:"calc(62.5px - 8px ".concat(r?"- 8px":"",")"),minHeight:"calc(100vh - 64px - 64px - 62.5px)"}}));var Le=(e=>(e[e.POPULAR=0]="POPULAR",e[e.LATEST=1]="LATEST",e[e.SEARCH=2]="SEARCH",e))(Le||{});const Te={0:"manga.error.label.no_mangas_found",1:"manga.error.label.no_mangas_found",2:"manga.error.label.no_matches"},Fe=e=>{const r={},o=[];return e.forEach(a=>{!!r[a.id]||(r[a.id]=a,o.push(a))}),o},Ie=(e,r,o,a,s,i)=>{let n;switch(r){case 0:n=I.useGetSourcePopularMangas(e,s);break;case 1:n=I.useGetSourceLatestMangas(e,s);break;case 2:n=I.useSourceSearch(e,o!=null?o:"",a.map(x=>{const{position:u,state:g,group:v}=x;return v!==void 0?{position:v,groupChange:{position:u,[x.type]:g}}:{position:u,[x.type]:g}}),s);break;default:throw new Error('Unknown ContentType "'.concat(r,'"'))}const l=n[1],p=l.findLastIndex(x=>{var u;return!!((u=x.data)!=null&&u.fetchSourceManga)}),c=l[p],d=l.slice(-1)[0].isLoading;let m=!d;const S=h.useMemo(()=>{let x=[];return l.forEach((u,g)=>{var F,$;const v=($=(F=u.data)==null?void 0:F.fetchSourceManga.mangas)!=null?$:[],C=v.filter(k=>!i||!k.inLibrary),w=Fe([...x,...C]);m=!d&&l.length===g+1&&!C.length&&!!v.length,x=w}),x},[l,i]);return p===-1?[n[0],{...n[1][n[1].length-1],filteredOutAllItemsOfFetchedPage:m}]:[n[0],{...l[l.length-1],data:{...c.data,fetchSourceManga:{...c.data.fetchSourceManga,hasNextPage:l.length>p+1?!1:c.data.fetchSourceManga.hasNextPage,mangas:S}},filteredOutAllItemsOfFetchedPage:m}]};function ps(){var et,st,at,nt;const{t:e}=H(),{setTitle:r,setAction:o}=h.useContext(It),{sourceId:a}=Et(),s=$t(),i=rt(),{key:n,state:l}=i,{contentType:p=0,clearCache:c=!1}=(et=rt().state)!=null?et:{};kt("browse");const[d,m]=h.useState(!0);h.useEffect(()=>{m(!1)},[]);const{settings:{hideLibraryEntries:S}}=Mt(),{options:x}=ot(),[u]=Gt("query",Nt),[g,v]=P("source-mangas-".concat(a,"-filters"),[]),[C,w]=P("source-mangas-location-".concat(n,"-").concat(a,"-filters"),g!=null?g:[]),[A,F]=h.useState(C),[$,k]=P("source-mangas-".concat(a,"-content-type"),p),[b,ft]=P("source-mangas-location-".concat(n,"-").concat(a,"-content-type"),u?2:$);h.useEffect(()=>()=>{v(void 0),k(void 0)},[a]);const M=h.useCallback(()=>{_t.session.setItem(te(i),void 0,!1),window.scrollTo(0,0)},[n]),W=j=>{v(j),w(j),M()},X=j=>{k(j),ft(j)},[Z,{data:L,isLoading:R,size:D,abortRequest:ht,filteredOutAllItemsOfFetchedPage:G}]=Ie(a,b,u,C,1,S),J=R||G,tt=(st=L==null?void 0:L.fetchSourceManga.mangas)!=null?st:[],_=(at=L==null?void 0:L.fetchSourceManga.hasNextPage)!=null?at:!1,{data:B}=I.useGetSource(a),f=B==null?void 0:B.source,St=(nt=f==null?void 0:f.filters)!=null?nt:[],jt=J?void 0:e(Te[b]),bt=a==="0"?t.jsxs(t.Fragment,{children:[t.jsxs("span",{children:[e("source.local_source.label.checkout")," "]}),t.jsx(ee,{href:"https://github.com/Suwayomi/Suwayomi-Server/wiki/Local-Source",target:"_blank",rel:"noreferrer",children:e("source.local_source.label.guide")})]}):void 0,O=h.useCallback((j,yt)=>{X(j),M(),u&&!yt&&s({pathname:""},{state:{...l,contentType:j}})},[X,u,M]);!!u&&b!==2&&O(2,u);const vt=h.useCallback(()=>{_&&Z(D+1)},[D,_,b]),Ct=h.useCallback(()=>{F([]),W([])},[a,b]);return h.useEffect(()=>{G&&_&&!R&&Z(D+1)},[G,R]),h.useEffect(()=>{!c||!Rt.REVALIDATION.includes(a)||I.clearBrowseCacheFor(a)},[c]),h.useEffect(()=>()=>{b!==2||d||(ht(new Error("SourceMangas(".concat(a,"): search string changed"))),M())},[u]),h.useEffect(()=>{var j;return r((j=f==null?void 0:f.displayName)!=null?j:e("source.title")),o(t.jsxs(t.Fragment,{children:[t.jsx(Bt,{}),t.jsx(se,{}),(f==null?void 0:f.isConfigurable)&&t.jsx(Ot,{title:e("settings.title"),children:t.jsx(Pt,{onClick:()=>s("/sources/".concat(a,"/configure/")),"aria-label":"display more actions",edge:"end",color:"inherit",size:"large",children:t.jsx(wt,{})})})]})),()=>{r(""),o(null)}},[e,f]),t.jsxs(ye,{hasContent:!!tt.length,children:[t.jsxs(Ce,{children:[t.jsx(N,{variant:b===0?"contained":"outlined",startIcon:t.jsx(qt,{}),onClick:()=>O(0),children:e("global.button.popular")}),(f==null?void 0:f.supportsLatest)===void 0||f.supportsLatest?t.jsx(N,{disabled:!(f!=null&&f.supportsLatest),variant:b===1?"contained":"outlined",startIcon:t.jsx(At,{}),onClick:()=>O(1),children:e("global.button.latest")}):null,t.jsx(N,{variant:b===2?"contained":"outlined",startIcon:t.jsx(pt,{}),onClick:()=>O(2,u),children:e("global.button.filter")})]}),t.jsx(ve,{mangas:tt,hasNextPage:_,loadMore:vt,message:jt,messageExtra:bt,isLoading:J,gridLayout:x.SourcegridLayout},b),b===2&&t.jsx(be,{sourceFilter:St,updateFilterValue:F,setTriggerUpdate:()=>{W(A)},resetFilterValue:Ct,update:A})]})}export{Le as SourceContentType,ps as SourceMangas};
