import{u as b,a as i,c as p,h as u,j as r,f as C,I as x,w as J,m as T}from"./index-Zl59rTnr.js";import{P as h}from"./Progress-BgVdFcJg.js";const j=a=>{if(!a)return 0;const o=a.failedJobs.mangas.totalCount+a.completeJobs.mangas.totalCount,n=o+a.pendingJobs.mangas.totalCount+a.runningJobs.mangas.totalCount,s=100*(o/n);return Number.isNaN(s)?0:s};let t=!1;function R({handleFinishedUpdate:a}){const{t:o}=b(),{data:n,refetch:s}=i.useGetLastGlobalUpdateTimestamp(),c=n==null?void 0:n.lastUpdateTimestamp.timestamp,{data:l}=i.useGetGlobalUpdateSummary(),e=l==null?void 0:l.updateStatus,m=!!(e!=null&&e.isRunning),g=p.useMemo(()=>j(e),[e==null?void 0:e.failedJobs.mangas.totalCount,e==null?void 0:e.completeJobs.mangas.totalCount,e==null?void 0:e.pendingJobs.mangas.totalCount,e==null?void 0:e.runningJobs.mangas.totalCount]);p.useEffect(()=>{!t&&(e!=null&&e.isRunning)&&(t=!0),t&&g===100&&(t=!1,a==null||a(),s().catch(u()))},[e==null?void 0:e.isRunning]);const d=async()=>{try{t=!0,await i.startGlobalUpdate().response,s().catch(u("UpdateChecker::reFetchLastTimestamp"))}catch(f){t=!1,T(o("global.error.label.update_failed"),"error")}};return r.jsx(C,{title:o("library.settings.global_update.label.last_update_tooltip",{date:c?new Date(+c).toLocaleString():"-"}),children:r.jsx(x,{onClick:d,disabled:m,children:m?r.jsx(h,{progress:g}):r.jsx(J,{})})})}export{R as U};
