import{u as y,au as w,r as h,b as k,j as e,a6 as A,aO as P,a4 as R,p as L,bH as E,i as F,an as M,k as U,n as D,q as N,B as I,m as T,g as p,a as O,R as B,f as _,e as $,F as v,o as S,w as q}from"./index-Bunimexy.js";import{E as G}from"./EmptyViewAbsoluteCentered-BJsAF0H0.js";import{P as W}from"./PasswordTextField-DajZPB08.js";import{T as g}from"./Trackers-Bgo8y--2.js";import{L as H}from"./ListItemAvatar-YVMhuVRa.js";import{A as V}from"./Avatar-y36Vrebj.js";import{C as J}from"./Chip-BTr7VDhA.js";import{T as K}from"./TextField-B2Nq9xcg.js";import{u as z}from"./useAppTitle-Cv6DabpI.js";import{S as C}from"./Switch-SZbhVDQ3.js";import{L as Q}from"./ListSubheader-DBjDtMkz.js";import"./VisibilityOff-1kdIU2X1.js";import"./InputAdornment-bKBiz75j.js";import"./useFormControl-CLpWWdfr.js";import"./formControlState-Dq1zat_P.js";import"./SwitchBase-Dc738_PD.js";const X=({tracker:a})=>{const{t:r}=y(),[x]=w("serverBaseURL","http://localhost:4567"),[f,{loading:n}]=h.useLoginToTrackerCredentials(),[b]=h.useLogoutFromTracker(),[o,l]=k.useState(""),[d,c]=k.useState(""),i=!a.isLoggedIn&&!!a.authUrl,j=async()=>{try{await b({variables:{trackerId:a.id}})}catch(s){T(r("tracking.action.logout.label.failure",{name:a.name}),"error",p(s))}},u=async()=>{if(i){const s={redirectUrl:"".concat(x,"/tracker/login/oauth"),clientName:"Suwayomi-WebUI",trackerId:a.id,trackerName:a.name};window.open("".concat(a.authUrl,"&state=").concat(JSON.stringify(s)),"_self");return}try{await f({variables:{input:{trackerId:a.id,username:o,password:d}}})}catch(s){T(r("tracking.action.login.label.failure",{name:a.name}),"error",p(s))}},m=s=>{if(!i){s();return}u()};return e.jsx(A,{variant:"popover",popupId:"tracker-dialog",children:s=>e.jsxs(e.Fragment,{children:[e.jsxs(P,{...R(s),onClick:()=>m(s.open),children:[e.jsx(H,{sx:{paddingRight:"20px"},children:e.jsx(V,{alt:"".concat(a.name),src:h.getValidImgUrlFor(a.icon),variant:"rounded",sx:{width:64,height:64}})}),e.jsx(L,{primary:a.name}),g.isLoggedIn(a)&&e.jsx(E,{children:e.jsx(J,{label:r("global.label.logged_in"),color:"success"})})]}),e.jsxs(F,{...M(s),open:(g.isLoggedIn(a)||!a.authUrl)&&s.isOpen,disableRestoreFocus:!0,children:[e.jsx(U,{children:r(g.isLoggedIn(a)?"tracking.settings.dialog.title.log_out":"tracking.settings.dialog.title.log_in",{name:a.name})}),!i&&!a.isLoggedIn&&e.jsxs(D,{children:[e.jsx(K,{autoFocus:!0,margin:"dense",id:"username",name:"username",label:r("global.label.username"),type:"text",fullWidth:!0,variant:"standard",onChange:t=>l(t.target.value)}),e.jsx(W,{margin:"dense",fullWidth:!0,variant:"standard",onChange:t=>c(t.target.value)})]}),e.jsxs(N,{children:[e.jsx(I,{onClick:s.close,children:r("global.button.cancel")}),e.jsx(I,{variant:"contained",disabled:!i&&!a.isLoggedIn&&(n||!o.length||!d.length),onClick:()=>g.isLoggedIn(a)?j():u(),children:r(g.isLoggedIn(a)?"global.button.log_out":"global.button.log_in")})]})]})]})})},he=()=>{var s;const{t:a}=y();z(a("tracking.title"));const{settings:{updateProgressAfterReading:r,updateProgressManualMarkRead:x},loading:f,request:{error:n,refetch:b}}=O(),o=q(t=>T(a("global.error.label.failed_to_save_changes"),"error",p(t))),{data:l,loading:d,error:c,refetch:i}=h.useGetTrackerList(B,{notifyOnNetworkStatusChange:!0}),j=(s=l==null?void 0:l.trackers.nodes)!=null?s:[],u=f||d,m=n!=null?n:c;return m?e.jsx(G,{message:a("global.error.label.failed_to_load_data"),messageExtra:p(m),retry:()=>{n&&b().catch(_()),c&&i().catch(_())}}):u?e.jsx($,{}):e.jsxs(e.Fragment,{children:[e.jsxs(v,{sx:{pt:0},children:[e.jsxs(S,{children:[e.jsx(L,{primary:a("tracking.settings.label.update_progress_reading")}),e.jsx(C,{edge:"end",checked:r,onChange:t=>o("updateProgressAfterReading",t.target.checked)})]}),e.jsxs(S,{children:[e.jsx(L,{primary:a("tracking.settings.label.update_progress_manual"),secondary:a("tracking.settings.label.update_progress_reading_description")}),e.jsx(C,{edge:"end",checked:x,onChange:t=>o("updateProgressManualMarkRead",t.target.checked)})]})]}),e.jsx(v,{subheader:e.jsx(Q,{component:"div",id:"tracking-trackers",children:a("tracking.settings.title.trackers")}),children:j.map(t=>e.jsx(X,{tracker:t},t.id))})]})};export{he as TrackingSettings};
