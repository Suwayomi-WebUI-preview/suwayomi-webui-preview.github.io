import{r as Ee,i as Se,j as e,s as ce,u as _,L as y,B as C,a as E,T,b as U,c as o,N as V,d as G,e as Ne,f as ae,g as ue,I as de,h as X,E as M,k as D,l as z,m as je,n as be,o as Ae,p as Ie,q as ve,S as ye,D as N,t as Ce,v as _e}from"./index-D6RYBNhe.js";import{t as F,L as pe,i as Oe,E as g}from"./LangSelect-D31JAcPd.js";import{SourceContentType as B}from"./SourceMangas-Bv4kPmhV.js";import{S as K}from"./SpinnerImage--77B1QOy.js";import{C as Q,a as xe}from"./index-DGjB4x9H.js";import{C as Y}from"./CardContent-sLHFs3NZ.js";import{A as J}from"./Avatar-5bJ3DWwf.js";import{f as we}from"./file-selector-DNVc6qUt.js";import{d as Ue}from"./Add-Cfy_TD5u.js";import{u as De,S as Pe,A as ke}from"./AppbarSearch-BUJyp6OY.js";import{S as Re,a as Be,b as me}from"./StyledGroupItemWrapper-BzZtN7dF.js";import{T as H,a as W}from"./Tabs-DcXsNrU8.js";import{T as Ge,a as Me}from"./TabsMenu-DuMtdn6u.js";import{C as Fe}from"./Chip-BUCSdFfL.js";import"./FilterList-B_0xrp9g.js";import"./cloneObject-DrOPTG0J.js";import"./Switch-uJK7KaYC.js";import"./SwitchBase-B0rT0SwT.js";import"./TextField-BsPhsFsz.js";import"./Favorite-CZK93bTH.js";import"./GridLayouts-CfA7dJdS.js";import"./ViewModule-m-4_Hwa8.js";import"./Checkbox-CMGh2nfj.js";import"./ListPreference-BkA9zf4t.js";import"./SortRadioInput-CbzIoMn7.js";import"./CheckboxInput-CUyC7wfn.js";import"./Collapse-DlmjrCDx.js";import"./useDebounce-BDv83NHX.js";import"./InputAdornment-BMkJJMlZ.js";import"./ThreeStateCheckboxInput-C41jOK86.js";import"./StyledFab-WdkP40Ol.js";import"./MangaGrid-C-UKN7ot.js";import"./useManageMangaLibraryState-ubfWXGhl.js";import"./Link-BNRcdOsD.js";import"./NumberSetting-B1PCWSx9.js";import"./Info-6eil46u_.js";import"./useMobilePicker-DgqptBYP.js";import"./SelectSetting-8dZue8Rn.js";import"./Select-D4SlXrdS.js";import"./metadataServerSettings-BzXqSfB-.js";import"./metadata-S3rj_Joy.js";import"./Mangas-DTU0K87K.js";import"./Chapters-CPKjKZCN.js";import"./Delete-B9pGU81w.js";import"./Sync-BWeuXktb.js";import"./PlayArrow-COuFmoWi.js";var Z={},$e=Se;Object.defineProperty(Z,"__esModule",{value:!0});var he=Z.default=void 0,qe=$e(Ee()),He=e;he=Z.default=(0,qe.default)((0,He.jsx)("path",{d:"M19.3 16.9c.4-.7.7-1.5.7-2.4 0-2.5-2-4.5-4.5-4.5S11 12 11 14.5s2 4.5 4.5 4.5c.9 0 1.7-.3 2.4-.7l3.2 3.2 1.4-1.4zm-3.8.1c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5M12 20v2C6.48 22 2 17.52 2 12S6.48 2 12 2c4.84 0 8.87 3.44 9.8 8h-2.07c-.64-2.46-2.4-4.47-4.73-5.41V5c0 1.1-.9 2-2 2h-2v2c0 .55-.45 1-1 1H8v2h2v3H9l-4.79-4.79C4.08 10.79 4 11.38 4 12c0 4.41 3.59 8 8 8"}),"TravelExplore");const We=ce("div")(({theme:t})=>({display:"flex",[t.breakpoints.up("sm")]:{display:"none"}})),Ve=ce("div")(({theme:t})=>({display:"flex",[t.breakpoints.down("sm")]:{display:"none"},"& .MuiButton-root":{marginLeft:"20px"}})),Xe=t=>{const{t:s}=_(),{source:{id:n,name:l,lang:c,iconUrl:r,supportsLatest:m,isNsfw:u,extension:{repo:h}},showSourceRepo:i}=t;return e.jsx(Q,{sx:{margin:"10px",marginTop:0},children:e.jsx(xe,{component:y,to:"/sources/".concat(n),state:{contentType:B.POPULAR,clearCache:!0},children:e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:2},children:[e.jsxs(C,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(J,{variant:"rounded",alt:l,sx:{width:56,height:56,flex:"0 0 auto",mr:2,background:"transparent"},children:e.jsx(K,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%"},alt:l,src:E.getValidImgUrlFor(r)})}),e.jsxs(C,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(T,{variant:"h5",component:"h2",children:l}),n!=="0"&&e.jsxs(T,{variant:"caption",display:"block",gutterBottom:!0,children:[F(c),u&&e.jsx(T,{variant:"caption",display:"inline",gutterBottom:!0,color:"red",children:" 18+"}),i&&e.jsx(T,{variant:"caption",display:"block",children:h})]})]})]}),e.jsxs(e.Fragment,{children:[e.jsx(We,{children:m&&e.jsx(U,{variant:"outlined",component:y,to:"/sources/".concat(n),state:{contentType:B.LATEST,clearCache:!0},children:s("global.button.latest")})}),e.jsxs(Ve,{children:[m&&e.jsx(U,{variant:"outlined",component:y,to:"/sources/".concat(n),state:{contentType:B.LATEST,clearCache:!0},children:s("global.button.latest")}),e.jsx(U,{variant:"outlined",component:y,to:"/sources/".concat(n),state:{contentType:B.POPULAR,clearCache:!0},children:s("global.button.popular")})]})]})]})})})};function ze(t){const s=[];return t.forEach(n=>{s.indexOf(n.lang)===-1&&s.push(n.lang)}),s.sort(z),s}function Ke(t){const s={};return t.forEach(n=>{s[n.lang]===void 0&&(s[n.lang]=[]),s[n.lang].push(n)}),s}function Qe(){const{t}=_(),{setAction:s}=o.useContext(V),[n,l]=G("shownSourceLangs",je()),[c]=G("showNsfw",!0),{data:r,loading:m,error:u,refetch:h}=E.useGetSourceList({notifyOnNetworkStatusChange:!0}),i=r==null?void 0:r.sources.nodes,v=o.useMemo(()=>{if(!i||i!=null&&i.length)return!1;const{repo:x}=i[0].extension;return i.some(f=>f.extension.repo!==x)},[i]),b=Ne();return o.useEffect(()=>{ae().forEach(x=>{let f=!1;n.forEach(d=>{d===x&&(f=!0)}),f||l(d=>(d.push(x),d))})},[]),o.useEffect(()=>(s(e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:t("search.title.global_search"),children:e.jsx(de,{onClick:()=>b("/sources/all/search/"),size:"large",children:e.jsx(he,{})})}),e.jsx(pe,{shownLangs:n,setShownLangs:l,allLangs:ze(i!=null?i:[]),forcedLangs:ae()})]})),()=>{s(null)}),[t,n,i]),m?e.jsx(X,{}):u?e.jsx(M,{message:t("global.error.label.failed_to_load_data"),messageExtra:u.message,retry:()=>h().catch(D())}):(i==null?void 0:i.length)===0?e.jsx(M,{message:t("source.error.label.no_sources_found")}):e.jsx(e.Fragment,{children:Object.entries(Ke(i!=null?i:[])).sort((x,f)=>z(x[0],f[0])).map(([x,f])=>n.indexOf(x)!==-1&&e.jsxs(o.Fragment,{children:[e.jsx(T,{variant:"h4",style:{paddingLeft:"24px",paddingTop:"6px",paddingBottom:"16px",fontWeight:"bold"},children:F(x)},x),f.filter(d=>c||!d.isNsfw).map(d=>e.jsx(Xe,{source:d,showSourceRepo:v},d.id))]},x))})}var fe=(t=>(t.UPDATE="UPDATE",t.UNINSTALL="UNINSTALL",t.INSTALL="INSTALL",t))(fe||{}),ge=(t=>(t.OBSOLETE="OBSOLETE",t.UPDATING="UPDATING",t.UNINSTALLING="UNINSTALLING",t.INSTALLING="INSTALLING",t))(ge||{});const L={...fe,...ge},Ye={UPDATE:"UPDATING",UNINSTALL:"UNINSTALLING",INSTALL:"INSTALLING"},Je={UPDATE:"UNINSTALL",UNINSTALL:"INSTALL",INSTALL:"UNINSTALL"},Ze={[L.UNINSTALL]:"extension.action.label.uninstall",[L.INSTALL]:"extension.action.label.install",[L.UPDATE]:"extension.action.label.update",[L.OBSOLETE]:"extension.state.label.obsolete",[L.UPDATING]:"extension.state.label.updating",[L.UNINSTALLING]:"extension.state.label.uninstalling",[L.INSTALLING]:"extension.state.label.installing"},et={UPDATE:"extension.label.update_failed",INSTALL:"extension.label.installation_failed",UNINSTALL:"extension.label.uninstallation_failed"},oe=(t,s,n)=>s?L.OBSOLETE:n?L.UPDATE:t?L.UNINSTALL:L.INSTALL;function tt(t){const{t:s}=_(),{extension:{name:n,lang:l,versionName:c,isInstalled:r,hasUpdate:m,isObsolete:u,pkgName:h,iconUrl:i,isNsfw:v,repo:b},handleUpdate:x,showSourceRepo:f}=t,[d,A]=o.useState(oe(r,u,m)),$=l==="all"?s("extension.language.all"):l.toUpperCase(),O=async j=>{const P=Je[j],k=Ye[j];try{switch(A(k),j){case"INSTALL":await E.updateExtension(h,{install:!0,isObsolete:u}).response;break;case"UNINSTALL":await E.updateExtension(h,{uninstall:!0,isObsolete:u}).response;break;case"UPDATE":await E.updateExtension(h,{update:!0,isObsolete:u}).response;break;default:throw new Error('Unexpected ExtensionAction "'.concat(j,'"'))}A(P),x()}catch(q){A(oe(r,u,m)),be(s(et[j]),"error")}};function S(){switch(d){case"INSTALL":case"UPDATE":case"UNINSTALL":O(d).catch(D());break;case"OBSOLETE":O("UNINSTALL").catch(D());break}}return e.jsx(Q,{children:e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,"&:last-child":{paddingBottom:2}},children:[e.jsxs(C,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(J,{variant:"rounded",sx:{width:56,height:56,flex:"0 0 auto",mr:2,background:"transparent"},alt:n,children:e.jsx(K,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%"},alt:n,src:E.getValidImgUrlFor(i)})}),e.jsxs(C,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(T,{variant:"h5",component:"h2",children:n}),e.jsxs(T,{variant:"caption",display:"block",children:[$," ",c,v&&e.jsx(T,{variant:"caption",display:"inline",color:"red",children:" 18+"})]}),f&&e.jsx(T,{variant:"caption",display:"block",children:b})]})]}),e.jsx(U,{variant:"outlined",sx:{color:d===L.OBSOLETE?"red":"inherit"},onClick:()=>S(),children:s(Ze[d])})]})})}const ie=0,le=1;function nt(t){const s=[],n={[g.OBSOLETE]:[],[g.INSTALLED]:[],[g.UPDATE_PENDING]:[],[N.ALL]:[],[N.OTHER]:[],[N.LOCAL_SOURCE]:[]};t.forEach(r=>{if(n[r.lang]===void 0&&(n[r.lang]=[],r.lang!=="all"&&s.push(r.lang)),r.isInstalled){if(r.hasUpdate){n[g.UPDATE_PENDING].push(r);return}if(r.isObsolete){n[g.OBSOLETE].push(r);return}n[g.INSTALLED].push(r)}else n[r.lang].push(r)}),s.sort(z);const l=[[g.OBSOLETE,n[g.OBSOLETE]],[g.UPDATE_PENDING,n[g.UPDATE_PENDING]],[g.INSTALLED,n[g.INSTALLED]],[N.ALL,n[N.ALL]],[N.OTHER,n[N.OTHER]],[N.LOCAL_SOURCE,n[N.LOCAL_SOURCE]]],c=s.map(r=>[r,n[r]]);return{allLangs:s,groupedExtensions:l.concat(c)}}function st(){var re;const{t}=_(),{setAction:s}=o.useContext(V),n=Ae(),l=Ie(n.breakpoints.down("sm")),{data:c}=E.useGetServerSettings(),r=!!(c!=null&&c.settings.extensionRepos.length),m=((re=c==null?void 0:c.settings.extensionRepos.length)!=null?re:0)>1,u=o.useRef(null),[h,i]=G("shownExtensionLangs",Ce()),[v]=G("showNsfw",!0),[b]=De("query",Pe),[x,f]=o.useState({}),[d,{data:A,loading:$,error:O}]=E.useExtensionListFetch(),S=A==null?void 0:A.fetchExtensions.extensions,j=o.useCallback(()=>f({}),[]);o.useEffect(()=>{d()},[x]);const P=o.useMemo(()=>(S!=null?S:[]).filter(a=>{const p=v||!a.isNsfw;return b?p&&a.name.toLowerCase().includes(b.toLowerCase()):p}),[S,v,b]),{allLangs:k,groupedExtensions:q}=o.useMemo(()=>nt(P),[P]),w=o.useMemo(()=>q.filter(a=>a[le].length>0).filter(a=>Oe(a[ie])||h.includes(a[ie])),[h,q]),Le=o.useMemo(()=>w.map(a=>a[le].length),[w]),ee=o.useMemo(()=>w.map(([,a])=>a).flat(1),[w]),[te,R]=ve(o.useState([])),ne=a=>{a.name.toLowerCase().endsWith("apk")?(u.current&&(u.current.value=""),R(t("extension.label.installing_file"),"info"),E.installExternalExtension(a).response.then(()=>{j(),R(t("extension.label.installed_successfully"),"success")}).catch(()=>R(t("extension.label.installation_failed"),"error"))):R(t("global.error.label.invalid_file_type"),"error")};o.useEffect(()=>(s(e.jsxs(e.Fragment,{children:[e.jsx(ke,{}),e.jsx(ue,{title:t("extension.action.label.install_external"),children:e.jsx(de,{onClick:()=>{var a;return(a=u.current)==null?void 0:a.click()},size:"large",children:e.jsx(Ue,{})})}),e.jsx(pe,{shownLangs:h,setShownLangs:i,allLangs:k})]})),()=>{s(null)}),[t,h,k]),o.useEffect(()=>{const a=async I=>{I.preventDefault();const Te=await we(I);ne(Te[0])},p=I=>{I.preventDefault()};return document.addEventListener("drop",a),document.addEventListener("dragover",p),()=>{document.removeEventListener("drop",a),document.removeEventListener("dragover",p)}},[]);const se=o.useMemo(()=>e.jsx("input",{type:"file",style:{display:"none"},ref:u,onChange:a=>{var I;const p=(I=a.target.files)==null?void 0:I[0];p&&ne(p)}}),[]);return $?e.jsx(X,{}):O?e.jsx(M,{message:t("global.error.label.failed_to_load_data"),messageExtra:O.message,retry:()=>d().catch(D())}):!(S!=null&&S.length)&&!r?e.jsxs(e.Fragment,{children:[te,se,e.jsxs(ye,{sx:{paddingTop:"20px"},alignItems:"center",justifyContent:"center",rowGap:"10px",children:[e.jsx(T,{children:t("extension.label.add_repository_info")}),e.jsx(U,{component:y,variant:"contained",to:"/settings/browseSettings",children:t("settings.title")})]})]}):e.jsxs(e.Fragment,{children:[te,se,e.jsx(Re,{style:{height:"undefined"},heightToSubtract:l?48:53,overscan:window.innerHeight*.5,groupCounts:Le,groupContent:a=>{const[p]=w[a];return e.jsx(Be,{variant:"h4",style:{paddingLeft:"24px",paddingTop:"6px",paddingBottom:"16px",fontWeight:"bold"},isFirstItem:a===0,children:F(p)},p)},itemContent:a=>{const p=ee[a];return e.jsx(me,{isLastItem:a===ee.length-1,children:e.jsx(tt,{extension:p,handleUpdate:j,showSourceRepo:m})},"".concat(p.pkgName,"_").concat(p.isInstalled,"_").concat(p.isObsolete,"_").concat(p.hasUpdate))}})]})}const rt=({id:t,name:s,lang:n,iconUrl:l,mangaCount:c})=>e.jsx(Q,{children:e.jsx(xe,{component:y,to:"/migrate/source/".concat(t,"/"),children:e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[e.jsxs(C,{sx:{display:"flex"},children:[e.jsx(J,{variant:"rounded",sx:{width:56,height:56,flex:"0 0 auto",mr:2,background:"transparent"},children:e.jsx(K,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%"},alt:s,src:E.getValidImgUrlFor(l)})}),e.jsxs(C,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(T,{variant:"h5",component:"h2",children:s}),e.jsx(T,{variant:"caption",display:"block",children:F(n)})]})]}),e.jsx(Fe,{sx:{borderRadius:"5px"},size:"small",label:c})]})})}),at=t=>{if(!t)return{};const s={};return t.forEach(({sourceId:n,source:l})=>{var r;const c=(r=s[n])!=null?r:{id:n,name:n,lang:"unknown",iconUrl:null,mangaCount:0,...l};s[n]={...c,mangaCount:c.mangaCount+1}}),s},ot=()=>{const{t}=_(),{data:s,loading:n,error:l,refetch:c}=E.useGetMigratableSources({notifyOnNetworkStatusChange:!0}),r=o.useMemo(()=>at(s==null?void 0:s.mangas.nodes),[s==null?void 0:s.mangas.nodes]);return n?e.jsx(X,{}):l?e.jsx(M,{message:t("global.error.label.failed_to_load_data"),messageExtra:l.message,retry:()=>c().catch(D())}):e.jsx(_e,{children:Object.values(r).map((m,u)=>e.jsx(me,{isLastItem:u===Object.values(r).length-1,children:e.jsx(rt,{...m})},m.id))})};function en(){const{t}=_(),{setTitle:s}=o.useContext(V),[n,l]=o.useState(0);return o.useEffect(()=>{s(t("global.label.browse"))},[t]),e.jsxs(Ge,{children:[e.jsxs(Me,{value:n,tabsCount:2,onChange:(c,r)=>l(r),children:[e.jsx(H,{sx:{textTransform:"none"},label:t("source.title")}),e.jsx(H,{sx:{textTransform:"none"},label:t("extension.title")}),e.jsx(H,{sx:{textTransform:"none"},label:t("migrate.title")})]}),e.jsx(W,{index:0,currentIndex:n,children:e.jsx(Qe,{})}),e.jsx(W,{index:1,currentIndex:n,children:e.jsx(st,{})}),e.jsx(W,{index:2,currentIndex:n,children:e.jsx(ot,{})})]})}export{en as Browse};
