import{u as P,p as k,a as B,g as $,b as G,r as T,d as c,j as r,f as H,h as q,i as N,o as C,am as D,A as I,L as O,T as A,aw as Q}from"./index-D2_dCMBF.js";import{u as V,S as W,A as z}from"./AppbarSearch-DMR87DYu.js";import{t as J,L as K}from"./LanguageSelect-Cb2ElfB9.js";import{u as v}from"./useDebounce-n_We4Vat.js";import{B as U}from"./BaseMangaGrid-B4TS2wvi.js";import{E as X}from"./EmptyViewAbsoluteCentered-rO8MR0G-.js";import{S as _}from"./Sources-Br-W6XHo.js";import{u as Y}from"./useAppTitleAndAction-DA-L3q6j.js";import{C as Z}from"./Card-CKffCtS2.js";import{C as ee}from"./CardActionArea-4qMvHVwC.js";import"./ChaptersDownloadActionMenuItems-C6JtAFD6.js";import"./Trackers-D4pSmk7a.js";import"./ListCardContent-CUni8eKh.js";import"./Avatar-ZcbM6Q4Z.js";import"./TextField-kswmo9A1.js";import"./useFormControl-BBRgs61F.js";import"./formControlState-Dq1zat_P.js";import"./InputAdornment-Dl9od6QX.js";import"./CheckCircle-DOoI4f8f.js";import"./MUI.util-DDPpK_AC.js";import"./Link-Bg3AmDhN.js";import"./useManageMangaLibraryState-D9P1Mjfm.js";import"./ThreeStateCheckboxInput-B96qeOI4.js";import"./Checkbox-ngyJ9_M3.js";import"./SwitchBase-C-QbNHM0.js";import"./CheckboxInput-BoA396dr.js";import"./FormGroup-CF4jN-FP.js";import"./ListPreference-06Jqv6Ct.js";import"./NumberSetting-C3zHIwEn.js";import"./Slider-Ds2-YWnr.js";import"./useMobilePicker-DYjW38Nt.js";import"./Chip-CkrZDxnY.js";import"./SelectSetting-48LUn2iX.js";import"./Select-D8FEiwW7.js";import"./FilterList-BU23g8va.js";import"./Switch-DZXnjGvA.js";import"./MangaGrid-BelB44FL.js";import"./Delete-1cwdsCH_.js";import"./Download-Bd4eVTbT.js";import"./Sync-DYhDQMst.js";import"./use-merged-ref-Dg2Oxsao.js";import"./ListCardAvatar-BTl3PnGb.js";import"./PlayArrow-CRqdKdDE.js";import"./StyledFab-BuSqQPX7.js";import"./useAppTitle-_3PqlVnx.js";import"./useAppAction-D6rZfZp7.js";const re=(i,d)=>i.displayName.localeCompare(d.displayName),se=(i,d,e)=>{const s=e.get(i.id),o=e.get(d.id),g=!(s!=null&&s.isLoading),a=!!(s!=null&&s.error),u=!(s!=null&&s.hasResults)&&!a,f=!(o!=null&&o.isLoading),t=!!(o!=null&&o.error),h=!(o!=null&&o.hasResults)&&!t;return g&&!f?-1:!g&&f||u&&!h?1:h&&!u||!a&&t?-1:a&&!t?1:0},oe=1e3,te=D.memo(({source:i,onSearchRequestFinished:d,searchString:e,emptyQuery:s,mode:o})=>{var E,n;const{t:g}=P(),{id:a,displayName:u,lang:f}=i,t=c.useRef(e),h=c.useRef(()=>{});t.current!==e&&(t.current=e,h.current(new Error("SourceSearchPreview(".concat(a,", ").concat(u,"): search string changed"))));const[j,S]=T.useSourceSearch(a,e!=null?e:"",void 0,1,{skipRequest:!e,addAbortSignal:!0}),{data:x,isLoading:m,error:p,abortRequest:b}=S[0];h.current=b;const y=(n=(E=x==null?void 0:x.fetchSourceManga)==null?void 0:E.mangas)!=null?n:[],L=!p&&!m&&!y.length;c.useEffect(()=>{d(i,{isLoading:m,hasResults:!L,emptySearch:!e,error:p})},[m,L,e,p]);let l;return p?l=g("search.error.label.source_search_failed"):L&&(l=g("manga.error.label.no_mangas_found")),!m&&!e||s?null:r.jsxs(r.Fragment,{children:[r.jsx(Z,{sx:{mb:1},children:r.jsxs(ee,{component:O,to:"".concat(I.sources.childRoutes.browse.path(a),"?query=").concat(e),sx:{p:3},children:[r.jsx(A,{variant:"h5",children:u}),r.jsx(A,{variant:"caption",children:J(f)})]})}),l?r.jsx(Q,{sx:{alignItems:"start",height:void 0},noFaces:!0,message:l,messageExtra:q(p),retry:p?()=>j(1).catch(N("SourceSearchPreview(".concat(i.id,")::refetch"))):void 0}):r.jsx(U,{gridWrapperProps:{sx:{px:0}},mangas:y,isLoading:m,hasNextPage:!1,loadMore:()=>{},horizontal:!0,noFaces:!0,message:l,inLibraryIndicator:!0,mode:o})]})}),Xe=()=>{const{t:i}=P(),{pathname:d,state:e}=k(),s=d.startsWith("/migrate/source"),[o]=V("query",W),g=v(o,oe),[a,u]=B("shownSourceLangs",$()),{settings:{showNsfw:f}}=G(),{data:t,loading:h,error:M,refetch:j}=T.useGetSourceList({notifyOnNetworkStatusChange:!0}),S=c.useMemo(()=>{var n;return(n=t==null?void 0:t.sources.nodes)!=null?n:[]},[t==null?void 0:t.sources.nodes]),x=c.useMemo(()=>_.filter(S,{showNsfw:f,languages:a,keepLocalSource:!0}),[S,a]),m=c.useMemo(()=>[...x].toSorted(re),[x]),[p,b]=c.useState(new Map),y=v(p,500),L=c.useMemo(()=>_.getLanguages(S),[S]),l=c.useMemo(()=>[...m].sort((n,R)=>se(n,R,y)),[m,y]),E=c.useCallback(({id:n},R)=>{b(F=>{const w=new Map(F);return w.set(n,R),w})},[b]);return Y(i(s?"migrate.search.title":"search.title.global_search",{title:e==null?void 0:e.mangaTitle}),r.jsxs(r.Fragment,{children:[r.jsx(z,{isClosable:!1}),r.jsx(K,{selectedLanguages:a,setSelectedLanguages:u,languages:L})]}),[a,u,L]),h?r.jsx(H,{}):M?r.jsx(X,{message:i("global.error.label.failed_to_load_data"),messageExtra:q(M),retry:()=>j().catch(N())}):r.jsx(C,{sx:{p:1},children:l.map((n,R)=>r.jsx(C,{sx:{pb:R+1!==l.length?2:0},children:r.jsx(te,{source:n,onSearchRequestFinished:E,searchString:g,emptyQuery:!o,mode:s?"migrate.select":"source"})},n.id))})};export{Xe as SearchAll};
