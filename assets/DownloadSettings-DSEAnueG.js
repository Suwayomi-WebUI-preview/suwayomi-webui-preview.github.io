import{u as f,j as a,x as p,aF as r,as as i,Q as y,m as D,g as m,r as x,b4 as M,d as U,h as R,i as C,s as P}from"./index-Cfd-5nyg.js";import{T as V}from"./TextSetting-BhtQVQuE.js";import{N as k}from"./NumberSetting-CQ3rnPU5.js";import{u as W,g as z}from"./usePersistedValue-CouD95Z_.js";import{S as h}from"./Switch-DHtiVn2y.js";import{S as O}from"./SelectSetting-DlLz_9BF.js";import{a as G}from"./CategoriesInclusionSetting-C1I6XvEM.js";import{E as H}from"./EmptyViewAbsoluteCentered-8D4RyaYH.js";import{u as F}from"./useAppTitle-JdwpcA6x.js";import{L as j}from"./ListSubheader-CXIcLSjK.js";import"./PasswordTextField-DUPo4EIi.js";import"./TextField-Rw_QvELF.js";import"./useFormControl-D7IcDija.js";import"./formControlState-Dq1zat_P.js";import"./InputAdornment-utNmnW-6.js";import"./Slider-Bd1m61Uf.js";import"./SwitchBase-DJ3Ol6Xe.js";import"./Select-Do7H45IH.js";import"./ThreeStateCheckboxInput-SRKZKj89.js";import"./Checkbox-DCwwhdBB.js";const N=2,q=10,v=N,B=({downloadAheadLimit:e})=>{const{t:d}=f(),s=!!e,[l,c]=W("lastDownloadAheadLimit",v,e,z),u=n=>{c(n===0?l:n),y("downloadAheadLimit",n).catch(_=>D(d("global.error.label.failed_to_save_changes"),"error",m(_)))},w=n=>{u(n?l:0)};return a.jsxs(p,{children:[a.jsxs(r,{children:[a.jsx(i,{primary:d("download.settings.download_ahead.label.while_reading")}),a.jsx(h,{edge:"end",checked:s,onChange:n=>w(n.target.checked)})]}),a.jsx(k,{settingTitle:d("download.settings.download_ahead.label.unread_chapters_to_download"),settingValue:d("download.settings.download_ahead.label.value",{chapters:l,count:l}),value:l,minValue:N,maxValue:q,defaultValue:v,showSlider:!0,dialogDescription:d("download.settings.download_ahead.label.description"),dialogDisclaimer:d("download.settings.download_ahead.label.disclaimer"),valueUnit:d("chapter.title_one"),handleUpdate:u,disabled:!s})]})},K=[0,1,2,3,4,5],Q={0:{text:"global.label.disabled"},1:{text:"download.settings.delete_chapters.while_reading.option.label.first"},2:{text:"download.settings.delete_chapters.while_reading.option.label.second"},3:{text:"download.settings.delete_chapters.while_reading.option.label.third"},4:{text:"download.settings.delete_chapters.while_reading.option.label.fourth"},5:{text:"download.settings.delete_chapters.while_reading.option.label.fifth"}},X=K.map(e=>[e,Q[e]]),Y=e=>typeof e=="boolean"?Number(e):e,J=({chapterToDelete:e,handleChange:d})=>{const{t:s}=f(),l=Y(e);return a.jsx(O,{settingName:s("download.settings.delete_chapters.while_reading.label.title"),value:l,values:X,handleChange:d})},Z=e=>({downloadAsCbz:e.downloadAsCbz,downloadsPath:e.downloadsPath,autoDownloadNewChapters:e.autoDownloadNewChapters,autoDownloadNewChaptersLimit:e.autoDownloadNewChaptersLimit,excludeEntryWithUnreadChapters:e.excludeEntryWithUnreadChapters,autoDownloadIgnoreReUploads:e.autoDownloadIgnoreReUploads}),xe=()=>{var S,T,L;const{t:e}=f();F(e("download.title.download"));const d=x.useGetCategories(M),s=x.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[l]=x.useUpdateServerSettings(),{settings:c,loading:u,request:{error:w,refetch:n}}=U();if(s.loading||u||d.loading)return a.jsx(R,{});const E=(T=(S=s.error)!=null?S:w)!=null?T:d.error;if(E)return a.jsx(H,{message:e("global.error.label.failed_to_load_data"),messageExtra:m(E),retry:()=>{s.error&&s.refetch().catch(C()),w&&n().catch(C()),d.error&&d.refetch().catch(C())}});const t=Z(s.data.settings),g=(o,A)=>{l({variables:{input:{settings:{[o]:A}}}}).catch(I=>D(e("global.error.label.failed_to_save_changes"),"error",m(I)))},b=P(o=>D(e("global.error.label.failed_to_save_changes"),"error",m(o)));return a.jsxs(p,{sx:{pt:0},children:[a.jsx(V,{settingName:e("download.settings.download_path.label.title"),dialogDescription:e("download.settings.download_path.label.description"),value:t==null?void 0:t.downloadsPath,settingDescription:t!=null&&t.downloadsPath.length?t.downloadsPath:e("global.label.default"),handleChange:o=>g("downloadsPath",o)}),a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.file_type.label.cbz")}),a.jsx(h,{edge:"end",checked:!!(t!=null&&t.downloadAsCbz),onChange:o=>g("downloadAsCbz",o.target.checked)})]}),a.jsxs(p,{subheader:a.jsx(j,{component:"div",id:"download-settings-auto-delete-downloads",children:e("download.settings.delete_chapters.title")}),children:[a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.delete_chapters.label.manually_marked_as_read")}),a.jsx(h,{edge:"end",checked:c.deleteChaptersManuallyMarkedRead,onChange:o=>b("deleteChaptersManuallyMarkedRead",o.target.checked)})]}),a.jsx(J,{chapterToDelete:c.deleteChaptersWhileReading,handleChange:o=>b("deleteChaptersWhileReading",o)}),a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.delete_chapters.label.allow_deletion_of_bookmarked")}),a.jsx(h,{edge:"end",checked:c.deleteChaptersWithBookmark,onChange:o=>b("deleteChaptersWithBookmark",o.target.checked)})]})]}),a.jsxs(p,{subheader:a.jsx(j,{component:"div",id:"download-settings-auto-download",children:e("download.settings.auto_download.title")}),children:[a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.auto_download.label.new_chapters")}),a.jsx(h,{edge:"end",checked:!!(t!=null&&t.autoDownloadNewChapters),onChange:o=>g("autoDownloadNewChapters",o.target.checked)})]}),a.jsx(k,{disabled:!(t!=null&&t.autoDownloadNewChapters),settingTitle:e("download.settings.auto_download.download_limit.label.title"),dialogDescription:e("download.settings.auto_download.download_limit.label.description"),value:(L=t==null?void 0:t.autoDownloadNewChaptersLimit)!=null?L:0,settingValue:t.autoDownloadNewChaptersLimit?e("download.settings.download_ahead.label.value",{chapters:t.autoDownloadNewChaptersLimit,count:t.autoDownloadNewChaptersLimit}):e("global.label.none"),defaultValue:0,minValue:0,maxValue:20,showSlider:!0,valueUnit:e("chapter.title_one"),handleUpdate:o=>g("autoDownloadNewChaptersLimit",o)}),a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.auto_download.label.ignore_with_unread_chapters")}),a.jsx(h,{edge:"end",checked:!!(t!=null&&t.excludeEntryWithUnreadChapters),onChange:o=>g("excludeEntryWithUnreadChapters",o.target.checked),disabled:!(t!=null&&t.autoDownloadNewChapters)})]}),a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.auto_download.label.ignore_re_uploads")}),a.jsx(h,{edge:"end",checked:!!(t!=null&&t.autoDownloadIgnoreReUploads),onChange:o=>g("autoDownloadIgnoreReUploads",o.target.checked),disabled:!(t!=null&&t.autoDownloadNewChapters)})]}),a.jsx(G,{categories:d.data.categories.nodes,includeField:"includeInDownload",dialogText:e("download.settings.auto_download.categories.label.include_in_download")})]}),a.jsx(p,{subheader:a.jsx(j,{component:"div",id:"download-settings-download-ahead",children:e("download.settings.download_ahead.title")}),children:a.jsx(B,{downloadAheadLimit:c.downloadAheadLimit})})]})};export{xe as DownloadSettings};
