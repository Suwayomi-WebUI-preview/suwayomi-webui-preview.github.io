import{u as A,d as b,o as y,c,N as C,j as t,P as D,I as T,y as E,b5 as B,F as G,z as I,Q as _,a as w,bC as S,g as O,E as P,h as F,B as L}from"./index-B1ngPwIB.js";import{G as k}from"./GridLayouts-DHbzCiXX.js";import{C as N}from"./CheckboxInput-1RRsy7uH.js";import{b as z}from"./MangaGrid-Dh-R7oO0.js";import{S as H,a as M}from"./StyledGroupHeader-CEy2RoNN.js";import{B as V}from"./BaseMangaGrid-B9WXZ_Yh.js";import"./ViewModule-Cf8BIYqd.js";import"./Checkbox-CFe8Nkga.js";import"./TextField-BQllUdKJ.js";import"./SwitchBase-BSFfQaIY.js";import"./ListPreference-rkZrVGh8.js";import"./index-BPDEUacc.js";import"./useManageMangaLibraryState-COetvYuo.js";import"./Trackers-D4pSmk7a.js";import"./TypographyMaxLines-CsEWrP6u.js";import"./Avatar-DD-HWnBR.js";import"./Info-CeA1cPGf.js";import"./InputAdornment-CrIqFqFu.js";import"./SpinnerImage-BL7qbj--.js";import"./Collapse-D2EyMrfT.js";import"./Link-UDob-JM_.js";import"./NumberSetting-BYyVv3Vd.js";import"./useMobilePicker-BAxde9pz.js";import"./Chip-Bg3sI2O6.js";import"./SelectSetting-clKPw1QM.js";import"./Select-DDNLiS8H.js";import"./Mangas-Dk36rEXp.js";import"./Chapters-CHWW0AEE.js";import"./ThreeStateCheckboxInput-1qUHi6RY.js";import"./Delete-DLuTETjf.js";import"./Sync-DW_0-FqI.js";import"./PlayArrow-BSDyk3q9.js";import"./StyledFab-BHlFj9La.js";const q=a=>{const r=Object.groupBy(a,({title:i})=>i.toLowerCase().trim());return Object.fromEntries(Object.entries(r).filter(i=>{var e,o;return((o=(e=i[1])==null?void 0:e.length)!=null?o:0)>1}).map(([,i])=>[i[0].title,i]))},Q=a=>{const r={},i={};return a.forEach(e=>a.forEach(o=>{var u,p,f;if(!(e.id!==o.id))return;const d=e.title.toLowerCase().trim(),n=o.title.toLowerCase().trim()===d,h=!!((u=o.description)!=null&&u.toLowerCase().trim().includes(d));!(n||h)||(!r[e.id]&&(r[e.id]=!0,i[e.title]=[...(p=i[e.title])!=null?p:[],e]),r[o.id])||(r[o.id]=!0,i[e.title]=[...(f=i[e.title])!=null?f:[],o])})),i},At=()=>{const{t:a}=A(),[r,i]=b("libraryDuplicatesGridLayout",y.List),[e,o]=b("libraryDuplicatesCheckAlternativeTitles",!1),{setTitle:g,setAction:d}=c.useContext(C);c.useEffect(()=>(g(a("library.settings.advanced.duplicates.label.title")),d(t.jsxs(t.Fragment,{children:[t.jsx(k,{gridLayout:r,onChange:i}),t.jsx(D,{variant:"popover",popupId:"library-dupliactes-settings",children:s=>t.jsxs(t.Fragment,{children:[t.jsx(T,{...E(s),children:t.jsx(B,{})}),t.jsx(G,{...I(s),children:t.jsx(_,{children:t.jsx(N,{label:a("library.settings.advanced.duplicates.settings.label.check_description"),checked:e,onChange:(m,v)=>o(v)})})})]})})]})),()=>{g(""),d(null)}),[a,r,e]);const{data:n,loading:h,error:x,refetch:j}=w.useGetMangas(S,{condition:{inLibrary:!0}}),l=c.useMemo(()=>{var m;const s=(m=n==null?void 0:n.mangas.nodes)!=null?m:[];return e?Q(s):q(s)},[n==null?void 0:n.mangas.nodes,e]),u=c.useMemo(()=>Object.keys(l),[l]),p=c.useMemo(()=>Object.values(l).flat(),[l]),f=c.useMemo(()=>Object.values(l).map(s=>s.length),[l]);return h?t.jsx(O,{}):x?t.jsx(P,{message:a("global.error.label.failed_to_load_data"),messageExtra:x.message,retry:()=>j().catch(F())}):r===y.List?t.jsx(H,{style:{height:"undefined"},groupCounts:f,groupContent:s=>t.jsx(M,{variant:"h5",isFirstItem:s===0,children:u[s]}),itemContent:s=>t.jsx(L,{sx:{px:1,pb:1},children:t.jsx(z,{manga:p[s],gridLayout:r,selected:null,mode:"duplicate"})},p[s].id)}):u.map((s,m)=>t.jsxs(L,{children:[t.jsx(M,{sx:{pt:m===0?void 0:0,pb:0},variant:"h5",isFirstItem:!1,children:s}),t.jsx(V,{mangas:l[s],hasNextPage:!1,loadMore:()=>{},isLoading:!1,gridLayout:r,inLibraryIndicator:!1,horizontal:!0,mode:"duplicate"})]},s))};export{At as LibraryDuplicates};
