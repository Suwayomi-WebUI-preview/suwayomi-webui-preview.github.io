import{r as He,i as Ge,j as r,u as J,p as Ne,c as j,K as Ye,aA as Ze,aB as Xe,g as De,az as Ie,h as _e,S as w,T as pe,c9 as et,b5 as tt,aC as rt,b as ie,m as y,bj as Oe,Q as Ee,z as nt,f as X,O as Me,s as st,B as W,ca as Le,cb as at,bE as it,cc as ot,cd as ct,I as me,ce as lt,cf as dt,M as ut,cg as _,N as ht,d as pt,k as fe,aO as ge,as as ne,_ as se,Y as q,ch as Ce}from"./index-p7rUbK5Y.js";import{S as xe}from"./Select-BTC9RK4Y.js";import{N as mt}from"./NumberSetting-zodT6b7M.js";import{b as ft}from"./language-D0g-NESR.js";import{T as gt}from"./Trans-DB_WrgRB.js";import{L as Be}from"./Link-CKsWdHb5.js";import{T as be}from"./TextField-BTlJENdf.js";import{T as We}from"./TypographyMaxLines-C_6Hb6IX.js";import{d as Ct}from"./CheckCircle-DTdToV4u.js";import{d as xt}from"./Delete-C1A6sCmR.js";import{d as bt}from"./Edit-BOnr23MK.js";import{C as jt}from"./Card-CPUXOJW4.js";import{C as At}from"./CardActionArea-C62UTgtC.js";import{S as wt}from"./Switch-BX-GGKps.js";import"./Info-CX2f_fUB.js";import"./InputAdornment-D3DuBd-a.js";import"./SwitchBase-DsteFV8K.js";var ce={},Tt=Ge;Object.defineProperty(ce,"__esModule",{value:!0});var Re=ce.default=void 0,vt=Tt(He()),St=r;Re=ce.default=(0,vt.default)((0,St.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle");class B extends Error{constructor(t,n){super(t+" at position "+n),this.position=n}}const H=92,ae=47,yt=42,je=123,G=125,Ae=91,Y=93,kt=40,Nt=41,Dt=32,le=10,Pe=9,Fe=13,It=8,_t=12,te=34,we=43,Te=45,Qe=39,Ve=48,Ue=57,O=44,Z=46,Ot=58,Et=59,Mt=65,Lt=97,Bt=69,Wt=101,Rt=70,Pt=102,Ft=160,Qt=8192,Vt=8202,Ut=8239,Kt=8287,zt=12288,Jt=8220,$t=8221,qt=8216,Ht=8217,Gt=96,Yt=180;function Zt(e){return e>=Ve&&e<=Ue||e>=Mt&&e<=Rt||e>=Lt&&e<=Pt}function E(e){return e>=Ve&&e<=Ue}function Xt(e){return e>=32&&e<=1114111}function R(e){return er.test(e)}const er=/^[,:[\]/{}()\n+]$/;function tr(e){return R(e)&&e!=="/"}function ve(e){return rr.test(e)||e&&ee(e.charCodeAt(0))}const rr=/^[[{\w-]$/;function nr(e){return e===le||e===Fe||e===Pe||e===It||e===_t}function P(e){return e===Dt||e===le||e===Pe||e===Fe}function sr(e){return e===Ft||e>=Qt&&e<=Vt||e===Ut||e===Kt||e===zt}function ee(e){return Ke(e)||oe(e)}function Ke(e){return e===te||e===Jt||e===$t}function Se(e){return e===te}function oe(e){return e===Qe||e===qt||e===Ht||e===Gt||e===Yt}function ye(e){return e===Qe}function K(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=e.lastIndexOf(t);return i!==-1?e.substring(0,i)+(n?"":e.substring(i+1)):e}function A(e,t){let n=e.length;if(!P(e.charCodeAt(n-1)))return e+t;for(;P(e.charCodeAt(n-1));)n--;return e.substring(0,n)+t+e.substring(n)}function ar(e,t,n){return e.substring(0,t)+e.substring(t+n)}function ir(e){return/[,\n][ \t\r]*$/.test(e)}function or(e){return/^\w+$/.test(e)}const cr={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},lr={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"};function dr(e){let t=0,n="";p()||Je();const m=c(O);for(m&&o(),ve(e[t])&&ir(n)?(m||(n=A(n,",")),F()):m&&(n=K(n,","));e.charCodeAt(t)===G||e.charCodeAt(t)===Y;)t++,o();if(t>=e.length)return n;ue();function p(){o();const s=v()||g()||S()||re()||b()||k();return o(),s}function o(){const s=t;let a=l();do a=x(),a&&(a=l());while(a);return t>s}function l(){let s="",a;for(;(a=P(e.charCodeAt(t)))||sr(e.charCodeAt(t));)a?s+=e[t]:s+=" ",t++;return s.length>0?(n+=s,!0):!1}function x(){if(e.charCodeAt(t)===ae&&e.charCodeAt(t+1)===yt){for(;t<e.length&&!ur(e,t);)t++;return t+=2,!0}if(e.charCodeAt(t)===ae&&e.charCodeAt(t+1)===ae){for(;t<e.length&&e.charCodeAt(t)!==le;)t++;return!0}return!1}function c(s){return e.charCodeAt(t)===s?(n+=e[t],t++,!0):!1}function u(s){return e.charCodeAt(t)===s?(t++,!0):!1}function h(){return u(H)}function M(){return o(),e.charCodeAt(t)===Z&&e.charCodeAt(t+1)===Z&&e.charCodeAt(t+2)===Z?(t+=3,o(),u(O),!0):!1}function v(){if(e.charCodeAt(t)===je){n+="{",t++,o(),u(O)&&o();let s=!0;for(;t<e.length&&e.charCodeAt(t)!==G;){let a;if(s?(a=!0,s=!1):(a=c(O),a||(n=A(n,",")),o()),M(),!(S()||k())){e.charCodeAt(t)===G||e.charCodeAt(t)===je||e.charCodeAt(t)===Y||e.charCodeAt(t)===Ae||e[t]===void 0?n=K(n,","):$e();break}o();const V=c(Ot),L=t>=e.length;V||(ve(e[t])||L?n=A(n,":"):he()),p()||(V||L?n+="null":he())}return e.charCodeAt(t)===G?(n+="}",t++):n=A(n,"}"),!0}return!1}function g(){if(e.charCodeAt(t)===Ae){n+="[",t++,o(),u(O)&&o();let s=!0;for(;t<e.length&&e.charCodeAt(t)!==Y;)if(s?s=!1:c(O)||(n=A(n,",")),M(),!p()){n=K(n,",");break}return e.charCodeAt(t)===Y?(n+="]",t++):n=A(n,"]"),!0}return!1}function F(){let s=!0,a=!0;for(;a;)s?s=!1:c(O)||(n=A(n,",")),a=p();a||(n=K(n,",")),n="[\n".concat(n,"\n]")}function S(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=e.charCodeAt(t)===H;if(a&&(t++,a=!0),ee(e.charCodeAt(t))){const D=Se(e.charCodeAt(t))?Se:ye(e.charCodeAt(t))?ye:oe(e.charCodeAt(t))?oe:Ke,V=t,L=n.length;let d='"';for(t++;;){if(t>=e.length){const f=T(t-1);return!s&&R(e.charAt(f))?(t=V,n=n.substring(0,L),S(!0)):(d=A(d,'"'),n+=d,!0)}else if(D(e.charCodeAt(t))){const f=t,I=d.length;if(d+='"',t++,n+=d,o(),s||t>=e.length||R(e.charAt(t))||ee(e.charCodeAt(t))||E(e.charCodeAt(t)))return $(),!0;if(R(e.charAt(T(f-1))))return t=V,n=n.substring(0,L),S(!0);n=n.substring(0,L),t=f+1,d=d.substring(0,I)+"\\"+d.substring(I)}else{if(s&&R(e[t]))return d=A(d,'"'),n+=d,$(),!0;if(e.charCodeAt(t)===H){const f=e.charAt(t+1);if(lr[f]!==void 0)d+=e.slice(t,t+2),t+=2;else if(f==="u"){let U=2;for(;U<6&&Zt(e.charCodeAt(t+U));)U++;U===6?(d+=e.slice(t,t+6),t+=6):t+U>=e.length?t=e.length:qe()}else d+=f,t+=2}else{const f=e.charAt(t),I=e.charCodeAt(t);I===te&&e.charCodeAt(t-1)!==H?(d+="\\"+f,t++):nr(I)?(d+=cr[f],t++):(Xt(I)||de(f),d+=f,t++)}}a&&h()}}return!1}function $(){let s=!1;for(o();e.charCodeAt(t)===we;){s=!0,t++,o(),n=K(n,'"',!0);const a=n.length;S()?n=ar(n,a,1):n=A(n,'"')}return s}function re(){const s=t;if(e.charCodeAt(t)===Te){if(t++,N())return Q(s),!0;if(!E(e.charCodeAt(t)))return t=s,!1}for(;E(e.charCodeAt(t));)t++;if(e.charCodeAt(t)===Z){if(t++,N())return Q(s),!0;if(!E(e.charCodeAt(t)))return t=s,!1;for(;E(e.charCodeAt(t));)t++}if(e.charCodeAt(t)===Wt||e.charCodeAt(t)===Bt){if(t++,(e.charCodeAt(t)===Te||e.charCodeAt(t)===we)&&t++,N())return Q(s),!0;if(!E(e.charCodeAt(t)))return t=s,!1;for(;E(e.charCodeAt(t));)t++}if(!N())return t=s,!1;if(t>s){const a=e.slice(s,t),D=/^0\d/.test(a);return n+=D?'"'.concat(a,'"'):a,!0}return!1}function b(){return C("true","true")||C("false","false")||C("null","null")||C("True","true")||C("False","false")||C("None","null")}function C(s,a){return e.slice(t,t+s.length)===s?(n+=a,t+=s.length,!0):!1}function k(){const s=t;for(;t<e.length&&!tr(e[t])&&!ee(e.charCodeAt(t));)t++;if(t>s){if(e.charCodeAt(t)===kt&&or(e.slice(s,t).trim()))return t++,p(),e.charCodeAt(t)===Nt&&(t++,e.charCodeAt(t)===Et&&t++),!0;{for(;P(e.charCodeAt(t-1))&&t>0;)t--;const a=e.slice(s,t);return n+=a==="undefined"?"null":JSON.stringify(a),e.charCodeAt(t)===te&&t++,!0}}}function T(s){let a=s;for(;a>0&&P(e.charCodeAt(a));)a--;return a}function N(){return t>=e.length||R(e[t])||P(e.charCodeAt(t))}function Q(s){n+=e.slice(s,t)+"0"}function de(s){throw new B("Invalid character "+JSON.stringify(s),t)}function ue(){throw new B("Unexpected character "+JSON.stringify(e[t]),t)}function Je(){throw new B("Unexpected end of json string",e.length)}function $e(){throw new B("Object key expected",t)}function he(){throw new B("Colon expected",t)}function qe(){const s=e.slice(t,t+6);throw new B('Invalid unicode character "'.concat(s,'"'),t)}}function ur(e,t){return e[t]==="*"&&e[t+1]==="/"}const hr={id:"",isCustom:!0,getName:()=>"",muiTheme:{palette:{primary:{main:"#1976d2"},secondary:{main:"#9c27b0"}}}},z={create:{title:"settings.appearance.theme.create.title",button:"global.button.ok",action:"settings.appearance.theme.create.action",success:"settings.appearance.theme.create.success",failure:"settings.appearance.theme.create.failure"},edit:{title:"settings.appearance.theme.edit.title",button:"global.button.save",action:"settings.appearance.theme.edit.action",success:"settings.appearance.theme.edit.success",failure:"settings.appearance.theme.edit.failure"}},ze=({bindDialogProps:e,mode:t,appTheme:n=hr})=>{const{t:i}=J(),{settings:{customThemes:m},request:{loading:p,error:o,refetch:l}}=Ne(),x=Oe(b=>{throw b}),[c,u]=j.useState(n),[h,M]=j.useState(!1),[v,g]=j.useState(!1),[F,S]=j.useState(!1),[$,re]=j.useState(t==="create");return r.jsxs(Ye,{...e,fullWidth:!0,maxWidth:"md",children:[r.jsx(Ze,{children:i(z[t].title)}),r.jsxs(Xe,{children:[p&&r.jsx(De,{}),o&&r.jsx(Ie,{message:i("global.error.label.failed_to_load_data"),messageExtra:o.message,retry:()=>l().catch(_e())}),!o&&r.jsxs(w,{sx:{gap:2},children:[r.jsx(pe,{children:r.jsxs(gt,{i18nKey:"settings.appearance.theme.create.dialog.info.creating_theme",children:["Create a custom theme with the"," ",r.jsx(Be,{href:"https://zenoo.github.io/mui-theme-creator/",target:"_blank",rel:"noreferrer",children:"MUI Theme Creator"})," ",', copy everything after "themeOptions" from "',"{",'" to "',"}",'" and paste it into the "theme" text field.']})}),r.jsx(pe,{children:i("settings.appearance.theme.create.dialog.info.theme_mode_lock")}),r.jsx(be,{disabled:t==="edit",label:i("settings.appearance.theme.create.dialog.theme_name"),value:c.getName(),error:h,helperText:h&&i("settings.appearance.theme.create.dialog.error.invalid_name"),onChange:b=>{const C=b.target.value.trim(),k=C.length<=16,T=et(C,m);M(!k||!T),u({...c,id:b.target.value,getName:()=>b.target.value})}}),r.jsx(be,{label:i("settings.appearance.theme.title"),multiline:!0,error:v,helperText:v&&i("settings.appearance.theme.create.dialog.error.invalid_json"),defaultValue:JSON.stringify(c.muiTheme,null,2),onChange:b=>{const C="invalid",k=(()=>{try{return dr(b.target.value)}catch(ue){return C}})(),T=tt(k),N=k===C||!T,Q=JSON.stringify(T)!==JSON.stringify(n.muiTheme);re(t==="create"?!0:Q),g(N),!N&&JSON.stringify(T)!==JSON.stringify(c.muiTheme)&&u({...c,muiTheme:T})}})]})]}),r.jsxs(rt,{children:[r.jsx(ie,{autoFocus:!0,onClick:e.onClose,color:"primary",children:i("global.button.cancel")}),r.jsx(ie,{disabled:v||h||F||!$||!c.id.length,onClick:b=>{y(i(z[t].action,{theme:c.getName()}),"info"),S(!0),x("customThemes",{...m,[c.id]:c}).then(()=>{y(i(z[t].success,{theme:c.getName()}),"success"),e.onClose(b)}).catch(()=>y(i(z[t].failure,{theme:c.getName()}),"error")).finally(()=>S(!1))},color:"primary",children:i(z[t].button)})]})]})},pr=()=>{const{t:e}=J(),t=Ee({variant:"popover",popupId:"theme-creation-dialog"});return r.jsxs(r.Fragment,{children:[r.jsxs(w,{sx:{alignItems:"center",gap:1,minWidth:"150px",maxWidth:"150px"},children:[r.jsx(ie,{sx:{width:"100%",height:"225px"},variant:"contained",size:"large",...nt(t),children:r.jsx(Re,{fontSize:"large"})}),r.jsx(X,{title:e("settings.appearance.theme.create.title"),placement:"top",children:r.jsx(We,{sx:{maxWidth:"100%"},children:e("settings.appearance.theme.create.title")})})]}),t.isOpen&&r.jsx(ze,{bindDialogProps:Me(t),mode:"create"})]})},ke=st(W)(()=>({width:"15px",height:"20px"})),mr=({theme:e,onDelete:t})=>{const{getName:n}=e,{t:i}=J(),{themeMode:m,setAppTheme:p,appTheme:o,pureBlackMode:l}=j.useContext(Le),x=Ee({variant:"popover",popupId:"theme-edit-dialog-".concat(e.id)}),c=e.id===o,u=j.useMemo(()=>at(m,e,l),[e,m,l]);return r.jsxs(r.Fragment,{children:[r.jsxs(w,{sx:{justifyContent:"center",alignItems:"center",minWidth:"150px",maxWidth:"150px",gap:1},children:[r.jsx(it,{theme:u,children:r.jsxs(jt,{sx:{width:"100%",height:"225px",position:"relative"},children:[r.jsx(W,{sx:{position:"absolute",top:0,right:0,bottom:0,left:0,border:"4px solid",borderColor:c?u.palette.primary.light:u.palette.background.paper,zIndex:1,pointerEvents:"none",borderRadius:1}}),r.jsx(At,{sx:{height:"100%",backgroundColor:"background.default"},onClick:()=>{if(!ot(e.muiTheme)){p(e.id);return}y(i("settings.appearance.theme.select.fonts.loading"),"info"),ct(e.muiTheme).then(()=>p(e.id)).catch(()=>y(i("settings.appearance.theme.select.fonts.error"),"error"))},children:r.jsxs(w,{sx:{height:"100%",m:0},children:[r.jsxs(w,{sx:{height:"100%",gap:2,p:2},children:[r.jsxs(w,{sx:{maxHeight:"20px",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[r.jsx(W,{sx:{width:"65%",height:"20px",backgroundColor:"primary.dark",borderRadius:1}}),r.jsxs(w,{sx:{height:"100%",alignItems:"center",gap:1},children:[c&&r.jsx(Ct,{sx:{visibility:c?"visible":"hidden",color:"primary.light"}}),!c&&e.isCustom&&r.jsx(me,{onClick:h=>{h.preventDefault(),h.stopPropagation(),t()},component:"div",size:"small",children:r.jsx(X,{title:i("global.button.delete"),children:r.jsx(xt,{})})}),e.isCustom&&r.jsx(me,{onClick:h=>{h.preventDefault(),h.stopPropagation(),x.open()},component:"div",size:"small",children:r.jsx(X,{title:i("global.button.edit"),children:r.jsx(bt,{})})})]})]}),r.jsx(W,{sx:{width:"55%",height:"65%",backgroundColor:"background.paper",p:1,borderRadius:1},children:r.jsxs(w,{sx:{width:"max-content",flexDirection:"row",overflow:"hidden",borderRadius:1},children:[r.jsx(ke,{sx:{backgroundColor:"primary.main"}}),r.jsx(ke,{sx:{backgroundColor:"secondary.main"}})]})})]}),r.jsxs(w,{sx:{height:"25%",backgroundColor:u.palette.background.paper,alignItems:"center",flexDirection:"row",gap:2,p:2},children:[r.jsx(W,{sx:{width:"20px",height:"20px",borderRadius:"50%",backgroundColor:"primary.main"}}),r.jsx(W,{sx:{flexGrow:1,height:"20px",borderRadius:1,backgroundColor:"primary.light"}})]})]})})]})}),r.jsx(X,{title:n(),placement:"top",children:r.jsx(We,{sx:{maxWidth:"100%"},children:n()})})]}),r.jsx(ze,{bindDialogProps:Me(x),mode:"edit",appTheme:e})]})},fr=()=>{const{t:e}=J(),{settings:{customThemes:t},request:{loading:n,error:i,refetch:m}}=Ne(),p=j.useMemo(()=>[...lt,...Object.values(t).map(l=>({...l,getName:()=>l.id}))],[t]),o=Oe(l=>{throw l});return n?r.jsx(De,{}):i?r.jsx(Ie,{message:e("global.error.label.failed_to_load_data"),messageExtra:i.message,retry:()=>m().catch(_e())}):r.jsxs(w,{sx:{flexDirection:"row",flexWrap:"no-wrap",alignItems:"start",overflowX:"auto",gap:1,mx:2},children:[r.jsx(pr,{}),p.map(l=>r.jsx(mr,{theme:l,onDelete:()=>{y(e("settings.appearance.theme.delete.action",{theme:l.getName()}),"info"),o("customThemes",Object.fromEntries(Object.entries(t).filter(([x])=>x!==l.id))).then(()=>y(e("settings.appearance.theme.delete.success",{theme:l.getName()}),"success")).catch(()=>y(e("settings.appearance.theme.delete.failure",{theme:l.getName()}),"error"))}},l.id))]})},Er=()=>{var v;const{t:e,i18n:t}=J(),{themeMode:n,setThemeMode:i,pureBlackMode:m,setPureBlackMode:p,appTheme:o}=j.useContext(Le),l=((v=dt(o).muiTheme.palette)==null?void 0:v.mode)==="dark"||ut.getThemeMode()===_.DARK,{setTitle:x,setAction:c}=j.useContext(ht);j.useEffect(()=>(x(e("settings.appearance.title")),c(null),()=>{x(""),c(null)}),[e]);const u=300,[h,M]=pt("ItemWidth",u);return r.jsxs(fe,{subheader:r.jsx(ge,{component:"div",id:"appearance-theme",children:e("settings.appearance.theme.title")}),children:[r.jsxs(ne,{children:[r.jsx(se,{primary:e("settings.appearance.theme.device_theme")}),r.jsxs(xe,{value:n,onChange:g=>i(g.target.value),children:[r.jsx(q,{value:_.SYSTEM,children:"System"},_.SYSTEM),r.jsx(q,{value:_.DARK,children:"Dark"},_.DARK),r.jsx(q,{value:_.LIGHT,children:"Light"},_.LIGHT)]})]}),r.jsx(fr,{}),l&&r.jsxs(ne,{children:[r.jsx(se,{primary:e("settings.appearance.theme.pure_black_mode")}),r.jsx(wt,{checked:m,onChange:(g,F)=>p(F)})]}),r.jsxs(fe,{subheader:r.jsx(ge,{component:"div",id:"appearance-theme",children:e("global.label.display")}),children:[r.jsxs(ne,{children:[r.jsx(se,{primary:e("global.language.label.language"),secondary:r.jsxs(r.Fragment,{children:[r.jsxs("span",{children:[e("settings.label.language_description")," "]}),r.jsx(Be,{href:"https://hosted.weblate.org/projects/suwayomi/suwayomi-webui",target:"_blank",rel:"noreferrer",children:e("global.language.title.weblate")})]})}),r.jsx(xe,{value:Ce.includes(t.language)?t.language:"en",onChange:({target:{value:g}})=>t.changeLanguage(g),children:Ce.map(g=>r.jsx(q,{value:g,children:ft(g)},g))})]}),r.jsx(mt,{settingTitle:e("settings.label.manga_item_width"),settingValue:"px: ".concat(h),value:h,defaultValue:u,minValue:100,maxValue:1e3,stepSize:10,valueUnit:"px",showSlider:!0,handleUpdate:M})]})]})};export{Er as Appearance};
