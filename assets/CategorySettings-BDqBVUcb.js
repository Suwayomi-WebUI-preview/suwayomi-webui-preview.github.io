import{u as w,j as e,o as x,T as W,S as z,C as I,I as v,r as d,a as J,e as n,b2 as Q,ae as X,g as Y,h as b,i as Z,b3 as $,D as ee,l as te,n as oe,aE as ae,B as k,m as F}from"./index-DWz4TNtd.js";import{A as re}from"./Add-83t_xa_6.js";import{D as se,a as ne,b as ie,c as le,S as ce,v as de,d as ge,e as ue}from"./DragHandle-CZXDYWzc.js";import{D as me,F as xe}from"./StyledFab-CsCAQaVn.js";import{E as he}from"./EmptyViewAbsoluteCentered-DPrnddnF.js";import{E as pe}from"./Edit-CKguvsIY.js";import{D as fe}from"./Delete-Da55i9yt.js";import{C as Ce}from"./Card-8Hlh2tNY.js";import{C as ye}from"./CardContent-CJ5i7b3K.js";import{T as je}from"./TextField-p1pWQlzT.js";import{F as De,C as be}from"./Checkbox-BBcQZP1l.js";import"./useFormControl-BeXl2Zas.js";import"./formControlState-Dq1zat_P.js";import"./SwitchBase-DdFM11Au.js";const A=({category:o,onEdit:g})=>{const{t:l}=w(),i=()=>{d.deleteCategory(o.id)};return e.jsx(x,{sx:{p:1,pb:0},children:e.jsx(Ce,{children:e.jsxs(ye,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5,"&:last-child":{paddingBottom:1.5},gap:2},children:[e.jsx(se,{}),e.jsx(W,{sx:{flexGrow:1},variant:"h6",component:"h2",children:o.name}),e.jsxs(z,{sx:{flexDirection:"row"},children:[e.jsx(I,{title:l("global.button.edit"),children:e.jsx(v,{component:x,onClick:g,children:e.jsx(pe,{})})}),e.jsx(I,{title:l("chapter.action.download.delete.label.action"),children:e.jsx(v,{component:x,onClick:i,children:e.jsx(fe,{})})})]})]})})})};function Ne(){const{t:o}=w(),{setTitle:g,setAction:l}=J();n.useLayoutEffect(()=>(g(o("category.dialog.title.edit_category_other")),l(null),()=>{g(""),l(null)}),[o]);const{data:i,loading:B,error:E,refetch:O}=d.useGetCategories(Q,{notifyOnNetworkStatusChange:!0}),r=n.useMemo(()=>{var a;const t=[...(a=i==null?void 0:i.categories.nodes)!=null?a:[]];return t.length>0&&t[0].name==="Default"&&t.shift(),t},[i]),[h,S]=n.useState(-1),[L,u]=n.useState(!1),[p,f]=n.useState(""),[C,y]=n.useState(!1),[G,{reset:N}]=d.useReorderCategory(),_=X(),R=ne.useSensorsForDevice(),[c,m]=n.useState(null),H=(t,a,s)=>{const j=t[a];G({variables:{input:{id:j.id,position:s+1}}}).catch(()=>N())},M=t=>{const{active:a,over:s}=t;if(m(null),!s||a.id===s.id)return;const j=r.findIndex(D=>D.id===a.id),V=r.findIndex(D=>D.id===s.id);H(r,j,V)},U=()=>{f(""),y(!1),S(-1)},q=()=>{U(),u(!0)},P=t=>{f(r[t].name),y(r[t].default),S(t),u(!0)},T=()=>{u(!1)},K=()=>{if(u(!1),h===-1)d.createCategory({name:p,default:C}).response.catch(t=>F(o("category.error.label.create_failure"),"error",b(t)));else{const t=r[h];d.updateCategory(t.id,{name:p,default:C}).response.catch(a=>F(o("global.error.label.failed_to_save_changes"),"error",b(a)))}};return B?e.jsx(Y,{}):E?e.jsx(he,{message:o("category.error.label.request_failure"),messageExtra:b(E),retry:()=>O().catch(Z())}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{sensors:R,collisionDetection:le,onDragStart:t=>{var a;return m((a=r.find(s=>s.id===t.active.id))!=null?a:null)},onDragEnd:M,onDragCancel:()=>m(null),onDragAbort:()=>m(null),children:e.jsxs(x,{sx:{paddingBottom:me},children:[e.jsx(ce,{items:r,strategy:de,children:r.map((t,a)=>e.jsx(ge,{id:t.id,isDragging:t.id===(c==null?void 0:c.id),children:e.jsx(A,{category:t,onEdit:()=>P(a)})},t.id))}),e.jsx(ue,{isActive:!!c,children:e.jsx(A,{category:c,onEdit:$})})]})}),e.jsx(xe,{color:"primary","aria-label":"add",style:{position:"fixed",bottom:_.spacing(2),right:_.spacing(2)},onClick:q,children:e.jsx(re,{})}),e.jsxs(ee,{open:L,onClose:T,children:[e.jsx(te,{id:"form-dialog-title",children:o(h===-1?"category.dialog.title.new_category":"category.dialog.title.edit_category_one")}),e.jsxs(oe,{children:[e.jsx(je,{autoFocus:!0,margin:"dense",id:"name",label:o("category.label.category_name"),type:"text",fullWidth:!0,value:p,onChange:t=>f(t.target.value)}),e.jsx(De,{control:e.jsx(be,{checked:C,onChange:t=>y(t.target.checked)}),label:o("category.label.use_as_default_category")})]}),e.jsxs(ae,{children:[e.jsx(k,{onClick:T,color:"primary",children:o("global.button.cancel")}),e.jsx(k,{onClick:K,color:"primary",children:o("global.button.submit")})]})]})]})}export{Ne as CategorySettings};
