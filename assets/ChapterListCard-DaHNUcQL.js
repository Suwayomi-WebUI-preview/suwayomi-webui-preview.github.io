import{c as _,j as e,u as S,r as O,ac as Q,e as J,f as B,k as X,a1 as Y,R as z,a9 as Z,b as D,aw as j,L as ee,C as E,I as te,a8 as re,ab as ae,G as $,T as oe}from"./index-BjiAJMwJ.js";import{e as se,g as h,h as ne,j as le,k as ie,D as de,R as ce,V as me,l as pe,M as he}from"./useManageMangaLibraryState-DR1E7jN2.js";import{g as xe}from"./DateHelper-IYwIdS4R.js";import{C as ue,D as ge}from"./ChapterCardMetadata-rxJVUuhC.js";import{D as ke}from"./Delete-B3ola86g.js";import{D as be}from"./Download-Cz925toA.js";import{D as Ce}from"./DoneAll-DGkuPhmc.js";import{C as s,b as Ie}from"./Chapters-CzOeaE_Y.js";import{I as fe}from"./IconWebView-CBIXAKao.js";import{M as je}from"./MUI.util-CEodEA2f.js";import{L as we}from"./ListCardContent-Cze7oEyu.js";import{C as Me}from"./Card-BYTjY99T.js";import{C as ye}from"./CardActionArea-BvyAdQFj.js";import{C as De}from"./Checkbox-C0m2Z0XZ.js";const _e=_(e.jsx("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"})),ve=_(e.jsx("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"})),Te=_(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),Re=Te,Ae=({chapter:t,handleSelection:l,canBeDownloaded:o=!1,selectedChapters:c=[],onClose:i,selectable:d=!0})=>{var P,V,N;const{t:r}=S(),m=!!t,{isDownloaded:f,isRead:p,isBookmarked:w}=t!=null?t:{},C=(N=(V=O.useGetMangaChapters(Q,(P=t==null?void 0:t.mangaId)!=null?P:-1,{skip:!t,fetchPolicy:"cache-only"}).data)==null?void 0:V.chapters.nodes)!=null?N:[],{settings:{deleteChaptersWithBookmark:M}}=J(),x=le(m,Ie),u=se(m),b=ie(m),{downloadableChapters:a,downloadedChapters:n,unbookmarkedChapters:g,bookmarkedChapters:v,unreadChapters:T,readChapters:R}=B.useMemo(()=>({downloadableChapters:s.getDownloadable(c),downloadedChapters:s.getDownloaded(c),unbookmarkedChapters:s.getNonBookmarked(c),bookmarkedChapters:s.getBookmarked(c),unreadChapters:s.getNonRead(c),readChapters:s.getRead(c)}),[c]),F=()=>{l==null||l(t.id,!0),i()},I=(L,W)=>{var H;const G=L==="mark_prev_as_read",U=G?"mark_as_read":L;if(U==="delete"&&t&&!s.isDeletable(t,M)){i();return}const y=(()=>{if(!t)return W;if(!G)return[t];const A=C.findIndex(({id:q})=>q===t.id);if(A+1>C.length-1)return[];const K=C.slice(A+1);return s.getNonRead(K)})();if(!y.length){i();return}s.performAction(U,s.getIds(y),{chapters:y,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(H=y[0])==null?void 0:H.mangaId}).catch(X()),i()};return e.jsxs(e.Fragment,{children:[m&&d&&e.jsx(h,{onClick:F,Icon:ne,title:r("chapter.action.label.select")}),m&&e.jsxs(e.Fragment,{children:[e.jsx(h,{Icon:Re,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),i()},title:r("global.button.open_browser")}),e.jsx(h,{Icon:fe,disabled:!t.realUrl,onClick:()=>{window.open(O.getWebviewUrl(t.realUrl),"_blank","noopener,noreferrer"),i()},title:r("global.button.open_webview")})]}),u(o)&&e.jsx(h,{Icon:be,disabled:b(!a.length),onClick:()=>I("download",a),title:x("download",a.length)}),u(f)&&e.jsx(h,{Icon:ke,disabled:b(!n.length),onClick:()=>I("delete",s.getDeletable(n,M)),title:x("delete",n.length)}),u(!w)&&e.jsx(h,{Icon:ve,disabled:b(!g.length),onClick:()=>I("bookmark",g),title:x("bookmark",g.length)}),u(w)&&e.jsx(h,{Icon:_e,disabled:b(!v.length),onClick:()=>I("unbookmark",v),title:x("unbookmark",v.length)}),u(!p)&&e.jsx(h,{Icon:de,disabled:b(!T.length),onClick:()=>I("mark_as_read",T),title:x("mark_as_read",T.length)}),u(p)&&e.jsx(h,{Icon:ce,disabled:b(!R.length),onClick:()=>I("mark_as_unread",R),title:x("mark_as_unread",R.length)}),m&&e.jsx(h,{onClick:()=>I("mark_prev_as_read",[]),Icon:Ce,title:r("chapter.action.mark_as_read.add.label.action.previous")})]})},Be=_(e.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"})),Se=B.memo(t=>{const{t:l}=S(),o=Y(),c=z.usePreventMobileContextMenu(),i=B.useRef(null),{mode:d="manga.page",chapter:r,showChapterNumber:m,onSelect:f,selected:p,selectable:w=!0,isActiveChapter:k=!1}=t,C=p!==null,{isDownloaded:M}=r,x=a=>{C&&(a.preventDefault(),a.stopPropagation(),f(r.id,!p,a.shiftKey))},u=(a,n)=>{a.stopPropagation(),a.preventDefault(),n==null||n(a)},b=me((a,{context:n})=>{if(!C&&i.current){u(a,()=>n==null?void 0:n(i.current));return}a.shiftKey=!0,x(a)});return e.jsx(Z,{variant:"popover",popupId:"chapter-card-action-menu",children:a=>{var n;return e.jsxs(D,{sx:{pt:1,px:1},children:[e.jsx(Me,{sx:{...j(d==="reader"&&k,{backgroundColor:"primary.main"})},children:e.jsx(ye,{component:ee,to:s.getReaderUrl(r),onContextMenu:c,sx:z.preventMobileContextMenuSx(),style:{color:o.palette.text[r.isRead?"disabled":"primary"]},state:s.getReaderOpenChapterLocationState(r,!0),replace:d==="reader",onClick:g=>x(g),...b(a.open),children:e.jsxs(we,{children:[e.jsx(ue,{title:m?"".concat(l("chapter.title_one")," ").concat(r.chapterNumber):r.name,secondaryText:r.scanlator,ternaryText:"".concat(xe(Number((n=r.uploadDate)!=null?n:0),!0)).concat(M?" â€¢ ".concat(l("chapter.status.label.downloaded")):""),infoIcons:r.isBookmarked&&e.jsx(Be,{color:d==="reader"&&k?"secondary":"primary"}),slotProps:{title:{variant:"h6",component:"h3",sx:j(d==="reader"&&k,{color:o.palette.primary.contrastText})},secondaryText:{sx:j(d==="reader"&&k,{color:o.palette.primary.contrastText})},ternaryText:{sx:j(d==="reader"&&k,{color:o.palette.primary.contrastText})}}}),e.jsx(ge,{chapterId:r.id,color:d==="reader"&&k?o.palette.primary.contrastText:void 0}),e.jsx(D,{sx:{minHeight:"48px"},children:p===null?e.jsx(E,{title:l("global.button.options"),children:e.jsx(te,{ref:i,...je.preventRippleProp(re(a),{onClick:g=>u(g)}),"aria-label":"more",sx:{color:"inherit",...j(d==="reader"&&k,{color:"primary.contrastText"})},children:e.jsx(pe,{})})}):e.jsx(E,{title:l(p?"global.button.deselect":"global.button.select"),children:e.jsx(De,{checked:p})})})]})})}),!C&&a.isOpen&&e.jsx(he,{...ae(a),children:g=>e.jsx(Ae,{onClose:g,chapter:r,handleSelection:()=>f(r.id,!0),canBeDownloaded:s.isDownloadable(r),selectable:w})})]})}})}),Pe=({missingChaptersGap:t})=>{const{t:l}=S();return e.jsxs(D,{sx:{width:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",p:2,pt:3.5,pb:2.5},children:[e.jsx($,{sx:{flexGrow:1,border:"1px solid",borderColor:o=>o.palette.text.secondary}}),e.jsx(oe,{sx:{px:2},variant:"body2",color:"textSecondary",children:l("chapter.missing",{count:t})}),e.jsx($,{sx:{flexGrow:1,border:"1px solid",borderColor:o=>o.palette.text.secondary}})]})},Xe=({index:t,isSortDesc:l,chapters:o,...c})=>{var p;const i=l?t+1:t-1,d=o[t],r=(p=o[i])!=null?p:{chapterNumber:0},m=s.getGap(d,r),f=m>0;return e.jsxs(D,{sx:j(!l,{flexDirection:"column-reverse"}),children:[e.jsx(Se,{...c,chapter:o[t]}),f&&e.jsx(Pe,{missingChaptersGap:m})]})};export{Be as B,Xe as C,Re as I,Ae as a};
