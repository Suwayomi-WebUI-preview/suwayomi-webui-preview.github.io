import{cD as bs,b as l,cE as gt,cF as Me,cy as L,j as s,i as Ht,ap as m,n as Vt,cG as qs,cH as F,cI as et,x as ze,cJ as wt,cK as Ce,cL as ye,cM as Js,cN as at,cO as Wt,S as P,w as $,T as qe,aS as Qs,cP as er,aU as tr,ca as yt,a0 as $e,ac as $t,cQ as ve,C as z,cR as Es,cS as de,H as Xe,cT as V,bK as le,cU as Ee,cV as sr,a as rr,cn as nr,cW as or,cX as ar,cY as ir,co as cr,ag as tt,cZ as qt,aV as Je,c_ as Jt,c$ as Ts,bO as ut,A as Xt,L as Ot,c as Se,u as U,bX as js,d0 as Cs,au as Rt,a4 as bt,a5 as Et,bZ as lr,al as dr,B as Qe,d1 as ur,d2 as Qt,d3 as ws,d4 as Ft,d5 as Os,d6 as gr,d7 as fr,d8 as es,d9 as Ls,da as ft,db as _e,cw as ot,dc as Ge,s as As,I as re,a1 as Ue,dd as Ut,de as ke,df as Ds,bY as hr,aB as xr,bc as pr,e as Lt,aL as mr,dg as Yt,a8 as vr,a9 as Sr,m as Is,dh as dt,di as At,af as ts,dj as Dt,dk as Rr,dl as kt,dm as br,dn as Tt,dp as Er,dq as Bs,bi as Tr,dr as Te,b1 as Pe,ds as jr,dt as je,du as Ne,dv as Cr,dw as Ps,dx as wr,dy as Or,r as Gt,dz as pt,dA as Lr,dB as Ar,f as vt,dC as Dr,dD as Ir,g as _s,dE as ys,dF as ks,dG as Br,dH as Pr,ax as Ns,dI as ss,aa as rs,dJ as _r,dK as yr,dL as lt,dM as q,dN as ns,dO as os,bf as kr,dP as St,dQ as Nr,dR as Mr,dS as as,dT as Hr,dU as Vr,d as Wr,dV as Fr,aw as Ur,dW as Gr,dX as zr,dY as $r}from"./index-uuLFyWjH.js";import{R as Xr,S as Yr,D as Kr,a as Zr,b as qr,c as Jr}from"./ReaderSettingsTabs-BzylWv7V.js";import{P as Qr}from"./PushPin-Bjr8J2PD.js";import{P as en}from"./PushPinOutlined-C7KDqXMp.js";import{L as zt}from"./Link-C2kDprXF.js";import{S as Ms}from"./Select-BNss_d9h.js";import{b as Hs,C as tn,B as sn}from"./CustomButtonIcon-BDHg4LLW.js";import{a as Vs,I as Ws,T as rn}from"./TextField-15mDkyKy.js";import{K as nn}from"./index-CPmTO8DF.js";import{I as on}from"./InputAdornment-BM3DOWOQ.js";import{O as an}from"./OpenInNew-DLGwx9Dm.js";import{D as cn}from"./Download-BoRIdzjV.js";import{D as ln}from"./Delete-CT9ozx7M.js";import{D as dn}from"./ChapterCardMetadata-DpBNY9qB.js";import{F as un}from"./Favorite-C6aZ1xaX.js";import{a as gn,F as fn,g as hn}from"./useManageMangaLibraryState-BsZvXNpP.js";import{C as xn}from"./CheckboxInput-CNhfe4XO.js";import{E as jt}from"./EmptyViewAbsoluteCentered-DhyXdnvR.js";import{u as pn}from"./use-window-event-Aw0L4SEr.js";import{u as mn}from"./use-merged-ref-C0Hj7ark.js";import{u as vn}from"./useAppTitle-DO-nxHM7.js";import"./TabsMenu-BTW2FKlF.js";import"./Tabs-DK63delJ.js";import"./Trans-YaNkPG9f.js";import"./Slider-Dz3godMk.js";import"./ListSubheader-C40ibkfJ.js";import"./Add-D7dacjba.js";import"./DoneAll-CPaoUM4v.js";import"./MUI.util-CYBuX_Wz.js";import"./ListCardContent-DmDL0s6p.js";import"./Card-BMGU0hB5.js";import"./CardActionArea-BVD5k2pE.js";import"./Checkbox-rBalqFKJ.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-C_H9sgNp.js";import"./SwitchBase-HR_UypDY.js";import"./ThreeStateCheckboxInput-lb99kLib.js";import"./FormGroup-BVSRhZNm.js";const Sn=e=>{const{activeScopes:r,enableScope:n,disableScope:o}=bs(),t=l.useRef([]);l.useEffect(()=>e?(t.current=[...r],n(gt.NONE),t.current.forEach(o),()=>{o(gt.NONE),t.current.forEach(n)}):()=>{},[e])},Rn=({isOpen:e,close:r})=>{const{manga:n}=Me(),o=L.useSettings();Sn(e);const[t,a]=l.useState(0),[d,i]=l.useState(!1);return!n||!e?null:s.jsx(Ht,{open:e,maxWidth:"md",fullWidth:!0,onClose:r,hideBackdrop:t===qs.FILTER,sx:{...m(d,{opacity:.75})},children:s.jsx(Vt,{sx:{p:0},children:s.jsx(Xr,{activeTab:t,setActiveTab:a,settings:o,updateSetting:(...c)=>L.updateSetting(n,...c),deleteSetting:(...c)=>L.deleteSetting(n,...c),setTransparent:i})})})},bn=({isDesktop:e,scrollbarXSize:r,readerNavBarWidth:n,isMaximized:o,currentPageIndex:t,pages:a,totalPages:d,progressBarType:i,shouldShowPageNumber:c,readingDirection:h})=>{const u=l.useMemo(()=>{const f=ye(t,a).name,g="/",x="".concat(f).concat(g).concat(d);return h===at.LTR?x:Js(x,g)},[t,a,d,h]);return!c||o||e&&i===Wt.STANDARD||o&&i===Wt.HIDDEN?null:s.jsx(P,{sx:{position:"fixed",left:n,right:0,bottom:f=>"max(calc(".concat(f.spacing(1)," + ").concat(r,"px), env(safe-area-inset-bottom))"),alignItems:"center",transition:f=>"left 0.".concat(f.transitions.duration.shortest,"s")},children:s.jsx($,{sx:{p:.5,borderRadius:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:s.jsx(qe,{sx:{color:"white"},children:u})})})},En=F(bn,[L.useOverlayMode,et,ze,wt,Ce,L.useSettingsWithoutDefaultFlag],["isDesktop","scrollbarXSize","readerNavBarWidth","isMaximized","currentPageIndex","pages","totalPages","progressBarType","shouldShowPageNumber","readingDirection"]);function is(e){return e.substring(2).toLowerCase()}function Tn(e,r){return r.documentElement.clientWidth<e.clientX||r.documentElement.clientHeight<e.clientY}function jn(e){const{children:r,disableReactTree:n=!1,mouseEvent:o="onClick",onClickAway:t,touchEvent:a="onTouchEnd"}=e,d=l.useRef(!1),i=l.useRef(null),c=l.useRef(!1),h=l.useRef(!1);l.useEffect(()=>(setTimeout(()=>{c.current=!0},0),()=>{c.current=!1}),[]);const u=Qs(er(r),i),f=tr(p=>{const R=h.current;h.current=!1;const S=yt(i.current);if(!c.current||!i.current||"clientX"in p&&Tn(p,S))return;if(d.current){d.current=!1;return}let C;p.composedPath?C=p.composedPath().includes(i.current):C=!S.documentElement.contains(p.target)||i.current.contains(p.target),!C&&(n||!R)&&t(p)}),g=p=>R=>{h.current=!0;const S=r.props[p];S&&S(R)},x={ref:u};return a!==!1&&(x[a]=g(a)),l.useEffect(()=>{if(a!==!1){const p=is(a),R=yt(i.current),S=()=>{d.current=!0};return R.addEventListener(p,f),R.addEventListener("touchmove",S),()=>{R.removeEventListener(p,f),R.removeEventListener("touchmove",S)}}},[f,a]),o!==!1&&(x[o]=g(o)),l.useEffect(()=>{if(o!==!1){const p=is(o),R=yt(i.current);return R.addEventListener(p,f),()=>{R.removeEventListener(p,f)}}},[f,o]),l.cloneElement(r,x)}const cs=$e(qe)({boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",textAlign:"center",userSelect:"none",cursor:"pointer"}),Cn=$e(P,{shouldForwardProp:$t(["progressBarPosition"])})(({theme:e,progressBarPosition:r})=>({position:"fixed",pointerEvents:"all",touchAction:"none",...m(ve(r).isHorizontal,{justifyContent:"flex-end",bottom:0,right:0}),...m(ve(r).isVertical,{top:0,bottom:0}),...m(ve(r).isLeft,{alignItems:e.direction==="ltr"?"flex-start":"flex-end"}),...m(ve(r).isRight,{alignItems:e.direction==="ltr"?"flex-end":"flex-start"})})),wn=$e(P)(({theme:e})=>({flexDirection:"row",justifyContent:"center",alignItems:"center",gap:e.spacing(.5)})),On=$e(P)({flexDirection:"row",flexGrow:1,overflow:"hidden"}),Ln=$e($,{shouldForwardProp:$t(["currentPagesIndex","pagesLength","progressBarPosition"])})(({currentPagesIndex:e,pagesLength:r,progressBarPosition:n})=>({position:"absolute",pointerEvents:"none",...m(ve(n).isHorizontal,{left:0,width:"".concat((e+1)/r*100,"%"),height:"100%"}),...m(ve(n).isVertical,{top:0,width:"100%",height:"".concat((e+1)/r*100,"%")})})),An=({pageName:e,currentPagesIndex:r,pagesLength:n,isDragging:o,boxProps:t,children:a,progressBarPosition:d})=>s.jsx(z,{title:e,slotProps:{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}},placement:Es[d],children:s.jsx($,{...t,sx:{position:"absolute",cursor:o?"grabbing":"grab",...m(ve(d).isHorizontal,{left:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"calc(100% / ".concat(n-1,")"),height:"100%"}),...m(ve(d).isVertical,{top:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"100%",height:"calc(100% / ".concat(n-1,")")}),...t==null?void 0:t.sx},children:a})}),Dn=$e(P)({position:"relative",flexDirection:"row",flexGrow:1}),In=l.memo($e($,{shouldForwardProp:$t(["isFirstPage","isLastPage"])})(({isFirstPage:e,isLastPage:r})=>({flexGrow:1,height:"100%",cursor:"pointer",borderLeftWidth:e?0:void 0,borderRightWidth:r?0:void 0}))),Bn=l.memo(({page:e,pagesIndex:r,isCurrentPage:n,isLeadingPage:o,isTrailingPage:t,totalPages:a,showDraggingStyle:d,primaryPageLoadState:i,secondaryPageLoadState:c,createProgressBarSlot:h,...u})=>{const f=l.useMemo(()=>h(e,r,i,c,n,o,t,a,d),[h,e,r,i,c,n,o,t,a,d]);return s.jsx(In,{...u,isFirstPage:r===0,isLastPage:r===a-1,children:f})}),Pn=({totalPages:e,pages:r,pageLoadStates:n,currentPageIndex:o,slotProps:t,slots:a,createProgressBarSlot:d,progressBarPosition:i,readingMode:c,isDragging:h,setIsDragging:u,openPage:f,direction:g,fullSegmentClicks:x})=>{var O,y,_,G,ue,k,M,W,B,ne,K,oe,Y,ee,N,Re,ae,ge,we,xe,Q,Oe,Le,pe,Ae,fe,He,De,st,Ie,Ve,ie;const p=l.useRef(null),R=l.useRef(void 0),[S,C]=l.useState(0),v=l.useRef(null);Xe(v,l.useCallback(()=>{const I=v.current;if(!I)return;const{paddingLeft:X,paddingRight:Ye}=getComputedStyle(I),We=6,Z=I.clientWidth-parseFloat(X)-parseFloat(Ye),Be=c===V.DOUBLE_PAGE?Z*2+We:Z;C(Be)},[c]));const b=l.useMemo(()=>ye(o,r).pagesIndex,[o,r]),j=ve(i).isHorizontal,E=l.useMemo(()=>ye(o,r),[o,r]),T=l.useCallback((...I)=>le(I[0],I[1],g),[g]);de.useHandleProgressDragging(f,p,h,E,r,i,T,x);const A=I=>{if(!p.current)return;const X="touches"in I;f(Ee(sr(X?I.touches[0]:I,p.current,r,j,x,T)),void 0,!1),clearTimeout(R.current),R.current=setTimeout(()=>u(!0),250)},D=()=>{u(!1),clearTimeout(R.current)};return s.jsx(Cn,{...t==null?void 0:t.container,progressBarPosition:i,children:s.jsxs(wn,{...t==null?void 0:t.progressBarRoot,children:[s.jsx(cs,{...(O=t==null?void 0:t.progressBarPageTexts)==null?void 0:O.base,...(y=t==null?void 0:t.progressBarPageTexts)==null?void 0:y.current,sx:[{width:"".concat(S,"px")},...Array.isArray((G=(_=t==null?void 0:t.progressBarPageTexts)==null?void 0:_.base)==null?void 0:G.sx)?(M=(k=(ue=t==null?void 0:t.progressBarPageTexts)==null?void 0:ue.base)==null?void 0:k.sx)!=null?M:[]:[(B=(W=t==null?void 0:t.progressBarPageTexts)==null?void 0:W.base)==null?void 0:B.sx],...Array.isArray((K=(ne=t==null?void 0:t.progressBarPageTexts)==null?void 0:ne.current)==null?void 0:K.sx)?(ee=(Y=(oe=t==null?void 0:t.progressBarPageTexts)==null?void 0:oe.current)==null?void 0:Y.sx)!=null?ee:[]:[(Re=(N=t==null?void 0:t.progressBarPageTexts)==null?void 0:N.current)==null?void 0:Re.sx]],onClick:()=>f("previous","ltr",!1),children:E.name}),s.jsx(jn,{onClickAway:()=>u(!1),children:s.jsxs(Dn,{...t==null?void 0:t.progressBarSlotsActionArea,onMouseDown:A,onMouseUp:D,onTouchStart:A,onTouchEnd:D,children:[s.jsxs(On,{ref:p,...t==null?void 0:t.progressBarSlotsContainer,children:[r.map((I,X)=>l.createElement(Bn,{...t==null?void 0:t.progressBarSlot,key:I.primary.index,page:I,pagesIndex:X,isCurrentPage:X===b,isLeadingPage:X<b,isTrailingPage:X>b,totalPages:r.length,primaryPageLoadState:n[I.primary.index].loaded,secondaryPageLoadState:I.secondary?n[I.secondary.index].loaded:void 0,createProgressBarSlot:d,showDraggingStyle:X===b&&h})),s.jsx(Ln,{...t==null?void 0:t.progressBarReadPages,currentPagesIndex:E.pagesIndex,pagesLength:r.length,progressBarPosition:i})]}),s.jsx(An,{boxProps:t==null?void 0:t.progressBarCurrentPageSlot,pageName:E.name,currentPagesIndex:E.pagesIndex,pagesLength:r.length,isDragging:h,progressBarPosition:i,children:a==null?void 0:a.progressBarCurrentPage})]})}),s.jsx(cs,{ref:v,...(ae=t==null?void 0:t.progressBarPageTexts)==null?void 0:ae.base,...(ge=t==null?void 0:t.progressBarPageTexts)==null?void 0:ge.total,sx:[{minWidth:"unset"},...Array.isArray((xe=(we=t==null?void 0:t.progressBarPageTexts)==null?void 0:we.base)==null?void 0:xe.sx)?(Le=(Oe=(Q=t==null?void 0:t.progressBarPageTexts)==null?void 0:Q.base)==null?void 0:Oe.sx)!=null?Le:[]:[(Ae=(pe=t==null?void 0:t.progressBarPageTexts)==null?void 0:pe.base)==null?void 0:Ae.sx],...Array.isArray((He=(fe=t==null?void 0:t.progressBarPageTexts)==null?void 0:fe.total)==null?void 0:He.sx)?(Ie=(st=(De=t==null?void 0:t.progressBarPageTexts)==null?void 0:De.total)==null?void 0:st.sx)!=null?Ie:[]:[(ie=(Ve=t==null?void 0:t.progressBarPageTexts)==null?void 0:Ve.total)==null?void 0:ie.sx]],onClick:()=>f("next","ltr",!1),children:e})]})})},Fs=F(l.memo(Pn),[wt,()=>({openPage:de.useOpenPage()}),Ce,L.useSettingsWithoutDefaultFlag],["isDragging","setIsDragging","openPage","pages","pageLoadStates","totalPages","currentPageIndex","readingMode"]),_n=l.forwardRef(({direction:e,...r},n)=>{const{settings:{customThemes:o,appTheme:t,themeMode:a,shouldUsePureBlackMode:d}}=rr(),i=l.useMemo(()=>nr(a,or(t,o),d,e),[a,t,o,d,e]);return s.jsx(ar,{value:ir[e],children:s.jsx(cr,{theme:i,children:s.jsx($,{...r,ref:n,dir:e})})})}),Us=F(_n,[()=>({direction:L.useGetThemeDirection()})],["direction"]),Gs=l.memo(({pageName:e,progressBarPosition:r,slotProps:n,children:o})=>{var t;return s.jsx(z,{...n==null?void 0:n.tooltip,title:e,placement:Es[r],children:s.jsx($,{...n==null?void 0:n.box,sx:{width:"100%",height:"100%",...(t=n==null?void 0:n.box)==null?void 0:t.sx},children:o})})}),yn=l.memo(({pageName:e,primaryPageLoadState:r,secondaryPageLoadState:n,progressBarPosition:o,isCurrentPage:t,isLeadingPage:a,showDraggingStyle:d})=>{const i=tt();return s.jsx(Gs,{pageName:e,progressBarPosition:o,slotProps:{box:{sx:{cursor:"pointer",backgroundColor:qt(i.palette.background.paper,.2),...i.applyStyles("dark",{backgroundColor:Jt(i.palette.background.paper,.1)}),...m(r&&(n==null||n),{backgroundColor:qt(i.palette.background.paper,.35),...i.applyStyles("dark",{backgroundColor:Jt(i.palette.background.paper,.25)})})}},tooltip:{slotProps:t?{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}}:void 0}},children:s.jsx($,{sx:{width:"100%",height:"100%",...m(a,{backgroundColor:Je(i.palette.primary.main,.5)}),...m(t,{cursor:d?"grabbing":"grab",pointer:"grabbing",borderRadius:2,backgroundColor:"primary.dark",...i.applyStyles("dark",{backgroundColor:"primary.light"})})}})})}),kn=({readerNavBarWidth:e,isMaximized:r,setIsMaximized:n,isDragging:o,progressBarType:t,progressBarSize:a,progressBarPosition:d,progressBarPositionAutoVertical:i,readerDirection:c,scrollbarXSize:h,scrollbarYSize:u,totalPages:f})=>{const g=tt(),[,x]=l.useState({});Xe(window.document.documentElement,l.useCallback(()=>x({}),[]));const p=Ts(d,i,u,e+h),{isBottom:R,isLeft:S,isRight:C,isVertical:v,isHorizontal:b}=ve(p),j=!!f,E=t===Wt.HIDDEN,T=!r&&!o;return s.jsx(Us,{children:s.jsx(Fs,{direction:b?c:"ltr",progressBarPosition:p,fullSegmentClicks:!0,createProgressBarSlot:l.useCallback((A,D,O,y,_,G,ue,k,M)=>s.jsx(yn,{pageName:A.name,primaryPageLoadState:O,secondaryPageLoadState:y,progressBarPosition:p,isCurrentPage:_,isLeadingPage:G,showDraggingStyle:M}),[p]),slotProps:{container:{sx:{overflow:"hidden",transition:"all 0.".concat(g.transitions.duration.shortest,"s"),...m(b,{minHeight:"100px",...m(g.direction==="ltr",{left:c==="ltr"?e:u,right:c==="rtl"?e:u}),...m(g.direction==="rtl",{left:c==="rtl"?e:u,right:c==="ltr"?e:u})}),...m(v,{minWidth:"100px",bottom:"".concat(h,"px")}),...m(R,{bottom:"".concat(h,"px")}),...m(S,{...m(g.direction==="ltr",{left:c==="ltr"?e:"unset",right:c==="rtl"?e:"unset"}),...m(g.direction==="rtl",{right:c==="rtl"?u:"unset",left:c==="ltr"?u:"unset"})}),...m(C,{...m(g.direction==="ltr",{right:c==="ltr"?u:"unset",left:c==="rtl"?u:"unset"}),...m(g.direction==="rtl",{left:c==="rtl"?e:"unset",right:c==="ltr"?e:"unset"})}),...m(T,{opacity:E?0:.85}),...m(!j,{pointerEvents:"none"})},onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},progressBarRoot:{sx:{gap:0,transition:"all 0.1s ease-in-out",backgroundColor:"background.paper",...m(v,{flexDirection:"column",height:"100%"}),...m(T,{backgroundColor:"unset",pointerEvents:"none",...m(b,{px:2}),...m(v,{py:2}),...m(R,{pb:.25}),...m(S,{...m(g.direction==="ltr",{pl:c==="ltr"?.25:0,pr:c==="rtl"?.25:0}),...m(g.direction==="rtl",{pr:c==="rtl"?.25:0,pl:c==="ltr"?.25:0})}),...m(C,{...m(g.direction==="ltr",{pr:c==="ltr"?.25:0,pl:c==="rtl"?.25:0}),...m(g.direction==="rtl",{pl:c==="rtl"?.25:0,pr:c==="ltr"?.25:0})})})}},progressBarSlotsContainer:{sx:{gap:.25,borderRadius:2,transition:"height 0.1s ease-in-out",...m(b,{height:"20px"}),...m(v,{flexDirection:"column",width:"20px"}),...m(T,{...m(b,{height:"".concat(a,"px")}),...m(v,{width:"".concat(a,"px")})})}},progressBarReadPages:{sx:{display:"none"}},progressBarCurrentPageSlot:{sx:{display:"none"}},progressBarPageTexts:{base:{sx:{px:1,py:1.5,transition:"all 0.1s ease-in-out",...m(T,{transform:"scale(0)",p:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})}}}}})})},Nn=F(l.memo(kn),[ze,wt,L.useSettingsWithoutDefaultFlag,()=>({readerDirection:L.useGetThemeDirection()}),et,Ce],["readerNavBarWidth","isMaximized","setIsMaximized","isDragging","progressBarType","progressBarSize","progressBarPosition","progressBarPositionAutoVertical","readerDirection","scrollbarXSize","scrollbarYSize","totalPages"]),Mn=$e(P)({width:"400px",minWidth:"400px",maxWidth:"400px",height:"100vh",overflowY:"auto"}),Hn=l.memo(({mangaId:e,mangaTitle:r,chapterTitle:n,scanlator:o})=>s.jsxs(P,{children:[s.jsx(z,{title:r,placement:"right",children:s.jsx(ut,{lines:3,variant:"h6",component:"h1",sx:{textAlign:"center"},children:s.jsx(zt,{component:Ot,to:Xt.manga.path(e),sx:{textDecoration:"none",color:"inherit"},children:r})})}),s.jsx(z,{title:n,placement:"right",children:s.jsx(ut,{lines:4,variant:"body1",component:"h2",sx:{textAlign:"center"},children:n})}),o&&s.jsx(z,{title:o,placement:"right",children:s.jsx(ut,{lines:4,variant:"body2",component:"h3",color:"textDisabled",sx:{textAlign:"center"},children:o})})]})),Vn=Se(s.jsx("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"})),Wn=Se(s.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),Ct=({title:e,type:r,disabled:n,...o})=>s.jsx(z,{title:e,disabled:n,children:s.jsx(Hs,{sx:{flexBasis:"15%"},variant:"contained",disabled:n,...o,children:r==="previous"?s.jsx(Vn,{}):s.jsx(Wn,{})})}),Fn=({currentPageIndex:e,pages:r,readingDirection:n,openPage:o})=>{const{t}=U(),a=js(),d=l.useMemo(()=>ye(e,r),[e,r]),i=Cs[n];return s.jsxs(P,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(Ct,{type:"previous",title:t(a("reader.button.previous_page","reader.button.next_page",i)),disabled:a(!d.primary.index,Ee(d)===Ee(r.slice(-1)[0]),i),onClick:()=>o("previous",void 0,!1)}),s.jsxs(Vs,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(Ws,{id:"reader-nav-bar-desktop-page-select",children:t("reader.page_info.label.page")}),s.jsx(Ms,{labelId:"reader-nav-bar-desktop-page-select",label:t("reader.page_info.label.page"),value:Ee(d),onChange:c=>o(c.target.value,void 0,!1),children:r.map(c=>s.jsx(Rt,{value:Ee(c),children:c.name},Ee(c)))})]}),s.jsx(Ct,{type:"next",title:t(a("reader.button.next_page","reader.button.previous_page",i)),disabled:a(Ee(d)===Ee(r.slice(-1)[0]),!d.primary.index,i),onClick:()=>o("next",void 0,!1)})]})},Un=F(l.memo(Fn),[Ce,()=>({openPage:de.useOpenPage()}),L.useSettingsWithoutDefaultFlag],["currentPageIndex","pages","readingDirection","openPage"]),Gn=()=>{},zs=({currentChapter:e,chapters:r,style:n})=>{const o=l.useMemo(()=>e&&r.findIndex(t=>t.id===e.id),[e,r]);return s.jsx(nn,{style:{height:"calc(".concat(r.length," * 100px)"),...n},initialTopMostItemIndex:o!=null?o:0,totalCount:r.length,computeItemKey:t=>r[t].id,itemContent:t=>s.jsx(tn,{index:t,chapters:r,isSortDesc:!0,mode:"reader",showChapterNumber:!1,selected:null,onSelect:Gn,selectable:!1,isActiveChapter:t===o}),increaseViewportBy:400})},zn=({currentChapter:e,previousChapter:r,nextChapter:n,chapters:o=[],readerThemeDirection:t,openChapter:a})=>{var c,h;const{t:d}=U(),i=bt({variant:"popover",popupId:"reader-nav-bar-desktop-chapter-list"});return l.useLayoutEffect(()=>{i.close()},[e==null?void 0:e.id]),s.jsxs(P,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(Ct,{type:"previous",title:d(le("reader.button.previous_chapter","reader.button.next_chapter",t)),onClick:()=>{a(le("previous","next",t))},disabled:le(!r,!n,t)}),s.jsxs(Vs,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(Ws,{id:"reader-nav-bar-desktop-chapter-select",children:d("chapter.title_one")}),s.jsx(Ms,{...Et(i),open:i.isOpen,value:(c=e==null?void 0:e.id)!=null?c:0,MenuProps:{sx:{visibility:"hidden"}},label:d("chapter.title_one"),labelId:"reader-nav-bar-desktop-chapter-select",children:s.jsx(Rt,{value:(h=e==null?void 0:e.id)!=null?h:0,children:e?"#".concat(e.chapterNumber," ").concat(e.name):""},e==null?void 0:e.id)})]}),s.jsx(Ct,{component:Ot,type:"next",title:d(le("reader.button.next_chapter","reader.button.previous_chapter",t)),onClick:()=>{a(le("next","previous",t))},disabled:le(!n,!r,t)}),s.jsx(lr,{...dr(i),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:s.jsx($,{sx:{mb:1},children:s.jsx(zs,{style:{width:"500px",maxWidth:"90vw",minHeight:"150px",maxHeight:"300px"},currentChapter:e,chapters:o})})})]})},$n=F(l.memo(zn),[()=>({readerThemeDirection:L.useGetThemeDirection()}),()=>({openChapter:de.useOpenChapter()})],["readerThemeDirection","openChapter"]),Xn=Se(s.jsx("path",{d:"M17 4h3c1.1 0 2 .9 2 2v2h-2V6h-3zM4 8V6h3V4H4c-1.1 0-2 .9-2 2v2zm16 8v2h-3v2h3c1.1 0 2-.9 2-2v-2zM7 18H4v-2H2v2c0 1.1.9 2 2 2h3zM18 8H6v8h12z"})),$s=(e,r,n)=>{const t=(e+1)%r.length===0;if(!(n&&t))return r[(e+1)%r.length]},Kt=({tooltip:e,value:r,defaultValue:n,values:o,setValue:t,valueToDisplayData:a,isDefaultable:d,onDefault:i,defaultIcon:c})=>{const{t:h}=U(),u=r===void 0,f=l.useMemo(()=>u?-1:o.indexOf(r),[r,o]);return s.jsx(z,{title:e,children:u?s.jsx(Qe,{onClick:()=>t(o[0]),sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:c,size:"large",children:n===void 0?h("global.label.default"):s.jsx(Yr,{i18nKey:"settings.default_value",value:a[n].isTitleString?a[n].title:h(a[n].title)})}):s.jsx(Qe,{onClick:()=>{const g=$s(f,o,d);if(g===void 0){i==null||i();return}t(g)},sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:a[r].icon,size:"large",children:a[r].isTitleString?a[r].title:h(a[r].title)})})},Yn=({pageScaleMode:e,shouldStretchPage:r,updateSetting:n,...o})=>{const{t}=U();return s.jsxs(P,{sx:{flexDirection:"row",gap:1},children:[s.jsx(Kt,{...o,tooltip:t("reader.settings.page_scale.title"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:ws,setValue:a=>n("pageScaleMode",a),valueToDisplayData:Qt,defaultIcon:Qt[e.value].icon}),ur[e.value]&&s.jsx(z,{title:t("reader.settings.page_scale.stretch"),children:s.jsx(Hs,{onClick:()=>n("shouldStretchPage",!r.value),sx:{px:void 0},variant:"contained",color:r.value?"secondary":"primary",children:s.jsx(Xn,{})})})]})},Kn=({readingMode:e,setReadingMode:r,...n})=>{const{t:o}=U();return s.jsx(Kt,{...n,tooltip:o("reader.settings.label.reading_mode"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Os,setValue:r,valueToDisplayData:Ft,defaultIcon:Ft[e.value].icon})},Zn=()=>s.jsx(gr,{children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M2 4h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2m20 0h-6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6M2 12h20m-3-3 3 3-3 3M5 9l-3 3 3 3"})})}),qn=({readingMode:e,shouldOffsetDoubleSpreads:r,setShouldOffsetDoubleSpreads:n})=>{const{t:o}=U();return fr(e)?s.jsx(Qe,{sx:{justifyContent:"start",textTransform:"unset"},size:"large",onClick:()=>n(!r),color:r?"secondary":"primary",variant:"contained",startIcon:s.jsx(Zn,{}),children:o("reader.settings.label.offset_double_spread")}):null},Jn=({readingDirection:e,setReadingDirection:r,...n})=>{const{t:o}=U();return s.jsx(Kt,{...n,tooltip:o("reader.settings.label.reading_direction"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Ls,setValue:r,valueToDisplayData:es,defaultIcon:es[e.value].icon})},Qn=Se(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 14H9V8h2zm4 0h-2V8h2z"})),eo=Se(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 14.5v-9l6 4.5z"})),to=({autoScroll:e,setAutoScroll:r})=>{const{t:n}=U(),{isActive:o,toggleActive:t}=ft(),a=l.useRef(void 0);return s.jsxs(P,{sx:{flexDirection:"row",gap:1},children:[s.jsx(Qe,{sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},size:"large",onClick:t,color:o?"secondary":"primary",variant:"contained",startIcon:o?s.jsx(Qn,{}):s.jsx(eo,{}),children:n("reader.settings.auto_scroll.title")}),s.jsx(rn,{value:e.value,type:"number",size:"small",onBlur:d=>{const i=ot(+d.target.value,_e.min,_e.max);i!==e.value&&(clearTimeout(a.current),r({...e,value:i},!0))},onChange:d=>{const i=ot(+d.target.value,_e.min,_e.max);r({...e,value:i},!1),clearTimeout(a.current),a.current=setTimeout(()=>r({...e,value:i},!0),1e3)},slotProps:{input:{inputProps:_e,endAdornment:s.jsx(on,{position:"end",children:n("global.time.seconds.second",{count:e.value})})}}})]})},so=({manga:e,readingMode:r,shouldOffsetDoubleSpreads:n,pageScaleMode:o,shouldStretchPage:t,readingDirection:a,autoScroll:d,openSettings:i})=>{const{t:c}=U(),h=L.useCreateUpdateSetting(e!=null?e:Ge),u=L.useCreateDeleteSetting(e!=null?e:Ge);return s.jsxs(P,{sx:{gap:1},children:[s.jsx(Kn,{readingMode:r,setReadingMode:f=>h("readingMode",f),isDefaultable:!0,onDefault:()=>u("readingMode")}),s.jsx(qn,{readingMode:r.value,shouldOffsetDoubleSpreads:n.value,setShouldOffsetDoubleSpreads:f=>h("shouldOffsetDoubleSpreads",f)}),s.jsx(Yn,{pageScaleMode:o,shouldStretchPage:t,updateSetting:h,isDefaultable:!0,onDefault:()=>u("pageScaleMode")}),s.jsx(Jn,{readingDirection:a,setReadingDirection:f=>h("readingDirection",f),isDefaultable:!0,onDefault:()=>u("readingDirection")}),s.jsx(to,{autoScroll:d,setAutoScroll:(...f)=>h("autoScroll",...f)}),s.jsx(Qe,{onClick:()=>i(),size:"large",sx:{justifyContent:"start",textTransform:"none"},variant:"contained",startIcon:s.jsx(As,{}),children:c("reader.settings.title.reader")})]})},ro=F(so,[Me,L.useSettings],["manga","readingMode","shouldOffsetDoubleSpreads","pageScaleMode","shouldStretchPage","readingDirection","autoScroll"]),no=Se(s.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"})),ls={...Ge,title:"Fallback",inLibrary:!1},oo=({manga:e})=>{const{inLibrary:r}=e!=null?e:ls,{t:n}=U(),{CategorySelectComponent:o,updateLibraryState:t}=gn(e!=null?e:ls,!0);return s.jsxs(s.Fragment,{children:[s.jsx(z,{title:n(r?"manga.action.library.remove.label.action":"manga.button.add_to_library"),children:s.jsx(re,{onClick:t,color:"inherit",children:r?s.jsx(un,{}):s.jsx(fn,{})})}),o]})},Xs=F(l.memo(oo),[Me],["manga"]),ao=Se(s.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),io=({id:e,isBookmarked:r})=>{const{t:n}=U(),o=r?"unbookmark":"bookmark";return s.jsx(z,{title:n(Ut[o].action.single),children:s.jsx(re,{onClick:()=>Ue.performAction(o,[e],{}),color:"inherit",children:r?s.jsx(sn,{}):s.jsx(ao,{})})})},Ys=l.memo(io),co=({currentChapter:e})=>{var o;const{t:r}=U(),n=Ue.useDownloadStatusFromCache((o=e==null?void 0:e.id)!=null?o:-1);return e&&Ue.isDownloaded(e)?s.jsx(z,{title:r(Ut.delete.action.single),children:s.jsx(re,{onClick:()=>Ue.performAction("delete",[e.id],{}),color:"inherit",children:s.jsx(ln,{})})}):n?s.jsx(dn,{chapterId:n.chapter.id}):s.jsx(z,{title:r(Ut.download.action.single),disabled:!e,children:s.jsx(re,{disabled:!e,onClick:()=>{var t;return Ue.performAction("download",[(t=e==null?void 0:e.id)!=null?t:-1],{})},color:"inherit",children:s.jsx(cn,{})})})},lo=l.memo(({currentChapter:e,pageLoadStates:r,setPageLoadStates:n,setRetryFailedPagesKeyPrefix:o})=>{const{id:t,isBookmarked:a,realUrl:d}=e!=null?e:Ds,{t:i}=U(),c=l.useRef(0),h=l.useMemo(()=>r.some(u=>u.error),[r]);return s.jsxs(P,{sx:{flexDirection:"row",justifyContent:"center",gap:1},children:[s.jsx(Xs,{}),s.jsx(Ys,{id:t,isBookmarked:a}),s.jsx(z,{title:i("reader.button.retry_load_pages"),disabled:!h,children:s.jsx(re,{onClick:()=>{n(u=>u.map(f=>({url:f.url,loaded:f.loaded}))),o("".concat(c.current)),c.current=(c.current+1)%1e3},disabled:!h,color:"inherit",children:s.jsx(no,{})})}),s.jsx(co,{currentChapter:e}),s.jsx(z,{title:i("chapter.action.label.open_on_source"),disabled:!d,children:s.jsx(re,{disabled:!d,href:d!=null?d:"",rel:"noreferrer",target:"_blank",color:"inherit",children:s.jsx(an,{})})})]})}),uo=F(lo,[ke,Ce],["currentChapter","pageLoadStates","setPageLoadStates","setRetryFailedPagesKeyPrefix"]),go=({exit:e})=>{const{t:r}=U(),n=js();return s.jsx(z,{title:r("reader.button.exit"),children:s.jsx(re,{sx:{marginRight:2},onClick:e,color:"inherit",children:n(s.jsx(hr,{}),s.jsx(xr,{}))})})},Ks=F(l.memo(go),[()=>({exit:L.useExit()})],["exit"]),fo=(e,r)=>{const n=l.useRef(r),o=l.useRef(r);return o.current!==n.current&&!e&&(n.current=!1),o.current!==r&&(n.current=o.current,o.current=r),n.current},ho=({isVisible:e,openSettings:r,setReaderNavBarWidth:n,manga:o,chapters:t,currentChapter:a,previousChapter:d,nextChapter:i,isStaticNav:c})=>{const{t:h}=U(),u=L.useCreateUpdateSetting(o!=null?o:Ge),[f,g]=l.useState();Xe(f,l.useCallback(()=>{c&&n(f.offsetWidth)},[f,c])),l.useLayoutEffect(()=>()=>n(0),[]);const R=fo(e,c)&&e?0:void 0;return s.jsx(pr,{variant:c?"permanent":"persistent",open:e||c,transitionDuration:R,SlideProps:{unmountOnExit:!0},PaperProps:{ref:S=>g(S)},children:s.jsxs(Mn,{sx:{backgroundColor:"background.paper",pointerEvents:"all"},children:[s.jsxs(P,{sx:{p:2,gap:2,backgroundColor:"action.hover"},children:[s.jsxs(P,{sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(Ks,{}),s.jsx(z,{title:h("reader.settings.label.static_navigation"),children:s.jsx(re,{onClick:()=>{n(0),u("isStaticNav",!c)},color:c?"primary":"inherit",children:c?s.jsx(Qr,{}):s.jsx(en,{})})})]}),o&&a?s.jsxs(s.Fragment,{children:[s.jsx(Hn,{mangaId:o.id,mangaTitle:o.title,chapterTitle:a.name,scanlator:a.scanlator}),s.jsx(uo,{})]}):s.jsx(Lt,{})]}),s.jsxs(P,{sx:{p:2,gap:2},children:[s.jsxs(P,{sx:{gap:1},children:[s.jsx(Un,{}),s.jsx($n,{chapters:t,currentChapter:a,nextChapter:i,previousChapter:d})]}),s.jsx(mr,{}),s.jsx(ro,{openSettings:r})]})]})})},xo=F(l.memo(ho),[ze,Me,ke,Ce,L.useSettingsWithoutDefaultFlag],["setReaderNavBarWidth","manga","chapters","currentChapter","previousChapter","nextChapter","isStaticNav"]),po={...Ge,title:""},mo=l.forwardRef(({isVisible:e,manga:r,currentChapter:n,scrollbarYSize:o},t)=>{const{t:a}=U(),d=bt({popupId:"reader-overlay-more-menu",variant:"popover"}),{id:i,title:c}=r!=null?r:po,{id:h,name:u,realUrl:f,isBookmarked:g}=n!=null?n:Ds;return s.jsx(Yt,{direction:"down",in:e,ref:t,children:s.jsxs(P,{sx:{flexDirection:"row",alignItems:"center",position:"fixed",top:0,left:0,right:"".concat(o,"px"),p:2,pt:x=>"max(env(safe-area-inset-top), ".concat(x.spacing(2),")"),backgroundColor:x=>Je(x.palette.background.paper,.95),pointerEvents:"all",boxShadow:2},children:[s.jsx(Ks,{}),s.jsx(P,{sx:{flexGrow:1},children:r&&n?s.jsxs(s.Fragment,{children:[s.jsx(z,{title:c,children:s.jsx(ut,{lines:1,component:"h1",variant:"h5",children:s.jsx(zt,{component:Ot,to:Xt.manga.path(i),sx:{textDecoration:"none",color:"inherit"},children:c})})}),s.jsx(z,{title:u,children:s.jsx(ut,{lines:1,children:u})})]}):s.jsx(Lt,{})}),s.jsx(Xs,{}),s.jsx(Ys,{id:h,isBookmarked:g}),s.jsx(re,{...Et(d),color:"inherit",children:s.jsx(hn,{})}),s.jsxs(vr,{...Sr(d),children:[s.jsx(Rt,{component:zt,disabled:!f,href:f!=null?f:"",rel:"noreferrer",target:"_blank",children:a("chapter.action.label.open_on_source")}),s.jsx(Rt,{disabled:!f,onClick:async()=>{await navigator.clipboard.writeText(c),Is(a("global.label.copied_clipboard"),"info")},children:a("global.label.share")})]})]})})}),vo=F(l.memo(mo),[Me,ke,et],["manga","currentChapter","scrollbarYSize"]),So=Se(s.jsx("path",{d:"m21.81 12.74-.82-.63v-.22l.8-.63c.16-.12.2-.34.1-.51l-.85-1.48c-.07-.13-.21-.2-.35-.2q-.075 0-.15.03l-.95.38c-.08-.05-.11-.07-.19-.11l-.15-1.01c-.03-.21-.2-.36-.4-.36h-1.71c-.2 0-.37.15-.4.34l-.14 1.01c-.03.02-.07.03-.1.05l-.09.06-.95-.38q-.075-.03-.15-.03c-.14 0-.27.07-.35.2l-.85 1.48c-.1.17-.06.39.1.51l.8.63v.23l-.8.63c-.16.12-.2.34-.1.51l.85 1.48c.07.13.21.2.35.2q.075 0 .15-.03l.95-.37c.08.05.12.07.2.11l.15 1.01c.03.2.2.34.4.34h1.71c.2 0 .37-.15.4-.34l.15-1.01c.03-.02.07-.03.1-.05l.09-.06.95.38q.075.03.15.03c.14 0 .27-.07.35-.2l.85-1.48c.1-.17.06-.39-.1-.51M18 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M17 17h2v4c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v4h-2V6H7v12h10z"})),Ro=Se(s.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5M7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"})),ds=Se(s.jsx("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})),us=Se(s.jsx("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"})),bo={display:"flex",alignItems:"center",justifyContent:"end",position:"relative",backgroundColor:"background.default"},gs="3px",Eo=l.memo(({isTrailingPage:e,pagesIndex:r,totalPages:n,isVertical:o,isHorizontal:t})=>{const a="".concat(r/(n-1)*100,"%");return s.jsx($,{sx:{position:"absolute",...m(o,{top:a,left:"50%"}),...m(t,{top:"50%",left:a}),transform:"translate(-50%, -50%)",width:gs,height:gs,borderRadius:100,backgroundColor:"background.paper",...m(e,{backgroundColor:"primary.main"}),zIndex:1}})}),To=l.memo(({pageName:e,isTrailingPage:r,isCurrentPage:n,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:d})=>s.jsx(Gs,{pageName:e,progressBarPosition:dt.BOTTOM,slotProps:{box:{sx:bo}},children:!n&&s.jsx(Eo,{isTrailingPage:r,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:d})})),jo={[dt.BOTTOM]:"up",[dt.LEFT]:"right",[dt.RIGHT]:"left",[dt.AUTO]:"left"},Co=({previousChapter:e,nextChapter:r,isVisible:n,setIsMaximized:o,isDragging:t,currentPageIndex:a,pages:d,direction:i,progressBarPosition:c,progressBarPositionAutoVertical:h,topOffset:u=0,bottomOffset:f=0,scrollbarXSize:g})=>{const x=de.useOpenChapter(),[,p]=l.useState({});Xe(window.document.documentElement,l.useCallback(()=>p({}),[]));const R=Ts(c,h,u+f,g),{isLeft:S,isRight:C,isVertical:v,isHorizontal:b}=ve(R),j=b?i:"ltr",E=l.useMemo(()=>ye(a,d).pagesIndex,[a,d]),T=l.useMemo(()=>({container:{sx:{flexGrow:1,position:"relative",display:"flex",justifyItems:"center",alignItems:"stretch",backgroundColor:D=>Je(D.palette.background.paper,.85),borderRadius:100,boxShadow:2}},progressBarRoot:{sx:{flexGrow:1,gap:0,...m(v,{flexDirection:"column"}),...m(b,{alignItems:"stretch"})}},progressBarSlotsActionArea:{sx:{alignItems:"center",cursor:"pointer",...m(v,{width:"100%",flexDirection:"column",px:2}),...m(b,{height:"100%",py:2})}},progressBarSlotsContainer:{sx:{borderRadius:100,backgroundColor:"background.default",...m(v,{flexDirection:"column",py:1}),...m(b,{px:1})}},progressBarSlot:{sx:{...m(v,{width:"20px"}),...m(b,{height:"20px"})}},progressBarCurrentPageSlot:{sx:{display:"flex",zIndex:1,cursor:"inherit",...m(v,{justifyContent:"center"}),...m(b,{alignItems:"center"})}},progressBarPageTexts:{base:{sx:{...m(v,{py:1}),...m(b,{px:1})}}}}),[v,b]),A=l.useMemo(()=>({progressBarCurrentPage:s.jsx($,{sx:{position:"absolute",...m(v,{top:"calc(100% - 6px)",...m(E===0,{top:"0"}),width:"75%",height:"6px"}),...m(b,{left:"calc(100% - 0px)",...m(E===0,{left:"0"}),width:"6px",height:"75%"}),backgroundColor:"primary.main",borderRadius:100,cursor:t?"grabbing":"grab"}})}),[E,d.length,t,v,b]);return l.useLayoutEffect(()=>(o(n),()=>o(!1)),[n]),s.jsx(Yt,{direction:jo[R],in:n,children:s.jsx(Us,{sx:{position:"relative",display:"flex",alignItems:"end",height:"100%",pointerEvents:"none",...m(S,{justifyContent:i==="ltr"?"start":"end"}),...m(C,{justifyContent:i==="ltr"?"end":"start"})},children:s.jsxs(P,{sx:{p:2,gap:1,pointerEvents:"all",alignItems:"center",...m(v,{height:"100%",flexDirection:"column"}),...m(b,{width:"100%",flexDirection:"row"})},children:[s.jsx(re,{onClick:()=>x("previous"),disabled:!e,sx:{backgroundColor:D=>Je(D.palette.background.paper,.85),boxShadow:2},children:le(s.jsx(ds,{sx:{...m(v,{transform:"rotate(90deg)"})}}),s.jsx(us,{sx:{...m(v,{transform:"rotate(90deg)"})}}),j)}),s.jsx(Fs,{direction:j,progressBarPosition:R,fullSegmentClicks:!1,createProgressBarSlot:l.useCallback((D,O,y,_,G,ue,k,M)=>s.jsx(To,{pageName:D.name,isTrailingPage:k,isCurrentPage:G,pagesIndex:O,totalPages:M,isVertical:v,isHorizontal:b}),[v,b]),slotProps:{...T,progressBarReadPages:{sx:{backgroundColor:"primary.main",...m(v,{width:"20px",height:"".concat(Math.max(0,ye(a,d).pagesIndex)/(d.length-1)*100,"%"),borderRadius:"400px 400px 0 0"}),...m(b,{width:"".concat(Math.max(0,ye(a,d).pagesIndex)/(d.length-1)*100,"%"),height:"20px",borderRadius:"400px 0 0 400px"})}}},slots:A}),s.jsx(re,{onClick:()=>x("next"),disabled:!r,sx:{backgroundColor:D=>Je(D.palette.background.paper,.85),boxShadow:2},children:le(s.jsx(us,{sx:{...m(v,{transform:"rotate(90deg)"})}}),s.jsx(ds,{sx:{...m(v,{transform:"rotate(90deg)"})}}),j)})]})})})},wo=F(l.memo(Co),[ke,At,wt,Ce,()=>({direction:L.useGetThemeDirection()}),L.useSettingsWithoutDefaultFlag,et],["previousChapter","nextChapter","isVisible","setIsMaximized","isDragging","currentPageIndex","pages","direction","progressBarPosition","progressBarPositionAutoVertical","scrollbarXSize"]),Oo=({manga:e,readingMode:r,readingDirection:n,autoScroll:o,isActive:t,toggleActive:a})=>{const{t:d}=U(),i=L.useCreateDeleteSetting(e!=null?e:Ge);return e?s.jsxs(P,{sx:{gap:2},children:[s.jsx(Kr,{}),s.jsx(Zr,{readingMode:r,setReadingMode:c=>L.updateSetting(e,"readingMode",c),isDefaultable:!0,onDefault:()=>i("readingMode")}),s.jsx(qr,{readingDirection:n,setReadingDirection:c=>L.updateSetting(e,"readingDirection",c),isDefaultable:!0,onDefault:()=>i("readingDirection")}),s.jsx(xn,{label:d("reader.settings.auto_scroll.title"),checked:t,onChange:()=>a()}),s.jsx(Jr,{autoScroll:o,setAutoScroll:(...c)=>L.updateSetting(e,"autoScroll",...c)})]}):null},Lo=F(l.memo(Oo),[Me,L.useSettings,ft],["manga","readingMode","readingDirection","autoScroll","isActive","toggleActive"]),Ao=({openSettings:e,isVisible:r,currentChapter:n,chapters:o,scrollbarXSize:t,scrollbarYSize:a,topOffset:d=0})=>{const{t:i}=U(),c=bt({variant:"dialog",popupId:"reader-chapter-list-dialog"}),h=bt({variant:"dialog",popupId:"reader-quick-settings-dialog"}),[u,f]=l.useState(0),g=l.useRef(null);return Xe(g,l.useCallback(()=>{var x,p;return f((p=(x=g.current)==null?void 0:x.clientHeight)!=null?p:0)},[u])),l.useLayoutEffect(()=>{c.close()},[n==null?void 0:n.id]),s.jsxs(s.Fragment,{children:[s.jsxs(P,{sx:{position:"fixed",right:"".concat(a,"px"),bottom:0,left:0,height:"calc(100% - ".concat(d,"px)")},children:[s.jsx(wo,{topOffset:d,bottomOffset:u}),s.jsx(Yt,{direction:"up",in:r,children:s.jsx(P,{ref:g,sx:{alignItems:"center",backgroundColor:x=>Je(x.palette.background.paper,.95),pb:"max(".concat(t,"px, env(safe-area-inset-bottom))"),boxShadow:2,pointerEvents:"all"},children:s.jsxs(P,{sx:{width:"50%",flexDirection:"row",p:2,gap:1,justifyContent:"space-evenly",alignItems:"center"},children:[s.jsx(z,{title:i("reader.button.chapter_list"),children:s.jsx(re,{...Et(c),color:"inherit",children:s.jsx(Ro,{})})}),s.jsx(z,{title:i("reader.settings.title.quick_settings"),children:s.jsx(re,{...Et(h),color:"inherit",children:s.jsx(So,{})})}),s.jsx(z,{title:i("settings.title"),children:s.jsx(re,{onClick:e,color:"inherit",children:s.jsx(As,{})})})]})})})]}),c.isOpen&&s.jsx(Ht,{...ts(c),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Vt,{sx:{p:0,pb:1},children:s.jsx(zs,{style:{minHeight:"15vh",maxHeight:"75vh"},currentChapter:n,chapters:o})})}),h.isOpen&&s.jsx(Ht,{...ts(h),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Vt,{children:s.jsx(Lo,{})})})]})},Do=F(l.memo(Ao),[ke,et],["currentChapter","chapters","scrollbarXSize","scrollbarYSize"]),Io=({isVisible:e,isDesktop:r,isMobile:n})=>{const[o,t]=l.useState(!1),[a,d]=l.useState(0),i=l.useRef(null);return Xe(i,l.useCallback(()=>{var c,h;return d((h=(c=i.current)==null?void 0:c.clientHeight)!=null?h:0)},[n])),s.jsxs($,{sx:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none",zIndex:1},children:[r&&s.jsxs(s.Fragment,{children:[s.jsx(Nn,{}),s.jsx(xo,{isVisible:e,openSettings:()=>t(!0)})]}),n&&s.jsxs(s.Fragment,{children:[s.jsx(vo,{ref:i,isVisible:e}),s.jsx(Do,{openSettings:()=>t(!0),isVisible:e,topOffset:a})]}),s.jsx(Rn,{isOpen:o,close:()=>t(!1)}),s.jsx(En,{})]})},Bo=F(l.memo(Io),[L.useOverlayMode],["isDesktop","isMobile"]),fs="reader-tap-zone-layout-canvas",Po=({readerNavBarWidth:e,showPreview:r,tapZoneLayout:n,tapZoneInvertMode:o,readingDirection:t})=>{const a=tt(),[d,i]=l.useState(0),[c,h]=l.useState(0),[u,f]=l.useState(null);Xe(u,l.useCallback(()=>{var x,p;i((x=u==null?void 0:u.clientWidth)!=null?x:0),h((p=u==null?void 0:u.clientHeight)!=null?p:0)},[u]));const g=Rr.getOrCreateCanvas(n,d,c,a.typography.h3,{vertical:o.vertical,horizontal:o.horizontal,isRTL:t===at.RTL});return l.useLayoutEffect(()=>{const x=document.getElementById(fs);x==null||x.replaceChildren(g)},[g,r]),s.jsx($,{ref:f,sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none"},children:r&&s.jsx("div",{id:fs})})},_o=F(Po,[ze,Dt,L.useSettingsWithoutDefaultFlag],["readerNavBarWidth","showPreview","tapZoneLayout","tapZoneInvertMode","readingDirection"]),yo=({readerNavBarWidth:e,customFilter:{rgba:{value:{red:r,green:n,blue:o,alpha:t,blendMode:a},enabled:d}}})=>d?s.jsx($,{sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none",background:"rgba(".concat(r," ").concat(n," ").concat(o," / ").concat(t,"%)"),mixBlendMode:"".concat(a)}}):null,ko=F(yo,[ze,L.useSettingsWithoutDefaultFlag],["readerNavBarWidth","customFilter"]),hs=2,xs=1,Ze=0,te=0,se=1,No=(e,r=kt.XY)=>{const[n,o]=l.useState(!1),t=l.useRef(void 0),a=l.useRef([0,0,0]),d=l.useRef([0,0,0]),i=l.useRef([0,0,0]),c=l.useRef([0,0]),h=l.useRef(void 0);return l.useEffect(()=>{const u=e==null?void 0:e.current;if(!u)return()=>{};const f=()=>{t.current||(t.current=getComputedStyle(u));const T=t.current.direction==="rtl",A=t.current.flexDirection==="row-reverse";return T||!T&&A},g=()=>(t.current||(t.current=getComputedStyle(u)),t.current.flexDirection==="column-reverse"),x=r!==kt.Y,p=r!==kt.X,R=()=>clearInterval(h.current),S=()=>{const T=(Y,ee,N)=>(Y[Ze]-Y[hs])/(ee[Ze]-ee[hs])*1e3/N,A=[x?T(a.current,i.current,u.clientWidth):0,p?T(d.current,i.current,u.clientHeight):0],D=x&&p?Math.sqrt(A[te]**2+A[se]**2):Math.abs(p?A[se]:A[te]),O=[A[te]/D,A[se]/D],y=ot(1.2*D,-12,12),_=(Date.now()-i.current[Ze])/1e3,G=y-14.278*_+75.24*_**2/y-149.72*_**3/y/y;if(!(y!==0&&G>0&&!Number.isNaN(y))){R();return}const k=(Y,ee)=>Y*ee*(y*_-7.1397*_**2+25.08*_**3/y-37.43*_**4/y/y),M=[k(u.clientWidth,O[te]),k(u.clientHeight,O[se])],W=[u.scrollWidth-u.clientWidth,u.scrollHeight-u.clientHeight],B=[ot(c.current[te]-M[te],f()?-W[te]:0,W[te]),ot(c.current[se]-M[se],g()?-W[se]:0,W[se])],ne=B[te]!==0||B[te]!==W[te],K=B[se]!==0||B[se]!==W[se];ne||K||R(),x&&(u.scrollLeft=B[te]),p&&(u.scrollTop=B[se])};let C=!1;const v=T=>{if(C)return!0;const A=[u.clientHeight<u.scrollHeight,u.clientWidth<u.scrollWidth],D=[Math.abs(a.current[Ze]-T.pageX)>0,Math.abs(d.current[Ze]-T.pageY)>0];return A[te]&&D[te]||A[se]&&D[se]},b=T=>{v(T)&&(C=!0,o(!0),a.current=[...a.current.slice(1),T.pageX],d.current=[...d.current.slice(1),T.pageY],i.current=[...i.current.slice(1),Date.now()],x&&(u.scrollLeft+=a.current[Ze]-a.current[xs]),p&&(u.scrollTop+=d.current[Ze]-d.current[xs]))},j=()=>{u.removeEventListener("mousemove",b),u.removeEventListener("mouseup",j),setTimeout(()=>{C=!1,o(!1)},0),c.current=[u.scrollLeft,u.scrollTop],h.current=setInterval(S,16)},E=T=>{T.button===0&&(T.preventDefault(),a.current=[T.pageX,T.pageX,T.pageX],d.current=[T.pageY,T.pageY,T.pageY],i.current=[Date.now()-2,Date.now()-1,Date.now()],u.addEventListener("mousemove",b),u.addEventListener("mouseup",j),R())};return u.addEventListener("mousedown",E),u.addEventListener("wheel",R),()=>{u.removeEventListener("mousedown",E),u.removeEventListener("wheel",R),R()}},[e,r]),n},Mo=(e,r)=>{l.useEffect(()=>{if(e){r.pause();return}r.resume()},[e,r.isPaused])},Ho=(e,r,n,o,t)=>{l.useEffect(()=>{var d,i;const a=()=>{e&&r(!1),n&&o(!1)};return(d=t.current)==null||d.addEventListener("wheel",a),(i=t.current)==null||i.addEventListener("touchmove",a),()=>{var c,h;(c=t.current)==null||c.removeEventListener("wheel",a),(h=t.current)==null||h.removeEventListener("touchmove",a)}},[e,n])},Vo=(e,r,n)=>{l.useEffect(()=>{if(e!==V.CONTINUOUS_HORIZONTAL)return()=>{};if(!n.current)return()=>{};let o,t,a;const d=i=>{var f,g;if(a===!0)return;i.preventDefault();const c=!Math.abs(Math.abs(o!=null?o:i.deltaX)-Math.abs(i.deltaX)),h=!Math.abs(Math.abs(t!=null?t:i.deltaY)-Math.abs(i.deltaY));if(o=i.deltaX,t=i.deltaY,a||(a=!c||!h),a!==void 0){if(i.shiftKey){(f=n.current)==null||f.scrollBy({top:i.deltaY});return}(g=n.current)==null||g.scrollBy({left:r===at.LTR?i.deltaY:i.deltaY*-1})}};return n.current.addEventListener("wheel",d),()=>{var i;return(i=n.current)==null?void 0:i.removeEventListener("wheel",d)}},[e,r])},Wo=e=>{const r=l.useRef(void 0);l.useEffect(()=>{const n=t=>{const a=e.current;a&&(a.style.cursor=t?"default":"none")},o=()=>{n(!0),clearTimeout(r.current),r.current=setTimeout(()=>{n(!1)},5e3)};return o(),window.addEventListener("mousemove",o),()=>{n(!0),window.removeEventListener("mousemove",o),clearTimeout(r.current)}},[])},Fo=(e,r,n,o,t)=>{l.useLayoutEffect(()=>{var a;r||(a=t.current)==null||a.scrollTo(br(t.current,n,o),0)},[e])},Uo=(e,r,n,o,t,a,d,i,c,h)=>{l.useLayoutEffect(()=>{if(e==null)return;const u=ye(e,n);if(d){const x=e>r?Tt.PREVIOUS:Tt.NEXT,p=i.current[u.pagesIndex];p==null||p.scrollIntoView({block:"start",inline:Er(x,c,h)})}const f=Ee(u),g=f===o-1;t(null),a(f,!g,g)},[e])},Go=(e,r,n,o,t,a,d)=>{const[i,c]=l.useState(d===V.DOUBLE_PAGE);l.useLayoutEffect(()=>{if(i&&d!==V.DOUBLE_PAGE){c(!1);const f=Bs(n);o(f),t(f.map(({primary:{url:g}})=>({url:g,isSpread:!1})));return}d===V.DOUBLE_PAGE&&(i||a(Ee(ye(e,r))),o(r),c(d===V.DOUBLE_PAGE))},[r,d])},Nt=({title:e,name:r,scanlator:n,backgroundColor:o})=>{const t=tt(),a=t.palette.getContrastText(Cr(t.palette,Ps[o])),d=Je(a,.5);return r?s.jsxs(P,{children:[s.jsx(qe,{color:a,children:e}),s.jsx(qe,{color:a,variant:"h6",component:"h1",children:r}),n&&s.jsx(qe,{variant:"body2",color:d,children:n})]}):null},zo=({type:e,transitionPageMode:r,readingMode:n,backgroundColor:o,shouldShowTransitionPage:t,manga:a,currentChapterName:d,currentChapterScanlator:i,previousChapterName:c,previousChapterScanlator:h,nextChapterName:u,nextChapterScanlator:f,scrollbarXSize:g,scrollbarYSize:x,readerNavBarWidth:p,handleBack:R})=>{var D;const{t:S}=U(),C=e===Te.PREVIOUS,v=e===Te.NEXT,b=!!d&&!c,j=!!d&&!u,E=b&&e===Te.PREVIOUS,T=j&&e===Te.NEXT;return!t&&!(E||T)||!jr(e,r,n)?null:s.jsx(P,{sx:{justifyContent:"center",alignItems:"center",...m(!Ne(n),{width:"100%",height:"100%"}),...m(Ne(n),{position:"sticky",...m(je(n),{left:0,maxWidth:"calc(100vw - ".concat(x,"px - ").concat(p,"px)"),minHeight:"calc(100vh - ".concat(g,"px)")}),...m(n===V.CONTINUOUS_HORIZONTAL,{top:0,minWidth:"calc(100vw - ".concat(x,"px - ").concat(p,"px)"),maxHeight:"calc(100vh - ".concat(g,"px)")})})},children:s.jsxs(P,{sx:{gap:2,maxWidth:O=>"calc(100vw - ".concat(x,"px - ").concat(p,"px - ").concat(O.spacing(2),")"),maxHeight:"calc(100vh - ".concat(g,"px)"),width:"max-content",p:1},children:[C&&b&&s.jsx(qe,{variant:"h6",children:S("reader.transition_page.first_chapter")}),s.jsxs(P,{sx:{gap:5},children:[C&&!b&&s.jsx(Nt,{title:S("reader.transition_page.previous"),name:c,scanlator:h,backgroundColor:o}),!!d&&s.jsx(Nt,{title:S(C?"reader.transition_page.current":"reader.transition_page.finished"),name:d,scanlator:i,backgroundColor:o}),v&&!j&&s.jsx(Nt,{title:S("reader.transition_page.next"),name:u,scanlator:f,backgroundColor:o})]}),v&&j&&s.jsx(qe,{variant:"h6",children:S("reader.transition_page.last_chapter")}),(C&&b||v&&j)&&s.jsxs(P,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:[s.jsx(Qe,{sx:{flexGrow:1},onClick:O=>{O.stopPropagation(),R()},variant:"contained",children:S("reader.transition_page.exit.previous_page")}),s.jsx(Qe,{sx:{flexGrow:1},component:Ot,onClick:O=>{O.stopPropagation()},variant:"contained",to:Xt.manga.path((D=a==null?void 0:a.id)!=null?D:-1),children:S("reader.transition_page.exit.manga_page")})]})]})})},ps=F(l.memo(zo),[Me,({chapterId:e})=>{const{chapters:r}=ke(),n=l.useMemo(()=>r.findIndex(d=>d.id===e),[e,r]),o=r[n],t=l.useMemo(()=>r[n+1],[n,r]),a=l.useMemo(()=>r[n-1],[n,r]);return{currentChapterName:o==null?void 0:o.name,currentChapterScanlator:o==null?void 0:o.scanlator,previousChapterName:t==null?void 0:t.name,previousChapterScanlator:t==null?void 0:t.name,nextChapterName:a==null?void 0:a.name,nextChapterScanlator:a==null?void 0:a.scanlator}},et,ze,Ce,L.useSettingsWithoutDefaultFlag,({chapterId:e,type:r})=>{const n=Tr(),{chapters:o}=ke(),t=l.useMemo(()=>o.findIndex(u=>u.id===e),[e,o]),a=t===0,d=t===o.length-1,i=r===Te.PREVIOUS&&d,c=r===Te.NEXT&&a;return{handleBack:i||c?n:Pe}}],["manga","currentChapterName","currentChapterScanlator","previousChapterName","previousChapterScanlator","nextChapterName","nextChapterScanlator","scrollbarXSize","scrollbarYSize","readerNavBarWidth","backgroundColor","transitionPageMode","readingMode","handleBack","shouldShowTransitionPage"]),$o=(e,r,n,o,t,a,d,i,c,h,u,f,g,x,p,R,S,C)=>{var b,j;const v=l.useRef(void 0);l.useLayoutEffect(()=>{var y;const E=(y=r.data)==null?void 0:y.fetchChapterPages;if(!E)return;const{pages:T}=E,A=T.length?T:[""],D=wr(n,o!=null?o:0,A.length-1),O=v.current!==(E==null?void 0:E.pages);if(O){v.current=E.pages;const _=Bs(A);c(!0),f(_),g(A),x(_.map(({primary:{url:G}})=>({url:G,loaded:!1}))),p(_.map(({primary:{url:G}})=>({url:G,isSpread:!1})))}else f(t),x(a),p(d);u(E.pages.length),g(A),R(D),S(D),h(_=>({..._,isCurrentChapterReady:i||O})),C(Te.NONE)},[(j=(b=r.data)==null?void 0:b.fetchChapterPages)==null?void 0:j.pages,e])},ms=0,mt="-10px",Xo=(e,r,n)=>{if(!Ne(r))return;const o=Cs[n],t="0px ".concat(mt," 0px 0px"),a="0px 0px 0px ".concat(mt);return je(r)?e==="first"?"0px 0px ".concat(mt," 0px"):"".concat(mt," 0px 0px 0px"):e==="first"?le(t,a,o):le(a,t,o)},Yo=(e,r,n,o)=>e===at.LTR?{start:n>=o,end:r<0}:{start:r<0,end:n>=o},Ko=(e,{top:r,right:n,bottom:o,left:t},a,d)=>{const i=window.innerWidth-d,c=window.innerHeight-a;return{[V.CONTINUOUS_VERTICAL]:{start:o>=c,end:r<0},[V.CONTINUOUS_HORIZONTAL]:Yo(e,t,n,i)}},Zo=({[V.CONTINUOUS_VERTICAL]:e,[V.CONTINUOUS_HORIZONTAL]:r},n)=>je(n)?e.start||e.end:r.start||r.end,qo=({[V.CONTINUOUS_VERTICAL]:e,[V.CONTINUOUS_HORIZONTAL]:r},n)=>je(n)?e:r,vs=(e,r,n,o,t,a,d,i,c,h,u,f,g,x)=>{l.useEffect(()=>{const p=Ne(a),R=je(a);if(x||!g||!p||!i||!o||t||n===void 0)return()=>{};const S=()=>{const C=g.scrollLeft===0,v=g.scrollLeft===g.scrollWidth-g.clientWidth,b=g.scrollTop===0,j=g.scrollTop===g.scrollHeight-g.clientHeight;(e==="first"&&(R?b:C)||e==="last"&&(R?j:v))&&c(n,void 0,!1)};return g.addEventListener("scroll",S),()=>g.removeEventListener("scroll",S)},[a,g,x,i,o,t,n,c]),Or(h,l.useCallback(p=>{if(!i||!Ne(a)||n===void 0||!x&&!t)return;const R=p[p.length-1],S=Ko(d,R.target.getBoundingClientRect(),u,f),{start:C,end:v}=qo(S,a),b=R.intersectionRatio<=ms;if(!Zo(S,a))return;const j=e==="first"&&C&&!t,E=e==="last"&&!o&&v;if(j||e==="last"&&v&&b){c(n,!t,!1);return}E&&c(r,!1,!1)},[e,r,n,o,t,a,d,i,x,c,u,f]),l.useMemo(()=>({root:g,threshold:[ms],rootMargin:Xo(e,a,d),ignoreInitialObserve:!0}),[e,a,d]))},Jo=({readingMode:e,readingDirection:r,shouldUseInfiniteScroll:n,chapterId:o,previousChapterId:t,nextChapterId:a,isPreviousChapterVisible:d,isCurrentChapter:i,isNextChapterVisible:c,imageWrapper:h,openChapter:u,scrollbarXSize:f,scrollbarYSize:g,scrollElement:x,shouldShowTransitionPage:p})=>(vs("first",o,t,i,d,e,r,n,u,h,f,g,x,p),vs("last",o,a,i,c,e,r,n,u,h,f,g,x,p),null),Qo=F(l.memo(Jo),[()=>({openChapter:de.useOpenChapter()}),L.useSettingsWithoutDefaultFlag],["openChapter","shouldShowTransitionPage"]),ea=({currentPageIndex:e,setPages:r,setPageLoadStates:n,setTotalPages:o,setCurrentPageIndex:t,updateCurrentPageIndex:a,setPageToScrollToIndex:d,transitionPageMode:i,retryFailedPagesKeyPrefix:c,setTransitionPageMode:h,readingMode:u,readerWidth:f,pageScaleMode:g,shouldOffsetDoubleSpreads:x,readingDirection:p,shouldUseInfiniteScroll:R,imagePreLoadAmount:S,pageGap:C,chapterId:v,previousChapterId:b,nextChapterId:j,isPreviousChapterVisible:E,isNextChapterVisible:T,lastPageRead:A,isInitialChapter:D,isCurrentChapter:O,isPreviousChapter:y,isNextChapter:_,isLeadingChapter:G,isTrailingChapter:ue,isPreloadMode:k,imageRefs:M,scrollIntoView:W,setReaderStateChapters:B,resumeMode:ne,customFilter:K,shouldStretchPage:oe,scrollbarXSize:Y,scrollbarYSize:ee,readerNavBarWidth:N,onSizeChange:Re,minWidth:ae,minHeight:ge,scrollElement:we})=>{const{t:xe}=U(),{direction:Q}=tt(),[Oe,Le]=Gt.useGetChapterPagesFetch(v!=null?v:-1),[pe,Ae]=l.useState(!1),[fe,He]=l.useState(pt.totalPages),[De,st]=l.useState(pt.pageUrls),[Ie,Ve]=l.useState(pt.pages),[ie,I]=l.useState(pt.pageLoadStates),[X,Ye]=l.useState(ie.map(({url:w})=>({url:w,isSpread:!1}))),We=l.useRef(null),Z=l.useRef(O),Be=l.useRef(Ie.map(()=>null)),me=l.useRef(null),H=l.useMemo(()=>!!!fe||!(fe===X.length)?Ie:u===V.DOUBLE_PAGE?Lr(De,X,x,p):Ie,[X,u,x,p,fe]),it=l.useMemo(()=>Ar(u),[u]),rt=p===at.LTR,Fe=Ne(u),he=!Fe&&!O||k,ht=!Fe&&O,It=!he&&(ht||Fe&&(D||G)),ct=!he&&(ht||Fe&&(D||ue));Z.current=O,O&&(M.current=Be.current);const Ke=l.useCallback(()=>{v&&(Ae(!1),Oe({variables:{input:{chapterId:v}}}).catch(vt()))},[Oe,v]),Bt=l.useMemo(()=>Dr(H,X,Ye,ie,w=>{Z.current&&n(w),I(w)},u),[H,u]),Pt=l.useMemo(()=>Ir(w=>{Z.current&&n(w),I(w)}),[]);l.useEffect(()=>{Ke()},[v]),Xe(We,l.useCallback(w=>{const{clientWidth:be,clientHeight:nt}=w[0].target;Re(be,nt,v)},[Re,We.current,v]));const ce=(w,be,nt,xt=!1)=>{(xt||!pe)&&be(w),O&&nt(w)};return $o(O,Le,ne,A,H,ie,X,pe,Ae,w=>ce(w,Pe,B),w=>ce(w,He,o),w=>ce(w,Ve,r),w=>ce(w,st,Pe),w=>ce(w,I,n),w=>ce(w,Ye,Pe),w=>ce(w,Pe,t),w=>{(D&&!pe||W)&&(d(w),B(be=>({...be,visibleChapters:{...be.visibleChapters,scrollIntoView:!1,resumeMode:void 0}})))},w=>ce(w,Pe,h)),Go(e,H,De,w=>ce(w,Ve,r,!0),w=>ce(w,Ye,Pe,!0),w=>ce(w,Pe,a),u),Fe||O||y||_?Le.error?he?null:s.jsx($,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center",position:"relative"},children:s.jsx(jt,{message:xe("global.error.label.failed_to_load_data"),messageExtra:_s(Le.error),retry:()=>{Ke()}})}):Le.loading||!pe?he?null:s.jsx($,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center"},children:s.jsx(Lt,{})}):v!=null&&!fe?he?null:s.jsx($,{sx:{minWidth:"100%",minHeight:"100%",position:"relative"},children:s.jsx(jt,{message:xe("reader.error.label.no_pages_found"),retry:Ke})}):s.jsxs(P,{ref:We,sx:{width:"fit-content",height:"fit-content",margin:"auto",flexWrap:"nowrap",...m(u===V.CONTINUOUS_HORIZONTAL,{minHeight:ge}),...m(je(u),{minWidth:ae}),...m(he,{maxWidth:0,maxHeight:0,minWidth:"unset",minHeight:"unset",overflow:"hidden",margin:"unset"}),...m(je(u)&&ys(f,g),{alignItems:"center"}),...m(u===V.CONTINUOUS_HORIZONTAL,{...m(Q==="ltr",{flexDirection:rt?"row":"row-reverse"}),...m(Q==="rtl",{flexDirection:rt?"row-reverse":"row"})})},children:[!k&&s.jsx(Qo,{readingMode:u,readingDirection:p,shouldUseInfiniteScroll:R,chapterId:v,previousChapterId:b,nextChapterId:j,isCurrentChapter:O,isPreviousChapterVisible:E,isNextChapterVisible:T,imageWrapper:me.current,scrollbarXSize:Y,scrollbarYSize:ee,scrollElement:we}),It&&s.jsx(ps,{chapterId:v,type:Te.PREVIOUS}),s.jsx(it,{ref:me,totalPages:fe,currentPageIndex:e,pages:H,transitionPageMode:i,pageLoadStates:ie,retryFailedPagesKeyPrefix:c,imageRefs:Be,onLoad:Bt,onError:Pt,isCurrentChapter:O,isPreviousChapter:y,isNextChapter:_,readingMode:u,imagePreLoadAmount:S,readingDirection:p,pageScaleMode:g,pageGap:C,customFilter:K,shouldStretchPage:oe,readerWidth:f,scrollbarXSize:Y,scrollbarYSize:ee,readerNavBarWidth:N,isPreloadMode:k,resumeMode:ne,handleAsInitialRender:W}),ct&&s.jsx(ps,{chapterId:v,type:Te.NEXT})]}):null},ta=l.memo(ea),sa=(e,r,n,o)=>{const t=Br(r),a=Pr(r),d=n!==window.innerWidth,i=o!==window.innerHeight,c=t&&d,h=a&&i;return!je(e)&&d?!0:c||h},Ss=(e,r,n)=>{l.useLayoutEffect(()=>{n(r)},[e])},ra=(e,r,n,o)=>{const t=l.useRef({width:window.innerWidth,height:window.innerHeight}),a=l.useCallback(()=>{const{width:d,height:i}=t.current;t.current={width:window.innerWidth,height:window.innerHeight},sa(e,r,d,i)&&n(o)},[e,r,o]);pn("resize",a)},Zs=e=>{const r=l.useRef({left:0,top:0,visibleElement:void 0,visibleElementLeft:0,visibleElementTop:0});return l.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=()=>{var a,d;const{visibleElement:t}=r.current;r.current={...r.current,left:n.scrollLeft,top:n.scrollTop,visibleElementLeft:(a=t==null?void 0:t.offsetLeft)!=null?a:0,visibleElementTop:(d=t==null?void 0:t.offsetTop)!=null?d:0}};return n.addEventListener("scroll",o),()=>n.removeEventListener("scroll",o)},[]),l.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=(d,i)=>Array.from(d).filter(c=>c instanceof HTMLElement).flatMap(c=>c instanceof HTMLImageElement?[c]:Array.from(c.querySelectorAll("img"))).forEach(i),t=new IntersectionObserver(d=>{const i=d.find(c=>c.isIntersecting);(i==null?void 0:i.target)instanceof HTMLElement&&(r.current={...r.current,visibleElement:i.target,visibleElementLeft:i.target.offsetLeft,visibleElementTop:i.target.offsetTop})}),a=new MutationObserver(d=>{for(const i of d)o(i.addedNodes,c=>t.observe(c)),o(i.removedNodes,c=>t.unobserve(c))});return a.observe(n,{childList:!0,subtree:!0}),()=>{a.disconnect(),t.disconnect()}},[]),r},na=(e,r)=>{const n=Zs(e),o=Ne(r),t=je(r);l.useEffect(()=>{const a=e.current;if(!a||!o)return()=>{};const d=u=>{const{left:f,top:g,visibleElement:x,visibleElementLeft:p,visibleElementTop:R}=n.current;if(!x||!!!u.filter(j=>!(j.target instanceof HTMLElement)||!j.target.clientWidth&&!j.target.clientHeight?!1:t?j.target.offsetTop<g:Math.abs(j.target.offsetLeft)<Math.abs(f)).length)return;const v=f-p+x.offsetLeft,b=g-R+x.offsetTop;a.scrollTo(v,b)},i=(u,f)=>Array.from(u).filter(g=>g instanceof HTMLElement).flatMap(g=>g instanceof HTMLImageElement?[g]:Array.from(g.querySelectorAll("img"))).forEach(f),c=new ResizeObserver(d),h=new MutationObserver(u=>{for(const f of u)i(f.addedNodes,g=>c.observe(g)),i(f.removedNodes,g=>c.unobserve(g))});return h.observe(a,{childList:!0,subtree:!0}),()=>{h.disconnect(),c.disconnect()}},[o,t])},oa=(e,r,n,o,t,a,d)=>{const i=Zs(e),c=()=>{const h=e.current,{left:u,top:f,visibleElementLeft:g,visibleElementTop:x,visibleElement:p}=i.current;if(!h||!d||!p)return!1;const R=ks(n,t,a),S=o===0;if(!(!R.previous&&S))return!1;const v=u-g+p.offsetLeft,b=f-x+p.offsetTop;return h.scrollTo(v,b),!0};l.useEffect(()=>{const h=e.current;if(!h||!d)return()=>{};let u=!1;const f=(p,R)=>{Array.from(p).filter(S=>S instanceof HTMLElement).flatMap(S=>S instanceof HTMLImageElement?[S]:Array.from(S.querySelectorAll("img"))).forEach(R)},g=new ResizeObserver(()=>{u||(u=c(),u&&g.disconnect())}),x=new MutationObserver(p=>{for(const R of p)f(R.addedNodes,S=>g.observe(S)),f(R.removedNodes,S=>g.unobserve(S))});return x.observe(h,{childList:!0,subtree:!0}),()=>{x.disconnect(),g.disconnect()}},[r]),l.useLayoutEffect(()=>{c()},[r])},aa=(e,r,n,o,t,a,d,i,c,h)=>{oa(e,r,n,o,t,a,Ne(d)),na(e,d),ra(d,h,c,o),Ss(i,o,c),Ss(d,o,c)},ia={[V.SINGLE_PAGE]:lt.X,[V.DOUBLE_PAGE]:lt.X,[V.CONTINUOUS_VERTICAL]:lt.Y,[V.CONTINUOUS_HORIZONTAL]:lt.X,[V.WEBTOON]:lt.Y},ca=l.forwardRef(({currentPageIndex:e,pageToScrollToIndex:r,setPageToScrollToIndex:n,pages:o,totalPages:t,setPages:a,setPageLoadStates:d,setTotalPages:i,setCurrentPageIndex:c,transitionPageMode:h,retryFailedPagesKeyPrefix:u,setTransitionPageMode:f,readingMode:g,readingDirection:x,shouldUseInfiniteScroll:p,readerWidth:R,pageScaleMode:S,shouldOffsetDoubleSpreads:C,imagePreLoadAmount:v,pageGap:b,customFilter:j,shouldStretchPage:E,readerNavBarWidth:T,setScrollbarXSize:A,setScrollbarYSize:D,isVisible:O,setIsVisible:y,updateCurrentPageIndex:_,showPreview:G,setShowPreview:ue,initialChapter:k,currentChapter:M,chapters:W,visibleChapters:B,setReaderStateChapters:ne,isCurrentChapterReady:K},oe)=>{var We;const{direction:Y}=tt(),{resumeMode:ee=ss.START}=(We=Ns().state)!=null?We:{resumeMode:ss.START},N=l.useRef(null),Re=mn(oe,N),ae=je(g),ge=Ne(g),we=No(N),xe=ft();l.useEffect(()=>xe.setScrollRef(N),[]);const Q=rs.useGetScrollbarSize("width",N.current),Oe=rs.useGetScrollbarSize("height",N.current);l.useLayoutEffect(()=>{A(Q),D(Oe)},[Q,Oe]);const Le=de.useHandleClick(N.current),pe=l.useRef(o.map(()=>null)),[{minChapterViewWidth:Ae,minChapterViewHeight:fe,minChapterSizeSourceChapterId:He},De]=l.useState({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),[,st]=l.useState({}),Ie=ia[g],Ve=x===at.LTR,ie=l.useMemo(()=>W.findIndex(Z=>Z.id===(k==null?void 0:k.id)),[W,k==null?void 0:k.id]),I=l.useMemo(()=>W.slice(Math.max(0,ie-B.trailing),Math.min(W.length,ie+B.leading+1)),[W,ie,B.trailing,B.leading]),X=l.useMemo(()=>I.findIndex(Z=>Z.id===(M==null?void 0:M.id)),[M,I]),Ye=l.useCallback((Z,Be,me)=>{if(!ge)return;const H=me===He;if(ae){if(!H&&Ae>=Z)return;De({minChapterViewWidth:Z,minChapterViewHeight:0,minChapterSizeSourceChapterId:me});return}(H||fe<Be)&&De({minChapterViewWidth:0,minChapterViewHeight:Be,minChapterSizeSourceChapterId:me})},[ge,ae,Ae,fe,He]);if(Uo(r,e,o,t,n,_,ge,pe,Y,x),Fo(e,ge,Y,x,N),Wo(N),Vo(g,x,N),Ho(O,y,G,ue,N),Mo(O,xe),aa(N,M==null?void 0:M.id,X,e,I,B,g,x,n,S),l.useLayoutEffect(()=>{De({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),st({})},[g]),!k||!M)throw new Error("ReaderViewer: illegal state - initialChapter and currentChapter should not be undefined");return s.jsx(P,{ref:Re,sx:{width:"100%",height:"100%",overflow:"auto",flexWrap:"nowrap",...m(ae&&ys(R,S),{alignItems:"center"}),...m(!ae,{...m(Y==="ltr",{flexDirection:Ve?"row":"row-reverse"}),...m(Y==="rtl",{flexDirection:Ve?"row-reverse":"row"})})},onClick:Z=>!we&&Le(Z),onScroll:()=>de.updateCurrentPageOnScroll(pe,t-1,_,Ie,x),children:I.map((Z,Be)=>{var be,nt,xt,Zt;const me=Math.max(0,I.length-Be-1),H=I[me],it=(be=I[me+1])!=null?be:W[ie+B.leading+1],rt=(nt=I[me-1])!=null?nt:W[ie-B.trailing-1],Fe=H.id===k.id,he=H.id===M.id,ht=H.id===((xt=I[X+1])==null?void 0:xt.id),It=H.id===((Zt=I[X-1])==null?void 0:Zt.id),ct=k.sourceOrder>H.sourceOrder,Ke=k.sourceOrder<H.sourceOrder,Bt=B.lastLeadingChapterSourceOrder===H.sourceOrder,Pt=B.lastTrailingChapterSourceOrder===H.sourceOrder,ce=Bt&&B.isLeadingChapterPreloadMode||Pt&&B.isTrailingChapterPreloadMode,_t=ks(me,I,B),w=H.id===He;return s.jsx(ta,{chapterId:H.id,previousChapterId:it==null?void 0:it.id,nextChapterId:rt==null?void 0:rt.id,isPreviousChapterVisible:_t.previous,isNextChapterVisible:_t.next,lastPageRead:ot(H.lastPageRead,0,H.pageCount-1),currentPageIndex:yr(e,H,M,he,K,ct,Ke,B),isInitialChapter:Fe,isCurrentChapter:he,isPreviousChapter:ht,isNextChapter:It,isLeadingChapter:ct,isTrailingChapter:Ke,isPreloadMode:ce,imageRefs:pe,setPages:a,setPageLoadStates:d,setTotalPages:i,setCurrentPageIndex:c,setPageToScrollToIndex:n,transitionPageMode:h,retryFailedPagesKeyPrefix:u,readingMode:g,readerWidth:R,pageScaleMode:S,shouldOffsetDoubleSpreads:C,readingDirection:x,shouldUseInfiniteScroll:p,updateCurrentPageIndex:he?_:Pe,scrollIntoView:he&&B.scrollIntoView,resumeMode:_r(he,Fe,ct,Ke,B.resumeMode,ee),setReaderStateChapters:ne,setTransitionPageMode:f,pageGap:b,imagePreLoadAmount:v,customFilter:j,shouldStretchPage:E,scrollbarXSize:Q,scrollbarYSize:Oe,readerNavBarWidth:T,onSizeChange:Ye,minWidth:w?0:Ae,minHeight:w?0:fe,scrollElement:N.current},H.id)})})}),la=F(l.memo(ca),[Ce,L.useSettingsWithoutDefaultFlag,et,At,()=>({updateCurrentPageIndex:de.useUpdateCurrentPageIndex()}),Dt,ke,ze],["currentPageIndex","pageToScrollToIndex","setPageToScrollToIndex","pages","totalPages","setPages","setPageLoadStates","setTotalPages","setCurrentPageIndex","retryFailedPagesKeyPrefix","setTransitionPageMode","readingMode","readingDirection","shouldUseInfiniteScroll","readerWidth","pageScaleMode","shouldOffsetDoubleSpreads","imagePreLoadAmount","pageGap","customFilter","shouldStretchPage","readerNavBarWidth","transitionPageMode","setScrollbarXSize","setScrollbarYSize","isVisible","setIsVisible","updateCurrentPageIndex","showPreview","setShowPreview","initialChapter","currentChapter","chapters","visibleChapters","setReaderStateChapters","isCurrentChapterReady"]),da=Object.fromEntries(Object.values(gt).map(e=>[e,{scopes:e}])),J=(...e)=>{const[r,n,o,t]=e;return kr(r,n,{...o,...da.reader},t)},Mt=(e,r,n,o,t,a,d)=>{if(a){e(n,t[0]);return}const i=$s(t.indexOf(o),t,d);if(i===void 0){r(n);return}e(n,i)},ua=({scrollElementRef:e})=>{const{direction:r}=tt(),n=L.useGetThemeDirection(),{enableScope:o,disableScope:t}=bs(),{manga:a}=Me(),{isVisible:d,setIsVisible:i}=At(),{hotkeys:c,pageScaleMode:h,shouldStretchPage:u,shouldOffsetDoubleSpreads:f,readingMode:g,readingDirection:x,autoScroll:p,scrollAmount:R}=L.useSettings(),S=ft(),{setShowPreview:C}=Dt(),v=L.useExit(),b=de.useOpenChapter(),j=de.useOpenPage(),E=L.useCreateUpdateSetting(a!=null?a:Ge),T=L.useCreateDeleteSetting(a!=null?a:Ge);return J(c[q.PREVIOUS_PAGE],()=>j("previous"),[j]),J(c[q.NEXT_PAGE],()=>j("next"),[j]),J(c[q.SCROLL_BACKWARD],()=>e.current&&de.scroll(ns.BACKWARD,os[g.value],g.value,x.value,r,e.current,b,i,C,R),{preventDefault:!0},[g.value,x.value,r,b,R]),J(c[q.SCROLL_FORWARD],()=>e.current&&de.scroll(ns.FORWARD,os[g.value],g.value,x.value,r,e.current,b,i,C,R),{preventDefault:!0},[g.value,x.value,r,b,R]),J(c[q.PREVIOUS_CHAPTER],()=>b(le("previous","next",n)),[b,n]),J(c[q.NEXT_CHAPTER],()=>b(le("next","previous",n)),[b,n]),J(c[q.TOGGLE_MENU],()=>i(!d),[d]),J(c[q.CYCLE_SCALE_TYPE],()=>{Mt(E,T,"pageScaleMode",h.value,ws,h.isDefault,!0)},[E,T,h.value,h.isDefault]),J(c[q.STRETCH_IMAGE],()=>E("shouldStretchPage",!u.value),[E,u.value]),J(c[q.OFFSET_SPREAD_PAGES],()=>E("shouldOffsetDoubleSpreads",!f.value),[E,f.value]),J(c[q.CYCLE_READING_MODE],()=>{Mt(E,T,"readingMode",g.value,Os,g.isDefault,!0)},[E,T,g.value,g.isDefault]),J(c[q.CYCLE_READING_DIRECTION],()=>{Mt(E,T,"readingDirection",x.value,Ls,x.isDefault,!0)},[E,T,x.value,x.isDefault]),J(c[q.TOGGLE_AUTO_SCROLL],S.toggleActive,{preventDefault:!0},[S.toggleActive]),J(c[q.AUTO_SCROLL_SPEED_DECREASE],()=>E("autoScroll",{...p,value:Math.min(_e.max,p.value+_e.step)}),[E,p.value]),J(c[q.AUTO_SCROLL_SPEED_INCREASE],()=>E("autoScroll",{...p,value:Math.max(_e.min,p.value-_e.step)}),[E,p.value]),J(c[q.EXIT_READER],v,[v]),l.useEffect(()=>(o(gt.READER),()=>t(gt.READER)),[]),null},ga=(e,r,n,o,t,a,d,i,c,h,u,f)=>{l.useEffect(()=>()=>{e(void 0),r(St),n(0),o(null),t(0),a([Nr("",0)]),d([]),i([{url:"",loaded:!1}]),c(Te.NONE),h(!1),u(Mr),f()},[])},fa=(e,r,n,o,t,a)=>{var d;l.useEffect(()=>{var p;const i=(p=e.data)==null?void 0:p.manga;if(!i||r.loading||r.error)return;const c=as(i,n),h=Hr(i,c.shouldUseAutoWebtoonMode,c.readingMode),u={...n,readingMode:h?V.WEBTOON:n.readingMode},f=h?V.WEBTOON:c.readingMode.value,g=Vr("global",{meta:o},u,void 0,f),x=as(i,g);t(x),a(!0)},[(d=e.data)==null?void 0:d.manga,n])},Rs=5e3,ha=(e,r,n,o,t,a,d,i,c)=>{const{t:h}=U(),u=l.useRef(void 0),f=l.useRef(void 0),g=l.useRef(void 0),x=l.useRef(!0);l.useEffect(()=>{if(e||r||!n)return;const p=JSON.stringify(o)!==JSON.stringify(u.current);d&&p&&Is(h(Ft[o.value].title),{autoHideDuration:Rs}),u.current=o;const S=JSON.stringify(t)!==JSON.stringify(f.current)||JSON.stringify(a)!==JSON.stringify(g.current);i&&S&&(c(!0),x.current&&setTimeout(()=>c(!1),Rs)),f.current=t,g.current=a,x.current=!1},[e,r,n,o.value,o.isDefault,t.value,t.isDefault,a.value,a.isDefault])},xa=(e,r,n,o,t,a)=>{var u;const d=Wr(),i=Ns().state,{updateInitialChapter:c}=i!=null?i:{},h=c?void 0:n;l.useEffect(()=>{var b,j;const f=(b=e.data)==null?void 0:b.chapters.nodes,g=f?(j=f[f.length-r])!=null?j:null:void 0,x=h!=null?h:g,p=o!=null?o:g,R=f&&g&&Ue.getNextChapter(g,f,{offset:Tt.NEXT,skipDupe:a,skipDupeChapter:p}),S=f&&g&&Ue.getNextChapter(g,f,{offset:Tt.PREVIOUS,skipDupe:a,skipDupeChapter:p}),C=!f||!p?[]:a?Ue.removeDuplicates(p,f):f,v=x!=null&&x.id!==(h==null?void 0:h.id);v&&d("",{replace:!0,state:{...i,updateInitialChapter:void 0}}),t(E=>{var A,D,O;const T=(g==null?void 0:g.id)!==((A=E.currentChapter)==null?void 0:A.id);return{...E,mangaChapters:f!=null?f:[],chapters:C,initialChapter:x,chapterForDuplicatesHandling:p,currentChapter:g,nextChapter:R,previousChapter:S,isCurrentChapterReady:T?!1:E.isCurrentChapterReady,visibleChapters:v?{...St.visibleChapters,lastLeadingChapterSourceOrder:(D=x==null?void 0:x.sourceOrder)!=null?D:St.visibleChapters.lastLeadingChapterSourceOrder,lastTrailingChapterSourceOrder:(O=x==null?void 0:x.sourceOrder)!=null?O:St.visibleChapters.lastTrailingChapterSourceOrder,isLeadingChapterPreloadMode:!1,isTrailingChapterPreloadMode:!1,scrollIntoView:!!E.initialChapter}:E.visibleChapters}})},[(u=e.data)==null?void 0:u.chapters.nodes,r,a,h])},pa=({setOverride:e,readerNavBarWidth:r,isVisible:n,setIsVisible:o,manga:t,setManga:a,shouldSkipDupChapters:d,backgroundColor:i,readingMode:c,tapZoneLayout:h,tapZoneInvertMode:u,shouldShowReadingModePreview:f,shouldShowTapZoneLayoutPreview:g,setSettings:x,initialChapter:p,chapterForDuplicatesHandling:R,currentChapter:S,setReaderStateChapters:C,setTotalPages:v,setCurrentPageIndex:b,setPageToScrollToIndex:j,setPages:E,setPageUrls:T,setPageLoadStates:A,setTransitionPageMode:D,cancelAutoScroll:O,setShowPreview:y})=>{var ge,we,xe;const{t:_}=U(),G=l.useRef(null),[ue,k]=l.useState(!1),{chapterSourceOrder:M,mangaId:W}=Ur(),B=Number(M),ne=Number(W),K=Gt.useGetManga(Gr,ne),oe=Gt.useGetMangaChapters(zr,ne);vn(!t||!S?_("reader.title",{mangaId:ne,chapterIndex:B}):"".concat(t.title,": ").concat(S.name));const{metadata:Y,settings:ee,request:N}=$r(),Re=S===void 0||!ue||K.loading||oe.loading||N.loading,ae=(we=(ge=K.error)!=null?ge:oe.error)!=null?we:N.error;return l.useEffect(()=>{var Q;a((Q=K.data)==null?void 0:Q.manga)},[(xe=K.data)==null?void 0:xe.manga]),ga(a,C,b,j,v,E,T,A,D,o,x,O),fa(K,N,ee,Y,x,k),ha(Re,ae,ue,c,h,u,f,g,y),xa(oe,B,p,R,C,d),l.useLayoutEffect(()=>(e({status:!0,value:s.jsxs($,{sx:{position:"absolute"},children:[s.jsx(ua,{scrollElementRef:G}),s.jsx(Bo,{isVisible:n}),!G.current&&s.jsx($,{onClick:()=>o(!n),sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"transparent"}})]})}),()=>e({status:!1,value:null})),[n,o,G.current]),ae?s.jsx(jt,{message:_("global.error.label.failed_to_load_data"),messageExtra:_s(ae),retry:()=>{K.error&&K.refetch().catch(vt()),N.error&&N.refetch().catch(vt()),oe.error&&oe.refetch().catch(vt())}}):Re?s.jsx($,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:s.jsx(Lt,{})}):S===null?s.jsx(jt,{message:_("reader.error.label.chapter_not_found")}):!t||!S?null:s.jsxs($,{sx:{position:"relative",display:"flex",flexDirection:"column",width:"calc(100vw - ".concat(r,"px)"),height:"100vh",marginLeft:"".concat(r,"px"),transition:Q=>"width 0.".concat(Q.transitions.duration.shortest,"s, margin-left 0.").concat(Q.transitions.duration.shortest,"s"),overflow:"auto",backgroundColor:Ps[i]},children:[s.jsx(la,{ref:G}),s.jsx(_o,{}),s.jsx(ko,{})]})},ti=F(l.memo(pa),[ze,At,Me,ke,Fr,()=>{const{shouldSkipDupChapters:e,backgroundColor:r,shouldShowReadingModePreview:n,shouldShowTapZoneLayoutPreview:o}=L.useSettingsWithoutDefaultFlag();return{shouldSkipDupChapters:e,backgroundColor:r,shouldShowReadingModePreview:n,shouldShowTapZoneLayoutPreview:o}},()=>{const{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}=L.useSettings();return{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}},Ce,()=>({cancelAutoScroll:ft().cancel}),Dt],["setOverride","readerNavBarWidth","isVisible","setIsVisible","manga","setManga","shouldSkipDupChapters","backgroundColor","readingMode","tapZoneLayout","tapZoneInvertMode","shouldShowReadingModePreview","shouldShowTapZoneLayoutPreview","setSettings","initialChapter","chapterForDuplicatesHandling","currentChapter","setReaderStateChapters","setTotalPages","setCurrentPageIndex","setPageToScrollToIndex","setPages","setPageUrls","setPageLoadStates","setTransitionPageMode","cancelAutoScroll","setShowPreview"]);export{ti as Reader};
