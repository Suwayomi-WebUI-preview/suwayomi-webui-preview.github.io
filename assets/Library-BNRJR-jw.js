import{bI as ke,f as m,bJ as Ae,cl as ye,k as D,u as I,r as G,cm as Be,e as N,j as t,cn as L,bN as Fe,aH as w,ao as B,F as Le,m as le,g as ce,C as ge,I as ve,y as z,z as Ce,E as Y,a6 as Ie,co as Re,cp as we,cq as Ee,H as Oe,B as De,A as Ge,L as Ne,Y as Ue,i as Pe,cr as ze}from"./index-tyLNoj-g.js";import{E as de}from"./EmptyViewAbsoluteCentered-BYMaQRbt.js";import{T as Ye,a as Je}from"./Tabs-CqD6sGVC.js";import{F as $e}from"./FilterList-DbNLoWH0.js";import{C as E}from"./CheckboxInput-NU-9mW5A.js";import{S as Ve,R as P}from"./SortRadioInput-B1eI0V7x.js";import{T as A}from"./ThreeStateCheckboxInput-BpOBsQsn.js";import{O as We,S as He,a as Ke}from"./SelectionFAB-DqRB9POx.js";import{T as Qe}from"./Trackers-BQ19KlF0.js";import{c as Xe,a as Ze}from"./Mangas-mToPioBB.js";import{a as qe}from"./ListPreference-D0bVVPYn.js";import{a as et,b as tt}from"./MangaGrid-C2i7npOx.js";import{A as at}from"./AppbarSearch-BxShoYa7.js";import{C as st,U as rt}from"./UpdateChecker-BdmfEDb7.js";import{j as ot}from"./useManageMangaLibraryState-oshfaG-S.js";import{C as nt}from"./Checkbox-BVVRKzrk.js";import{e as J}from"./Strings-CAV0u705.js";import{T as it}from"./TabsMenu-Cpu7jaC1.js";import{T as lt}from"./TabsWrapper-DzAllFsx.js";import{u as ct}from"./useAppTitle-Ct9UAEbu.js";import{u as dt}from"./useAppAction-BKjR_D9N.js";import{C as ht}from"./Chip-Bqu2KfxW.js";import"./StyledFab-BVxUBYam.js";import"./Chapters-CVLk9ObR.js";import"./DateHelper-CQQOwLKt.js";import"./Asserts-xItX73wb.js";import"./FormGroup-DtQlQBKT.js";import"./SwitchBase-BUewK90Z.js";import"./Delete-DoYSpbIL.js";import"./Download-zVltBYuQ.js";import"./ContinueReadingTooltip-DMOKqAKK.js";import"./AvatarSpinner-BkBm9Z2k.js";import"./SpinnerImage-aS-Tjv9-.js";import"./Refresh-ByL8_Gdz.js";import"./Image-Cvd__x3R.js";import"./Card-CzQnnrhS.js";import"./ListCardContent-DUkVOdyv.js";import"./CheckCircle-0jea4fMr.js";import"./Metadata-Dvqj23yD.js";import"./MUI.util-CEodEA2f.js";import"./CardActionArea-Ca0juIFc.js";import"./Link-Cg0uLQV0.js";import"./NumberSetting-DIR6cKm2.js";import"./Slider-CQFFNfQF.js";import"./useMobilePicker-V6rp_GFU.js";import"./SelectSetting-jaF-d2Pf.js";import"./Select-3SmpnGu0.js";import"./Sync-_8VVr9RC.js";import"./use-merged-ref-TRKgqlSM.js";import"./ListCardAvatar-Bp3ipTWd.js";import"./PlayArrow-dJJOrE4T.js";import"./index-CvNpBCvA.js";import"./Virtuoso.util-BEbfYdlu.js";import"./Progress-3sj4Nqny.js";const pt={sortDesc:void 0,sortBy:void 0,hasDownloadedChapters:void 0,hasBookmarkedChapters:void 0,hasUnreadChapters:void 0,hasReadChapters:void 0,hasDuplicateChapters:void 0,hasTrackerBinding:{},hasStatus:{}},ut=e=>({...e,hasTrackerBinding:e.hasTrackerBinding?JSON.stringify(e.hasTrackerBinding):void 0,hasStatus:e.hasStatus?JSON.stringify(e.hasStatus):void 0}),mt=(e,a=pt,n)=>ke("category",e,a,void 0,n),xe=(e,a,n)=>mt({...e,meta:Ae(e.meta)},a,n),gt=(e,a)=>xe(e,a),fe=(e,a)=>{const n=xe(e,a,m.useEffect);return m.useMemo(()=>n,[e,a])},Ct=async(e,a,n)=>ye(e,[[a,ut({[a]:n})[a]]]),xt=(e,a=D("createUpdateCategoryMetadata"))=>(n,s)=>Ct(e,n,s).catch(a),ft={filter:{id:"o7J4JM"},sort:{id:"f6Hub0"},display:{id:"Xm/s+u"}},St=[["unreadChapters",{id:"gpKhB7"}],["totalChapters",{id:"GnZOZw"}],["alphabetically",{id:"j8JRpm"}],["dateAdded",{id:"0DYtlD"}],["lastRead",{id:"3jvboG"}],["latestFetchedChapter",{id:"Q1me+U"}],["latestUploadedChapter",{id:"FVuPVV"}]],bt=({category:e,open:a,onClose:n})=>{var p,T;const{i18n:s,_:d}=I(),r=G.useGetTrackerList(Be),o=Qe.getLoggedIn((T=(p=r.data)==null?void 0:p.trackers.nodes)!=null?T:[]),i=fe(e),h=xt(e,u=>le(s._({id:"cBoXe4"}),"error",ce(u))),{settings:{showTabSize:g,showContinueReadingButton:x,showDownloadBadge:S,showUnreadBadge:_,gridLayout:b}}=N(),j=Le(u=>le(s._({id:"p43DY9"}),"error",ce(u)));return t.jsx(We,{open:a,onClose:n,tabs:["filter","sort","display"],tabTitle:u=>s._(ft[u]),tabContent:u=>u==="filter"?t.jsxs(t.Fragment,{children:[t.jsx(A,{label:s._({id:"KuVpz+"}),checked:i.hasUnreadChapters,onChange:c=>h("hasUnreadChapters",c)}),t.jsx(A,{label:s._({id:"JEGlfK"}),checked:i.hasReadChapters,onChange:c=>h("hasReadChapters",c)}),t.jsx(A,{label:s._({id:"Vv4iDV"}),checked:i.hasDownloadedChapters,onChange:c=>h("hasDownloadedChapters",c)}),t.jsx(A,{label:s._({id:"1C/9Sa"}),checked:i.hasBookmarkedChapters,onChange:c=>h("hasBookmarkedChapters",c)}),t.jsx(A,{label:s._({id:"GbJcxX"}),checked:i.hasDuplicateChapters,onChange:c=>h("hasDuplicateChapters",c)}),t.jsx(L,{sx:{mt:2},children:s._({id:"uAQUqI"})}),Object.values(Fe).map(c=>t.jsx(A,{label:s._(Xe[c]),checked:i.hasStatus[c],onChange:M=>h("hasStatus",{...i.hasStatus,[c]:M})},c)),t.jsx(L,{sx:{mt:2},children:s._({id:"EaG6cP"})}),o.map(c=>t.jsx(A,{label:c.name,checked:i.hasTrackerBinding[c.id],onChange:M=>h("hasTrackerBinding",{...i.hasTrackerBinding,[c.id]:M})},c.id))]}):u==="sort"?St.map(([c,M])=>t.jsx(Ve,{label:s._(M),checked:i.sortBy===c,sortDescending:i.sortDesc,onClick:()=>c!==i.sortBy?h("sortBy",c):h("sortDesc",!i.sortDesc)},c)):u==="display"?t.jsxs(t.Fragment,{children:[t.jsx(L,{children:s._({id:"fZ2U+F"})}),t.jsxs(qe,{onChange:c=>w("gridLayout",Number(c.target.value)),value:b,children:[t.jsx(P,{label:s._({id:"9ObMkz"}),value:B.Compact,checked:b==null||b===B.Compact}),t.jsx(P,{label:s._({id:"fYhACr"}),value:B.Comfortable,checked:b===B.Comfortable}),t.jsx(P,{label:s._({id:"2BBAbc"}),value:B.List,checked:b===B.List})]}),t.jsx(L,{sx:{mt:2},children:s._({id:"+YFgJi"})}),t.jsx(E,{label:s._({id:"8hN7A5"}),checked:_,onChange:()=>w("showUnreadBadge",!_)}),t.jsx(E,{label:s._({id:"J8a4UJ"}),checked:S,onChange:()=>w("showDownloadBadge",!S)}),t.jsx(L,{sx:{mt:2},children:s._({id:"38Or+7"})}),t.jsx(E,{label:s._({id:"zbtsm/"}),checked:g,onChange:()=>j("showTabSize",!g)}),t.jsx(L,{sx:{mt:2},children:s._({id:"/IX/7x"})}),t.jsx(E,{label:s._({id:"t7NGbE"}),checked:x,onChange:()=>w("showContinueReadingButton",!x)})]}):null})},_t=({category:e})=>{const{i18n:a,_:n}=I(),[s,d]=m.useState(!1),r=gt(e),o=r.hasDownloadedChapters!=null||r.hasUnreadChapters!=null||r.hasReadChapters!=null||r.hasBookmarkedChapters!=null||r.hasDuplicateChapters!=null||Object.values(r.hasStatus).some(i=>i!=null)||Object.values(r.hasTrackerBinding).some(i=>i!=null);return t.jsxs(t.Fragment,{children:[t.jsx(ge,{title:a._({id:"Tz0i8g"}),children:t.jsx(ve,{onClick:()=>d(!s),color:o?"warning":"inherit",children:t.jsx($e,{})})}),t.jsx(bt,{category:e,open:s,onClose:()=>d(!1)})]})},jt=()=>{},he=({showFilteredOutMessage:e,message:a,messageExtra:n,...s})=>{const{i18n:d,_:r}=I(),{settings:{gridLayout:o}}=N();return m.useLayoutEffect(()=>(document.body.style.overflowY=o===B.List?"auto":"scroll",()=>{document.body.style.overflowY="auto"}),[]),t.jsx(et,{gridWrapperProps:{sx:{p:1}},...s,hasNextPage:!1,loadMore:jt,message:e?d._({id:"X0ERkx"}):a,messageExtra:e?void 0:n,gridLayout:o})},Tt=({isActive:e,areAllItemsSelected:a,areNoItemsSelected:n,onSelectAll:s,onModeChange:d})=>{const{i18n:r,_:o}=I();return t.jsxs(t.Fragment,{children:[e&&t.jsx(He,{areAllItemsSelected:a,areNoItemsSelected:n,onChange:s}),t.jsx(ge,{title:e?r._({id:"dEgA5A"}):r._({id:"wgNoIs"}),children:t.jsx(nt,{checkedIcon:t.jsx(st,{}),sx:{padding:"8px",color:"inherit","&.Mui-checked":{color:"inherit"}},checked:e,onChange:(i,h)=>d(h)})})]})},$=(e,a,n)=>{switch(e){case!0:return a();case!1:return n();default:return!0}},O=(e,a)=>$(e,()=>!!a&&a>=1,()=>a===0),Se=(e,a)=>$(e,()=>!!a,()=>!a),y=(e,a)=>{const n=e==null?void 0:e.filter(o=>o!=null),s=a==null?void 0:a.filter(o=>o!=null);if(!(n!=null&&n.length))return!0;const d=n.map(J),r=s.map(J).join(", ");return d.every(o=>r.includes(o))},Mt=(e,{title:a,genre:n,description:s,artist:d,author:r,source:o,sourceId:i})=>y([e],[a])||y(e==null?void 0:e.split(","),n.map(h=>J(h)))||y([e],[s])||y([e],[d])||y([e],[r])||y([e],[o==null?void 0:o.displayName])||y([e],[i]),kt=(e,a)=>Object.entries(e).map(([n,s])=>{const d=a.trackRecords.nodes.some(r=>r.trackerId===Number(n));return $(s,()=>d,()=>!d)}).every(Boolean),At=(e,a)=>Object.entries(e).map(([n,s])=>Se(s,n===a.status)).every(Boolean),yt=(e,{hasDownloadedChapters:a,hasUnreadChapters:n,hasReadChapters:s,hasBookmarkedChapters:d,hasDuplicateChapters:r,hasTrackerBinding:o,hasStatus:i})=>O(a,e.downloadCount)&&O(n,e.unreadCount)&&O(s,e.chapters.totalCount-e.unreadCount)&&O(d,e.bookmarkCount)&&Se(r,e.hasDuplicateChapters)&&kt(o,e)&&At(i,e),Bt=(e,a,n)=>{const s=n.ignoreFilters&&(a==null?void 0:a.length);return e.filter(d=>{const r=Mt(a,d),o=s||yt(d,n);return r&&o})},v=(e=0,a=0)=>Number(e)-Number(a),pe=(e,a)=>e.localeCompare(a,void 0,{sensitivity:"base"}),Ft=(e,a,n)=>{const s=[...e],d=(()=>{switch(a){case"alphabetically":return(r,o)=>pe(r.title,o.title);case"dateAdded":return(r,o)=>v(r.inLibraryAt,o.inLibraryAt);case"unreadChapters":return(r,o)=>v(r.unreadCount,o.unreadCount);case"lastRead":return(r,o)=>{var i,h;return v((i=r.lastReadChapter)==null?void 0:i.lastReadAt,(h=o.lastReadChapter)==null?void 0:h.lastReadAt)};case"latestUploadedChapter":return(r,o)=>{var i,h;return v((i=r.latestUploadedChapter)==null?void 0:i.uploadDate,(h=o.latestUploadedChapter)==null?void 0:h.uploadDate)};case"latestFetchedChapter":return(r,o)=>{var i,h;return v((i=r.latestFetchedChapter)==null?void 0:i.fetchedAt,(h=o.latestFetchedChapter)==null?void 0:h.fetchedAt)};case"totalChapters":return(r,o)=>v(r.chapters.totalCount,o.chapters.totalCount);default:return()=>0}})();return s.sort((r,o)=>{const i=d(r,o);return i!==0?n?-i:i:pe(r.title,o.title)}),s},Lt={id:-1},vt=(e,a)=>{const[n]=z(Y.QUERY,Ce),s=fe(a!=null?a:Lt),{hasUnreadChapters:d,hasReadChapters:r,hasDownloadedChapters:o,hasBookmarkedChapters:i,hasTrackerBinding:h,hasDuplicateChapters:g,hasStatus:x}=s,{settings:S}=N(),_=m.useMemo(()=>Bt(e,n,{...s,ignoreFilters:S.ignoreFilters}),[e,n,d,r,o,i,h,g,x,S.ignoreFilters]),b=m.useMemo(()=>Ft(_,s.sortBy,s.sortDesc),[_,s.sortBy,s.sortDesc]),j=Object.values(s.hasTrackerBinding).some(T=>T!=null),p=(d!=null||r!=null||o!=null||i!=null||!!n||j)&&_.length===0&&e.length>0;return{visibleMangas:b,showFilteredOutMessage:p,filterKey:"".concat(JSON.stringify(s)).concat(S.ignoreFilters)}},ue=Ue("span")({display:"flex",alignItems:"center"}),me=({sx:e,...a})=>t.jsx(ht,{...a,size:"small",sx:{...e,marginLeft:"5px"}});function Ia(){var ae,se,re,oe,ne,ie;const{i18n:e,_:a}=I(),n=Ie(),{settings:{showTabSize:s}}=N(),{data:d,error:r,loading:o,refetch:i}=G.useGetCategories(Re,{notifyOnNetworkStatusChange:!0}),h=d==null?void 0:d.categories.nodes.filter(l=>l.id!==0||l.id===0&&l.mangas.totalCount),g=h!=null?h:[],x=G.useGetMangas(we,{}),S=(se=(ae=x.data)==null?void 0:ae.mangas.totalCount)!=null?se:0,[_,b]=z(Y.TAB,ze),[j]=z(Y.QUERY,Ce),p=(re=g.find(l=>l.id===_))!=null?re:g[0],{data:T,error:u,loading:c,refetch:M}=G.useGetCategoryMangas(p==null?void 0:p.id,{skip:!p,notifyOnNetworkStatusChange:!0}),be=(oe=T==null?void 0:T.mangas.nodes)!=null?oe:[],{visibleMangas:f,showFilteredOutMessage:V,filterKey:W}=vt(be,p),H=m.useCallback(()=>M().catch(D("Library::refetchCategoryMangas")),[M,p]),_e=m.useMemo(()=>f.map(l=>l.id),[f]),[k,R]=m.useState(!1),{areNoItemsForKeySelected:K,areAllItemsForKeySelected:Q,selectedItemIds:F,handleSelectAll:U,handleSelection:X,clearSelection:je}=ot(f.length,{itemIds:_e,currentKey:p==null?void 0:p.id.toString()}),Z=m.useCallback((l,C,Me)=>{R(!!(F.length+(C?1:-1))),X(l,C,Me)},[R,X]),q=m.useMemo(()=>F.map(l=>Ze.getFromCache(l,Ee,"MANGA_CHAPTER_STAT_FIELDS")).filter(l=>!!l),[F.length,f]),ee=m.useMemo(()=>k?t.jsx(Ke,{title:e._({id:"YznjBR",values:{0:F.length}}),children:(l,C)=>t.jsx(tt,{selectedMangas:q,onClose:()=>{l(),R(!1),je()},setHideMenu:C})}):null,[k,q]),te=m.useMemo(()=>!!j&&t.jsx(Oe,{sx:{p:2},children:t.jsx(De,{size:"large",component:Ne,to:Ge.sources.childRoutes.searchAll.path(j),sx:{textTransform:"none",width:"100%"},children:e._({id:"usXh8H",values:{query:j}})})}),[j]);ct(t.jsxs(ue,{children:[e._({id:"exYcTF"}),s&&t.jsx(me,{sx:{...n.applyStyles("light",{backgroundColor:"background.paper"})},label:S})]}),e._({id:"exYcTF"}),[a,s,S]),dt(t.jsxs(t.Fragment,{children:[!k&&p&&t.jsxs(t.Fragment,{children:[t.jsx(at,{}),t.jsx(_t,{category:p}),t.jsx(rt,{categoryId:p==null?void 0:p.id})]}),!!f.length&&t.jsx(Tt,{isActive:k,areAllItemsSelected:Q,areNoItemsSelected:K,onSelectAll:l=>U(l,[...new Set(f.map(C=>C.id))]),onModeChange:l=>{R(l),l?U(!0,[...new Set(f.map(C=>C.id))]):g.forEach(C=>U(!1,[],C.id.toString()))}})]}),[k,K,Q,p,f.length]);const Te=l=>{b(l)};return r!=null||x.error?t.jsx(de,{message:e._({id:"6m5aox"}),messageExtra:(ie=r==null?void 0:r.message)!=null?ie:(ne=x.error)==null?void 0:ne.message,retry:()=>{r&&i().catch(D("Library::refetchCategories")),x.error&&x.refetch().catch(D("Library::refetchLibrarySize"))}}):o||x.loading?t.jsx(Pe,{}):g.length===0?t.jsx(de,{message:e._({id:"EWQlBH"})}):g.length===1?t.jsxs(t.Fragment,{children:[te,t.jsx(he,{mangas:f,message:u?e._({id:"wCaJj1"}):e._({id:"EWQlBH"}),messageExtra:u==null?void 0:u.message,isLoading:c,selectedMangaIds:F,isSelectModeActive:k,handleSelection:Z,showFilteredOutMessage:!u&&V,retry:u&&H},W),ee]}):t.jsxs(lt,{children:[t.jsx(it,{value:p.id,onChange:(l,C)=>Te(C),children:g.map(l=>t.jsx(Ye,{sx:{flexGrow:1,maxWidth:"unset"},label:t.jsxs(ue,{children:[l.name,s?t.jsx(me,{label:l.mangas.totalCount}):null]}),value:l.id},l.id))}),te,g.map(l=>t.jsx(Je,{index:l.order,currentIndex:p.order,children:l===p&&t.jsx(he,{mangas:f,message:u?e._({id:"wCaJj1"}):e._({id:"vV4hhj"}),messageExtra:u==null?void 0:u.message,isLoading:c,selectedMangaIds:F,isSelectModeActive:k,handleSelection:Z,showFilteredOutMessage:!u&&V,retry:u&&H},W)},l.order)),ee]})}export{Ia as Library};
