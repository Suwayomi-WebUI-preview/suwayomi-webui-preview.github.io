import{c as _,j as e,u as z,r as $,a0 as G,b as W,d as y,_ as n,d7 as q,h as Y,ac as J,a1 as Q,S as E,ab as I,L as X,dT as Z,C as H,I as ee,a2 as ae,a4 as te,B as oe}from"./index-CBxbdOZa.js";import{c as re,d as p,C as se,e as ne,f as le,D as de,R as ie,V as ce,g as me,M as he}from"./useManageMangaLibraryState-DEU-P4Qb.js";import{C as ue,D as pe}from"./ChapterCardMetadata-CAy174W3.js";import{D as ke}from"./Delete-CPYpmXa7.js";import{D as be}from"./Download-Dvr2tlzK.js";import{M as xe}from"./MUI.util-Bs9Vl2GD.js";import{L as ge}from"./ListCardContent-DPbnp6xG.js";import{C as Ce}from"./Card-BbGJVXOW.js";import{C as fe}from"./CardActionArea-Dl3PGSnS.js";import{C as Ie}from"./Checkbox-D5Y8DhmM.js";const _e=_(e.jsx("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"})),je=_(e.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"})),Te=_(e.jsx("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"})),De=_(e.jsx("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"})),ye=_(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),we=({chapter:t,handleSelection:l,canBeDownloaded:c=!1,selectedChapters:d=[],onClose:r,selectable:o=!0})=>{var v,L,P;const{t:g}=z(),m=!!t,{isDownloaded:b,isRead:j,isBookmarked:i}=t!=null?t:{},C=(P=(L=$.useGetMangaChapters(G,(v=t==null?void 0:t.mangaId)!=null?v:-1,{skip:!t,fetchPolicy:"cache-only"}).data)==null?void 0:L.chapters.nodes)!=null?P:[],{settings:{deleteChaptersWithBookmark:f}}=W(),h=ne(m,q),k=re(m),a=le(m),{downloadableChapters:s,downloadedChapters:u,unbookmarkedChapters:w,bookmarkedChapters:A,unreadChapters:M,readChapters:R}=y.useMemo(()=>({downloadableChapters:n.getDownloadable(d),downloadedChapters:n.getDownloaded(d),unbookmarkedChapters:n.getNonBookmarked(d),bookmarkedChapters:n.getBookmarked(d),unreadChapters:n.getNonRead(d),readChapters:n.getRead(d)}),[d]),U=()=>{l==null||l(t.id,!0),r()},x=(S,F)=>{var O;const N=S==="mark_prev_as_read",V=N?"mark_as_read":S;if(V==="delete"&&t&&!n.isDeletable(t,f)){r();return}const D=(()=>{if(!t)return F;if(!N)return[t];const B=C.findIndex(({id:K})=>K===t.id);return B+1>C.length-1?[]:C.slice(B+1)})();if(!D.length){r();return}n.performAction(V,n.getIds(D),{chapters:D,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(O=D[0])==null?void 0:O.mangaId}).catch(Y()),r()};return e.jsxs(e.Fragment,{children:[m&&o&&e.jsx(p,{onClick:U,Icon:se,title:g("chapter.action.label.select")}),m&&e.jsx(p,{Icon:ye,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),r()},title:g("chapter.action.label.open_on_source")}),k(c)&&e.jsx(p,{Icon:be,disabled:a(!s.length),onClick:()=>x("download",s),title:h("download",s.length)}),k(b)&&e.jsx(p,{Icon:ke,disabled:a(!u.length),onClick:()=>x("delete",n.getDeletable(u,f)),title:h("delete",u.length)}),k(!i)&&e.jsx(p,{Icon:De,disabled:a(!w.length),onClick:()=>x("bookmark",w),title:h("bookmark",w.length)}),k(i)&&e.jsx(p,{Icon:Te,disabled:a(!A.length),onClick:()=>x("unbookmark",A),title:h("unbookmark",A.length)}),k(!j)&&e.jsx(p,{Icon:de,disabled:a(!M.length),onClick:()=>x("mark_as_read",M),title:h("mark_as_read",M.length)}),k(j)&&e.jsx(p,{Icon:ie,disabled:a(!R.length),onClick:()=>x("mark_as_unread",R),title:h("mark_as_unread",R.length)}),m&&e.jsx(p,{onClick:()=>x("mark_prev_as_read",[]),Icon:_e,title:g("chapter.action.mark_as_read.add.label.action.previous")})]})},He=y.memo(t=>{const{t:l}=z(),c=J(),d=y.useRef(null),{mode:r="manga.page",chapter:o,showChapterNumber:g,onSelect:m,selected:b,selectable:j=!0,isActiveChapter:i=!1}=t,T=b!==null,{isDownloaded:C}=o,f=a=>{T&&(a.preventDefault(),a.stopPropagation(),m(o.id,!b,a.shiftKey))},h=(a,s)=>{a.stopPropagation(),a.preventDefault(),s==null||s(a)},k=ce((a,{context:s})=>{if(!T&&d.current){h(a,()=>s==null?void 0:s(d.current));return}a.shiftKey=!0,f(a)});return e.jsx(Q,{variant:"popover",popupId:"chapter-card-action-menu",children:a=>{var s;return e.jsxs(E,{sx:{pt:1,px:1},children:[e.jsx(Ce,{sx:{touchCallout:"none",...I(r==="reader"&&i,{backgroundColor:"primary.main"})},children:e.jsx(fe,{component:X,to:n.getReaderUrl(o),style:{color:c.palette.text[o.isRead?"disabled":"primary"]},state:n.getReaderOpenChapterLocationState(o,!0),replace:r==="reader",onClick:u=>f(u),...k(a.open),children:e.jsxs(ge,{children:[e.jsx(ue,{title:g?"".concat(l("chapter.title_one")," ").concat(o.chapterNumber):o.name,secondaryText:o.scanlator,ternaryText:"".concat(Z(Number((s=o.uploadDate)!=null?s:0),!0)).concat(C?" â€¢ ".concat(l("chapter.status.label.downloaded")):""),infoIcons:o.isBookmarked&&e.jsx(je,{color:r==="reader"&&i?"secondary":"primary"}),slotProps:{title:{variant:"h6",component:"h3",sx:I(r==="reader"&&i,{color:c.palette.primary.contrastText})},secondaryText:{sx:I(r==="reader"&&i,{color:c.palette.primary.contrastText})},ternaryText:{sx:I(r==="reader"&&i,{color:c.palette.primary.contrastText})}}}),e.jsx(pe,{chapterId:o.id,color:r==="reader"&&i?c.palette.primary.contrastText:void 0}),e.jsx(E,{sx:{minHeight:"48px"},children:b===null?e.jsx(H,{title:l("global.button.options"),children:e.jsx(ee,{ref:d,...xe.preventRippleProp(ae(a),{onClick:u=>h(u)}),"aria-label":"more",sx:{color:"inherit",...I(r==="reader"&&i,{color:"primary.contrastText"})},children:e.jsx(me,{})})}):e.jsx(H,{title:l(b?"global.button.deselect":"global.button.select"),children:e.jsx(Ie,{checked:b})})})]})})}),!T&&a.isOpen&&e.jsx(he,{...te(a),children:u=>e.jsx(we,{onClose:u,chapter:o,handleSelection:()=>m(o.id,!0),canBeDownloaded:n.isDownloadable(o),selectable:j})})]})}})}),ze={id:-1,name:"",realUrl:"",isBookmarked:!1},Ue={unread:void 0,downloaded:void 0,bookmarked:void 0,reverse:!0,sortBy:"source",showChapterNumber:!1},Fe={source:"global.sort.label.by_source",chapterNumber:"global.sort.label.by_chapter_number",uploadedAt:"global.sort.label.by_upload_date",fetchedAt:"global.sort.label.by_fetch_date"},Ke=y.forwardRef(({children:t,...l},c)=>e.jsx(oe,{ref:c,...l,sx:{minWidth:"unset",px:"10px",...l.sx},children:t}));export{je as B,Fe as C,Ue as D,ze as F,ye as L,_e as a,He as b,we as c,Ke as d};
