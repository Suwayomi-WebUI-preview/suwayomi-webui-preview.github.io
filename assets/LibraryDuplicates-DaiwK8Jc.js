import{u as C,d as y,G as b,c,N as D,j as t,z as A,I as T,A as E,b1 as G,M as B,C as w,Q as I,a as O,h as k,E as S,k as F,B as M}from"./index-CgwpgmzX.js";import{b as P,M as N}from"./MangaGrid-BNOBrVw-.js";import{G as _}from"./GridLayouts-0f2tDZN2.js";import{C as z}from"./CheckboxInput-z11lWREO.js";import{S as H,a as L}from"./StyledGroupHeader-6oslJpMx.js";import"./index-BDuKUTxJ.js";import"./useManageMangaLibraryState-Bjnhc4hd.js";import"./CardContent-WastZZpR.js";import"./Avatar-Gc3ZUICh.js";import"./Info-DumgNkXl.js";import"./TextField-2w_Aa973.js";import"./InputAdornment-COdo-9fV.js";import"./SpinnerImage-C5KxRMfX.js";import"./Collapse-AEWCvR_t.js";import"./Link-B6Yv1IDU.js";import"./ListPreference-BMHY7-R_.js";import"./Checkbox-DCoF1kSO.js";import"./SwitchBase-BWPfpppt.js";import"./NumberSetting-NbToRaJk.js";import"./useMobilePicker-DReU6gdT.js";import"./Chip-D_giEhEV.js";import"./SelectSetting-knR1H-3a.js";import"./Select-Bpy-_SaN.js";import"./Mangas-DYPxkouH.js";import"./Chapters-CpzI1SdB.js";import"./ThreeStateCheckboxInput-Cub-dL0z.js";import"./Delete-CNXFT6xJ.js";import"./Sync-BeCG5YiP.js";import"./PlayArrow--SqiJEmL.js";import"./StyledFab-2U1Kldhf.js";import"./ViewModule-BDA7HIl5.js";const V=a=>{const r=Object.groupBy(a,({title:i})=>i.toLowerCase().trim());return Object.fromEntries(Object.entries(r).filter(i=>{var e,o;return((o=(e=i[1])==null?void 0:e.length)!=null?o:0)>1}).map(([,i])=>[i[0].title,i]))},q=a=>{const r={},i={};return a.forEach(e=>a.forEach(o=>{var d,p,f;if(!(e.id!==o.id))return;const u=e.title.toLowerCase().trim(),n=o.title.toLowerCase().trim()===u,x=!!((d=o.description)!=null&&d.toLowerCase().trim().includes(u));!(n||x)||(!r[e.id]&&(r[e.id]=!0,i[e.title]=[...(p=i[e.title])!=null?p:[],e]),r[o.id])||(r[o.id]=!0,i[e.title]=[...(f=i[e.title])!=null?f:[],o])})),i},Mt=()=>{const{t:a}=C(),[r,i]=y("libraryDuplicatesGridLayout",b.List),[e,o]=y("libraryDuplicatesCheckAlternativeTitles",!1),{setTitle:h,setAction:u}=c.useContext(D);c.useEffect(()=>(h(a("library.settings.advanced.duplicates.label.title")),u(t.jsxs(t.Fragment,{children:[t.jsx(_,{gridLayout:r,onChange:i}),t.jsx(A,{variant:"popover",popupId:"library-dupliactes-settings",children:s=>t.jsxs(t.Fragment,{children:[t.jsx(T,{...E(s),children:t.jsx(G,{})}),t.jsx(B,{...w(s),children:t.jsx(I,{children:t.jsx(z,{label:a("library.settings.advanced.duplicates.settings.label.check_description"),checked:e,onChange:(m,v)=>o(v)})})})]})})]})),()=>{h(""),u(null)}),[a,r,e]);const{data:n,loading:x,error:g,refetch:j}=O.useGetMangas({condition:{inLibrary:!0}}),l=c.useMemo(()=>{var m;const s=(m=n==null?void 0:n.mangas.nodes)!=null?m:[];return e?q(s):V(s)},[n==null?void 0:n.mangas.nodes,e]),d=c.useMemo(()=>Object.keys(l),[l]),p=c.useMemo(()=>Object.values(l).flat(),[l]),f=c.useMemo(()=>Object.values(l).map(s=>s.length),[l]);return x?t.jsx(k,{}):g?t.jsx(S,{message:a(""),messageExtra:g.message,retry:()=>j().catch(F())}):r===b.List?t.jsx(H,{style:{height:"undefined"},groupCounts:f,groupContent:s=>t.jsx(L,{variant:"h5",isFirstItem:s===0,children:d[s]}),itemContent:s=>t.jsx(M,{sx:{px:1,pb:1},children:t.jsx(P,{manga:p[s],gridLayout:r,selected:null,mode:"duplicate"})},p[s].id)}):d.map((s,m)=>t.jsxs(M,{children:[t.jsx(L,{sx:{pt:m===0?void 0:0,pb:0},variant:"h5",isFirstItem:!1,children:s}),t.jsx(N,{mangas:l[s],hasNextPage:!1,loadMore:()=>{},isLoading:!1,gridLayout:r,horizontal:!0,mode:"duplicate"})]},s))};export{Mt as LibraryDuplicates};
