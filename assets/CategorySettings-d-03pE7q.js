import{u as I,j as e,B as u,C as H,b as P,T as v,d as M,k as T,I as S,K as q,r as i,f as z,h as n,b5 as K,as as U,l as V,E as W,m as Z,n as J,p as Q,ao as X,aK as Y,aL as $,aZ as ee,b6 as te,a0 as ae,aN as oe,e as _}from"./index-b9u_iuUy.js";import{D as se,a as re,S as ne,P as le}from"./StrictModeDroppable-Bcuvmg7o.js";import{D as ie,F as ce}from"./StyledFab-L36ISSSa.js";import{E as de}from"./Edit-BcG7Jlhs.js";const ge=({category:a,provided:r,onEdit:c})=>{const{t:s}=I(),x=()=>{i.deleteCategory(a.id)};return e.jsx(u,{sx:{p:1,pb:0},...r.draggableProps,...r.dragHandleProps,ref:r.innerRef,children:e.jsx(H,{children:e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5,"&:last-child":{paddingBottom:1.5},gap:2},children:[e.jsx(se,{}),e.jsx(v,{sx:{flexGrow:1},variant:"h6",component:"h2",children:a.name}),e.jsxs(M,{sx:{flexDirection:"row"},children:[e.jsx(T,{title:s("global.button.edit"),children:e.jsx(S,{component:u,onClick:c,size:"large",children:e.jsx(de,{})})}),e.jsx(T,{title:s("chapter.action.download.delete.label.action"),children:e.jsx(S,{component:u,onClick:x,size:"large",children:e.jsx(q,{})})})]})]})})})};function me(){const{t:a}=I(),{setTitle:r,setAction:c}=z();n.useLayoutEffect(()=>(r(a("category.title.category_other")),c(null),()=>{r(""),c(null)}),[a]);const{data:s,loading:x,error:C,refetch:k}=i.useGetCategories(K,{notifyOnNetworkStatusChange:!0}),l=n.useMemo(()=>{var o;const t=[...(o=s==null?void 0:s.categories.nodes)!=null?o:[]];return t.length>0&&t[0].name==="Default"&&t.shift(),t},[s]),[h,b]=n.useState(-1),[F,d]=n.useState(!1),[p,m]=n.useState(""),[f,j]=n.useState(!1),[B,{reset:w}]=i.useReorderCategory(),D=U(),A=(t,o,g)=>{const y=t[o];B({variables:{input:{id:y.id,position:g+1}}}).catch(()=>w())},L=t=>{t.destination&&A(l,t.source.index,t.destination.index)},R=()=>{m(""),j(!1),b(-1)},G=()=>{R(),d(!0)},N=t=>{m(l[t].name),j(l[t].default),b(t),d(!0)},E=()=>{d(!1)},O=()=>{if(d(!1),h===-1)i.createCategory({name:p,default:f});else{const t=l[h];i.updateCategory(t.id,{name:p,default:f})}};return x?e.jsx(V,{}):C?e.jsx(W,{message:a("category.error.label.request_failure"),messageExtra:Z(C),retry:()=>k().catch(J())}):e.jsxs(e.Fragment,{children:[e.jsx(re,{onDragEnd:L,children:e.jsx(ne,{droppableId:"droppable",children:t=>e.jsxs(u,{ref:t.innerRef,sx:{paddingBottom:ie},children:[l.map((o,g)=>e.jsx(le,{draggableId:o.id.toString(),index:g,children:y=>e.jsx(ge,{provided:y,category:o,onEdit:()=>N(g)})},o.id)),t.placeholder]})})}),e.jsx(ce,{color:"primary","aria-label":"add",style:{position:"fixed",bottom:D.spacing(2),right:D.spacing(2)},onClick:G,children:e.jsx(Q,{})}),e.jsxs(X,{open:F,onClose:E,children:[e.jsx(Y,{id:"form-dialog-title",children:a(h===-1?"category.dialog.title.new_category":"category.dialog.title.edit_category")}),e.jsxs($,{children:[e.jsx(ee,{autoFocus:!0,margin:"dense",id:"name",label:a("category.label.category_name"),type:"text",fullWidth:!0,value:p,onChange:t=>m(t.target.value)}),e.jsx(te,{control:e.jsx(ae,{checked:f,onChange:t=>j(t.target.checked)}),label:a("category.label.use_as_default_category")})]}),e.jsxs(oe,{children:[e.jsx(_,{onClick:E,color:"primary",children:a("global.button.cancel")}),e.jsx(_,{onClick:O,color:"primary",children:a("global.button.submit")})]})]})]})}export{me as CategorySettings};
