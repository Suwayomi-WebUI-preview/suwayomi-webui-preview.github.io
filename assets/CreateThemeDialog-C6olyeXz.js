import{u as Se,e as Te,aq as ye,f as _,j as c,o as ve,p as Ne,q as ke,i as je,aM as Ae,g as se,k as _e,b as Y,T as Ee,b9 as ie,d9 as Oe,bJ as $e,w as Ie,B as ae,m as x,F as De}from"./index-CmeAoKHp.js";import{C as Ue}from"./CheckboxInput-DWcU9fom.js";import{T as Me}from"./Trans-mjYZUKB1.js";import{L as ee}from"./Link-B2iSjP9_.js";class E extends Error{constructor(e,r){super("".concat(e," at position ").concat(r)),this.position=r}}const pe=32,Ve=10,ge=9,be=13,We=160,Je=8192,Be=8202,Le=8239,Qe=8287,ze=12288;function Fe(n){return/^[0-9A-Fa-f]$/.test(n)}function y(n){return n>="0"&&n<="9"}function Pe(n){return n>=" "}function z(n){return",:[]/{}()\n+".includes(n)}function oe(n){return n>="a"&&n<="z"||n>="A"&&n<="Z"||n==="_"||n==="$"}function ce(n){return n>="a"&&n<="z"||n>="A"&&n<="Z"||n==="_"||n==="$"||n>="0"&&n<="9"}const ue=/^(http|https|ftp|mailto|file|data|irc):\/\/$/,le=/^[A-Za-z0-9-._~:/?#@!$&'()*+;=]$/;function fe(n){return",[]/{}\n+".includes(n)}function he(n){return F(n)||qe.test(n)}const qe=/^[[{\w-]$/;function Ke(n){return n==="\n"||n==="\r"||n==="	"||n==="\b"||n==="\f"}function v(n,e){const r=n.charCodeAt(e);return r===pe||r===Ve||r===ge||r===be}function Re(n,e){const r=n.charCodeAt(e);return r===pe||r===ge||r===be}function Ze(n,e){const r=n.charCodeAt(e);return r===We||r>=Je&&r<=Be||r===Le||r===Qe||r===ze}function F(n){return we(n)||ne(n)}function we(n){return n==='"'||n==="“"||n==="”"}function de(n){return n==='"'}function ne(n){return n==="'"||n==="‘"||n==="’"||n==="`"||n==="´"}function me(n){return n==="'"}function V(n,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const N=n.lastIndexOf(e);return N!==-1?n.substring(0,N)+(r?"":n.substring(N+1)):n}function d(n,e){let r=n.length;if(!v(n,r-1))return n+e;for(;v(n,r-1);)r--;return n.substring(0,r)+e+n.substring(r)}function He(n,e,r){return n.substring(0,e)+n.substring(e+r)}function Ge(n){return/[,\n][ \t\r]*$/.test(n)}const Xe={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},Ye={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"};function xe(n){let e=0,r="";j(["```","[```","{```"]),C()||H(),j(["```","```]","```}"]);const O=S(",");for(O&&a(),he(n[e])&&Ge(r)?(O||(r=d(r,",")),D()):O&&(r=V(r,","));n[e]==="}"||n[e]==="]";)e++,a();if(e>=n.length)return r;L();function C(){a();const t=I()||K()||m()||B()||R()||U(!1)||Z();return a(),t}function a(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const s=e;let i=k(t);do i=P(),i&&(i=k(t));while(i);return e>s}function k(t){const s=t?v:Re;let i="";for(;;)if(s(n,e))i+=n[e],e++;else if(Ze(n,e))i+=" ",e++;else break;return i.length>0?(r+=i,!0):!1}function P(){if(n[e]==="/"&&n[e+1]==="*"){for(;e<n.length&&!en(n,e);)e++;return e+=2,!0}if(n[e]==="/"&&n[e+1]==="/"){for(;e<n.length&&n[e]!=="\n";)e++;return!0}return!1}function j(t){if(q(t)){if(oe(n[e]))for(;e<n.length&&ce(n[e]);)e++;return a(),!0}return!1}function q(t){k(!0);for(const s of t){const i=e+s.length;if(n.slice(e,i)===s)return e=i,!0}return!1}function S(t){return n[e]===t?(r+=n[e],e++,!0):!1}function A(t){return n[e]===t?(e++,!0):!1}function l(){return A("\\")}function $(){return a(),n[e]==="."&&n[e+1]==="."&&n[e+2]==="."?(e+=3,a(),A(","),!0):!1}function I(){if(n[e]==="{"){r+="{",e++,a(),A(",")&&a();let t=!0;for(;e<n.length&&n[e]!=="}";){let s;if(t?(s=!0,t=!1):(s=S(","),s||(r=d(r,",")),a()),$(),!(m()||U(!0))){n[e]==="}"||n[e]==="{"||n[e]==="]"||n[e]==="["||n[e]===void 0?r=V(r,","):re();break}a();const Q=S(":"),T=e>=n.length;Q||(he(n[e])||T?r=d(r,":"):G()),C()||(Q||T?r+="null":G())}return n[e]==="}"?(r+="}",e++):r=d(r,"}"),!0}return!1}function K(){if(n[e]==="["){r+="[",e++,a(),A(",")&&a();let t=!0;for(;e<n.length&&n[e]!=="]";)if(t?t=!1:S(",")||(r=d(r,",")),$(),!C()){r=V(r,",");break}return n[e]==="]"?(r+="]",e++):r=d(r,"]"),!0}return!1}function D(){let t=!0,s=!0;for(;s;)t?t=!1:S(",")||(r=d(r,",")),s=C();s||(r=V(r,",")),r="[\n".concat(r,"\n]")}function m(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,i=n[e]==="\\";if(i&&(e++,i=!0),F(n[e])){const Q=de(n[e])?de:me(n[e])?me:ne(n[e])?ne:we,T=e,M=r.length;let o='"';for(e++;;){if(e>=n.length){const u=f(e-1);return!t&&z(n.charAt(u))?(e=T,r=r.substring(0,M),m(!0)):(o=d(o,'"'),r+=o,!0)}if(e===s)return o=d(o,'"'),r+=o,!0;if(Q(n[e])){const u=e,X=o.length;if(o+='"',e++,r+=o,a(!1),t||e>=n.length||z(n[e])||F(n[e])||y(n[e]))return J(),!0;const w=f(u-1),te=n.charAt(w);if(te===",")return e=T,r=r.substring(0,M),m(!1,w);if(z(te))return e=T,r=r.substring(0,M),m(!0);r=r.substring(0,M),e=u+1,o="".concat(o.substring(0,X),"\\").concat(o.substring(X))}else if(t&&fe(n[e])){if(n[e-1]===":"&&ue.test(n.substring(T+1,e+2)))for(;e<n.length&&le.test(n[e]);)o+=n[e],e++;return o=d(o,'"'),r+=o,J(),!0}else if(n[e]==="\\"){const u=n.charAt(e+1);if(Ye[u]!==void 0)o+=n.slice(e,e+2),e+=2;else if(u==="u"){let w=2;for(;w<6&&Fe(n[e+w]);)w++;w===6?(o+=n.slice(e,e+6),e+=6):e+w>=n.length?e=n.length:Ce()}else o+=u,e+=2}else{const u=n.charAt(e);u==='"'&&n[e-1]!=="\\"?(o+="\\".concat(u),e++):Ke(u)?(o+=Xe[u],e++):(Pe(u)||b(u),o+=u,e++)}i&&l()}}return!1}function J(){let t=!1;for(a();n[e]==="+";){t=!0,e++,a(),r=V(r,'"',!0);const s=r.length;m()?r=He(r,s,1):r=d(r,'"')}return t}function B(){const t=e;if(n[e]==="-"){if(e++,h())return g(t),!0;if(!y(n[e]))return e=t,!1}for(;y(n[e]);)e++;if(n[e]==="."){if(e++,h())return g(t),!0;if(!y(n[e]))return e=t,!1;for(;y(n[e]);)e++}if(n[e]==="e"||n[e]==="E"){if(e++,(n[e]==="-"||n[e]==="+")&&e++,h())return g(t),!0;if(!y(n[e]))return e=t,!1;for(;y(n[e]);)e++}if(!h())return e=t,!1;if(e>t){const s=n.slice(t,e),i=/^0\d/.test(s);return r+=i?'"'.concat(s,'"'):s,!0}return!1}function R(){return p("true","true")||p("false","false")||p("null","null")||p("True","true")||p("False","false")||p("None","null")}function p(t,s){return n.slice(e,e+t.length)===t?(r+=s,e+=t.length,!0):!1}function U(t){const s=e;if(oe(n[e])){for(;e<n.length&&ce(n[e]);)e++;let i=e;for(;v(n,i);)i++;if(n[i]==="(")return e=i+1,C(),n[e]===")"&&(e++,n[e]===";"&&e++),!0}for(;e<n.length&&!fe(n[e])&&!F(n[e])&&(!t||n[e]!==":");)e++;if(n[e-1]===":"&&ue.test(n.substring(s,e+2)))for(;e<n.length&&le.test(n[e]);)e++;if(e>s){for(;v(n,e-1)&&e>0;)e--;const i=n.slice(s,e);return r+=i==="undefined"?"null":JSON.stringify(i),n[e]==='"'&&e++,!0}}function Z(){if(n[e]==="/"){const t=e;for(e++;e<n.length&&(n[e]!=="/"||n[e-1]==="\\");)e++;return e++,r+='"'.concat(n.substring(t,e),'"'),!0}}function f(t){let s=t;for(;s>0&&v(n,s);)s--;return s}function h(){return e>=n.length||z(n[e])||v(n,e)}function g(t){r+="".concat(n.slice(t,e),"0")}function b(t){throw new E("Invalid character ".concat(JSON.stringify(t)),e)}function L(){throw new E("Unexpected character ".concat(JSON.stringify(n[e])),e)}function H(){throw new E("Unexpected end of json string",n.length)}function re(){throw new E("Object key expected",e)}function G(){throw new E("Colon expected",e)}function Ce(){const t=n.slice(e,e+6);throw new E('Invalid unicode character "'.concat(t,'"'),e)}}function en(n,e){return n[e]==="*"&&n[e+1]==="/"}const nn={id:"",isCustom:!0,getName:()=>"",muiTheme:{colorSchemes:{light:{palette:{primary:{main:"#1976d2"},secondary:{main:"#9c27b0"}}},dark:{palette:{primary:{main:"#1976d2"},secondary:{main:"#9c27b0"}}}}}},W={create:{title:"settings.appearance.theme.create.title",button:"global.button.ok",action:"settings.appearance.theme.create.action",success:"settings.appearance.theme.create.success",failure:"settings.appearance.theme.create.failure"},edit:{title:"settings.appearance.theme.edit.title",button:"global.button.save",action:"settings.appearance.theme.edit.action",success:"settings.appearance.theme.edit.success",failure:"settings.appearance.theme.edit.failure"},save_dynamic:{title:"settings.appearance.manga_dynamic_color_schemes.save",button:"global.button.save",action:"settings.appearance.theme.create.action",success:"settings.appearance.theme.create.success",failure:"settings.appearance.theme.create.failure"}},on=({mode:n,appTheme:e=nn,isVisible:r,onExitComplete:N,onSubmit:O,onDismiss:C})=>{const{t:a}=Se(),{settings:{customThemes:k},request:{loading:P,error:j,refetch:q}}=Te(),{setAppTheme:S}=ye(),A=De(f=>{throw f}),[l,$]=_.useState(e),[I,K]=_.useState(!1),[D,m]=_.useState(!1),[J,B]=_.useState(!1),[R,p]=_.useState(n==="create"),[U,Z]=_.useState(!1);return c.jsxs(ve,{open:r,onTransitionExited:N,fullWidth:!0,maxWidth:"md",children:[c.jsx(Ne,{children:a(W[n].title)}),c.jsxs(ke,{children:[P&&c.jsx(je,{}),j&&c.jsx(Ae,{message:a("global.error.label.failed_to_load_data"),messageExtra:se(j),retry:()=>q().catch(_e())}),!j&&c.jsxs(Y,{sx:{gap:2,whiteSpace:"pre-line"},children:[c.jsx(Ee,{children:c.jsxs(Me,{i18nKey:"settings.appearance.theme.create.dialog.description",children:[c.jsx(ee,{href:"https://mui.com/material-ui/customization/how-to-customize/",target:"_blank",rel:"noreferrer",children:"MUI documentation"}),c.jsx(ee,{href:"https://mui.com/material-ui/customization/palette/#color-schemes",target:"_blank",rel:"noreferrer",children:"MUI documentation"}),c.jsx(ee,{href:"https://zenoo.github.io/mui-theme-creator/",target:"_blank",rel:"noreferrer",children:"MUI Theme Creator"})," ",', copy everything after "themeOptions" from "',"{",'" to "',"}",'" and paste it into the "theme" text field.']})}),c.jsx(ie,{disabled:n==="edit",label:a("settings.appearance.theme.create.dialog.theme_name"),value:l.getName(),error:I,helperText:I&&a("settings.appearance.theme.create.dialog.error.invalid_name"),onChange:f=>{const h=f.target.value.trim(),g=h.length<=32,b=Oe(h,k);K(!g||!b),$({...l,id:f.target.value,getName:()=>f.target.value})}}),c.jsx(ie,{label:a("settings.appearance.theme.title"),multiline:!0,error:D,helperText:D&&a("settings.appearance.theme.create.dialog.error.invalid_json"),defaultValue:JSON.stringify(l.muiTheme,null,2),onChange:f=>{const h="invalid",g=(()=>{try{return xe(f.target.value)}catch(G){return h}})(),b=$e(g),L=g===h||!b,H=JSON.stringify(b)!==JSON.stringify(e.muiTheme);p(n==="create"?!0:H),m(L),!L&&JSON.stringify(b)!==JSON.stringify(l.muiTheme)&&$({...l,muiTheme:b})}})]})]}),c.jsx(Ie,{children:c.jsxs(Y,{sx:{width:"100%"},children:[c.jsx(Ue,{sx:{margin:0},size:"small",label:a("settings.appearance.manga_dynamic_color_schemes.set_active"),checked:U,onChange:(f,h)=>Z(h)}),c.jsxs(Y,{sx:{flexDirection:"row",justifyContent:"end"},children:[c.jsx(ae,{autoFocus:!0,onClick:()=>C(),color:"primary",children:a("global.button.cancel")}),c.jsx(ae,{disabled:D||I||J||!R||!l.id.length,onClick:()=>{x(a(W[n].action,{theme:l.getName()}),"info"),B(!0),A("customThemes",{...k,[l.id]:l}).then(()=>{x(a(W[n].success,{theme:l.getName()}),"success"),U&&S(l.getName()),O()}).catch(f=>x(a(W[n].failure,{theme:l.getName()}),"error",se(f))).finally(()=>B(!1))},color:"primary",children:a(W[n].button)})]})]})})]})};export{on as T};
