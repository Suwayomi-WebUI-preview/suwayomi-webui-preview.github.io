var I=Object.freeze,M=Object.defineProperty;var k=(o,l)=>I(M(o,"raw",{value:I(l||o.slice())}));import{u as v,j as e,z as C,T as q,S as U,C as A,I as F,r as p,b as g,i as W,k as P,n as V,aV as z,q as K,B as O,m as L,g as y,aW as X,e as Y,f as J,aX as Q}from"./index-DtQrBt4M.js";import{A as Z}from"./Add-DcmrN_3d.js";import{D as $,a as ee,b as te,c as oe,S as ae,v as re,d as se,e as ne}from"./DragHandle-BPLJrsUE.js";import{D as ie,F as le}from"./StyledFab-BYjwCb63.js";import{E as de}from"./EmptyViewAbsoluteCentered-DI8B4Znn.js";import{E as ce}from"./Edit-D4VHRjNX.js";import{D as ge}from"./Delete-FiCE_LSZ.js";import{L as me}from"./ListCardContent-CNnYMY6x.js";import{C as ue}from"./Card-BbwqA1T1.js";import{u as xe}from"./useAppTitle-BJQWe9Un.js";import{a as pe}from"./Asserts-C0856h9S.js";import{F as he,C as fe}from"./Checkbox-BflEth31.js";import"./SwitchBase-DsJUurlx.js";const w=({category:o,onEdit:l})=>{const{t:s}=v(),a=()=>{p.deleteCategory(o.id)};return e.jsx(C,{sx:{p:1,pb:0},children:e.jsx(ue,{children:e.jsxs(me,{sx:{gap:2},children:[e.jsx($,{}),e.jsx(q,{sx:{flexGrow:1},variant:"h6",component:"h2",children:o.name}),e.jsxs(U,{sx:{flexDirection:"row"},children:[e.jsx(A,{title:s("global.button.edit"),children:e.jsx(F,{component:C,onClick:l,children:e.jsx(ce,{})})}),e.jsx(A,{title:s("chapter.action.download.delete.label.action"),children:e.jsx(F,{component:C,onClick:a,children:e.jsx(ge,{})})})]})]})})})},_=-1;var G;const Ce=({category:o,onClose:l})=>{const s=!!o,{t:a}=v(),[n,j]=g.useState(o==null?void 0:o.name),[m,D]=g.useState(!!(o!=null&&o.default)),u=n!==void 0&&!n.trim().length,h=n!==void 0&&!u,b=()=>{if(pe(n),l(),s){p.updateCategory(o.id,{name:n,default:m}).response.catch(i=>L(a("global.error.label.failed_to_save_changes"),"error",y(i)));return}p.createCategory({name:n,default:m}).response.catch(i=>L(a("category.error.label.create_failure"),"error",y(i)))};return e.jsxs(W,{open:!0,onClose:l,children:[e.jsx(P,{id:"form-dialog-title",children:a(s?"category.dialog.title.edit_category_one":"category.dialog.title.new_category")}),e.jsxs(V,{children:[e.jsx(z,{autoFocus:!0,margin:"dense",id:"name",label:a("category.label.category_name"),type:"text",fullWidth:!0,value:n,onChange:i=>j(i.target.value.trim()),error:u,helperText:u?a(G||(G=k(["global.error.label.invalid_input"]))):void 0}),e.jsx(he,{control:e.jsx(fe,{checked:m,onChange:i=>D(i.target.checked)}),label:a("category.label.use_as_default_category")})]}),e.jsxs(K,{children:[e.jsx(O,{onClick:l,color:"primary",children:a("global.button.cancel")}),e.jsx(O,{onClick:b,color:"primary",disabled:!h,children:a("global.button.submit")})]})]})};function Le(){const{t:o}=v(),l=ee.useSensorsForDevice();xe(o("category.dialog.title.edit_category_other"));const{data:s,loading:a,error:n,refetch:j}=p.useGetCategories(X,{notifyOnNetworkStatusChange:!0}),[m,{reset:D}]=p.useReorderCategory(),[u,h]=g.useState(_),[b,i]=g.useState(!1),[x,f]=g.useState(null),d=g.useMemo(()=>{var r;const t=[...(r=s==null?void 0:s.categories.nodes)!=null?r:[]];return t.length>0&&t[0].name==="Default"&&t.shift(),t},[s]),R=(t,r,c)=>{const E=t[r];m({variables:{input:{id:E.id,position:c+1}}}).catch(()=>D())},B=t=>{const{active:r,over:c}=t;if(f(null),!c||r.id===c.id)return;const E=d.findIndex(S=>S.id===r.id),H=d.findIndex(S=>S.id===c.id);R(d,E,H)},T=t=>{h(t!=null?t:_),i(!0)},N=()=>{h(_),i(!1)};return a?e.jsx(Y,{}):n?e.jsx(de,{message:o("category.error.label.request_failure"),messageExtra:y(n),retry:()=>j().catch(J())}):e.jsxs(e.Fragment,{children:[e.jsx(te,{sensors:l,collisionDetection:oe,onDragStart:t=>{var r;return f((r=d.find(c=>c.id===t.active.id))!=null?r:null)},onDragEnd:B,onDragCancel:()=>f(null),onDragAbort:()=>f(null),children:e.jsxs(C,{sx:{paddingBottom:ie},children:[e.jsx(ae,{items:d,strategy:re,children:d.map((t,r)=>e.jsx(se,{id:t.id,isDragging:t.id===(x==null?void 0:x.id),children:e.jsx(w,{category:t,onEdit:()=>T(r)})},t.id))}),e.jsx(ne,{isActive:!!x,children:e.jsx(w,{category:x,onEdit:Q})})]})}),e.jsx(le,{color:"primary","aria-label":"add",sx:{position:"fixed",bottom:t=>t.spacing(2),right:t=>t.spacing(2)},onClick:()=>T(),children:e.jsx(Z,{})}),b&&e.jsx(Ce,{category:d[u],onClose:N})]})}export{Le as CategorySettings};
