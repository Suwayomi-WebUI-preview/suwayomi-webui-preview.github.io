import{J as k,H as y,s as S,_ as p,c,O as A,Q as w,bE as F,j as t,U as P,V as U,u as _,a as x,an as M,y as I,bF as R,D as N,af as D,ag as E,ah as W,b as f,m as b,N as $,E as O,g as B,o as v,ab as C,as as V}from"./index-Zl59rTnr.js";import{P as J,b as q,c as G}from"./index-D03_UwGI.js";import{P as H}from"./PasswordTextField-D4MXzy1a.js";import{A as Q}from"./Avatar-922Wk_ln.js";import{C as z}from"./Chip-DIc23AWH.js";import{T as K}from"./TextField-lew-bJf8.js";import{u as X,c as Y}from"./metadataServerSettings-Bu9SBxLq.js";import{S as T}from"./Switch-Dz039eWF.js";import"./InputAdornment-C6brfzM8.js";import"./metadata-3dsaWhfv.js";import"./SwitchBase-B5dQFXOZ.js";function Z(e){return k("MuiListItemAvatar",e)}y("MuiListItemAvatar",["root","alignItemsFlexStart"]);const ee=["className"],te=e=>{const{alignItems:s,classes:n}=e;return U({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},Z,n)},se=S("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[s.root,n.alignItems==="flex-start"&&s.alignItemsFlexStart]}})(({ownerState:e})=>p({minWidth:56,flexShrink:0},e.alignItems==="flex-start"&&{marginTop:8})),ae=c.forwardRef(function(s,n){const i=A({props:s,name:"MuiListItemAvatar"}),{className:d}=i,r=w(i,ee),m=c.useContext(F),o=p({},i,{alignItems:m.alignItems}),u=te(o);return t.jsx(se,p({className:P(u.root,d),ownerState:o,ref:n},r))}),ne=ae,ie=({tracker:e})=>{const{t:s}=_(),[n,{loading:i}]=x.useLoginToTrackerCredentials(),[d]=x.useLogoutFromTracker(),[r,m]=c.useState(""),[o,u]=c.useState(""),g=!e.isLoggedIn&&!!e.authUrl,l=async()=>{try{await d({variables:{trackerId:e.id}})}catch(a){b(s("tracking.action.logout.label.failure",{name:e.name}),"error")}},j=async()=>{if(g){const a={redirectUrl:"".concat(window.location.origin,"/tracker/login/oauth"),clientName:"Suwayomi-WebUI",trackerId:e.id,trackerName:e.name};window.open("".concat(e.authUrl,"&state=").concat(JSON.stringify(a)),"_self");return}try{await n({variables:{input:{trackerId:e.id,username:r,password:o}}})}catch(a){b(s("tracking.action.login.label.failure",{name:e.name}),"error")}},L=a=>{if(!g){a();return}j()};return t.jsx(J,{variant:"popover",popupId:"tracker-dialog",children:a=>t.jsxs(t.Fragment,{children:[t.jsxs(M,{...q(a),onClick:()=>L(a.open),onTouchStart:()=>L(a.open),children:[t.jsx(ne,{sx:{paddingRight:"20px"},children:t.jsx(Q,{alt:"".concat(e.name),src:x.getValidImgUrlFor(e.icon),variant:"rounded",sx:{width:64,height:64}})}),t.jsx(I,{primary:e.name}),e.isLoggedIn&&t.jsx(R,{children:t.jsx(z,{label:s("global.label.logged_in"),color:"success"})})]}),t.jsxs(N,{...G(a),open:(e.isLoggedIn||!e.authUrl)&&a.isOpen,disableRestoreFocus:!0,children:[t.jsx(D,{children:s(e.isLoggedIn?"tracking.settings.dialog.title.log_out":"tracking.settings.dialog.title.log_in",{name:e.name})}),!g&&!e.isLoggedIn&&t.jsxs(E,{children:[t.jsx(K,{autoFocus:!0,margin:"dense",id:"username",name:"username",label:s("global.label.username"),type:"text",fullWidth:!0,variant:"standard",onChange:h=>m(h.target.value)}),t.jsx(H,{margin:"dense",fullWidth:!0,variant:"standard",onChange:h=>u(h.target.value)})]}),t.jsxs(W,{children:[t.jsx(f,{onClick:a.close,children:s("global.button.cancel")}),t.jsx(f,{variant:"contained",disabled:!g&&!e.isLoggedIn&&(i||!r.length||!o.length),onClick:()=>e.isLoggedIn?l():j(),children:s(e.isLoggedIn?"global.button.log_out":"global.button.log_in")})]})]})]})})},Ie=()=>{var g;const{t:e}=_(),{setTitle:s}=c.useContext($);c.useEffect(()=>{s(e("tracking.settings.title.settings"))},[e]);const{settings:{updateProgressAfterReading:n,updateProgressManualMarkRead:i}}=X(),d=Y(()=>b(e("global.error.label.failed_to_save_changes"),"error")),{data:r,loading:m,error:o}=x.useGetTrackerList(),u=(g=r==null?void 0:r.trackers.nodes)!=null?g:[];return o?t.jsx(O,{message:o.message}):m?t.jsx(B,{}):t.jsxs(t.Fragment,{children:[t.jsxs(v,{children:[t.jsxs(C,{children:[t.jsx(I,{primary:e("tracking.settings.label.update_progress_reading")}),t.jsx(T,{edge:"end",checked:n,onChange:l=>d("updateProgressAfterReading",l.target.checked)})]}),t.jsxs(C,{children:[t.jsx(I,{primary:e("tracking.settings.label.update_progress_manual"),secondary:e("tracking.settings.label.update_progress_reading_description")}),t.jsx(T,{edge:"end",checked:i,onChange:l=>d("updateProgressManualMarkRead",l.target.checked)})]})]}),t.jsx(v,{subheader:t.jsx(V,{component:"div",id:"tracking-trackers",children:e("tracking.settings.title.trackers")}),children:u.map(l=>t.jsx(ie,{tracker:l},l.id))})]})};export{Ie as TrackingSettings};
