var W=Object.freeze,ce=Object.defineProperty;var J=(e,t)=>W(ce(e,"raw",{value:W(t||e.slice())}));import{b as s,c as N,j as d,aG as le,aH as ie,p as ue,aA as de,B as G,ab as ge,u as ee,r as U,ev as te,i as fe,k as he,n as me,q as be,S as q,A as ae,L as pe,ew as ve,Z as Ce,m as j,g as R,a2 as B,f as A,ex as ye,Q as xe,ey as Se,R as Me,d as we,bg as z,ct as Te,ez as Ie}from"./index-kzF4ix3O.js";import{T as ke}from"./ThreeStateCheckboxInput-D3LxevZj.js";import{C as Le}from"./CheckboxInput-c_beFuW4.js";import{F as Ae}from"./FormGroup-Dbed61LD.js";var F=(e=>(e.Mouse="mouse",e.Touch="touch",e.Pointer="pointer",e))(F||{}),O=(e=>(e.CancelledByMovement="cancelled-by-movement",e.CancelledByRelease="cancelled-by-release",e.CancelledOutsideElement="cancelled-outside-element",e))(O||{});const Ee=["mousedown","mousemove","mouseup","mouseleave","mouseout"],_e=["touchstart","touchmove","touchend","touchcancel"],De=["pointerdown","pointermove","pointerup","pointerleave","pointerout"];function je(e){return typeof e=="object"&&e!==null&&"pageX"in e&&typeof e.pageX=="number"&&"pageY"in e&&typeof e.pageY=="number"}function Re(e){var t;return Ee.includes((t=e==null?void 0:e.nativeEvent)==null?void 0:t.type)}function ne(e){var t;return _e.includes((t=e==null?void 0:e.nativeEvent)==null?void 0:t.type)||"touches"in e}function Fe(e){const{nativeEvent:t}=e;return t?De.includes(t==null?void 0:t.type)||"pointerId"in t:!1}function H(e){return Re(e)||ne(e)||Fe(e)}function Q(e){var t;const a=ne(e)?(t=e==null?void 0:e.touches)==null?void 0:t[0]:e;return je(a)?{x:a.pageX,y:a.pageY}:null}function Oe(e){return{target:e.target,currentTarget:e.currentTarget,nativeEvent:e,persist:()=>{}}}function st(e,{threshold:t=400,captureEvent:a=!1,detect:o=F.Pointer,cancelOnMovement:r=!1,cancelOutsideElement:u=!0,filterEvents:i,onStart:g,onMove:w,onFinish:T,onCancel:I}={}){const b=s.useRef(!1),C=s.useRef(!1),y=s.useRef(),f=s.useRef(),x=s.useRef(e),p=s.useRef(null),v=s.useCallback(n=>l=>{C.current||H(l)&&(i!==void 0&&!i(l)||(a&&l.persist(),g==null||g(l,{context:n}),p.current=Q(l),C.current=!0,y.current=l.currentTarget,f.current=setTimeout(()=>{x.current&&(x.current(l,{context:n}),b.current=!0)},t)))},[a,i,g,t]),m=s.useCallback(n=>(l,c)=>{H(l)&&C.current&&(p.current=null,a&&l.persist(),b.current?T==null||T(l,{context:n}):C.current&&(I==null||I(l,{context:n,reason:c!=null?c:O.CancelledByRelease})),b.current=!1,C.current=!1,f.current!==void 0&&clearTimeout(f.current))},[a,T,I]),M=s.useCallback(n=>l=>{if(H(l)&&(w==null||w(l,{context:n}),r!==!1&&p.current)){const c=Q(l);if(c){const h=r===!0?25:r,E={x:Math.abs(c.x-p.current.x),y:Math.abs(c.y-p.current.y)};(E.x>h||E.y>h)&&m(n)(l,O.CancelledByMovement)}}},[m,r,w]),S=s.useCallback(n=>{if(e===null)return{};switch(o){case F.Mouse:{const l={onMouseDown:v(n),onMouseMove:M(n),onMouseUp:m(n)};return u&&(l.onMouseLeave=c=>{m(n)(c,O.CancelledOutsideElement)}),l}case F.Touch:return{onTouchStart:v(n),onTouchMove:M(n),onTouchEnd:m(n)};case F.Pointer:{const l={onPointerDown:v(n),onPointerMove:M(n),onPointerUp:m(n)};return u&&(l.onPointerLeave=c=>m(n)(c,O.CancelledOutsideElement)),l}}},[e,m,u,o,M,v]);return s.useEffect(()=>{function n(l){const c=Oe(l);m()(c)}return window.addEventListener("mouseup",n),window.addEventListener("touchend",n),window.addEventListener("pointerup",n),()=>{window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),window.removeEventListener("pointerup",n)}},[m]),s.useEffect(()=>()=>{f.current!==void 0&&clearTimeout(f.current)},[]),s.useEffect(()=>{x.current=e},[e]),S}const ct=N(d.jsx("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"})),lt=N(d.jsx("path",{d:"m1.79 12 5.58 5.59L5.96 19 .37 13.41zm.45-7.78L12.9 14.89l-1.28 1.28L7.44 12l-1.41 1.41L11.62 19l2.69-2.69 4.89 4.89 1.41-1.41L3.65 2.81zm14.9 9.27L23.62 7 22.2 5.59l-6.48 6.48zM17.96 7l-1.41-1.41-3.65 3.66 1.41 1.41z"})),it=N(d.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"})),ut=N(d.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"})),dt=({title:e,Icon:t,...a})=>d.jsxs(le,{...a,children:[d.jsx(ie,{children:d.jsx(t,{fontSize:"small"})}),d.jsx(ue,{children:e})]}),gt=(e,t)=>(a,o)=>{const r=o>0?" (".concat(o,")"):"";return"".concat(de(t[a].action[e?"single":"selected"])).concat(r)},ft=e=>(t=!1)=>e?t:!0,ht=e=>t=>e?!1:t,mt=s.forwardRef(({children:e,...t},a)=>d.jsx(G,{ref:a,...t,sx:{minWidth:"unset",px:"10px",...t.sx},children:e})),bt=N(d.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),pt=({children:e,onClose:t,...a})=>{const[o,r]=s.useState(!1);return d.jsx(ge,{...a,open:a.open,onClose:t,sx:{visibility:!a.open||o?"hidden":"visible"},children:e(()=>{t({},"backdropClick"),r(!1)},r)})},Ne=(e,{itemIds:t=[],keyCount:a=e,currentKey:o,initialState:r={}})=>{var S;const[u,i]=s.useState(r),g=s.useRef(void 0),w=[...new Set(Object.values(u).flat())],T=w.length===e,I=!w.length,b=(S=u[o])!=null?S:[],C=b.length===a,y=b.length===0;y&&(g.current=void 0);const f=s.useCallback((n,l,{selectRange:c=!1,key:h=o}={})=>{var K;const E=!l,{id:k,key:oe}=(K=g.current)!=null?K:{};g.current={id:n,key:h};const P=c&&h===oe&&k!==void 0,V=P?t.indexOf(k):-1,Y=P?t.indexOf(n):-1,$=P?t.slice(Math.min(V,Y),Math.max(V,Y)+1):[n];if(E){i(_=>{var D,X;return{..._,[h]:(X=(D=_[h])==null?void 0:D.filter(se=>!$.includes(se)))!=null?X:[]}});return}i(_=>{var D;return{..._,[h]:[...new Set([...(D=_[h])!=null?D:[],...$])]}})},[o,t]),x=s.useCallback((n,l,c=o)=>{switch(n){case!0:i(h=>({...h,[c]:[...l]}));break;case!1:i(h=>({...h,[c]:[]}));break}},[o]),p=s.useCallback((n,l)=>{i(c=>({...c,[n]:[...l]}))},[]),v=s.useCallback(n=>u[n],[u]),m=s.useCallback(()=>{i({})},[]),M=s.useCallback(()=>{m(),i(r)},[m,r]);return{selectedItemIds:w,keySelectedItemIds:b,handleSelection:f,handleSelectAll:x,areAllItemsSelected:T,areNoItemsSelected:I,areAllItemsForKeySelected:C,areNoItemsForKeySelected:y,setSelectionForKey:p,getSelectionForKey:v,clearSelection:m,reset:M}},Ge=0;class L{static getIds(t){return t.map(a=>a.id)}static getUserCreated(t){return t.filter(a=>a.id!==Ge)}static getDefaults(t){return t.filter(a=>a.default)}}const Be=e=>{const{data:t}=U.useGetManga(ve,e!=null?e:-1,{skip:e===void 0});return s.useMemo(()=>e===void 0||!t?[]:L.getIds(t.manga.categories.nodes),[t==null?void 0:t.manga.categories.nodes,e])},Ue=(e,t,a,o)=>{if(t.includes(e))return!0;if(!o&&a.includes(e))return!1};function Pe(e){const{t}=ee(),{open:a,onClose:o,mangaId:r,mangaIds:u,addToLibrary:i=!1}=e,g=r!==void 0,w=u!=null?u:[r],[T,I]=s.useState(!1),b=Be(r),{data:C}=U.useGetCategories(te),y=C==null?void 0:C.categories.nodes,f=s.useMemo(()=>L.getUserCreated(y!=null?y:[]),[y]),x=s.useMemo(()=>i?L.getIds(L.getDefaults(f)):[],[f]),{handleSelection:p,setSelectionForKey:v,getSelectionForKey:m}=Ne(f.length,{currentKey:"categoriesToAdd",initialState:{categoriesToAdd:[...b,...x],categoriesToRemove:[]}});s.useEffect(()=>{v("categoriesToAdd",[...b,...x]),v("categoriesToRemove",[])},[b]);const M=m("categoriesToAdd"),S=m("categoriesToRemove"),n=()=>{v("categoriesToAdd",b),v("categoriesToRemove",[]),o(!1)},l=()=>{const c=g?M.filter(k=>!b.includes(k)):M,h=g?b.filter(k=>!M.includes(k)):S;o(!0,c,h),T&&Ce("showAddToLibraryCategorySelectDialog",!1).catch(k=>j(t("search.error.label.failed_to_save_settings"),"error",R(k))),(c.length||h.length)&&(i||B.performAction("change_categories",w,{changeCategoriesPatch:{addToCategories:c,removeFromCategories:h}}).catch(A()))};return d.jsxs(fe,{sx:{".MuiDialog-paper":{maxHeight:435,width:"80%"}},maxWidth:"xs",open:a,onClose:n,children:[d.jsx(he,{children:t("category.title.set_categories")}),d.jsx(me,{dividers:!0,children:d.jsxs(Ae,{children:[f.length===0&&d.jsx("span",{children:t("category.error.no_categories_found.label.info")}),f.map(c=>d.jsx(ke,{checked:Ue(c.id,M,S,g),onChange:h=>{p(c.id,!1,{key:"categoriesToAdd"}),p(c.id,!1,{key:"categoriesToRemove"}),h&&p(c.id,!0,{key:"categoriesToAdd"}),h===!1&&p(c.id,!0,{key:"categoriesToRemove"})},label:c.name},c.id))]})}),d.jsx(be,{children:d.jsxs(q,{sx:{width:"100%"},children:[i&&d.jsx(Le,{sx:{margin:0},size:"small",label:t("global.button.dont_show_dialog_again"),onChange:c=>I(c.target.checked)}),d.jsxs(q,{direction:"row",sx:{justifyContent:"space-between",alignItems:"end",width:"100%"},children:[d.jsx(G,{component:pe,to:ae.settings.childRoutes.categories.path,children:t(f.length?"global.button.edit":"global.button.create")}),d.jsxs(q,{direction:"row",children:[d.jsx(G,{autoFocus:!0,onClick:n,color:"primary",children:t("global.button.cancel")}),!!f.length&&d.jsx(G,{onClick:l,color:"primary",children:t("global.button.ok")})]})]})]})})]})}const qe=({mangaId:e,mangaIds:t,onClose:a,addToLibrary:o})=>{const[r,u]=s.useState(!1),i=s.useMemo(()=>r?d.jsx(Pe,{open:r,onClose:(...g)=>{u(!1),a==null||a(...g)},mangaId:e,mangaIds:t,addToLibrary:o}):null,[e,t,o,a,r]);return{openCategorySelect:u,CategorySelectComponent:i}},ze={...Se},He=e=>({...e,excludedScanlators:JSON.stringify(e.excludedScanlators)}),Ve=(e,t=ze,a)=>xe("manga",e,t,void 0,a),re=(e,t,a)=>Ve({...e,meta:Me(e.meta)},t,a),vt=(e,t)=>re(e,t),Ye=(e,t)=>{const a=re(e,t,s.useEffect);return s.useMemo(()=>a,[e,t])},$e=async(e,t,a)=>ye(e,[[t,He({[t]:a})[t]]]),Ke=(e,t=A())=>(a,o)=>$e(e,a,o).catch(t);function Xe(e,{isRead:t}){switch(e){case!0:return!t;case!1:return t;default:return!0}}function We(e,{isDownloaded:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function Je(e,{isBookmarked:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function Qe(e,{scanlator:t}){return!t||!e.includes(t)}const Ze=(e,{sortBy:t,reverse:a})=>{const o=[...e];switch(t){case"source":o.sort((r,u)=>r.sourceOrder-u.sourceOrder);break;case"fetchedAt":o.sort((r,u)=>{var i,g;return Number((i=r.fetchedAt)!=null?i:0)-Number((g=u.fetchedAt)!=null?g:0)});break;case"chapterNumber":o.sort((r,u)=>r.chapterNumber-u.chapterNumber);break;case"uploadedAt":o.sort((r,u)=>{var i,g;return Number((i=r.uploadDate)!=null?i:0)-Number((g=u.uploadDate)!=null?g:0)});break}return a&&o.reverse(),o};function et(e,t){return e.filter(a=>Xe(t.unread,a)&&We(t.downloaded,a)&&Je(t.bookmarked,a)&&Qe(t.excludedScanlators,a))}function Ct(e,t){const a=et(e,t);return Ze(a,t)}const yt=e=>{const{unread:t,downloaded:a,bookmarked:o,excludedScanlators:r}=e;return t!=null||a!=null||o!=null||!!r.length},xt=e=>{const{unread:t,downloaded:a,bookmarked:o,reverse:r,sortBy:u,showChapterNumber:i,excludedScanlators:g}=Ye(e);return s.useMemo(()=>({unread:t,downloaded:a,bookmarked:o,reverse:r,sortBy:u,showChapterNumber:i,excludedScanlators:g}),[t,a,o,r,u,i,g])},St=(e,t=A())=>Ke(e,t);var Z;const Mt=(e,t=!1)=>{var b,C;const{t:a}=ee(),o=we(),[r,u]=s.useState(!!e.inLibrary),i=s.useCallback((y,f=[],x=[])=>{y&&U.updateManga(e.id,{updateManga:{inLibrary:!0},updateMangaCategories:{addToCategories:f,removeFromCategories:x}}).response.then(()=>j(a("library.info.label.added_to_library"),"success")).then(()=>u(!0)).catch(p=>{j(a("library.error.label.add_to_library"),"error",R(p))})},[e.id]),g=s.useCallback(async()=>{t&&await z({title:a("global.label.are_you_sure"),message:a("manga.action.library.remove.dialog.label.message",{title:e.title}),actions:{confirm:{title:a("global.button.remove")}}}),await B.removeFromLibrary([e.id],!0),u(!1)},[e.id,t]),{openCategorySelect:w,CategorySelectComponent:T}=qe({mangaId:e.id,addToLibrary:!0,onClose:i}),I=s.useCallback(()=>{const y=async()=>{if(r){g().catch(A());return}let f;try{f=(await Ie()).showAddToLibraryCategorySelectDialog}catch(S){j(a("global.error.label.failed_to_load_data"),"error",R(S));return}let x;try{x=await U.getCategories(te).response}catch(S){j(a("category.error.label.request_failure"),"error",R(S));return}const p=L.getUserCreated(x.data.categories.nodes);let v;try{v=await B.getDuplicateLibraryMangas(e.title).response}catch(S){await z({title:a("global.error.label.failed_to_load_data"),message:a("manga.action.library.add.dialog.duplicate.label.failure",{error:R(S)}),actions:{extra:{show:!0,title:a("global.button.retry"),contain:!0},confirm:{title:a("global.button.add")}},onExtra:()=>y().catch(A())})}if((v==null?void 0:v.data.mangas.totalCount)&&await z({title:a("global.label.are_you_sure"),message:a("manga.action.library.add.dialog.duplicate.label.info"),actions:{extra:{show:!0,title:a("migrate.dialog.action.button.show_entry"),contain:!0},confirm:{title:a("global.button.add")}},onExtra:()=>o(ae.manga.path(v.data.mangas.nodes[0].id))}),!(f&&!!p.length)){i(!0,L.getIds(L.getDefaults(p)));return}w(!0)};y().catch(A())},[r,g,i]);return{CategorySelectComponent:T,updateLibraryState:I,isInLibrary:(C=(b=B.getFromCache(e.id,Te(Z||(Z=J(["\n                    fragment MangaInLibraryState on MangaType {\n                        inLibrary\n                    }\n                "]))),"MangaInLibraryState"))==null?void 0:b.inLibrary)!=null?C:r}};export{mt as C,it as D,ut as F,pt as M,lt as R,st as V,xt as a,St as b,Mt as c,qe as d,ft as e,Ct as f,dt as g,ct as h,yt as i,gt as j,ht as k,bt as l,vt as m,et as n,Ne as u};
