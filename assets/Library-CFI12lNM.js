import{u as F,t as A,a as M,j as e,G as S,c as h,g as ae,I as ue,r as me,i as ge,v as be,s as he,k as J,P as pe,N as fe,E as X,h as xe}from"./index-DfklFglD.js";import{u as P,S as re,A as ye,N as Ce}from"./AppbarSearch-BSOHiWG4.js";import{T as je,a as Se}from"./Tabs-C7c999sV.js";import{d as ke}from"./FilterList-Cf78USv8.js";import{C as I}from"./CheckboxInput-KCsH1oYu.js";import{S as _e,R as D}from"./SortRadioInput-ClQkMCJg.js";import{T as v}from"./ThreeStateCheckboxInput-byB4M3Hy.js";import{O as Le,S as we,a as Te}from"./SelectionFAB-DiBSqF-v.js";import{T as se}from"./Trackers-y2kGZe-r.js";import{F as w}from"./TextField-CayxvvBt.js";import{R as Me}from"./ListPreference-B-GstjFg.js";import{M as Fe,a as Ae}from"./MangaGrid-DDlUynYy.js";import{U as Ie}from"./UpdateChecker-DBzTyNqU.js";import{u as ve}from"./useManageMangaLibraryState-DTqcBB_c.js";import{C as Re}from"./Checkbox-l9Tb8bBM.js";import{T as Ne,a as Oe}from"./TabsMenu-CjhlR_Bh.js";import{C as De}from"./Chip-DGoyOcek.js";import"./StyledFab-B6X76Drs.js";import"./SwitchBase-DFDorVSP.js";import"./index-BfzuAxR7.js";import"./Delete-Bn34JGUD.js";import"./Sync-C3x00COy.js";import"./Mangas-B_3FaMhn.js";import"./Chapters-Bfm-begS.js";import"./SpinnerImage-DA4-HJ6P.js";import"./TypographyMaxLines-DOEP0QdL.js";import"./Link-D9Tvr723.js";import"./Avatar-TRL1BSE6.js";import"./PlayArrow-BXdB74U9.js";import"./Progress-CAZqOhKW.js";import"./Info-DxG20Nd6.js";import"./InputAdornment-B2lMFbn_.js";import"./Collapse-DsmQb-eo.js";import"./NumberSetting-CddEK8v8.js";import"./useMobilePicker-Dg4A6As7.js";import"./SelectSetting-DWEEpxNL.js";import"./Select-DN6lQiuD.js";const Ee={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},Pe=[["sortToRead","library.option.sort.label.by_unread_chapters"],["sortAlph","library.option.sort.label.alphabetically"],["sortDateAdded","library.option.sort.label.by_date_added"],["sortLastRead","library.option.sort.label.by_last_read"],["sortLatestFetchedChapter","library.option.sort.label.by_latest_fetched_chapter"],["sortLatestUploadedChapter","library.option.sort.label.by_latest_uploaded_chapter"]],Be=({open:a,onClose:o})=>{var g,y;const{t}=F(),{options:s,setOptions:i}=A(),d=M.useGetTrackerList(),c=se.getLoggedIn((y=(g=d.data)==null?void 0:g.trackers.nodes)!=null?y:[]),r=(b,l)=>{i(m=>({...m,[b]:l}))};return e.jsx(Le,{open:a,onClose:o,tabs:["filter","sort","display"],tabTitle:b=>t(Ee[b]),tabContent:b=>{if(b==="filter")return e.jsxs(e.Fragment,{children:[e.jsx(v,{label:t("global.filter.label.unread"),checked:s.unread,onChange:l=>r("unread",l)}),e.jsx(v,{label:t("global.filter.label.downloaded"),checked:s.downloaded,onChange:l=>r("downloaded",l)}),e.jsx(v,{label:t("global.filter.label.bookmarked"),checked:s.bookmarked,onChange:l=>r("bookmarked",l)}),e.jsx(w,{sx:{mt:2},children:t("global.filter.label.tracked")}),c.map(l=>e.jsx(v,{label:l.name,checked:s.tracker[l.id],onChange:m=>r("tracker",{...s.tracker,[l.id]:m})},l.id))]});if(b==="sort")return Pe.map(([l,m])=>e.jsx(_e,{label:t(m),checked:s.sorts===l,sortDescending:s.sortDesc,onClick:()=>l!==s.sorts?r("sorts",l):r("sortDesc",!s.sortDesc)},l));if(b==="display"){const{gridLayout:l,showContinueReadingButton:m,showDownloadBadge:u,showUnreadBadge:k,showTabSize:_}=s;return e.jsxs(e.Fragment,{children:[e.jsx(w,{children:t("global.grid_layout.title")}),e.jsxs(Me,{onChange:R=>r("gridLayout",Number(R.target.value)),value:l,children:[e.jsx(D,{label:t("global.grid_layout.label.compact_grid"),value:S.Compact,checked:l==null||l===S.Compact}),e.jsx(D,{label:t("global.grid_layout.label.comfortable_grid"),value:S.Comfortable,checked:l===S.Comfortable}),e.jsx(D,{label:t("global.grid_layout.label.list"),value:S.List,checked:l===S.List})]}),e.jsx(w,{sx:{mt:2},children:t("library.option.display.badge.title")}),e.jsx(I,{label:t("library.option.display.badge.label.unread_badges"),checked:k,onChange:()=>r("showUnreadBadge",!k)}),e.jsx(I,{label:t("library.option.display.badge.label.download_badges"),checked:u,onChange:()=>r("showDownloadBadge",!u)}),e.jsx(w,{sx:{mt:2},children:t("library.option.display.tab.title")}),e.jsx(I,{label:t("library.option.display.tab.label.show_number_of_items"),checked:_,onChange:()=>r("showTabSize",!_)}),e.jsx(w,{sx:{mt:2},children:t("global.label.other")}),e.jsx(I,{label:t("library.option.display.other.label.show_continue_reading_button"),checked:m,onChange:()=>r("showContinueReadingButton",!m)})]})}return null}})},Ge=()=>{const{t:a}=F(),[o,t]=h.useState(!1),{options:s}=A(),i=s.downloaded!=null||s.unread!=null||Object.values(s.tracker).some(d=>d!=null);return e.jsxs(e.Fragment,{children:[e.jsx(ae,{title:a("settings.title"),children:e.jsx(ue,{onClick:()=>t(!o),color:i?"warning":"default",children:e.jsx(ke,{})})}),e.jsx(Be,{open:o,onClose:()=>t(!1)})]})},Z=({showFilteredOutMessage:a,message:o,messageExtra:t,...s})=>{const{t:i}=F(),[d]=P("query",re),{options:c}=A(),{unread:r,downloaded:g}=c;return h.useEffect(()=>{window.scrollTo(0,0)},[d,r,g]),h.useLayoutEffect(()=>(document.body.style.overflowY=c.gridLayout===S.List?"auto":"scroll",()=>{document.body.style.overflowY="auto"}),[]),e.jsx(Fe,{...s,hasNextPage:!1,loadMore:()=>{},message:a?i("library.error.label.no_matches"):o,messageExtra:a?void 0:t,gridLayout:c.gridLayout})};var B={},ze=ge;Object.defineProperty(B,"__esModule",{value:!0});var oe=B.default=void 0,Ue=ze(me()),qe=e;oe=B.default=(0,Ue.default)((0,qe.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");const Ke=({isActive:a,areAllItemsSelected:o,areNoItemsSelected:t,onSelectAll:s,onModeChange:i})=>{const{t:d}=F();return e.jsxs(e.Fragment,{children:[a&&e.jsx(we,{areAllItemsSelected:o,areNoItemsSelected:t,onChange:s}),e.jsx(ae,{title:d(a?"global.button.cancel":"global.button.select_all"),children:e.jsx(Re,{checkedIcon:e.jsx(oe,{}),sx:{padding:"8px"},checked:a,onChange:(c,r)=>i(r)})})]})},le=(a,o,t)=>{switch(a){case!0:return o();case!1:return t();default:return!0}},E=(a,o)=>le(a,()=>!!o&&o>=1,()=>o===0),Qe=(a,{title:o})=>a?o.toLowerCase().includes(a.toLowerCase()):!0,We=(a,{genre:o})=>a?a.split(",").map(s=>s.toLowerCase().trim()).every(s=>o.map(i=>i.toLowerCase()).includes(s)):!0,Ve=(a,o)=>Object.entries(a).map(([t,s])=>{const d=se.getTrackers(o.trackRecords.nodes).some(c=>c.id===Number(t));return le(s,()=>d,()=>!d)}).every(t=>t),Ye=(a,o,t,s,i,d,c)=>a.filter(r=>{const g=c&&(o==null?void 0:o.length),y=Qe(o,r)||We(o,r),b=g||E(s,r.downloadCount)&&E(t,r.unreadCount)&&E(i,r.bookmarkCount)&&Ve(d,r);return y&&b}),T=(a=0,o=0)=>Number(a)-Number(o),He=(a,o)=>a.localeCompare(o),$e=(a,o,t)=>{const s=[...a];switch(o){case"sortAlph":s.sort((i,d)=>He(i.title,d.title));break;case"sortDateAdded":s.sort((i,d)=>T(i.inLibraryAt,d.inLibraryAt));break;case"sortToRead":s.sort((i,d)=>T(i.unreadCount,d.unreadCount));break;case"sortLastRead":s.sort((i,d)=>{var c,r;return T((c=i.lastReadChapter)==null?void 0:c.lastReadAt,(r=d.lastReadChapter)==null?void 0:r.lastReadAt)});break;case"sortLatestUploadedChapter":s.sort((i,d)=>{var c,r;return T((c=i.latestUploadedChapter)==null?void 0:c.uploadDate,(r=d.latestUploadedChapter)==null?void 0:r.uploadDate)});break;case"sortLatestFetchedChapter":s.sort((i,d)=>{var c,r;return T((c=i.latestFetchedChapter)==null?void 0:c.fetchedAt,(r=d.latestFetchedChapter)==null?void 0:r.fetchedAt)});break}return t&&s.reverse(),s},Je=a=>{const[o]=P("query",re),{options:t}=A(),{unread:s,downloaded:i,bookmarked:d,tracker:c}=t,{settings:r}=be(),g=h.useMemo(()=>Ye(a,o,s,i,d,c,r.ignoreFilters),[a,o,s,i,d,c,r.ignoreFilters]),y=h.useMemo(()=>$e(g,t.sorts,t.sortDesc),[g,t.sorts,t.sortDesc]),b=Object.values(t.tracker).some(m=>m!=null),l=(s!=null||i!=null||d!=null||!!o||b)&&g.length===0&&a.length>0;return{visibleMangas:y,showFilteredOutMessage:l}},ee=he("span")({display:"flex",alignItems:"center"}),te=a=>e.jsx(De,{...a,size:"small",sx:{marginLeft:"5px"}});function Ot(){var H,$;const{t:a}=F(),{options:o}=A(),{data:t,error:s,loading:i,refetch:d}=M.useGetCategories({notifyOnNetworkStatusChange:!0}),c=t==null?void 0:t.categories.nodes.filter(n=>n.id!==0||n.id===0&&n.mangas.totalCount),r=c!=null?c:[],g=h.useMemo(()=>r.map(n=>n.mangas.totalCount).reduce((n,p)=>n+p,0),[r]),[y,b]=P("tab",Ce),l=(H=r.find(n=>n.order===y))!=null?H:r[0],{data:m,error:u,loading:k,refetch:_}=M.useGetCategoryMangas(l==null?void 0:l.id,{skip:!l,notifyOnNetworkStatusChange:!0}),R=($=m==null?void 0:m.mangas.nodes)!=null?$:[],{visibleMangas:f,showFilteredOutMessage:G}=Je(R),z=h.useCallback(()=>_().catch(J()),[_,l]),ne=h.useMemo(()=>f.map(n=>n.id),[f]),[C,N]=h.useState(!1),{areNoItemsForKeySelected:U,areAllItemsForKeySelected:q,selectedItemIds:j,handleSelectAll:O,handleSelection:ie,clearSelection:de}=ve(f.length,{itemIds:ne,currentKey:l==null?void 0:l.id.toString()}),K=(n,p,x)=>{N(!!(j.length+(p?1:-1))),ie(n,p,x)},Q=h.useMemo(()=>j.map(n=>M.graphQLClient.client.cache.readFragment({id:M.graphQLClient.client.cache.identify({__typename:"MangaType",id:n}),fragment:pe,fragmentName:"PARTIAL_MANGA_FIELDS"})),[j.length,f]),W=h.useMemo(()=>C?e.jsx(Te,{selectedItemsCount:j.length,title:"manga.title",children:(n,p)=>e.jsx(Ae,{selectedMangas:Q,onClose:x=>{n(),N(x),x||de()},setHideMenu:p})}):null,[C,Q]),{setTitle:V,setAction:Y}=h.useContext(fe);h.useEffect(()=>{const n=a("library.title"),p=e.jsxs(ee,{children:[n,o.showTabSize&&e.jsx(te,{label:g})]});return V(p,n),Y(e.jsxs(e.Fragment,{children:[!C&&e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),e.jsx(Ge,{}),e.jsx(Ie,{})]}),e.jsx(Ke,{isActive:C,areAllItemsSelected:q,areNoItemsSelected:U,onSelectAll:x=>O(x,[...new Set(f.map(L=>L.id))]),onModeChange:x=>{N(x),x?O(!0,[...new Set(f.map(L=>L.id))]):r.forEach(L=>O(!1,[],L.id.toString()))}})]})),()=>{V(""),Y(null)}},[a,g,i,o,C,U,q,j.length,f.length]);const ce=n=>{b(n)};return s!=null?e.jsx(X,{message:a("category.error.label.request_failure"),messageExtra:s.message,retry:()=>d().catch(J())}):i?e.jsx(xe,{}):r.length===0?e.jsx(X,{message:a("library.error.label.empty")}):r.length===1?e.jsxs(e.Fragment,{children:[e.jsx(Z,{mangas:f,message:a(u?"manga.error.label.request_failure":"library.error.label.empty"),messageExtra:u==null?void 0:u.message,isLoading:k,selectedMangaIds:j,isSelectModeActive:C,handleSelection:K,showFilteredOutMessage:!u&&G,retry:u&&z}),W]}):e.jsxs(Ne,{children:[e.jsx(Oe,{value:l.order,onChange:(n,p)=>ce(p),tabsCount:r.length,children:r.map(n=>e.jsx(je,{sx:{display:"flex"},label:e.jsxs(ee,{children:[n.name,o.showTabSize?e.jsx(te,{label:n.mangas.totalCount}):null]}),value:n.order},n.id))}),r.map(n=>e.jsx(Se,{index:n.order,currentIndex:l.order,children:n===l&&e.jsx(Z,{mangas:f,message:a(u?"manga.error.label.request_failure":"library.error.label.empty"),messageExtra:u==null?void 0:u.message,isLoading:k,selectedMangaIds:j,isSelectModeActive:C,handleSelection:K,showFilteredOutMessage:!u&&G,retry:u&&z})},n.order)),W]})}export{Ot as Library};
