import{c as m,a0 as we,$ as ye,s as q,a3 as K,a4 as ke,x as Me,bF as Ie,a5 as Se,j as t,a6 as $e,bG as Z,bH as ne,a7 as De,U as Te,V as se,W as Re,bf as oe,B as z,H as _e,ag as ee,bI as Ee,bJ as Pe,u as A,w as Ge,L as J,J as de,h as ue,e as Be,X as We,q as Le,aw as Fe,ax as Ne,ay as Oe,S as H,b as F,bh as ze,m as Ae,z as Ve,f as N,I as Ke,p as B,o as pe,T as te,P as He,A as Ue,R as qe,g as fe,al as Je,b4 as Xe,b5 as Ye,v as Ze,d as Qe,n as ie,E as et}from"./index-DgWg_Psu.js";import{C as ge,a as he,b as tt}from"./index-LEgeaP6H.js";import{l as nt,M as G,d as ot,C as rt,a as st,b as it,m as at,n as ct,j as lt,T as dt,c as ut,e as pt,f as ft,g as ae,i as gt,J as ht,h as mt}from"./useManageMangaLibraryState-CC8XCrln.js";import{d as xt}from"./Delete-d9GdS_tD.js";import{d as bt}from"./Sync-Dlvdicxk.js";import{M,a as jt}from"./Mangas-C3TvRRAc.js";import{C as Y}from"./CheckboxInput-CdLHdolx.js";import{F as Ct}from"./ListPreference-B0ImoRwD.js";import{S as me}from"./SpinnerImage-0mGD6bll.js";import{C as vt}from"./Checkbox-CukkR5-d.js";import{T as xe,C as wt}from"./TypographyMaxLines-B3EKy_G6.js";import{L as yt}from"./Link-CtfJOahX.js";import{A as kt}from"./Avatar-5WSj2ZIn.js";import{d as Mt}from"./PlayArrow-BAe_OlCq.js";import{D as It}from"./StyledFab-B9fSBY_n.js";const St=m.createContext(),ce=St;function $t(e){return we("MuiGrid",e)}const Dt=[0,1,2,3,4,5,6,7,8,9,10],Tt=["column-reverse","column","row-reverse","row"],Rt=["nowrap","wrap-reverse","wrap"],V=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],U=ye("MuiGrid",["root","container","item","zeroMinWidth",...Dt.map(e=>"spacing-xs-".concat(e)),...Tt.map(e=>"direction-xs-".concat(e)),...Rt.map(e=>"wrap-xs-".concat(e)),...V.map(e=>"grid-xs-".concat(e)),...V.map(e=>"grid-sm-".concat(e)),...V.map(e=>"grid-md-".concat(e)),...V.map(e=>"grid-lg-".concat(e)),...V.map(e=>"grid-xl-".concat(e))]),_t=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function O(e){const n=parseFloat(e);return"".concat(n).concat(String(e).replace(String(n),"")||"px")}function Et({theme:e,ownerState:n}){let o;return e.breakpoints.keys.reduce((r,i)=>{let s={};if(n[i]&&(o=n[i]),!o)return r;if(o===!0)s={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(o==="auto")s={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const a=Z({values:n.columns,breakpoints:e.breakpoints.values}),u=typeof a=="object"?a[i]:a;if(u==null)return r;const d="".concat(Math.round(o/u*1e8)/1e6,"%");let l={};if(n.container&&n.item&&n.columnSpacing!==0){const c=e.spacing(n.columnSpacing);if(c!=="0px"){const g="calc(".concat(d," + ").concat(O(c),")");l={flexBasis:g,maxWidth:g}}}s=K({flexBasis:d,flexGrow:0,maxWidth:d},l)}return e.breakpoints.values[i]===0?Object.assign(r,s):r[e.breakpoints.up(i)]=s,r},{})}function Pt({theme:e,ownerState:n}){const o=Z({values:n.direction,breakpoints:e.breakpoints.values});return ne({theme:e},o,r=>{const i={flexDirection:r};return r.indexOf("column")===0&&(i["& > .".concat(U.item)]={maxWidth:"none"}),i})}function be({breakpoints:e,values:n}){let o="";Object.keys(n).forEach(i=>{o===""&&n[i]!==0&&(o=i)});const r=Object.keys(e).sort((i,s)=>e[i]-e[s]);return r.slice(0,r.indexOf(o))}function Gt({theme:e,ownerState:n}){const{container:o,rowSpacing:r}=n;let i={};if(o&&r!==0){const s=Z({values:r,breakpoints:e.breakpoints.values});let a;typeof s=="object"&&(a=be({breakpoints:e.breakpoints.values,values:s})),i=ne({theme:e},s,(u,d)=>{var l;const c=e.spacing(u);return c!=="0px"?{marginTop:"-".concat(O(c)),["& > .".concat(U.item)]:{paddingTop:O(c)}}:(l=a)!=null&&l.includes(d)?{}:{marginTop:0,["& > .".concat(U.item)]:{paddingTop:0}}})}return i}function Bt({theme:e,ownerState:n}){const{container:o,columnSpacing:r}=n;let i={};if(o&&r!==0){const s=Z({values:r,breakpoints:e.breakpoints.values});let a;typeof s=="object"&&(a=be({breakpoints:e.breakpoints.values,values:s})),i=ne({theme:e},s,(u,d)=>{var l;const c=e.spacing(u);return c!=="0px"?{width:"calc(100% + ".concat(O(c),")"),marginLeft:"-".concat(O(c)),["& > .".concat(U.item)]:{paddingLeft:O(c)}}:(l=a)!=null&&l.includes(d)?{}:{width:"100%",marginLeft:0,["& > .".concat(U.item)]:{paddingLeft:0}}})}return i}function Wt(e,n,o={}){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[o["spacing-xs-".concat(String(e))]];const r=[];return n.forEach(i=>{const s=e[i];Number(s)>0&&r.push(o["spacing-".concat(i,"-").concat(String(s))])}),r}const Lt=q("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:o}=e,{container:r,direction:i,item:s,spacing:a,wrap:u,zeroMinWidth:d,breakpoints:l}=o;let c=[];r&&(c=Wt(a,l,n));const g=[];return l.forEach(h=>{const p=o[h];p&&g.push(n["grid-".concat(h,"-").concat(String(p))])}),[n.root,r&&n.container,s&&n.item,d&&n.zeroMinWidth,...c,i!=="row"&&n["direction-xs-".concat(String(i))],u!=="wrap"&&n["wrap-xs-".concat(String(u))],...g]}})(({ownerState:e})=>K({boxSizing:"border-box"},e.container&&{display:"flex",flexWrap:"wrap",width:"100%"},e.item&&{margin:0},e.zeroMinWidth&&{minWidth:0},e.wrap!=="wrap"&&{flexWrap:e.wrap}),Pt,Gt,Bt,Et);function Ft(e,n){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return["spacing-xs-".concat(String(e))];const o=[];return n.forEach(r=>{const i=e[r];if(Number(i)>0){const s="spacing-".concat(r,"-").concat(String(i));o.push(s)}}),o}const Nt=e=>{const{classes:n,container:o,direction:r,item:i,spacing:s,wrap:a,zeroMinWidth:u,breakpoints:d}=e;let l=[];o&&(l=Ft(s,d));const c=[];d.forEach(h=>{const p=e[h];p&&c.push("grid-".concat(h,"-").concat(String(p)))});const g={root:["root",o&&"container",i&&"item",u&&"zeroMinWidth",...l,r!=="row"&&"direction-xs-".concat(String(r)),a!=="wrap"&&"wrap-xs-".concat(String(a)),...c]};return De(g,$t,n)},Ot=m.forwardRef(function(n,o){const r=ke({props:n,name:"MuiGrid"}),{breakpoints:i}=Me(),s=Ie(r),{className:a,columns:u,columnSpacing:d,component:l="div",container:c=!1,direction:g="row",item:h=!1,rowSpacing:p,spacing:x=0,wrap:f="wrap",zeroMinWidth:v=!1}=s,b=Se(s,_t),w=p||x,I=d||x,D=m.useContext(ce),y=c?u||12:D,S={},_=K({},b);i.keys.forEach(k=>{b[k]!=null&&(S[k]=b[k],delete _[k])});const $=K({},s,{columns:y,container:c,direction:g,item:h,rowSpacing:w,columnSpacing:I,wrap:f,zeroMinWidth:v,spacing:x},S,{breakpoints:i.keys}),E=Nt($);return t.jsx(ce.Provider,{value:y,children:t.jsx(Lt,K({ownerState:$,className:$e(E.root,a),as:l,ref:o},_))})}),re=Ot,zt=m.forwardRef(({MenuItemProps:e,className:n,label:o,LeftIcon:r,renderLabel:i,RightIcon:s,...a},u)=>t.jsxs(Te,{...e,ref:u,className:n,...a,children:[r&&t.jsx(se,{children:t.jsx(r,{fontSize:"small"})}),t.jsx(Re,{children:o}),s&&t.jsx(se,{style:{minWidth:0},children:t.jsx(s,{fontSize:"small"})})]})),je=m.forwardRef((e,n)=>{const{parentMenuOpen:o,label:r,renderLabel:i,RightIcon:s=ee(Ee,Pe),LeftIcon:a,children:u,className:d,tabIndex:l,ContainerProps:c={},MenuProps:g,...h}=e,p=oe.useIsTouchDevice(),{ref:x,...f}=c,v=m.useRef(null);m.useImperativeHandle(n,()=>v.current);const b=m.useRef(null);m.useImperativeHandle(x,()=>b.current);const w=m.useRef(null),[I,D]=m.useState(!1),y=j=>{if(I!==j){if(e.disabled){D(!1);return}D(j)}},S=j=>{p||(y(!0),f.onMouseEnter&&f.onMouseEnter(j))},_=j=>{y(!1),f.onMouseLeave&&f.onMouseLeave(j)},$=()=>{var W,P;const j=(P=(W=b.current)==null?void 0:W.ownerDocument.activeElement)!=null?P:null;if(w.current==null)return!1;for(const L of w.current.children)if(L===j)return!0;return!1},E=j=>{p||(j.target===b.current&&y(!0),f.onFocus&&f.onFocus(j))},k=j=>{y(!I),f.onClick&&f.onClick(j)},T=j=>{var P,L,Q;if(j.key==="Escape")return;$()&&j.stopPropagation();const W=(P=b.current)==null?void 0:P.ownerDocument.activeElement;if(j.key==="ArrowLeft"&&$()&&((L=b.current)==null||L.focus()),j.key==="ArrowRight"&&j.target===b.current&&j.target===W){const X=(Q=w.current)==null?void 0:Q.children[0];X==null||X.focus()}},C=I&&o;let R;return e.disabled||(R=l!==void 0?l:-1),t.jsxs(z,{...f,ref:b,onFocus:E,onClick:k,tabIndex:R,onMouseEnter:S,onMouseLeave:_,onKeyDown:T,children:[t.jsx(zt,{MenuItemProps:h,className:d,ref:v,LeftIcon:a,RightIcon:s,label:r,renderLabel:i}),t.jsx(_e,{style:{pointerEvents:"none"},anchorEl:v.current,anchorOrigin:{horizontal:ee("right","left"),vertical:"top"},transformOrigin:{horizontal:ee("left","right"),vertical:"top"},open:C,autoFocus:!1,disableAutoFocus:!0,disableEnforceFocus:!0,onClose:()=>{y(!1)},...g,children:t.jsx(z,{ref:w,style:{pointerEvents:"auto"},children:u})})]})});je.displayName="NestedMenuItem";const At=["remove_from_library"],Vt=({manga:e,handleSelection:n,selectedMangas:o,onClose:r,setHideMenu:i})=>{const{t:s}=A(),[a,u]=m.useState(!1),d=!!e,l=o!=null?o:[],c=ut(d,jt),g=pt(d),h=ft(d),p=!!e&&e.downloadCount===e.chapters.totalCount,x=!!(e!=null&&e.downloadCount),f=!!(e!=null&&e.unreadCount),v=!!e&&e.unreadCount!==e.chapters.totalCount,{openCategorySelect:b,CategorySelectComponent:w}=nt({mangaId:e==null?void 0:e.id,mangaIds:o?M.getIds(l):void 0,onClose:()=>r(!0),addToLibrary:!1}),I=()=>{n==null||n(e.id,!0),r(!0)},D=(E,k)=>{M.performAction(E,e?[e.id]:M.getIds(k),{wasManuallyMarkedAsRead:!0}).catch(ue()),r(!At.includes(E))},{downloadableMangas:y,downloadedMangas:S,unreadMangas:_,readMangas:$}=m.useMemo(()=>({downloadableMangas:[...M.getNotDownloaded(l),...M.getPartiallyDownloaded(l)],downloadedMangas:[...M.getPartiallyDownloaded(l),...M.getFullyDownloaded(l)],unreadMangas:[...M.getUnread(l),...M.getPartiallyRead(l)],readMangas:[...M.getPartiallyRead(l),...M.getFullyRead(l)]}),[l]);return t.jsxs(t.Fragment,{children:[!!n&&d&&t.jsx(G,{onClick:I,Icon:ot,title:s("chapter.action.label.select")}),g(!p)&&t.jsx(je,{disabled:h(!y.length),LeftIcon:Ge,label:c("download",y.length),parentMenuOpen:!0,children:t.jsx(rt,{mangaIds:d?[e.id]:M.getIds(l),closeMenu:()=>r(!0)})}),g(x)&&t.jsx(G,{Icon:xt,disabled:h(!S.length),onClick:()=>D("delete",S),title:c("delete",S.length)}),g(f)&&t.jsx(G,{Icon:st,disabled:h(!_.length),onClick:()=>D("mark_as_read",_),title:c("mark_as_read",_.length)}),g(v)&&t.jsx(G,{Icon:it,disabled:h(!$.length),onClick:()=>D("mark_as_unread",$),title:c("mark_as_unread",$.length)}),d&&t.jsx(J,{to:"/migrate/source/".concat(e==null?void 0:e.sourceId,"/manga/").concat(e==null?void 0:e.id,"/search?query=").concat(e==null?void 0:e.title),state:{mangaTitle:e==null?void 0:e.title},style:{textDecoration:"none",color:"inherit"},children:t.jsx(G,{Icon:at,title:c("migrate",l.length)})}),d&&t.jsx(G,{onClick:()=>{u(!0),i(!0)},Icon:bt,title:c("track",l.length)}),t.jsx(G,{onClick:()=>{b(!0),i(!0)},Icon:ct,title:c("change_categories",l.length)}),t.jsx(G,{onClick:()=>D("remove_from_library",l),Icon:lt,title:c("remove_from_library",l.length)}),w,a&&t.jsx(de,{open:!0,maxWidth:"md",fullWidth:!0,scroll:"paper",onClose:()=>{u(!1),r(!0)},children:t.jsx(dt,{manga:e})})]})},Kt=({mangaIdToMigrateTo:e,onClose:n})=>{const{t:o}=A(),r=Be(),{mangaId:i}=We(),s=Number(i),{settings:{migrateChapters:a,migrateCategories:u,migrateTracking:d,deleteChapters:l}}=Le(),[c,g]=m.useState(!1),h=ze(ue()),p=async x=>{if(s==null)throw new Error('MigrateDialog::migrate: unexpected mangaId "'.concat(s,'"'));Ae(o("migrate.label.info"),"info"),g(!0);try{await M.migrate(s,e,{mode:x,migrateChapters:a,migrateCategories:u,migrateTracking:d,deleteChapters:l}),r("/manga/".concat(e),{replace:!0})}catch(f){g(!1)}};return t.jsxs(de,{open:!0,fullWidth:!0,onClose:n,children:[t.jsx(Fe,{children:o("migrate.dialog.title")}),t.jsx(Ne,{dividers:!0,children:t.jsxs(Ct,{children:[t.jsx(Y,{disabled:c,label:o("chapter.title_one"),checked:a,onChange:(x,f)=>h("migrateChapters",f)}),t.jsx(Y,{disabled:c,label:o("category.title.category_one"),checked:u,onChange:(x,f)=>h("migrateCategories",f)}),t.jsx(Y,{disabled:c,label:o("tracking.title"),checked:d,onChange:(x,f)=>h("migrateTracking",f)}),t.jsx(Y,{disabled:c,label:o("migrate.dialog.label.delete_downloaded"),checked:l,onChange:(x,f)=>h("deleteChapters",f)})]})}),t.jsx(Oe,{children:t.jsxs(H,{sx:{width:"100%"},direction:"row",justifyContent:"space-between",children:[t.jsx(F,{disabled:c,component:J,to:"/manga/".concat(e),children:o("migrate.dialog.action.button.show_entry")}),t.jsxs(H,{direction:"row",children:[t.jsx(F,{disabled:c,onClick:n,children:o("global.button.cancel")}),t.jsx(F,{disabled:c,onClick:()=>p("copy"),children:o("global.button.copy")}),t.jsx(F,{disabled:c,onClick:()=>p("migrate"),children:o("global.button.migrate")})]})]})})]})},Ce=m.forwardRef(({id:e,selected:n,handleSelection:o,asCheckbox:r=!1,popupState:i},s)=>{const{t:a}=A(),u=oe.useIsTouchDevice(),d=m.useMemo(()=>Ve(i),[i]),l=p=>{p.stopPropagation(),p.preventDefault()},c=(p,x)=>{l(p),o==null||o(e,x)},g=p=>{u||(l(p),i.open(p),d.onClick(p))};return o?n!==null?r?t.jsx(N,{title:a(n?"global.button.deselect":"global.button.select"),children:t.jsx(vt,{checked:n,onMouseDown:l,onChange:c})}):null:r?t.jsx(N,{title:a("global.button.options"),children:t.jsx(Ke,{ref:s,...d,onClick:g,onTouchStart:g,"aria-label":"more",size:"large",onMouseDown:l,children:t.jsx(ae,{})})}):t.jsx(N,{title:a("global.button.options"),children:t.jsx(F,{ref:s,...d,onClick:g,onTouchStart:g,className:"manga-option-button",size:"small",variant:"contained",sx:{minWidth:"unset",paddingX:"0",paddingY:"2.5px",visibility:i.isOpen?"visible":"hidden",pointerEvents:"none","@media not (pointer: fine)":{visibility:"hidden",pointerEvents:void 0}},onMouseDown:p=>p.stopPropagation(),children:t.jsx(ae,{})})}):null}),Ht=q("div")({position:"absolute",bottom:0,width:"100%",height:"30%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),Ut=q("div")({position:"absolute",bottom:0,width:"100%",height:"20%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),le=q(xe)({fontSize:"1.05rem"}),qt=({manga:e,longPressBind:n,popupState:o,handleClick:r,mangaLinkTo:i,selected:s,inLibraryIndicator:a,isInLibrary:u,gridLayout:d,handleSelection:l,continueReadingButton:c,mangaBadges:g,mode:h})=>{const p=m.useRef(null),{id:x,title:f}=e;return t.jsx(yt,{component:J,...n(()=>o.open(p.current)),onClick:r,to:i,state:{mangaTitle:f},sx:{textDecoration:"none",touchCallout:"none"},children:t.jsxs(z,{sx:{display:"flex",flexDirection:"column",margin:"2px",outline:s?"4px solid":void 0,borderRadius:s?"1px":void 0,outlineColor:v=>v.palette.primary.main,backgroundColor:v=>s?v.palette.primary.main:void 0,"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:h==="source"?"none":"flex"}}},children:[t.jsx(ge,{sx:{aspectRatio:"225/350",display:"flex"},children:t.jsxs(he,{sx:{position:"relative",height:"100%"},children:[t.jsx(me,{alt:f,src:M.getThumbnailUrl(e),imgStyle:a&&u?{height:"100%",width:"100%",objectFit:"cover",filter:"brightness(0.4)"}:{height:"100%",width:"100%",objectFit:"cover"},spinnerStyle:{display:"grid",placeItems:"center"}}),t.jsxs(H,{alignItems:"start",justifyContent:"space-between",direction:"row",sx:{position:"absolute",top:5,left:5,right:5},children:[g,t.jsx(Ce,{ref:p,popupState:o,id:x,selected:s,handleSelection:l})]}),t.jsxs(t.Fragment,{children:[d!==B.Comfortable&&t.jsxs(t.Fragment,{children:[t.jsx(Ht,{}),t.jsx(Ut,{})]}),t.jsxs(H,{direction:"row",justifyContent:d!==B.Comfortable?"space-between":"end",alignItems:"end",sx:{position:"absolute",bottom:0,width:"100%",margin:"0.5em 0",padding:"0 0.5em",gap:"0.5em"},children:[d!==B.Comfortable&&t.jsx(N,{title:f,placement:"top",children:t.jsx(le,{sx:{color:"white",textShadow:"0px 0px 3px #000000"},children:f})}),c]})]})]})}),d===B.Comfortable&&t.jsx(N,{title:f,placement:"top",children:t.jsx(le,{sx:{position:"relative",width:"100%",bottom:0,margin:"0.5em 0",padding:"0 0.5em",color:"text.primary",height:"3rem"},children:f})})]})})},Jt=({manga:e,longPressBind:n,popupState:o,handleClick:r,mangaLinkTo:i,selected:s,inLibraryIndicator:a,isInLibrary:u,handleSelection:d,continueReadingButton:l,mangaBadges:c,mode:g})=>{const h=m.useRef(null),{id:p,title:x}=e;return t.jsx(ge,{children:t.jsx(he,{component:J,to:i,state:{mangaTitle:x},onClick:r,...n(()=>o.open(h.current)),sx:{touchCallout:"none","@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:g==="source"?"none":"inline-flex"}}},children:t.jsxs(wt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:2,position:"relative"},children:[t.jsx(kt,{variant:"rounded",sx:{width:56,height:56,flex:"0 0 auto",marginRight:2},children:t.jsx(me,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%",imageRendering:"pixelated",filter:a&&u?"brightness(0.4)":void 0},alt:e.title,src:M.getThumbnailUrl(e)})}),t.jsx(z,{sx:{display:"flex",flexDirection:"row",flexGrow:1,width:"min-content"},children:t.jsx(N,{title:x,placement:"top",children:t.jsx(xe,{variant:"h5",children:x})})}),t.jsxs(H,{direction:"row",alignItems:"center",gap:"5px",children:[c,l,t.jsx(Ce,{ref:h,popupState:o,id:p,selected:s,handleSelection:d,asCheckbox:!0})]})]})})})},Xt=({showContinueReadingButton:e,isLatestChapterRead:n,nextChapterIndexToRead:o,mangaLinkTo:r})=>{const{t:i}=A(),s=o===1;return!e||n?null:t.jsx(N,{title:i(s?"global.button.start":"global.button.resume"),children:t.jsx(F,{variant:"contained",size:"small",sx:{minWidth:"unset"},component:J,to:"".concat(r,"chapter/").concat(o),onClick:a=>a.stopPropagation(),onMouseDown:a=>a.stopPropagation(),children:t.jsx(Mt,{})})})},Yt=q("div")({display:"flex",height:"fit-content",borderRadius:"5px",overflow:"hidden","& p":{color:"white",padding:"0.1em",paddingInline:"0.2em",fontSize:"1.05rem"}}),Zt=({inLibraryIndicator:e,updateLibraryState:n,isInLibrary:o,unread:r,downloadCount:i,mode:s})=>{const{t:a}=A(),u=oe.useIsTouchDevice(),{options:{showUnreadBadge:d,showDownloadBadge:l}}=pe();return t.jsxs(Yt,{children:[!u&&e&&s==="source"&&t.jsx(F,{className:"source-manga-library-state-button",component:"div",variant:"contained",size:"small",onMouseDown:c=>c.stopPropagation(),onClick:c=>{c.preventDefault(),c.stopPropagation(),n()},sx:{display:"none"},color:o?"error":"primary",children:a(o?"manga.action.library.remove.label.action":"manga.button.add_to_library")}),e&&o&&t.jsx(te,{className:"source-manga-library-state-indicator",sx:{backgroundColor:"primary.dark"},children:a("manga.button.in_library")}),(d&&s==="default"||s==="duplicate")&&(r!=null?r:0)>0&&t.jsx(te,{sx:{backgroundColor:"primary.dark"},children:r}),(l&&s==="default"||s==="duplicate")&&(i!=null?i:0)>0&&t.jsx(te,{sx:{backgroundColor:"success.dark"},children:i})]})},Qt=(e,n,o,r)=>{switch(e){case"default":case"source":case"duplicate":return"/manga/".concat(n,"/");case"migrate.search":return"/migrate/source/".concat(o,"/manga/").concat(n,"/search?query=").concat(r);case"migrate.select":return"";default:throw new Error('getMangaLinkTo: unexpected MangaCardMode "'.concat(e,'"'))}},en=e=>{var T;const{manga:n,gridLayout:o,inLibraryIndicator:r,selected:i,handleSelection:s,mode:a="default"}=e,{id:u,latestReadChapter:d,firstUnreadChapter:l,chapters:c,downloadCount:g,unreadCount:h}=n,{options:{showContinueReadingButton:p}}=pe(),{CategorySelectComponent:x,updateLibraryState:f,isInLibrary:v}=gt(n,a==="source"),b=Qt(a,n.id,n.sourceId,n.title),w=(T=l==null?void 0:l.sourceOrder)!=null?T:1,I=(c==null?void 0:c.totalCount)===(d==null?void 0:d.sourceOrder),[D,y]=m.useState(!1),S=(C,R)=>{const j=a==="default",W=a==="source",P=a==="migrate.select",L=i!==null;if(P||L||(j||W)&&R){if(C.preventDefault(),W){f();return}if(L){s==null||s(u,!i,{selectRange:C.shiftKey});return}if(j){R==null||R();return}P&&y(!0)}},_=ht((C,{context:R})=>{C.shiftKey=!0,S(C,R)}),$=m.useMemo(()=>o===B.List?Jt:qt,[o]),E=m.useMemo(()=>{var C;return t.jsx(Xt,{showContinueReadingButton:p&&a==="default"&&!!((C=n.chapters)!=null&&C.totalCount),isLatestChapterRead:I,nextChapterIndexToRead:w,mangaLinkTo:b})},[p,I,w,b]),k=m.useMemo(()=>t.jsx(Zt,{inLibraryIndicator:r,isInLibrary:v,unread:h,downloadCount:g,updateLibraryState:f,mode:a}),[r,v,h,g,f]);return t.jsxs(t.Fragment,{children:[D&&t.jsx(Kt,{mangaIdToMigrateTo:n.id,onClose:()=>y(!1)}),t.jsx(He,{variant:"popover",popupId:"manga-card-action-menu",children:C=>t.jsxs(t.Fragment,{children:[t.jsx($,{...e,longPressBind:_,popupState:C,handleClick:S,mangaLinkTo:b,isInLibrary:v,inLibraryIndicator:r,continueReadingButton:E,mangaBadges:k}),!!s&&C.isOpen&&t.jsx(mt,{...Ue(C),children:(R,j)=>t.jsx(Vt,{manga:n,handleSelection:s,onClose:R,setHideMenu:j})}),x]})})]})},tn=qe.forwardRef(({children:e,...n},o)=>t.jsx(re,{...n,ref:o,container:!0,sx:{paddingLeft:"5px",paddingRight:"13px"},children:e})),nn=(e,n,o,r=12)=>{const i=Math.ceil(e/n),s=o===B.List?r:r/i;return({children:a,...u})=>t.jsx(re,{...u,item:!0,xs:s,sx:{width:"100%",paddingTop:"8px",paddingLeft:"8px"},children:a})},ve=(e,n,o,r=!1,i,s,a)=>t.jsx(en,{manga:e,gridLayout:n,inLibraryIndicator:o,selected:r?i==null?void 0:i.includes(e.id):null,handleSelection:s,mode:a},e.id),on=m.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:r,gridLayout:i,isSelectModeActive:s,selectedMangaIds:a,handleSelection:u,mode:d},l)=>t.jsx(re,{ref:l,container:!0,spacing:1,style:{margin:0,width:"100%",padding:"5px",overflowX:"auto",display:"-webkit-inline-box",flexWrap:"nowrap"},children:e?t.jsx(fe,{}):n.map(c=>t.jsx(r,{children:ve(c,i,o,s,a,u,d)},c.id))})),rn=e=>"MangaGrid-snapshot-location-".concat(e.key),sn=m.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:r,gridLayout:i,hasNextPage:s,loadMore:a,isSelectModeActive:u,selectedMangaIds:d,handleSelection:l,mode:c},g)=>{const h=Je(),p=rn(h),[x]=Xe(p,void 0),f=m.useRef(),v=b=>{const w=window.location.href;clearTimeout(f.current),f.current=setTimeout(()=>{w===window.location.href&&Ye.session.setItem(p,b,!1)},250)};return m.useEffect(()=>clearTimeout(f.current),[h.key,f.current]),t.jsxs(t.Fragment,{children:[t.jsx(z,{ref:g,children:t.jsx(tt,{useWindowScroll:!0,overscan:window.innerHeight*.25,totalCount:n.length,components:{List:tn,Item:r},restoreStateFrom:x,stateChanged:v,endReached:()=>a(),itemContent:b=>ve(n[b],i,o,u,d,l,c)})}),u&&i===B.List?t.jsx(z,{sx:{paddingBottom:It}}):e?t.jsx(fe,{}):s?t.jsx("div",{style:{height:"75px"}}):null]})}),wn=({mangas:e,isLoading:n,message:o,messageExtra:r,hasNextPage:i,loadMore:s,gridLayout:a,horizontal:u,noFaces:d,inLibraryIndicator:l,isSelectModeActive:c,selectedMangaIds:g,handleSelection:h,mode:p,retry:x})=>{var $,E;const{t:f}=A(),{navBarWidth:v}=Ze(),b=m.useRef(null),w=m.useRef(null),[I,D]=m.useState((E=($=w.current)==null?void 0:$.offsetWidth)!=null?E:Math.max(0,document.documentElement.offsetWidth-v)),[y]=Qe("ItemWidth",300),S=m.useMemo(()=>nn(I,y,a),[I,y,a]);return m.useLayoutEffect(()=>{let k;const T=C=>{k=setTimeout(()=>{if(document.body.style.overflow.includes("hidden")){T(250);return}document.body.style.overflowY=a===B.List?"auto":"scroll"},C)};return T(0),()=>{clearTimeout(k)}},[a]),m.useLayoutEffect(()=>()=>{document.body.style.overflowY="auto"},[]),ie(w,m.useCallback(()=>{D((()=>{var C;const T=(C=w.current)==null?void 0:C.offsetWidth;return T||document.documentElement.offsetWidth-v})())},[v])),ie(b,m.useCallback((k,T)=>{const C=k[0].target.clientHeight,R=C>document.documentElement.clientHeight;if(!n&&C){if(R){T.disconnect();return}s(),T.disconnect()}},[b,s,n])),!n&&e.length===0?t.jsx(et,{noFaces:d,message:o!=null?o:f("manga.error.label.no_mangas_found"),messageExtra:r,retry:x}):t.jsx("div",{ref:w,style:{overflow:"hidden",paddingBottom:"13px"},children:u?t.jsx(on,{ref:b,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:S,gridLayout:a,isSelectModeActive:c,selectedMangaIds:g,handleSelection:h,mode:p}):t.jsx(sn,{ref:b,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:S,hasNextPage:i,loadMore:s,gridLayout:a,isSelectModeActive:c,selectedMangaIds:g,handleSelection:h,mode:p})})};export{wn as M,Vt as a,en as b,rn as g};
