import{u as f,a as i,c as p,k as u,j as r,g as C,bb as x,I as J,U as T,n as U}from"./index-HpGObMom.js";import{P as j}from"./Progress-BOZ0xDCK.js";const h=e=>{if(!e)return 0;const o=e.failedJobs.mangas.totalCount+e.completeJobs.mangas.totalCount,n=o+e.pendingJobs.mangas.totalCount+e.runningJobs.mangas.totalCount,s=100*(o/n);return Number.isNaN(s)?0:s};let t=!1;function R({handleFinishedUpdate:e}){const{t:o}=f(),{data:n,refetch:s}=i.useGetLastGlobalUpdateTimestamp(),c=n==null?void 0:n.lastUpdateTimestamp.timestamp,{data:l}=i.useGetGlobalUpdateSummary(),a=l==null?void 0:l.updateStatus,m=!!(a!=null&&a.isRunning),g=p.useMemo(()=>h(a),[a==null?void 0:a.failedJobs.mangas.totalCount,a==null?void 0:a.completeJobs.mangas.totalCount,a==null?void 0:a.pendingJobs.mangas.totalCount,a==null?void 0:a.runningJobs.mangas.totalCount]);p.useEffect(()=>{!t&&(a!=null&&a.isRunning)&&(t=!0),t&&g===100&&(t=!1,e==null||e(),s().catch(u()))},[a==null?void 0:a.isRunning]);const b=async()=>{try{t=!0,await i.startGlobalUpdate().response,s().catch(u("UpdateChecker::reFetchLastTimestamp"))}catch(d){t=!1,U(o("global.error.label.update_failed"),"error")}};return r.jsx(C,{title:o("library.settings.global_update.label.last_update_tooltip",{date:c?x.format(+c):"-"}),children:r.jsx(J,{onClick:b,disabled:m,children:m?r.jsx(j,{progress:g}):r.jsx(T,{})})})}export{R as U};
