var E=Object.freeze,T=Object.defineProperty;var G=(e,o)=>E(T(e,"raw",{value:E(o||e.slice())}));import{u as _,c,N as b,Q as k,d as P,G as Q,a as m,bi as q,j as u,g as v,E as A,h as M}from"./index-DfBuIO9L.js";import{M as K}from"./MangaGrid-BP3tMGK7.js";import{G as O}from"./GridLayouts-CRfh_fJ7.js";import"./index-G7-_ctUm.js";import"./useManageMangaLibraryState-DdPIApsS.js";import"./Trackers-y2kGZe-r.js";import"./TypographyMaxLines-oVEHFE6N.js";import"./Avatar-Dk897tog.js";import"./Info-CzS2RLVV.js";import"./TextField-Crw1y3Ix.js";import"./InputAdornment-l2OmGp6f.js";import"./SpinnerImage-CaUvTm_b.js";import"./Collapse-MYtikCd6.js";import"./Link-B1yr3aoJ.js";import"./ListPreference-hcYggMjk.js";import"./Checkbox-DrsGYsRp.js";import"./SwitchBase-miZdTjdG.js";import"./NumberSetting-BWxo6oce.js";import"./useMobilePicker-XdJ88e_P.js";import"./Chip-CWBFb9bn.js";import"./SelectSetting-sEtG3Uyg.js";import"./Select-DiIJDcsh.js";import"./CheckboxInput-B1TLArug.js";import"./Mangas-B3OVvTz3.js";import"./Chapters-BxIe5cMO.js";import"./ThreeStateCheckboxInput-Dhz3m5HS.js";import"./Delete-BbgDr3ls.js";import"./Sync-DPT0yh7A.js";import"./PlayArrow-UlDove7k.js";import"./StyledFab-DLBwrsRn.js";import"./ViewModule-B_7LNb35.js";var C;const Er=()=>{var x;const{t:e}=_(),{setTitle:o,setAction:L}=c.useContext(b),{sourceId:a}=k(),[p,j]=P("migrateGridLayout",Q.List),S=m.graphQLClient.client.cache.readFragment({id:m.graphQLClient.client.cache.identify({__typename:"SourceType",id:a}),fragment:q(C||(C=G(["\n            fragment MigratableSource on SourceType {\n                id\n                name\n            }\n        "])))}),[t,w]=c.useState(S!==null?!0:void 0),{data:s,loading:d,error:r,refetch:I}=m.useGetSource(a,{skip:!!t,notifyOnNetworkStatusChange:!0}),{sourceId:g,name:i}={sourceId:a,name:a,...S,...s==null?void 0:s.source},{data:l,loading:y,error:f,refetch:N}=m.useGetMigratableSourceMangas(g,{skip:!t,notifyOnNetworkStatusChange:!0});if(c.useEffect(()=>{var n;return o((n=i!=null?i:g)!=null?n:e("migrate.title")),L(u.jsx(O,{gridLayout:p,onChange:j})),()=>{o(""),L(null)}},[e,i,g,p]),c.useEffect(()=>{d||t||w(!!s||!!(r!=null&&r.message.includes("The field at path '/source' was declared as a non null type")))},[d,r]),d||!r&&!t||y)return u.jsx(v,{});const h=r&&t===!1;if(h||f){const n=h?r:f;return u.jsx(A,{message:e("global.error.label.failed_to_load_data"),messageExtra:n.message,retry:()=>{h&&I().catch(M()),f&&N().catch(M())}})}return u.jsx(K,{hasNextPage:!1,loadMore:()=>{},isLoading:y,mangas:(x=l==null?void 0:l.mangas.nodes)!=null?x:[],gridLayout:p,mode:"migrate.search"})};export{Er as Migrate};
