import{u as B,h as U,ah as V,y as X,S as v,e as Y,r as H,f as p,j as e,i as J,g as k,k as D,H as E,b as T,B as C,F as K,am as Z,ak as O,z as ee,E as re,m as te,A as se,L as oe,T as $,C as ae,I as ne,b0 as ie,ac as ce,cF as ue}from"./index-C-R-YL45.js";import{P as me}from"./PushPin-B9lRI-_D.js";import{D as pe}from"./DoneAll-D5T2Goww.js";import{F as de}from"./FilterList-yqH0-RuA.js";import{A as le}from"./AppbarSearch-D-vnpaJM.js";import{u as q}from"./useDebounce-CXhgVbDc.js";import{B as he}from"./BaseMangaGrid-CfMq1uk_.js";import{E as ge}from"./EmptyViewAbsoluteCentered-COFR2M2Y.js";import{t as fe}from"./Extensions.utils-Bu5hx70I.js";import{u as xe}from"./useAppTitleAndAction-Drzd0JC4.js";import{M as Se}from"./MUI.util-CEodEA2f.js";import{S as ye}from"./SourceLanguageSelect-CRNSWeR1.js";import{u as je}from"./use-resize-observer-CwclFS5l.js";import{C as Re}from"./Card-DIGAiQxR.js";import{C as we}from"./CardActionArea-DvriuNAz.js";import"./ContinueReadingTooltip-CWh2sxhz.js";import"./Trackers-BQ19KlF0.js";import"./AvatarSpinner-CqNs2I32.js";import"./SpinnerImage-Bn3NstE8.js";import"./Refresh-D_cP1Y0d.js";import"./Image-Cv5oODYa.js";import"./ListCardContent-BxL2gOSv.js";import"./CheckCircle-53bKFKA9.js";import"./Metadata-B-0_IORg.js";import"./Mangas-BEzC4Hou.js";import"./Chapters-2g_N5hFa.js";import"./DateHelper-DTyKL_Dv.js";import"./Asserts-xItX73wb.js";import"./Link-BlsDiaDB.js";import"./useManageMangaLibraryState-DCMRVFbt.js";import"./ThreeStateCheckboxInput-DSi4gXoo.js";import"./Checkbox-C2YCtdbY.js";import"./SwitchBase-CTSE5RWO.js";import"./CheckboxInput-C0cMJY8F.js";import"./FormGroup-fnIgPa-k.js";import"./ListPreference-SsqiVEMn.js";import"./NumberSetting-C6tB4ymP.js";import"./Slider-mW1YVHK7.js";import"./useMobilePicker-CkcF9eky.js";import"./Chip-ByfLOp86.js";import"./SelectSetting-HEHwLjO8.js";import"./Select-MzJUBpbh.js";import"./MangaGrid-Cv60Ojdj.js";import"./Delete-DzNZWZHe.js";import"./Download-BbnI8Wgp.js";import"./Sync-B2FjoHhI.js";import"./use-merged-ref-DR0zeWTK.js";import"./ListCardAvatar-DXpRHMtl.js";import"./PlayArrow-BJ2z7fh3.js";import"./StyledFab-B1MHOY0y.js";import"./index-BSh74icw.js";import"./Virtuoso.util-zSgXBt5R.js";import"./Strings-CAV0u705.js";import"./useAppTitle-B2JGZY0n.js";import"./useAppAction-kyjvX9sQ.js";import"./ListItemAvatar-0wvy52Gy.js";import"./Switch-BrMuZ2K0.js";const Le=(t,S)=>t.displayName.localeCompare(S.displayName),Me=(t,S,r)=>{const j=O(t).isPinned,o=O(S).isPinned,a=r.get(t.id),s=r.get(S.id),l=!(a!=null&&a.isLoading),u=!!(a!=null&&a.error),i=!(a!=null&&a.hasResults)&&!u,R=!(s!=null&&s.isLoading),c=!!(s!=null&&s.error),h=!(s!=null&&s.hasResults)&&!c;return l&&!R?-1:!l&&R||i&&!h?1:h&&!i||!u&&c?-1:u&&!c?1:j&&!o?-1:!j&&o?1:0},be=ue(1).seconds.inWholeMilliseconds,Pe=Z.memo(({source:t,onSearchRequestFinished:S,searchString:r,emptyQuery:j,mode:o,shouldShowOnlySourcesWithResults:a})=>{var M,b;const{i18n:s,_:l}=B(),{id:u,name:i,lang:R}=t,c=p.useRef(r),h=p.useRef(()=>{});c.current!==r&&(c.current=r,h.current(new Error("SourceSearchPreview(".concat(u,", ").concat(i,"): search string changed"))));const[w,g]=H.useSourceSearch(u,r!=null?r:"",void 0,1,{skipRequest:!r,addAbortSignal:!0}),{data:L,isLoading:f,error:d,abortRequest:m}=g[0];h.current=m;const P=(b=(M=L==null?void 0:L.fetchSourceManga)==null?void 0:M.mangas)!=null?b:[],y=!d&&!f&&!P.length;p.useEffect(()=>{S(t,{isLoading:f,hasResults:!y,emptySearch:!r,error:d})},[f,y,r,d]);let x;return d?x=s._({id:"n0YgTE"}):y&&(x=s._({id:"RbPhRX"})),!f&&!r||j||a&&(y||d)?null:e.jsxs(E,{sx:{pb:2},children:[e.jsx(Re,{sx:{mb:1},children:e.jsxs(we,{component:oe,to:se.sources.childRoutes.browse.path(u,r),sx:{p:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(E,{children:[e.jsx($,{variant:"h5",children:i}),e.jsx($,{variant:"caption",children:fe(R)})]}),e.jsx(ae,{title:s._({id:"fMPkxb"}),children:e.jsx(ne,{...Se.preventRippleProp(),children:e.jsx(ie,{})})})]})}),x?e.jsx(ce,{sx:{alignItems:"start",height:void 0},noFaces:!0,message:x,messageExtra:k(d),retry:d?()=>w(1).catch(D("SourceSearchPreview(".concat(t.id,")::refetch"))):void 0}):e.jsx(he,{gridWrapperProps:{sx:{px:0}},mangas:P,isLoading:f,hasNextPage:!1,loadMore:()=>{},horizontal:!0,noFaces:!0,message:x,inLibraryIndicator:!0,mode:o},r)]})}),Cr=()=>{var F;const{i18n:t,_:S}=B(),r=U(),{pathname:j,state:o}=V(),{ref:a,height:s}=je(),l=(F=o==null?void 0:o.shouldShowOnlyPinnedSources)!=null?F:!0,u=j.startsWith("/migrate/source"),[i]=X(re.QUERY,ee),R=q(i,be),{languages:c,setLanguages:h}=v.useLanguages(),{settings:{showNsfw:I,shouldShowOnlySourcesWithResults:w}}=Y(),{data:g,loading:L,error:f,refetch:d}=H.useGetSourceList({notifyOnNetworkStatusChange:!0}),m=p.useMemo(()=>{var n;return(n=g==null?void 0:g.sources.nodes)!=null?n:[]},[g==null?void 0:g.sources.nodes]),[P,y]=p.useState(new Map),x=q(P,500),M=p.useMemo(()=>v.getLanguages(m),[m]),b=p.useMemo(()=>v.filter(m,{isNsfw:I?void 0:!1,languages:c,keepLocalSource:!0,pinned:l?!0:void 0,enabled:!0}),[m,c,l]),A=p.useMemo(()=>[...b].toSorted(Le),[b]),G=p.useMemo(()=>[...A].sort((n,_)=>Me(n,_,x)),[A,x]),W=p.useCallback(({id:n},_)=>{y(Q=>{const N=new Map(Q);return N.set(n,_),N})},[y]),z=K(n=>te(t._({id:"cBoXe4"}),"error",k(n)));return xe(u?t._({id:"DbdKs8",values:{0:o==null?void 0:o.mangaTitle}}):t._({id:"kddIOO"}),e.jsxs(e.Fragment,{children:[e.jsx(le,{isClosable:!1}),e.jsx(ye,{selectedLanguages:c,setSelectedLanguages:h,languages:M,sources:m!=null?m:[]})]}),[c,h,M,m]),L?e.jsx(J,{}):f?e.jsx(ge,{message:t._({id:"6m5aox"}),messageExtra:k(f),retry:()=>d().catch(D("SearchAll::refetch"))}):e.jsxs(E,{sx:{position:"relative",px:1,pb:1},children:[e.jsxs(T,{ref:a,sx:{width:"100%",position:"fixed",zIndex:1,flexDirection:"row",gap:2,pt:1,pb:2,background:n=>n.palette.background.default},children:[e.jsxs(T,{sx:{flexDirection:"row",gap:1},children:[e.jsx(C,{startIcon:e.jsx(me,{}),variant:l?"contained":"outlined",onClick:()=>r({pathname:"",search:i?"query=".concat(i):""},{replace:!0,state:{...o,shouldShowOnlyPinnedSources:!0}}),children:t._({id:"kNiQp6"})}),e.jsx(C,{startIcon:e.jsx(pe,{}),variant:l?"outlined":"contained",onClick:()=>r({pathname:"",search:i?"query=".concat(i):""},{replace:!0,state:{...o,shouldShowOnlyPinnedSources:!1}}),children:t._({id:"N40H+G"})})]}),e.jsx(C,{startIcon:e.jsx(de,{}),variant:w?"contained":"outlined",onClick:()=>z("shouldShowOnlySourcesWithResults",!w),children:t._({id:"qjRJki"})})]}),e.jsx(E,{sx:{pt:"".concat(s,"px")},children:G.map(n=>e.jsx(Pe,{source:n,onSearchRequestFinished:W,searchString:R,emptyQuery:!i,mode:u?"migrate.select":"source",shouldShowOnlySourcesWithResults:w},n.id))})]})};export{Cr as SearchAll};
