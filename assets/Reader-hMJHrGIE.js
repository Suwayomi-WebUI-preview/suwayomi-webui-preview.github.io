var xs=Object.defineProperty;var ms=(t,e,s)=>e in t?xs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Q=(t,e,s)=>ms(t,typeof e!="symbol"?e+"":e,s);import{cV as Nr,b as l,cW as wt,j as o,i as Zt,at as v,n as qt,cX as vs,E as Ke,cY as lt,cZ as Jt,S as B,z as X,T as tt,aS as Ss,c_ as Rs,aU as bs,ct as Xt,a1 as Ze,a9 as rr,C as F,c$ as _r,d0 as H,d1 as ft,d2 as dr,as as St,d3 as Hr,d4 as Cs,d5 as Ae,f as bt,bd as Ps,d6 as Ct,d7 as le,a as Vr,d8 as Ye,aH as rt,d9 as z,da as de,c2 as q,M as Ue,cI as Ts,db as Es,dc as ws,dd as As,cJ as Is,am as ot,de as ur,aV as st,df as gr,bv as Pt,A as sr,L as Ht,c as Ie,u as U,ca as zr,b7 as Wr,b8 as Fr,ax as Tt,a3 as kt,a4 as Bt,cc as Ds,ap as Os,B as at,dg as Ms,dh as hr,di as Ur,dj as Qt,dk as Gr,dl as Ls,dm as pr,dn as Xr,b1 as js,dp as Ve,bb as ys,dq as nt,s as $r,I as oe,r as At,cb as ks,aF as Bs,bj as Ns,e as Vt,aP as _s,dr as nr,a6 as Hs,a7 as Vs,m as Yr,ds as Rt,al as fr,bl as zs,b3 as He,dt as Ws,du as Kr,g as Zr,aB as qr,dv as xr,O as mr,dw as xt,dx as ee,bk as Fs,dy as er,d as Us,aA as Gs,dz as Xs,dA as $s}from"./index-BHDpUh3-.js";import{b as J,R as Ys,a as L,w as ge,c as dt,d as qe,e as zt,g as ke,f as Re,i as ue,h as ze,j as et,k as Z,l as vr,m as Sr,n as ce,o as Ks,p as Et,q as Zs,r as qs,s as Js,t as Qs,v as Jr,x as Qr,y as es,S as en,z as tn,A as Wt,B as It,C as We,D as ar,E as rn,F as sn,G as nn,H as an,I as or,J as on,K as cn,L as ts,M as ln,N as Fe,O as dn,P as Rr,Q as Mt,T as un,U as gn,V as hn,W as pn,X as rs,Y as ss,Z as fn,_ as xn,$ as ir,a0 as mn,a1 as vn,a2 as jt,a3 as br,a4 as Sn,a5 as Rn,a6 as $t,a7 as bn}from"./ReaderSettingsTabs-2p53a6O4.js";import{r as Cn}from"./Strings-CAV0u705.js";import{C as ye,b as tr,F as ns}from"./Chapters-DXVGTzCM.js";import{P as Pn}from"./PushPin-Zb3QB8BU.js";import{P as Tn}from"./PushPinOutlined-Bc1TdApX.js";import{L as yt}from"./Link-BjsfiI8X.js";import{S as as}from"./Select-COLUFbl9.js";import{C as os,c as En,F as wn,l as An,n as In,a as Dn}from"./useManageMangaLibraryState-CBzda54n.js";import{q as On}from"./index-Dv5TOdqu.js";import{C as Mn,B as Ln,I as jn}from"./ChapterListCard-BHwl_NqB.js";import{D as yn}from"./Download-BRd5O6yM.js";import{D as kn}from"./Delete-D2LiWUhi.js";import{D as Bn}from"./ChapterCardMetadata-bJjJe3ue.js";import{F as Nn,I as _n}from"./IconWebView-C2yjsUlt.js";import{F as cr}from"./Mangas-BKS1toPu.js";import{C as Hn}from"./CheckboxInput-D2v66HMN.js";import{E as Nt}from"./EmptyViewAbsoluteCentered--aM-A61a.js";import{u as Vn}from"./SpinnerImage-05xVjeY4.js";import{u as zn}from"./use-window-event-C3gBpB4k.js";import{u as Wn}from"./use-merged-ref-8l9C8tMv.js";import{u as Fn}from"./useAppTitle-Dst-z4ZT.js";import"./TabsMenu-D91zL5I9.js";import"./Tabs-D9cM1vyg.js";import"./Trans-ZuQky33T.js";import"./Slider-C0Sm88zy.js";import"./ListSubheader-Crz13cmT.js";import"./Add-QFEUA5AF.js";import"./DateHelper-gEEoOyXG.js";import"./Asserts-84xfL9i5.js";import"./ThreeStateCheckboxInput-zbZ7suLw.js";import"./Checkbox-BMSu4avR.js";import"./SwitchBase-Cx9CTguw.js";import"./FormGroup-DTMYQrrW.js";import"./DoneAll-Br5wxRs6.js";import"./MUI.util-CEodEA2f.js";import"./ListCardContent-DE5brXp7.js";import"./Card-C0XSdsEX.js";import"./CardActionArea-BU0DrTcp.js";import"./Refresh-xZ1MnxbS.js";const Un=t=>{const{activeScopes:e,enableScope:s,disableScope:r}=Nr(),n=l.useRef([]);l.useEffect(()=>t?(n.current=[...e],s(wt.NONE),n.current.forEach(r),()=>{r(wt.NONE),n.current.forEach(s)}):()=>{},[t])},Gn=({isOpen:t,close:e})=>{const s=J(c=>c.settings);Un(t);const[r,n]=l.useState(0),[a,i]=l.useState(!1);return t?o.jsx(Zt,{open:t,maxWidth:"md",fullWidth:!0,onClose:e,hideBackdrop:r===vs.FILTER,sx:{...v(a,{opacity:.75})},children:o.jsx(qt,{sx:{p:0},children:o.jsx(Ys,{activeTab:r,setActiveTab:n,settings:s,updateSetting:(...c)=>L.updateSetting(...c),deleteSetting:(...c)=>L.deleteSetting(...c),setTransparent:i})})}):null},Xn=({isDesktop:t,readerNavBarWidth:e})=>{const s=dt(u=>u.scrollbar),{currentPageIndex:r,pages:n,totalPages:a}=qe(u=>({currentPageIndex:u.pages.currentPageIndex,pages:u.pages.pages,totalPages:u.pages.totalPages})),{readingDirection:i,shouldShowPageNumber:c,progressBarType:d}=J(u=>({readingDirection:u.settings.readingDirection.value,shouldShowPageNumber:u.settings.shouldShowPageNumber,progressBarType:u.settings.progressBarType})),p=zt(u=>u.progressBar.isMaximized),g=l.useMemo(()=>{const u=ke(r,n).name,h="/",f="".concat(u).concat(h).concat(a);return i===lt.LTR?f:Cn(f,h)},[r,n,a,i]);return!c||p||t&&d===Jt.STANDARD||p&&d===Jt.HIDDEN?null:o.jsx(B,{sx:{position:"fixed",left:e,right:0,bottom:u=>"max(calc(".concat(u.spacing(1)," + ").concat(s.xSize,"px), env(safe-area-inset-bottom))"),alignItems:"center",transition:u=>"left 0.".concat(u.transitions.duration.shortest,"s")},children:o.jsx(X,{sx:{p:.5,borderRadius:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:o.jsx(tt,{sx:{color:"white"},children:g})})})},$n=ge(Xn,[L.useOverlayMode,Ke],["isDesktop","readerNavBarWidth"]);function Cr(t){return t.substring(2).toLowerCase()}function Yn(t,e){return e.documentElement.clientWidth<t.clientX||e.documentElement.clientHeight<t.clientY}function Kn(t){const{children:e,disableReactTree:s=!1,mouseEvent:r="onClick",onClickAway:n,touchEvent:a="onTouchEnd"}=t,i=l.useRef(!1),c=l.useRef(null),d=l.useRef(!1),p=l.useRef(!1);l.useEffect(()=>(setTimeout(()=>{d.current=!0},0),()=>{d.current=!1}),[]);const g=Ss(Rs(e),c),u=bs(x=>{const S=p.current;p.current=!1;const T=Xt(c.current);if(!d.current||!c.current||"clientX"in x&&Yn(x,T))return;if(i.current){i.current=!1;return}let m;x.composedPath?m=x.composedPath().includes(c.current):m=!T.documentElement.contains(x.target)||c.current.contains(x.target),!m&&(s||!S)&&n(x)}),h=x=>S=>{p.current=!0;const T=e.props[x];T&&T(S)},f={ref:g};return a!==!1&&(f[a]=h(a)),l.useEffect(()=>{if(a!==!1){const x=Cr(a),S=Xt(c.current),T=()=>{i.current=!0};return S.addEventListener(x,u),S.addEventListener("touchmove",T),()=>{S.removeEventListener(x,u),S.removeEventListener("touchmove",T)}}},[u,a]),r!==!1&&(f[r]=h(r)),l.useEffect(()=>{if(r!==!1){const x=Cr(r),S=Xt(c.current);return S.addEventListener(x,u),()=>{S.removeEventListener(x,u)}}},[u,r]),l.cloneElement(e,f)}const Pr=Ze(tt)({boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",textAlign:"center",userSelect:"none",cursor:"pointer"}),Zn=Ze(B,{shouldForwardProp:rr(["progressBarPosition"])})(({theme:t,progressBarPosition:e})=>({position:"fixed",pointerEvents:"all",touchAction:"none",...v(Re(e).isHorizontal,{justifyContent:"flex-end",bottom:0,right:0}),...v(Re(e).isVertical,{top:0,bottom:0}),...v(Re(e).isLeft,{alignItems:t.direction==="ltr"?"flex-start":"flex-end"}),...v(Re(e).isRight,{alignItems:t.direction==="ltr"?"flex-end":"flex-start"})})),qn=Ze(B)(({theme:t})=>({flexDirection:"row",justifyContent:"center",alignItems:"center",gap:t.spacing(.5)})),Jn=Ze(B)({flexDirection:"row",flexGrow:1,overflow:"hidden"}),Qn=Ze(X,{shouldForwardProp:rr(["currentPagesIndex","pagesLength","progressBarPosition"])})(({currentPagesIndex:t,pagesLength:e,progressBarPosition:s})=>({position:"absolute",pointerEvents:"none",...v(Re(s).isHorizontal,{left:0,width:"".concat((t+1)/e*100,"%"),height:"100%"}),...v(Re(s).isVertical,{top:0,width:"100%",height:"".concat((t+1)/e*100,"%")})})),ea=({pageName:t,currentPagesIndex:e,pagesLength:s,isDragging:r,boxProps:n,children:a,progressBarPosition:i})=>o.jsx(F,{title:t,slotProps:{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}},placement:_r[i],children:o.jsx(X,{...n,sx:{position:"absolute",cursor:r?"grabbing":"grab",...v(Re(i).isHorizontal,{left:"".concat(Math.max(0,e-1)/(s-1)*100,"%"),width:"calc(100% / ".concat(s-1,")"),height:"100%"}),...v(Re(i).isVertical,{top:"".concat(Math.max(0,e-1)/(s-1)*100,"%"),width:"100%",height:"calc(100% / ".concat(s-1,")")}),...n==null?void 0:n.sx},children:a})}),ta=Ze(B)({position:"relative",flexDirection:"row",flexGrow:1}),ra={[ft.EDGE]:[{rect:[0,0,100,33.33],type:H.NEXT},{rect:[0,33.33,33.33,66.66],type:H.NEXT},{rect:[66.66,33.33,33.33,66.66],type:H.NEXT},{rect:[33.33,33.33,33.33,33.33],type:H.MENU},{rect:[33.33,66.66,33.33,33.33],type:H.PREVIOUS}],[ft.KINDLE]:[{rect:[0,0,100,33.33],type:H.MENU},{rect:[0,33.33,33.33,66.66],type:H.PREVIOUS},{rect:[33.33,33.33,66.66,66.66],type:H.NEXT}],[ft.L_SHAPE]:[{rect:[0,0,100,33.33],type:H.PREVIOUS},{rect:[0,33.33,33.33,33.33],type:H.PREVIOUS},{rect:[33.33,33.33,33.33,33.33],type:H.MENU},{rect:[66.66,33.33,33.33,33.33],type:H.NEXT},{rect:[0,66.66,100,33.33],type:H.NEXT}],[ft.RIGHT_LEFT]:[{rect:[0,0,33.33,100],type:H.PREVIOUS},{rect:[33.33,0,33.33,100],type:H.MENU},{rect:[66.66,0,33.33,100],type:H.NEXT}],[ft.DISABLED]:[{rect:[0,0,100,100],type:H.MENU}]},sa={[H.PREVIOUS]:{text:"global.label.previous",color:"rgba(255, 114, 118, .5)"},[H.NEXT]:{text:"global.label.next",color:"rgba(144, 238, 144, .5)"},[H.MENU]:{text:"global.label.menu",color:"rgba(0, 0, 0, .5)"}};class Se{static invertRect(e,{vertical:s,horizontal:r,isRTL:n}){const a=s?this.invertVertical(e):e,i=r?this.invertHorizontal(a):a;return n?this.invertHorizontal(i):i}static getRegions(e,s){return ra[e].map(({type:n,rect:a})=>({type:n,rect:this.invertRect(a,s)}))}static isCanvasReusable(e,s,r,n,a){var f;const i=this.layout===e,c=this.width===s,d=this.height===r,p=!!this.canvas,g=this.language===dr.language,u=((f=this.invertMode)==null?void 0:f.vertical)===a.vertical&&this.invertMode.horizontal===a.horizontal&&this.invertMode.isRTL===a.isRTL,h=this.fontStyle===n;return p&&c&&d&&i&&g&&u&&h}static drawCanvas(e,s,r,n,a){a.forEach(({type:i,rect:[c,d,p,g]})=>{const{text:u,color:h}=sa[i],f=St(u),x=(E,b)=>E/100*b,S=x(c,s),T=x(d,r),m=x(p,s),P=x(g,r),A=(E,b)=>(E+b)*.5+E*.5,w=A(S,m),I=A(T,P);e.beginPath(),e.rect(S,T,m,P),e.fillStyle=h,e.strokeStyle=h,e.lineWidth=.1,e.stroke(),e.fill(),e.strokeStyle="black",e.textAlign="center",e.textBaseline="middle",e.font="".concat(n.fontSize," ").concat(n.fontFamily),e.strokeStyle="black",e.lineWidth=3,e.strokeText(f,w,I),e.lineWidth=1,e.fillStyle="white",e.fillText(f,w,I)})}static getOrCreateCanvas(e,s,r,n,a){if(this.isCanvasReusable(e,s,r,n,a))return this.canvas;const i=document.createElement("canvas"),c=i.getContext("2d");c.canvas.width=s,c.canvas.height=r;const d=this.getRegions(e,a);return this.drawCanvas(c,s,r,n,d),this.layout=e,this.canvas=i,this.width=s,this.height=r,this.language=dr.language,this.invertMode=a,this.regions=d,this.fontStyle=n,i}static doesRegionContainPos(e,s,r){const[n,a,i,c]=e.rect;return s>=n&&s<=n+i&&r>=a&&r<=a+c}static getAction(e,s){var i;const r=e/this.width*100,n=s/this.height*100,a=(i=this.regions)==null?void 0:i.find(c=>this.doesRegionContainPos(c,r,n));return a?a.type:H.MENU}}Q(Se,"layout",null),Q(Se,"canvas",null),Q(Se,"width",null),Q(Se,"height",null),Q(Se,"language",null),Q(Se,"invertMode",null),Q(Se,"regions",null),Q(Se,"fontStyle",null),Q(Se,"invertVertical",([e,s,r,n])=>[e,100-(s+n),r,n]),Q(Se,"invertHorizontal",([e,s,r,n])=>[100-(e+r),s,r,n]);const na=(t,e,s)=>{if(t===Ae.X){if(e===de.BACKWARD)return s==="ltr"?-1:1;if(e===de.FORWARD)return s==="ltr"?1:-1}return e===de.BACKWARD?-1:1},fe=class fe{static scroll(e,s,r,n,a,i,c=Hr.LARGE){if(!a)return;const d=Ct[n],p=Cs().direction===d,g=ue(r),u=Math.abs(a.scrollTop)<=1,h=Math.floor(a.scrollTop)===a.scrollHeight-a.clientHeight||Math.ceil(a.scrollTop)===a.scrollHeight-a.clientHeight,f=Math.abs(a.scrollLeft)<=1,x=a.scrollWidth-a.clientWidth-Math.floor(Math.abs(a.scrollLeft))<=1||a.scrollWidth-a.clientWidth-Math.ceil(Math.abs(a.scrollLeft))<=1,S=p?f:x,T=p?x:f,m=c/100,P=na(s,e,d),A=(I,E)=>I+E*m*P;ze().setIsVisible(!1),i(!1);const w=(I,E,b)=>{if(I&&e===de.BACKWARD&&g){fe.openChapter("previous");return}if(E&&e===de.FORWARD&&g){fe.openChapter("next");return}a.scroll({...b,behavior:"smooth"})};switch(s){case Ae.X:w(S,T,{left:A(a.scrollLeft,a.clientWidth)});break;case Ae.Y:w(u,h,{top:A(a.scrollTop,a.clientHeight)});break;default:throw new Error('Unexpected "ScrollDirection" ('.concat(s,")"))}}static openChapter(e,s=!0,r=!0){const{currentChapter:n,previousChapter:a,nextChapter:i,chapters:c,visibleChapters:{lastLeadingChapterSourceOrder:d,lastTrailingChapterSourceOrder:p},setReaderStateChapters:g}=et(),{shouldInformAboutMissingChapter:u,shouldInformAboutScanlatorChange:h,shouldUseInfiniteScroll:f}=Z();if(!n)return;const x=typeof e=="number",S=e==="previous";if(!(x||S&&!!a||!S&&!!i))return;(async()=>{const w=x?c.find(E=>E.id===e):S?a:i;if(!w)return;const I=w.sourceOrder<n.sourceOrder;try{s&&await fe.checkNextChapterConsistency(I?"previous":"next",n,w,u,h);const E=d<=w.sourceOrder&&p>=w.sourceOrder,b=f&&(!r||E);b&&g(C=>Js(I,C,w.sourceOrder,r,I?!1:void 0,I?void 0:!1)),L.navigateToChapter(w,{resumeMode:Qs(x||!b,I),updateInitialChapter:!b})}catch(E){}})().catch(bt())}static async checkNextChapterConsistency(e,s,r,n,a){if(!s||!r)return;const i=ye.getGap(s,r),c=!a||s.scanlator===r.scanlator,d=!n||!i;if(!(!c||!d))return;const g={previous:{scanlator:"reader.chapter_transition.warning.previous.scanlator",chapter_number:"reader.chapter_transition.warning.previous.chapter_number"},next:{scanlator:"reader.chapter_transition.warning.next.scanlator",chapter_number:"reader.chapter_transition.warning.next.chapter_number"}},u=c?"":St(g[e].scanlator,{nextScanlator:r.scanlator,currentScanlator:s.scanlator}),h=d?"":St(g[e].chapter_number,{count:i,nextChapter:"#".concat(r.chapterNumber," ").concat(r.name),currentChapter:"#".concat(s.chapterNumber," ").concat(s.name)}),f=!c&&!d?"\n\n":"",x="".concat(u).concat(f).concat(h);await Ps.show({title:St("reader.chapter_transition.warning.title"),message:x,actions:{confirm:{title:St("global.button.open")}}})}static openPage(e,s,r=!0){const{currentPageIndex:n,setPageToScrollToIndex:a,pages:i,transitionPageMode:c,setTransitionPageMode:d}=vr(),{readingDirection:p,readingMode:g,shouldShowTransitionPage:u}=Z(),h=Ct[p.value],f=q(e,e==="previous"?"next":"previous",s!=null?s:h),x=ke(n,i),S=Sr("previous",x.pagesIndex,i),T=Sr("next",x.pagesIndex,i),m=ce(i[0]),P=ce(i[i.length-1]),A=x.primary.index===0,w=n===P,I=Ks(c,g.value),E=ue(g.value);r&&(ze().setIsVisible(!1),Et().setShowPreview(!1));const b=()=>d(le.NONE);if(typeof e=="number"){a(e),b();return}const C=E&&I,D=!E&&c===le.PREVIOUS||C,j=!E&&c===le.NEXT||C;if(A&&(!u||D)&&f==="previous"&&!!et().previousChapter){fe.openChapter("previous");return}if(w&&(!u||j)&&f==="next"&&!!et().nextChapter){fe.openChapter("next");return}const M=f==="previous",G=f==="next";if(I&&!E&&(D&&G||j&&M)){b(),a(D?m:P);return}if((A&&M||w&&G)&&!E){d(M?le.PREVIOUS:le.NEXT);return}a(M?S:T)}static useUpdateCurrentPageIndex(){const e=L.useUpdateChapter(),{settings:{downloadAheadLimit:s}}=Vr();return l.useCallback((r,n=!0,a=!1)=>{const{currentPageIndex:i,setCurrentPageIndex:c}=vr(),{currentChapter:d,chapters:p,previousChapter:g,nextChapter:u,visibleChapters:h,setReaderStateChapters:f}=et();if(r===i&&!a||(c(r),!d))return;const x=ye.getNextChapters(d,p,{offset:Ye.NEXT}),S=i>r?Ye.PREVIOUS:Ye.NEXT;L.downloadAhead(d,u,x,r,s),L.preloadChapter(r,d.pageCount,S===Ye.NEXT?u:g,h.lastLeadingChapterSourceOrder,h.lastTrailingChapterSourceOrder,f,S);const T=()=>{const m=Jr(d.id);if(!m)return;const P=a?m.pageCount-1:r,A=P===m.pageCount-1;e({lastPageRead:P,isRead:A?!0:void 0})};if(clearTimeout(fe.updateCurrentPageTimeout),n){fe.updateCurrentPageTimeout=setTimeout(T,rt(1).seconds.inWholeMilliseconds);return}T()},[s])}static updateCurrentPageOnScroll(e,s,r,n,a){var g;const i=Ct[a],c=e.current.findIndex(u=>u&&Zs(u,n,{bottom:1,left:q(0,window.innerWidth+1,i),right:q(1,0,i)})),d=(g=e.current)==null?void 0:g[e.current.length-1],p=d&&qs(d,n,a);if(c!==-1){if(p){r(c,!1,!0);return}r(c,c!==s)}}static handleClick(e,s){if(!e)return;const{readingMode:r,readingDirection:n,isStaticNav:a,scrollAmount:i}=Z(),c=s.currentTarget.getBoundingClientRect(),d=s.clientX-c.left,p=s.clientY-c.top,g=Se.getAction(d,p);Et().setShowPreview(!1);const u=ue(r.value),h=r.value===z.CONTINUOUS_HORIZONTAL?Ae.X:Ae.Y;switch(g){case H.MENU:ze().setIsVisible(a||!ze().isVisible);break;case H.PREVIOUS:case H.NEXT:u?fe.scroll(g===H.PREVIOUS?de.BACKWARD:de.FORWARD,h,r.value,n.value,e,Et().setShowPreview,i):fe.openPage(g===H.PREVIOUS?"previous":"next","ltr");break;default:throw new Error('Unexpected "TapZoneRegionType" ('.concat(g,")"))}}static useHandleProgressDragging(e,s,r,n,a,i,c){l.useEffect(()=>{if(!s)return()=>{};const{isHorizontal:d}=Re(a),p=h=>{if(!e.current)return;const f=ce(Qr(h,e.current,n,d,c,i));ce(r)!==f&&fe.openPage(f,void 0,!1)},g=h=>{p(h)},u=h=>{h.touches.length>0&&p(h.touches[0])};return document.addEventListener("mousemove",g),document.addEventListener("touchmove",u),()=>{document.removeEventListener("mousemove",g),document.removeEventListener("touchmove",u)}},[s,r,n,a])}};Q(fe,"updateCurrentPageTimeout");let V=fe;const aa=l.memo(Ze(X,{shouldForwardProp:rr(["isFirstPage","isLastPage"])})(({isFirstPage:t,isLastPage:e})=>({flexGrow:1,height:"100%",cursor:"pointer",borderLeftWidth:t?0:void 0,borderRightWidth:e?0:void 0}))),oa=l.memo(({page:t,pagesIndex:e,isCurrentPage:s,isLeadingPage:r,isTrailingPage:n,totalPages:a,showDraggingStyle:i,primaryPageLoadState:c,secondaryPageLoadState:d,createProgressBarSlot:p,...g})=>{const u=l.useMemo(()=>p(t,e,c,d,s,r,n,a,i),[p,t,e,c,d,s,r,n,a,i]);return o.jsx(aa,{...g,isFirstPage:e===0,isLastPage:e===a-1,children:u})}),ia=({slotProps:t,slots:e,createProgressBarSlot:s,progressBarPosition:r,direction:n,fullSegmentClicks:a})=>{var C,D,j,N,k,M,G,xe,ne,he,K,_,y,be,De,Ce,ae,Oe,Ge,Pe,Te,Be,me,Xe,Je,it,Me,Ee,$,Le,Ne,_e;const{pages:i,pageLoadStates:c,totalPages:d,currentPageIndex:p}=qe(R=>({pages:R.pages.pages,pageLoadStates:R.pages.pageLoadStates,totalPages:R.pages.totalPages,currentPageIndex:R.pages.currentPageIndex})),g=J(R=>R.settings.readingMode.value),{isDragging:u,setIsDragging:h}=zt(R=>({isDragging:R.progressBar.isDragging,setIsDragging:R.progressBar.setIsDragging})),f=l.useRef(null),x=l.useRef(void 0),[S,T]=l.useState(0),m=l.useRef(null);Ue(m,l.useCallback(()=>{const R=m.current;if(!R)return;const{paddingLeft:Y,paddingRight:pe}=getComputedStyle(R),W=6,ve=R.clientWidth-parseFloat(Y)-parseFloat(pe),Qe=g===z.DOUBLE_PAGE?ve*2+W:ve;T(Qe)},[g]));const P=l.useMemo(()=>ke(p,i).pagesIndex,[p,i]),A=Re(r).isHorizontal,w=l.useMemo(()=>ke(p,i),[p,i]),I=l.useCallback((...R)=>q(R[0],R[1],n),[n]);V.useHandleProgressDragging(f,u,w,i,r,I,a);const E=R=>{if(!f.current)return;const Y="touches"in R;V.openPage(ce(Qr(Y?R.touches[0]:R,f.current,i,A,a,I)),void 0,!1),clearTimeout(x.current),x.current=setTimeout(()=>h(!0),250)},b=()=>{h(!1),clearTimeout(x.current)};return o.jsx(Zn,{...t==null?void 0:t.container,progressBarPosition:r,children:o.jsxs(qn,{...t==null?void 0:t.progressBarRoot,children:[o.jsx(Pr,{...(C=t==null?void 0:t.progressBarPageTexts)==null?void 0:C.base,...(D=t==null?void 0:t.progressBarPageTexts)==null?void 0:D.current,sx:[{width:"".concat(S,"px")},...Array.isArray((N=(j=t==null?void 0:t.progressBarPageTexts)==null?void 0:j.base)==null?void 0:N.sx)?(G=(M=(k=t==null?void 0:t.progressBarPageTexts)==null?void 0:k.base)==null?void 0:M.sx)!=null?G:[]:[(ne=(xe=t==null?void 0:t.progressBarPageTexts)==null?void 0:xe.base)==null?void 0:ne.sx],...Array.isArray((K=(he=t==null?void 0:t.progressBarPageTexts)==null?void 0:he.current)==null?void 0:K.sx)?(be=(y=(_=t==null?void 0:t.progressBarPageTexts)==null?void 0:_.current)==null?void 0:y.sx)!=null?be:[]:[(Ce=(De=t==null?void 0:t.progressBarPageTexts)==null?void 0:De.current)==null?void 0:Ce.sx]],onClick:()=>V.openPage("previous","ltr",!1),children:w.name}),o.jsx(Kn,{onClickAway:()=>h(!1),children:o.jsxs(ta,{...t==null?void 0:t.progressBarSlotsActionArea,onMouseDown:E,onMouseUp:b,onTouchStart:E,onTouchEnd:b,children:[o.jsxs(Jn,{ref:f,...t==null?void 0:t.progressBarSlotsContainer,children:[i.map((R,Y)=>l.createElement(oa,{...t==null?void 0:t.progressBarSlot,key:R.primary.index,page:R,pagesIndex:Y,isCurrentPage:Y===P,isLeadingPage:Y<P,isTrailingPage:Y>P,totalPages:i.length,primaryPageLoadState:c[R.primary.index].loaded,secondaryPageLoadState:R.secondary?c[R.secondary.index].loaded:void 0,createProgressBarSlot:s,showDraggingStyle:Y===P&&u})),o.jsx(Qn,{...t==null?void 0:t.progressBarReadPages,currentPagesIndex:w.pagesIndex,pagesLength:i.length,progressBarPosition:r})]}),o.jsx(ea,{boxProps:t==null?void 0:t.progressBarCurrentPageSlot,pageName:w.name,currentPagesIndex:w.pagesIndex,pagesLength:i.length,isDragging:u,progressBarPosition:r,children:e==null?void 0:e.progressBarCurrentPage})]})}),o.jsx(Pr,{ref:m,...(ae=t==null?void 0:t.progressBarPageTexts)==null?void 0:ae.base,...(Oe=t==null?void 0:t.progressBarPageTexts)==null?void 0:Oe.total,sx:[{minWidth:"unset"},...Array.isArray((Pe=(Ge=t==null?void 0:t.progressBarPageTexts)==null?void 0:Ge.base)==null?void 0:Pe.sx)?(me=(Be=(Te=t==null?void 0:t.progressBarPageTexts)==null?void 0:Te.base)==null?void 0:Be.sx)!=null?me:[]:[(Je=(Xe=t==null?void 0:t.progressBarPageTexts)==null?void 0:Xe.base)==null?void 0:Je.sx],...Array.isArray((Me=(it=t==null?void 0:t.progressBarPageTexts)==null?void 0:it.total)==null?void 0:Me.sx)?(Le=($=(Ee=t==null?void 0:t.progressBarPageTexts)==null?void 0:Ee.total)==null?void 0:$.sx)!=null?Le:[]:[(_e=(Ne=t==null?void 0:t.progressBarPageTexts)==null?void 0:Ne.total)==null?void 0:_e.sx]],onClick:()=>V.openPage("next","ltr",!1),children:d})]})})},is=l.memo(ia),ca=({direction:t,...e})=>{const{settings:{customThemes:s,appTheme:r,themeMode:n,shouldUsePureBlackMode:a}}=Vr(),i=l.useMemo(()=>Ts(n,Es(r,s),a,t),[n,r,s,a,t]);return o.jsx(ws,{value:As[t],children:o.jsx(Is,{theme:i,children:o.jsx(X,{...e,dir:t})})})},cs=ge(ca,[()=>({direction:L.useGetThemeDirection()})],["direction"]),ls=l.memo(({pageName:t,progressBarPosition:e,slotProps:s,children:r})=>{var n;return o.jsx(F,{...s==null?void 0:s.tooltip,title:t,placement:_r[e],children:o.jsx(X,{...s==null?void 0:s.box,sx:{width:"100%",height:"100%",...(n=s==null?void 0:s.box)==null?void 0:n.sx},children:r})})}),la=l.memo(({pageName:t,primaryPageLoadState:e,secondaryPageLoadState:s,progressBarPosition:r,isCurrentPage:n,isLeadingPage:a,showDraggingStyle:i})=>{const c=ot();return o.jsx(ls,{pageName:t,progressBarPosition:r,slotProps:{box:{sx:{cursor:"pointer",backgroundColor:ur(c.palette.background.paper,.2),...c.applyStyles("dark",{backgroundColor:gr(c.palette.background.paper,.1)}),...v(e&&(s==null||s),{backgroundColor:ur(c.palette.background.paper,.35),...c.applyStyles("dark",{backgroundColor:gr(c.palette.background.paper,.25)})})}},tooltip:{slotProps:n?{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}}:void 0}},children:o.jsx(X,{sx:{width:"100%",height:"100%",...v(a,{backgroundColor:st(c.palette.primary.main,.5)}),...v(n,{cursor:i?"grabbing":"grab",pointer:"grabbing",borderRadius:2,backgroundColor:"primary.dark",...c.applyStyles("dark",{backgroundColor:"primary.light"})})}})})}),da=({readerNavBarWidth:t,readerDirection:e})=>{const s=ot(),r=dt(E=>E.scrollbar),n=qe(E=>E.pages.totalPages),{progressBarType:a,progressBarSize:i,progressBarPosition:c,progressBarPositionAutoVertical:d}=J(E=>({progressBarType:E.settings.progressBarType,progressBarSize:E.settings.progressBarSize,progressBarPosition:E.settings.progressBarPosition,progressBarPositionAutoVertical:E.settings.progressBarPositionAutoVertical})),{isMaximized:p,setIsMaximized:g,isDragging:u}=zt(E=>({isMaximized:E.progressBar.isMaximized,setIsMaximized:E.progressBar.setIsMaximized,isDragging:E.progressBar.isDragging})),[,h]=l.useState({});Ue(window.document.documentElement,l.useCallback(()=>h({}),[]));const f=es(c,d,r.ySize,t+r.xSize),{isBottom:x,isLeft:S,isRight:T,isVertical:m,isHorizontal:P}=Re(f),A=!!n,w=a===Jt.HIDDEN,I=!p&&!u;return o.jsx(cs,{children:o.jsx(is,{direction:P?e:"ltr",progressBarPosition:f,fullSegmentClicks:!0,createProgressBarSlot:l.useCallback((E,b,C,D,j,N,k,M,G)=>o.jsx(la,{pageName:E.name,primaryPageLoadState:C,secondaryPageLoadState:D,progressBarPosition:f,isCurrentPage:j,isLeadingPage:N,showDraggingStyle:G}),[f]),slotProps:{container:{sx:{overflow:"hidden",transition:"all 0.".concat(s.transitions.duration.shortest,"s"),...v(P,{minHeight:"100px",...v(s.direction==="ltr",{left:e==="ltr"?t:r.ySize,right:e==="rtl"?t:r.ySize}),...v(s.direction==="rtl",{left:e==="rtl"?t:r.ySize,right:e==="ltr"?t:r.ySize})}),...v(m,{minWidth:"100px",bottom:"".concat(r.xSize,"px")}),...v(x,{bottom:"".concat(r.xSize,"px")}),...v(S,{...v(s.direction==="ltr",{left:e==="ltr"?t:"unset",right:e==="rtl"?t:"unset"}),...v(s.direction==="rtl",{right:e==="rtl"?r.ySize:"unset",left:e==="ltr"?r.ySize:"unset"})}),...v(T,{...v(s.direction==="ltr",{right:e==="ltr"?r.ySize:"unset",left:e==="rtl"?r.ySize:"unset"}),...v(s.direction==="rtl",{left:e==="rtl"?t:"unset",right:e==="ltr"?t:"unset"})}),...v(I,{opacity:w?0:.85}),...v(!A,{pointerEvents:"none"})},onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1)},progressBarRoot:{sx:{gap:0,transition:"all 0.1s ease-in-out",backgroundColor:"background.paper",...v(m,{flexDirection:"column",height:"100%"}),...v(I,{backgroundColor:"unset",pointerEvents:"none",...v(P,{px:2}),...v(m,{py:2}),...v(x,{pb:.25}),...v(S,{...v(s.direction==="ltr",{pl:e==="ltr"?.25:0,pr:e==="rtl"?.25:0}),...v(s.direction==="rtl",{pr:e==="rtl"?.25:0,pl:e==="ltr"?.25:0})}),...v(T,{...v(s.direction==="ltr",{pr:e==="ltr"?.25:0,pl:e==="rtl"?.25:0}),...v(s.direction==="rtl",{pl:e==="rtl"?.25:0,pr:e==="ltr"?.25:0})})})}},progressBarSlotsContainer:{sx:{gap:.25,borderRadius:2,transition:"height 0.1s ease-in-out",...v(P,{height:"20px"}),...v(m,{flexDirection:"column",width:"20px"}),...v(I,{...v(P,{height:"".concat(i,"px")}),...v(m,{width:"".concat(i,"px")})})}},progressBarReadPages:{sx:{display:"none"}},progressBarCurrentPageSlot:{sx:{display:"none"}},progressBarPageTexts:{base:{sx:{px:1,py:1.5,transition:"all 0.1s ease-in-out",...v(I,{transform:"scale(0)",p:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})}}}}})})},ua=ge(l.memo(da),[Ke,()=>({readerDirection:L.useGetThemeDirection()})],["readerNavBarWidth","readerDirection"]),ga=Ze(B)({width:"400px",minWidth:"400px",maxWidth:"400px",height:"100vh",overflowY:"auto"}),ha=l.memo(({mangaId:t,mangaTitle:e,chapterTitle:s,scanlator:r})=>o.jsxs(B,{children:[o.jsx(F,{title:e,placement:"right",children:o.jsx(Pt,{lines:3,variant:"h6",component:"h1",sx:{textAlign:"center"},children:o.jsx(yt,{component:Ht,to:sr.manga.path(t),sx:{textDecoration:"none",color:"inherit"},children:e})})}),o.jsx(F,{title:s,placement:"right",children:o.jsx(Pt,{lines:4,variant:"body1",component:"h2",sx:{textAlign:"center"},children:s})}),r&&o.jsx(F,{title:r,placement:"right",children:o.jsx(Pt,{lines:4,variant:"body2",component:"h3",color:"textDisabled",sx:{textAlign:"center"},children:r})})]})),pa=Ie(o.jsx("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"})),fa=Ie(o.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),_t=({title:t,type:e,disabled:s,...r})=>o.jsx(F,{title:t,disabled:s,children:o.jsx(os,{sx:{flexBasis:"15%"},variant:"contained",disabled:s,...r,children:e==="previous"?o.jsx(pa,{}):o.jsx(fa,{})})}),xa=()=>{const{t}=U(),e=zr(),{currentPageIndex:s,pages:r}=qe(c=>({currentPageIndex:c.pages.currentPageIndex,pages:c.pages.pages})),n=J(c=>c.settings.readingDirection.value),a=l.useMemo(()=>ke(s,r),[s,r]),i=Ct[n];return o.jsxs(B,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[o.jsx(_t,{type:"previous",title:t(e("reader.button.previous_page","reader.button.next_page",i)),disabled:e(!a.primary.index,ce(a)===ce(r.slice(-1)[0]),i),onClick:()=>V.openPage("previous",void 0,!1)}),o.jsxs(Wr,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[o.jsx(Fr,{id:"reader-nav-bar-desktop-page-select",children:t("reader.page_info.label.page")}),o.jsx(as,{labelId:"reader-nav-bar-desktop-page-select",label:t("reader.page_info.label.page"),value:ce(a),onChange:c=>V.openPage(c.target.value,void 0,!1),children:r.map(c=>o.jsx(Tt,{value:ce(c),children:c.name},ce(c)))})]}),o.jsx(_t,{type:"next",title:t(e("reader.button.next_page","reader.button.previous_page",i)),disabled:e(ce(a)===ce(r.slice(-1)[0]),!a.primary.index,i),onClick:()=>V.openPage("next",void 0,!1)})]})},ma=l.memo(xa),va=()=>{},ds=({currentChapter:t,chapters:e,style:s})=>{const r=l.useMemo(()=>t&&e.findIndex(n=>n.id===t.id),[t,e]);return o.jsx(On,{style:{height:"calc(".concat(e.length," * 100px)"),...s},initialTopMostItemIndex:r!=null?r:0,totalCount:e.length,computeItemKey:n=>e[n].id,itemContent:n=>o.jsx(Mn,{index:n,chapters:e,isSortDesc:!0,mode:"reader",showChapterNumber:!1,selected:null,onSelect:va,selectable:!1,isActiveChapter:n===r}),increaseViewportBy:400})},Sa=({currentChapter:t,previousChapter:e,nextChapter:s,chapters:r=[],readerThemeDirection:n})=>{var c,d;const{t:a}=U(),i=kt({variant:"popover",popupId:"reader-nav-bar-desktop-chapter-list"});return l.useLayoutEffect(()=>{i.close()},[t==null?void 0:t.id]),o.jsxs(B,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[o.jsx(_t,{type:"previous",title:a(q("reader.button.previous_chapter","reader.button.next_chapter",n)),onClick:()=>{V.openChapter(q("previous","next",n))},disabled:q(!e,!s,n)}),o.jsxs(Wr,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[o.jsx(Fr,{id:"reader-nav-bar-desktop-chapter-select",children:a("chapter.title_one")}),o.jsx(as,{...Bt(i),open:i.isOpen,value:(c=t==null?void 0:t.id)!=null?c:0,MenuProps:{sx:{visibility:"hidden"}},label:a("chapter.title_one"),labelId:"reader-nav-bar-desktop-chapter-select",children:o.jsx(Tt,{value:(d=t==null?void 0:t.id)!=null?d:0,children:t?"#".concat(t.chapterNumber," ").concat(t.name):""},t==null?void 0:t.id)})]}),o.jsx(_t,{component:Ht,type:"next",title:a(q("reader.button.next_chapter","reader.button.previous_chapter",n)),onClick:()=>{V.openChapter(q("next","previous",n))},disabled:q(!s,!e,n)}),o.jsx(Ds,{...Os(i),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:o.jsx(X,{sx:{mb:1},children:o.jsx(ds,{style:{width:"500px",maxWidth:"90vw",minHeight:"150px",maxHeight:"300px"},currentChapter:t,chapters:r})})})]})},Ra=ge(l.memo(Sa),[()=>({readerThemeDirection:L.useGetThemeDirection()})],["readerThemeDirection"]),ba=Ie(o.jsx("path",{d:"M17 4h3c1.1 0 2 .9 2 2v2h-2V6h-3zM4 8V6h3V4H4c-1.1 0-2 .9-2 2v2zm16 8v2h-3v2h3c1.1 0 2-.9 2-2v-2zM7 18H4v-2H2v2c0 1.1.9 2 2 2h3zM18 8H6v8h12z"})),us=(t,e,s)=>{const n=(t+1)%e.length===0;if(!(s&&n))return e[(t+1)%e.length]},lr=({tooltip:t,value:e,defaultValue:s,values:r,setValue:n,valueToDisplayData:a,isDefaultable:i,onDefault:c,defaultIcon:d})=>{const{t:p}=U(),g=e===void 0,u=l.useMemo(()=>g?-1:r.indexOf(e),[e,r]);return o.jsx(F,{title:t,children:g?o.jsx(at,{onClick:()=>n(r[0]),sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:d,size:"large",children:s===void 0?p("global.label.default"):o.jsx(en,{i18nKey:"settings.default_value",value:a[s].isTitleString?a[s].title:p(a[s].title)})}):o.jsx(at,{onClick:()=>{const h=us(u,r,i);if(h===void 0){c==null||c();return}n(h)},sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:a[e].icon,size:"large",children:a[e].isTitleString?a[e].title:p(a[e].title)})})},Ca=({pageScaleMode:t,shouldStretchPage:e,updateSetting:s,...r})=>{const{t:n}=U();return o.jsxs(B,{sx:{flexDirection:"row",gap:1},children:[o.jsx(lr,{...r,tooltip:n("reader.settings.page_scale.title"),value:t.isDefault?void 0:t.value,defaultValue:t.isDefault?t.value:void 0,values:Ur,setValue:a=>s("pageScaleMode",a),valueToDisplayData:hr,defaultIcon:hr[t.value].icon}),Ms[t.value]&&o.jsx(F,{title:n("reader.settings.page_scale.stretch"),children:o.jsx(os,{onClick:()=>s("shouldStretchPage",!e.value),sx:{px:void 0},variant:"contained",color:e.value?"secondary":"primary",children:o.jsx(ba,{})})})]})},Pa=({readingMode:t,setReadingMode:e,...s})=>{const{t:r}=U();return o.jsx(lr,{...s,tooltip:r("reader.settings.label.reading_mode"),value:t.isDefault?void 0:t.value,defaultValue:t.isDefault?t.value:void 0,values:Gr,setValue:e,valueToDisplayData:Qt,defaultIcon:Qt[t.value].icon})},Ta=()=>o.jsx(Ls,{children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:o.jsx("path",{d:"M2 4h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2m20 0h-6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6M2 12h20m-3-3 3 3-3 3M5 9l-3 3 3 3"})})}),Ea=({readingMode:t,shouldOffsetDoubleSpreads:e,setShouldOffsetDoubleSpreads:s})=>{const{t:r}=U();return tn(t)?o.jsx(at,{sx:{justifyContent:"start",textTransform:"unset"},size:"large",onClick:()=>s(!e),color:e?"secondary":"primary",variant:"contained",startIcon:o.jsx(Ta,{}),children:r("reader.settings.label.offset_double_spread")}):null},wa=({readingDirection:t,setReadingDirection:e,...s})=>{const{t:r}=U();return o.jsx(lr,{...s,tooltip:r("reader.settings.label.reading_direction"),value:t.isDefault?void 0:t.value,defaultValue:t.isDefault?t.value:void 0,values:Xr,setValue:e,valueToDisplayData:pr,defaultIcon:pr[t.value].icon})},Aa=Ie(o.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 14H9V8h2zm4 0h-2V8h2z"})),Ia=Ie(o.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 14.5v-9l6 4.5z"})),Da=({autoScroll:t,setAutoScroll:e})=>{const{t:s}=U(),{isActive:r,toggleActive:n}=Wt(i=>({isActive:i.autoScroll.isActive,toggleActive:i.autoScroll.toggleActive})),a=l.useRef(void 0);return o.jsxs(B,{sx:{flexDirection:"row",gap:1},children:[o.jsx(at,{sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},size:"large",onClick:n,color:r?"secondary":"primary",variant:"contained",startIcon:r?o.jsx(Aa,{}):o.jsx(Ia,{}),children:s("reader.settings.auto_scroll.title")}),o.jsx(js,{value:t.value,type:"number",size:"small",onBlur:i=>{const c=nt(+i.target.value,Ve.min,Ve.max);c!==t.value&&(clearTimeout(a.current),e({...t,value:c},!0))},onChange:i=>{const c=nt(+i.target.value,Ve.min,Ve.max);e({...t,value:c},!1),clearTimeout(a.current),a.current=setTimeout(()=>e({...t,value:c},!0),rt(1).seconds.inWholeMilliseconds)},slotProps:{input:{inputProps:Ve,endAdornment:o.jsx(ys,{position:"end",children:s("global.time.seconds.second",{count:t.value})})}}})]})},Oa=({openSettings:t})=>{const{t:e}=U(),{readingMode:s,shouldOffsetDoubleSpreads:r,pageScaleMode:n,shouldStretchPage:a,readingDirection:i,autoScroll:c}=J(d=>({readingMode:d.settings.readingMode,shouldOffsetDoubleSpreads:d.settings.shouldOffsetDoubleSpreads,pageScaleMode:d.settings.pageScaleMode,shouldStretchPage:d.settings.shouldStretchPage,readingDirection:d.settings.readingDirection,autoScroll:d.settings.autoScroll}));return o.jsxs(B,{sx:{gap:1},children:[o.jsx(Pa,{readingMode:s,setReadingMode:d=>L.updateSetting("readingMode",d),isDefaultable:!0,onDefault:()=>L.deleteSetting("readingMode")}),o.jsx(Ea,{readingMode:s.value,shouldOffsetDoubleSpreads:r.value,setShouldOffsetDoubleSpreads:d=>L.updateSetting("shouldOffsetDoubleSpreads",d)}),o.jsx(Ca,{pageScaleMode:n,shouldStretchPage:a,updateSetting:L.updateSetting,isDefaultable:!0,onDefault:()=>L.deleteSetting("pageScaleMode")}),o.jsx(wa,{readingDirection:i,setReadingDirection:d=>L.updateSetting("readingDirection",d),isDefaultable:!0,onDefault:()=>L.deleteSetting("readingDirection")}),o.jsx(Da,{autoScroll:c,setAutoScroll:(...d)=>L.updateSetting("autoScroll",...d)}),o.jsx(at,{onClick:()=>t(),size:"large",sx:{justifyContent:"start",textTransform:"none"},variant:"contained",startIcon:o.jsx($r,{}),children:e("settings.title")})]})},Ma=l.memo(Oa),La=Ie(o.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"})),Tr={...cr,title:"Fallback",inLibrary:!1},gs=l.memo(()=>{const t=It(n=>n.manga),{inLibrary:e}=t!=null?t:Tr,{t:s}=U(),{updateLibraryState:r}=En(t!=null?t:Tr,!0);return o.jsx(F,{title:s(e?"manga.action.library.remove.label.action":"manga.button.add_to_library"),children:o.jsx(oe,{onClick:r,color:"inherit",children:e?o.jsx(Nn,{}):o.jsx(wn,{})})})}),ja=Ie(o.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),ya=({id:t,isBookmarked:e})=>{const{t:s}=U(),r=e?"unbookmark":"bookmark";return o.jsx(F,{title:s(tr[r].action.single),children:o.jsx(oe,{onClick:()=>ye.performAction(r,[t],{}),color:"inherit",children:e?o.jsx(Ln,{}):o.jsx(ja,{})})})},hs=l.memo(ya),ka=({currentChapter:t})=>{var r;const{t:e}=U(),s=ye.useDownloadStatusFromCache((r=t==null?void 0:t.id)!=null?r:-1);return t&&ye.isDownloaded(t)?o.jsx(F,{title:e(tr.delete.action.single),children:o.jsx(oe,{onClick:()=>ye.performAction("delete",[t.id],{}),color:"inherit",children:o.jsx(kn,{})})}):s?o.jsx(Bn,{chapterId:s.chapter.id}):o.jsx(F,{title:e(tr.download.action.single),disabled:!t,children:o.jsx(oe,{disabled:!t,onClick:()=>{var n;return ye.performAction("download",[(n=t==null?void 0:t.id)!=null?n:-1],{})},color:"inherit",children:o.jsx(yn,{})})})},Ba=l.memo(()=>{const t=We(g=>g.chapters.currentChapter),{id:e,isBookmarked:s,realUrl:r}=t!=null?t:ns,{t:n}=U(),{pageLoadStates:a,setPageLoadStates:i,setRetryFailedPagesKeyPrefix:c}=qe(g=>({pageLoadStates:g.pages.pageLoadStates,setPageLoadStates:g.pages.setPageLoadStates,setRetryFailedPagesKeyPrefix:g.pages.setRetryFailedPagesKeyPrefix})),d=l.useRef(0),p=l.useMemo(()=>a.some(g=>g.error),[a]);return o.jsxs(B,{sx:{flexDirection:"row",justifyContent:"center",gap:1},children:[o.jsx(gs,{}),o.jsx(hs,{id:e,isBookmarked:s}),o.jsx(F,{title:n("reader.button.retry_load_pages"),disabled:!p,children:o.jsx(oe,{onClick:()=>{i(g=>g.map(u=>({url:u.url,loaded:u.loaded}))),c("".concat(d.current)),d.current=(d.current+1)%1e3},disabled:!p,color:"inherit",children:o.jsx(La,{})})}),o.jsx(ka,{currentChapter:t}),o.jsx(F,{title:n("global.button.open_browser"),disabled:!r,children:o.jsx(oe,{disabled:!r,href:r!=null?r:"",rel:"noreferrer",target:"_blank",color:"inherit",children:o.jsx(jn,{})})}),o.jsx(F,{title:n("global.button.open_webview"),disabled:!r,children:o.jsx(oe,{disabled:!r,href:r?At.getWebviewUrl(r):"",rel:"noreferrer",target:"_blank",color:"inherit",children:o.jsx(_n,{})})})]})}),Na=({exit:t})=>{const{t:e}=U(),s=zr();return o.jsx(F,{title:e("reader.button.exit"),children:o.jsx(oe,{sx:{marginRight:2},onClick:t,color:"inherit",children:s(o.jsx(ks,{}),o.jsx(Bs,{}))})})},ps=ge(l.memo(Na),[()=>({exit:L.useExit()})],["exit"]),_a=(t,e)=>{const s=l.useRef(e),r=l.useRef(e);return r.current!==s.current&&!t&&(s.current=!1),r.current!==e&&(s.current=r.current,r.current=e),s.current},Ha=({isVisible:t,openSettings:e,setReaderNavBarWidth:s})=>{const{t:r}=U(),n=It(S=>S.manga),{chapters:a,currentChapter:i,previousChapter:c,nextChapter:d}=We(S=>({chapters:S.chapters.chapters,currentChapter:S.chapters.currentChapter,previousChapter:S.chapters.previousChapter,nextChapter:S.chapters.nextChapter})),p=J(S=>S.settings.isStaticNav),[g,u]=l.useState();Ue(g,l.useCallback(()=>{p&&s(g.offsetWidth)},[g,p])),l.useLayoutEffect(()=>()=>s(0),[]);const x=_a(t,p)&&t?0:void 0;return o.jsx(Ns,{variant:p?"permanent":"persistent",open:t||p,transitionDuration:x,SlideProps:{unmountOnExit:!0},PaperProps:{ref:S=>u(S)},children:o.jsxs(ga,{sx:{backgroundColor:"background.paper",pointerEvents:"all"},children:[o.jsxs(B,{sx:{p:2,gap:2,backgroundColor:"action.hover"},children:[o.jsxs(B,{sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[o.jsx(ps,{}),o.jsx(F,{title:r("reader.settings.label.static_navigation"),children:o.jsx(oe,{onClick:()=>{s(0),L.updateSetting("isStaticNav",!p)},color:p?"primary":"inherit",children:p?o.jsx(Pn,{}):o.jsx(Tn,{})})})]}),n&&i?o.jsxs(o.Fragment,{children:[o.jsx(ha,{mangaId:n.id,mangaTitle:n.title,chapterTitle:i.name,scanlator:i.scanlator}),o.jsx(Ba,{})]}):o.jsx(Vt,{})]}),o.jsxs(B,{sx:{p:2,gap:2},children:[o.jsxs(B,{sx:{gap:1},children:[o.jsx(ma,{}),o.jsx(Ra,{chapters:a,currentChapter:i,nextChapter:d,previousChapter:c})]}),o.jsx(_s,{}),o.jsx(Ma,{openSettings:e})]})]})})},Va=ge(l.memo(Ha),[Ke],["setReaderNavBarWidth"]),za={...cr,title:""},Wa=({isVisible:t,ref:e})=>{const{t:s}=U(),r=kt({popupId:"reader-overlay-more-menu",variant:"popover"}),n=We(f=>f.chapters.currentChapter),a=It(f=>f.manga),i=dt(f=>f.scrollbar),{id:c,title:d}=a!=null?a:za,{id:p,name:g,realUrl:u,isBookmarked:h}=n!=null?n:ns;return o.jsx(nr,{direction:"down",in:t,ref:e,children:o.jsxs(B,{sx:{flexDirection:"row",alignItems:"center",position:"fixed",top:0,left:0,right:"".concat(i.ySize,"px"),p:2,pt:f=>"max(env(safe-area-inset-top), ".concat(f.spacing(2),")"),backgroundColor:f=>st(f.palette.background.paper,.95),pointerEvents:"all",boxShadow:2},children:[o.jsx(ps,{}),o.jsx(B,{sx:{flexGrow:1},children:a&&n?o.jsxs(o.Fragment,{children:[o.jsx(F,{title:d,children:o.jsx(Pt,{lines:1,component:"h1",variant:"h5",children:o.jsx(yt,{component:Ht,to:sr.manga.path(c),sx:{textDecoration:"none",color:"inherit"},children:d})})}),o.jsx(F,{title:g,children:o.jsx(Pt,{lines:1,children:g})})]}):o.jsx(Vt,{})}),o.jsx(gs,{}),o.jsx(hs,{id:p,isBookmarked:h}),o.jsx(oe,{...Bt(r),color:"inherit",children:o.jsx(An,{})}),o.jsxs(Hs,{...Vs(r),children:[o.jsx(Tt,{component:yt,disabled:!u,href:u!=null?u:"",rel:"noreferrer",target:"_blank",children:s("global.button.open_browser")}),o.jsx(Tt,{component:yt,disabled:!u,href:u?At.getWebviewUrl(u):"",rel:"noreferrer",target:"_blank",children:s("global.button.open_webview")}),o.jsx(Tt,{disabled:!u,onClick:async()=>{await navigator.clipboard.writeText(d),Yr(s("global.label.copied_clipboard"),"info")},children:s("global.label.share")})]})]})})},Fa=l.memo(Wa),Ua=Ie(o.jsx("path",{d:"m21.81 12.74-.82-.63v-.22l.8-.63c.16-.12.2-.34.1-.51l-.85-1.48c-.07-.13-.21-.2-.35-.2q-.075 0-.15.03l-.95.38c-.08-.05-.11-.07-.19-.11l-.15-1.01c-.03-.21-.2-.36-.4-.36h-1.71c-.2 0-.37.15-.4.34l-.14 1.01c-.03.02-.07.03-.1.05l-.09.06-.95-.38q-.075-.03-.15-.03c-.14 0-.27.07-.35.2l-.85 1.48c-.1.17-.06.39.1.51l.8.63v.23l-.8.63c-.16.12-.2.34-.1.51l.85 1.48c.07.13.21.2.35.2q.075 0 .15-.03l.95-.37c.08.05.12.07.2.11l.15 1.01c.03.2.2.34.4.34h1.71c.2 0 .37-.15.4-.34l.15-1.01c.03-.02.07-.03.1-.05l.09-.06.95.38q.075.03.15.03c.14 0 .27-.07.35-.2l.85-1.48c.1-.17.06-.39-.1-.51M18 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M17 17h2v4c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v4h-2V6H7v12h10z"})),Ga=Ie(o.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5M7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"})),Er=Ie(o.jsx("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})),wr=Ie(o.jsx("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"})),Xa={display:"flex",alignItems:"center",justifyContent:"end",position:"relative",backgroundColor:"background.default"},Ar="3px",$a=l.memo(({isTrailingPage:t,pagesIndex:e,totalPages:s,isVertical:r,isHorizontal:n})=>{const a="".concat(e/(s-1)*100,"%");return o.jsx(X,{sx:{position:"absolute",...v(r,{top:a,left:"50%"}),...v(n,{top:"50%",left:a}),transform:"translate(-50%, -50%)",width:Ar,height:Ar,borderRadius:100,backgroundColor:"background.paper",...v(t,{backgroundColor:"primary.main"}),zIndex:1}})}),Ya=l.memo(({pageName:t,isTrailingPage:e,isCurrentPage:s,pagesIndex:r,totalPages:n,isVertical:a,isHorizontal:i})=>o.jsx(ls,{pageName:t,progressBarPosition:Rt.BOTTOM,slotProps:{box:{sx:Xa}},children:!s&&o.jsx($a,{isTrailingPage:e,pagesIndex:r,totalPages:n,isVertical:a,isHorizontal:i})})),Ka={[Rt.BOTTOM]:"up",[Rt.LEFT]:"right",[Rt.RIGHT]:"left",[Rt.AUTO]:"left"},Za=({direction:t,topOffset:e=0,bottomOffset:s=0})=>{const r=dt(b=>b.scrollbar),n=ar(b=>b.overlay.isVisible),{currentPageIndex:a,pages:i}=qe(b=>({currentPageIndex:b.pages.currentPageIndex,pages:b.pages.pages})),{previousChapter:c,nextChapter:d}=We(b=>({previousChapter:b.chapters.previousChapter,nextChapter:b.chapters.nextChapter})),{progressBarPosition:p,progressBarPositionAutoVertical:g}=J(b=>({progressBarPosition:b.settings.progressBarPosition,progressBarPositionAutoVertical:b.settings.progressBarPositionAutoVertical})),{setIsMaximized:u,isDragging:h}=zt(b=>({setIsMaximized:b.progressBar.setIsMaximized,isDragging:b.progressBar.isDragging})),[,f]=l.useState({});Ue(window.document.documentElement,l.useCallback(()=>f({}),[]));const x=es(p,g,e+s,r.xSize),{isLeft:S,isRight:T,isVertical:m,isHorizontal:P}=Re(x),A=P?t:"ltr",w=l.useMemo(()=>ke(a,i).pagesIndex,[a,i]),I=l.useMemo(()=>({container:{sx:{flexGrow:1,position:"relative",display:"flex",justifyItems:"center",alignItems:"stretch",backgroundColor:b=>st(b.palette.background.paper,.85),borderRadius:100,boxShadow:2}},progressBarRoot:{sx:{flexGrow:1,gap:0,...v(m,{flexDirection:"column"}),...v(P,{alignItems:"stretch"})}},progressBarSlotsActionArea:{sx:{alignItems:"center",cursor:"pointer",...v(m,{width:"100%",flexDirection:"column",px:2}),...v(P,{height:"100%",py:2})}},progressBarSlotsContainer:{sx:{borderRadius:100,backgroundColor:"background.default",...v(m,{flexDirection:"column",py:1}),...v(P,{px:1})}},progressBarSlot:{sx:{...v(m,{width:"20px"}),...v(P,{height:"20px"})}},progressBarCurrentPageSlot:{sx:{display:"flex",zIndex:1,cursor:"inherit",...v(m,{justifyContent:"center"}),...v(P,{alignItems:"center"})}},progressBarPageTexts:{base:{sx:{...v(m,{py:1}),...v(P,{px:1})}}}}),[m,P]),E=l.useMemo(()=>({progressBarCurrentPage:o.jsx(X,{sx:{position:"absolute",...v(m,{top:"calc(100% - 6px)",...v(w===0,{top:"0"}),width:"75%",height:"6px"}),...v(P,{left:"calc(100% - 0px)",...v(w===0,{left:"0"}),width:"6px",height:"75%"}),backgroundColor:"primary.main",borderRadius:100,cursor:h?"grabbing":"grab"}})}),[w,i.length,h,m,P]);return l.useLayoutEffect(()=>(u(n),()=>u(!1)),[n]),o.jsx(nr,{direction:Ka[x],in:n,children:o.jsx(cs,{sx:{position:"relative",display:"flex",alignItems:"end",height:"100%",pointerEvents:"none",...v(S,{justifyContent:t==="ltr"?"start":"end"}),...v(T,{justifyContent:t==="ltr"?"end":"start"})},children:o.jsxs(B,{sx:{p:2,gap:1,pointerEvents:"all",alignItems:"center",...v(m,{height:"100%",flexDirection:"column"}),...v(P,{width:"100%",flexDirection:"row"})},children:[o.jsx(oe,{onClick:()=>V.openChapter("previous"),disabled:!c,sx:{backgroundColor:b=>st(b.palette.background.paper,.85),boxShadow:2},children:q(o.jsx(Er,{sx:{...v(m,{transform:"rotate(90deg)"})}}),o.jsx(wr,{sx:{...v(m,{transform:"rotate(90deg)"})}}),A)}),o.jsx(is,{direction:A,progressBarPosition:x,fullSegmentClicks:!1,createProgressBarSlot:l.useCallback((b,C,D,j,N,k,M,G)=>o.jsx(Ya,{pageName:b.name,isTrailingPage:M,isCurrentPage:N,pagesIndex:C,totalPages:G,isVertical:m,isHorizontal:P}),[m,P]),slotProps:{...I,progressBarReadPages:{sx:{backgroundColor:"primary.main",...v(m,{width:"20px",height:"".concat(Math.max(0,ke(a,i).pagesIndex)/(i.length-1)*100,"%"),borderRadius:"400px 400px 0 0"}),...v(P,{width:"".concat(Math.max(0,ke(a,i).pagesIndex)/(i.length-1)*100,"%"),height:"20px",borderRadius:"400px 0 0 400px"})}}},slots:E}),o.jsx(oe,{onClick:()=>V.openChapter("next"),disabled:!d,sx:{backgroundColor:b=>st(b.palette.background.paper,.85),boxShadow:2},children:q(o.jsx(wr,{sx:{...v(m,{transform:"rotate(90deg)"})}}),o.jsx(Er,{sx:{...v(m,{transform:"rotate(90deg)"})}}),A)})]})})})},qa=ge(l.memo(Za),[()=>({direction:L.useGetThemeDirection()})],["direction"]),Ja=()=>{const{t}=U(),{isActive:e,toggleActive:s}=Wt(i=>({isActive:i.autoScroll.isActive,toggleActive:i.autoScroll.toggleActive})),{readingMode:r,readingDirection:n,autoScroll:a}=J(i=>({readingMode:i.settings.readingMode,readingDirection:i.settings.readingDirection,autoScroll:i.settings.autoScroll}));return o.jsxs(B,{sx:{gap:2},children:[o.jsx(rn,{}),o.jsx(sn,{readingMode:r,setReadingMode:i=>L.updateSetting("readingMode",i),isDefaultable:!0,onDefault:()=>L.deleteSetting("readingMode")}),o.jsx(nn,{readingDirection:n,setReadingDirection:i=>L.updateSetting("readingDirection",i),isDefaultable:!0,onDefault:()=>L.deleteSetting("readingDirection")}),o.jsx(Hn,{label:t("reader.settings.auto_scroll.title"),checked:e,onChange:()=>s()}),o.jsx(an,{autoScroll:a,setAutoScroll:(...i)=>L.updateSetting("autoScroll",...i)})]})},Qa=l.memo(Ja),eo=({openSettings:t,isVisible:e,topOffset:s=0})=>{const{t:r}=U(),{currentChapter:n,chapters:a}=We(h=>({currentChapter:h.chapters.currentChapter,chapters:h.chapters.chapters})),i=kt({variant:"dialog",popupId:"reader-chapter-list-dialog"}),c=kt({variant:"dialog",popupId:"reader-quick-settings-dialog"}),d=dt(h=>h.scrollbar),[p,g]=l.useState(0),u=l.useRef(null);return Ue(u,l.useCallback(()=>{var h,f;return g((f=(h=u.current)==null?void 0:h.clientHeight)!=null?f:0)},[p])),l.useLayoutEffect(()=>{i.close()},[n==null?void 0:n.id]),o.jsxs(o.Fragment,{children:[o.jsxs(B,{sx:{position:"fixed",right:"".concat(d.ySize,"px"),bottom:0,left:0,height:"calc(100% - ".concat(s,"px)")},children:[o.jsx(qa,{topOffset:s,bottomOffset:p}),o.jsx(nr,{direction:"up",in:e,children:o.jsx(B,{ref:u,sx:{alignItems:"center",backgroundColor:h=>st(h.palette.background.paper,.95),pb:"max(".concat(d.xSize,"px, env(safe-area-inset-bottom))"),boxShadow:2,pointerEvents:"all"},children:o.jsxs(B,{sx:{width:"50%",flexDirection:"row",p:2,gap:1,justifyContent:"space-evenly",alignItems:"center"},children:[o.jsx(F,{title:r("reader.button.chapter_list"),children:o.jsx(oe,{...Bt(i),color:"inherit",children:o.jsx(Ga,{})})}),o.jsx(F,{title:r("reader.settings.title.quick_settings"),children:o.jsx(oe,{...Bt(c),color:"inherit",children:o.jsx(Ua,{})})}),o.jsx(F,{title:r("settings.title"),children:o.jsx(oe,{onClick:t,color:"inherit",children:o.jsx($r,{})})})]})})})]}),i.isOpen&&o.jsx(Zt,{...fr(i),fullWidth:!0,maxWidth:"md",scroll:"paper",children:o.jsx(qt,{sx:{p:0,pb:1},children:o.jsx(ds,{style:{minHeight:"15vh",maxHeight:"75vh"},currentChapter:n,chapters:a})})}),c.isOpen&&o.jsx(Zt,{...fr(c),fullWidth:!0,maxWidth:"md",scroll:"paper",children:o.jsx(qt,{children:o.jsx(Qa,{})})})]})},to=l.memo(eo),ro=({isDesktop:t,isMobile:e})=>{const s=ar(d=>d.overlay.isVisible),[r,n]=l.useState(!1),[a,i]=l.useState(0),c=l.useRef(null);return Ue(c,l.useCallback(()=>{var d,p;return i((p=(d=c.current)==null?void 0:d.clientHeight)!=null?p:0)},[e])),o.jsxs(X,{sx:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none",zIndex:1},children:[t&&o.jsxs(o.Fragment,{children:[o.jsx(ua,{}),o.jsx(Va,{isVisible:s,openSettings:()=>n(!0)})]}),e&&o.jsxs(o.Fragment,{children:[o.jsx(Fa,{ref:c,isVisible:s}),o.jsx(to,{openSettings:()=>n(!0),isVisible:s,topOffset:a})]}),o.jsx(Gn,{isOpen:r,close:()=>n(!1)}),o.jsx($n,{})]})},so=ge(l.memo(ro),[L.useOverlayMode],["isDesktop","isMobile"]),Ir="reader-tap-zone-layout-canvas",no=({readerNavBarWidth:t})=>{const e=ot(),{tapZoneLayout:s,tapZoneInvertMode:r,readingDirection:n}=J(f=>({tapZoneLayout:f.settings.tapZoneLayout.value,tapZoneInvertMode:f.settings.tapZoneInvertMode.value,readingDirection:f.settings.readingDirection.value})),a=or(f=>f.tapZone.showPreview),[i,c]=l.useState(0),[d,p]=l.useState(0),[g,u]=l.useState(null);Ue(g,l.useCallback(()=>{var f,x;c((f=g==null?void 0:g.clientWidth)!=null?f:0),p((x=g==null?void 0:g.clientHeight)!=null?x:0)},[g]));const h=Se.getOrCreateCanvas(s,i,d,e.typography.h3,{vertical:r.vertical,horizontal:r.horizontal,isRTL:n===lt.RTL});return l.useLayoutEffect(()=>{const f=document.getElementById(Ir);f==null||f.replaceChildren(h)},[h,a]),o.jsx(X,{ref:u,sx:{position:"fixed",top:0,left:t,right:0,bottom:0,pointerEvents:"none"},children:a&&o.jsx("div",{id:Ir})})},ao=ge(no,[Ke],["readerNavBarWidth"]),oo=({readerNavBarWidth:t})=>{const{value:{red:e,green:s,blue:r,alpha:n,blendMode:a},enabled:i}=J(c=>c.settings.customFilter.rgba);return i?o.jsx(X,{sx:{position:"fixed",top:0,left:t,right:0,bottom:0,pointerEvents:"none",background:"rgba(".concat(e," ").concat(s," ").concat(r," / ").concat(n,"%)"),mixBlendMode:"".concat(a)}}):null},io=ge(oo,[Ke],["readerNavBarWidth"]),Dr=2,mt=0,te=0,re=1,co=(t,e=Ae.XY)=>{const[s,r]=l.useState(!1),n=l.useRef(void 0),a=l.useRef([0,0,0]),i=l.useRef([0,0,0]),c=l.useRef([0,0,0]),d=l.useRef([0,0]),p=l.useRef(void 0),g=l.useRef([0,0]),u=l.useRef([0,0]);return l.useEffect(()=>{const h=t==null?void 0:t.current;if(!h)return()=>{};const f=()=>{n.current||(n.current=getComputedStyle(h));const C=n.current.direction==="rtl",D=n.current.flexDirection==="row-reverse";return C||!C&&D},x=()=>(n.current||(n.current=getComputedStyle(h)),n.current.flexDirection==="column-reverse"),S=e!==Ae.Y,T=e!==Ae.X,m=()=>{p.current!==void 0&&(cancelAnimationFrame(p.current),p.current=void 0)},P=()=>{const C=(Ce,ae,Oe)=>(Ce[mt]-Ce[Dr])/(ae[mt]-ae[Dr])*1e3/Oe,D=[S?C(a.current,c.current,h.clientWidth):0,T?C(i.current,c.current,h.clientHeight):0],j=S&&T?Math.sqrt(D[te]**2+D[re]**2):Math.abs(T?D[re]:D[te]),N=[D[te]/j,D[re]/j],k=nt(1.2*j,-12,12),M=(Date.now()-c.current[mt])/1e3,G=k-14.278*M+75.24*M**2/k-149.72*M**3/k/k;if(!(k!==0&&G>0&&!Number.isNaN(k))){m();return}const ne=(Ce,ae)=>Ce*ae*(k*M-7.1397*M**2+25.08*M**3/k-37.43*M**4/k/k),he=[ne(h.clientWidth,N[te]),ne(h.clientHeight,N[re])],K=[h.scrollWidth-h.clientWidth,h.scrollHeight-h.clientHeight],_=[nt(d.current[te]-he[te],f()?-K[te]:0,K[te]),nt(d.current[re]-he[re],x()?-K[re]:0,K[re])],y=_[te]!==0||_[te]!==K[te],be=_[re]!==0||_[re]!==K[re];y||be||m(),S&&(h.scrollLeft=_[te]),T&&(h.scrollTop=_[re])};let A=!1;const w=C=>{if(A)return!0;const D=[h.clientHeight<h.scrollHeight,h.clientWidth<h.scrollWidth],j=[Math.abs(a.current[mt]-C.pageX)>0,Math.abs(i.current[mt]-C.pageY)>0];return D[te]&&j[te]||D[re]&&j[re]},I=C=>{w(C)&&(A=!0,r(!0),a.current=[...a.current.slice(1),C.pageX],i.current=[...i.current.slice(1),C.pageY],c.current=[...c.current.slice(1),Date.now()],S&&(h.scrollLeft=u.current[te]-(C.pageX-g.current[te])),T&&(h.scrollTop=u.current[re]-(C.pageY-g.current[re])))},E=()=>{h.removeEventListener("mousemove",I),h.removeEventListener("mouseup",E),setTimeout(()=>{A=!1,r(!1)},0),d.current=[h.scrollLeft,h.scrollTop];const C=()=>{P(),p.current=requestAnimationFrame(C)};p.current=requestAnimationFrame(C)},b=C=>{C.button===0&&(C.preventDefault(),g.current=[C.pageX,C.pageY],u.current=[h.scrollLeft,h.scrollTop],a.current=[C.pageX,C.pageX,C.pageX],i.current=[C.pageY,C.pageY,C.pageY],c.current=[Date.now()-2,Date.now()-1,Date.now()],h.addEventListener("mousemove",I),h.addEventListener("mouseup",E),m())};return h.addEventListener("mousedown",b),h.addEventListener("wheel",m),()=>{h.removeEventListener("mousedown",b),h.removeEventListener("wheel",m),m()}},[t,e]),s},lo=(t,e,s,r,n)=>{l.useEffect(()=>{if(t&&!n){s();return}r()},[t,e,n])},uo=(t,e,s,r)=>{l.useEffect(()=>{var a,i;const n=()=>{t&&ze().setIsVisible(!1),e&&s(!1)};return(a=r.current)==null||a.addEventListener("wheel",n),(i=r.current)==null||i.addEventListener("touchmove",n),()=>{var c,d;(c=r.current)==null||c.removeEventListener("wheel",n),(d=r.current)==null||d.removeEventListener("touchmove",n)}},[t,e])};class go{constructor(){Q(this,"TRACK_PAD_DELTA_THRESHOLD",30);Q(this,"MAX_RECORDS",150);Q(this,"data",{simultaneousDeltaOccurrences:[],deltas:{X:[],Y:[]}});Q(this,"detectedTrackPadLike");window.addEventListener("wheel",this.record.bind(this)),setInterval(()=>{this.determineIsTrackPadLike()},rt(5).seconds.inWholeMilliseconds)}record(e){const s=Date.now();e.deltaX!==0&&e.deltaY!==0&&this.data.simultaneousDeltaOccurrences.push(s),this.data.deltas.X.push({timestamp:s,delta:Math.abs(e.deltaX)}),this.data.deltas.Y.push({timestamp:s,delta:Math.abs(e.deltaY)}),this.data.simultaneousDeltaOccurrences=this.cleanupSeries(this.data.simultaneousDeltaOccurrences),this.data.deltas.X=this.cleanupSeries(this.data.deltas.X),this.data.deltas.Y=this.cleanupSeries(this.data.deltas.Y),this.data.deltas.X.length>5&&this.detectedTrackPadLike===void 0&&this.determineIsTrackPadLike()}cleanupSeries(e){if(e.length<=this.MAX_RECORDS*1.25)return e;const s=Math.abs(this.MAX_RECORDS-e.length);return e.slice(s)}getOldestRecordTimestamp(){var e;return(e=this.data.deltas.X[0])==null?void 0:e.timestamp}getLatestRecordTimestamp(){var e;return(e=this.data.deltas.X[this.data.deltas.X.length-1])==null?void 0:e.timestamp}getIndexOfLastValidRecord(e,s,r,n){const a=e.findLastIndex(i=>r-n(i)>s);return nt(a+1,0,e.length-1)}isTrackPadLike(){return!!this.detectedTrackPadLike}determineIsTrackPadLike(){const e=rt(15).seconds.inWholeMilliseconds,s=Date.now(),r=this.getOldestRecordTimestamp(),n=this.getLatestRecordTimestamp();if(!(r!==void 0))return;const i=n!=null?n:s,c=this.hasSimultaneousDeltaOccurrences(e,i),d=this.isTrackPadLikeForDirection("X",e,i),p=this.isTrackPadLikeForDirection("Y",e,i);this.detectedTrackPadLike=c||d||p}hasSimultaneousDeltaOccurrences(e,s){const r=rt(e).milliseconds.asWholeSeconds.div(2).inWholeSeconds,n=this.getIndexOfLastValidRecord(this.data.simultaneousDeltaOccurrences,e,s,a=>a);return this.data.simultaneousDeltaOccurrences.slice(n).length>=r}isTrackPadLikeForDirection(e,s,r){const n=this.getIndexOfLastValidRecord(this.data.deltas[e],s,r,h=>h.timestamp),a=this.data.deltas[e].slice(n).filter(h=>!!h.delta);if(!a.length)return!1;const i=a.sort((h,f)=>h.delta-f.delta),c=i.length%2===0,d=Math.floor(i.length/2),p=i[d].delta,g=(i[d].delta+i[d+1].delta)/2;return(c?g:p)<this.TRACK_PAD_DELTA_THRESHOLD}}const ho=new go,po=(t,e,s)=>{l.useEffect(()=>{const r=s.current;if(t!==z.CONTINUOUS_HORIZONTAL)return()=>{};if(!r)return()=>{};const n=a=>{if(!(Math.abs(a.deltaX)>Math.abs(a.deltaY)||ho.isTrackPadLike())){if(a.preventDefault(),a.shiftKey){r.scrollBy({top:a.deltaY});return}r.scrollBy({left:e===lt.LTR?a.deltaY:a.deltaY*-1})}};return r.addEventListener("wheel",n),()=>r.removeEventListener("wheel",n)},[t,e])},fo=t=>{const e=l.useRef(void 0);l.useEffect(()=>{const s=n=>{const a=t.current;a&&(a.style.cursor=n?"default":"none")},r=()=>{s(!0),clearTimeout(e.current),e.current=setTimeout(()=>{s(!1)},rt(5).seconds.inWholeMilliseconds)};return r(),window.addEventListener("mousemove",r),()=>{s(!0),window.removeEventListener("mousemove",r),clearTimeout(e.current)}},[])},xo=(t,e,s,r,n)=>{l.useLayoutEffect(()=>{var a;e||(a=n.current)==null||a.scrollTo(on(n.current,s,r),0)},[t])},mo=(t,e,s,r,n,a,i,c,d,p)=>{l.useLayoutEffect(()=>{if(t==null)return;const g=ke(t,s);if(i){const f=t>e?Ye.PREVIOUS:Ye.NEXT,x=c.current[g.pagesIndex];x==null||x.scrollIntoView({block:"start",inline:cn(f,d,p)})}const u=ce(g),h=u===r-1;n(null),a(u,!h,h)},[t])},vo=(t,e,s,r,n,a,i)=>{const[c,d]=l.useState(i===z.DOUBLE_PAGE);l.useLayoutEffect(()=>{if(c&&i!==z.DOUBLE_PAGE){d(!1);const u=ts(s);r(u),n(u.map(({primary:{url:h}})=>({url:h,isSpread:!1})));return}i===z.DOUBLE_PAGE&&(c||a(ce(ke(t,e))),r(e),d(i===z.DOUBLE_PAGE))},[e,i])},Yt=({title:t,name:e,scanlator:s,backgroundColor:r})=>{const n=ot(),a=n.palette.getContrastText(Ws(n.palette,Kr[r])),i=st(a,.5);return e?o.jsxs(B,{children:[o.jsx(tt,{color:a,children:t}),o.jsx(tt,{color:a,variant:"h6",component:"h1",children:e}),s&&o.jsx(tt,{variant:"body2",color:i,children:s})]}):null},So=({type:t,currentChapterName:e,currentChapterScanlator:s,previousChapterName:r,previousChapterScanlator:n,nextChapterName:a,nextChapterScanlator:i,readerNavBarWidth:c,handleBack:d})=>{var b;const{t:p}=U(),g=It(C=>C.manga),u=dt(C=>C.scrollbar),h=qe(C=>C.pages.transitionPageMode),{readingMode:f,backgroundColor:x,shouldShowTransitionPage:S}=J(C=>({readingMode:C.settings.readingMode.value,backgroundColor:C.settings.backgroundColor,shouldShowTransitionPage:C.settings.shouldShowTransitionPage})),T=t===le.PREVIOUS,m=t===le.NEXT,P=!!e&&!r,A=!!e&&!a,w=P&&t===le.PREVIOUS,I=A&&t===le.NEXT;return!S&&!(w||I)||!ln(t,h,f)?null:o.jsx(B,{sx:{justifyContent:"center",alignItems:"center",...v(!ue(f),{width:"100%",height:"100%"}),...v(ue(f),{position:"sticky",...v(Fe(f),{left:0,maxWidth:"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px)"),minHeight:"calc(100vh - ".concat(u.xSize,"px)")}),...v(f===z.CONTINUOUS_HORIZONTAL,{top:0,minWidth:"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px)"),maxHeight:"calc(100vh - ".concat(u.xSize,"px)")})})},children:o.jsxs(B,{sx:{gap:2,maxWidth:C=>"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px - ").concat(C.spacing(2),")"),maxHeight:"calc(100vh - ".concat(u.xSize,"px)"),width:"max-content",p:1},children:[T&&P&&o.jsx(tt,{variant:"h6",children:p("reader.transition_page.first_chapter")}),o.jsxs(B,{sx:{gap:5},children:[T&&!P&&o.jsx(Yt,{title:p("reader.transition_page.previous"),name:r,scanlator:n,backgroundColor:x}),!!e&&o.jsx(Yt,{title:p(T?"reader.transition_page.current":"reader.transition_page.finished"),name:e,scanlator:s,backgroundColor:x}),m&&!A&&o.jsx(Yt,{title:p("reader.transition_page.next"),name:a,scanlator:i,backgroundColor:x})]}),m&&A&&o.jsx(tt,{variant:"h6",children:p("reader.transition_page.last_chapter")}),(T&&P||m&&A)&&o.jsxs(B,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:[o.jsx(at,{sx:{flexGrow:1},onClick:C=>{C.stopPropagation(),d()},variant:"contained",children:p("reader.transition_page.exit.previous_page")}),o.jsx(at,{sx:{flexGrow:1},component:Ht,onClick:C=>{C.stopPropagation()},variant:"contained",to:sr.manga.path((b=g==null?void 0:g.id)!=null?b:-1),children:p("reader.transition_page.exit.manga_page")})]})]})})},Or=ge(l.memo(So),[({chapterId:t})=>{const e=We(i=>i.chapters.chapters),s=l.useMemo(()=>e.findIndex(i=>i.id===t),[t,e]),r=e[s],n=l.useMemo(()=>e[s+1],[s,e]),a=l.useMemo(()=>e[s-1],[s,e]);return{currentChapterName:r==null?void 0:r.name,currentChapterScanlator:r==null?void 0:r.scanlator,previousChapterName:n==null?void 0:n.name,previousChapterScanlator:n==null?void 0:n.name,nextChapterName:a==null?void 0:a.name,nextChapterScanlator:a==null?void 0:a.scanlator}},Ke,({chapterId:t,type:e})=>{const s=zs(),r=We(g=>g.chapters.chapters),n=l.useMemo(()=>r.findIndex(g=>g.id===t),[t,r]),a=n===0,i=n===r.length-1,c=e===le.PREVIOUS&&i,d=e===le.NEXT&&a;return{handleBack:c||d?s:He}}],["currentChapterName","currentChapterScanlator","previousChapterName","previousChapterScanlator","nextChapterName","nextChapterScanlator","readerNavBarWidth","handleBack"]),Ro=(t,e,s,r,n,a,i,c,d,p,g,u,h,f,x,S,T,m)=>{var A,w;const P=l.useRef(void 0);l.useLayoutEffect(()=>{var j;const I=(j=e.data)==null?void 0:j.fetchChapterPages;if(!I)return;const{pages:E}=I,b=E.length?E:[""],C=dn(s,r!=null?r:0,b.length-1),D=P.current!==(I==null?void 0:I.pages);if(D){P.current=I.pages;const N=ts(b);d(!0),u(N),h(b),f(N.map(({primary:{url:k}})=>({url:k,loaded:!1}))),x(N.map(({primary:{url:k}})=>({url:k,isSpread:!1})))}else u(n),f(a),x(i);g(I.pages.length),h(b),S(C),T(C),p(N=>({...N,isCurrentChapterReady:c||D})),m(le.NONE)},[(w=(A=e.data)==null?void 0:A.fetchChapterPages)==null?void 0:w.pages,t])},Mr=0,Lt="-10px",bo=(t,e,s)=>{if(!ue(e))return;const r=Ct[s],n="0px ".concat(Lt," 0px 0px"),a="0px 0px 0px ".concat(Lt);return Fe(e)?t==="first"?"0px 0px ".concat(Lt," 0px"):"".concat(Lt," 0px 0px 0px"):t==="first"?q(n,a,r):q(a,n,r)},Co=(t,e,s,r)=>t===lt.LTR?{start:s>=r,end:e<0}:{start:e<0,end:s>=r},Po=(t,{top:e,right:s,bottom:r,left:n},a,i)=>{const c=window.innerWidth-i,d=window.innerHeight-a;return{[z.CONTINUOUS_VERTICAL]:{start:r>=d,end:e<0},[z.CONTINUOUS_HORIZONTAL]:Co(t,n,s,c)}},To=({[z.CONTINUOUS_VERTICAL]:t,[z.CONTINUOUS_HORIZONTAL]:e},s)=>Fe(s)?t.start||t.end:e.start||e.end,Eo=({[z.CONTINUOUS_VERTICAL]:t,[z.CONTINUOUS_HORIZONTAL]:e},s)=>Fe(s)?t:e,Lr=(t,e,s,r,n,a,i)=>{const{readingMode:c,readingDirection:d,shouldUseInfiniteScroll:p,shouldShowTransitionPage:g}=J(u=>({readingMode:u.settings.readingMode.value,readingDirection:u.settings.readingDirection.value,shouldUseInfiniteScroll:u.settings.shouldUseInfiniteScroll,shouldShowTransitionPage:u.settings.shouldShowTransitionPage}));l.useEffect(()=>{const u=ue(c),h=Fe(c);if(g||!i||!u||!p||!r||n||s===void 0)return()=>{};const f=()=>{const x=i.scrollLeft===0,S=i.scrollLeft===i.scrollWidth-i.clientWidth,T=i.scrollTop===0,m=i.scrollTop===i.scrollHeight-i.clientHeight;(t==="first"&&(h?T:x)||t==="last"&&(h?m:S))&&V.openChapter(s,void 0,!1)};return i.addEventListener("scroll",f),()=>i.removeEventListener("scroll",f)},[c,i,g,p,r,n,s]),Vn(a,l.useCallback(u=>{if(!p||!ue(c)||s===void 0||!g&&!n)return;const h=u[u.length-1],f=Po(d,h.target.getBoundingClientRect(),Rr().xSize,Rr().ySize),{start:x,end:S}=Eo(f,c),T=h.intersectionRatio<=Mr;if(!To(f,c))return;const m=t==="first"&&x&&!n,P=t==="last"&&!r&&S;if(m||t==="last"&&S&&T){V.openChapter(s,!n,!1);return}P&&V.openChapter(e,!1,!1)},[t,e,s,r,n,c,d,p,g]),l.useMemo(()=>({root:i,threshold:[Mr],rootMargin:bo(t,c,d),ignoreInitialObserve:!0}),[t,c,d]))},wo=({chapterId:t,previousChapterId:e,nextChapterId:s,isPreviousChapterVisible:r,isCurrentChapter:n,isNextChapterVisible:a,imageWrapper:i,scrollElement:c})=>(Lr("first",t,e,n,r,i,c),Lr("last",t,s,n,a,i,c),null),Ao=l.memo(wo),Io=({currentPageIndex:t,setPages:e,setPageLoadStates:s,setTotalPages:r,setCurrentPageIndex:n,updateCurrentPageIndex:a,setPageToScrollToIndex:i,transitionPageMode:c,retryFailedPagesKeyPrefix:d,setTransitionPageMode:p,readingMode:g,readerWidth:u,pageScaleMode:h,shouldOffsetDoubleSpreads:f,readingDirection:x,imagePreLoadAmount:S,pageGap:T,chapterId:m,previousChapterId:P,nextChapterId:A,isPreviousChapterVisible:w,isNextChapterVisible:I,lastPageRead:E,isInitialChapter:b,isCurrentChapter:C,isPreviousChapter:D,isNextChapter:j,isLeadingChapter:N,isTrailingChapter:k,isPreloadMode:M,imageRefs:G,scrollIntoView:xe,resumeMode:ne,customFilter:he,shouldStretchPage:K,readerNavBarWidth:_,onSizeChange:y,minWidth:be,minHeight:De,scrollElement:Ce})=>{const{t:ae}=U(),{direction:Oe}=ot(),[Ge,Pe]=At.useGetChapterPagesFetch(m!=null?m:-1),[Te,Be]=l.useState(!1),[me,Xe]=l.useState(Mt.totalPages),[Je,it]=l.useState(Mt.pageUrls),[Me,Ee]=l.useState(Mt.pages),[$,Le]=l.useState(Mt.pageLoadStates),[Ne,_e]=l.useState($.map(({url:O})=>({url:O,isSpread:!1}))),R=l.useRef(null),Y=l.useRef(C),pe=l.useRef(Me.map(()=>null)),W=l.useRef(null),ve=l.useMemo(()=>!!!me||!(me===Ne.length)?Me:g===z.DOUBLE_PAGE?un(Je,Ne,f,x):Me,[Ne,g,f,x,me]),Qe=l.useMemo(()=>gn(g),[g]),ut=x===lt.LTR,we=ue(g),$e=!we&&!C||M,Dt=!we&&C,gt=!$e&&(Dt||we&&(b||N)),ht=!$e&&(Dt||we&&(b||k));Y.current=C,C&&(G.current=pe.current);const pt=l.useCallback(()=>{m&&(Be(!1),Ge({variables:{input:{chapterId:m}}}).catch(bt()))},[Ge,m]),Ft=l.useMemo(()=>hn(ve,_e,O=>{Y.current&&s(O),Le(O)},g),[ve,g]),Ut=l.useMemo(()=>pn(O=>{Y.current&&s(O),Le(O)}),[]);l.useEffect(()=>{pt()},[m]),Ue(R,l.useCallback(O=>{const{clientWidth:je,clientHeight:ct}=O[0].target;y(je,ct,m)},[y,R.current,m]));const ie=(O,je,ct,Ot=!1)=>{(Ot||!Te)&&je(O),C&&ct(O)};return Ro(C,Pe,ne,E,ve,$,Ne,Te,Be,O=>ie(O,He,et().setReaderStateChapters),O=>ie(O,Xe,r),O=>ie(O,Ee,e),O=>ie(O,it,He),O=>ie(O,Le,s),O=>ie(O,_e,He),O=>ie(O,He,n),O=>{(b&&!Te||xe)&&(i(O),et().setReaderStateChapters(je=>({...je,visibleChapters:{...je.visibleChapters,scrollIntoView:!1,resumeMode:void 0}})))},O=>ie(O,He,p)),vo(t,ve,Je,O=>ie(O,Ee,e,!0),O=>ie(O,_e,He,!0),O=>ie(O,He,a),g),we||C||D||j?Pe.error?$e?null:o.jsx(X,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center",position:"relative"},children:o.jsx(Nt,{message:ae("global.error.label.failed_to_load_data"),messageExtra:Zr(Pe.error),retry:()=>{pt()}})}):Pe.loading||!Te?$e?null:o.jsx(X,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center"},children:o.jsx(Vt,{})}):m!=null&&!me?$e?null:o.jsx(X,{sx:{minWidth:"100%",minHeight:"100%",position:"relative"},children:o.jsx(Nt,{message:ae("reader.error.label.no_pages_found"),retry:pt})}):o.jsxs(B,{ref:R,sx:{width:"fit-content",height:"fit-content",margin:"auto",flexWrap:"nowrap",...v(g===z.CONTINUOUS_HORIZONTAL,{minHeight:De}),...v(Fe(g),{minWidth:be}),...v($e,{maxWidth:0,maxHeight:0,minWidth:"unset",minHeight:"unset",overflow:"hidden",margin:"unset"}),...v(Fe(g)&&rs(u,h),{alignItems:"center"}),...v(g===z.CONTINUOUS_HORIZONTAL,{...v(Oe==="ltr",{flexDirection:ut?"row":"row-reverse"}),...v(Oe==="rtl",{flexDirection:ut?"row-reverse":"row"})})},children:[!M&&o.jsx(Ao,{chapterId:m,previousChapterId:P,nextChapterId:A,isCurrentChapter:C,isPreviousChapterVisible:w,isNextChapterVisible:I,imageWrapper:W.current,scrollElement:Ce}),gt&&o.jsx(Or,{chapterId:m,type:le.PREVIOUS}),o.jsx(Qe,{ref:W,totalPages:me,currentPageIndex:t,pages:ve,transitionPageMode:c,pageLoadStates:$,retryFailedPagesKeyPrefix:d,imageRefs:pe,onLoad:Ft,onError:Ut,isCurrentChapter:C,isPreviousChapter:D,isNextChapter:j,readingMode:g,imagePreLoadAmount:S,readingDirection:x,pageScaleMode:h,pageGap:T,customFilter:he,shouldStretchPage:K,readerWidth:u,readerNavBarWidth:_,isPreloadMode:M,resumeMode:ne,handleAsInitialRender:xe}),ht&&o.jsx(Or,{chapterId:m,type:le.NEXT})]}):null},Do=l.memo(Io),Oo=(t,e,s,r)=>{if(!ue(t))return!1;const n=fn(e),a=xn(e),i=s!==window.innerWidth,c=r!==window.innerHeight;return n&&i||a&&c},vt=(t,e,s)=>{l.useLayoutEffect(()=>{s(e)},[t])},Mo=(t,e,s,r)=>{const n=l.useRef({width:window.innerWidth,height:window.innerHeight}),a=l.useRef(!1),i=l.useRef(void 0),c=l.useRef(null),d=l.useCallback(()=>{const{width:p,height:g}=n.current;n.current={width:window.innerWidth,height:window.innerHeight},a.current||(a.current=!0,c.current=r),Oo(t,e,p,g)&&(s(c.current),clearTimeout(i.current),i.current=setTimeout(()=>{a.current=!1,c.current=null},50))},[t,e,r]);zn("resize",d)},fs=t=>{const e=l.useRef({left:0,top:0,visibleElement:void 0,visibleElementLeft:0,visibleElementTop:0});return l.useEffect(()=>{const s=t.current;if(!s)return()=>{};const r=()=>{var a,i;const{visibleElement:n}=e.current;e.current={...e.current,left:s.scrollLeft,top:s.scrollTop,visibleElementLeft:(a=n==null?void 0:n.offsetLeft)!=null?a:0,visibleElementTop:(i=n==null?void 0:n.offsetTop)!=null?i:0}};return s.addEventListener("scroll",r),()=>s.removeEventListener("scroll",r)},[]),l.useEffect(()=>{const s=t.current;if(!s)return()=>{};const r=(i,c)=>Array.from(i).filter(d=>d instanceof HTMLElement).flatMap(d=>d instanceof HTMLImageElement?[d]:Array.from(d.querySelectorAll("img"))).forEach(c),n=new IntersectionObserver(i=>{const c=i.find(d=>d.isIntersecting);(c==null?void 0:c.target)instanceof HTMLElement&&(e.current={...e.current,visibleElement:c.target,visibleElementLeft:c.target.offsetLeft,visibleElementTop:c.target.offsetTop})}),a=new MutationObserver(i=>{for(const c of i)r(c.addedNodes,d=>n.observe(d)),r(c.removedNodes,d=>n.unobserve(d))});return a.observe(s,{childList:!0,subtree:!0}),()=>{a.disconnect(),n.disconnect()}},[]),e},Lo=(t,e)=>{const s=fs(t),r=ue(e),n=Fe(e);l.useEffect(()=>{const a=t.current;if(!a||!r)return()=>{};const i=g=>{const{left:u,top:h,visibleElement:f,visibleElementLeft:x,visibleElementTop:S}=s.current;if(!f||!!!g.filter(w=>!(w.target instanceof HTMLElement)||!w.target.clientWidth&&!w.target.clientHeight?!1:n?w.target.offsetTop<h:Math.abs(w.target.offsetLeft)<Math.abs(u)).length)return;const P=u-x+f.offsetLeft,A=h-S+f.offsetTop;a.scrollTo(P,A)},c=(g,u)=>Array.from(g).filter(h=>h instanceof HTMLElement).flatMap(h=>h instanceof HTMLImageElement?[h]:Array.from(h.querySelectorAll("img"))).forEach(u),d=new ResizeObserver(i),p=new MutationObserver(g=>{for(const u of g)c(u.addedNodes,h=>d.observe(h)),c(u.removedNodes,h=>d.unobserve(h))});return p.observe(a,{childList:!0,subtree:!0}),()=>{p.disconnect(),d.disconnect()}},[r,n])},jo=(t,e,s,r,n,a,i)=>{const c=fs(t),d=()=>{const p=t.current,{left:g,top:u,visibleElementLeft:h,visibleElementTop:f,visibleElement:x}=c.current;if(!p||!i||!x)return!1;const S=ss(s,n,a),T=r===0;if(!(!S.previous&&T))return!1;const P=g-h+x.offsetLeft,A=u-f+x.offsetTop;return p.scrollTo(P,A),!0};l.useEffect(()=>{const p=t.current;if(!p||!i)return()=>{};let g=!1;const u=(x,S)=>{Array.from(x).filter(T=>T instanceof HTMLElement).flatMap(T=>T instanceof HTMLImageElement?[T]:Array.from(T.querySelectorAll("img"))).forEach(S)},h=new ResizeObserver(()=>{g||(g=d(),g&&h.disconnect())}),f=new MutationObserver(x=>{for(const S of x)u(S.addedNodes,T=>h.observe(T)),u(S.removedNodes,T=>h.unobserve(T))});return f.observe(p,{childList:!0,subtree:!0}),()=>{f.disconnect(),h.disconnect()}},[e]),l.useLayoutEffect(()=>{d()},[e])},yo=(t,e,s,r,n,a,i,c,d,p,g,u)=>{jo(t,e,s,r,n,a,ue(i)),Lo(t,i),Mo(i,p,d,r),vt(c,r,d),vt(i,r,d),vt(p,r,d),vt(g,r,d),vt(u,r,d)},ko={[z.SINGLE_PAGE]:xt.X,[z.DOUBLE_PAGE]:xt.X,[z.CONTINUOUS_VERTICAL]:xt.Y,[z.CONTINUOUS_HORIZONTAL]:xt.X,[z.WEBTOON]:xt.Y},Bo=({readerNavBarWidth:t,updateCurrentPageIndex:e,ref:s})=>{var _e;const{direction:r}=ot(),n=ar(R=>R.overlay.isVisible),{currentPageIndex:a,pageToScrollToIndex:i,setPageToScrollToIndex:c,pages:d,totalPages:p,setPages:g,setPageLoadStates:u,setTotalPages:h,setCurrentPageIndex:f,transitionPageMode:x,retryFailedPagesKeyPrefix:S,setTransitionPageMode:T}=qe(R=>({currentPageIndex:R.pages.currentPageIndex,pageToScrollToIndex:R.pages.pageToScrollToIndex,setPageToScrollToIndex:R.pages.setPageToScrollToIndex,pages:R.pages.pages,totalPages:R.pages.totalPages,setPages:R.pages.setPages,setPageLoadStates:R.pages.setPageLoadStates,setTotalPages:R.pages.setTotalPages,setCurrentPageIndex:R.pages.setCurrentPageIndex,transitionPageMode:R.pages.transitionPageMode,retryFailedPagesKeyPrefix:R.pages.retryFailedPagesKeyPrefix,setTransitionPageMode:R.pages.setTransitionPageMode})),{initialChapter:m,currentChapter:P,chapters:A,visibleChapters:w,isCurrentChapterReady:I}=We(R=>({initialChapter:R.chapters.initialChapter,currentChapter:R.chapters.currentChapter,chapters:R.chapters.chapters,visibleChapters:R.chapters.visibleChapters,setReaderStateChapters:R.chapters.setReaderStateChapters,isCurrentChapterReady:R.chapters.isCurrentChapterReady})),{readingMode:E,readingDirection:b,readerWidth:C,pageScaleMode:D,shouldOffsetDoubleSpreads:j,imagePreLoadAmount:N,pageGap:k,customFilter:M,shouldStretchPage:G,isStaticNav:xe}=J(R=>({readingMode:R.settings.readingMode.value,readingDirection:R.settings.readingDirection.value,readerWidth:R.settings.readerWidth.value,pageScaleMode:R.settings.pageScaleMode.value,shouldOffsetDoubleSpreads:R.settings.shouldOffsetDoubleSpreads.value,imagePreLoadAmount:R.settings.imagePreLoadAmount,pageGap:R.settings.pageGap.value,customFilter:R.settings.customFilter,shouldStretchPage:R.settings.shouldStretchPage.value,isStaticNav:R.settings.isStaticNav})),{showPreview:ne,setShowPreview:he}=or(R=>({showPreview:R.tapZone.showPreview,setShowPreview:R.tapZone.setShowPreview})),{resumeMode:K=xr.START}=(_e=qr().state)!=null?_e:{resumeMode:xr.START},_=l.useRef(null),y=Wn(s,_),be=Fe(E),De=ue(E),Ce=co(_),ae=Wt(R=>({isPaused:R.autoScroll.isPaused,pause:R.autoScroll.pause,resume:R.autoScroll.resume,setScrollRef:R.autoScroll.setScrollRef}));l.useEffect(()=>ae.setScrollRef(_.current),[]);const Oe=mr.useGetScrollbarSize("width",_.current),Ge=mr.useGetScrollbarSize("height",_.current);l.useLayoutEffect(()=>{const{scrollbar:R}=ir();R.setXSize(Oe),R.setYSize(Ge)},[Oe,Ge]);const Pe=l.useRef(d.map(()=>null)),[{minChapterViewWidth:Te,minChapterViewHeight:Be,minChapterSizeSourceChapterId:me},Xe]=l.useState({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),[,Je]=l.useState({}),it=ko[E],Me=b===lt.LTR,Ee=l.useMemo(()=>A.findIndex(R=>R.id===(m==null?void 0:m.id)),[A,m==null?void 0:m.id]),$=l.useMemo(()=>A.slice(Math.max(0,Ee-w.trailing),Math.min(A.length,Ee+w.leading+1)),[A,Ee,w.trailing,w.leading]),Le=l.useMemo(()=>$.findIndex(R=>R.id===(P==null?void 0:P.id)),[P,$]),Ne=l.useCallback((R,Y,pe)=>{if(!De)return;const W=pe===me;if(be){if(!W&&Te>=R)return;Xe({minChapterViewWidth:R,minChapterViewHeight:0,minChapterSizeSourceChapterId:pe});return}(W||Be<Y)&&Xe({minChapterViewWidth:0,minChapterViewHeight:Y,minChapterSizeSourceChapterId:pe})},[De,be,Te,Be,me]);if(mo(i,a,d,p,c,e,De,Pe,r,b),xo(a,De,r,b,_),fo(_),po(E,b,_),uo(n,ne,he,_),lo(n,ae.isPaused,ae.pause,ae.resume,xe),yo(_,P==null?void 0:P.id,Le,a,$,w,E,b,c,D,G,C),l.useLayoutEffect(()=>{Xe({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),Je({})},[E]),!m||!P)throw new Error("ReaderViewer: illegal state - initialChapter and currentChapter should not be undefined");return o.jsx(B,{ref:y,sx:{width:"100%",height:"100%",overflow:"auto",flexWrap:"nowrap",...v(be&&rs(C,D),{alignItems:"center"}),...v(!be,{...v(r==="ltr",{flexDirection:Me?"row":"row-reverse"}),...v(r==="rtl",{flexDirection:Me?"row-reverse":"row"})})},onClick:R=>!Ce&&V.handleClick(_.current,R),onScroll:()=>V.updateCurrentPageOnScroll(Pe,p-1,e,it,b),children:$.map((R,Y)=>{var O,je,ct,Ot;const pe=Math.max(0,$.length-Y-1),W=$[pe],ve=(O=$[pe+1])!=null?O:A[Ee+w.leading+1],Qe=(je=$[pe-1])!=null?je:A[Ee-w.trailing-1],ut=W.id===m.id,we=W.id===P.id,$e=W.id===((ct=$[Le+1])==null?void 0:ct.id),Dt=W.id===((Ot=$[Le-1])==null?void 0:Ot.id),gt=m.sourceOrder>W.sourceOrder,ht=m.sourceOrder<W.sourceOrder,pt=w.lastLeadingChapterSourceOrder===W.sourceOrder,Ft=w.lastTrailingChapterSourceOrder===W.sourceOrder,Ut=pt&&w.isLeadingChapterPreloadMode||Ft&&w.isTrailingChapterPreloadMode,ie=ss(pe,$,w),Gt=W.id===me;return o.jsx(Do,{chapterId:W.id,previousChapterId:ve==null?void 0:ve.id,nextChapterId:Qe==null?void 0:Qe.id,isPreviousChapterVisible:ie.previous,isNextChapterVisible:ie.next,lastPageRead:nt(W.lastPageRead,0,W.pageCount-1),currentPageIndex:vn(a,W,P,we,I,gt,ht,w),isInitialChapter:ut,isCurrentChapter:we,isPreviousChapter:$e,isNextChapter:Dt,isLeadingChapter:gt,isTrailingChapter:ht,isPreloadMode:Ut,imageRefs:Pe,setPages:g,setPageLoadStates:u,setTotalPages:h,setCurrentPageIndex:f,setPageToScrollToIndex:c,transitionPageMode:x,retryFailedPagesKeyPrefix:S,readingMode:E,readerWidth:C,pageScaleMode:D,shouldOffsetDoubleSpreads:j,readingDirection:b,updateCurrentPageIndex:we?e:He,scrollIntoView:we&&w.scrollIntoView,resumeMode:mn(we,ut,gt,ht,w.resumeMode,K),setTransitionPageMode:T,pageGap:k,imagePreLoadAmount:N,customFilter:M,shouldStretchPage:G,readerNavBarWidth:t,onSizeChange:Ne,minWidth:Gt?0:Te,minHeight:Gt?0:Be,scrollElement:_.current},W.id)})})},No=ge(l.memo(Bo),[()=>({updateCurrentPageIndex:V.useUpdateCurrentPageIndex()}),Ke],["readerNavBarWidth","updateCurrentPageIndex"]),_o=Object.fromEntries(Object.values(wt).map(t=>[t,{scopes:t}])),se=(...t)=>{const[e,s,r,n]=t;return Fs(e,s,{...r,..._o.reader},n)},Kt=(t,e,s,r,n)=>{if(r){L.updateSetting(t,s[0]);return}const a=us(s.indexOf(e),s,n);if(a===void 0){L.deleteSetting(t);return}L.updateSetting(t,a)},Ho=({scrollElementRef:t})=>{const e=L.useGetThemeDirection(),{enableScope:s,disableScope:r}=Nr(),{hotkeys:n}=J(i=>({hotkeys:i.settings.hotkeys})),a=L.useExit();return se(n[ee.PREVIOUS_PAGE],()=>V.openPage("previous")),se(n[ee.NEXT_PAGE],()=>V.openPage("next")),se(n[ee.SCROLL_BACKWARD],()=>{const i=jt(),{readingMode:c,readingDirection:d,scrollAmount:p}=Z();if(i.isActive){i.setDirection(de.BACKWARD);return}t.current&&V.scroll(de.BACKWARD,er[c.value],c.value,d.value,t.current,Et().setShowPreview,p)},{preventDefault:!0}),se(n[ee.SCROLL_FORWARD],()=>{const i=jt(),{readingMode:c,readingDirection:d,scrollAmount:p}=Z();if(i.isActive){i.setDirection(de.FORWARD);return}t.current&&V.scroll(de.FORWARD,er[c.value],c.value,d.value,t.current,Et().setShowPreview,p)},{preventDefault:!0}),se(n[ee.PREVIOUS_CHAPTER],()=>V.openChapter(q("previous","next",e)),[e]),se(n[ee.NEXT_CHAPTER],()=>V.openChapter(q("next","previous",e)),[e]),se(n[ee.TOGGLE_MENU],()=>ze().setIsVisible(!ze().isVisible)),se(n[ee.CYCLE_SCALE_TYPE],()=>{Kt("pageScaleMode",Z().pageScaleMode.value,Ur,Z().pageScaleMode.isDefault,!0)},[]),se(n[ee.STRETCH_IMAGE],()=>L.updateSetting("shouldStretchPage",!Z().shouldStretchPage.value)),se(n[ee.OFFSET_SPREAD_PAGES],()=>L.updateSetting("shouldOffsetDoubleSpreads",!Z().shouldOffsetDoubleSpreads.value)),se(n[ee.CYCLE_READING_MODE],()=>{Kt("readingMode",Z().readingMode.value,Gr,Z().readingMode.isDefault,!0)}),se(n[ee.CYCLE_READING_DIRECTION],()=>{Kt("readingDirection",Z().readingDirection.value,Xr,Z().readingDirection.isDefault,!0)}),se(n[ee.TOGGLE_AUTO_SCROLL],()=>jt().toggleActive(),{preventDefault:!0}),se(n[ee.AUTO_SCROLL_SPEED_DECREASE],()=>L.updateSetting("autoScroll",{...Z().autoScroll,value:Math.min(Ve.max,Z().autoScroll.value+Ve.step)})),se(n[ee.AUTO_SCROLL_SPEED_INCREASE],()=>L.updateSetting("autoScroll",{...Z().autoScroll,value:Math.max(Ve.min,Z().autoScroll.value-Ve.step)})),se(n[ee.EXIT_READER],a,[a]),l.useEffect(()=>(s(wt.READER),()=>r(wt.READER)),[]),null},Vo=()=>{l.useEffect(()=>()=>{ir().reset()},[])},zo=(t,e,s,r,n,a)=>{var i;l.useEffect(()=>{var x;const c=(x=t.data)==null?void 0:x.manga;if(!c||e.loading||e.error)return;const d=br(c,s),p=Sn(c,d.shouldUseAutoWebtoonMode,d.readingMode),g={...s,readingMode:p?z.WEBTOON:s.readingMode},u=p?z.WEBTOON:d.readingMode.value,h=Rn("global",{meta:r},g,void 0,u),f=br(c,h);n(f),a(!0)},[(i=t.data)==null?void 0:i.manga,s])},jr=rt(5).seconds.inWholeMilliseconds,Wo=(t,e,s,r,n,a,i,c,d)=>{const{t:p}=U(),g=l.useRef(void 0),u=l.useRef(void 0),h=l.useRef(void 0),f=l.useRef(!0);l.useEffect(()=>{if(t||e||!s)return;const x=JSON.stringify(r)!==JSON.stringify(g.current);i&&x&&Yr(p(Qt[r.value].title),{autoHideDuration:jr}),g.current=r;const T=JSON.stringify(n)!==JSON.stringify(u.current)||JSON.stringify(a)!==JSON.stringify(h.current);c&&T&&(d(!0),f.current&&setTimeout(()=>d(!1),jr)),u.current=n,h.current=a,f.current=!1},[t,e,s,r.value,r.isDefault,n.value,n.isDefault,a.value,a.isDefault])},Fo=(t,e,s,r,n,a,i,c)=>{var h;const d=Us(),p=qr().state,{updateInitialChapter:g}=p!=null?p:{},u=g?void 0:r;l.useEffect(()=>{var I,E;const f=(I=t.data)==null?void 0:I.chapters.nodes,x=f?(E=f[f.length-e])!=null?E:null:void 0,S=u!=null?u:x,T=n!=null?n:x,m=(()=>{if(!f||!T)return[];const b=i?In(s!=null?s:f,c):f;return(a?ye.removeDuplicates(T,b):b).map(D=>Jr(D.id))})(),P=x&&ye.getNextChapter(x,m,{offset:Ye.NEXT}),A=x&&ye.getNextChapter(x,m,{offset:Ye.PREVIOUS}),w=S!=null&&S.id!==(u==null?void 0:u.id);w&&d("",{replace:!0,state:{...p,updateInitialChapter:void 0}}),et().setReaderStateChapters(b=>{var D,j,N,k;const C=(x==null?void 0:x.id)!==((D=b.currentChapter)==null?void 0:D.id);return{...b,mangaChapters:(j=b.mangaChapters)!=null?j:f,chapters:m,initialChapter:S,chapterForDuplicatesHandling:T,currentChapter:x,nextChapter:P,previousChapter:A,isCurrentChapterReady:C?!1:b.isCurrentChapterReady,visibleChapters:w?{...$t.chapters.visibleChapters,lastLeadingChapterSourceOrder:(N=S==null?void 0:S.sourceOrder)!=null?N:$t.chapters.visibleChapters.lastLeadingChapterSourceOrder,lastTrailingChapterSourceOrder:(k=S==null?void 0:S.sourceOrder)!=null?k:$t.chapters.visibleChapters.lastTrailingChapterSourceOrder,isLeadingChapterPreloadMode:!1,isTrailingChapterPreloadMode:!1,scrollIntoView:!!b.initialChapter}:b.visibleChapters}})},[(h=t.data)==null?void 0:h.chapters.nodes,e,a,i,u,c])},Uo=1,yr=(t,e,s=!1,r=!1)=>{const n=Math.max(t*e,Uo),a=s?-n:n;return r?a*-1:a},kr=(t,e,s)=>t*(e/100)/s;function Br(t,e,s,r,n){if(n(),!t){s(setInterval(()=>{r(e)},e),"interval");return}let a;const i=c=>{const d=c-(a!=null?a:c);a=c,r(d),s(requestAnimationFrame(i),"animationFrame")};s(requestAnimationFrame(i),"animationFrame")}const Go=(t,e,s=Ae.Y,r=100,n=!1,a=!1)=>{const i=typeof t=="function",c=l.useRef(void 0),d=l.useRef(void 0),p=l.useRef(-1),[g,u]=l.useState(!1),[h,f]=l.useState(!1),[x,S]=l.useState({width:window.innerWidth,height:window.innerHeight});Ue(document.documentElement,l.useCallback(()=>{const E=window.innerWidth,b=window.innerHeight;(x.width!==E||x.height!==b)&&S({width:E,height:b})},[]));const T=l.useCallback(()=>{clearTimeout(d.current),cancelAnimationFrame(p.current)},[]),m=l.useCallback(()=>{u(!0)},[]),P=l.useCallback(()=>{u(!1),f(!1),T()},[]),A=l.useCallback(()=>{if(g){P();return}m()},[g]),w=l.useCallback(()=>{f(!0)},[]),I=l.useCallback(()=>{f(!1)},[]);return l.useEffect(()=>{if(!t||!g)return()=>{};if(h)return T(),()=>{};const E=e*1e3;if(i)return Br(!1,E,M=>{d.current=M},t,T),()=>T();const b=t.current;if(!b)return()=>{};c.current||(c.current=getComputedStyle(b));const C=c.current.direction==="rtl",D=s!==Ae.Y,j=s!==Ae.X,N=kr(window.innerWidth,r,E),k=kr(window.innerHeight,r,E);return Br(a,E,(M,G)=>{switch(G){case"interval":d.current=M;break;case"animationFrame":p.current=M;break;default:throw new Error('Unexpected "type" ('.concat(G,")"))}},M=>{b.scrollBy({top:Number(j)*yr(k,M,!1,n),left:Number(D)*yr(N,M,C,n),behavior:a?void 0:"smooth"})},T),()=>T()},[t,e,r,x,g,h,n,a]),l.useMemo(()=>({isActive:g,isPaused:h,start:m,cancel:P,toggleActive:A,pause:w,resume:I}),[g,h,m,P,A,w,I])},Xo=({themeDirection:t,combinedDirection:e})=>{const{scrollRef:s,direction:r}=Wt(u=>({scrollRef:u.autoScroll.scrollRef,direction:u.autoScroll.direction})),{readingMode:n,autoScroll:a}=J(u=>({readingMode:u.settings.readingMode.value,autoScroll:u.settings.autoScroll})),c=n===z.CONTINUOUS_HORIZONTAL&&t!==e?q(r===de.BACKWARD,r===de.FORWARD,e):r===de.BACKWARD,d=ue(n),p=l.useCallback(()=>{V.openPage("next","ltr")},[]),g=Go(d?s:p,a.value,er[n],Hr.MEDIUM,c,a.smooth);return l.useEffect(()=>{const u=jt();u.setIsActive(g.isActive),u.setIsPaused(g.isPaused),u.setStart(g.start),u.setCancel(g.cancel),u.setToggleActive(g.toggleActive),u.setPause(g.pause),u.setResume(g.resume)},[g]),null},$o=ge(l.memo(Xo),[()=>({themeDirection:ot().direction}),()=>({combinedDirection:L.useGetThemeDirection()})],["themeDirection","combinedDirection"]),Yo=({setOverride:t,readerNavBarWidth:e})=>{var he,K,_;const{t:s}=U(),r=It(y=>y.manga),{mangaChapters:n,initialChapter:a,chapterForDuplicatesHandling:i,currentChapter:c}=We(y=>({mangaChapters:y.chapters.mangaChapters,initialChapter:y.chapters.initialChapter,chapterForDuplicatesHandling:y.chapters.chapterForDuplicatesHandling,currentChapter:y.chapters.currentChapter})),{shouldSkipDupChapters:d,shouldSkipFilteredChapters:p,backgroundColor:g,readingMode:u,tapZoneLayout:h,tapZoneInvertMode:f,shouldShowReadingModePreview:x,shouldShowTapZoneLayoutPreview:S,setSettings:T}=J(y=>({shouldSkipDupChapters:y.settings.shouldSkipDupChapters,shouldSkipFilteredChapters:y.settings.shouldSkipFilteredChapters,backgroundColor:y.settings.backgroundColor,readingMode:y.settings.readingMode,tapZoneLayout:y.settings.tapZoneLayout,tapZoneInvertMode:y.settings.tapZoneInvertMode,shouldShowReadingModePreview:y.settings.shouldShowReadingModePreview,shouldShowTapZoneLayoutPreview:y.settings.shouldShowTapZoneLayoutPreview,setSettings:y.settings.setSettings})),m=or(y=>y.tapZone.setShowPreview),P=l.useRef(null),[A,w]=l.useState(!1),{chapterSourceOrder:I,mangaId:E}=Gs(),b=Number(I),C=Number(E),D=At.useGetManga(Xs,C),j=At.useGetMangaChapters($s,C);Fn(!r||!c?s("reader.title",{mangaId:C,chapterIndex:b}):"".concat(r.title,": ").concat(c.name));const{metadata:N,settings:k,request:M}=bn(),G=Dn(r!=null?r:cr),xe=c===void 0||!A||D.loading||j.loading||M.loading,ne=(K=(he=D.error)!=null?he:j.error)!=null?K:M.error;return l.useEffect(()=>{var y;ir().setManga((y=D.data)==null?void 0:y.manga)},[(_=D.data)==null?void 0:_.manga]),Vo(),zo(D,M,k,N,T,w),Wo(xe,ne,A,u,h,f,x,S,m),Fo(j,b,n,a,i,d,p,G),l.useLayoutEffect(()=>(t({status:!0,value:o.jsxs(X,{sx:{position:"absolute"},children:[o.jsx(Ho,{scrollElementRef:P}),o.jsx(so,{}),!P.current&&o.jsx(X,{onClick:()=>ze().setIsVisible(!ze().isVisible),sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"transparent"}})]})}),()=>t({status:!1,value:null})),[P.current]),ne?o.jsx(Nt,{message:s("global.error.label.failed_to_load_data"),messageExtra:Zr(ne),retry:()=>{D.error&&D.refetch().catch(bt()),M.error&&M.refetch().catch(bt()),j.error&&j.refetch().catch(bt())}}):xe?o.jsx(X,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:o.jsx(Vt,{})}):c===null?o.jsx(Nt,{message:s("reader.error.label.chapter_not_found")}):!r||!c?null:o.jsxs(X,{sx:{position:"relative",display:"flex",flexDirection:"column",minWidth:"calc(100vw - ".concat(e,"px)"),maxWidth:"calc(100vw - ".concat(e,"px)"),width:"calc(100vw - ".concat(e,"px)"),height:"100vh",marginLeft:"".concat(e,"px"),transition:y=>"width 0.".concat(y.transitions.duration.shortest,"s, margin-left 0.").concat(y.transitions.duration.shortest,"s"),overflow:"auto",backgroundColor:Kr[g]},children:[o.jsx(No,{ref:P}),o.jsx(ao,{}),o.jsx(io,{}),o.jsx($o,{})]})},Bi=ge(l.memo(Yo),[Ke],["setOverride","readerNavBarWidth"]);export{Bi as Reader};
