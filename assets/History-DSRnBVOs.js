import{e as n,j as e,_ as C,A as y,L as w,o as I,bl as R,aM as E,u as L,a as M,r as T,h as G,i as P,T as S,g as v}from"./index-DWz4TNtd.js";import{E as h}from"./EmptyViewAbsoluteCentered-DPrnddnF.js";import{V as d,a as A,S as O,b as U}from"./Virtuoso.util-zkXm-8Xh.js";import{C as k,D as _}from"./ChapterCardMetadata-CVgQm7ae.js";import{C as B,a as F}from"./ChapterDownloadButton-Bl4yXpX3.js";import{C as N}from"./ChapterDownloadRetryButton-BmiRI-Cp.js";import{L as V}from"./ListCardContent-D0gc0Fug.js";import{C as D}from"./Card-8Hlh2tNY.js";import{C as K}from"./CardActionArea-DZr1-Ien.js";import"./MUI.util-BHb8I4Fi.js";import"./ListCardAvatar-DBmIeoJi.js";import"./Avatar-aJufYokf.js";import"./Download-BNw0zcIk.js";import"./CardContent-CJ5i7b3K.js";const $=n.memo(({chapter:t})=>{const{manga:o}=t;return e.jsx(D,{children:e.jsx(K,{component:w,to:y.reader.path(t.manga.id,t.sourceOrder),state:C.getReaderOpenChapterLocationState(t),sx:{color:a=>a.palette.text[t.isRead?"disabled":"primary"]},children:e.jsxs(V,{sx:{justifyContent:"space-between"},children:[e.jsxs(I,{sx:{display:"flex",flexGrow:1,gap:1},children:[e.jsx(B,{mangaId:o.id,mangaTitle:o.title,thumbnailUrl:o.thumbnailUrl,thumbnailUrlLastFetched:o.thumbnailUrlLastFetched}),e.jsx(k,{title:o.title,secondaryText:"".concat(t.name," â€” ").concat(R.format(E(Number(t.lastReadAt)).valueOf()))})]}),e.jsx(_,{chapterId:t.id}),e.jsx(N,{chapterId:t.id}),e.jsx(F,{chapterId:t.id,isDownloaded:t.isDownloaded})]})})})}),se=()=>{var c;const{t}=L(),{setTitle:o}=M(),{data:a,loading:l,error:m,fetchMore:g,refetch:x}=T.useGetRecentlyReadChapters(void 0,{fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),u=!!(a!=null&&a.chapters.pageInfo.hasNextPage),f=a==null?void 0:a.chapters.pageInfo.endCursor,s=(c=a==null?void 0:a.chapters.nodes)!=null?c:[],i=n.useMemo(()=>Object.entries(C.groupByDate(s,"lastReadAt")),[s]),p=n.useMemo(()=>i.map(r=>r[d.ITEMS].length),[i]),j=d.useCreateGroupedComputeItemKey(p,n.useCallback(r=>i[r][d.GROUP],[i]),n.useCallback(r=>s[r].id,[s]));n.useLayoutEffect(()=>(o(t("history.title")),()=>{o("")}),[t]);const b=n.useCallback(()=>{u&&g({variables:{offset:s.length}})},[u,f]);return m?e.jsx(h,{message:t("global.error.label.failed_to_load_data"),messageExtra:G(m),retry:()=>x().catch(P())}):!l&&s.length===0?e.jsx(h,{message:t("history.error.label.no_history_available")}):e.jsx(A,{components:{Footer:()=>l?e.jsx(v,{usePadding:!0}):null},overscan:window.innerHeight*.5,endReached:b,groupCounts:p,groupContent:r=>e.jsx(U,{isFirstItem:r===0,children:e.jsx(S,{variant:"h5",component:"h2",children:i[r][d.GROUP]})}),computeItemKey:j,itemContent:r=>e.jsx(O,{children:e.jsx($,{chapter:s[r]})})})};export{se as History};
