import{u as A,j as e,H as j,T as N,b as w,C as k,I as F,r as h,f as m,o as $,p as M,q as U,aE as P,w as q,B as G,m as O,g as T,cP as K,i as Q,k as W,bG as J}from"./index-B2DqTbID.js";import{A as V}from"./Add-BMopqt35.js";import{D as X,a as Y,b as z,c as Z,S as ee,v as te,d as se,e as ie}from"./DragHandle-B1fVTyir.js";import{D as oe,F as ne}from"./StyledFab-VreNRWhT.js";import{E as re}from"./EmptyViewAbsoluteCentered-BVIzquZB.js";import{E as ae}from"./Edit-DJrWUpfv.js";import{D as de}from"./Delete-BRlR2Kkr.js";import{L as le}from"./ListCardContent-cwBa_56s.js";import{C as ce}from"./Card-CmIha-h5.js";import{u as me}from"./useAppTitle-DOOoVvoM.js";import{a as xe}from"./Asserts-xItX73wb.js";import{F as ue,C as ge}from"./Checkbox-DMtiPQKg.js";import"./SwitchBase-CCmC1nuH.js";const y=({category:i,onEdit:c})=>{const{i18n:a,_:s}=A(),p=()=>{h.deleteCategory(i.id)};return e.jsx(j,{sx:{p:1,pb:0},children:e.jsx(ce,{children:e.jsxs(le,{sx:{gap:2},children:[e.jsx(X,{}),e.jsx(N,{sx:{flexGrow:1},variant:"h6",component:"h2",children:i.name}),e.jsxs(w,{sx:{flexDirection:"row"},children:[e.jsx(k,{title:a._({id:"ePK91l"}),children:e.jsx(F,{component:j,onClick:c,children:e.jsx(ae,{})})}),e.jsx(k,{title:a._({id:"cnGeoo"}),children:e.jsx(F,{component:j,onClick:p,children:e.jsx(de,{})})})]})]})})})},b=-1,he=({category:i,onClose:c})=>{const a=!!i,{i18n:s,_:p}=A(),[n,D]=m.useState(i==null?void 0:i.name),[x,_]=m.useState(!!(i!=null&&i.default)),u=n!==void 0&&!n.trim().length,f=n!==void 0&&!u,E=()=>{if(xe(n),c(),a){h.updateCategory(i.id,{name:n,default:x}).response.catch(r=>O(s._({id:"cBoXe4"}),"error",T(r)));return}h.createCategory({name:n,default:x}).response.catch(r=>O(s._({id:"9B+9sQ"}),"error",T(r)))};return e.jsxs($,{open:!0,onClose:c,children:[e.jsx(M,{id:"form-dialog-title",children:a?s._({id:"j1Jl7s"}):s._({id:"tl5vsv"})}),e.jsxs(U,{children:[e.jsx(P,{autoFocus:!0,margin:"dense",id:"name",label:s._({id:"+HdMsm"}),type:"text",fullWidth:!0,value:n,onChange:r=>D(r.target.value.trim()),error:u,helperText:u?s._({id:"UeOiKl"}):void 0}),e.jsx(ue,{control:e.jsx(ge,{checked:x,onChange:r=>_(r.target.checked)}),label:s._({id:"hf5GFU"})})]}),e.jsxs(q,{children:[e.jsx(G,{onClick:c,color:"primary",children:s._({id:"dEgA5A"})}),e.jsx(G,{onClick:E,color:"primary",disabled:!f,children:s._({id:"hQRttt"})})]})]})};function ke(){const{i18n:i,_:c}=A(),a=Y.useSensorsForDevice();me(i._({id:"EDmovq"}));const{data:s,loading:p,error:n,refetch:D}=h.useGetCategories(K,{notifyOnNetworkStatusChange:!0}),[x,{reset:_}]=h.useReorderCategory(),[u,f]=m.useState(b),[E,r]=m.useState(!1),[g,C]=m.useState(null),d=m.useMemo(()=>{var o;const t=[...(o=s==null?void 0:s.categories.nodes)!=null?o:[]];return t.length>0&&t[0].name==="Default"&&t.shift(),t},[s]),L=(t,o,l)=>{const S=t[o];x({variables:{input:{id:S.id,position:l+1}}}).catch(()=>_())},R=t=>{const{active:o,over:l}=t;if(C(null),!l||o.id===l.id)return;const S=d.findIndex(v=>v.id===o.id),H=d.findIndex(v=>v.id===l.id);L(d,S,H)},I=t=>{f(t!=null?t:b),r(!0)},B=()=>{f(b),r(!1)};return p?e.jsx(Q,{}):n?e.jsx(re,{message:i._({id:"2HCkNR"}),messageExtra:T(n),retry:()=>D().catch(W("CategorySettings::refetch"))}):e.jsxs(e.Fragment,{children:[e.jsx(z,{sensors:a,collisionDetection:Z,onDragStart:t=>{var o;return C((o=d.find(l=>l.id===t.active.id))!=null?o:null)},onDragEnd:R,onDragCancel:()=>C(null),onDragAbort:()=>C(null),children:e.jsxs(j,{sx:{paddingBottom:oe},children:[e.jsx(ee,{items:d,strategy:te,children:d.map((t,o)=>e.jsx(se,{id:t.id,isDragging:t.id===(g==null?void 0:g.id),children:e.jsx(y,{category:t,onEdit:()=>I(o)})},t.id))}),e.jsx(ie,{isActive:!!g,children:e.jsx(y,{category:g,onEdit:J})})]})}),e.jsx(ne,{color:"primary","aria-label":"add",sx:{position:"fixed",bottom:t=>t.spacing(2),right:t=>t.spacing(2)},onClick:()=>I(),children:e.jsx(V,{})}),E&&e.jsx(he,{category:d[u],onClose:B})]})}export{ke as CategorySettings};
