import{u as A,r as x,f as k,j as e,av as w,v as u,o as G,p as R,q as F,cS as L,w as P,B as U,G as S,m as f,g as v,N as j,s as y,cT as b,cP as O,e as B,i as q,k as T,cG as D,A as M,F as V,bR as $}from"./index-BQabjUKA.js";import{C as H,a as X}from"./CategoriesInclusionSetting-C1fowjqR.js";import{C as Y}from"./CheckboxInput-DoO9P99l.js";import{N as W}from"./NumberSetting-BVA9X_Ld.js";import{u as Q,g as Z}from"./usePersistedValue-DTjnu1wJ.js";import{S as C}from"./Switch-o-FWjids.js";import{L as I}from"./ListSubheader-BoNSprH5.js";import{a as z}from"./Mangas-REOBnP29.js";import{E as K}from"./EmptyViewAbsoluteCentered-DmoqT0nI.js";import{u as J}from"./useAppTitle-D27BGGAS.js";import"./ThreeStateCheckboxInput-jzUcBNuf.js";import"./Checkbox-D-q8QTIa.js";import"./SwitchBase-Cf6PCo03.js";import"./Slider-oT4ujvoB.js";import"./Chapters-DeNG7J4T.js";import"./DateHelper-DiHvHyGm.js";import"./Asserts-xItX73wb.js";const ee=t=>{const r=[];return t.excludeUnreadChapters&&r.push(S._(L.excludeUnreadChapters)),t.excludeNotStarted&&r.push(S._(L.excludeNotStarted)),t.excludeCompleted&&r.push(S._(L.excludeCompleted)),!r.length&&r.push(S._({id:"EdQY6l"})),r.join(", ")},te=t=>({excludeCompleted:t.excludeCompleted,excludeNotStarted:t.excludeNotStarted,excludeUnreadChapters:t.excludeUnreadChapters}),se=({serverSettings:t})=>{const{i18n:r,_:a}=A(),s=te(t),[d]=x.useUpdateServerSettings(),[o,i]=k.useState(s!=null?s:{}),[l,n]=k.useState(!1),h=ee(s),c=async()=>{const g=(s==null?void 0:s.excludeCompleted)!==o.excludeCompleted||s.excludeNotStarted!==o.excludeNotStarted||s.excludeUnreadChapters!==o.excludeUnreadChapters;if(n(!1),!!g)try{await d({variables:{input:{settings:o}}})}catch(_){f(r._({id:"cBoXe4"}),"error",v(_))}},m=()=>{i(s!=null?s:{}),n(!1)};return k.useEffect(()=>{s&&i(s)},[s==null?void 0:s.excludeCompleted,s==null?void 0:s.excludeNotStarted,s==null?void 0:s.excludeUnreadChapters]),e.jsxs(e.Fragment,{children:[e.jsx(w,{onClick:()=>n(!0),children:e.jsx(u,{primary:r._({id:"1y0E5U"}),secondary:h,onClick:()=>n(!0)})}),e.jsxs(G,{open:l,onClose:m,children:[e.jsx(R,{children:r._({id:"1y0E5U"})}),e.jsx(F,{children:e.jsx(H,{children:Object.entries(o).map(([g,_])=>e.jsx(Y,{label:r._(L[g]),checked:_,onChange:(N,E)=>{i({...o,[g]:E})}},g))})}),e.jsxs(P,{children:[e.jsx(U,{onClick:m,color:"primary",children:r._({id:"dEgA5A"})}),e.jsx(U,{onClick:c,color:"primary",children:r._({id:"aP3N/0"})})]})]})]})},re=({globalUpdateInterval:t})=>{const{i18n:r,_:a}=A(),s=t,d=!!s,[o]=x.useUpdateServerSettings(),[i,l]=Q("lastGlobalUpdateInterval",b.default,s,Z),n=k.useCallback(c=>{l(c===0?i:c),o({variables:{input:{settings:{globalUpdateInterval:c}}}})},[i]),h=c=>{n(c?i:0)};return e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsx(u,{primary:r._({id:"XN/sSd"})}),e.jsx(C,{edge:"end",checked:d,onChange:c=>h(c.target.checked)})]}),e.jsx(W,{settingTitle:r._({id:"D1wDG2"}),settingValue:r._({id:"uDXDiN",values:{currentAutoUpdateIntervalHours:i}}),value:i,minValue:b.min,maxValue:b.max,defaultValue:b.default,showSlider:!0,valueUnit:r._({id:"3S9JH+"}),handleUpdate:n,disabled:!d})]})},ae=({serverSettings:t,categories:r})=>{const{i18n:a,_:s}=A(),{updateMangas:d}=t,[o]=x.useUpdateServerSettings(),i=async(l,n)=>{try{await o({variables:{input:{settings:{[l]:n}}}})}catch(h){f(a._({id:"cBoXe4"}),"error",v(h))}};return e.jsxs(j,{subheader:e.jsx(I,{component:"div",id:"global-update-settings",children:a._({id:"sUw6wj"})}),children:[e.jsx(re,{globalUpdateInterval:t.globalUpdateInterval}),e.jsx(se,{serverSettings:t}),e.jsx(X,{categories:r,includeField:"includeInUpdate",dialogText:a._({id:"FFwm9b"})}),e.jsxs(y,{children:[e.jsx(u,{primary:a._({id:"wfvRo2"}),secondary:a._({id:"Yy4XAu"})}),e.jsx(C,{edge:"end",checked:d,onChange:l=>i("updateMangas",l.target.checked)})]})]})},ie=async()=>{try{const t=await x.getMangas($,{filter:{inLibrary:{equalTo:!1},categoryId:{isNull:!1}}},{fetchPolicy:"no-cache"}).response,r=z.getIds(t.data.mangas.nodes);r.length&&await x.updateMangasCategories(r,{clearCategories:!0}).response,f(S._({id:"BLMYEZ"}),"success")}catch(t){f(S._({id:"Uub3H3"}),"error",v(t))}};function ve(){var g,_,N,E;const{i18n:t,_:r}=A();J(t._({id:"exYcTF"}));const a=x.useGetCategories(O),s=x.useGetServerSettings({notifyOnNetworkStatusChange:!0}),{settings:d,loading:o,request:{error:i,refetch:l}}=B(),n=V(p=>f(t._({id:"p43DY9"}),"error",v(p))),h=((_=(g=a.data)==null?void 0:g.categories.nodes.length)!=null?_:1)-1;if(s.loading||o||a.loading)return e.jsx(q,{});const m=(E=(N=s.error)!=null?N:i)!=null?E:a.error;return m?e.jsx(K,{message:t._({id:"6m5aox"}),messageExtra:v(m),retry:()=>{s.error&&(s==null||s.refetch().catch(T("LibrarySettings::refetchServerSettings"))),i&&l().catch(T("LibrarySettings::refetchMetadataServerSettings")),a.error&&a.refetch().catch(T("LibrarySettings::refetchCategories"))}}):e.jsxs(j,{sx:{pt:0},children:[e.jsxs(j,{subheader:e.jsx(I,{component:"div",id:"library-category-settings",children:t._({id:"NUrY9o"})}),children:[e.jsx(D,{to:M.settings.childRoutes.categories.path,children:e.jsx(u,{primary:t._({id:"EDmovq"}),secondary:t._({id:"QzLd18",values:{categoryCount:h}})})}),e.jsxs(y,{children:[e.jsx(u,{primary:t._({id:"GKnPQk"}),secondary:t._({id:"9LI3Ed"})}),e.jsx(C,{edge:"end",checked:d.showAddToLibraryCategorySelectDialog,onChange:p=>n("showAddToLibraryCategorySelectDialog",p.target.checked)})]}),e.jsxs(y,{children:[e.jsx(u,{primary:t._({id:"XHdo+g"}),secondary:t._({id:"92wSoc"})}),e.jsx(C,{edge:"end",checked:d.removeMangaFromCategories,onChange:p=>n("removeMangaFromCategories",p.target.checked)})]})]}),e.jsx(j,{subheader:e.jsx(I,{component:"div",id:"library-general-settings",children:t._({id:"Weq9zb"})}),children:e.jsxs(y,{children:[e.jsx(u,{primary:t._({id:"C14a3W"}),secondary:t._({id:"EnhxZq"})}),e.jsx(C,{edge:"end",checked:d.ignoreFilters,onChange:p=>n("ignoreFilters",p.target.checked)})]})}),e.jsx(ae,{serverSettings:s.data.settings,categories:a.data.categories.nodes}),e.jsxs(j,{subheader:e.jsx(I,{component:"div",id:"library-advanced",children:t._({id:"sxkWRg"})}),children:[e.jsx(w,{onClick:()=>ie(),children:e.jsx(u,{primary:t._({id:"XOw+Zq"}),secondary:t._({id:"FPEAIW"})})}),e.jsx(D,{to:M.settings.childRoutes.library.childRoutes.duplicates.path,children:e.jsx(u,{primary:t._({id:"Sf1t6g"}),secondary:t._({id:"7+xuNh"})})})]})]})}export{ve as LibrarySettings};
