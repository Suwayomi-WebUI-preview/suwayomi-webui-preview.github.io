import{c as _,j as e,u as z,r as $,a1 as G,d as W,e as D,Z as n,d9 as q,i as Y,ad as Z,a2 as J,S as E,ac as I,L as Q,dV as X,C as H,I as ee,a3 as ae,a5 as te,B as oe}from"./index-CCIw14dI.js";import{c as re,d as u,C as se,e as ne,f as le,D as de,R as ie,V as ce,g as me,M as he}from"./useManageMangaLibraryState-5xywokxs.js";import{C as pe,D as ue}from"./ChapterCardMetadata-Don0ED8B.js";import{D as ke}from"./Delete-C7sxCtq4.js";import{D as xe}from"./Download-CeGXLsqD.js";import{M as be}from"./MUI.util-CBC1fb2m.js";import{C as ge}from"./Card-cqFx8CyL.js";import{C as Ce}from"./CardActionArea-jN0QJyDw.js";import{C as fe}from"./CardContent-Cgxy_ide.js";import{C as Ie}from"./Checkbox-BwKGBKnK.js";const _e=_(e.jsx("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"})),je=_(e.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"})),Te=_(e.jsx("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"})),ye=_(e.jsx("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"})),De=_(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),we=({chapter:t,handleSelection:l,canBeDownloaded:c=!1,selectedChapters:d=[],onClose:r,selectable:o=!0})=>{var v,P,S;const{t:g}=z(),m=!!t,{isDownloaded:x,isRead:j,isBookmarked:i}=t!=null?t:{},C=(S=(P=$.useGetMangaChapters(G,(v=t==null?void 0:t.mangaId)!=null?v:-1,{skip:!t,fetchPolicy:"cache-only"}).data)==null?void 0:P.chapters.nodes)!=null?S:[],{settings:{deleteChaptersWithBookmark:f}}=W(),h=ne(m,q),k=re(m),a=le(m),{downloadableChapters:s,downloadedChapters:p,unbookmarkedChapters:w,bookmarkedChapters:A,unreadChapters:M,readChapters:R}=D.useMemo(()=>({downloadableChapters:n.getDownloadable(d),downloadedChapters:n.getDownloaded(d),unbookmarkedChapters:n.getNonBookmarked(d),bookmarkedChapters:n.getBookmarked(d),unreadChapters:n.getNonRead(d),readChapters:n.getRead(d)}),[d]),U=()=>{l==null||l(t.id,!0),r()},b=(L,F)=>{var O;const V=L==="mark_prev_as_read",N=V?"mark_as_read":L;if(N==="delete"&&t&&!n.isDeletable(t,f)){r();return}const y=(()=>{if(!t)return F;if(!V)return[t];const B=C.findIndex(({id:K})=>K===t.id);return B+1>C.length-1?[]:C.slice(B+1)})();if(!y.length){r();return}n.performAction(N,n.getIds(y),{chapters:y,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(O=y[0])==null?void 0:O.mangaId}).catch(Y()),r()};return e.jsxs(e.Fragment,{children:[m&&o&&e.jsx(u,{onClick:U,Icon:se,title:g("chapter.action.label.select")}),m&&e.jsx(u,{Icon:De,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),r()},title:g("chapter.action.label.open_on_source")}),k(c)&&e.jsx(u,{Icon:xe,disabled:a(!s.length),onClick:()=>b("download",s),title:h("download",s.length)}),k(x)&&e.jsx(u,{Icon:ke,disabled:a(!p.length),onClick:()=>b("delete",n.getDeletable(p,f)),title:h("delete",p.length)}),k(!i)&&e.jsx(u,{Icon:ye,disabled:a(!w.length),onClick:()=>b("bookmark",w),title:h("bookmark",w.length)}),k(i)&&e.jsx(u,{Icon:Te,disabled:a(!A.length),onClick:()=>b("unbookmark",A),title:h("unbookmark",A.length)}),k(!j)&&e.jsx(u,{Icon:de,disabled:a(!M.length),onClick:()=>b("mark_as_read",M),title:h("mark_as_read",M.length)}),k(j)&&e.jsx(u,{Icon:ie,disabled:a(!R.length),onClick:()=>b("mark_as_unread",R),title:h("mark_as_unread",R.length)}),m&&e.jsx(u,{onClick:()=>b("mark_prev_as_read",[]),Icon:_e,title:g("chapter.action.mark_as_read.add.label.action.previous")})]})},He=D.memo(t=>{const{t:l}=z(),c=Z(),d=D.useRef(null),{mode:r="manga.page",chapter:o,showChapterNumber:g,onSelect:m,selected:x,selectable:j=!0,isActiveChapter:i=!1}=t,T=x!==null,{isDownloaded:C}=o,f=a=>{T&&(a.preventDefault(),a.stopPropagation(),m(o.id,!x,a.shiftKey))},h=(a,s)=>{a.stopPropagation(),a.preventDefault(),s==null||s(a)},k=ce((a,{context:s})=>{if(!T&&d.current){h(a,()=>s==null?void 0:s(d.current));return}a.shiftKey=!0,f(a)});return e.jsx(J,{variant:"popover",popupId:"chapter-card-action-menu",children:a=>{var s;return e.jsxs(E,{sx:{pt:1,px:1},children:[e.jsx(ge,{sx:{touchCallout:"none",...I(r==="reader"&&i,{backgroundColor:"primary.main"})},children:e.jsx(Ce,{component:Q,to:n.getReaderUrl(o),style:{color:c.palette.text[o.isRead?"disabled":"primary"]},state:n.getReaderOpenChapterLocationState(o,!0),replace:r==="reader",onClick:p=>f(p),...k(a.open),children:e.jsxs(fe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5,"&:last-child":{pb:1.5}},children:[e.jsx(pe,{title:g?"".concat(l("chapter.title_one")," ").concat(o.chapterNumber):o.name,secondaryText:o.scanlator,ternaryText:"".concat(X(Number((s=o.uploadDate)!=null?s:0),!0)).concat(C?" â€¢ ".concat(l("chapter.status.label.downloaded")):""),infoIcons:o.isBookmarked&&e.jsx(je,{color:r==="reader"&&i?"secondary":"primary"}),slotProps:{title:{variant:"h6",component:"h3",sx:I(r==="reader"&&i,{color:c.palette.primary.contrastText})},secondaryText:{sx:I(r==="reader"&&i,{color:c.palette.primary.contrastText})},ternaryText:{sx:I(r==="reader"&&i,{color:c.palette.primary.contrastText})}}}),e.jsx(ue,{chapterId:o.id,color:r==="reader"&&i?c.palette.primary.contrastText:void 0}),e.jsx(E,{sx:{minHeight:"48px"},children:x===null?e.jsx(H,{title:l("global.button.options"),children:e.jsx(ee,{ref:d,...be.preventRippleProp(ae(a),{onClick:p=>h(p)}),"aria-label":"more",sx:{color:"inherit",...I(r==="reader"&&i,{color:"primary.contrastText"})},children:e.jsx(me,{})})}):e.jsx(H,{title:l(x?"global.button.deselect":"global.button.select"),children:e.jsx(Ie,{checked:x})})})]})})}),!T&&a.isOpen&&e.jsx(he,{...te(a),children:p=>e.jsx(we,{onClose:p,chapter:o,handleSelection:()=>m(o.id,!0),canBeDownloaded:n.isDownloadable(o),selectable:j})})]})}})}),ze={id:-1,name:"",realUrl:"",isBookmarked:!1},Ue={unread:void 0,downloaded:void 0,bookmarked:void 0,reverse:!0,sortBy:"source",showChapterNumber:!1},Fe={source:"global.sort.label.by_source",chapterNumber:"global.sort.label.by_chapter_number",uploadedAt:"global.sort.label.by_upload_date",fetchedAt:"global.sort.label.by_fetch_date"},Ke=D.forwardRef(({children:t,...l},c)=>e.jsx(oe,{ref:c,...l,sx:{minWidth:"unset",px:"10px",...l.sx},children:t}));export{je as B,Fe as C,Ue as D,ze as F,De as L,_e as a,He as b,we as c,Ke as d};
