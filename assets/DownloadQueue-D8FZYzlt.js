import{c as z,j as e,u as H,r as s,g as V,i as u,l as w,I as h,Q as m,q as b,n as j,o as R,m as B,E as k,B as D,$ as O,C as U,a as $,A as F,L as N,b as W,f as v,d as G,T as _,R as K,U as J,V as X,W as Y}from"./index-Mw6rWbQu.js";import{D as Z,S as ee,P as te,a as re}from"./StrictModeDroppable-4O7kGbCi.js";import{P as oe}from"./PlayArrow-em4P4xOJ.js";const ae=z(e.jsx("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause"),se=z(e.jsx("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3zM14 5h-3l-1-1H6L5 5H2v2h12z"}),"DeleteSweep"),ne=({children:o,...a})=>e.jsx(D,{...a,style:{height:a["data-known-size"]||void 0},children:o}),q=u.memo(({provided:o,item:a,handleDelete:f,handleRetry:c})=>{const{t:x}=H();return e.jsx(D,{...o.draggableProps,...o.dragHandleProps,ref:o.innerRef,sx:{p:1,pb:0},children:e.jsx(U,{children:e.jsx($,{component:N,to:F.manga.path(a.manga.id),children:e.jsxs(W,{sx:{display:"flex",alignItems:"center",p:1.5},children:[e.jsx(h,{...v.preventRippleProp(),sx:{pointerEvents:"none"},children:e.jsx(re,{})}),e.jsxs(G,{sx:{flex:1,ml:1},direction:"column",children:[e.jsx(_,{variant:"h6",component:"h3",children:a.manga.title}),e.jsx(_,{variant:"caption",sx:{display:"block"},children:a.chapter.name})]}),e.jsx(K,{chapterId:a.chapter.id}),a.state===J.Error&&e.jsx(w,{title:x("global.button.retry"),children:e.jsx(h,{...v.preventRippleProp(),onClick:n=>{n.preventDefault(),n.stopPropagation(),c(a.chapter)},children:e.jsx(X,{})})}),e.jsx(w,{title:x("chapter.action.download.delete.label.action"),children:e.jsx(h,{...v.preventRippleProp(),onClick:n=>{n.preventDefault(),n.stopPropagation(),f(a.chapter)},children:e.jsx(Y,{})})})]})})})})}),ce=()=>{var S,E;const{t:o}=H(),[a,{reset:f}]=s.useReorderChapterInDownloadQueue(),{data:c,loading:x,error:n,refetch:T}=s.useGetDownloadStatus({notifyOnNetworkStatusChange:!0}),d=c==null?void 0:c.downloadStatus,i=(S=d==null?void 0:d.queue)!=null?S:[],p=(E=d==null?void 0:d.state)!=null?E:"STARTED",g=!i.length,{setTitle:C,setAction:y}=V(),A=async()=>{try{await s.clearDownloads().response}catch(t){b(o("download.queue.error.label.failed_delete_all"),"error",j(t))}},L=()=>{p===m.Stopped?s.startDownloads():s.stopDownloads()};u.useLayoutEffect(()=>(C(o("download.queue.title")),y(e.jsxs(e.Fragment,{children:[e.jsx(w,{title:o("download.queue.label.delete_all"),children:e.jsx(h,{onClick:A,color:"inherit",children:e.jsx(se,{})})}),e.jsx(w,{title:o(p===m.Started?"global.button.start":"global.button.stop"),disabled:g,children:e.jsx(h,{onClick:L,disabled:g,color:"inherit",children:p===m.Stopped?e.jsx(oe,{}):e.jsx(ae,{})})})]})),()=>{C(""),y(null)}),[o,p,g]),u.useEffect(()=>{const t=r=>{(r.message==="ResizeObserver loop completed with undelivered notifications."||r.message==="ResizeObserver loop limit exceeded")&&r.stopImmediatePropagation()};return window.addEventListener("error",t),()=>window.removeEventListener("error",t)},[]);const M=(t,r,l)=>{r!==l&&a({variables:{input:{chapterId:t[r].chapter.id,to:l}}}).catch(()=>{f()})},Q=t=>{t.destination&&M(i,t.source.index,t.destination.index)},I=u.useCallback(async t=>{try{await s.addChapterToDownloadQueue(t.id).response}catch(r){b(o("download.queue.error.label.failed_to_remove"),"error",j(r))}},[]),P=u.useCallback(async t=>{const r=p===m.Started;try{r&&await s.stopDownloads().response,await Promise.all([s.removeChapterFromDownloadQueue(t.id).response,s.deleteDownloadedChapter(t.id).response])}catch(l){b(o("download.queue.error.label.failed_to_remove"),"error",j(l))}r&&s.startDownloads().response.catch(R())},[]);return x?e.jsx(B,{}):n?e.jsx(k,{message:o("global.error.label.failed_to_load_data"),messageExtra:j(n),retry:()=>T().catch(R())}):g?e.jsx(k,{message:o("download.queue.label.no_downloads")}):e.jsx(Z,{onDragEnd:Q,children:e.jsx(ee,{droppableId:"droppable",mode:"virtual",renderClone:(t,r,l)=>e.jsx(q,{provided:t,item:i[l.source.index],handleDelete:P,handleRetry:I}),children:t=>e.jsx(D,{ref:t.innerRef,children:e.jsx(O,{useWindowScroll:!0,overscan:window.innerHeight*.5,components:{Item:ne},totalCount:i.length,computeItemKey:r=>i[r].chapter.id,itemContent:r=>e.jsx(te,{draggableId:"".concat(i[r].chapter.id),index:r,children:l=>e.jsx(q,{provided:l,item:i[r],handleDelete:P,handleRetry:I})})})})})})};export{ce as DownloadQueue};
