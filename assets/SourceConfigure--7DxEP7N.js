import{j as e,b as g,o as I,p as k,u as V,aJ as D,i as L,k as O,n as B,aZ as G,aV as N,q as M,B as j,av as E,az as A,r as w,a_ as H,e as J,g as b,f as R,H as q,m as U}from"./index-DpwGAhcA.js";import{S as W}from"./Switch-CLBWcFEb.js";import{C as F,F as z}from"./Checkbox-DO-bfoIy.js";import{L as Z}from"./ListPreference-CgWI3oRH.js";import{F as $}from"./FormGroup-B_FmTPMG.js";import{E as K}from"./EmptyViewAbsoluteCentered-PIBApOiE.js";import{u as Q}from"./useAppTitle-DD0N-9ns.js";import"./SwitchBase-C0VR5mkz.js";function y(t){return JSON.parse(JSON.stringify(t))}function X(t){return t==="Switch"?W:F}const Y=t=>t.type==="CheckBoxPreference"?{title:t.CheckBoxTitle,defaultValue:t.CheckBoxDefault,currentValue:t.CheckBoxCheckBoxCurrentValue}:{title:t.SwitchPreferenceTitle,defaultValue:t.SwitchPreferenceDefault,currentValue:t.SwitchPreferenceCurrentValue};function _(t){const{title:a,defaultValue:l,currentValue:n,summary:f,updateValue:h,twoStateType:s}={...t,...Y(t)},[o,i]=g.useState(n!=null?n:l);g.useEffect(()=>{i(n!=null?n:l)},[n]);const c=g.useMemo(()=>X(s),[s]);return e.jsxs(I,{children:[e.jsx(k,{primary:a,secondary:f}),e.jsx(c,{edge:"end",checked:o,onChange:()=>{h(s==="Switch"?"switchState":"checkBoxState",!n),i(!n)}})]})}function v(t){return e.jsx(_,{...t,twoStateType:"Checkbox"})}function ee(t){return e.jsx(_,{...t,twoStateType:"Switch"})}function te(t){const{t:a}=V(),{EditTextPreferenceTitle:l,summary:n,dialogTitle:f,dialogMessage:h,EditTextPreferenceCurrentValue:s,updateValue:o}=t,[i,c]=g.useState(s!=null?s:""),[m,d]=g.useState(!1),u=()=>{d(!1),c(s!=null?s:"")},x=()=>{d(!1),o("editTextState",i)};return e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:()=>d(!0),children:e.jsx(k,{primary:l,secondary:n})}),e.jsxs(L,{open:m,onClose:u,children:[e.jsx(O,{children:f}),e.jsxs(B,{children:[e.jsx(G,{children:h}),e.jsx(N,{autoFocus:!0,margin:"dense",id:"name",type:"text",fullWidth:!0,value:i,onChange:p=>c(p.target.value)})]}),e.jsxs(M,{children:[e.jsx(j,{onClick:u,color:"primary",children:a("global.button.cancel")}),e.jsx(j,{onClick:x,color:"primary",children:a("global.button.ok")})]})]})]})}function ne(t){const{t:a}=V(),{selectedValues:l,open:n,onClose:f,values:h,title:s}=t,[o,i]=E.useState(l);E.useEffect(()=>{n||i(l)},[l,n]);const c=()=>{f(null)},m=()=>{f(o)},d=(u,x)=>{const{checked:p}=u.target,S=o.some(r=>x===r);if(p){if(!S){const r=y(o);r.push(x),i(r)}}else if(S){const r=y(o),C=r.indexOf(x);r.splice(C,1),i(r)}};return e.jsxs(L,{sx:{"& .MuiDialog-paper":{width:"80%",maxHeight:435}},maxWidth:"xs",open:n,onClose:c,children:[e.jsx(O,{children:s}),e.jsx(B,{dividers:!0,children:e.jsx($,{children:h.map(u=>e.jsx(z,{control:e.jsx(F,{checked:o.some(x=>u===x),onChange:x=>d(x,u)}),label:u},u))})}),e.jsxs(M,{children:[e.jsx(j,{autoFocus:!0,onClick:c,children:a("global.button.cancel")}),e.jsx(j,{onClick:m,children:a("global.button.ok")})]})]})}function re(t){const{MultiSelectListPreferenceTitle:a,summary:l,MultiSelectListPreferenceCurrentValue:n,MultiSelectListPreferenceDefault:f,updateValue:h,entryValues:s,entries:o}=t,[i,c]=g.useState(n!=null?n:f),[m,d]=g.useState(!1);g.useEffect(()=>{c(n)},[n]);const u=r=>{var C;return(C=r==null?void 0:r.map(T=>{const P=s.indexOf(T);return o[P]}))!=null?C:[]},x=r=>{var C;return(C=r==null?void 0:r.map(T=>{const P=o.indexOf(T);return s[P]}))!=null?C:[]},p=()=>l,S=r=>{r!==null&&(h("multiSelectState",x(r)),c(r)),d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:()=>d(!0),children:e.jsx(k,{primary:a,secondary:p()})}),e.jsx(ne,{title:a!=null?a:"",open:m,onClose:S,selectedValues:u(i),values:o})]})}function se(t){switch(t){case"CheckBoxPreference":return v;case"SwitchPreference":return ee;case"ListPreference":return Z;case"EditTextPreference":return te;case"MultiSelectListPreference":return re;default:throw new Error('Unexpected preference type "'.concat(t,'"'))}}function xe(){var i;const{t}=V();Q(t("source.configuration.title"));const{sourceId:a}=A(),{data:l,loading:n,error:f,refetch:h}=w.useGetSource(H,a,{notifyOnNetworkStatusChange:!0}),s=(i=l==null?void 0:l.source.preferences)!=null?i:[],o=c=>(m,d)=>{w.setSourcePreferences(a,{position:c,[m]:d}).response.catch(u=>U(t("global.error.label.failed_to_save_changes"),"error",b(u)))};return n?e.jsx(J,{}):f?e.jsx(K,{message:t("global.error.label.failed_to_load_data"),messageExtra:b(f),retry:()=>h().catch(R())}):e.jsx(q,{sx:{padding:0},children:s.map((c,m)=>{const d=y(c);return g.createElement(se(c.type),{...d,updateValue:o(m)})})})}export{xe as SourceConfigure};
