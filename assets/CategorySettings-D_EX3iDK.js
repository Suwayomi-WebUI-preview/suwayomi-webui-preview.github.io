import{u as A,j as e,x,T as K,S as V,C as T,I,r as c,b4 as W,b as i,ap as z,e as J,g as b,f as Q,b5 as X,i as Y,k as Z,n as $,q as ee,B as v,m as k}from"./index-DmaLT3zm.js";import{A as te}from"./Add-Coc3xsL3.js";import{D as oe,a as ae,b as re,c as se,S as ne,v as ie,d as le,e as ce}from"./DragHandle-C8hjU8Bc.js";import{D as de,F as ge}from"./StyledFab-eXdd_Cqi.js";import{E as me}from"./EmptyViewAbsoluteCentered-E7t4qCWU.js";import{E as ue}from"./Edit-zZSIOrrV.js";import{D as xe}from"./Delete-DUmnrtJ2.js";import{L as pe}from"./ListCardContent-Bo5BMzHI.js";import{C as he}from"./Card-CkMFwu0i.js";import{u as fe}from"./useAppTitle-ueV_qAGT.js";import{T as Ce}from"./TextField-CvYDf2E6.js";import{F as je,C as ye}from"./Checkbox-CqY0vCak.js";import"./useFormControl-DXRCHqlg.js";import"./formControlState-Dq1zat_P.js";import"./SwitchBase-DCqZiClE.js";const F=({category:a,onEdit:n})=>{const{t:d}=A(),g=()=>{c.deleteCategory(a.id)};return e.jsx(x,{sx:{p:1,pb:0},children:e.jsx(he,{children:e.jsxs(pe,{sx:{gap:2},children:[e.jsx(oe,{}),e.jsx(K,{sx:{flexGrow:1},variant:"h6",component:"h2",children:a.name}),e.jsxs(V,{sx:{flexDirection:"row"},children:[e.jsx(T,{title:d("global.button.edit"),children:e.jsx(I,{component:x,onClick:n,children:e.jsx(ue,{})})}),e.jsx(T,{title:d("chapter.action.download.delete.label.action"),children:e.jsx(I,{component:x,onClick:g,children:e.jsx(xe,{})})})]})]})})})};function Ge(){const{t:a}=A();fe(a("category.dialog.title.edit_category_other"));const{data:n,loading:d,error:g,refetch:L}=c.useGetCategories(W,{notifyOnNetworkStatusChange:!0}),r=i.useMemo(()=>{var o;const t=[...(o=n==null?void 0:n.categories.nodes)!=null?o:[]];return t.length>0&&t[0].name==="Default"&&t.shift(),t},[n]),[p,S]=i.useState(-1),[O,m]=i.useState(!1),[h,f]=i.useState(""),[C,j]=i.useState(!1),[w,{reset:B}]=c.useReorderCategory(),E=z(),G=ae.useSensorsForDevice(),[l,u]=i.useState(null),R=(t,o,s)=>{const y=t[o];w({variables:{input:{id:y.id,position:s+1}}}).catch(()=>B())},H=t=>{const{active:o,over:s}=t;if(u(null),!s||o.id===s.id)return;const y=r.findIndex(D=>D.id===o.id),P=r.findIndex(D=>D.id===s.id);R(r,y,P)},N=()=>{f(""),j(!1),S(-1)},q=()=>{N(),m(!0)},M=t=>{f(r[t].name),j(r[t].default),S(t),m(!0)},_=()=>{m(!1)},U=()=>{if(m(!1),p===-1)c.createCategory({name:h,default:C}).response.catch(t=>k(a("category.error.label.create_failure"),"error",b(t)));else{const t=r[p];c.updateCategory(t.id,{name:h,default:C}).response.catch(o=>k(a("global.error.label.failed_to_save_changes"),"error",b(o)))}};return d?e.jsx(J,{}):g?e.jsx(me,{message:a("category.error.label.request_failure"),messageExtra:b(g),retry:()=>L().catch(Q())}):e.jsxs(e.Fragment,{children:[e.jsx(re,{sensors:G,collisionDetection:se,onDragStart:t=>{var o;return u((o=r.find(s=>s.id===t.active.id))!=null?o:null)},onDragEnd:H,onDragCancel:()=>u(null),onDragAbort:()=>u(null),children:e.jsxs(x,{sx:{paddingBottom:de},children:[e.jsx(ne,{items:r,strategy:ie,children:r.map((t,o)=>e.jsx(le,{id:t.id,isDragging:t.id===(l==null?void 0:l.id),children:e.jsx(F,{category:t,onEdit:()=>M(o)})},t.id))}),e.jsx(ce,{isActive:!!l,children:e.jsx(F,{category:l,onEdit:X})})]})}),e.jsx(ge,{color:"primary","aria-label":"add",style:{position:"fixed",bottom:E.spacing(2),right:E.spacing(2)},onClick:q,children:e.jsx(te,{})}),e.jsxs(Y,{open:O,onClose:_,children:[e.jsx(Z,{id:"form-dialog-title",children:a(p===-1?"category.dialog.title.new_category":"category.dialog.title.edit_category_one")}),e.jsxs($,{children:[e.jsx(Ce,{autoFocus:!0,margin:"dense",id:"name",label:a("category.label.category_name"),type:"text",fullWidth:!0,value:h,onChange:t=>f(t.target.value)}),e.jsx(je,{control:e.jsx(ye,{checked:C,onChange:t=>j(t.target.checked)}),label:a("category.label.use_as_default_category")})]}),e.jsxs(ee,{children:[e.jsx(v,{onClick:_,color:"primary",children:a("global.button.cancel")}),e.jsx(v,{onClick:U,color:"primary",children:a("global.button.submit")})]})]})]})}export{Ge as CategorySettings};
