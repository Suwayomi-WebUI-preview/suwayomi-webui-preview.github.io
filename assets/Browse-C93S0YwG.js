import{r as Ae,i as Ie,j as e,s as xe,u as _,L as v,B as y,a as T,T as L,b as P,c as o,N as V,d as G,e as ve,f as ce,g as he,I as me,h as X,E as M,k as C,l as z,m as ye,n as Ce,o as _e,p as Oe,q as we,S as Ue,D as N,t as De,v as Pe}from"./index-C2-i4E1A.js";import{t as F,L as fe,i as ke,E as f}from"./LangSelect-3OqJVqMO.js";import{SourceContentType as B}from"./SourceMangas-gBrTBrnm.js";import{S as K}from"./SpinnerImage-CRgnIS3y.js";import{C as Q,a as ge}from"./index-BAVu-2rT.js";import{C as Y}from"./CardContent-DBmRyVsg.js";import{A as J}from"./Avatar-B2MfcJWg.js";import{f as Re}from"./file-selector-FUraMMYp.js";import{d as Be}from"./Add-CO2DbG94.js";import{u as Ge,S as Me,A as Fe}from"./AppbarSearch-BUbDBf8p.js";import{S as $e,a as qe,b as Le}from"./StyledGroupItemWrapper-C1IKmPwv.js";import{T as H,a as W}from"./Tabs-JlRg3NCv.js";import{T as He,a as We}from"./TabsMenu-DWdzGe4O.js";import{C as Ve}from"./Chip-C2wUHca2.js";import"./FilterList-BT8Yj16z.js";import"./cloneObject-DrOPTG0J.js";import"./Switch-DsXMuWOo.js";import"./SwitchBase-CoFzMnLY.js";import"./TextField-70nHlBBv.js";import"./Favorite-D8VnssvK.js";import"./GridLayouts-COJLdvzU.js";import"./ViewModule-CjXFAtm6.js";import"./Checkbox-D29zeevZ.js";import"./ListPreference-BY8wTT0Z.js";import"./SortRadioInput-x7z1MGuH.js";import"./CheckboxInput-B2cAClJ9.js";import"./Collapse-dwtmLOnt.js";import"./useDebounce-wLjxumm3.js";import"./InputAdornment-DukL3TX2.js";import"./ThreeStateCheckboxInput-3sE7Na7e.js";import"./StyledFab-D2ZGwNvP.js";import"./MangaGrid-DmMqdpHU.js";import"./useManageMangaLibraryState-qvAxcxEU.js";import"./Info-CIHHO5Zo.js";import"./Link-DY47EI9O.js";import"./NumberSetting-CtN6oQPs.js";import"./useMobilePicker-BFbyFixp.js";import"./SelectSetting-pBuy0-0n.js";import"./Select-_IpmtYgR.js";import"./Mangas-Cfm-aE86.js";import"./Chapters-DsfBUGr-.js";import"./Delete-BYa4rhkz.js";import"./Sync-Dy4GShiX.js";import"./PlayArrow-CxjbUwuC.js";var Z={},Xe=Ie;Object.defineProperty(Z,"__esModule",{value:!0});var Te=Z.default=void 0,ze=Xe(Ae()),Ke=e;Te=Z.default=(0,ze.default)((0,Ke.jsx)("path",{d:"M19.3 16.9c.4-.7.7-1.5.7-2.4 0-2.5-2-4.5-4.5-4.5S11 12 11 14.5s2 4.5 4.5 4.5c.9 0 1.7-.3 2.4-.7l3.2 3.2 1.4-1.4zm-3.8.1c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5M12 20v2C6.48 22 2 17.52 2 12S6.48 2 12 2c4.84 0 8.87 3.44 9.8 8h-2.07c-.64-2.46-2.4-4.47-4.73-5.41V5c0 1.1-.9 2-2 2h-2v2c0 .55-.45 1-1 1H8v2h2v3H9l-4.79-4.79C4.08 10.79 4 11.38 4 12c0 4.41 3.59 8 8 8"}),"TravelExplore");const Qe=xe("div")(({theme:t})=>({display:"flex",[t.breakpoints.up("sm")]:{display:"none"}})),Ye=xe("div")(({theme:t})=>({display:"flex",[t.breakpoints.down("sm")]:{display:"none"},"& .MuiButton-root":{marginLeft:"20px"}})),Je=t=>{const{t:s}=_(),{source:{id:n,name:l,lang:c,iconUrl:r,supportsLatest:p,isNsfw:h,extension:{repo:E}},showSourceRepo:i}=t;return e.jsx(Q,{sx:{margin:"10px",marginTop:0},children:e.jsx(ge,{component:v,to:"/sources/".concat(n),state:{contentType:B.POPULAR,clearCache:!0},children:e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:2},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(J,{variant:"rounded",alt:l,sx:{width:56,height:56,flex:"0 0 auto",mr:2,background:"transparent"},children:e.jsx(K,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%"},alt:l,src:T.getValidImgUrlFor(r)})}),e.jsxs(y,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(L,{variant:"h5",component:"h2",children:l}),n!=="0"&&e.jsxs(L,{variant:"caption",display:"block",gutterBottom:!0,children:[F(c),h&&e.jsx(L,{variant:"caption",display:"inline",gutterBottom:!0,color:"red",children:" 18+"}),i&&e.jsx(L,{variant:"caption",display:"block",children:E})]})]})]}),e.jsxs(e.Fragment,{children:[e.jsx(Qe,{children:p&&e.jsx(P,{variant:"outlined",component:v,to:"/sources/".concat(n),state:{contentType:B.LATEST,clearCache:!0},children:s("global.button.latest")})}),e.jsxs(Ye,{children:[p&&e.jsx(P,{variant:"outlined",component:v,to:"/sources/".concat(n),state:{contentType:B.LATEST,clearCache:!0},children:s("global.button.latest")}),e.jsx(P,{variant:"outlined",component:v,to:"/sources/".concat(n),state:{contentType:B.POPULAR,clearCache:!0},children:s("global.button.popular")})]})]})]})})})};function Ze(t){const s=[];return t.forEach(n=>{s.indexOf(n.lang)===-1&&s.push(n.lang)}),s.sort(z),s}function et(t){const s={};return t.forEach(n=>{s[n.lang]===void 0&&(s[n.lang]=[]),s[n.lang].push(n)}),s}function tt(){const{t}=_(),{setAction:s}=o.useContext(V),[n,l]=G("shownSourceLangs",ye()),[c]=G("showNsfw",!0),{data:r,loading:p,error:h,refetch:E}=T.useGetSourceList({notifyOnNetworkStatusChange:!0}),i=r==null?void 0:r.sources.nodes,j=o.useMemo(()=>{if(!i||i!=null&&i.length)return!1;const{repo:x}=i[0].extension;return i.some(m=>m.extension.repo!==x)},[i]),b=ve();return o.useEffect(()=>{ce().forEach(x=>{let m=!1;n.forEach(u=>{u===x&&(m=!0)}),m||l(u=>(u.push(x),u))})},[]),o.useEffect(()=>(s(e.jsxs(e.Fragment,{children:[e.jsx(he,{title:t("search.title.global_search"),children:e.jsx(me,{onClick:()=>b("/sources/all/search/"),size:"large",children:e.jsx(Te,{})})}),e.jsx(fe,{shownLangs:n,setShownLangs:l,allLangs:Ze(i!=null?i:[]),forcedLangs:ce()})]})),()=>{s(null)}),[t,n,i]),p?e.jsx(X,{}):h?e.jsx(M,{message:t("global.error.label.failed_to_load_data"),messageExtra:h.message,retry:()=>E().catch(C())}):(i==null?void 0:i.length)===0?e.jsx(M,{message:t("source.error.label.no_sources_found")}):e.jsx(e.Fragment,{children:Object.entries(et(i!=null?i:[])).sort((x,m)=>z(x[0],m[0])).map(([x,m])=>n.indexOf(x)!==-1&&e.jsxs(o.Fragment,{children:[e.jsx(L,{variant:"h4",style:{paddingLeft:"24px",paddingTop:"6px",paddingBottom:"16px",fontWeight:"bold"},children:F(x)},x),m.filter(u=>c||!u.isNsfw).map(u=>e.jsx(Je,{source:u,showSourceRepo:j},u.id))]},x))})}var Ee=(t=>(t.UPDATE="UPDATE",t.UNINSTALL="UNINSTALL",t.INSTALL="INSTALL",t))(Ee||{}),Se=(t=>(t.OBSOLETE="OBSOLETE",t.UPDATING="UPDATING",t.UNINSTALLING="UNINSTALLING",t.INSTALLING="INSTALLING",t))(Se||{});const g={...Ee,...Se},nt={UPDATE:"UPDATING",UNINSTALL:"UNINSTALLING",INSTALL:"INSTALLING"},st={UPDATE:"UNINSTALL",UNINSTALL:"INSTALL",INSTALL:"UNINSTALL"},rt={[g.UNINSTALL]:"extension.action.label.uninstall",[g.INSTALL]:"extension.action.label.install",[g.UPDATE]:"extension.action.label.update",[g.OBSOLETE]:"extension.state.label.obsolete",[g.UPDATING]:"extension.state.label.updating",[g.UNINSTALLING]:"extension.state.label.uninstalling",[g.INSTALLING]:"extension.state.label.installing"},at={UPDATE:"extension.label.update_failed",INSTALL:"extension.label.installation_failed",UNINSTALL:"extension.label.uninstallation_failed"},ue=(t,s,n)=>s?g.OBSOLETE:n?g.UPDATE:t?g.UNINSTALL:g.INSTALL;function ot(t){const{t:s}=_(),{extension:{name:n,lang:l,versionName:c,isInstalled:r,hasUpdate:p,isObsolete:h,pkgName:E,iconUrl:i,isNsfw:j,repo:b},handleUpdate:x,showSourceRepo:m}=t,[u,O]=o.useState(ue(r,h,p)),$=l==="all"?s("extension.language.all"):l.toUpperCase(),w=async A=>{const k=st[A],S=nt[A];try{switch(O(S),A){case"INSTALL":await T.updateExtension(E,{install:!0,isObsolete:h}).response;break;case"UNINSTALL":await T.updateExtension(E,{uninstall:!0,isObsolete:h}).response;break;case"UPDATE":await T.updateExtension(E,{update:!0,isObsolete:h}).response;break;default:throw new Error('Unexpected ExtensionAction "'.concat(A,'"'))}O(k),x()}catch(q){O(ue(r,h,p)),Ce(s(at[A]),"error")}};function U(){switch(u){case"INSTALL":case"UPDATE":case"UNINSTALL":w(u).catch(C());break;case"OBSOLETE":w("UNINSTALL").catch(C());break}}return e.jsx(Q,{children:e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,"&:last-child":{paddingBottom:2}},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(J,{variant:"rounded",sx:{width:56,height:56,flex:"0 0 auto",mr:2,background:"transparent"},alt:n,children:e.jsx(K,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%"},alt:n,src:T.getValidImgUrlFor(i)})}),e.jsxs(y,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(L,{variant:"h5",component:"h2",children:n}),e.jsxs(L,{variant:"caption",display:"block",children:[$," ",c,j&&e.jsx(L,{variant:"caption",display:"inline",color:"red",children:" 18+"})]}),m&&e.jsx(L,{variant:"caption",display:"block",children:b})]})]}),e.jsx(P,{variant:"outlined",sx:{color:u===g.OBSOLETE?"red":"inherit"},onClick:()=>U(),children:s(rt[u])})]})})}const de=0,pe=1;function it(t){const s=[],n={[f.OBSOLETE]:[],[f.INSTALLED]:[],[f.UPDATE_PENDING]:[],[N.ALL]:[],[N.OTHER]:[],[N.LOCAL_SOURCE]:[]};t.forEach(r=>{if(n[r.lang]===void 0&&(n[r.lang]=[],r.lang!=="all"&&s.push(r.lang)),r.isInstalled){if(r.hasUpdate){n[f.UPDATE_PENDING].push(r);return}if(r.isObsolete){n[f.OBSOLETE].push(r);return}n[f.INSTALLED].push(r)}else n[r.lang].push(r)}),s.sort(z);const l=[[f.OBSOLETE,n[f.OBSOLETE]],[f.UPDATE_PENDING,n[f.UPDATE_PENDING]],[f.INSTALLED,n[f.INSTALLED]],[N.ALL,n[N.ALL]],[N.OTHER,n[N.OTHER]],[N.LOCAL_SOURCE,n[N.LOCAL_SOURCE]]],c=s.map(r=>[r,n[r]]);return{allLangs:s,groupedExtensions:l.concat(c)}}function lt(){var le;const{t}=_(),{setAction:s}=o.useContext(V),n=_e(),l=Oe(n.breakpoints.down("sm")),{data:c,loading:r,error:p,refetch:h}=T.useGetServerSettings({notifyOnNetworkStatusChange:!0}),E=!!(c!=null&&c.settings.extensionRepos.length),i=((le=c==null?void 0:c.settings.extensionRepos.length)!=null?le:0)>1,j=o.useRef(null),[b,x]=G("shownExtensionLangs",De()),[m]=G("showNsfw",!0),[u]=Ge("query",Me),[O,$]=o.useState({}),[w,{data:U,loading:A,error:k}]=T.useExtensionListFetch(),S=U==null?void 0:U.fetchExtensions.extensions,q=o.useCallback(()=>$({}),[]);o.useEffect(()=>{w()},[O]);const ee=o.useMemo(()=>(S!=null?S:[]).filter(a=>{const d=m||!a.isNsfw;return u?d&&a.name.toLowerCase().includes(u.toLowerCase()):d}),[S,m,u]),{allLangs:te,groupedExtensions:ne}=o.useMemo(()=>it(ee),[ee]),D=o.useMemo(()=>ne.filter(a=>a[pe].length>0).filter(a=>ke(a[de])||b.includes(a[de])),[b,ne]),Ne=o.useMemo(()=>D.map(a=>a[pe].length),[D]),se=o.useMemo(()=>D.map(([,a])=>a).flat(1),[D]),[re,R]=we(o.useState([])),ae=a=>{a.name.toLowerCase().endsWith("apk")?(j.current&&(j.current.value=""),R(t("extension.label.installing_file"),"info"),T.installExternalExtension(a).response.then(()=>{q(),R(t("extension.label.installed_successfully"),"success")}).catch(()=>R(t("extension.label.installation_failed"),"error"))):R(t("global.error.label.invalid_file_type"),"error")};o.useEffect(()=>(s(e.jsxs(e.Fragment,{children:[e.jsx(Fe,{}),e.jsx(he,{title:t("extension.action.label.install_external"),children:e.jsx(me,{onClick:()=>{var a;return(a=j.current)==null?void 0:a.click()},size:"large",children:e.jsx(Be,{})})}),e.jsx(fe,{shownLangs:b,setShownLangs:x,allLangs:te})]})),()=>{s(null)}),[t,b,te]),o.useEffect(()=>{const a=async I=>{I.preventDefault();const be=await Re(I);ae(be[0])},d=I=>{I.preventDefault()};return document.addEventListener("drop",a),document.addEventListener("dragover",d),()=>{document.removeEventListener("drop",a),document.removeEventListener("dragover",d)}},[]);const oe=o.useMemo(()=>e.jsx("input",{type:"file",style:{display:"none"},ref:j,onChange:a=>{var I;const d=(I=a.target.files)==null?void 0:I[0];d&&ae(d)}}),[]),je=r||A,ie=p!=null?p:k;return je?e.jsx(X,{}):ie?e.jsx(M,{message:t("global.error.label.failed_to_load_data"),messageExtra:ie.message,retry:()=>{p&&h().catch(C()),k&&w().catch(C())}}):!(S!=null&&S.length)&&!E?e.jsxs(e.Fragment,{children:[re,oe,e.jsxs(Ue,{sx:{paddingTop:"20px"},alignItems:"center",justifyContent:"center",rowGap:"10px",children:[e.jsx(L,{children:t("extension.label.add_repository_info")}),e.jsx(P,{component:v,variant:"contained",to:"/settings/browseSettings",children:t("settings.title")})]})]}):e.jsxs(e.Fragment,{children:[re,oe,e.jsx($e,{style:{height:"undefined"},heightToSubtract:l?48:53,overscan:window.innerHeight*.5,groupCounts:Ne,groupContent:a=>{const[d]=D[a];return e.jsx(qe,{variant:"h4",style:{paddingLeft:"24px",paddingTop:"6px",paddingBottom:"16px",fontWeight:"bold"},isFirstItem:a===0,children:F(d)},d)},itemContent:a=>{const d=se[a];return e.jsx(Le,{isLastItem:a===se.length-1,children:e.jsx(ot,{extension:d,handleUpdate:q,showSourceRepo:i})},"".concat(d.pkgName,"_").concat(d.isInstalled,"_").concat(d.isObsolete,"_").concat(d.hasUpdate))}})]})}const ct=({id:t,name:s,lang:n,iconUrl:l,mangaCount:c})=>e.jsx(Q,{children:e.jsx(ge,{component:v,to:"/migrate/source/".concat(t,"/"),children:e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[e.jsxs(y,{sx:{display:"flex"},children:[e.jsx(J,{variant:"rounded",sx:{width:56,height:56,flex:"0 0 auto",mr:2,background:"transparent"},children:e.jsx(K,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%"},alt:s,src:T.getValidImgUrlFor(l)})}),e.jsxs(y,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(L,{variant:"h5",component:"h2",children:s}),e.jsx(L,{variant:"caption",display:"block",children:F(n)})]})]}),e.jsx(Ve,{sx:{borderRadius:"5px"},size:"small",label:c})]})})}),ut=t=>{if(!t)return{};const s={};return t.forEach(({sourceId:n,source:l})=>{var r;const c=(r=s[n])!=null?r:{id:n,name:n,lang:"unknown",iconUrl:null,mangaCount:0,...l};s[n]={...c,mangaCount:c.mangaCount+1}}),s},dt=()=>{const{t}=_(),{data:s,loading:n,error:l,refetch:c}=T.useGetMigratableSources({notifyOnNetworkStatusChange:!0}),r=o.useMemo(()=>ut(s==null?void 0:s.mangas.nodes),[s==null?void 0:s.mangas.nodes]);return n?e.jsx(X,{}):l?e.jsx(M,{message:t("global.error.label.failed_to_load_data"),messageExtra:l.message,retry:()=>c().catch(C())}):e.jsx(Pe,{children:Object.values(r).map((p,h)=>e.jsx(Le,{isLastItem:h===Object.values(r).length-1,children:e.jsx(ct,{...p})},p.id))})};function sn(){const{t}=_(),{setTitle:s}=o.useContext(V),[n,l]=o.useState(0);return o.useEffect(()=>{s(t("global.label.browse"))},[t]),e.jsxs(He,{children:[e.jsxs(We,{value:n,tabsCount:2,onChange:(c,r)=>l(r),children:[e.jsx(H,{sx:{textTransform:"none"},label:t("source.title")}),e.jsx(H,{sx:{textTransform:"none"},label:t("extension.title")}),e.jsx(H,{sx:{textTransform:"none"},label:t("migrate.title")})]}),e.jsx(W,{index:0,currentIndex:n,children:e.jsx(tt,{})}),e.jsx(W,{index:1,currentIndex:n,children:e.jsx(lt,{})}),e.jsx(W,{index:2,currentIndex:n,children:e.jsx(dt,{})})]})}export{sn as Browse};
