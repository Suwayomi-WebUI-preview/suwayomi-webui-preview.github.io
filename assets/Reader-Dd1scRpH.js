import{cM as Es,b as d,cN as ft,cO as We,cH as L,j as s,i as Ht,am as m,n as Vt,cP as Js,cQ as F,cR as rt,x as ze,cS as Ot,cT as Oe,cU as Ne,cV as Qs,cW as ct,cX as Wt,S as B,w as Y,T as et,aP as er,cY as tr,aR as sr,ci as yt,a0 as Xe,a9 as zt,cZ as Se,C as $,c_ as Ts,c$ as le,H as Ye,d0 as V,bO as ce,d1 as je,d2 as rr,a as nr,cw as or,d3 as ar,d4 as ir,d5 as cr,cx as lr,ad as nt,d6 as Qt,aS as tt,d7 as es,d8 as js,bS as gt,A as Xt,L as At,c as Re,u as U,b$ as Cs,d9 as ws,ar as bt,a2 as Et,a3 as Tt,c1 as dr,ai as ur,B as st,da as gr,db as ts,dc as Os,dd as Ft,de as As,df as fr,dg as hr,dh as ss,di as Ls,dj as ht,dk as ke,dl as it,dm as Me,s as Ds,I as ae,a1 as $e,c9 as Ut,dn as He,dp as Is,c0 as xr,ay as pr,b9 as mr,e as Lt,aI as vr,dq as Yt,a6 as Sr,a7 as Rr,m as Bs,dr as ut,ds as Dt,ac as rs,dt as It,du as br,dv as kt,dw as Er,dx as jt,dy as Tr,dz as Ps,be as jr,dA as Ce,a_ as ye,dB as Cr,dC as we,dD as Ve,dE as wr,dF as _s,dG as Or,dH as Ar,r as Gt,dI as pt,dJ as Lr,dK as Dr,f as St,dL as Ir,dM as Br,g as ys,dN as ks,dO as Ns,dP as Pr,dQ as _r,au as Ms,dR as ns,M as os,dS as yr,dT as kr,dU as dt,dV as J,dW as mt,dX as as,bc as Nr,dY as Rt,dZ as Mr,d_ as Hr,d$ as is,e0 as Vr,e1 as Wr,d as Fr,e2 as Ur,e3 as Gr,at as $r,e4 as zr,e5 as Xr,e6 as Yr}from"./index-CPeTXJh6.js";import{R as Kr,S as Zr,D as qr,a as Jr,b as Qr,c as en}from"./ReaderSettingsTabs-CwoVtQXh.js";import{P as tn}from"./PushPin-Cuv8urOc.js";import{P as sn}from"./PushPinOutlined-Dh8ZUPxQ.js";import{L as $t}from"./Link-XitKuNji.js";import{S as Hs}from"./Select-B38dRF2T.js";import{b as Vs,C as rn,B as nn}from"./CustomButtonIcon-gzAp_43T.js";import{a as Ws,I as Fs,T as on}from"./TextField-DmqrC1lA.js";import{K as an}from"./index-IrUdv4oQ.js";import{I as cn}from"./InputAdornment-nw8HS46B.js";import{O as ln}from"./OpenInNew-LI7KoNjp.js";import{D as dn}from"./Download-Y8IzSAF5.js";import{D as un}from"./Delete-B4SM8zov.js";import{D as gn}from"./ChapterCardMetadata-cm_yxW1t.js";import{F as fn}from"./Favorite-DpVFMkbu.js";import{c as hn,F as xn,k as pn,m as mn,a as vn}from"./useManageMangaLibraryState-D0UvVvzw.js";import{C as Sn}from"./CheckboxInput-CpntG24i.js";import{E as Ct}from"./EmptyViewAbsoluteCentered-C0zy76AZ.js";import{u as Rn}from"./use-window-event-CEi5MjU8.js";import{u as bn}from"./use-merged-ref-CCn0Q7hV.js";import{u as En}from"./useAppTitle-BS2T-YKX.js";import"./TabsMenu-TFE6ki9m.js";import"./Tabs-DN6ZKtbU.js";import"./Trans-BwPgTAo0.js";import"./Slider-CTmIFjNp.js";import"./ListSubheader-Dh6ur9E5.js";import"./Add-B_sDb_qa.js";import"./DoneAll-Bh0AbMql.js";import"./MUI.util-CYBuX_Wz.js";import"./ListCardContent-0izJWE9h.js";import"./Card-BSHy-jG9.js";import"./CardActionArea-2P6bstp_.js";import"./Checkbox-DatnGaTI.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-CPzMRNSp.js";import"./SwitchBase-Z17wUCaO.js";import"./ThreeStateCheckboxInput-NS60IqwU.js";import"./FormGroup-DdQpvpYM.js";const Tn=e=>{const{activeScopes:r,enableScope:n,disableScope:o}=Es(),t=d.useRef([]);d.useEffect(()=>e?(t.current=[...r],n(ft.NONE),t.current.forEach(o),()=>{o(ft.NONE),t.current.forEach(n)}):()=>{},[e])},jn=({isOpen:e,close:r})=>{const{manga:n}=We(),o=L.useSettings();Tn(e);const[t,a]=d.useState(0),[l,c]=d.useState(!1);return!n||!e?null:s.jsx(Ht,{open:e,maxWidth:"md",fullWidth:!0,onClose:r,hideBackdrop:t===Js.FILTER,sx:{...m(l,{opacity:.75})},children:s.jsx(Vt,{sx:{p:0},children:s.jsx(Kr,{activeTab:t,setActiveTab:a,settings:o,updateSetting:(...i)=>L.updateSetting(n,...i),deleteSetting:(...i)=>L.deleteSetting(n,...i),setTransparent:c})})})},Cn=({isDesktop:e,scrollbarXSize:r,readerNavBarWidth:n,isMaximized:o,currentPageIndex:t,pages:a,totalPages:l,progressBarType:c,shouldShowPageNumber:i,readingDirection:h})=>{const u=d.useMemo(()=>{const f=Ne(t,a).name,g="/",p="".concat(f).concat(g).concat(l);return h===ct.LTR?p:Qs(p,g)},[t,a,l,h]);return!i||o||e&&c===Wt.STANDARD||o&&c===Wt.HIDDEN?null:s.jsx(B,{sx:{position:"fixed",left:n,right:0,bottom:f=>"max(calc(".concat(f.spacing(1)," + ").concat(r,"px), env(safe-area-inset-bottom))"),alignItems:"center",transition:f=>"left 0.".concat(f.transitions.duration.shortest,"s")},children:s.jsx(Y,{sx:{p:.5,borderRadius:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:s.jsx(et,{sx:{color:"white"},children:u})})})},wn=F(Cn,[L.useOverlayMode,rt,ze,Ot,Oe,L.useSettingsWithoutDefaultFlag],["isDesktop","scrollbarXSize","readerNavBarWidth","isMaximized","currentPageIndex","pages","totalPages","progressBarType","shouldShowPageNumber","readingDirection"]);function cs(e){return e.substring(2).toLowerCase()}function On(e,r){return r.documentElement.clientWidth<e.clientX||r.documentElement.clientHeight<e.clientY}function An(e){const{children:r,disableReactTree:n=!1,mouseEvent:o="onClick",onClickAway:t,touchEvent:a="onTouchEnd"}=e,l=d.useRef(!1),c=d.useRef(null),i=d.useRef(!1),h=d.useRef(!1);d.useEffect(()=>(setTimeout(()=>{i.current=!0},0),()=>{i.current=!1}),[]);const u=er(tr(r),c),f=sr(x=>{const S=h.current;h.current=!1;const v=yt(c.current);if(!i.current||!c.current||"clientX"in x&&On(x,v))return;if(l.current){l.current=!1;return}let C;x.composedPath?C=x.composedPath().includes(c.current):C=!v.documentElement.contains(x.target)||c.current.contains(x.target),!C&&(n||!S)&&t(x)}),g=x=>S=>{h.current=!0;const v=r.props[x];v&&v(S)},p={ref:u};return a!==!1&&(p[a]=g(a)),d.useEffect(()=>{if(a!==!1){const x=cs(a),S=yt(c.current),v=()=>{l.current=!0};return S.addEventListener(x,f),S.addEventListener("touchmove",v),()=>{S.removeEventListener(x,f),S.removeEventListener("touchmove",v)}}},[f,a]),o!==!1&&(p[o]=g(o)),d.useEffect(()=>{if(o!==!1){const x=cs(o),S=yt(c.current);return S.addEventListener(x,f),()=>{S.removeEventListener(x,f)}}},[f,o]),d.cloneElement(r,p)}const ls=Xe(et)({boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",textAlign:"center",userSelect:"none",cursor:"pointer"}),Ln=Xe(B,{shouldForwardProp:zt(["progressBarPosition"])})(({theme:e,progressBarPosition:r})=>({position:"fixed",pointerEvents:"all",touchAction:"none",...m(Se(r).isHorizontal,{justifyContent:"flex-end",bottom:0,right:0}),...m(Se(r).isVertical,{top:0,bottom:0}),...m(Se(r).isLeft,{alignItems:e.direction==="ltr"?"flex-start":"flex-end"}),...m(Se(r).isRight,{alignItems:e.direction==="ltr"?"flex-end":"flex-start"})})),Dn=Xe(B)(({theme:e})=>({flexDirection:"row",justifyContent:"center",alignItems:"center",gap:e.spacing(.5)})),In=Xe(B)({flexDirection:"row",flexGrow:1,overflow:"hidden"}),Bn=Xe(Y,{shouldForwardProp:zt(["currentPagesIndex","pagesLength","progressBarPosition"])})(({currentPagesIndex:e,pagesLength:r,progressBarPosition:n})=>({position:"absolute",pointerEvents:"none",...m(Se(n).isHorizontal,{left:0,width:"".concat((e+1)/r*100,"%"),height:"100%"}),...m(Se(n).isVertical,{top:0,width:"100%",height:"".concat((e+1)/r*100,"%")})})),Pn=({pageName:e,currentPagesIndex:r,pagesLength:n,isDragging:o,boxProps:t,children:a,progressBarPosition:l})=>s.jsx($,{title:e,slotProps:{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}},placement:Ts[l],children:s.jsx(Y,{...t,sx:{position:"absolute",cursor:o?"grabbing":"grab",...m(Se(l).isHorizontal,{left:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"calc(100% / ".concat(n-1,")"),height:"100%"}),...m(Se(l).isVertical,{top:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"100%",height:"calc(100% / ".concat(n-1,")")}),...t==null?void 0:t.sx},children:a})}),_n=Xe(B)({position:"relative",flexDirection:"row",flexGrow:1}),yn=d.memo(Xe(Y,{shouldForwardProp:zt(["isFirstPage","isLastPage"])})(({isFirstPage:e,isLastPage:r})=>({flexGrow:1,height:"100%",cursor:"pointer",borderLeftWidth:e?0:void 0,borderRightWidth:r?0:void 0}))),kn=d.memo(({page:e,pagesIndex:r,isCurrentPage:n,isLeadingPage:o,isTrailingPage:t,totalPages:a,showDraggingStyle:l,primaryPageLoadState:c,secondaryPageLoadState:i,createProgressBarSlot:h,...u})=>{const f=d.useMemo(()=>h(e,r,c,i,n,o,t,a,l),[h,e,r,c,i,n,o,t,a,l]);return s.jsx(yn,{...u,isFirstPage:r===0,isLastPage:r===a-1,children:f})}),Nn=({totalPages:e,pages:r,pageLoadStates:n,currentPageIndex:o,slotProps:t,slots:a,createProgressBarSlot:l,progressBarPosition:c,readingMode:i,isDragging:h,setIsDragging:u,openPage:f,direction:g,fullSegmentClicks:p})=>{var A,I,P,H,q,K,k,N,W,M,he,xe,z,G,be,X,de,pe,ue,me,ve,ge,te,ee,Ae,fe,Fe,Le,Ue,De,Ke,Ee;const x=d.useRef(null),S=d.useRef(void 0),[v,C]=d.useState(0),R=d.useRef(null);Ye(R,d.useCallback(()=>{const y=R.current;if(!y)return;const{paddingLeft:_,paddingRight:Ie}=getComputedStyle(y),Ze=6,Be=y.clientWidth-parseFloat(_)-parseFloat(Ie),se=i===V.DOUBLE_PAGE?Be*2+Ze:Be;C(se)},[i]));const b=d.useMemo(()=>Ne(o,r).pagesIndex,[o,r]),w=Se(c).isHorizontal,T=d.useMemo(()=>Ne(o,r),[o,r]),E=d.useCallback((...y)=>ce(y[0],y[1],g),[g]);le.useHandleProgressDragging(f,x,h,T,r,c,E,p);const D=y=>{if(!x.current)return;const _="touches"in y;f(je(rr(_?y.touches[0]:y,x.current,r,w,p,E)),void 0,!1),clearTimeout(S.current),S.current=setTimeout(()=>u(!0),250)},j=()=>{u(!1),clearTimeout(S.current)};return s.jsx(Ln,{...t==null?void 0:t.container,progressBarPosition:c,children:s.jsxs(Dn,{...t==null?void 0:t.progressBarRoot,children:[s.jsx(ls,{...(A=t==null?void 0:t.progressBarPageTexts)==null?void 0:A.base,...(I=t==null?void 0:t.progressBarPageTexts)==null?void 0:I.current,sx:[{width:"".concat(v,"px")},...Array.isArray((H=(P=t==null?void 0:t.progressBarPageTexts)==null?void 0:P.base)==null?void 0:H.sx)?(k=(K=(q=t==null?void 0:t.progressBarPageTexts)==null?void 0:q.base)==null?void 0:K.sx)!=null?k:[]:[(W=(N=t==null?void 0:t.progressBarPageTexts)==null?void 0:N.base)==null?void 0:W.sx],...Array.isArray((he=(M=t==null?void 0:t.progressBarPageTexts)==null?void 0:M.current)==null?void 0:he.sx)?(G=(z=(xe=t==null?void 0:t.progressBarPageTexts)==null?void 0:xe.current)==null?void 0:z.sx)!=null?G:[]:[(X=(be=t==null?void 0:t.progressBarPageTexts)==null?void 0:be.current)==null?void 0:X.sx]],onClick:()=>f("previous","ltr",!1),children:T.name}),s.jsx(An,{onClickAway:()=>u(!1),children:s.jsxs(_n,{...t==null?void 0:t.progressBarSlotsActionArea,onMouseDown:D,onMouseUp:j,onTouchStart:D,onTouchEnd:j,children:[s.jsxs(In,{ref:x,...t==null?void 0:t.progressBarSlotsContainer,children:[r.map((y,_)=>d.createElement(kn,{...t==null?void 0:t.progressBarSlot,key:y.primary.index,page:y,pagesIndex:_,isCurrentPage:_===b,isLeadingPage:_<b,isTrailingPage:_>b,totalPages:r.length,primaryPageLoadState:n[y.primary.index].loaded,secondaryPageLoadState:y.secondary?n[y.secondary.index].loaded:void 0,createProgressBarSlot:l,showDraggingStyle:_===b&&h})),s.jsx(Bn,{...t==null?void 0:t.progressBarReadPages,currentPagesIndex:T.pagesIndex,pagesLength:r.length,progressBarPosition:c})]}),s.jsx(Pn,{boxProps:t==null?void 0:t.progressBarCurrentPageSlot,pageName:T.name,currentPagesIndex:T.pagesIndex,pagesLength:r.length,isDragging:h,progressBarPosition:c,children:a==null?void 0:a.progressBarCurrentPage})]})}),s.jsx(ls,{ref:R,...(de=t==null?void 0:t.progressBarPageTexts)==null?void 0:de.base,...(pe=t==null?void 0:t.progressBarPageTexts)==null?void 0:pe.total,sx:[{minWidth:"unset"},...Array.isArray((me=(ue=t==null?void 0:t.progressBarPageTexts)==null?void 0:ue.base)==null?void 0:me.sx)?(te=(ge=(ve=t==null?void 0:t.progressBarPageTexts)==null?void 0:ve.base)==null?void 0:ge.sx)!=null?te:[]:[(Ae=(ee=t==null?void 0:t.progressBarPageTexts)==null?void 0:ee.base)==null?void 0:Ae.sx],...Array.isArray((Fe=(fe=t==null?void 0:t.progressBarPageTexts)==null?void 0:fe.total)==null?void 0:Fe.sx)?(De=(Ue=(Le=t==null?void 0:t.progressBarPageTexts)==null?void 0:Le.total)==null?void 0:Ue.sx)!=null?De:[]:[(Ee=(Ke=t==null?void 0:t.progressBarPageTexts)==null?void 0:Ke.total)==null?void 0:Ee.sx]],onClick:()=>f("next","ltr",!1),children:e})]})})},Us=F(d.memo(Nn),[Ot,()=>({openPage:le.useOpenPage()}),Oe,L.useSettingsWithoutDefaultFlag],["isDragging","setIsDragging","openPage","pages","pageLoadStates","totalPages","currentPageIndex","readingMode"]),Mn=d.forwardRef(({direction:e,...r},n)=>{const{settings:{customThemes:o,appTheme:t,themeMode:a,shouldUsePureBlackMode:l}}=nr(),c=d.useMemo(()=>or(a,ar(t,o),l,e),[a,t,o,l,e]);return s.jsx(ir,{value:cr[e],children:s.jsx(lr,{theme:c,children:s.jsx(Y,{...r,ref:n,dir:e})})})}),Gs=F(Mn,[()=>({direction:L.useGetThemeDirection()})],["direction"]),$s=d.memo(({pageName:e,progressBarPosition:r,slotProps:n,children:o})=>{var t;return s.jsx($,{...n==null?void 0:n.tooltip,title:e,placement:Ts[r],children:s.jsx(Y,{...n==null?void 0:n.box,sx:{width:"100%",height:"100%",...(t=n==null?void 0:n.box)==null?void 0:t.sx},children:o})})}),Hn=d.memo(({pageName:e,primaryPageLoadState:r,secondaryPageLoadState:n,progressBarPosition:o,isCurrentPage:t,isLeadingPage:a,showDraggingStyle:l})=>{const c=nt();return s.jsx($s,{pageName:e,progressBarPosition:o,slotProps:{box:{sx:{cursor:"pointer",backgroundColor:Qt(c.palette.background.paper,.2),...c.applyStyles("dark",{backgroundColor:es(c.palette.background.paper,.1)}),...m(r&&(n==null||n),{backgroundColor:Qt(c.palette.background.paper,.35),...c.applyStyles("dark",{backgroundColor:es(c.palette.background.paper,.25)})})}},tooltip:{slotProps:t?{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}}:void 0}},children:s.jsx(Y,{sx:{width:"100%",height:"100%",...m(a,{backgroundColor:tt(c.palette.primary.main,.5)}),...m(t,{cursor:l?"grabbing":"grab",pointer:"grabbing",borderRadius:2,backgroundColor:"primary.dark",...c.applyStyles("dark",{backgroundColor:"primary.light"})})}})})}),Vn=({readerNavBarWidth:e,isMaximized:r,setIsMaximized:n,isDragging:o,progressBarType:t,progressBarSize:a,progressBarPosition:l,progressBarPositionAutoVertical:c,readerDirection:i,scrollbarXSize:h,scrollbarYSize:u,totalPages:f})=>{const g=nt(),[,p]=d.useState({});Ye(window.document.documentElement,d.useCallback(()=>p({}),[]));const x=js(l,c,u,e+h),{isBottom:S,isLeft:v,isRight:C,isVertical:R,isHorizontal:b}=Se(x),w=!!f,T=t===Wt.HIDDEN,E=!r&&!o;return s.jsx(Gs,{children:s.jsx(Us,{direction:b?i:"ltr",progressBarPosition:x,fullSegmentClicks:!0,createProgressBarSlot:d.useCallback((D,j,A,I,P,H,q,K,k)=>s.jsx(Hn,{pageName:D.name,primaryPageLoadState:A,secondaryPageLoadState:I,progressBarPosition:x,isCurrentPage:P,isLeadingPage:H,showDraggingStyle:k}),[x]),slotProps:{container:{sx:{overflow:"hidden",transition:"all 0.".concat(g.transitions.duration.shortest,"s"),...m(b,{minHeight:"100px",...m(g.direction==="ltr",{left:i==="ltr"?e:u,right:i==="rtl"?e:u}),...m(g.direction==="rtl",{left:i==="rtl"?e:u,right:i==="ltr"?e:u})}),...m(R,{minWidth:"100px",bottom:"".concat(h,"px")}),...m(S,{bottom:"".concat(h,"px")}),...m(v,{...m(g.direction==="ltr",{left:i==="ltr"?e:"unset",right:i==="rtl"?e:"unset"}),...m(g.direction==="rtl",{right:i==="rtl"?u:"unset",left:i==="ltr"?u:"unset"})}),...m(C,{...m(g.direction==="ltr",{right:i==="ltr"?u:"unset",left:i==="rtl"?u:"unset"}),...m(g.direction==="rtl",{left:i==="rtl"?e:"unset",right:i==="ltr"?e:"unset"})}),...m(E,{opacity:T?0:.85}),...m(!w,{pointerEvents:"none"})},onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},progressBarRoot:{sx:{gap:0,transition:"all 0.1s ease-in-out",backgroundColor:"background.paper",...m(R,{flexDirection:"column",height:"100%"}),...m(E,{backgroundColor:"unset",pointerEvents:"none",...m(b,{px:2}),...m(R,{py:2}),...m(S,{pb:.25}),...m(v,{...m(g.direction==="ltr",{pl:i==="ltr"?.25:0,pr:i==="rtl"?.25:0}),...m(g.direction==="rtl",{pr:i==="rtl"?.25:0,pl:i==="ltr"?.25:0})}),...m(C,{...m(g.direction==="ltr",{pr:i==="ltr"?.25:0,pl:i==="rtl"?.25:0}),...m(g.direction==="rtl",{pl:i==="rtl"?.25:0,pr:i==="ltr"?.25:0})})})}},progressBarSlotsContainer:{sx:{gap:.25,borderRadius:2,transition:"height 0.1s ease-in-out",...m(b,{height:"20px"}),...m(R,{flexDirection:"column",width:"20px"}),...m(E,{...m(b,{height:"".concat(a,"px")}),...m(R,{width:"".concat(a,"px")})})}},progressBarReadPages:{sx:{display:"none"}},progressBarCurrentPageSlot:{sx:{display:"none"}},progressBarPageTexts:{base:{sx:{px:1,py:1.5,transition:"all 0.1s ease-in-out",...m(E,{transform:"scale(0)",p:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})}}}}})})},Wn=F(d.memo(Vn),[ze,Ot,L.useSettingsWithoutDefaultFlag,()=>({readerDirection:L.useGetThemeDirection()}),rt,Oe],["readerNavBarWidth","isMaximized","setIsMaximized","isDragging","progressBarType","progressBarSize","progressBarPosition","progressBarPositionAutoVertical","readerDirection","scrollbarXSize","scrollbarYSize","totalPages"]),Fn=Xe(B)({width:"400px",minWidth:"400px",maxWidth:"400px",height:"100vh",overflowY:"auto"}),Un=d.memo(({mangaId:e,mangaTitle:r,chapterTitle:n,scanlator:o})=>s.jsxs(B,{children:[s.jsx($,{title:r,placement:"right",children:s.jsx(gt,{lines:3,variant:"h6",component:"h1",sx:{textAlign:"center"},children:s.jsx($t,{component:At,to:Xt.manga.path(e),sx:{textDecoration:"none",color:"inherit"},children:r})})}),s.jsx($,{title:n,placement:"right",children:s.jsx(gt,{lines:4,variant:"body1",component:"h2",sx:{textAlign:"center"},children:n})}),o&&s.jsx($,{title:o,placement:"right",children:s.jsx(gt,{lines:4,variant:"body2",component:"h3",color:"textDisabled",sx:{textAlign:"center"},children:o})})]})),Gn=Re(s.jsx("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"})),$n=Re(s.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),wt=({title:e,type:r,disabled:n,...o})=>s.jsx($,{title:e,disabled:n,children:s.jsx(Vs,{sx:{flexBasis:"15%"},variant:"contained",disabled:n,...o,children:r==="previous"?s.jsx(Gn,{}):s.jsx($n,{})})}),zn=({currentPageIndex:e,pages:r,readingDirection:n,openPage:o})=>{const{t}=U(),a=Cs(),l=d.useMemo(()=>Ne(e,r),[e,r]),c=ws[n];return s.jsxs(B,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(wt,{type:"previous",title:t(a("reader.button.previous_page","reader.button.next_page",c)),disabled:a(!l.primary.index,je(l)===je(r.slice(-1)[0]),c),onClick:()=>o("previous",void 0,!1)}),s.jsxs(Ws,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(Fs,{id:"reader-nav-bar-desktop-page-select",children:t("reader.page_info.label.page")}),s.jsx(Hs,{labelId:"reader-nav-bar-desktop-page-select",label:t("reader.page_info.label.page"),value:je(l),onChange:i=>o(i.target.value,void 0,!1),children:r.map(i=>s.jsx(bt,{value:je(i),children:i.name},je(i)))})]}),s.jsx(wt,{type:"next",title:t(a("reader.button.next_page","reader.button.previous_page",c)),disabled:a(je(l)===je(r.slice(-1)[0]),!l.primary.index,c),onClick:()=>o("next",void 0,!1)})]})},Xn=F(d.memo(zn),[Oe,()=>({openPage:le.useOpenPage()}),L.useSettingsWithoutDefaultFlag],["currentPageIndex","pages","readingDirection","openPage"]),Yn=()=>{},zs=({currentChapter:e,chapters:r,style:n})=>{const o=d.useMemo(()=>e&&r.findIndex(t=>t.id===e.id),[e,r]);return s.jsx(an,{style:{height:"calc(".concat(r.length," * 100px)"),...n},initialTopMostItemIndex:o!=null?o:0,totalCount:r.length,computeItemKey:t=>r[t].id,itemContent:t=>s.jsx(rn,{index:t,chapters:r,isSortDesc:!0,mode:"reader",showChapterNumber:!1,selected:null,onSelect:Yn,selectable:!1,isActiveChapter:t===o}),increaseViewportBy:400})},Kn=({currentChapter:e,previousChapter:r,nextChapter:n,chapters:o=[],readerThemeDirection:t,openChapter:a})=>{var i,h;const{t:l}=U(),c=Et({variant:"popover",popupId:"reader-nav-bar-desktop-chapter-list"});return d.useLayoutEffect(()=>{c.close()},[e==null?void 0:e.id]),s.jsxs(B,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(wt,{type:"previous",title:l(ce("reader.button.previous_chapter","reader.button.next_chapter",t)),onClick:()=>{a(ce("previous","next",t))},disabled:ce(!r,!n,t)}),s.jsxs(Ws,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(Fs,{id:"reader-nav-bar-desktop-chapter-select",children:l("chapter.title_one")}),s.jsx(Hs,{...Tt(c),open:c.isOpen,value:(i=e==null?void 0:e.id)!=null?i:0,MenuProps:{sx:{visibility:"hidden"}},label:l("chapter.title_one"),labelId:"reader-nav-bar-desktop-chapter-select",children:s.jsx(bt,{value:(h=e==null?void 0:e.id)!=null?h:0,children:e?"#".concat(e.chapterNumber," ").concat(e.name):""},e==null?void 0:e.id)})]}),s.jsx(wt,{component:At,type:"next",title:l(ce("reader.button.next_chapter","reader.button.previous_chapter",t)),onClick:()=>{a(ce("next","previous",t))},disabled:ce(!n,!r,t)}),s.jsx(dr,{...ur(c),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:s.jsx(Y,{sx:{mb:1},children:s.jsx(zs,{style:{width:"500px",maxWidth:"90vw",minHeight:"150px",maxHeight:"300px"},currentChapter:e,chapters:o})})})]})},Zn=F(d.memo(Kn),[()=>({readerThemeDirection:L.useGetThemeDirection()}),()=>({openChapter:le.useOpenChapter()})],["readerThemeDirection","openChapter"]),qn=Re(s.jsx("path",{d:"M17 4h3c1.1 0 2 .9 2 2v2h-2V6h-3zM4 8V6h3V4H4c-1.1 0-2 .9-2 2v2zm16 8v2h-3v2h3c1.1 0 2-.9 2-2v-2zM7 18H4v-2H2v2c0 1.1.9 2 2 2h3zM18 8H6v8h12z"})),Xs=(e,r,n)=>{const t=(e+1)%r.length===0;if(!(n&&t))return r[(e+1)%r.length]},Kt=({tooltip:e,value:r,defaultValue:n,values:o,setValue:t,valueToDisplayData:a,isDefaultable:l,onDefault:c,defaultIcon:i})=>{const{t:h}=U(),u=r===void 0,f=d.useMemo(()=>u?-1:o.indexOf(r),[r,o]);return s.jsx($,{title:e,children:u?s.jsx(st,{onClick:()=>t(o[0]),sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:i,size:"large",children:n===void 0?h("global.label.default"):s.jsx(Zr,{i18nKey:"settings.default_value",value:a[n].isTitleString?a[n].title:h(a[n].title)})}):s.jsx(st,{onClick:()=>{const g=Xs(f,o,l);if(g===void 0){c==null||c();return}t(g)},sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:a[r].icon,size:"large",children:a[r].isTitleString?a[r].title:h(a[r].title)})})},Jn=({pageScaleMode:e,shouldStretchPage:r,updateSetting:n,...o})=>{const{t}=U();return s.jsxs(B,{sx:{flexDirection:"row",gap:1},children:[s.jsx(Kt,{...o,tooltip:t("reader.settings.page_scale.title"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Os,setValue:a=>n("pageScaleMode",a),valueToDisplayData:ts,defaultIcon:ts[e.value].icon}),gr[e.value]&&s.jsx($,{title:t("reader.settings.page_scale.stretch"),children:s.jsx(Vs,{onClick:()=>n("shouldStretchPage",!r.value),sx:{px:void 0},variant:"contained",color:r.value?"secondary":"primary",children:s.jsx(qn,{})})})]})},Qn=({readingMode:e,setReadingMode:r,...n})=>{const{t:o}=U();return s.jsx(Kt,{...n,tooltip:o("reader.settings.label.reading_mode"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:As,setValue:r,valueToDisplayData:Ft,defaultIcon:Ft[e.value].icon})},eo=()=>s.jsx(fr,{children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M2 4h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2m20 0h-6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6M2 12h20m-3-3 3 3-3 3M5 9l-3 3 3 3"})})}),to=({readingMode:e,shouldOffsetDoubleSpreads:r,setShouldOffsetDoubleSpreads:n})=>{const{t:o}=U();return hr(e)?s.jsx(st,{sx:{justifyContent:"start",textTransform:"unset"},size:"large",onClick:()=>n(!r),color:r?"secondary":"primary",variant:"contained",startIcon:s.jsx(eo,{}),children:o("reader.settings.label.offset_double_spread")}):null},so=({readingDirection:e,setReadingDirection:r,...n})=>{const{t:o}=U();return s.jsx(Kt,{...n,tooltip:o("reader.settings.label.reading_direction"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Ls,setValue:r,valueToDisplayData:ss,defaultIcon:ss[e.value].icon})},ro=Re(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 14H9V8h2zm4 0h-2V8h2z"})),no=Re(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 14.5v-9l6 4.5z"})),oo=({autoScroll:e,setAutoScroll:r})=>{const{t:n}=U(),{isActive:o,toggleActive:t}=ht(),a=d.useRef(void 0);return s.jsxs(B,{sx:{flexDirection:"row",gap:1},children:[s.jsx(st,{sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},size:"large",onClick:t,color:o?"secondary":"primary",variant:"contained",startIcon:o?s.jsx(ro,{}):s.jsx(no,{}),children:n("reader.settings.auto_scroll.title")}),s.jsx(on,{value:e.value,type:"number",size:"small",onBlur:l=>{const c=it(+l.target.value,ke.min,ke.max);c!==e.value&&(clearTimeout(a.current),r({...e,value:c},!0))},onChange:l=>{const c=it(+l.target.value,ke.min,ke.max);r({...e,value:c},!1),clearTimeout(a.current),a.current=setTimeout(()=>r({...e,value:c},!0),1e3)},slotProps:{input:{inputProps:ke,endAdornment:s.jsx(cn,{position:"end",children:n("global.time.seconds.second",{count:e.value})})}}})]})},ao=({manga:e,readingMode:r,shouldOffsetDoubleSpreads:n,pageScaleMode:o,shouldStretchPage:t,readingDirection:a,autoScroll:l,openSettings:c})=>{const{t:i}=U(),h=L.useCreateUpdateSetting(e!=null?e:Me),u=L.useCreateDeleteSetting(e!=null?e:Me);return s.jsxs(B,{sx:{gap:1},children:[s.jsx(Qn,{readingMode:r,setReadingMode:f=>h("readingMode",f),isDefaultable:!0,onDefault:()=>u("readingMode")}),s.jsx(to,{readingMode:r.value,shouldOffsetDoubleSpreads:n.value,setShouldOffsetDoubleSpreads:f=>h("shouldOffsetDoubleSpreads",f)}),s.jsx(Jn,{pageScaleMode:o,shouldStretchPage:t,updateSetting:h,isDefaultable:!0,onDefault:()=>u("pageScaleMode")}),s.jsx(so,{readingDirection:a,setReadingDirection:f=>h("readingDirection",f),isDefaultable:!0,onDefault:()=>u("readingDirection")}),s.jsx(oo,{autoScroll:l,setAutoScroll:(...f)=>h("autoScroll",...f)}),s.jsx(st,{onClick:()=>c(),size:"large",sx:{justifyContent:"start",textTransform:"none"},variant:"contained",startIcon:s.jsx(Ds,{}),children:i("settings.title")})]})},io=F(ao,[We,L.useSettings],["manga","readingMode","shouldOffsetDoubleSpreads","pageScaleMode","shouldStretchPage","readingDirection","autoScroll"]),co=Re(s.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"})),ds={...Me,title:"Fallback",inLibrary:!1},lo=({manga:e})=>{const{inLibrary:r}=e!=null?e:ds,{t:n}=U(),{CategorySelectComponent:o,updateLibraryState:t}=hn(e!=null?e:ds,!0);return s.jsxs(s.Fragment,{children:[s.jsx($,{title:n(r?"manga.action.library.remove.label.action":"manga.button.add_to_library"),children:s.jsx(ae,{onClick:t,color:"inherit",children:r?s.jsx(fn,{}):s.jsx(xn,{})})}),o]})},Ys=F(d.memo(lo),[We],["manga"]),uo=Re(s.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),go=({id:e,isBookmarked:r})=>{const{t:n}=U(),o=r?"unbookmark":"bookmark";return s.jsx($,{title:n(Ut[o].action.single),children:s.jsx(ae,{onClick:()=>$e.performAction(o,[e],{}),color:"inherit",children:r?s.jsx(nn,{}):s.jsx(uo,{})})})},Ks=d.memo(go),fo=({currentChapter:e})=>{var o;const{t:r}=U(),n=$e.useDownloadStatusFromCache((o=e==null?void 0:e.id)!=null?o:-1);return e&&$e.isDownloaded(e)?s.jsx($,{title:r(Ut.delete.action.single),children:s.jsx(ae,{onClick:()=>$e.performAction("delete",[e.id],{}),color:"inherit",children:s.jsx(un,{})})}):n?s.jsx(gn,{chapterId:n.chapter.id}):s.jsx($,{title:r(Ut.download.action.single),disabled:!e,children:s.jsx(ae,{disabled:!e,onClick:()=>{var t;return $e.performAction("download",[(t=e==null?void 0:e.id)!=null?t:-1],{})},color:"inherit",children:s.jsx(dn,{})})})},ho=d.memo(({currentChapter:e,pageLoadStates:r,setPageLoadStates:n,setRetryFailedPagesKeyPrefix:o})=>{const{id:t,isBookmarked:a,realUrl:l}=e!=null?e:Is,{t:c}=U(),i=d.useRef(0),h=d.useMemo(()=>r.some(u=>u.error),[r]);return s.jsxs(B,{sx:{flexDirection:"row",justifyContent:"center",gap:1},children:[s.jsx(Ys,{}),s.jsx(Ks,{id:t,isBookmarked:a}),s.jsx($,{title:c("reader.button.retry_load_pages"),disabled:!h,children:s.jsx(ae,{onClick:()=>{n(u=>u.map(f=>({url:f.url,loaded:f.loaded}))),o("".concat(i.current)),i.current=(i.current+1)%1e3},disabled:!h,color:"inherit",children:s.jsx(co,{})})}),s.jsx(fo,{currentChapter:e}),s.jsx($,{title:c("chapter.action.label.open_on_source"),disabled:!l,children:s.jsx(ae,{disabled:!l,href:l!=null?l:"",rel:"noreferrer",target:"_blank",color:"inherit",children:s.jsx(ln,{})})})]})}),xo=F(ho,[He,Oe],["currentChapter","pageLoadStates","setPageLoadStates","setRetryFailedPagesKeyPrefix"]),po=({exit:e})=>{const{t:r}=U(),n=Cs();return s.jsx($,{title:r("reader.button.exit"),children:s.jsx(ae,{sx:{marginRight:2},onClick:e,color:"inherit",children:n(s.jsx(xr,{}),s.jsx(pr,{}))})})},Zs=F(d.memo(po),[()=>({exit:L.useExit()})],["exit"]),mo=(e,r)=>{const n=d.useRef(r),o=d.useRef(r);return o.current!==n.current&&!e&&(n.current=!1),o.current!==r&&(n.current=o.current,o.current=r),n.current},vo=({isVisible:e,openSettings:r,setReaderNavBarWidth:n,manga:o,chapters:t,currentChapter:a,previousChapter:l,nextChapter:c,isStaticNav:i})=>{const{t:h}=U(),u=L.useCreateUpdateSetting(o!=null?o:Me),[f,g]=d.useState();Ye(f,d.useCallback(()=>{i&&n(f.offsetWidth)},[f,i])),d.useLayoutEffect(()=>()=>n(0),[]);const S=mo(e,i)&&e?0:void 0;return s.jsx(mr,{variant:i?"permanent":"persistent",open:e||i,transitionDuration:S,SlideProps:{unmountOnExit:!0},PaperProps:{ref:v=>g(v)},children:s.jsxs(Fn,{sx:{backgroundColor:"background.paper",pointerEvents:"all"},children:[s.jsxs(B,{sx:{p:2,gap:2,backgroundColor:"action.hover"},children:[s.jsxs(B,{sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(Zs,{}),s.jsx($,{title:h("reader.settings.label.static_navigation"),children:s.jsx(ae,{onClick:()=>{n(0),u("isStaticNav",!i)},color:i?"primary":"inherit",children:i?s.jsx(tn,{}):s.jsx(sn,{})})})]}),o&&a?s.jsxs(s.Fragment,{children:[s.jsx(Un,{mangaId:o.id,mangaTitle:o.title,chapterTitle:a.name,scanlator:a.scanlator}),s.jsx(xo,{})]}):s.jsx(Lt,{})]}),s.jsxs(B,{sx:{p:2,gap:2},children:[s.jsxs(B,{sx:{gap:1},children:[s.jsx(Xn,{}),s.jsx(Zn,{chapters:t,currentChapter:a,nextChapter:c,previousChapter:l})]}),s.jsx(vr,{}),s.jsx(io,{openSettings:r})]})]})})},So=F(d.memo(vo),[ze,We,He,Oe,L.useSettingsWithoutDefaultFlag],["setReaderNavBarWidth","manga","chapters","currentChapter","previousChapter","nextChapter","isStaticNav"]),Ro={...Me,title:""},bo=d.forwardRef(({isVisible:e,manga:r,currentChapter:n,scrollbarYSize:o},t)=>{const{t:a}=U(),l=Et({popupId:"reader-overlay-more-menu",variant:"popover"}),{id:c,title:i}=r!=null?r:Ro,{id:h,name:u,realUrl:f,isBookmarked:g}=n!=null?n:Is;return s.jsx(Yt,{direction:"down",in:e,ref:t,children:s.jsxs(B,{sx:{flexDirection:"row",alignItems:"center",position:"fixed",top:0,left:0,right:"".concat(o,"px"),p:2,pt:p=>"max(env(safe-area-inset-top), ".concat(p.spacing(2),")"),backgroundColor:p=>tt(p.palette.background.paper,.95),pointerEvents:"all",boxShadow:2},children:[s.jsx(Zs,{}),s.jsx(B,{sx:{flexGrow:1},children:r&&n?s.jsxs(s.Fragment,{children:[s.jsx($,{title:i,children:s.jsx(gt,{lines:1,component:"h1",variant:"h5",children:s.jsx($t,{component:At,to:Xt.manga.path(c),sx:{textDecoration:"none",color:"inherit"},children:i})})}),s.jsx($,{title:u,children:s.jsx(gt,{lines:1,children:u})})]}):s.jsx(Lt,{})}),s.jsx(Ys,{}),s.jsx(Ks,{id:h,isBookmarked:g}),s.jsx(ae,{...Tt(l),color:"inherit",children:s.jsx(pn,{})}),s.jsxs(Sr,{...Rr(l),children:[s.jsx(bt,{component:$t,disabled:!f,href:f!=null?f:"",rel:"noreferrer",target:"_blank",children:a("chapter.action.label.open_on_source")}),s.jsx(bt,{disabled:!f,onClick:async()=>{await navigator.clipboard.writeText(i),Bs(a("global.label.copied_clipboard"),"info")},children:a("global.label.share")})]})]})})}),Eo=F(d.memo(bo),[We,He,rt],["manga","currentChapter","scrollbarYSize"]),To=Re(s.jsx("path",{d:"m21.81 12.74-.82-.63v-.22l.8-.63c.16-.12.2-.34.1-.51l-.85-1.48c-.07-.13-.21-.2-.35-.2q-.075 0-.15.03l-.95.38c-.08-.05-.11-.07-.19-.11l-.15-1.01c-.03-.21-.2-.36-.4-.36h-1.71c-.2 0-.37.15-.4.34l-.14 1.01c-.03.02-.07.03-.1.05l-.09.06-.95-.38q-.075-.03-.15-.03c-.14 0-.27.07-.35.2l-.85 1.48c-.1.17-.06.39.1.51l.8.63v.23l-.8.63c-.16.12-.2.34-.1.51l.85 1.48c.07.13.21.2.35.2q.075 0 .15-.03l.95-.37c.08.05.12.07.2.11l.15 1.01c.03.2.2.34.4.34h1.71c.2 0 .37-.15.4-.34l.15-1.01c.03-.02.07-.03.1-.05l.09-.06.95.38q.075.03.15.03c.14 0 .27-.07.35-.2l.85-1.48c.1-.17.06-.39-.1-.51M18 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M17 17h2v4c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v4h-2V6H7v12h10z"})),jo=Re(s.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5M7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"})),us=Re(s.jsx("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})),gs=Re(s.jsx("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"})),Co={display:"flex",alignItems:"center",justifyContent:"end",position:"relative",backgroundColor:"background.default"},fs="3px",wo=d.memo(({isTrailingPage:e,pagesIndex:r,totalPages:n,isVertical:o,isHorizontal:t})=>{const a="".concat(r/(n-1)*100,"%");return s.jsx(Y,{sx:{position:"absolute",...m(o,{top:a,left:"50%"}),...m(t,{top:"50%",left:a}),transform:"translate(-50%, -50%)",width:fs,height:fs,borderRadius:100,backgroundColor:"background.paper",...m(e,{backgroundColor:"primary.main"}),zIndex:1}})}),Oo=d.memo(({pageName:e,isTrailingPage:r,isCurrentPage:n,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:l})=>s.jsx($s,{pageName:e,progressBarPosition:ut.BOTTOM,slotProps:{box:{sx:Co}},children:!n&&s.jsx(wo,{isTrailingPage:r,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:l})})),Ao={[ut.BOTTOM]:"up",[ut.LEFT]:"right",[ut.RIGHT]:"left",[ut.AUTO]:"left"},Lo=({previousChapter:e,nextChapter:r,isVisible:n,setIsMaximized:o,isDragging:t,currentPageIndex:a,pages:l,direction:c,progressBarPosition:i,progressBarPositionAutoVertical:h,topOffset:u=0,bottomOffset:f=0,scrollbarXSize:g})=>{const p=le.useOpenChapter(),[,x]=d.useState({});Ye(window.document.documentElement,d.useCallback(()=>x({}),[]));const S=js(i,h,u+f,g),{isLeft:v,isRight:C,isVertical:R,isHorizontal:b}=Se(S),w=b?c:"ltr",T=d.useMemo(()=>Ne(a,l).pagesIndex,[a,l]),E=d.useMemo(()=>({container:{sx:{flexGrow:1,position:"relative",display:"flex",justifyItems:"center",alignItems:"stretch",backgroundColor:j=>tt(j.palette.background.paper,.85),borderRadius:100,boxShadow:2}},progressBarRoot:{sx:{flexGrow:1,gap:0,...m(R,{flexDirection:"column"}),...m(b,{alignItems:"stretch"})}},progressBarSlotsActionArea:{sx:{alignItems:"center",cursor:"pointer",...m(R,{width:"100%",flexDirection:"column",px:2}),...m(b,{height:"100%",py:2})}},progressBarSlotsContainer:{sx:{borderRadius:100,backgroundColor:"background.default",...m(R,{flexDirection:"column",py:1}),...m(b,{px:1})}},progressBarSlot:{sx:{...m(R,{width:"20px"}),...m(b,{height:"20px"})}},progressBarCurrentPageSlot:{sx:{display:"flex",zIndex:1,cursor:"inherit",...m(R,{justifyContent:"center"}),...m(b,{alignItems:"center"})}},progressBarPageTexts:{base:{sx:{...m(R,{py:1}),...m(b,{px:1})}}}}),[R,b]),D=d.useMemo(()=>({progressBarCurrentPage:s.jsx(Y,{sx:{position:"absolute",...m(R,{top:"calc(100% - 6px)",...m(T===0,{top:"0"}),width:"75%",height:"6px"}),...m(b,{left:"calc(100% - 0px)",...m(T===0,{left:"0"}),width:"6px",height:"75%"}),backgroundColor:"primary.main",borderRadius:100,cursor:t?"grabbing":"grab"}})}),[T,l.length,t,R,b]);return d.useLayoutEffect(()=>(o(n),()=>o(!1)),[n]),s.jsx(Yt,{direction:Ao[S],in:n,children:s.jsx(Gs,{sx:{position:"relative",display:"flex",alignItems:"end",height:"100%",pointerEvents:"none",...m(v,{justifyContent:c==="ltr"?"start":"end"}),...m(C,{justifyContent:c==="ltr"?"end":"start"})},children:s.jsxs(B,{sx:{p:2,gap:1,pointerEvents:"all",alignItems:"center",...m(R,{height:"100%",flexDirection:"column"}),...m(b,{width:"100%",flexDirection:"row"})},children:[s.jsx(ae,{onClick:()=>p("previous"),disabled:!e,sx:{backgroundColor:j=>tt(j.palette.background.paper,.85),boxShadow:2},children:ce(s.jsx(us,{sx:{...m(R,{transform:"rotate(90deg)"})}}),s.jsx(gs,{sx:{...m(R,{transform:"rotate(90deg)"})}}),w)}),s.jsx(Us,{direction:w,progressBarPosition:S,fullSegmentClicks:!1,createProgressBarSlot:d.useCallback((j,A,I,P,H,q,K,k)=>s.jsx(Oo,{pageName:j.name,isTrailingPage:K,isCurrentPage:H,pagesIndex:A,totalPages:k,isVertical:R,isHorizontal:b}),[R,b]),slotProps:{...E,progressBarReadPages:{sx:{backgroundColor:"primary.main",...m(R,{width:"20px",height:"".concat(Math.max(0,Ne(a,l).pagesIndex)/(l.length-1)*100,"%"),borderRadius:"400px 400px 0 0"}),...m(b,{width:"".concat(Math.max(0,Ne(a,l).pagesIndex)/(l.length-1)*100,"%"),height:"20px",borderRadius:"400px 0 0 400px"})}}},slots:D}),s.jsx(ae,{onClick:()=>p("next"),disabled:!r,sx:{backgroundColor:j=>tt(j.palette.background.paper,.85),boxShadow:2},children:ce(s.jsx(gs,{sx:{...m(R,{transform:"rotate(90deg)"})}}),s.jsx(us,{sx:{...m(R,{transform:"rotate(90deg)"})}}),w)})]})})})},Do=F(d.memo(Lo),[He,Dt,Ot,Oe,()=>({direction:L.useGetThemeDirection()}),L.useSettingsWithoutDefaultFlag,rt],["previousChapter","nextChapter","isVisible","setIsMaximized","isDragging","currentPageIndex","pages","direction","progressBarPosition","progressBarPositionAutoVertical","scrollbarXSize"]),Io=({manga:e,readingMode:r,readingDirection:n,autoScroll:o,isActive:t,toggleActive:a})=>{const{t:l}=U(),c=L.useCreateDeleteSetting(e!=null?e:Me);return e?s.jsxs(B,{sx:{gap:2},children:[s.jsx(qr,{}),s.jsx(Jr,{readingMode:r,setReadingMode:i=>L.updateSetting(e,"readingMode",i),isDefaultable:!0,onDefault:()=>c("readingMode")}),s.jsx(Qr,{readingDirection:n,setReadingDirection:i=>L.updateSetting(e,"readingDirection",i),isDefaultable:!0,onDefault:()=>c("readingDirection")}),s.jsx(Sn,{label:l("reader.settings.auto_scroll.title"),checked:t,onChange:()=>a()}),s.jsx(en,{autoScroll:o,setAutoScroll:(...i)=>L.updateSetting(e,"autoScroll",...i)})]}):null},Bo=F(d.memo(Io),[We,L.useSettings,ht],["manga","readingMode","readingDirection","autoScroll","isActive","toggleActive"]),Po=({openSettings:e,isVisible:r,currentChapter:n,chapters:o,scrollbarXSize:t,scrollbarYSize:a,topOffset:l=0})=>{const{t:c}=U(),i=Et({variant:"dialog",popupId:"reader-chapter-list-dialog"}),h=Et({variant:"dialog",popupId:"reader-quick-settings-dialog"}),[u,f]=d.useState(0),g=d.useRef(null);return Ye(g,d.useCallback(()=>{var p,x;return f((x=(p=g.current)==null?void 0:p.clientHeight)!=null?x:0)},[u])),d.useLayoutEffect(()=>{i.close()},[n==null?void 0:n.id]),s.jsxs(s.Fragment,{children:[s.jsxs(B,{sx:{position:"fixed",right:"".concat(a,"px"),bottom:0,left:0,height:"calc(100% - ".concat(l,"px)")},children:[s.jsx(Do,{topOffset:l,bottomOffset:u}),s.jsx(Yt,{direction:"up",in:r,children:s.jsx(B,{ref:g,sx:{alignItems:"center",backgroundColor:p=>tt(p.palette.background.paper,.95),pb:"max(".concat(t,"px, env(safe-area-inset-bottom))"),boxShadow:2,pointerEvents:"all"},children:s.jsxs(B,{sx:{width:"50%",flexDirection:"row",p:2,gap:1,justifyContent:"space-evenly",alignItems:"center"},children:[s.jsx($,{title:c("reader.button.chapter_list"),children:s.jsx(ae,{...Tt(i),color:"inherit",children:s.jsx(jo,{})})}),s.jsx($,{title:c("reader.settings.title.quick_settings"),children:s.jsx(ae,{...Tt(h),color:"inherit",children:s.jsx(To,{})})}),s.jsx($,{title:c("settings.title"),children:s.jsx(ae,{onClick:e,color:"inherit",children:s.jsx(Ds,{})})})]})})})]}),i.isOpen&&s.jsx(Ht,{...rs(i),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Vt,{sx:{p:0,pb:1},children:s.jsx(zs,{style:{minHeight:"15vh",maxHeight:"75vh"},currentChapter:n,chapters:o})})}),h.isOpen&&s.jsx(Ht,{...rs(h),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Vt,{children:s.jsx(Bo,{})})})]})},_o=F(d.memo(Po),[He,rt],["currentChapter","chapters","scrollbarXSize","scrollbarYSize"]),yo=({isVisible:e,isDesktop:r,isMobile:n})=>{const[o,t]=d.useState(!1),[a,l]=d.useState(0),c=d.useRef(null);return Ye(c,d.useCallback(()=>{var i,h;return l((h=(i=c.current)==null?void 0:i.clientHeight)!=null?h:0)},[n])),s.jsxs(Y,{sx:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none",zIndex:1},children:[r&&s.jsxs(s.Fragment,{children:[s.jsx(Wn,{}),s.jsx(So,{isVisible:e,openSettings:()=>t(!0)})]}),n&&s.jsxs(s.Fragment,{children:[s.jsx(Eo,{ref:c,isVisible:e}),s.jsx(_o,{openSettings:()=>t(!0),isVisible:e,topOffset:a})]}),s.jsx(jn,{isOpen:o,close:()=>t(!1)}),s.jsx(wn,{})]})},ko=F(d.memo(yo),[L.useOverlayMode],["isDesktop","isMobile"]),hs="reader-tap-zone-layout-canvas",No=({readerNavBarWidth:e,showPreview:r,tapZoneLayout:n,tapZoneInvertMode:o,readingDirection:t})=>{const a=nt(),[l,c]=d.useState(0),[i,h]=d.useState(0),[u,f]=d.useState(null);Ye(u,d.useCallback(()=>{var p,x;c((p=u==null?void 0:u.clientWidth)!=null?p:0),h((x=u==null?void 0:u.clientHeight)!=null?x:0)},[u]));const g=br.getOrCreateCanvas(n,l,i,a.typography.h3,{vertical:o.vertical,horizontal:o.horizontal,isRTL:t===ct.RTL});return d.useLayoutEffect(()=>{const p=document.getElementById(hs);p==null||p.replaceChildren(g)},[g,r]),s.jsx(Y,{ref:f,sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none"},children:r&&s.jsx("div",{id:hs})})},Mo=F(No,[ze,It,L.useSettingsWithoutDefaultFlag],["readerNavBarWidth","showPreview","tapZoneLayout","tapZoneInvertMode","readingDirection"]),Ho=({readerNavBarWidth:e,customFilter:{rgba:{value:{red:r,green:n,blue:o,alpha:t,blendMode:a},enabled:l}}})=>l?s.jsx(Y,{sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none",background:"rgba(".concat(r," ").concat(n," ").concat(o," / ").concat(t,"%)"),mixBlendMode:"".concat(a)}}):null,Vo=F(Ho,[ze,L.useSettingsWithoutDefaultFlag],["readerNavBarWidth","customFilter"]),xs=2,ps=1,Qe=0,ne=0,oe=1,Wo=(e,r=kt.XY)=>{const[n,o]=d.useState(!1),t=d.useRef(void 0),a=d.useRef([0,0,0]),l=d.useRef([0,0,0]),c=d.useRef([0,0,0]),i=d.useRef([0,0]),h=d.useRef(void 0);return d.useEffect(()=>{const u=e==null?void 0:e.current;if(!u)return()=>{};const f=()=>{t.current||(t.current=getComputedStyle(u));const E=t.current.direction==="rtl",D=t.current.flexDirection==="row-reverse";return E||!E&&D},g=()=>(t.current||(t.current=getComputedStyle(u)),t.current.flexDirection==="column-reverse"),p=r!==kt.Y,x=r!==kt.X,S=()=>clearInterval(h.current),v=()=>{const E=(z,G,be)=>(z[Qe]-z[xs])/(G[Qe]-G[xs])*1e3/be,D=[p?E(a.current,c.current,u.clientWidth):0,x?E(l.current,c.current,u.clientHeight):0],j=p&&x?Math.sqrt(D[ne]**2+D[oe]**2):Math.abs(x?D[oe]:D[ne]),A=[D[ne]/j,D[oe]/j],I=it(1.2*j,-12,12),P=(Date.now()-c.current[Qe])/1e3,H=I-14.278*P+75.24*P**2/I-149.72*P**3/I/I;if(!(I!==0&&H>0&&!Number.isNaN(I))){S();return}const K=(z,G)=>z*G*(I*P-7.1397*P**2+25.08*P**3/I-37.43*P**4/I/I),k=[K(u.clientWidth,A[ne]),K(u.clientHeight,A[oe])],N=[u.scrollWidth-u.clientWidth,u.scrollHeight-u.clientHeight],W=[it(i.current[ne]-k[ne],f()?-N[ne]:0,N[ne]),it(i.current[oe]-k[oe],g()?-N[oe]:0,N[oe])],M=W[ne]!==0||W[ne]!==N[ne],he=W[oe]!==0||W[oe]!==N[oe];M||he||S(),p&&(u.scrollLeft=W[ne]),x&&(u.scrollTop=W[oe])};let C=!1;const R=E=>{if(C)return!0;const D=[u.clientHeight<u.scrollHeight,u.clientWidth<u.scrollWidth],j=[Math.abs(a.current[Qe]-E.pageX)>0,Math.abs(l.current[Qe]-E.pageY)>0];return D[ne]&&j[ne]||D[oe]&&j[oe]},b=E=>{R(E)&&(C=!0,o(!0),a.current=[...a.current.slice(1),E.pageX],l.current=[...l.current.slice(1),E.pageY],c.current=[...c.current.slice(1),Date.now()],p&&(u.scrollLeft+=a.current[Qe]-a.current[ps]),x&&(u.scrollTop+=l.current[Qe]-l.current[ps]))},w=()=>{u.removeEventListener("mousemove",b),u.removeEventListener("mouseup",w),setTimeout(()=>{C=!1,o(!1)},0),i.current=[u.scrollLeft,u.scrollTop],h.current=setInterval(v,16)},T=E=>{E.button===0&&(E.preventDefault(),a.current=[E.pageX,E.pageX,E.pageX],l.current=[E.pageY,E.pageY,E.pageY],c.current=[Date.now()-2,Date.now()-1,Date.now()],u.addEventListener("mousemove",b),u.addEventListener("mouseup",w),S())};return u.addEventListener("mousedown",T),u.addEventListener("wheel",S),()=>{u.removeEventListener("mousedown",T),u.removeEventListener("wheel",S),S()}},[e,r]),n},Fo=(e,r,n)=>{d.useEffect(()=>{if(e&&!n){r.pause();return}r.resume()},[e,r.isPaused,n])},Uo=(e,r,n,o,t)=>{d.useEffect(()=>{var l,c;const a=()=>{e&&r(!1),n&&o(!1)};return(l=t.current)==null||l.addEventListener("wheel",a),(c=t.current)==null||c.addEventListener("touchmove",a),()=>{var i,h;(i=t.current)==null||i.removeEventListener("wheel",a),(h=t.current)==null||h.removeEventListener("touchmove",a)}},[e,n])},Go=(e,r,n)=>{d.useEffect(()=>{if(e!==V.CONTINUOUS_HORIZONTAL)return()=>{};if(!n.current)return()=>{};let o,t,a;const l=c=>{var f,g;if(a===!0)return;c.preventDefault();const i=!Math.abs(Math.abs(o!=null?o:c.deltaX)-Math.abs(c.deltaX)),h=!Math.abs(Math.abs(t!=null?t:c.deltaY)-Math.abs(c.deltaY));if(o=c.deltaX,t=c.deltaY,a||(a=!i||!h),a!==void 0){if(c.shiftKey){(f=n.current)==null||f.scrollBy({top:c.deltaY});return}(g=n.current)==null||g.scrollBy({left:r===ct.LTR?c.deltaY:c.deltaY*-1})}};return n.current.addEventListener("wheel",l),()=>{var c;return(c=n.current)==null?void 0:c.removeEventListener("wheel",l)}},[e,r])},$o=e=>{const r=d.useRef(void 0);d.useEffect(()=>{const n=t=>{const a=e.current;a&&(a.style.cursor=t?"default":"none")},o=()=>{n(!0),clearTimeout(r.current),r.current=setTimeout(()=>{n(!1)},5e3)};return o(),window.addEventListener("mousemove",o),()=>{n(!0),window.removeEventListener("mousemove",o),clearTimeout(r.current)}},[])},zo=(e,r,n,o,t)=>{d.useLayoutEffect(()=>{var a;r||(a=t.current)==null||a.scrollTo(Er(t.current,n,o),0)},[e])},Xo=(e,r,n,o,t,a,l,c,i,h)=>{d.useLayoutEffect(()=>{if(e==null)return;const u=Ne(e,n);if(l){const p=e>r?jt.PREVIOUS:jt.NEXT,x=c.current[u.pagesIndex];x==null||x.scrollIntoView({block:"start",inline:Tr(p,i,h)})}const f=je(u),g=f===o-1;t(null),a(f,!g,g)},[e])},Yo=(e,r,n,o,t,a,l)=>{const[c,i]=d.useState(l===V.DOUBLE_PAGE);d.useLayoutEffect(()=>{if(c&&l!==V.DOUBLE_PAGE){i(!1);const f=Ps(n);o(f),t(f.map(({primary:{url:g}})=>({url:g,isSpread:!1})));return}l===V.DOUBLE_PAGE&&(c||a(je(Ne(e,r))),o(r),i(l===V.DOUBLE_PAGE))},[r,l])},Nt=({title:e,name:r,scanlator:n,backgroundColor:o})=>{const t=nt(),a=t.palette.getContrastText(wr(t.palette,_s[o])),l=tt(a,.5);return r?s.jsxs(B,{children:[s.jsx(et,{color:a,children:e}),s.jsx(et,{color:a,variant:"h6",component:"h1",children:r}),n&&s.jsx(et,{variant:"body2",color:l,children:n})]}):null},Ko=({type:e,transitionPageMode:r,readingMode:n,backgroundColor:o,shouldShowTransitionPage:t,manga:a,currentChapterName:l,currentChapterScanlator:c,previousChapterName:i,previousChapterScanlator:h,nextChapterName:u,nextChapterScanlator:f,scrollbarXSize:g,scrollbarYSize:p,readerNavBarWidth:x,handleBack:S})=>{var j;const{t:v}=U(),C=e===Ce.PREVIOUS,R=e===Ce.NEXT,b=!!l&&!i,w=!!l&&!u,T=b&&e===Ce.PREVIOUS,E=w&&e===Ce.NEXT;return!t&&!(T||E)||!Cr(e,r,n)?null:s.jsx(B,{sx:{justifyContent:"center",alignItems:"center",...m(!Ve(n),{width:"100%",height:"100%"}),...m(Ve(n),{position:"sticky",...m(we(n),{left:0,maxWidth:"calc(100vw - ".concat(p,"px - ").concat(x,"px)"),minHeight:"calc(100vh - ".concat(g,"px)")}),...m(n===V.CONTINUOUS_HORIZONTAL,{top:0,minWidth:"calc(100vw - ".concat(p,"px - ").concat(x,"px)"),maxHeight:"calc(100vh - ".concat(g,"px)")})})},children:s.jsxs(B,{sx:{gap:2,maxWidth:A=>"calc(100vw - ".concat(p,"px - ").concat(x,"px - ").concat(A.spacing(2),")"),maxHeight:"calc(100vh - ".concat(g,"px)"),width:"max-content",p:1},children:[C&&b&&s.jsx(et,{variant:"h6",children:v("reader.transition_page.first_chapter")}),s.jsxs(B,{sx:{gap:5},children:[C&&!b&&s.jsx(Nt,{title:v("reader.transition_page.previous"),name:i,scanlator:h,backgroundColor:o}),!!l&&s.jsx(Nt,{title:v(C?"reader.transition_page.current":"reader.transition_page.finished"),name:l,scanlator:c,backgroundColor:o}),R&&!w&&s.jsx(Nt,{title:v("reader.transition_page.next"),name:u,scanlator:f,backgroundColor:o})]}),R&&w&&s.jsx(et,{variant:"h6",children:v("reader.transition_page.last_chapter")}),(C&&b||R&&w)&&s.jsxs(B,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:[s.jsx(st,{sx:{flexGrow:1},onClick:A=>{A.stopPropagation(),S()},variant:"contained",children:v("reader.transition_page.exit.previous_page")}),s.jsx(st,{sx:{flexGrow:1},component:At,onClick:A=>{A.stopPropagation()},variant:"contained",to:Xt.manga.path((j=a==null?void 0:a.id)!=null?j:-1),children:v("reader.transition_page.exit.manga_page")})]})]})})},ms=F(d.memo(Ko),[We,({chapterId:e})=>{const{chapters:r}=He(),n=d.useMemo(()=>r.findIndex(l=>l.id===e),[e,r]),o=r[n],t=d.useMemo(()=>r[n+1],[n,r]),a=d.useMemo(()=>r[n-1],[n,r]);return{currentChapterName:o==null?void 0:o.name,currentChapterScanlator:o==null?void 0:o.scanlator,previousChapterName:t==null?void 0:t.name,previousChapterScanlator:t==null?void 0:t.name,nextChapterName:a==null?void 0:a.name,nextChapterScanlator:a==null?void 0:a.scanlator}},rt,ze,Oe,L.useSettingsWithoutDefaultFlag,({chapterId:e,type:r})=>{const n=jr(),{chapters:o}=He(),t=d.useMemo(()=>o.findIndex(u=>u.id===e),[e,o]),a=t===0,l=t===o.length-1,c=r===Ce.PREVIOUS&&l,i=r===Ce.NEXT&&a;return{handleBack:c||i?n:ye}}],["manga","currentChapterName","currentChapterScanlator","previousChapterName","previousChapterScanlator","nextChapterName","nextChapterScanlator","scrollbarXSize","scrollbarYSize","readerNavBarWidth","backgroundColor","transitionPageMode","readingMode","handleBack","shouldShowTransitionPage"]),Zo=(e,r,n,o,t,a,l,c,i,h,u,f,g,p,x,S,v,C)=>{var b,w;const R=d.useRef(void 0);d.useLayoutEffect(()=>{var I;const T=(I=r.data)==null?void 0:I.fetchChapterPages;if(!T)return;const{pages:E}=T,D=E.length?E:[""],j=Or(n,o!=null?o:0,D.length-1),A=R.current!==(T==null?void 0:T.pages);if(A){R.current=T.pages;const P=Ps(D);i(!0),f(P),g(D),p(P.map(({primary:{url:H}})=>({url:H,loaded:!1}))),x(P.map(({primary:{url:H}})=>({url:H,isSpread:!1})))}else f(t),p(a),x(l);u(T.pages.length),g(D),S(j),v(j),h(P=>({...P,isCurrentChapterReady:c||A})),C(Ce.NONE)},[(w=(b=r.data)==null?void 0:b.fetchChapterPages)==null?void 0:w.pages,e])},vs=0,vt="-10px",qo=(e,r,n)=>{if(!Ve(r))return;const o=ws[n],t="0px ".concat(vt," 0px 0px"),a="0px 0px 0px ".concat(vt);return we(r)?e==="first"?"0px 0px ".concat(vt," 0px"):"".concat(vt," 0px 0px 0px"):e==="first"?ce(t,a,o):ce(a,t,o)},Jo=(e,r,n,o)=>e===ct.LTR?{start:n>=o,end:r<0}:{start:r<0,end:n>=o},Qo=(e,{top:r,right:n,bottom:o,left:t},a,l)=>{const c=window.innerWidth-l,i=window.innerHeight-a;return{[V.CONTINUOUS_VERTICAL]:{start:o>=i,end:r<0},[V.CONTINUOUS_HORIZONTAL]:Jo(e,t,n,c)}},ea=({[V.CONTINUOUS_VERTICAL]:e,[V.CONTINUOUS_HORIZONTAL]:r},n)=>we(n)?e.start||e.end:r.start||r.end,ta=({[V.CONTINUOUS_VERTICAL]:e,[V.CONTINUOUS_HORIZONTAL]:r},n)=>we(n)?e:r,Ss=(e,r,n,o,t,a,l,c,i,h,u,f,g,p)=>{d.useEffect(()=>{const x=Ve(a),S=we(a);if(p||!g||!x||!c||!o||t||n===void 0)return()=>{};const v=()=>{const C=g.scrollLeft===0,R=g.scrollLeft===g.scrollWidth-g.clientWidth,b=g.scrollTop===0,w=g.scrollTop===g.scrollHeight-g.clientHeight;(e==="first"&&(S?b:C)||e==="last"&&(S?w:R))&&i(n,void 0,!1)};return g.addEventListener("scroll",v),()=>g.removeEventListener("scroll",v)},[a,g,p,c,o,t,n,i]),Ar(h,d.useCallback(x=>{if(!c||!Ve(a)||n===void 0||!p&&!t)return;const S=x[x.length-1],v=Qo(l,S.target.getBoundingClientRect(),u,f),{start:C,end:R}=ta(v,a),b=S.intersectionRatio<=vs;if(!ea(v,a))return;const w=e==="first"&&C&&!t,T=e==="last"&&!o&&R;if(w||e==="last"&&R&&b){i(n,!t,!1);return}T&&i(r,!1,!1)},[e,r,n,o,t,a,l,c,p,i,u,f]),d.useMemo(()=>({root:g,threshold:[vs],rootMargin:qo(e,a,l),ignoreInitialObserve:!0}),[e,a,l]))},sa=({readingMode:e,readingDirection:r,shouldUseInfiniteScroll:n,chapterId:o,previousChapterId:t,nextChapterId:a,isPreviousChapterVisible:l,isCurrentChapter:c,isNextChapterVisible:i,imageWrapper:h,openChapter:u,scrollbarXSize:f,scrollbarYSize:g,scrollElement:p,shouldShowTransitionPage:x})=>(Ss("first",o,t,c,l,e,r,n,u,h,f,g,p,x),Ss("last",o,a,c,i,e,r,n,u,h,f,g,p,x),null),ra=F(d.memo(sa),[()=>({openChapter:le.useOpenChapter()}),L.useSettingsWithoutDefaultFlag],["openChapter","shouldShowTransitionPage"]),na=({currentPageIndex:e,setPages:r,setPageLoadStates:n,setTotalPages:o,setCurrentPageIndex:t,updateCurrentPageIndex:a,setPageToScrollToIndex:l,transitionPageMode:c,retryFailedPagesKeyPrefix:i,setTransitionPageMode:h,readingMode:u,readerWidth:f,pageScaleMode:g,shouldOffsetDoubleSpreads:p,readingDirection:x,shouldUseInfiniteScroll:S,imagePreLoadAmount:v,pageGap:C,chapterId:R,previousChapterId:b,nextChapterId:w,isPreviousChapterVisible:T,isNextChapterVisible:E,lastPageRead:D,isInitialChapter:j,isCurrentChapter:A,isPreviousChapter:I,isNextChapter:P,isLeadingChapter:H,isTrailingChapter:q,isPreloadMode:K,imageRefs:k,scrollIntoView:N,setReaderStateChapters:W,resumeMode:M,customFilter:he,shouldStretchPage:xe,scrollbarXSize:z,scrollbarYSize:G,readerNavBarWidth:be,onSizeChange:X,minWidth:de,minHeight:pe,scrollElement:ue})=>{const{t:me}=U(),{direction:ve}=nt(),[ge,te]=Gt.useGetChapterPagesFetch(R!=null?R:-1),[ee,Ae]=d.useState(!1),[fe,Fe]=d.useState(pt.totalPages),[Le,Ue]=d.useState(pt.pageUrls),[De,Ke]=d.useState(pt.pages),[Ee,y]=d.useState(pt.pageLoadStates),[_,Ie]=d.useState(Ee.map(({url:O})=>({url:O,isSpread:!1}))),Ze=d.useRef(null),Be=d.useRef(A),se=d.useRef(De.map(()=>null)),qe=d.useRef(null),re=d.useMemo(()=>!!!fe||!(fe===_.length)?De:u===V.DOUBLE_PAGE?Lr(Le,_,p,x):De,[_,u,p,x,fe]),Z=d.useMemo(()=>Dr(u),[u]),ot=x===ct.LTR,Pe=Ve(u),_e=!Pe&&!A||K,Ge=!Pe&&A,Bt=!_e&&(Ge||Pe&&(j||H)),Pt=!_e&&(Ge||Pe&&(j||q));Be.current=A,A&&(k.current=se.current);const Je=d.useCallback(()=>{R&&(Ae(!1),ge({variables:{input:{chapterId:R}}}).catch(St()))},[ge,R]),lt=d.useMemo(()=>Ir(re,_,Ie,Ee,O=>{Be.current&&n(O),y(O)},u),[re,u]),_t=d.useMemo(()=>Br(O=>{Be.current&&n(O),y(O)}),[]);d.useEffect(()=>{Je()},[R]),Ye(Ze,d.useCallback(O=>{const{clientWidth:Te,clientHeight:at}=O[0].target;X(Te,at,R)},[X,Ze.current,R]));const ie=(O,Te,at,xt=!1)=>{(xt||!ee)&&Te(O),A&&at(O)};return Zo(A,te,M,D,re,Ee,_,ee,Ae,O=>ie(O,ye,W),O=>ie(O,Fe,o),O=>ie(O,Ke,r),O=>ie(O,Ue,ye),O=>ie(O,y,n),O=>ie(O,Ie,ye),O=>ie(O,ye,t),O=>{(j&&!ee||N)&&(l(O),W(Te=>({...Te,visibleChapters:{...Te.visibleChapters,scrollIntoView:!1,resumeMode:void 0}})))},O=>ie(O,ye,h)),Yo(e,re,Le,O=>ie(O,Ke,r,!0),O=>ie(O,Ie,ye,!0),O=>ie(O,ye,a),u),Pe||A||I||P?te.error?_e?null:s.jsx(Y,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center",position:"relative"},children:s.jsx(Ct,{message:me("global.error.label.failed_to_load_data"),messageExtra:ys(te.error),retry:()=>{Je()}})}):te.loading||!ee?_e?null:s.jsx(Y,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center"},children:s.jsx(Lt,{})}):R!=null&&!fe?_e?null:s.jsx(Y,{sx:{minWidth:"100%",minHeight:"100%",position:"relative"},children:s.jsx(Ct,{message:me("reader.error.label.no_pages_found"),retry:Je})}):s.jsxs(B,{ref:Ze,sx:{width:"fit-content",height:"fit-content",margin:"auto",flexWrap:"nowrap",...m(u===V.CONTINUOUS_HORIZONTAL,{minHeight:pe}),...m(we(u),{minWidth:de}),...m(_e,{maxWidth:0,maxHeight:0,minWidth:"unset",minHeight:"unset",overflow:"hidden",margin:"unset"}),...m(we(u)&&ks(f,g),{alignItems:"center"}),...m(u===V.CONTINUOUS_HORIZONTAL,{...m(ve==="ltr",{flexDirection:ot?"row":"row-reverse"}),...m(ve==="rtl",{flexDirection:ot?"row-reverse":"row"})})},children:[!K&&s.jsx(ra,{readingMode:u,readingDirection:x,shouldUseInfiniteScroll:S,chapterId:R,previousChapterId:b,nextChapterId:w,isCurrentChapter:A,isPreviousChapterVisible:T,isNextChapterVisible:E,imageWrapper:qe.current,scrollbarXSize:z,scrollbarYSize:G,scrollElement:ue}),Bt&&s.jsx(ms,{chapterId:R,type:Ce.PREVIOUS}),s.jsx(Z,{ref:qe,totalPages:fe,currentPageIndex:e,pages:re,transitionPageMode:c,pageLoadStates:Ee,retryFailedPagesKeyPrefix:i,imageRefs:se,onLoad:lt,onError:_t,isCurrentChapter:A,isPreviousChapter:I,isNextChapter:P,readingMode:u,imagePreLoadAmount:v,readingDirection:x,pageScaleMode:g,pageGap:C,customFilter:he,shouldStretchPage:xe,readerWidth:f,scrollbarXSize:z,scrollbarYSize:G,readerNavBarWidth:be,isPreloadMode:K,resumeMode:M,handleAsInitialRender:N}),Pt&&s.jsx(ms,{chapterId:R,type:Ce.NEXT})]}):null},oa=d.memo(na),aa=(e,r,n,o)=>{const t=Pr(r),a=_r(r),l=n!==window.innerWidth,c=o!==window.innerHeight,i=t&&l,h=a&&c;return!we(e)&&l?!0:i||h},Rs=(e,r,n)=>{d.useLayoutEffect(()=>{n(r)},[e])},ia=(e,r,n,o)=>{const t=d.useRef({width:window.innerWidth,height:window.innerHeight}),a=d.useCallback(()=>{const{width:l,height:c}=t.current;t.current={width:window.innerWidth,height:window.innerHeight},aa(e,r,l,c)&&n(o)},[e,r,o]);Rn("resize",a)},qs=e=>{const r=d.useRef({left:0,top:0,visibleElement:void 0,visibleElementLeft:0,visibleElementTop:0});return d.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=()=>{var a,l;const{visibleElement:t}=r.current;r.current={...r.current,left:n.scrollLeft,top:n.scrollTop,visibleElementLeft:(a=t==null?void 0:t.offsetLeft)!=null?a:0,visibleElementTop:(l=t==null?void 0:t.offsetTop)!=null?l:0}};return n.addEventListener("scroll",o),()=>n.removeEventListener("scroll",o)},[]),d.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=(l,c)=>Array.from(l).filter(i=>i instanceof HTMLElement).flatMap(i=>i instanceof HTMLImageElement?[i]:Array.from(i.querySelectorAll("img"))).forEach(c),t=new IntersectionObserver(l=>{const c=l.find(i=>i.isIntersecting);(c==null?void 0:c.target)instanceof HTMLElement&&(r.current={...r.current,visibleElement:c.target,visibleElementLeft:c.target.offsetLeft,visibleElementTop:c.target.offsetTop})}),a=new MutationObserver(l=>{for(const c of l)o(c.addedNodes,i=>t.observe(i)),o(c.removedNodes,i=>t.unobserve(i))});return a.observe(n,{childList:!0,subtree:!0}),()=>{a.disconnect(),t.disconnect()}},[]),r},ca=(e,r)=>{const n=qs(e),o=Ve(r),t=we(r);d.useEffect(()=>{const a=e.current;if(!a||!o)return()=>{};const l=u=>{const{left:f,top:g,visibleElement:p,visibleElementLeft:x,visibleElementTop:S}=n.current;if(!p||!!!u.filter(w=>!(w.target instanceof HTMLElement)||!w.target.clientWidth&&!w.target.clientHeight?!1:t?w.target.offsetTop<g:Math.abs(w.target.offsetLeft)<Math.abs(f)).length)return;const R=f-x+p.offsetLeft,b=g-S+p.offsetTop;a.scrollTo(R,b)},c=(u,f)=>Array.from(u).filter(g=>g instanceof HTMLElement).flatMap(g=>g instanceof HTMLImageElement?[g]:Array.from(g.querySelectorAll("img"))).forEach(f),i=new ResizeObserver(l),h=new MutationObserver(u=>{for(const f of u)c(f.addedNodes,g=>i.observe(g)),c(f.removedNodes,g=>i.unobserve(g))});return h.observe(a,{childList:!0,subtree:!0}),()=>{h.disconnect(),i.disconnect()}},[o,t])},la=(e,r,n,o,t,a,l)=>{const c=qs(e),i=()=>{const h=e.current,{left:u,top:f,visibleElementLeft:g,visibleElementTop:p,visibleElement:x}=c.current;if(!h||!l||!x)return!1;const S=Ns(n,t,a),v=o===0;if(!(!S.previous&&v))return!1;const R=u-g+x.offsetLeft,b=f-p+x.offsetTop;return h.scrollTo(R,b),!0};d.useEffect(()=>{const h=e.current;if(!h||!l)return()=>{};let u=!1;const f=(x,S)=>{Array.from(x).filter(v=>v instanceof HTMLElement).flatMap(v=>v instanceof HTMLImageElement?[v]:Array.from(v.querySelectorAll("img"))).forEach(S)},g=new ResizeObserver(()=>{u||(u=i(),u&&g.disconnect())}),p=new MutationObserver(x=>{for(const S of x)f(S.addedNodes,v=>g.observe(v)),f(S.removedNodes,v=>g.unobserve(v))});return p.observe(h,{childList:!0,subtree:!0}),()=>{p.disconnect(),g.disconnect()}},[r]),d.useLayoutEffect(()=>{i()},[r])},da=(e,r,n,o,t,a,l,c,i,h)=>{la(e,r,n,o,t,a,Ve(l)),ca(e,l),ia(l,h,i,o),Rs(c,o,i),Rs(l,o,i)},ua={[V.SINGLE_PAGE]:dt.X,[V.DOUBLE_PAGE]:dt.X,[V.CONTINUOUS_VERTICAL]:dt.Y,[V.CONTINUOUS_HORIZONTAL]:dt.X,[V.WEBTOON]:dt.Y},ga=d.forwardRef(({currentPageIndex:e,pageToScrollToIndex:r,setPageToScrollToIndex:n,pages:o,totalPages:t,setPages:a,setPageLoadStates:l,setTotalPages:c,setCurrentPageIndex:i,transitionPageMode:h,retryFailedPagesKeyPrefix:u,setTransitionPageMode:f,readingMode:g,readingDirection:p,shouldUseInfiniteScroll:x,readerWidth:S,pageScaleMode:v,shouldOffsetDoubleSpreads:C,imagePreLoadAmount:R,pageGap:b,customFilter:w,shouldStretchPage:T,isStaticNav:E,readerNavBarWidth:D,setScrollbarXSize:j,setScrollbarYSize:A,isVisible:I,setIsVisible:P,updateCurrentPageIndex:H,showPreview:q,setShowPreview:K,initialChapter:k,currentChapter:N,chapters:W,visibleChapters:M,setReaderStateChapters:he,isCurrentChapterReady:xe},z)=>{var Be;const{direction:G}=nt(),{resumeMode:be=ns.START}=(Be=Ms().state)!=null?Be:{resumeMode:ns.START},X=d.useRef(null),de=bn(z,X),pe=we(g),ue=Ve(g),me=Wo(X),ve=ht();d.useEffect(()=>ve.setScrollRef(X),[]);const ge=os.useGetScrollbarSize("width",X.current),te=os.useGetScrollbarSize("height",X.current);d.useLayoutEffect(()=>{j(ge),A(te)},[ge,te]);const ee=le.useHandleClick(X.current),Ae=d.useRef(o.map(()=>null)),[{minChapterViewWidth:fe,minChapterViewHeight:Fe,minChapterSizeSourceChapterId:Le},Ue]=d.useState({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),[,De]=d.useState({}),Ke=ua[g],Ee=p===ct.LTR,y=d.useMemo(()=>W.findIndex(se=>se.id===(k==null?void 0:k.id)),[W,k==null?void 0:k.id]),_=d.useMemo(()=>W.slice(Math.max(0,y-M.trailing),Math.min(W.length,y+M.leading+1)),[W,y,M.trailing,M.leading]),Ie=d.useMemo(()=>_.findIndex(se=>se.id===(N==null?void 0:N.id)),[N,_]),Ze=d.useCallback((se,qe,re)=>{if(!ue)return;const Z=re===Le;if(pe){if(!Z&&fe>=se)return;Ue({minChapterViewWidth:se,minChapterViewHeight:0,minChapterSizeSourceChapterId:re});return}(Z||Fe<qe)&&Ue({minChapterViewWidth:0,minChapterViewHeight:qe,minChapterSizeSourceChapterId:re})},[ue,pe,fe,Fe,Le]);if(Xo(r,e,o,t,n,H,ue,Ae,G,p),zo(e,ue,G,p,X),$o(X),Go(g,p,X),Uo(I,P,q,K,X),Fo(I,ve,E),da(X,N==null?void 0:N.id,Ie,e,_,M,g,p,n,v),d.useLayoutEffect(()=>{Ue({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),De({})},[g]),!k||!N)throw new Error("ReaderViewer: illegal state - initialChapter and currentChapter should not be undefined");return s.jsx(B,{ref:de,sx:{width:"100%",height:"100%",overflow:"auto",flexWrap:"nowrap",...m(pe&&ks(S,v),{alignItems:"center"}),...m(!pe,{...m(G==="ltr",{flexDirection:Ee?"row":"row-reverse"}),...m(G==="rtl",{flexDirection:Ee?"row-reverse":"row"})})},onClick:se=>!me&&ee(se),onScroll:()=>le.updateCurrentPageOnScroll(Ae,t-1,H,Ke,p),children:_.map((se,qe)=>{var at,xt,qt,Jt;const re=Math.max(0,_.length-qe-1),Z=_[re],ot=(at=_[re+1])!=null?at:W[y+M.leading+1],Pe=(xt=_[re-1])!=null?xt:W[y-M.trailing-1],_e=Z.id===k.id,Ge=Z.id===N.id,Bt=Z.id===((qt=_[Ie+1])==null?void 0:qt.id),Pt=Z.id===((Jt=_[Ie-1])==null?void 0:Jt.id),Je=k.sourceOrder>Z.sourceOrder,lt=k.sourceOrder<Z.sourceOrder,_t=M.lastLeadingChapterSourceOrder===Z.sourceOrder,ie=M.lastTrailingChapterSourceOrder===Z.sourceOrder,Zt=_t&&M.isLeadingChapterPreloadMode||ie&&M.isTrailingChapterPreloadMode,O=Ns(re,_,M),Te=Z.id===Le;return s.jsx(oa,{chapterId:Z.id,previousChapterId:ot==null?void 0:ot.id,nextChapterId:Pe==null?void 0:Pe.id,isPreviousChapterVisible:O.previous,isNextChapterVisible:O.next,lastPageRead:it(Z.lastPageRead,0,Z.pageCount-1),currentPageIndex:kr(e,Z,N,Ge,xe,Je,lt,M),isInitialChapter:_e,isCurrentChapter:Ge,isPreviousChapter:Bt,isNextChapter:Pt,isLeadingChapter:Je,isTrailingChapter:lt,isPreloadMode:Zt,imageRefs:Ae,setPages:a,setPageLoadStates:l,setTotalPages:c,setCurrentPageIndex:i,setPageToScrollToIndex:n,transitionPageMode:h,retryFailedPagesKeyPrefix:u,readingMode:g,readerWidth:S,pageScaleMode:v,shouldOffsetDoubleSpreads:C,readingDirection:p,shouldUseInfiniteScroll:x,updateCurrentPageIndex:Ge?H:ye,scrollIntoView:Ge&&M.scrollIntoView,resumeMode:yr(Ge,_e,Je,lt,M.resumeMode,be),setReaderStateChapters:he,setTransitionPageMode:f,pageGap:b,imagePreLoadAmount:R,customFilter:w,shouldStretchPage:T,scrollbarXSize:ge,scrollbarYSize:te,readerNavBarWidth:D,onSizeChange:Ze,minWidth:Te?0:fe,minHeight:Te?0:Fe,scrollElement:X.current},Z.id)})})}),fa=F(d.memo(ga),[Oe,L.useSettingsWithoutDefaultFlag,rt,Dt,()=>({updateCurrentPageIndex:le.useUpdateCurrentPageIndex()}),It,He,ze],["currentPageIndex","pageToScrollToIndex","setPageToScrollToIndex","pages","totalPages","setPages","setPageLoadStates","setTotalPages","setCurrentPageIndex","retryFailedPagesKeyPrefix","setTransitionPageMode","readingMode","readingDirection","shouldUseInfiniteScroll","readerWidth","pageScaleMode","shouldOffsetDoubleSpreads","imagePreLoadAmount","pageGap","customFilter","shouldStretchPage","isStaticNav","readerNavBarWidth","transitionPageMode","setScrollbarXSize","setScrollbarYSize","isVisible","setIsVisible","updateCurrentPageIndex","showPreview","setShowPreview","initialChapter","currentChapter","chapters","visibleChapters","setReaderStateChapters","isCurrentChapterReady"]),ha=Object.fromEntries(Object.values(ft).map(e=>[e,{scopes:e}])),Q=(...e)=>{const[r,n,o,t]=e;return Nr(r,n,{...o,...ha.reader},t)},Mt=(e,r,n,o,t,a,l)=>{if(a){e(n,t[0]);return}const c=Xs(t.indexOf(o),t,l);if(c===void 0){r(n);return}e(n,c)},xa=({scrollElementRef:e})=>{const{direction:r}=nt(),n=L.useGetThemeDirection(),{enableScope:o,disableScope:t}=Es(),{manga:a}=We(),{isVisible:l,setIsVisible:c}=Dt(),{hotkeys:i,pageScaleMode:h,shouldStretchPage:u,shouldOffsetDoubleSpreads:f,readingMode:g,readingDirection:p,autoScroll:x,scrollAmount:S}=L.useSettings(),v=ht(),{setShowPreview:C}=It(),R=L.useExit(),b=le.useOpenChapter(),w=le.useOpenPage(),T=L.useCreateUpdateSetting(a!=null?a:Me),E=L.useCreateDeleteSetting(a!=null?a:Me);return Q(i[J.PREVIOUS_PAGE],()=>w("previous"),[w]),Q(i[J.NEXT_PAGE],()=>w("next"),[w]),Q(i[J.SCROLL_BACKWARD],()=>{if(v.isActive){v.setDirection(mt.BACKWARD);return}e.current&&le.scroll(mt.BACKWARD,as[g.value],g.value,p.value,r,e.current,b,c,C,S)},{preventDefault:!0},[g.value,p.value,r,b,S,v.isActive]),Q(i[J.SCROLL_FORWARD],()=>{if(v.isActive){v.setDirection(mt.FORWARD);return}e.current&&le.scroll(mt.FORWARD,as[g.value],g.value,p.value,r,e.current,b,c,C,S)},{preventDefault:!0},[g.value,p.value,r,b,S,v.isActive]),Q(i[J.PREVIOUS_CHAPTER],()=>b(ce("previous","next",n)),[b,n]),Q(i[J.NEXT_CHAPTER],()=>b(ce("next","previous",n)),[b,n]),Q(i[J.TOGGLE_MENU],()=>c(!l),[l]),Q(i[J.CYCLE_SCALE_TYPE],()=>{Mt(T,E,"pageScaleMode",h.value,Os,h.isDefault,!0)},[T,E,h.value,h.isDefault]),Q(i[J.STRETCH_IMAGE],()=>T("shouldStretchPage",!u.value),[T,u.value]),Q(i[J.OFFSET_SPREAD_PAGES],()=>T("shouldOffsetDoubleSpreads",!f.value),[T,f.value]),Q(i[J.CYCLE_READING_MODE],()=>{Mt(T,E,"readingMode",g.value,As,g.isDefault,!0)},[T,E,g.value,g.isDefault]),Q(i[J.CYCLE_READING_DIRECTION],()=>{Mt(T,E,"readingDirection",p.value,Ls,p.isDefault,!0)},[T,E,p.value,p.isDefault]),Q(i[J.TOGGLE_AUTO_SCROLL],v.toggleActive,{preventDefault:!0},[v.toggleActive]),Q(i[J.AUTO_SCROLL_SPEED_DECREASE],()=>T("autoScroll",{...x,value:Math.min(ke.max,x.value+ke.step)}),[T,x.value]),Q(i[J.AUTO_SCROLL_SPEED_INCREASE],()=>T("autoScroll",{...x,value:Math.max(ke.min,x.value-ke.step)}),[T,x.value]),Q(i[J.EXIT_READER],R,[R]),d.useEffect(()=>(o(ft.READER),()=>t(ft.READER)),[]),null},pa=(e,r,n,o,t,a,l,c,i,h,u,f)=>{d.useEffect(()=>()=>{e(void 0),r(Rt),n(0),o(null),t(0),a([Mr("",0)]),l([]),c([{url:"",loaded:!1}]),i(Ce.NONE),h(!1),u(Hr),f()},[])},ma=(e,r,n,o,t,a)=>{var l;d.useEffect(()=>{var x;const c=(x=e.data)==null?void 0:x.manga;if(!c||r.loading||r.error)return;const i=is(c,n),h=Vr(c,i.shouldUseAutoWebtoonMode,i.readingMode),u={...n,readingMode:h?V.WEBTOON:n.readingMode},f=h?V.WEBTOON:i.readingMode.value,g=Wr("global",{meta:o},u,void 0,f),p=is(c,g);t(p),a(!0)},[(l=e.data)==null?void 0:l.manga,n])},bs=5e3,va=(e,r,n,o,t,a,l,c,i)=>{const{t:h}=U(),u=d.useRef(void 0),f=d.useRef(void 0),g=d.useRef(void 0),p=d.useRef(!0);d.useEffect(()=>{if(e||r||!n)return;const x=JSON.stringify(o)!==JSON.stringify(u.current);l&&x&&Bs(h(Ft[o.value].title),{autoHideDuration:bs}),u.current=o;const v=JSON.stringify(t)!==JSON.stringify(f.current)||JSON.stringify(a)!==JSON.stringify(g.current);c&&v&&(i(!0),p.current&&setTimeout(()=>i(!1),bs)),f.current=t,g.current=a,p.current=!1},[e,r,n,o.value,o.isDefault,t.value,t.isDefault,a.value,a.isDefault])},Sa=(e,r,n,o,t,a,l,c,i)=>{var p;const h=Fr(),u=Ms().state,{updateInitialChapter:f}=u!=null?u:{},g=f?void 0:o;d.useEffect(()=>{var E,D;const x=(E=e.data)==null?void 0:E.chapters.nodes,S=x?(D=x[x.length-r])!=null?D:null:void 0,v=g!=null?g:S,C=t!=null?t:S,R=(()=>{if(!x||!C)return[];const j=c?mn(n!=null?n:x,i):x;return(l?$e.removeDuplicates(C,j):j).map(I=>Ur(I.id))})(),b=S&&$e.getNextChapter(S,R,{offset:jt.NEXT}),w=S&&$e.getNextChapter(S,R,{offset:jt.PREVIOUS}),T=v!=null&&v.id!==(g==null?void 0:g.id);T&&h("",{replace:!0,state:{...u,updateInitialChapter:void 0}}),a(j=>{var I,P,H,q;const A=(S==null?void 0:S.id)!==((I=j.currentChapter)==null?void 0:I.id);return{...j,mangaChapters:(P=j.mangaChapters)!=null?P:x,chapters:R,initialChapter:v,chapterForDuplicatesHandling:C,currentChapter:S,nextChapter:b,previousChapter:w,isCurrentChapterReady:A?!1:j.isCurrentChapterReady,visibleChapters:T?{...Rt.visibleChapters,lastLeadingChapterSourceOrder:(H=v==null?void 0:v.sourceOrder)!=null?H:Rt.visibleChapters.lastLeadingChapterSourceOrder,lastTrailingChapterSourceOrder:(q=v==null?void 0:v.sourceOrder)!=null?q:Rt.visibleChapters.lastTrailingChapterSourceOrder,isLeadingChapterPreloadMode:!1,isTrailingChapterPreloadMode:!1,scrollIntoView:!!j.initialChapter}:j.visibleChapters}})},[(p=e.data)==null?void 0:p.chapters.nodes,r,l,c,g,i])},Ra=({setOverride:e,readerNavBarWidth:r,isVisible:n,setIsVisible:o,manga:t,setManga:a,shouldSkipDupChapters:l,shouldSkipFilteredChapters:c,backgroundColor:i,readingMode:h,tapZoneLayout:u,tapZoneInvertMode:f,shouldShowReadingModePreview:g,shouldShowTapZoneLayoutPreview:p,setSettings:x,mangaChapters:S,initialChapter:v,chapterForDuplicatesHandling:C,currentChapter:R,setReaderStateChapters:b,setTotalPages:w,setCurrentPageIndex:T,setPageToScrollToIndex:E,setPages:D,setPageUrls:j,setPageLoadStates:A,setTransitionPageMode:I,cancelAutoScroll:P,setShowPreview:H})=>{var ve,ge,te;const{t:q}=U(),K=d.useRef(null),[k,N]=d.useState(!1),{chapterSourceOrder:W,mangaId:M}=$r(),he=Number(W),xe=Number(M),z=Gt.useGetManga(zr,xe),G=Gt.useGetMangaChapters(Xr,xe);En(!t||!R?q("reader.title",{mangaId:xe,chapterIndex:he}):"".concat(t.title,": ").concat(R.name));const{metadata:be,settings:X,request:de}=Yr(),pe=vn(t!=null?t:Me),ue=R===void 0||!k||z.loading||G.loading||de.loading,me=(ge=(ve=z.error)!=null?ve:G.error)!=null?ge:de.error;return d.useEffect(()=>{var ee;a((ee=z.data)==null?void 0:ee.manga)},[(te=z.data)==null?void 0:te.manga]),pa(a,b,T,E,w,D,j,A,I,o,x,P),ma(z,de,X,be,x,N),va(ue,me,k,h,u,f,g,p,H),Sa(G,he,S,v,C,b,l,c,pe),d.useLayoutEffect(()=>(e({status:!0,value:s.jsxs(Y,{sx:{position:"absolute"},children:[s.jsx(xa,{scrollElementRef:K}),s.jsx(ko,{isVisible:n}),!K.current&&s.jsx(Y,{onClick:()=>o(!n),sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"transparent"}})]})}),()=>e({status:!1,value:null})),[n,o,K.current]),me?s.jsx(Ct,{message:q("global.error.label.failed_to_load_data"),messageExtra:ys(me),retry:()=>{z.error&&z.refetch().catch(St()),de.error&&de.refetch().catch(St()),G.error&&G.refetch().catch(St())}}):ue?s.jsx(Y,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:s.jsx(Lt,{})}):R===null?s.jsx(Ct,{message:q("reader.error.label.chapter_not_found")}):!t||!R?null:s.jsxs(Y,{sx:{position:"relative",display:"flex",flexDirection:"column",width:"calc(100vw - ".concat(r,"px)"),height:"100vh",marginLeft:"".concat(r,"px"),transition:ee=>"width 0.".concat(ee.transitions.duration.shortest,"s, margin-left 0.").concat(ee.transitions.duration.shortest,"s"),overflow:"auto",backgroundColor:_s[i]},children:[s.jsx(fa,{ref:K}),s.jsx(Mo,{}),s.jsx(Vo,{})]})},oi=F(d.memo(Ra),[ze,Dt,We,He,Gr,()=>{const{shouldSkipDupChapters:e,shouldSkipFilteredChapters:r,backgroundColor:n,shouldShowReadingModePreview:o,shouldShowTapZoneLayoutPreview:t}=L.useSettingsWithoutDefaultFlag();return{shouldSkipDupChapters:e,shouldSkipFilteredChapters:r,backgroundColor:n,shouldShowReadingModePreview:o,shouldShowTapZoneLayoutPreview:t}},()=>{const{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}=L.useSettings();return{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}},Oe,()=>({cancelAutoScroll:ht().cancel}),It],["setOverride","readerNavBarWidth","isVisible","setIsVisible","manga","setManga","shouldSkipDupChapters","shouldSkipFilteredChapters","backgroundColor","readingMode","tapZoneLayout","tapZoneInvertMode","shouldShowReadingModePreview","shouldShowTapZoneLayoutPreview","setSettings","mangaChapters","initialChapter","chapterForDuplicatesHandling","currentChapter","setReaderStateChapters","setTotalPages","setCurrentPageIndex","setPageToScrollToIndex","setPages","setPageUrls","setPageLoadStates","setTransitionPageMode","cancelAutoScroll","setShowPreview"]);export{oi as Reader};
