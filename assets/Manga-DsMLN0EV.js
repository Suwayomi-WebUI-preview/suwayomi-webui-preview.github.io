import{r as L,i as F,j as e,u as w,x as Le,c as x,y as ke,k as ve,o as Ce,z as te,L as H,S as B,T as V,g as $,I as M,A as re,C as _e,F as Fe,H as ae,s as y,a as z,h as we,E as q,M as ye,B as Ie,b as Ae,e as Oe,J as Ne,K as ze,n as Me,p as Pe,R as We,O as pe,Q as J,U as Y,V as X,N as Ee,W as Ve,X as qe,Y as He,Z as Ue}from"./index-ZNnErvSB.js";import{C as Ge,a as Ke,V as Qe}from"./index-7RbFD7AL.js";import{M as S,d as Je,a as Ye,b as Xe,c as Ze,e as et,f as tt,J as rt,g as at,h as st,u as nt,C as ot,T as Z,i as lt,j as it,k as dt,l as ct,m as ge,n as xe}from"./useManageMangaLibraryState-ZPQgNuMC.js";import{g as ut}from"./date-CXPVBtaK.js";import{D as ht}from"./DownloadStateIndicator-CiBcur5y.js";import{d as mt}from"./Delete-wFHFAXKw.js";import{C as v,a as ft}from"./Chapters-LCVkOA02.js";import{C as pt}from"./CardContent-EE57nb4F.js";import{C as gt}from"./Checkbox-Bf46Ok7a.js";import{d as xt}from"./PlayArrow-CZDBVSyS.js";import{S as bt,D as jt}from"./StyledFab-DXKJX5_n.js";import{d as kt}from"./FilterList-Dqvqdc9s.js";import{S as vt,R as be}from"./SortRadioInput-HO-G8Xry.js";import{T as ee}from"./ThreeStateCheckboxInput-B_xE-UA2.js";import{O as Ct,a as _t,S as wt,d as yt}from"./SelectionFAB-C6Gw9P3_.js";import{R as It}from"./ListPreference-CzEYRS4i.js";import{d as Mt}from"./Favorite-CojAwe2f.js";import{M as Rt}from"./Mangas-Dhi4NOss.js";import{S as St}from"./SpinnerImage-BHRmMd4H.js";import{d as $t}from"./Sync-Dyd3O42O.js";import{L as Tt}from"./Link-DEL1POSg.js";import"./Avatar-JougP0-9.js";import"./TextField-BkmZjha1.js";import"./InputAdornment-D9it-gN0.js";import"./Collapse-BC8BBmfY.js";import"./NumberSetting-DpJEb6Ln.js";import"./Info-CdODygfp.js";import"./useMobilePicker-Be_4UWWV.js";import"./Chip-p98Qvmkx.js";import"./SelectSetting-BntQCtTG.js";import"./Select-Xg1Y7MZ6.js";import"./CheckboxInput-C2tXpRuP.js";import"./SwitchBase-66kKQ1ZF.js";import"./Tabs-Cs5J980n.js";var se={},Bt=F;Object.defineProperty(se,"__esModule",{value:!0});var Re=se.default=void 0,Dt=Bt(L()),Lt=e;Re=se.default=(0,Dt.default)((0,Lt.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");var ne={},Ft=F;Object.defineProperty(ne,"__esModule",{value:!0});var oe=ne.default=void 0,At=Ft(L()),Ot=e;oe=ne.default=(0,At.default)((0,Ot.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll");var le={},Nt=F;Object.defineProperty(le,"__esModule",{value:!0});var Se=le.default=void 0,zt=Nt(L()),Pt=e;Se=le.default=(0,zt.default)((0,Pt.jsx)("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"}),"Bookmark");var ie={},Wt=F;Object.defineProperty(ie,"__esModule",{value:!0});var $e=ie.default=void 0,Et=Wt(L()),Vt=e;$e=ie.default=(0,Et.default)((0,Vt.jsx)("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"}),"BookmarkRemove");var de={},qt=F;Object.defineProperty(de,"__esModule",{value:!0});var Te=de.default=void 0,Ht=qt(L()),Ut=e;Te=de.default=(0,Ht.default)((0,Ut.jsx)("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"}),"BookmarkAdd");var ce={},Gt=F;Object.defineProperty(ce,"__esModule",{value:!0});var ue=ce.default=void 0,Kt=Gt(L()),Qt=e;ue=ce.default=(0,Kt.default)((0,Qt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39"}),"Public");class C{static getChapters(r){return r.map(({chapter:a})=>a)}static getIds(r){return v.getIds(C.getChapters(r))}static getDownloaded(r){return r.filter(({chapter:a})=>v.isDownloaded(a))}static getDeletable(r,a){return r.filter(({chapter:n})=>v.isDeletable(n,a))}static getNonDownloaded(r){return r.filter(({chapter:a})=>!v.isDownloaded(a))}static getDownloadable(r){return r.filter(({chapter:a,downloadChapter:n})=>!v.isDownloaded(a)&&!n)}static getBookmarked(r){return r.filter(({chapter:a})=>v.isBookmarked(a))}static getNonBookmarked(r){return r.filter(({chapter:a})=>!v.isBookmarked(a))}static getRead(r){return r.filter(({chapter:a})=>v.isRead(a))}static getNonRead(r){return r.filter(({chapter:a})=>!v.isRead(a))}}const Be=({chapter:t,allChapters:r,handleSelection:a,canBeDownloaded:n=!1,selectedChapters:s=[],onClose:i})=>{const{t:o}=w(),d=!!t,{isDownloaded:b,isRead:f,isBookmarked:h}=t!=null?t:{},{settings:{deleteChaptersWithBookmark:l}}=Le(),g=Ze(d,ft),m=et(d),p=tt(d),{downloadableChapters:c,downloadedChapters:j,unbookmarkedChapters:k,bookmarkedChapters:I,unreadChapters:P,readChapters:A}=x.useMemo(()=>({downloadableChapters:C.getDownloadable(s),downloadedChapters:C.getDownloaded(s),unbookmarkedChapters:C.getNonBookmarked(s),bookmarkedChapters:C.getBookmarked(s),unreadChapters:C.getNonRead(s),readChapters:C.getRead(s)}),[s]),U=()=>{a==null||a(t.id,!0),i()},R=(O,G)=>{var W;const T=O==="mark_prev_as_read",E=T?"mark_as_read":O;if(E==="delete"&&t&&!v.isDeletable(t,l)){i();return}const D=(()=>{if(!t)return C.getChapters(G);if(!T)return[t];const N=r.findIndex(({id:_})=>_===t.id);return N+1>r.length-1?[]:r.slice(N+1)})();if(!D.length){i();return}v.performAction(E,v.getIds(D),{chapters:D,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(W=D[0])==null?void 0:W.mangaId}).catch(ve()),i()};return e.jsxs(e.Fragment,{children:[d&&e.jsx(S,{onClick:U,Icon:Je,title:o("chapter.action.label.select")}),d&&e.jsx(S,{Icon:ue,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),i()},title:o("chapter.action.label.open_on_source")}),m(n)&&e.jsx(S,{Icon:ke,disabled:p(!c.length),onClick:()=>R("download",c),title:g("download",c.length)}),m(b)&&e.jsx(S,{Icon:mt,disabled:p(!j.length),onClick:()=>R("delete",C.getDeletable(j,l)),title:g("delete",j.length)}),m(!h)&&e.jsx(S,{Icon:Te,disabled:p(!k.length),onClick:()=>R("bookmark",k),title:g("bookmark",k.length)}),m(h)&&e.jsx(S,{Icon:$e,disabled:p(!I.length),onClick:()=>R("unbookmark",I),title:g("unbookmark",I.length)}),m(!f)&&e.jsx(S,{Icon:Ye,disabled:p(!P.length),onClick:()=>R("mark_as_read",P),title:g("mark_as_read",P.length)}),m(f)&&e.jsx(S,{Icon:Xe,disabled:p(!A.length),onClick:()=>R("mark_as_unread",A),title:g("mark_as_unread",A.length)}),d&&e.jsx(S,{onClick:()=>R("mark_prev_as_read",[]),Icon:oe,title:o("chapter.action.mark_as_read.add.label.action.previous")})]})},Jt=t=>{const{t:r}=w(),a=Ce(),n=x.useRef(null),{chapter:s,allChapters:i,downloadChapter:o,showChapterNumber:d,onSelect:b,selected:f}=t,h=f!==null,{isDownloaded:l}=s,g=c=>{h&&(c.preventDefault(),c.stopPropagation(),b(!f,c.shiftKey))},m=(c,j)=>{c.stopPropagation(),c.preventDefault(),j(c)},p=rt((c,{context:j})=>{if(!h&&n.current){m(c,()=>j==null?void 0:j(n.current));return}c.shiftKey=!0,g(c)});return e.jsx("li",{children:e.jsx(te,{variant:"popover",popupId:"chapter-card-action-menu",children:c=>{var j;return e.jsxs(e.Fragment,{children:[e.jsx(Ge,{sx:{position:"relative",margin:1,touchCallout:"none"},children:e.jsx(Ke,{component:H,to:"/manga/".concat(s.manga.id,"/chapter/").concat(s.sourceOrder),style:{color:a.palette.text[s.isRead?"disabled":"primary"]},onClick:k=>g(k),...p(c.open),children:e.jsxs(pt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:2,"&:last-child":{pb:2}},children:[e.jsxs(B,{direction:"column",flex:1,children:[e.jsxs(V,{variant:"h5",component:"h2",children:[s.isBookmarked&&e.jsx(Se,{color:"primary",sx:{mr:.5,position:"relative",top:"0.15em"}}),d?"".concat(r("chapter.title")," ").concat(s.chapterNumber):s.name]}),e.jsx(V,{variant:"caption",children:s.scanlator}),e.jsxs(V,{variant:"caption",children:[ut(Number((j=s.uploadDate)!=null?j:0),!0),l&&" â€¢ ".concat(r("chapter.status.label.downloaded"))]})]}),o&&e.jsx(ht,{download:o}),f===null?e.jsx($,{title:r("global.button.options"),children:e.jsx(M,{ref:n,...re(c),onClick:k=>m(k,c.open),onTouchStart:k=>m(k,c.open),"aria-label":"more",size:"large",children:e.jsx(at,{})})}):e.jsx($,{title:r(f?"global.button.deselect":"global.button.select"),children:e.jsx(gt,{checked:f})})]})})}),!h&&c.isOpen&&e.jsx(st,{..._e(c),children:k=>e.jsx(Be,{onClose:k,chapter:s,allChapters:i,handleSelection:()=>b(!0),canBeDownloaded:!s.isDownloaded&&!o})})]})}})})};function Yt(t){const{t:r}=w(),{chapterIndex:a,mangaId:n}=t;return e.jsxs(bt,{component:H,variant:"extended",color:"primary",to:"/manga/".concat(n,"/chapter/").concat(a),children:[e.jsx(xt,{}),r(a===1?"global.button.start":"global.button.resume")]})}const Xt={active:!1,unread:void 0,downloaded:void 0,bookmarked:void 0,reverse:!1,sortBy:"source",showChapterNumber:!1};function Zt(t,r){switch(r.type){case"filter":return{...t,active:t.unread!==!1&&t.downloaded!==!1&&t.bookmarked!==!1,[r.filterType]:r.filterValue};case"sortBy":return{...t,sortBy:r.sortBy};case"sortReverse":return{...t,reverse:!t.reverse};case"showChapterNumber":return{...t,showChapterNumber:!t.showChapterNumber};default:throw Error(ae("global.error.label.invalid_action"))}}function er(t,{isRead:r}){switch(t){case!0:return!r;case!1:return r;default:return!0}}function tr(t,{isDownloaded:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}function rr(t,{isBookmarked:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}function ar(t,r){const a=r.active?t.filter(s=>er(r.unread,s)&&tr(r.downloaded,s)&&rr(r.bookmarked,s)):[...t],n=r.sortBy==="fetchedAt"?a.sort((s,i)=>{var o,d;return Number((o=s.fetchedAt)!=null?o:0)-Number((d=i.fetchedAt)!=null?d:0)}):a;return r.reverse&&n.reverse(),n}const sr=t=>Fe(Zt,"".concat(t,"filterOptions"),Xt),nr=[["source","global.sort.label.by_source"],["fetchedAt","global.sort.label.by_fetch_date"]],or=t=>{const{unread:r,downloaded:a,bookmarked:n}=t;return r!=null||a!=null||n!=null},lr={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},ir=({open:t,onClose:r,options:a,optionsDispatch:n})=>{const{t:s}=w();return e.jsx(Ct,{open:t,onClose:r,minHeight:150,tabs:["filter","sort","display"],tabTitle:i=>s(lr[i]),tabContent:i=>i==="filter"?e.jsxs(e.Fragment,{children:[e.jsx(ee,{label:s("global.filter.label.unread"),checked:a.unread,onChange:o=>n({type:"filter",filterType:"unread",filterValue:o})}),e.jsx(ee,{label:s("global.filter.label.downloaded"),checked:a.downloaded,onChange:o=>n({type:"filter",filterType:"downloaded",filterValue:o})}),e.jsx(ee,{label:s("global.filter.label.bookmarked"),checked:a.bookmarked,onChange:o=>n({type:"filter",filterType:"bookmarked",filterValue:o})})]}):i==="sort"?nr.map(([o,d])=>e.jsx(vt,{label:s(d),checked:a.sortBy===o,sortDescending:a.reverse,onClick:()=>o!==a.sortBy?n({type:"sortBy",sortBy:o}):n({type:"sortReverse"})},o)):i==="display"?e.jsxs(It,{onChange:()=>n({type:"showChapterNumber"}),value:a.showChapterNumber,children:[e.jsx(be,{label:s("chapter.option.display.label.source_title"),value:!1}),e.jsx(be,{label:s("chapter.option.display.label.chapter_number"),value:!0})]}):null})},dr=({options:t,optionsDispatch:r})=>{const{t:a}=w(),[n,s]=x.useState(!1),i=or(t);return e.jsxs(e.Fragment,{children:[e.jsx($,{title:a("settings.title"),children:e.jsx(M,{onClick:()=>s(!0),children:e.jsx(kt,{color:i?"warning":void 0})})}),e.jsx(ir,{open:n,onClose:()=>s(!1),options:t,optionsDispatch:r})]})},cr=y(B)(({theme:t})=>({margin:8,marginBottom:0,marginRight:"10px",minHeight:40,[t.breakpoints.down("md")]:{marginRight:0}})),ur=y(Qe)(({theme:t})=>({listStyle:"none",padding:0,minHeight:"200px",[t.breakpoints.up("md")]:{width:"50vw",height:"calc(100vh - 64px - 48px)",margin:0}})),hr=({manga:t,isRefreshing:r})=>{var K,D,W,N;const{t:a}=w(),{data:n}=z.useGetDownloadStatus(),s=(K=n==null?void 0:n.downloadStatus.queue)!=null?K:[],[i,o]=sr(t.id),{data:d,loading:b,error:f,refetch:h}=z.useGetMangaChapters(t.id,{notifyOnNetworkStatusChange:!0}),l=x.useMemo(()=>{var u;return(u=d==null?void 0:d.chapters.nodes)!=null?u:[]},[d==null?void 0:d.chapters.nodes]),g=x.useMemo(()=>l.map(u=>u.id),[l]),{areNoItemsSelected:m,areAllItemsSelected:p,selectedItemIds:c,handleSelectAll:j,handleSelection:k}=nt(l.length,{itemIds:g,currentKey:"default"}),I=x.useMemo(()=>ar(l,i),[l,i]),P=(W=(D=t.firstUnreadChapter)==null?void 0:D.sourceOrder)!=null?W:1,A=t.chapters.totalCount===((N=t.latestReadChapter)==null?void 0:N.sourceOrder),U=t.unreadCount===0,R=t.downloadCount===t.chapters.totalCount,O=l.length===0,G=!O&&I.length===0,T=x.useMemo(()=>I.map(u=>{const _=s==null?void 0:s.find(fe=>fe.chapter.sourceOrder===u.sourceOrder&&fe.chapter.manga.id===u.manga.id),Q=m?null:c.includes(u.id);return{chapter:u,downloadChapter:_,selected:Q}}),[s,c,I]),E=x.useMemo(()=>{const u=T.filter(_=>_.selected);return u.length?e.jsx(_t,{selectedItemsCount:u.length,title:"chapter.title",children:_=>e.jsx(Be,{selectedChapters:u,onClose:_})}):A?null:e.jsx(Yt,{chapterIndex:P,mangaId:t.id})},[T,A]);return b||O&&r?e.jsx(B,{sx:{justifyContent:"center",alignItems:"center",position:"relative",flexGrow:1},children:e.jsx(we,{})}):f?e.jsx(B,{sx:{justifyContent:"center",position:"relative",flexGrow:1},children:e.jsx(q,{message:a("global.error.label.failed_to_load_data"),messageExtra:f.message,retry:()=>h().catch(ve())})}):e.jsxs(e.Fragment,{children:[e.jsxs(B,{direction:"column",sx:{position:"relative"},children:[e.jsxs(cr,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(V,{variant:"h5",children:"".concat(I.length," ").concat(a("chapter.title",{count:I.length}))}),e.jsxs(B,{direction:"row",sx:{paddingRight:"24px"},children:[e.jsx($,{title:a("chapter.action.mark_as_read.add.label.action.current"),children:e.jsx(M,{disabled:U,onClick:()=>v.markAsRead(C.getChapters(C.getNonRead(T)),!0,t.id),children:e.jsx(oe,{})})}),e.jsx(te,{variant:"popover",popupId:"chapterlist-download-button",children:u=>e.jsxs(e.Fragment,{children:[e.jsx($,{title:a("chapter.action.download.add.label.action"),children:e.jsx(M,{disabled:R,...re(u),children:e.jsx(ke,{})})}),u.isOpen&&e.jsx(ye,{..._e(u),children:e.jsx(ot,{mangaIds:[t.id],closeMenu:u.close})})]})}),e.jsx(dr,{options:i,optionsDispatch:o}),e.jsx(wt,{areAllItemsSelected:p,areNoItemsSelected:m,onChange:u=>j(u,u?l.map(_=>_.id):[])})]})]}),O&&e.jsx(q,{message:a("chapter.error.label.no_chapter_found")}),G&&e.jsx(q,{message:a("chapter.error.label.no_matches")}),e.jsx(ur,{style:{height:"undefined",overflowY:window.innerWidth<900?"visible":"auto"},components:{Footer:()=>e.jsx(Ie,{sx:{paddingBottom:jt}})},totalCount:I.length,itemContent:u=>e.jsx(Jt,{...T[u],allChapters:l,showChapterNumber:i.showChapterNumber,onSelect:(_,Q)=>k(T[u].chapter.id,_,{selectRange:Q})}),useWindowScroll:window.innerWidth<900,overscan:window.innerHeight*.5})]}),E]})},mr=t=>{const[r,a]=x.useState(!1);return[x.useCallback(async()=>{a(!0),await Promise.all([z.getMangaFetch(t,{awaitRefetchQueries:!0}).response,z.getMangaChaptersFetch(t,{awaitRefetchQueries:!0}).response]).finally(()=>a(!1))},[t]),{loading:r}]},he=({children:t,...r})=>e.jsx(Ae,{...r,children:e.jsx(B,{direction:"row",alignItems:"center",justifyContent:"center",gap:"10px",flexWrap:"wrap",children:t})});var me={},fr=F;Object.defineProperty(me,"__esModule",{value:!0});var De=me.default=void 0,pr=fr(L()),gr=e;De=me.default=(0,pr.default)((0,gr.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");const xr=({manga:t})=>{var b,f;const{t:r}=w(),a=Oe(),n=z.useGetTrackerList(),s=t.trackRecords.nodes,i=Z.getLoggedIn((f=(b=n.data)==null?void 0:b.trackers.nodes)!=null?f:[]),o=Z.getLoggedIn(Z.getTrackers(s)),d=h=>{if(n.error){Me(r("tracking.error.label.could_not_load_track_info"),"error");return}if(!i.length){a("/settings/trackingSettings");return}h()};return e.jsx(te,{variant:"dialog",popupId:"manga-track-modal",children:h=>e.jsxs(e.Fragment,{children:[e.jsxs(he,{...re(h),disabled:n.loading||!!n.error,onClick:()=>d(h.open),onTouchStart:()=>d(h.open),size:"large",sx:{color:o.length?"#2196f3":"inherit"},children:[o.length?e.jsx(De,{}):e.jsx($t,{}),o.length?r("manga.button.track.active",{count:o.length}):r("manga.button.track.start")]}),e.jsx(Ne,{...ze(h),maxWidth:"md",fullWidth:!0,scroll:"paper",children:e.jsx(lt,{manga:t})})]})})},br=y("div")(({theme:t})=>({width:"100%",[t.breakpoints.up("md")]:{position:"sticky",top:"64px",left:"0px",width:"50vw",height:"calc(100vh - 64px)",alignSelf:"flex-start",overflowY:"auto"}})),jr=y("div")(()=>({padding:"10px"})),kr=y("div")(()=>({display:"flex"})),vr=y("div")(()=>({"& img":{borderRadius:4,maxWidth:"100%",minWidth:"100%",height:"auto"},maxWidth:"50%"})),Cr=y("div")(({theme:t})=>({marginLeft:15,maxWidth:"100%","& span":{fontWeight:"400"},[t.breakpoints.up("lg")]:{fontSize:"1.3em"}})),_r=y("div")(({theme:t})=>({display:"flex",justifyContent:"space-around","& button, a":{borderRadius:"25px",textTransform:"none",paddingLeft:"20px",paddingRight:"20px",fontSize:"x-large",[t.breakpoints.down("sm")]:{fontSize:"larger"}}})),wr=y("div")(({theme:t})=>({paddingLeft:"10px",paddingRight:"10px",[t.breakpoints.up("md")]:{fontSize:"1.2em"},[t.breakpoints.up("lg")]:{fontSize:"1.3em"}})),yr=y("div")(()=>({"& h4":{marginTop:"1em",marginBottom:0},"& p":{textAlign:"justify",textJustify:"inter-word"}})),Ir=y("div")(()=>({display:"flex",flexWrap:"wrap","& h5":{border:"2px solid #2196f3",borderRadius:"1.13em",marginRight:"1em",marginTop:0,marginBottom:"10px",padding:"0.3em",color:"#2196f3"}})),Mr=({url:t})=>{const{t:r}=w(),a=x.useMemo(()=>e.jsxs(he,{size:"large",disabled:!t,sx:{color:"inherit"},component:Tt,href:t!=null?t:void 0,target:"_blank",rel:"noreferrer",children:[e.jsx(ue,{}),r("global.button.open_site")]}),[t]);return a};function Rr(t){var r;return t?(r=t.displayName)!=null?r:t.id:ae("global.label.unknown")}function je(t){return t||"UNKNOWN"}const Sr=({manga:t})=>{const{t:r}=w();x.useEffect(()=>{t.source||Me(ae("source.error.label.source_not_found"),"error")},[t.source]);const{CategorySelectComponent:a,updateLibraryState:n}=it(t);return e.jsxs(e.Fragment,{children:[e.jsxs(br,{children:[e.jsxs(jr,{children:[e.jsxs(kr,{children:[e.jsx(vr,{children:e.jsx(St,{src:Rt.getThumbnailUrl(t),alt:"Manga Thumbnail"})}),e.jsxs(Cr,{children:[e.jsx("h1",{children:t.title}),e.jsxs("h3",{children:["".concat(r("manga.label.author"),": "),e.jsx("span",{children:je(t.author)})]}),e.jsxs("h3",{children:["".concat(r("manga.label.artist"),": "),e.jsx("span",{children:je(t.artist)})]}),e.jsx("h3",{children:"".concat(r("manga.label.status"),": ").concat(t.status)}),e.jsx("h3",{children:"".concat(r("source.title"),": ").concat(Rr(t.source))})]})]}),e.jsxs(_r,{children:[e.jsxs(he,{onClick:n,size:"large",sx:{color:t.inLibrary?"#2196f3":"inherit"},children:[t.inLibrary?e.jsx(Mt,{}):e.jsx(dt,{}),t.inLibrary?r("manga.button.in_library"):r("manga.button.add_to_library")]}),e.jsx(xr,{manga:t}),e.jsx(Mr,{url:t.realUrl})]})]}),e.jsxs(wr,{children:[e.jsxs(yr,{children:[e.jsx("h4",{children:r("settings.about.title")}),e.jsx("p",{style:{whiteSpace:"pre-line"},children:t.description})]}),e.jsx(Ir,{children:t.genre.map(s=>e.jsx("h5",{children:s},s))})]})]}),a]})},$r=({manga:t,onRefresh:r,refreshing:a})=>{var g,m;const{t:n}=w(),s=Ce(),i=Pe(s.breakpoints.up("sm")),[o,d]=We.useState(null),b=!!o,f=()=>{d(null)},{openCategorySelect:h,CategorySelectComponent:l}=ct({mangaId:t.id});return e.jsxs(e.Fragment,{children:[i&&e.jsxs(e.Fragment,{children:[e.jsx($,{title:n("manga.label.reload_from_source"),children:e.jsx(M,{onClick:()=>{r()},disabled:a,children:e.jsx(pe,{})})}),t.inLibrary&&e.jsxs(e.Fragment,{children:[e.jsx($,{title:n("global.button.migrate"),children:e.jsx(H,{to:"/migrate/source/".concat((g=t.source)==null?void 0:g.id,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:e.jsx(M,{children:e.jsx(ge,{})})})}),e.jsx($,{title:n("manga.label.edit_categories"),children:e.jsx(M,{onClick:()=>{h(!0)},children:e.jsx(xe,{})})})]})]}),!i&&e.jsxs(e.Fragment,{children:[e.jsx(M,{id:"chaptersMenuButton","aria-controls":b?"chaptersMenu":void 0,"aria-haspopup":"true","aria-expanded":b?"true":void 0,onClick:p=>d(p.currentTarget),children:e.jsx(yt,{})}),e.jsxs(ye,{id:"chaptersMenu",anchorEl:o,open:b,onClose:f,MenuListProps:{"aria-labelledby":"chaptersMenuButton"},children:[e.jsxs(J,{onClick:()=>{r(),f()},disabled:a,children:[e.jsx(Y,{children:e.jsx(pe,{fontSize:"small"})}),e.jsx(X,{children:n("manga.label.reload_from_source")})]}),t.inLibrary&&[e.jsxs(J,{component:H,to:"/migrate/source/".concat((m=t.source)==null?void 0:m.id,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:[e.jsx(Y,{children:e.jsx(ge,{fontSize:"small"})}),e.jsx(X,{children:n("migrate.title")})]},"migrate"),e.jsxs(J,{onClick:()=>{h(!0),f()},children:[e.jsx(Y,{children:e.jsx(xe,{fontSize:"small"})}),e.jsx(X,{children:n("manga.label.edit_categories")})]},"categories")]]})]}),l]})},ua=()=>{const{t}=w(),{setTitle:r,setAction:a}=x.useContext(Ee),{id:n}=Ve(),s=x.useRef(!1),{data:i,error:o,loading:d,networkStatus:b,refetch:f}=z.useGetManga(n),h=Ue(b),l=i==null?void 0:i.manga,[g,{loading:m}]=mr(n);return qe("library"),x.useEffect(()=>{if(l==null)return;!s.current&&!l.initialized&&(s.current=!0,g())},[l]),x.useEffect(()=>{var p;return r((p=l==null?void 0:l.title)!=null?p:t("manga.title")),a(null),()=>{r(""),a(null)}},[t,l==null?void 0:l.title]),x.useEffect(()=>{var p;return a(e.jsxs(B,{direction:"row",alignItems:"center",children:[o&&!h&&!m&&e.jsx($,{title:e.jsxs(e.Fragment,{children:[t("manga.error.label.request_failure"),e.jsx("br",{}),(p=o.message)!=null?p:o]}),children:e.jsx(M,{onClick:()=>f(),children:e.jsx(Re,{color:"error"})})}),l&&(m||h)&&e.jsx(M,{disabled:!0,children:e.jsx(He,{size:16})}),l&&e.jsx($r,{manga:l,onRefresh:g,refreshing:m})]})),()=>{a(null)}},[t,o,h,m,l,g]),o&&!l?e.jsx(q,{message:t("manga.error.label.request_failure"),messageExtra:o.message}):e.jsxs(Ie,{sx:{display:{md:"flex"},overflow:"hidden"},children:[d&&e.jsx(we,{}),l&&e.jsx(Sr,{manga:l}),l&&e.jsx(hr,{manga:l,isRefreshing:m})]})};export{ua as Manga};
