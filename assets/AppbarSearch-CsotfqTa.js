import{aM as U,c as p,aN as T,r as F,i as I,j as k,u as q,a7 as A,R as z,f as G,I as $}from"./index-Zl59rTnr.js";import{S as W}from"./useManageMangaLibraryState-CawoFeDt.js";function L(e,t){if(e==null)return e;if(e.length===0&&(!t||t&&e!==""))return null;const r=e instanceof Array?e[0]:e;return r==null?r:!t&&r===""?null:r}function B(e){return e==null?e:String(e)}function H(e){const t=L(e);return t==null?t:t===""?null:+t}function J(e){return e==null?e:String(e)}function X(e){const t=L(e,!0);return t==null?t:String(t)}const w={encode:J,decode:X},ke={encode:B,decode:H};function Y(e,t){const r={},n=Object.keys(t);for(const s of n){const a=t[s];e[s]?r[s]=e[s].encode(t[s]):r[s]=a==null?a:String(a)}return r}class Z{constructor(){this.paramsMap=new Map,this.registeredParams=new Map}set(t,r,n,s){this.paramsMap.set(t,{stringified:r,decoded:n,decode:s})}has(t,r,n){if(!this.paramsMap.has(t))return!1;const s=this.paramsMap.get(t);return s?s.stringified===r&&(n==null||s.decode===n):!1}get(t){var r;if(this.paramsMap.has(t))return(r=this.paramsMap.get(t))==null?void 0:r.decoded}registerParams(t){for(const r of t){const n=this.registeredParams.get(r)||0;this.registeredParams.set(r,n+1)}}unregisterParams(t){for(const r of t){const n=(this.registeredParams.get(r)||0)-1;n<=0?(this.registeredParams.delete(r),this.paramsMap.has(r)&&this.paramsMap.delete(r)):this.registeredParams.set(r,n)}}clear(){this.paramsMap.clear(),this.registeredParams.clear()}}const b=new Z;function ee(e,t){var r,n,s;const a={};let c=!1;const o=Object.keys(e);let i=o;if(t.includeKnownParams||t.includeKnownParams!==!1&&o.length===0){const f=Object.keys((r=t.params)!=null?r:{});i.push(...f)}for(const f of i){const u=e[f];if(u!=null&&typeof u=="object"){a[f]=u;continue}c=!0,a[f]=(s=(n=t.params)==null?void 0:n[f])!=null?s:w}return c?a:e}function Q(e,t,r,n){var s;if(!r||!t.length)return e;let a={...e},c=!1;for(const o of t)Object.prototype.hasOwnProperty.call(a,o)||(a[o]=(s=r[o])!=null?s:n,c=!0);return c?a:e}const te=Object.prototype.hasOwnProperty;function _(e,t){return e===t?e!==0||t!==0||1/e===1/t:e!==e&&t!==t}function C(e,t,r){var n,s;if(_(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const a=Object.keys(e),c=Object.keys(t);if(a.length!==c.length)return!1;for(let o=0;o<a.length;o++){const i=(s=(n=r==null?void 0:r[a[o]])==null?void 0:n.equals)!=null?s:_;if(!te.call(t,a[o])||!i(e[a[o]],t[a[o]]))return!1}return!0}function x(e,t,r){const n={},s=Object.keys(t);for(const a of s){const c=t[a],o=e[a];let i;if(r.has(a,o,c.decode))i=r.get(a);else{if(i=c.decode(o),c.equals&&r.has(a,o)){const l=r.get(a);c.equals(i,l)&&(i=l)}i!==void 0&&r.set(a,o,i,c.decode)}i===void 0&&c.default!==void 0&&(i=c.default),n[a]=i}return n}function re(){let e;function t(r,n,s){const a=x(r,n,s);return e!=null&&C(e,a)?e:(e=a,a)}return t}function ne(e){let t;for(const r in e)if(e[r].urlName){const n=e[r].urlName,s="".concat(n,"\0").concat(r);t?t.push(s):t=[s]}return t?t.join("\n"):void 0}function ae(e){if(e)return Object.fromEntries(e.split("\n").map(t=>t.split("\0")))}function se(e,t){var r;let n={};for(const s in e)((r=t[s])==null?void 0:r.urlName)!=null?n[t[s].urlName]=e[s]:n[s]=e[s];return n}let D,E,K,N={};const V=(e,t,r)=>{if(D===t&&K===e&&E===r)return N;D=t,K=e;const n=e(t!=null?t:"");E=r;const s=ae(r);for(let[a,c]of Object.entries(n)){s!=null&&s[a]&&(delete n[a],a=s[a],n[a]=c);const o=N[a];C(c,o)&&(n[a]=o)}return N=n,n};function oe(e,t){var r;for(const n in e)((r=t[n])==null?void 0:r.default)!==void 0&&e[n]!==void 0&&t[n].encode(t[n].default)===e[n]&&(e[n]=void 0)}function ce({changes:e,updateType:t,currentSearchString:r,paramConfigMap:n,options:s}){const{searchStringToObject:a,objectToSearchString:c}=s;t==null&&(t=s.updateType);let o;const i=V(a,r),l=Q(n,Object.keys(e),s.params);let f;if(typeof e=="function"){const m=x(i,l,b);f=e(m)}else f=e;o=Y(l,f),s.removeDefaultsFromUrl&&oe(o,l),o=se(o,l);let u;return t==="push"||t==="replace"?u=c(o):u=c({...i,...o}),u!=null&&u.length&&u[0]!=="?"&&(u="?".concat(u)),u!=null?u:""}function ie({searchString:e,adapter:t,navigate:r,updateType:n}){const a={...t.location,search:e};r&&(typeof n=="string"&&n.startsWith("replace")?t.replace(a):t.push(a))}const ue=e=>e(),le=e=>setTimeout(()=>e(),0),O=[];function fe(e,{immediate:t}={}){O.push(e);let r=t?ue:le;O.length===1&&r(()=>{const n=O.slice();O.length=0;const s=n[0].currentSearchString;let a;for(let c=0;c<n.length;++c){const o=c===0?n[c]:{...n[c],currentSearchString:a};a=ce(o)}e.options.skipUpdateWhenNoChange&&a===s||ie({searchString:a!=null?a:"",adapter:n[n.length-1].adapter,navigate:!0,updateType:n[n.length-1].updateType})})}function de(e,t){const{adapter:r,options:n}=U(),[s]=p.useState(re),{paramConfigMap:a,options:c}=me(e,t),o=p.useMemo(()=>T(n,c),[n,c]);let i=ee(a,o);const l=V(o.searchStringToObject,r.location.search,ne(i));o.includeAllParams&&(i=Q(i,Object.keys(l),o.params,w));const f=s(l,i,b),u=Object.keys(i).join("\0");p.useEffect(()=>{const y=u.split("\0");return b.registerParams(y),()=>{b.unregisterParams(y)}},[u]);const m={adapter:r,paramConfigMap:i,options:o},h=p.useRef(m);h.current==null&&(h.current=m),p.useEffect(()=>{h.current.adapter=r,h.current.paramConfigMap=i,h.current.options=o},[r,i,o]);const[g]=p.useState(()=>(j,P)=>{const{adapter:v,paramConfigMap:d,options:S}=h.current;P==null&&(P=S.updateType),fe({changes:j,updateType:P,currentSearchString:v.location.search,paramConfigMap:d,options:S,adapter:v},{immediate:!S.enableBatching})});return[f,g]}var pe=de;function me(e,t){let r,n;return e===void 0?(r={},n=t):Array.isArray(e)?(r=Object.fromEntries(e.map(s=>[s,"inherit"])),n=t):(r=e,n=t),{paramConfigMap:r,options:n}}const he=(e,t,r)=>{const n=p.useMemo(()=>({[e]:t!=null?t:"inherit"}),[e,t]),[s,a]=pe(n,r),c=s[e],o=p.useCallback((i,l)=>a(typeof i=="function"?f=>{const u=i(f[e]);return{[e]:u}}:{[e]:i},l),[e,a]);return[c,o]};var M={},ge=I;Object.defineProperty(M,"__esModule",{value:!0});var R=M.default=void 0,ve=ge(F()),Se=k;R=M.default=(0,ve.default)((0,Se.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");const Oe=e=>{const{isClosable:t=!0}=e,{t:r}=q(),[n,s]=p.useState(),a=A(),[c,o]=he("query",w),[i,l]=p.useState(!t||!!c),f=z.useRef(),[u,m]=p.useState(c!=null?c:"");n!==a.key&&(s(a.key),m(c!=null?c:""),l(!t||!!c));const h=i||!!c,g=d=>{var S;t&&(l(d),d&&((S=f.current)==null||S.focus()))};function y(d){d!==""&&(o(d),g(!1))}const j=()=>{m(""),o(void 0),g(!1)},P=()=>{u||g(!1)},v=d=>{(d.key==="F3"||d.ctrlKey&&d.key==="f")&&(d.preventDefault(),g(!0))};return p.useEffect(()=>(window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}),[v]),h?k.jsx(W,{autoFocus:!0,variant:"standard",value:u,onCancel:j,onChange:d=>m(d.target.value),onKeyDown:d=>{d.key==="Enter"&&y(u)},onBlur:P,inputRef:f}):k.jsx(G,{title:r("search.title.search"),children:k.jsx($,{onClick:()=>g(!0),children:k.jsx(R,{})})})};export{Oe as A,ke as N,w as S,R as d,he as u};
