import{c as at,j as s,u as F,_ as N,L as Z,$ as Zt,i as vt,a0 as te,e as _,J as ee,K as re,a1 as ne,C as V,I as D,a2 as Ot,a3 as _t,a4 as Ht,a5 as ie,t as se,a6 as wt,E as Pt,r as q,a7 as ae,X as O,S as k,h as Nt,g as tt,Z as z,T as et,p as zt,a8 as Wt,m as rt,a9 as oe,aa as le,B as ce,f as ue,N as he,l as de,ab as ge,A as nt,d as fe,ac as it,P as me,ad as mt,ae as pe,af as Bt,ag as be,ah as xe,ai as ve,aj as _e,ak as Ce,a as we,al as je,am as Me,an as ye,ao as jt,ap as Le,aq as lt,ar as ct,as as ut,at as ke,au as Ie,av as Se,aw as Te}from"./index-N2KlV0av.js";import{P as De}from"./PlayArrow-DiLfKCRZ.js";import{S as Ee,D as Ae}from"./StyledFab-B6oU9v4L.js";import{E as K}from"./EmptyViewAbsoluteCentered-C-ieOCBn.js";import{F as Re}from"./FilterList-wQqFr0Lm.js";import{D as Ve}from"./Download-DDYAj0A0.js";import{D as Fe}from"./DoneAll-D3XCteUQ.js";import{S as Oe,R as Mt}from"./SortRadioInput-CgBCJMLH.js";import{T as ht}from"./ThreeStateCheckboxInput-DKpappyc.js";import{O as He,S as Pe,a as Ne}from"./SelectionFAB-BshDEz8t.js";import{R as ze}from"./ListPreference-DDue1aKx.js";import{C as We,T as Be,M as Ge,p as qe,s as Ue,S as yt,L as Lt}from"./ChaptersDownloadActionMenuItems-tuKcoALG.js";import{u as $e,a as Qe,F as Xe,b as Ye}from"./useManageMangaLibraryState-Di9m2aVX.js";import{C as Je,a as Ke,b as Ze,L as tr}from"./CustomButtonIcon-qhVYIMTA.js";import{V as er}from"./VirtuosoPersisted-DKihgC1S.js";import{F as rr}from"./Favorite-BkWAkrmU.js";import{E as nr,a as ir}from"./ExpandMore-msBiDy6a.js";import{S as sr}from"./Sync-Dr_-rxOu.js";import{T as dt}from"./Trackers-D4pSmk7a.js";import{S as ar}from"./Sources-TFJwJ8A4.js";import{L as Gt}from"./Link-D22D_gCx.js";import{C as or}from"./Chip-D7nNR2Nq.js";import{u as lr}from"./useAppTitleAndAction-Qhrh_BkB.js";import"./Checkbox-DYjBAZGb.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-Duzwmpsm.js";import"./SwitchBase-UsGD7FS6.js";import"./Tabs-CMQ_ozaX.js";import"./FormGroup-DT_NyV1j.js";import"./Card-ClSl2UAy.js";import"./ListCardContent-CoynPlVh.js";import"./Avatar-C3J2UaiB.js";import"./TextField-CTksBse0.js";import"./InputAdornment-Cv5HSwPc.js";import"./CheckCircle-D5F9cyCZ.js";import"./index-vvcQFnCy.js";import"./CardActionArea-DNWiv-Nz.js";import"./NumberSetting-6185Izzy.js";import"./Slider-C6GgYjGn.js";import"./useMobilePicker-C-osmVmg.js";import"./SelectSetting-BbYpK0sr.js";import"./Select-D8q08aMn.js";import"./CheckboxInput-CONW3GzG.js";import"./ChapterCardMetadata-B38JLTwx.js";import"./Delete-D1V5RDTd.js";import"./Virtuoso.util-yZ1KuQeE.js";import"./use-merged-ref-DQQPRP4g.js";import"./useAppTitle-ZPuGx_MD.js";import"./useAppAction-V9q1xf-c.js";const cr=at(s.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}));function ur({chapter:e}){const{t}=F(),{sourceOrder:r}=e;return s.jsxs(Ee,{component:Z,variant:"extended",color:"primary",to:N.getReaderUrl(e),state:N.getReaderOpenChapterLocationState(e),children:[s.jsx(De,{}),t(r===1?"global.button.start":"global.button.resume")]})}const hr={...te},qt=e=>({...e}),dr=e=>({...e}),gr=(e,t=hr,r)=>dr(re("manga",e,qt(t),void 0,r)),fr=(e,t,r)=>gr({...e,meta:ee(e.meta)},t,r),mr=(e,t)=>{const r=fr(e,t,_.useEffect);return _.useMemo(()=>r,[e,t])},pr=async(e,t,r)=>Zt(e,[[t,qt({[t]:r})[t]]]),br=(e,t=vt())=>(r,n)=>pr(e,r,n).catch(t);function xr(e,{isRead:t}){switch(e){case!0:return!t;case!1:return t;default:return!0}}function vr(e,{isDownloaded:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function _r(e,{isBookmarked:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}const Cr=(e,{sortBy:t,reverse:r})=>{const n=[...e];switch(t){case"source":n.sort((i,a)=>i.sourceOrder-a.sourceOrder);break;case"fetchedAt":n.sort((i,a)=>{var o,l;return Number((o=i.fetchedAt)!=null?o:0)-Number((l=a.fetchedAt)!=null?l:0)});break;case"chapterNumber":n.sort((i,a)=>i.chapterNumber-a.chapterNumber);break;case"uploadedAt":n.sort((i,a)=>{var o,l;return Number((o=i.uploadDate)!=null?o:0)-Number((l=a.uploadDate)!=null?l:0)});break}return r&&n.reverse(),n};function wr(e,t){const r=e.filter(n=>xr(t.unread,n)&&vr(t.downloaded,n)&&_r(t.bookmarked,n));return Cr(r,t)}const jr=e=>{const{unread:t,downloaded:r,bookmarked:n}=e;return t!=null||r!=null||n!=null},Mr=e=>{const{unread:t,downloaded:r,bookmarked:n,reverse:i,sortBy:a,showChapterNumber:o}=mr(e);return _.useMemo(()=>({unread:t,downloaded:r,bookmarked:n,reverse:i,sortBy:a,showChapterNumber:o}),[t,r,n,i,a,o])},yr=(e,t=vt())=>br(e,t),Lr={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},kr=({open:e,onClose:t,options:r,updateOption:n})=>{const{t:i}=F();return s.jsx(He,{open:e,onClose:t,minHeight:150,tabs:["filter","sort","display"],tabTitle:a=>i(Lr[a]),tabContent:a=>a==="filter"?s.jsxs(s.Fragment,{children:[s.jsx(ht,{label:i("global.filter.label.unread"),checked:r.unread,onChange:o=>n("unread",o)}),s.jsx(ht,{label:i("global.filter.label.downloaded"),checked:r.downloaded,onChange:o=>n("downloaded",o)}),s.jsx(ht,{label:i("global.filter.label.bookmarked"),checked:r.bookmarked,onChange:o=>n("bookmarked",o)})]}):a==="sort"?Object.entries(ne).map(([o,l])=>s.jsx(Oe,{label:i(l),checked:r.sortBy===o,sortDescending:r.reverse,onClick:()=>o!==r.sortBy?n("sortBy",o):n("reverse",!r.reverse)},o)):a==="display"?s.jsxs(ze,{onChange:()=>n("showChapterNumber",!r.showChapterNumber),value:r.showChapterNumber,children:[s.jsx(Mt,{label:i("chapter.option.display.label.source_title"),value:!1}),s.jsx(Mt,{label:i("chapter.option.display.label.chapter_number"),value:!0})]}):null})},Ir=({mangaId:e,areAllChaptersRead:t,areAllChaptersDownloaded:r,options:n,updateOption:i,unreadChapters:a})=>{const{t:o}=F(),[l,c]=_.useState(!1),u=jr(n);return s.jsxs(s.Fragment,{children:[s.jsx(V,{title:o("chapter.action.mark_as_read.add.label.action.current"),disabled:t,children:s.jsx(D,{disabled:t,onClick:()=>N.markAsRead(a,!0,e),color:"inherit",children:s.jsx(Fe,{})})}),s.jsx(Ot,{variant:"popover",popupId:"chapterlist-download-button",children:h=>s.jsxs(s.Fragment,{children:[s.jsx(V,{title:o("chapter.action.download.add.label.action"),disabled:t,children:s.jsx(D,{disabled:r,..._t(h),color:"inherit",children:s.jsx(Ve,{})})}),h.isOpen&&s.jsx(Ht,{...ie(h),children:s.jsx(We,{mangaIds:[e],closeMenu:h.close})})]})}),s.jsx(V,{title:o("settings.title"),children:s.jsx(D,{onClick:()=>c(!0),color:"inherit",children:s.jsx(Re,{color:u?"warning":void 0})})}),s.jsx(kr,{open:l,onClose:()=>c(!1),options:n,updateOption:i})]})},Sr=z(k,{shouldForwardProp:Wt(["scrollbarWidth"])})(({theme:e,scrollbarWidth:t})=>({padding:e.spacing(1),paddingRight:"calc(".concat(t,"px + ").concat(e.spacing(1),")"),paddingBottom:0,[e.breakpoints.down("md")]:{paddingRight:e.spacing(1)}})),Tr=z(er,{shouldForwardProp:Wt(["topOffset"])})(({theme:e,topOffset:t})=>({listStyle:"none",padding:0,[e.breakpoints.up("md")]:{height:"calc(100vh - ".concat(t,"px)"),margin:0}})),Dr=({selectedChapters:e,firstUnreadChapter:t,onFABMenuClose:r})=>e.length?s.jsx(Ne,{selectedItemsCount:e.length,title:"chapter.title_one",children:n=>s.jsx(Ke,{selectedChapters:e,onClose:()=>{r==null||r(),n()}})}):t?s.jsx(ur,{chapter:t}):null,Er=({manga:e,isRefreshing:t})=>{const{t:r}=F(),{appBarHeight:n}=se(),i=wt.useIsBelowWidth("md"),[a,o]=_.useState(50),[l,c]=_.useState(null);Pt(l,_.useCallback(()=>{var C;return o((C=l==null?void 0:l.offsetHeight)!=null?C:0)},[l]));const u=wt.useGetScrollbarSize("width"),h=Mr(e),d=yr(e,C=>rt(r("global.error.label.failed_to_save_changes"),"error",tt(C))),{data:g,loading:m,error:f,refetch:p}=q.useGetMangaChapters(ae,e.id,{notifyOnNetworkStatusChange:!0}),b=_.useMemo(()=>{var C;return(C=g==null?void 0:g.chapters.nodes)!=null?C:[]},[g==null?void 0:g.chapters.nodes]),v=_.useMemo(()=>wr(b,h),[b,h]),w=_.useMemo(()=>N.getIds(v),[v]),A=O.isFullyRead(e),L=O.isFullyDownloaded(e),S=_.useMemo(()=>N.getMissingCount(v),[v]),x=b.length===0,j=!x&&v.length===0,{areNoItemsSelected:M,areAllItemsSelected:I,selectedItemIds:y,handleSelectAll:$,handleSelection:W,clearSelection:Q}=$e(w.length,{itemIds:w,currentKey:"default"}),X=_.useCallback((C,ot,Kt)=>W(C,ot,{selectRange:Kt}),[W]);return m||x&&t?s.jsx(k,{sx:{justifyContent:"center",alignItems:"center",position:"relative",flexGrow:1},children:s.jsx(Nt,{})}):f?s.jsx(k,{sx:{justifyContent:"center",position:"relative",flexGrow:1},children:s.jsx(K,{message:r("global.error.label.failed_to_load_data"),messageExtra:tt(f),retry:()=>p().catch(vt())})}):s.jsxs(s.Fragment,{children:[s.jsxs(k,{direction:"column",sx:{position:"relative",flexBasis:"60%"},children:[s.jsxs(Sr,{ref:c,direction:"row",alignItems:"center",justifyContent:"space-between",scrollbarWidth:u,children:[s.jsxs(k,{children:[s.jsx(et,{variant:"h5",component:"h3",children:r("chapter.value",{count:v.length})}),!!S&&s.jsx(et,{variant:"body2",color:"warning",children:"".concat(r("chapter.missing",{count:S}))})]}),s.jsxs(k,{direction:"row",children:[M&&s.jsx(Ir,{mangaId:e.id,areAllChaptersDownloaded:L,areAllChaptersRead:A,options:h,updateOption:d,unreadChapters:N.getNonRead(b)}),!!w.length&&s.jsx(Pe,{areAllItemsSelected:I,areNoItemsSelected:M,onChange:C=>$(C,C?w:[])})]})]}),x&&s.jsx(K,{message:r("chapter.error.label.no_chapter_found")}),j&&s.jsx(K,{message:r("chapter.error.label.no_matches")}),s.jsx(Tr,{persistKey:"manga-".concat(e.id,"-chapter-list"),topOffset:n+a,style:{height:"undefined"},components:{Footer:()=>s.jsx(zt,{sx:{paddingBottom:Ae}})},totalCount:v.length,computeItemKey:C=>v[C].id,itemContent:C=>s.jsx(Je,{index:C,isSortDesc:h.reverse,chapters:v,selected:M?null:y.includes(v[C].id),showChapterNumber:h.showChapterNumber,onSelect:X}),useWindowScroll:i,overscan:window.innerHeight*.5})]}),s.jsx(Dr,{selectedChapters:y.map(C=>b.find(ot=>ot.id===C)).filter(C=>C!=null),firstUnreadChapter:e.firstUnreadChapter,onFABMenuClose:Q})]})},Ar=e=>{const[t,r]=_.useState(!1),[n,i]=_.useState(null);return[_.useCallback(async()=>{r(!0),i(null),await Promise.all([q.getMangaFetch(e,{awaitRefetchQueries:!0}).response,q.getMangaChaptersFetch(e,{awaitRefetchQueries:!0}).response]).catch(o=>{o instanceof oe&&le(o.message)==="no chapters found"||i(o)}).finally(()=>r(!1))},[e]),{loading:t,error:n}]},Rr=at(s.jsx("path",{d:"M21 11V3h-8l3.29 3.29-10 10L3 13v8h8l-3.29-3.29 10-10z"})),Vr=at(s.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}));class Fr{constructor(t,r){this.pixels=t,this.opts=r;const{sigBits:n}=r,i=(L,S,x)=>(L<<2*n)+(S<<n)+x;this.getColorIndex=i;const a=8-n,o=1<<3*n,l=new Uint32Array(o);let c,u,h,d,g,m,f,p,b,v;c=h=g=0,u=d=m=Number.MAX_VALUE;const w=t.length/4;let A=0;for(;A<w;){const L=A*4;if(A++,f=t[L+0],p=t[L+1],b=t[L+2],v=t[L+3],v===0)continue;f=f>>a,p=p>>a,b=b>>a;const S=i(f,p,b);l[S]===void 0&&(l[S]=0),l[S]+=1,f>c&&(c=f),f<u&&(u=f),p>h&&(h=p),p<d&&(d=p),b>g&&(g=b),b<m&&(m=b)}this._colorCount=l.reduce((L,S)=>S>0?L+1:L,0),this.hist=l,this.rmax=c,this.rmin=u,this.gmax=h,this.gmin=d,this.bmax=g,this.bmin=m}get colorCount(){return this._colorCount}}class Or{scaleDown(t){const r=this.getWidth(),n=this.getHeight();let i=1;if(t.maxDimension>0){const a=Math.max(r,n);a>t.maxDimension&&(i=t.maxDimension/a)}else i=1/t.quality;i<1&&this.resize(r*i,n*i,i)}}function Hr(e,t){var r;if(t.length>0){const n=e.data,i=n.length/4;let a,o,l,c,u;for(let h=0;h<i;h++){a=h*4,o=n[a+0],l=n[a+1],c=n[a+2],u=n[a+3];for(let d=0;d<t.length;d++)if(!((r=t[d])!=null&&r.call(t,o,l,c,u))){n[a+3]=0;break}}}return e}function Pr(e){const t=new URL(e,location.href);return t.protocol===location.protocol&&t.host===location.host&&t.port===location.port}function Nr(e,t){const r=new URL(e),n=new URL(t);return r.protocol===n.protocol&&r.hostname===n.hostname&&r.port===n.port}class zr extends Or{_getCanvas(){if(!this._canvas)throw new Error("Canvas is not initialized");return this._canvas}_getContext(){if(!this._context)throw new Error("Context is not initialized");return this._context}_getWidth(){if(!this._width)throw new Error("Width is not initialized");return this._width}_getHeight(){if(!this._height)throw new Error("Height is not initialized");return this._height}_initCanvas(){const t=this.image;if(!t)throw new Error("Image is not initialized");const r=this._canvas=document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new ReferenceError("Failed to create canvas context");this._context=n,r.className="@vibrant/canvas",r.style.display="none",this._width=r.width=t.width,this._height=r.height=t.height,n.drawImage(t,0,0),document.body.appendChild(r)}load(t){let r,n;if(typeof t=="string")r=document.createElement("img"),n=t,!Pr(n)&&!Nr(window.location.href,n)&&(r.crossOrigin="anonymous"),r.src=n;else if(t instanceof HTMLImageElement)r=t,n=t.src;else return Promise.reject(new Error("Cannot load buffer as an image in browser"));return this.image=r,new Promise((i,a)=>{const o=()=>{this._initCanvas(),i(this)};r.complete?o():(r.onload=o,r.onerror=l=>a(new Error("Fail to load image: ".concat(n))))})}clear(){this._getContext().clearRect(0,0,this._getWidth(),this._getHeight())}update(t){this._getContext().putImageData(t,0,0)}getWidth(){return this._getWidth()}getHeight(){return this._getHeight()}resize(t,r,n){if(!this.image)throw new Error("Image is not initialized");this._width=this._getCanvas().width=t,this._height=this._getCanvas().height=r,this._getContext().scale(n,n),this._getContext().drawImage(this.image,0,0)}getPixelCount(){return this._getWidth()*this._getHeight()}getImageData(){return this._getContext().getImageData(0,0,this._getWidth(),this._getHeight())}remove(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}}function U(e,...t){return t.forEach(r=>{if(r){for(const n in r)if(r.hasOwnProperty(n)){const i=r[n];Array.isArray(i)?e[n]=i.slice(0):typeof i=="object"?(e[n]||(e[n]={}),U(e[n],i)):e[n]=i}}}),e}function Wr(e,t){const{colorCount:r,quantizer:n,generators:i,filters:a}=e,o={colorCount:r},l=typeof n=="string"?{name:n,options:{}}:n;return l.options=U({},o,l.options),U({},{quantizer:l,generators:i,filters:a},t)}class Br{constructor(t,r={}){this._src=t,this._opts=U({},H.DefaultOpts,r)}maxColorCount(t){return this._opts.colorCount=t,this}maxDimension(t){return this._opts.maxDimension=t,this}addFilter(t){return this._opts.filters?this._opts.filters.push(t):this._opts.filters=[t],this}removeFilter(t){if(this._opts.filters){const r=this._opts.filters.indexOf(t);r>0&&this._opts.filters.splice(r)}return this}clearFilters(){return this._opts.filters=[],this}quality(t){return this._opts.quality=t,this}useImageClass(t){return this._opts.ImageClass=t,this}useGenerator(t,r){return this._opts.generators||(this._opts.generators=[]),this._opts.generators.push(r?{name:t,options:r}:t),this}useQuantizer(t,r){return this._opts.quantizer=r?{name:t,options:r}:t,this}build(){return new H(this._src,this._opts)}getPalette(){return this.build().getPalette()}}class gt{constructor(t){this.pipeline=t,this._map={}}names(){return Object.keys(this._map)}has(t){return!!this._map[t]}get(t){return this._map[t]}register(t,r){return this._map[t]=r,this.pipeline}}class Gr{constructor(){this.filter=new gt(this),this.quantizer=new gt(this),this.generator=new gt(this)}_buildProcessTasks({filters:t,quantizer:r,generators:n}){return n.length===1&&n[0]==="*"&&(n=this.generator.names()),{filters:t.map(a=>i(this.filter,a)),quantizer:i(this.quantizer,r),generators:n.map(a=>i(this.generator,a))};function i(a,o){let l,c;return typeof o=="string"?l=o:(l=o.name,c=o.options),{name:l,fn:a.get(l),options:c}}}async process(t,r){const{filters:n,quantizer:i,generators:a}=this._buildProcessTasks(r),o=await this._filterColors(n,t),l=await this._generateColors(i,o),c=await this._generatePalettes(a,l);return{colors:l,palettes:c}}_filterColors(t,r){return Promise.resolve(Hr(r,t.map(({fn:n})=>n)))}_generateColors(t,r){return Promise.resolve(t.fn(r.data,t.options))}async _generatePalettes(t,r){const n=await Promise.all(t.map(({fn:i,options:a})=>Promise.resolve(i(r,a))));return Promise.resolve(n.reduce((i,a,o)=>(i[t[o].name]=a,i),{}))}}function qr(e,t,r){return"#"+((1<<24)+(e<<16)+(t<<8)+r).toString(16).slice(1,7)}function Ur(e,t,r){e/=255,t/=255,r/=255;const n=Math.max(e,t,r),i=Math.min(e,t,r);let a=0,o=0;const l=(n+i)/2;if(n!==i){const c=n-i;switch(o=l>.5?c/(2-n-i):c/(n+i),n){case e:a=(t-r)/c+(t<r?6:0);break;case t:a=(r-e)/c+2;break;case r:a=(e-t)/c+4;break}a/=6}return[a,o,l]}function R(e,t,r){let n,i,a;function o(l,c,u){return u<0&&(u+=1),u>1&&(u-=1),u<1/6?l+(c-l)*6*u:u<1/2?c:u<2/3?l+(c-l)*(2/3-u)*6:l}if(t===0)n=i=a=r;else{const l=r<.5?r*(1+t):r+t-r*t,c=2*r-l;n=o(c,l,e+1/3),i=o(c,l,e),a=o(c,l,e-1/3)}return[n*255,i*255,a*255]}class T{static applyFilters(t,r){return r.length>0?t.filter(({r:n,g:i,b:a})=>{var o;for(let l=0;l<r.length;l++)if(!((o=r[l])!=null&&o.call(r,n,i,a,255)))return!1;return!0}):t}static clone(t){return new T(t._rgb,t._population)}get r(){return this._rgb[0]}get g(){return this._rgb[1]}get b(){return this._rgb[2]}get rgb(){return this._rgb}get hsl(){if(!this._hsl){const[t,r,n]=this._rgb;this._hsl=Ur(t,r,n)}return this._hsl}get hex(){if(!this._hex){const[t,r,n]=this._rgb;this._hex=qr(t,r,n)}return this._hex}get population(){return this._population}toJSON(){return{rgb:this.rgb,population:this.population}}getYiq(){if(!this._yiq){const t=this._rgb;this._yiq=(t[0]*299+t[1]*587+t[2]*114)/1e3}return this._yiq}get titleTextColor(){return this._titleTextColor||(this._titleTextColor=this.getYiq()<200?"#fff":"#000"),this._titleTextColor}get bodyTextColor(){return this._bodyTextColor||(this._bodyTextColor=this.getYiq()<150?"#fff":"#000"),this._bodyTextColor}constructor(t,r){this._rgb=t,this._population=r}}const Ut=class pt{constructor(t,r){this._src=t,this.opts=U({},pt.DefaultOpts,r)}static use(t){this._pipeline=t}static from(t){return new Br(t)}get result(){return this._result}_process(t,r){t.scaleDown(this.opts);const n=Wr(this.opts,r);return pt._pipeline.process(t.getImageData(),n)}async getPalette(){const t=new this.opts.ImageClass;try{const r=await t.load(this._src),n=await this._process(r,{generators:["default"]});this._result=n;const i=n.palettes.default;if(!i)throw new Error("Something went wrong and a palette was not found, please file a bug against our GitHub repo: https://github.com/vibrant-Colors/node-vibrant/");return t.remove(),i}catch(r){return t.remove(),Promise.reject(r)}}async getPalettes(){const t=new this.opts.ImageClass;try{const r=await t.load(this._src),n=await this._process(r,{generators:["*"]});this._result=n;const i=n.palettes;return t.remove(),i}catch(r){return t.remove(),Promise.reject(r)}}};Ut.DefaultOpts={colorCount:64,quality:5,filters:[]};let H=Ut;H.DefaultOpts.quantizer="mmcq";H.DefaultOpts.generators=["default"];H.DefaultOpts.filters=["default"];H.DefaultOpts.ImageClass=zr;const bt=5,ft=8-bt;class st{constructor(t,r,n,i,a,o,l){this.histogram=l,this._volume=-1,this._avg=null,this._count=-1,this.dimension={r1:t,r2:r,g1:n,g2:i,b1:a,b2:o}}static build(t){const r=new Fr(t,{sigBits:bt}),{rmin:n,rmax:i,gmin:a,gmax:o,bmin:l,bmax:c}=r;return new st(n,i,a,o,l,c,r)}invalidate(){this._volume=this._count=-1,this._avg=null}volume(){if(this._volume<0){const{r1:t,r2:r,g1:n,g2:i,b1:a,b2:o}=this.dimension;this._volume=(r-t+1)*(i-n+1)*(o-a+1)}return this._volume}count(){if(this._count<0){const{hist:t,getColorIndex:r}=this.histogram,{r1:n,r2:i,g1:a,g2:o,b1:l,b2:c}=this.dimension;let u=0;for(let h=n;h<=i;h++)for(let d=a;d<=o;d++)for(let g=l;g<=c;g++){const m=r(h,d,g);t[m]&&(u+=t[m])}this._count=u}return this._count}clone(){const{histogram:t}=this,{r1:r,r2:n,g1:i,g2:a,b1:o,b2:l}=this.dimension;return new st(r,n,i,a,o,l,t)}avg(){if(!this._avg){const{hist:t,getColorIndex:r}=this.histogram,{r1:n,r2:i,g1:a,g2:o,b1:l,b2:c}=this.dimension;let u=0;const h=1<<8-bt;let d,g,m;d=g=m=0;for(let f=n;f<=i;f++)for(let p=a;p<=o;p++)for(let b=l;b<=c;b++){const v=r(f,p,b),w=t[v];w&&(u+=w,d+=w*(f+.5)*h,g+=w*(p+.5)*h,m+=w*(b+.5)*h)}u?this._avg=[~~(d/u),~~(g/u),~~(m/u)]:this._avg=[~~(h*(n+i+1)/2),~~(h*(a+o+1)/2),~~(h*(l+c+1)/2)]}return this._avg}contains(t){let[r,n,i]=t;const{r1:a,r2:o,g1:l,g2:c,b1:u,b2:h}=this.dimension;return r>>=ft,n>>=ft,i>>=ft,r>=a&&r<=o&&n>=l&&n<=c&&i>=u&&i<=h}split(){const{hist:t,getColorIndex:r}=this.histogram,{r1:n,r2:i,g1:a,g2:o,b1:l,b2:c}=this.dimension,u=this.count();if(!u)return[];if(u===1)return[this.clone()];const h=i-n+1,d=o-a+1,g=c-l+1,m=Math.max(h,d,g);let f=null,p,b;p=b=0;let v=null;if(m===h){v="r",f=new Uint32Array(i+1);for(let x=n;x<=i;x++){p=0;for(let j=a;j<=o;j++)for(let M=l;M<=c;M++){const I=r(x,j,M);t[I]&&(p+=t[I])}b+=p,f[x]=b}}else if(m===d){v="g",f=new Uint32Array(o+1);for(let x=a;x<=o;x++){p=0;for(let j=n;j<=i;j++)for(let M=l;M<=c;M++){const I=r(j,x,M);t[I]&&(p+=t[I])}b+=p,f[x]=b}}else{v="b",f=new Uint32Array(c+1);for(let x=l;x<=c;x++){p=0;for(let j=n;j<=i;j++)for(let M=a;M<=o;M++){const I=r(j,M,x);t[I]&&(p+=t[I])}b+=p,f[x]=b}}let w=-1;const A=new Uint32Array(f.length);for(let x=0;x<f.length;x++){const j=f[x];j&&(w<0&&j>b/2&&(w=x),A[x]=b-j)}const L=this;function S(x){const j=x+"1",M=x+"2",I=L.dimension[j];let y=L.dimension[M];const $=L.clone(),W=L.clone(),Q=w-I,X=y-w;for(Q<=X?(y=Math.min(y-1,~~(w+X/2)),y=Math.max(0,y)):(y=Math.max(I,~~(w-1-Q/2)),y=Math.min(L.dimension[M],y));!f[y];)y++;let C=A[y];for(;!C&&f[y-1];)C=A[--y];return $.dimension[M]=y,W.dimension[j]=y+1,[$,W]}return S(v)}}class kt{_sort(){this._sorted||(this.contents.sort(this._comparator),this._sorted=!0)}constructor(t){this._comparator=t,this.contents=[],this._sorted=!1}push(t){this.contents.push(t),this._sorted=!1}peek(t){return this._sort(),t=typeof t=="number"?t:this.contents.length-1,this.contents[t]}pop(){return this._sort(),this.contents.pop()}size(){return this.contents.length}map(t){return this._sort(),this.contents.map(t)}}const $r=.75;function It(e,t){let r=e.size();for(;e.size()<t;){const n=e.pop();if(n&&n.count()>0){const[i,a]=n.split();if(!i||(e.push(i),a&&a.count()>0&&e.push(a),e.size()===r))break;r=e.size()}else break}}const Qr=(e,t)=>{if(e.length===0||t.colorCount<2||t.colorCount>256)throw new Error("Wrong MMCQ parameters");const r=st.build(e);r.histogram.colorCount;const n=new kt((a,o)=>a.count()-o.count());n.push(r),It(n,$r*t.colorCount);const i=new kt((a,o)=>a.count()*a.volume()-o.count()*o.volume());return i.contents=n.contents,It(i,t.colorCount-i.size()),Xr(i)};function Xr(e){const t=[];for(;e.size();){const r=e.pop(),n=r.avg();t.push(new T(n,r.count()))}return t}const Yr={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function Jr(e){let t=0;return e.forEach(r=>{t=Math.max(t,r.population)}),t}function Kr(e,t){return e.Vibrant===t||e.DarkVibrant===t||e.LightVibrant===t||e.Muted===t||e.DarkMuted===t||e.LightMuted===t}function Zr(e,t,r,n,i,a,o){function l(...u){let h=0,d=0;for(let g=0;g<u.length;g+=2){const m=u[g],f=u[g+1];!m||!f||(h+=m*f,d+=f)}return h/d}function c(u,h){return 1-Math.abs(u-h)}return l(c(e,t),o.weightSaturation,c(r,n),o.weightLuma,i/a,o.weightPopulation)}function P(e,t,r,n,i,a,o,l,c,u){let h=null,d=0;return t.forEach(g=>{const[,m,f]=g.hsl;if(m>=l&&m<=c&&f>=i&&f<=a&&!Kr(e,g)){const p=Zr(m,o,f,n,g.population,r,u);(h===null||p>d)&&(h=g,d=p)}}),h}function tn(e,t,r){const n={Vibrant:null,DarkVibrant:null,LightVibrant:null,Muted:null,DarkMuted:null,LightMuted:null};return n.Vibrant=P(n,e,t,r.targetNormalLuma,r.minNormalLuma,r.maxNormalLuma,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.LightVibrant=P(n,e,t,r.targetLightLuma,r.minLightLuma,1,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.DarkVibrant=P(n,e,t,r.targetDarkLuma,0,r.maxDarkLuma,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.Muted=P(n,e,t,r.targetNormalLuma,r.minNormalLuma,r.maxNormalLuma,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n.LightMuted=P(n,e,t,r.targetLightLuma,r.minLightLuma,1,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n.DarkMuted=P(n,e,t,r.targetDarkLuma,0,r.maxDarkLuma,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n}function en(e,t,r){if(!e.Vibrant&&!e.DarkVibrant&&!e.LightVibrant){if(!e.DarkVibrant&&e.DarkMuted){let[n,i,a]=e.DarkMuted.hsl;a=r.targetDarkLuma,e.DarkVibrant=new T(R(n,i,a),0)}if(!e.LightVibrant&&e.LightMuted){let[n,i,a]=e.LightMuted.hsl;a=r.targetDarkLuma,e.DarkVibrant=new T(R(n,i,a),0)}}if(!e.Vibrant&&e.DarkVibrant){let[n,i,a]=e.DarkVibrant.hsl;a=r.targetNormalLuma,e.Vibrant=new T(R(n,i,a),0)}else if(!e.Vibrant&&e.LightVibrant){let[n,i,a]=e.LightVibrant.hsl;a=r.targetNormalLuma,e.Vibrant=new T(R(n,i,a),0)}if(!e.DarkVibrant&&e.Vibrant){let[n,i,a]=e.Vibrant.hsl;a=r.targetDarkLuma,e.DarkVibrant=new T(R(n,i,a),0)}if(!e.LightVibrant&&e.Vibrant){let[n,i,a]=e.Vibrant.hsl;a=r.targetLightLuma,e.LightVibrant=new T(R(n,i,a),0)}if(!e.Muted&&e.Vibrant){let[n,i,a]=e.Vibrant.hsl;a=r.targetMutesSaturation,e.Muted=new T(R(n,i,a),0)}if(!e.DarkMuted&&e.DarkVibrant){let[n,i,a]=e.DarkVibrant.hsl;a=r.targetMutesSaturation,e.DarkMuted=new T(R(n,i,a),0)}if(!e.LightMuted&&e.LightVibrant){let[n,i,a]=e.LightVibrant.hsl;a=r.targetMutesSaturation,e.LightMuted=new T(R(n,i,a),0)}}const rn=(e,t)=>{t=Object.assign({},Yr,t);const r=Jr(e),n=tn(e,r,t);return en(n,r,t),n},nn=new Gr().filter.register("default",(e,t,r,n)=>n>=125&&!(e>250&&t>250&&r>250)).quantizer.register("mmcq",Qr).generator.register("default",rn);H.use(nn);/*! Fast Average Color | © 2025 Denis Seleznev | MIT License | https://github.com/fast-average-color/fast-average-color */function sn(e){var t=e.toString(16);return t.length===1?"0"+t:t}function St(e){return"#"+e.map(sn).join("")}function an(e){var t=(e[0]*299+e[1]*587+e[2]*114)/1e3;return t<128}function on(e){return e?ln(e)?e:[e]:[]}function ln(e){return Array.isArray(e[0])}function Ct(e,t,r){for(var n=0;n<r.length;n++)if(cn(e,t,r[n]))return!0;return!1}function cn(e,t,r){switch(r.length){case 3:if(un(e,t,r))return!0;break;case 4:if(hn(e,t,r))return!0;break;case 5:if(dn(e,t,r))return!0;break;default:return!1}}function un(e,t,r){return e[t+3]!==255||e[t]===r[0]&&e[t+1]===r[1]&&e[t+2]===r[2]}function hn(e,t,r){return e[t+3]&&r[3]?e[t]===r[0]&&e[t+1]===r[1]&&e[t+2]===r[2]&&e[t+3]===r[3]:e[t+3]===r[3]}function Y(e,t,r){return e>=t-r&&e<=t+r}function dn(e,t,r){var n=r[0],i=r[1],a=r[2],o=r[3],l=r[4],c=e[t+3],u=Y(c,o,l);return o?!!(!c&&u||Y(e[t],n,l)&&Y(e[t+1],i,l)&&Y(e[t+2],a,l)&&u):u}var gn=24;function fn(e,t,r){for(var n={},i=r.dominantDivider||gn,a=r.ignoredColor,o=r.step,l=[0,0,0,0,0],c=0;c<t;c+=o){var u=e[c],h=e[c+1],d=e[c+2],g=e[c+3];if(!(a&&Ct(e,c,a))){var m=Math.round(u/i)+","+Math.round(h/i)+","+Math.round(d/i);n[m]?n[m]=[n[m][0]+u*g,n[m][1]+h*g,n[m][2]+d*g,n[m][3]+g,n[m][4]+1]:n[m]=[u*g,h*g,d*g,g,1],l[4]<n[m][4]&&(l=n[m])}}var f=l[0],p=l[1],b=l[2],v=l[3],w=l[4];return v?[Math.round(f/v),Math.round(p/v),Math.round(b/v),Math.round(v/w)]:r.defaultColor}function mn(e,t,r){for(var n=0,i=0,a=0,o=0,l=0,c=r.ignoredColor,u=r.step,h=0;h<t;h+=u){var d=e[h+3],g=e[h]*d,m=e[h+1]*d,f=e[h+2]*d;c&&Ct(e,h,c)||(n+=g,i+=m,a+=f,o+=d,l++)}return o?[Math.round(n/o),Math.round(i/o),Math.round(a/o),Math.round(o/l)]:r.defaultColor}function pn(e,t,r){for(var n=0,i=0,a=0,o=0,l=0,c=r.ignoredColor,u=r.step,h=0;h<t;h+=u){var d=e[h],g=e[h+1],m=e[h+2],f=e[h+3];c&&Ct(e,h,c)||(n+=d*d*f,i+=g*g*f,a+=m*m*f,o+=f,l++)}return o?[Math.round(Math.sqrt(n/o)),Math.round(Math.sqrt(i/o)),Math.round(Math.sqrt(a/o)),Math.round(o/l)]:r.defaultColor}function Tt(e){return G(e,"defaultColor",[0,0,0,0])}function G(e,t,r){return e[t]===void 0?r:e[t]}var Dt=10,xt=100;function bn(e){return e.search(/\.svg(\?|$)/i)!==-1}function xn(e){if($t(e)){var t=e.naturalWidth,r=e.naturalHeight;return!e.naturalWidth&&bn(e.src)&&(t=r=xt),{width:t,height:r}}return _n(e)?{width:e.videoWidth,height:e.videoHeight}:Xt(e)?{width:e.codedWidth,height:e.codedHeight}:{width:e.width,height:e.height}}function Et(e){return Cn(e)?"canvas":vn(e)?"offscreencanvas":Xt(e)?"videoframe":wn(e)?"imagebitmap":e.src}function $t(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}var Qt=typeof OffscreenCanvas<"u";function vn(e){return Qt&&e instanceof OffscreenCanvas}function _n(e){return typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement}function Xt(e){return typeof VideoFrame<"u"&&e instanceof VideoFrame}function Cn(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}function wn(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap}function jn(e,t){var r=G(t,"left",0),n=G(t,"top",0),i=G(t,"width",e.width),a=G(t,"height",e.height),o=i,l=a;if(t.mode==="precision")return{srcLeft:r,srcTop:n,srcWidth:i,srcHeight:a,destWidth:o,destHeight:l};var c;return i>a?(c=i/a,o=xt,l=Math.round(o/c)):(c=a/i,l=xt,o=Math.round(l/c)),(o>i||l>a||o<Dt||l<Dt)&&(o=i,l=a),{srcLeft:r,srcTop:n,srcWidth:i,srcHeight:a,destWidth:o,destHeight:l}}var Mn=typeof window>"u";function yn(){return Mn?Qt?new OffscreenCanvas(1,1):null:document.createElement("canvas")}var Ln="FastAverageColor: ";function E(e){return Error(Ln+e)}function B(e,t){t||console.error(e)}var kn=function(){function e(){this.canvas=null,this.ctx=null}return e.prototype.getColorAsync=function(t,r){if(!t)return Promise.reject(E("call .getColorAsync() without resource"));if(typeof t=="string"){if(typeof Image>"u")return Promise.reject(E("resource as string is not supported in this environment"));var n=new Image;return n.crossOrigin=r&&r.crossOrigin||"",n.src=t,this.bindImageEvents(n,r)}else{if($t(t)&&!t.complete)return this.bindImageEvents(t,r);var i=this.getColor(t,r);return i.error?Promise.reject(i.error):Promise.resolve(i)}},e.prototype.getColor=function(t,r){r=r||{};var n=Tt(r);if(!t){var i=E("call .getColor() without resource");return B(i,r.silent),this.prepareResult(n,i)}var a=xn(t),o=jn(a,r);if(!o.srcWidth||!o.srcHeight||!o.destWidth||!o.destHeight){var i=E('incorrect sizes for resource "'.concat(Et(t),'"'));return B(i,r.silent),this.prepareResult(n,i)}if(!this.canvas&&(this.canvas=yn(),!this.canvas)){var i=E("OffscreenCanvas is not supported in this browser");return B(i,r.silent),this.prepareResult(n,i)}if(!this.ctx){if(this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),!this.ctx){var i=E("Canvas Context 2D is not supported in this browser");return B(i,r.silent),this.prepareResult(n)}this.ctx.imageSmoothingEnabled=!1}this.canvas.width=o.destWidth,this.canvas.height=o.destHeight;try{this.ctx.clearRect(0,0,o.destWidth,o.destHeight),this.ctx.drawImage(t,o.srcLeft,o.srcTop,o.srcWidth,o.srcHeight,0,0,o.destWidth,o.destHeight);var l=this.ctx.getImageData(0,0,o.destWidth,o.destHeight).data;return this.prepareResult(this.getColorFromArray4(l,r))}catch(c){var i=E("security error (CORS) for resource ".concat(Et(t),".\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image"));return B(i,r.silent),r.silent||console.error(c),this.prepareResult(n,i)}},e.prototype.getColorFromArray4=function(t,r){r=r||{};var n=4,i=t.length,a=Tt(r);if(i<n)return a;var o=i-i%n,l=(r.step||1)*n,c;switch(r.algorithm||"sqrt"){case"simple":c=mn;break;case"sqrt":c=pn;break;case"dominant":c=fn;break;default:throw E("".concat(r.algorithm," is unknown algorithm"))}return c(t,o,{defaultColor:a,ignoredColor:on(r.ignoredColor),step:l,dominantDivider:r.dominantDivider})},e.prototype.prepareResult=function(t,r){var n=t.slice(0,3),i=[t[0],t[1],t[2],t[3]/255],a=an(t);return{value:[t[0],t[1],t[2],t[3]],rgb:"rgb("+n.join(",")+")",rgba:"rgba("+i.join(",")+")",hex:St(n),hexa:St(t),isDark:a,isLight:!a,error:r}},e.prototype.destroy=function(){this.canvas&&(this.canvas.width=1,this.canvas.height=1,this.canvas=null),this.ctx=null},e.prototype.bindImageEvents=function(t,r){var n=this;return new Promise(function(i,a){var o=function(){u();var h=n.getColor(t,r);h.error?a(h.error):i(h)},l=function(){u(),a(E('Error loading image "'.concat(t.src,'"')))},c=function(){u(),a(E('Image "'.concat(t.src,'" loading aborted')))},u=function(){t.removeEventListener("load",o),t.removeEventListener("error",l),t.removeEventListener("abort",c)};t.addEventListener("load",o),t.addEventListener("error",l),t.addEventListener("abort",c)})},e}();const Yt=_.forwardRef(({children:e,...t},r)=>s.jsx(ce,{ref:r,...t,children:s.jsx(k,{direction:"row",sx:{alignItems:"center",justifyContent:"center",gap:1,flexWrap:"wrap"},children:e})})),In=at(s.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),Sn=({manga:e})=>{var u,h;const{t}=F(),r=ue(),n=q.useGetTrackerList(he),i=(h=(u=n.data)==null?void 0:u.trackers.nodes)!=null?h:[],a=e.trackRecords.nodes,o=dt.getLoggedIn(i),l=dt.getLoggedIn(dt.getTrackers(a,i)),c=d=>{var g;if(n.error){rt(t("tracking.error.label.could_not_load_track_info"),"error",(g=n.error)==null?void 0:g.toString());return}if(!o.length){r(nt.tracker.path);return}d()};return s.jsx(Ot,{variant:"dialog",popupId:"manga-track-modal",children:d=>s.jsxs(s.Fragment,{children:[s.jsxs(Yt,{..._t(d),size:"medium",disabled:n.loading||!!n.error,onClick:()=>c(d.open),variant:l.length?"contained":"outlined",children:[l.length?s.jsx(In,{}):s.jsx(sr,{}),l.length?t("manga.button.track.active",{count:l.length}):t("manga.button.track.start")]}),d.isOpen&&s.jsx(de,{...ge(d),maxWidth:"md",fullWidth:!0,scroll:"paper",children:s.jsx(Be,{manga:e})})]})})},Tn=z("div")(({theme:e})=>({display:"flex",flexDirection:"column",gap:e.spacing(2),padding:e.spacing(1),[e.breakpoints.up("md")]:{flexBasis:"40%",height:"calc(100vh - 64px)",overflowY:"auto"}})),Dn=({url:e,mangaThumbnailBackdrop:t,children:r})=>s.jsxs(k,{sx:{position:"relative"},children:[t&&s.jsxs(s.Fragment,{children:[s.jsx(mt,{spinnerStyle:{display:"none"},imgStyle:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"},src:e,alt:"Manga Thumbnail"}),s.jsx(k,{sx:{"&::before":n=>pe(t,{position:"absolute",display:"inline-block",content:'""',top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(to top, ".concat(n.palette.background.default,", transparent 100%, transparent 1px),linear-gradient(to right, ").concat(n.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to bottom, ").concat(n.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to left, ").concat(n.palette.background.default,", transparent 50%, transparent 1px)"),backdropFilter:"blur(4.5px) brightness(0.75)"})}})]}),r]}),En=z("div")(({theme:e})=>({display:"flex",paddingBottom:e.spacing(1)})),An=z("div")(({theme:e})=>({zIndex:1,marginLeft:e.spacing(1)})),J=e=>s.jsx(Ge,{...e}),Rn=z("div")(({theme:e})=>({display:"flex",gap:e.spacing(1)})),Vn=({url:e})=>{const{t}=F();return s.jsx(V,{title:t("global.button.open_site"),disabled:!e,children:s.jsx(Ze,{size:"medium",disabled:!e,component:Gt,href:e!=null?e:void 0,target:"_blank",rel:"noreferrer",variant:"outlined",children:s.jsx(tr,{})})})};function Fn(e){var t;return e?ar.isLocalSource(e)?it("source.local_source.title"):(t=e.displayName)!=null?t:e.id:it("global.label.unknown")}function At(e){return e!=null?e:it("global.label.unknown")}const Jt=({query:e,children:t})=>s.jsx(Gt,{component:Z,to:nt.library.path(void 0,e),sx:{textDecoration:"none",color:"inherit"},children:t!=null?t:e}),Rt=e=>e==null?void 0:e.map(t=>s.jsx(Jt,{query:t})).reduce((t,r)=>s.jsxs(s.Fragment,{children:[t,", ",r]})),On=({manga:e,mangaDynamicColorSchemes:t})=>{const r=Bt(),{setDynamicColor:n}=be(),i=xe({variant:"popover",popupId:"manga-thumbnail-fullscreen"}),[a,o]=_.useState(!1);return _.useLayoutEffect(()=>{if(!t)return()=>{};const l=new Image;return l.crossOrigin="anonymous",l.src=O.getThumbnailUrl(e),l.onload=()=>{const c=l.width>600&&l.height>600;Promise.all([H.from(l).getPalette(),new kn().getColor(l,{algorithm:"dominant",mode:c?"speed":"precision",ignoredColor:[[255,255,255,255,75],[0,0,0,255,75]]})]).then(([u,h])=>{!u.Vibrant||!u.DarkVibrant||!u.LightVibrant||!u.LightMuted||!u.Muted||!u.DarkMuted||n({...u,average:h})})},()=>{n(null)}},[]),s.jsxs(s.Fragment,{children:[s.jsxs(k,{sx:{position:"relative",borderRadius:1,overflow:"hidden",backgroundColor:"background.paper",width:"150px",maxHeight:"fit-content",aspectRatio:ve,flexShrink:0,flexGrow:0,[r.breakpoints.up("lg")]:{width:"200px"},[r.breakpoints.up("xl")]:{width:"300px"}},children:[s.jsx(mt,{src:O.getThumbnailUrl(e),alt:"Manga Thumbnail",onLoad:()=>o(!0),imgStyle:{width:"100%",height:"100%",objectFit:"cover"}}),a&&s.jsx(k,{..._t(i),sx:{position:"absolute",top:0,bottom:0,width:"100%",justifyContent:"center",alignItems:"center",opacity:0,"&:hover":{background:"rgba(0, 0, 0, 0.4)",cursor:"pointer",opacity:1}},children:s.jsx(Rr,{fontSize:"large",color:"primary"})})]}),s.jsx(_e,{...Ce(i),sx:{outline:0},children:s.jsx(k,{onClick:()=>i.close(),sx:{height:"100vh",p:2,outline:0,justifyContent:"center",alignItems:"center"},children:s.jsx(mt,{src:O.getThumbnailUrl(e),alt:"Manga Thumbnail",imgStyle:{height:"100%",width:"100%",objectFit:"contain"}})})})]})},Vt="35px",Ft=75,Hn=({manga:{description:e,genre:t}})=>{const[r,n]=_.useState(null),[i,a]=_.useState();Pt(r,_.useCallback(()=>a(r==null?void 0:r.clientHeight),[r]));const[o,l]=we("isDescriptionGenreCollapsed",!0),c=e?Math.min(Ft,i!=null?i:Ft):0,u=_.useMemo(()=>t.filter(Boolean),[t]);return s.jsxs(s.Fragment,{children:[e&&s.jsxs(k,{sx:{position:"relative"},children:[s.jsx(je,{collapsedSize:c,in:!o,children:s.jsx(et,{ref:n,sx:{whiteSpace:"pre-line",textAlign:"justify",textJustify:"inter-word",mb:Vt},children:qe(Ue(e,{disallowedTagsMode:"escape"}))})}),s.jsx(k,{onClick:()=>l(!o),sx:{justifyContent:"flex-start",alignItems:"center",cursor:"pointer",position:"absolute",width:"100%",height:Vt,bottom:0,background:h=>"linear-gradient(transparent -15px, ".concat(h.palette.background.default,")")},children:s.jsx(D,{sx:{color:h=>h.palette.mode==="light"?"black":"text"},children:o?s.jsx(nr,{}):s.jsx(ir,{})})})]}),s.jsx(k,{sx:{flexDirection:"row",flexWrap:o?"no-wrap":"wrap",gap:1,overflowX:o?"auto":null},children:u.map(h=>s.jsx(Jt,{query:h,children:s.jsx(or,{label:h,variant:"outlined",onClick:()=>{}})},h))})]})},Pn=({manga:e})=>{const{t}=F(),{settings:{mangaThumbnailBackdrop:r,mangaDynamicColorSchemes:n}}=fe();_.useEffect(()=>{e.source||rt(it("source.error.label.source_not_found"),"error")},[e.source]);const{CategorySelectComponent:i,updateLibraryState:a}=Qe(e),o=async()=>{try{await navigator.clipboard.writeText(e.title),rt(t("global.label.copied_clipboard"),"info")}catch(l){}};return s.jsxs(s.Fragment,{children:[s.jsxs(Tn,{children:[s.jsxs(Dn,{url:O.getThumbnailUrl(e),mangaThumbnailBackdrop:r,children:[s.jsxs(En,{children:[s.jsx(On,{manga:e,mangaDynamicColorSchemes:n}),s.jsxs(An,{children:[s.jsxs(k,{sx:{flexDirection:"row",gap:1,alignItems:"flex-start",mb:1},children:[s.jsx(et,{variant:"h5",component:"h2",sx:{wordBreak:"break-word"},children:e.title}),s.jsx(V,{title:t("global.button.copy"),children:s.jsx(D,{onClick:o,color:"inherit",children:s.jsx(Vr,{fontSize:"small"})})})]}),s.jsx(J,{title:t("manga.label.author"),value:At(Rt(O.getAuthors(e)))}),s.jsx(J,{title:t("manga.label.author"),value:At(Rt(O.getArtists(e)))}),s.jsx(J,{title:t("manga.label.status"),value:t(me[e.status])}),s.jsx(J,{title:t("source.title_one"),value:Fn(e.source)})]})]}),s.jsxs(Rn,{children:[s.jsxs(Yt,{size:"medium",onClick:a,variant:e.inLibrary?"contained":"outlined",children:[e.inLibrary?s.jsx(rr,{}):s.jsx(Xe,{}),e.inLibrary?t("manga.button.in_library"):t("manga.button.add_to_library")]}),s.jsx(Sn,{manga:e}),s.jsx(Vn,{url:e.realUrl})]})]}),s.jsx(Hn,{manga:e})]}),i]})},Nn=({manga:e,onRefresh:t,refreshing:r})=>{const{t:n}=F(),i=Bt(),a=Me(i.breakpoints.up("sm")),[o,l]=ye.useState(null),c=!!o,u=()=>{l(null)},{openCategorySelect:h,CategorySelectComponent:d}=Ye({mangaId:e.id});return s.jsxs(s.Fragment,{children:[a&&s.jsxs(s.Fragment,{children:[s.jsx(V,{title:n("manga.label.reload_from_source"),disabled:r,children:s.jsx(D,{onClick:()=>{t()},disabled:r,color:"inherit",children:s.jsx(jt,{})})}),e.inLibrary&&s.jsxs(s.Fragment,{children:[s.jsx(V,{title:n("global.button.migrate"),children:s.jsx(Z,{to:nt.migrate.childRoutes.search.path(e.sourceId,e.id,e.title),state:{mangaTitle:e.title},style:{textDecoration:"none",color:"inherit"},children:s.jsx(D,{color:"inherit",children:s.jsx(yt,{})})})}),s.jsx(V,{title:n("manga.label.edit_categories"),children:s.jsx(D,{onClick:()=>{h(!0)},color:"inherit",children:s.jsx(Lt,{})})})]})]}),!a&&s.jsxs(s.Fragment,{children:[s.jsx(D,{id:"chaptersMenuButton","aria-controls":c?"chaptersMenu":void 0,"aria-haspopup":"true","aria-expanded":c?"true":void 0,onClick:g=>l(g.currentTarget),color:"inherit",children:s.jsx(Le,{})}),s.jsxs(Ht,{id:"chaptersMenu",anchorEl:o,open:c,onClose:u,MenuListProps:{"aria-labelledby":"chaptersMenuButton"},children:[s.jsxs(lt,{onClick:()=>{t(),u()},disabled:r,children:[s.jsx(ct,{children:s.jsx(jt,{fontSize:"small"})}),s.jsx(ut,{children:n("manga.label.reload_from_source")})]}),e.inLibrary&&[s.jsxs(lt,{component:Z,to:nt.migrate.childRoutes.search.path(e.sourceId,e.id,e.title),state:{mangaTitle:e.title},style:{textDecoration:"none",color:"inherit"},children:[s.jsx(ct,{children:s.jsx(yt,{fontSize:"small"})}),s.jsx(ut,{children:n("migrate.title")})]},"migrate"),s.jsxs(lt,{onClick:()=>{h(!0),u()},children:[s.jsx(ct,{children:s.jsx(Lt,{fontSize:"small"})}),s.jsx(ut,{children:n("manga.label.edit_categories")})]},"categories")]]})]}),d]})},Fi=()=>{var f;const{t:e}=F(),{id:t}=ke(),r=_.useRef(!1),{data:n,error:i,loading:a,networkStatus:o,refetch:l}=q.useGetManga(Ie,t),c=Se(o),u=n==null?void 0:n.manga,[h,{loading:d,error:g}]=Ar(t),m=i!=null?i:g;return _.useEffect(()=>{if(u==null)return;!r.current&&!u.initialized&&(r.current=!0,h())},[u]),lr((f=u==null?void 0:u.title)!=null?f:e("manga.title_one"),s.jsxs(k,{direction:"row",sx:{alignItems:"center"},children:[m&&!c&&!d&&s.jsx(V,{title:s.jsxs(s.Fragment,{children:[e("manga.error.label.request_failure"),s.jsx("br",{}),tt(m)]}),children:s.jsx(D,{onClick:()=>l(),children:s.jsx(cr,{color:"error"})})}),u&&(d||c)&&s.jsx(D,{disabled:!0,children:s.jsx(Te,{size:16})}),u&&s.jsx(Nn,{manga:u,onRefresh:h,refreshing:d})]}),[e,m,c,d,u,h]),m&&!u?s.jsx(K,{message:e("manga.error.label.request_failure"),messageExtra:tt(m)}):s.jsxs(zt,{sx:{display:{md:"flex"},overflow:"hidden"},children:[a&&s.jsx(Nt,{}),u&&s.jsx(Pn,{manga:u}),u&&s.jsx(Er,{manga:u,isRefreshing:d})]})};export{Fi as Manga};
