import{u as J,a as Y,r as N,b as W,j as r,H as d,bD as X,o as n,p as i,y as $,e as Q,g as j,f as V,bE as _,b2 as l,bF as Z,bG as p,bH as f,b0 as u,bI as k,bJ as L,bK as M,bL as m,bM as w,m as D,aA as A,bN as F}from"./index-kzF4ix3O.js";import{N as c}from"./NumberSetting-BP4rBdsu.js";import{S as v}from"./SelectSetting-BZu8gpfF.js";import{E as ee}from"./EmptyViewAbsoluteCentered-BOST1byO.js";import{u as se}from"./useAppTitle-DWjdhXdc.js";import{S as o}from"./Switch-4PG44UyK.js";import{L as g}from"./ListSubheader-Cmi7i_KO.js";import{T as re}from"./Trans-C-pUJVpA.js";import{L as te}from"./Link-D4mR48Dc.js";import"./Slider-DPC_-aE5.js";import"./Select-DU1e2Vsq.js";import"./SwitchBase-BmJzQQty.js";const ae=s=>s===0?A("global.label.never"):A("settings.server.misc.log_files.file_cleanup.value",{days:s,count:s}),be=()=>{var E,T;const{t:s}=J();se(s("settings.server.title.server"));const{settings:{serverInformAvailableUpdate:U},loading:R,request:{error:x,refetch:z}}=Y(),O=$(e=>D(s("global.error.label.failed_to_save_changes"),"error",j(e))),{data:I,loading:H,error:C,refetch:B}=N.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[K]=N.useUpdateServerSettings(),a=async(e,S,h)=>{try{await K({variables:{input:{settings:{[e]:S}}}}),h==null||h(!0)}catch(G){D(s("global.error.label.failed_to_save_changes"),"error",j(G)),h==null||h(!1)}},b=W.useMemo(()=>r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-client",children:s("global.label.client")}),children:[r.jsx(X,{}),r.jsxs(n,{children:[r.jsx(i,{primary:s("global.update.settings.inform.label.title"),secondary:s("global.update.settings.inform.label.description")}),r.jsx(o,{edge:"end",checked:U,onChange:e=>O("serverInformAvailableUpdate",e.target.checked)})]})]}),[U]);if(R||H)return r.jsxs(r.Fragment,{children:[b,r.jsx(Q,{})]});const P=x!=null?x:C;if(P)return r.jsxs(r.Fragment,{children:[b,r.jsx(ee,{message:s("global.error.label.failed_to_load_data"),messageExtra:j(P),retry:()=>{x&&z().catch(V()),C&&B().catch(V())}})]});const t=I.settings,q=!((E=t.authUsername)!=null&&E.trim())||!((T=t.authPassword)!=null&&T.trim()),y=t.databaseType===_.H2;return r.jsxs(d,{sx:{pt:0},children:[b,r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-server-address",children:s("settings.server.address.server.title")}),children:[r.jsx(l,{settingName:s("settings.server.address.server.label.ip"),handleChange:e=>a("ip",e),value:t.ip,placeholder:"0.0.0.0"}),r.jsx(c,{settingTitle:s("settings.server.address.server.label.port"),settingValue:t.port.toString(),handleUpdate:e=>a("port",e),value:t.port,defaultValue:4567,valueUnit:s("settings.server.address.server.label.port")})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-socks-proxy",children:s("settings.server.socks_proxy.title")}),children:[r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.socks_proxy.label.enable")}),r.jsx(o,{edge:"end",checked:t.socksProxyEnabled,onChange:e=>a("socksProxyEnabled",e.target.checked)})]}),r.jsx(v,{settingName:s("settings.server.socks_proxy.label.version"),value:t.socksProxyVersion,values:[[4,{text:"4"}],[5,{text:"5"}]],handleChange:e=>a("socksProxyVersion",e)}),r.jsx(l,{settingName:s("settings.server.socks_proxy.label.host"),value:t.socksProxyHost,handleChange:e=>a("socksProxyHost",e)}),r.jsx(l,{settingName:s("settings.server.socks_proxy.label.port"),value:t.socksProxyPort,handleChange:e=>a("socksProxyPort",e)}),r.jsx(l,{settingName:s("settings.server.socks_proxy.label.username"),value:t.socksProxyUsername,handleChange:e=>a("socksProxyUsername",e)}),r.jsx(l,{settingName:s("settings.server.socks_proxy.label.password"),value:t.socksProxyPassword,handleChange:e=>a("socksProxyPassword",e),isPassword:!0})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-auth",children:s("settings.server.auth.title")}),children:[r.jsx(v,{settingName:s("settings.server.auth.label.title"),value:t.authMode,values:Z,handleChange:e=>{a("authMode",e,S=>{S&&(e!==p.UiLogin&&F.removeTokens(),F.setAuthRequired(e===p.UiLogin))})},disabled:q}),r.jsx(l,{settingName:s("settings.server.auth.label.username"),value:t.authUsername,validate:e=>t.authMode===p.None||!!e.trim(),handleChange:e=>a("authUsername",e)}),r.jsx(l,{settingName:s("settings.server.auth.label.password"),value:t.authPassword,isPassword:!0,validate:e=>t.authMode===p.None||!!e.trim(),handleChange:e=>a("authPassword",e)}),t.authMode===p.UiLogin&&r.jsxs(r.Fragment,{children:[r.jsx(l,{settingName:s("settings.server.auth.jwt.audience"),value:t.jwtAudience,handleChange:e=>a("jwtAudience",e)}),r.jsx(c,{settingTitle:s("settings.server.auth.jwt.access_token_expiry"),settingValue:u.duration(t.jwtTokenExpiry).humanize(),value:u.duration(t.jwtTokenExpiry).asMinutes(),valueUnit:s("global.time.minutes.minute_other"),defaultValue:f.default,minValue:f.min,maxValue:f.max,handleUpdate:e=>a("jwtTokenExpiry",u.duration(e,"minute").toISOString()),showSlider:!0}),r.jsx(c,{settingTitle:s("settings.server.auth.jwt.refresh_token_expiry"),settingValue:u.duration(t.jwtRefreshExpiry).humanize(),value:u.duration(t.jwtRefreshExpiry).asDays(),valueUnit:s("global.time.days.day_other"),defaultValue:k.default,minValue:k.min,maxValue:k.max,handleUpdate:e=>a("jwtRefreshExpiry",u.duration(e,"day").toISOString()),showSlider:!0})]})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-clouadflare-bypass",children:s("settings.server.cloudflare.title")}),children:[r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.cloudflare.flaresolverr.enabled.label.title"),secondary:r.jsxs(re,{i18nKey:"settings.server.cloudflare.flaresolverr.enabled.label.description",children:["See"," ",r.jsx(te,{href:"https://github.com/FlareSolverr/FlareSolverr?tab=readme-ov-file#installation",target:"_blank",rel:"noreferrer",children:"FlareSolverr"})," ","for information on how to set it up"]})}),r.jsx(o,{edge:"end",checked:t.flareSolverrEnabled,onChange:e=>a("flareSolverrEnabled",e.target.checked)})]}),r.jsx(l,{settingName:s("settings.server.cloudflare.flaresolverr.url.label.title"),dialogDescription:s("settings.server.cloudflare.flaresolverr.url.label.description"),value:t.flareSolverrUrl,handleChange:e=>a("flareSolverrUrl",e)}),r.jsx(c,{settingTitle:s("settings.server.cloudflare.flaresolverr.timeout.label.title"),settingValue:s("global.time.seconds.value",{count:t.flareSolverrTimeout}),dialogDescription:s("settings.server.cloudflare.flaresolverr.timeout.label.description"),value:t.flareSolverrTimeout,defaultValue:60,minValue:20,maxValue:60*5,stepSize:1,showSlider:!0,valueUnit:s("global.time.seconds.second_other"),handleUpdate:e=>a("flareSolverrTimeout",e)}),r.jsx(l,{settingName:s("settings.server.cloudflare.flaresolverr.session.name.label.title"),value:t.flareSolverrSessionName,handleChange:e=>a("flareSolverrSessionName",e)}),r.jsx(c,{settingTitle:s("settings.server.cloudflare.flaresolverr.session.ttl.label.title"),settingValue:s("global.time.minutes.value",{count:t.flareSolverrSessionTtl}),dialogDescription:s("settings.server.cloudflare.flaresolverr.session.ttl.label.description"),value:t.flareSolverrSessionTtl,defaultValue:15,minValue:1,maxValue:60,stepSize:1,showSlider:!0,valueUnit:s("global.time.minutes.minute_other"),handleUpdate:e=>a("flareSolverrSessionTtl",e)}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.cloudflare.flaresolverr.response_fallback.label.title"),secondary:s("settings.server.cloudflare.flaresolverr.response_fallback.label.description")}),r.jsx(o,{edge:"end",checked:t.flareSolverrAsResponseFallback,onChange:e=>a("flareSolverrAsResponseFallback",e.target.checked)})]})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-opds",children:s("settings.server.opds.title")}),children:[r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.opds.binary_file_sizes.label.title"),secondary:s("settings.server.opds.binary_file_sizes.label.description")}),r.jsx(o,{edge:"end",checked:t.opdsUseBinaryFileSizes,onChange:e=>a("opdsUseBinaryFileSizes",e.target.checked)})]}),r.jsx(c,{settingTitle:s("settings.server.opds.items_per_page.label.title"),settingValue:t.opdsItemsPerPage.toString(),dialogDescription:s("settings.server.opds.items_per_page.label.description"),value:t.opdsItemsPerPage,defaultValue:50,minValue:10,maxValue:5e3,stepSize:10,showSlider:!0,valueUnit:s("settings.server.opds.items_per_page.label.unit_other"),handleUpdate:e=>a("opdsItemsPerPage",e)}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.opds.enable_page_read_progress.label.title"),secondary:s("settings.server.opds.enable_page_read_progress.label.description")}),r.jsx(o,{edge:"end",checked:t.opdsEnablePageReadProgress,onChange:e=>a("opdsEnablePageReadProgress",e.target.checked)})]}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.opds.mark_as_read_on_download.label.title"),secondary:s("settings.server.opds.mark_as_read_on_download.label.description")}),r.jsx(o,{edge:"end",checked:t.opdsMarkAsReadOnDownload,onChange:e=>a("opdsMarkAsReadOnDownload",e.target.checked)})]}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.opds.show_only_unread_chapters.label.title"),secondary:s("settings.server.opds.show_only_unread_chapters.label.description")}),r.jsx(o,{edge:"end",checked:t.opdsShowOnlyUnreadChapters,onChange:e=>a("opdsShowOnlyUnreadChapters",e.target.checked)})]}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.opds.show_only_downloaded_chapters.label.title"),secondary:s("settings.server.opds.show_only_downloaded_chapters.label.description")}),r.jsx(o,{edge:"end",checked:t.opdsShowOnlyDownloadedChapters,onChange:e=>a("opdsShowOnlyDownloadedChapters",e.target.checked)})]}),r.jsx(v,{settingName:s("settings.server.opds.chapter_sort_order.label.title"),dialogDescription:s("settings.server.opds.chapter_sort_order.label.description"),value:t.opdsChapterSortOrder,values:[[L.Asc,{text:s("global.sort.label.asc")}],[L.Desc,{text:s("global.sort.label.desc")}]],handleChange:e=>a("opdsChapterSortOrder",e)})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-koreader-sync",children:s("settings.server.koreader.sync.title")}),children:[r.jsx(l,{settingName:s("settings.server.koreader.sync.server_address"),handleChange:e=>a("koreaderSyncServerUrl",e),value:t.koreaderSyncServerUrl,placeholder:"http://localhost:17200"}),r.jsx(l,{settingName:s("settings.server.koreader.sync.username"),value:t.koreaderSyncUsername,handleChange:e=>a("koreaderSyncUsername",e)}),r.jsx(l,{settingName:s("settings.server.koreader.sync.user_key"),value:t.koreaderSyncUserkey,handleChange:e=>a("koreaderSyncUserkey",e),isPassword:!0}),r.jsx(l,{settingName:s("settings.server.koreader.sync.device_id"),value:t.koreaderSyncDeviceId,handleChange:e=>a("koreaderSyncDeviceId",e)}),r.jsx(v,{settingName:s("settings.server.koreader.sync.check_sum_method.title"),value:t.koreaderSyncChecksumMethod,values:[[M.Binary,{text:s("settings.server.koreader.sync.check_sum_method.binary")}],[M.Filename,{text:s("settings.server.koreader.sync.check_sum_method.filename")}]],handleChange:e=>a("koreaderSyncChecksumMethod",e)}),r.jsx(v,{settingName:s("settings.server.koreader.sync.strategy.title"),value:t.koreaderSyncStrategy,values:[[m.Disabled,{text:s("settings.server.koreader.sync.strategy.disabled")}],[m.Prompt,{text:s("settings.server.koreader.sync.strategy.prompt")}],[m.Silent,{text:s("settings.server.koreader.sync.strategy.silent")}],[m.Send,{text:s("settings.server.koreader.sync.strategy.send")}],[m.Receive,{text:s("settings.server.koreader.sync.strategy.receive")}]],handleChange:e=>a("koreaderSyncStrategy",e)}),r.jsx(c,{settingTitle:s("settings.server.koreader.sync.tolerance.title"),dialogDescription:s("settings.server.koreader.sync.tolerance.description"),settingValue:t.koreaderSyncPercentageTolerance.toString(),value:t.koreaderSyncPercentageTolerance,defaultValue:w.default,minValue:w.min,maxValue:w.max,valueUnit:"",handleUpdate:e=>a("koreaderSyncPercentageTolerance",e)})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-database",children:s("settings.server.database.title")}),children:[r.jsx(v,{settingName:s("settings.server.database.type.title"),value:t.databaseType,values:[[_.H2,{text:s("settings.server.database.type.h2")}],[_.Postgresql,{text:s("settings.server.database.type.postgresql")}]],handleChange:e=>a("databaseType",e)}),r.jsx(l,{settingName:s("settings.server.database.address"),handleChange:e=>a("databaseUrl",e),value:t.databaseUrl,placeholder:"postgresql://localhost:5432/suwayomi",disabled:y}),r.jsx(l,{settingName:s("settings.server.database.username"),value:t.databaseUsername,handleChange:e=>a("databaseUsername",e),disabled:y}),r.jsx(l,{settingName:s("settings.server.database.password"),value:t.databasePassword,handleChange:e=>a("databasePassword",e),disabled:y,isPassword:!0})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-misc",children:s("settings.server.misc.title")}),children:[r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.misc.log_level.label.server")}),r.jsx(o,{edge:"end",checked:t.debugLogsEnabled,onChange:e=>a("debugLogsEnabled",e.target.checked)})]}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.misc.tray_icon.label.title"),secondary:s("settings.server.misc.tray_icon.label.description")}),r.jsx(o,{edge:"end",checked:t.systemTrayEnabled,onChange:e=>a("systemTrayEnabled",e.target.checked)})]}),r.jsx(c,{settingTitle:s("settings.server.misc.log_files.file_cleanup.title"),settingValue:ae(t.maxLogFiles),value:t.maxLogFiles,valueUnit:s("global.date.label.day_one"),handleUpdate:e=>a("maxLogFiles",e)}),r.jsx(l,{settingName:s("settings.server.misc.log_files.file_size.title"),value:t.maxLogFileSize,dialogDescription:s("settings.server.misc.log_files.file_size.description"),validate:e=>!!e.match(/^[0-9]+(|kb|KB|mb|MB|gb|GB)$/g),handleChange:e=>a("maxLogFileSize",e)}),r.jsx(l,{settingName:s("settings.server.misc.log_files.total_size.title"),value:t.maxLogFolderSize,dialogDescription:s("settings.server.misc.log_files.total_size.description"),validate:e=>!!e.match(/^[0-9]+(|kb|KB|mb|MB|gb|GB)$/g),handleChange:e=>a("maxLogFolderSize",e)})]})]})};export{be as ServerSettings};
