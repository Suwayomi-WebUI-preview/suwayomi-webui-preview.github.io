import{r as D,i as L,j as e,D as Qe,u as I,l as Le,c as u,K as Be,h as Fe,O as le,P as ie,S as k,L as Q,T as V,Q as Je,f as M,I as w,R as J,U as Ae,V as Xe,W as G,F as B,k as Ye,M as we,v as de,a as E,X as Ze,g as Ne,E as K,Y as Oe,B as Ee,Z as et,e as tt,G as rt,_ as at,$ as st,m as oe,a0 as nt,a1 as ot,a2 as lt,d as it,a3 as dt,a4 as ct,w as Ie,a5 as te,a6 as re,a7 as ae,N as ut,a8 as ht,a9 as pt,aa as ft,ab as gt}from"./index-CKBxMd_h.js";import{V as mt}from"./index-DFMF3h4b.js";import{M as T,d as xt,a as bt,b as jt,c as kt,e as vt,f as Ct,J as Pe,g as _t,h as yt,u as wt,C as It,T as St,i as Mt,j as $t,k as Rt,l as Tt,m as Se,n as Me}from"./useManageMangaLibraryState-Buii7VAm.js";import{D as Dt}from"./DownloadStateIndicator-BLHztKFA.js";import{d as Lt}from"./Delete-CgmxhIrM.js";import{C,a as Bt}from"./Chapters-C94eQhhe.js";import{T as Ft,s as ce}from"./TypographyMaxLines-CUvaPvl8.js";import{C as At}from"./Card-Cr9utwej.js";import{C as Nt}from"./CardActionArea-BHBGCn9v.js";import{C as Ot}from"./CardContent-D5B4KoK-.js";import{C as Et}from"./Checkbox-ahfba6_6.js";import{d as Pt}from"./PlayArrow-DYZR5rOS.js";import{S as zt,D as Ht}from"./StyledFab-gJcKMs5T.js";import{d as Vt}from"./FilterList-B4MB-hNh.js";import{S as Gt,R as $e}from"./SortRadioInput-DyHfYr02.js";import{T as se}from"./ThreeStateCheckboxInput-BsazusKT.js";import{O as qt,a as Wt,S as Ut,d as Kt}from"./SelectionFAB-DmeYA5wt.js";import{R as Qt}from"./ListPreference-CM7aD9qg.js";import{M as q,s as Jt}from"./Mangas-Df_Z9EgA.js";import{b as Xt}from"./Strings-CWt9sr6N.js";import{d as Yt,a as Zt,b as er}from"./ExpandMore-XF74jtek.js";import{S as Re}from"./SpinnerImage-0JZOfick.js";import{C as ue}from"./CustomIconButton-8xEvZSID.js";import{d as tr}from"./Sync-Cq_IfjXs.js";import{T as ne}from"./Trackers-D4pSmk7a.js";import{L as rr}from"./Link-Md8SMvlM.js";import{C as ar}from"./Collapse-C7pJTB29.js";import{C as sr}from"./Chip-0iDzqWXn.js";import"./Avatar-COfGnEWj.js";import"./Info-2xKqwcLI.js";import"./TextField-DKEWl0kG.js";import"./InputAdornment-0ZrWWhgd.js";import"./CheckCircle-C3BmOyh0.js";import"./NumberSetting-Cyy9C5Bb.js";import"./useMobilePicker-D8SH1tv9.js";import"./SelectSetting-r_f7SmmX.js";import"./Select-CummqEgG.js";import"./CheckboxInput-OYYQUZ2R.js";import"./SwitchBase-CSUbfhgD.js";import"./Tabs-BnUs8XgG.js";var he={},nr=L;Object.defineProperty(he,"__esModule",{value:!0});var ze=he.default=void 0,or=nr(D()),lr=e;ze=he.default=(0,or.default)((0,lr.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");var pe={},ir=L;Object.defineProperty(pe,"__esModule",{value:!0});var fe=pe.default=void 0,dr=ir(D()),cr=e;fe=pe.default=(0,dr.default)((0,cr.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll");var ge={},ur=L;Object.defineProperty(ge,"__esModule",{value:!0});var He=ge.default=void 0,hr=ur(D()),pr=e;He=ge.default=(0,hr.default)((0,pr.jsx)("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"}),"Bookmark");var me={},fr=L;Object.defineProperty(me,"__esModule",{value:!0});var Ve=me.default=void 0,gr=fr(D()),mr=e;Ve=me.default=(0,gr.default)((0,mr.jsx)("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"}),"BookmarkRemove");var xe={},xr=L;Object.defineProperty(xe,"__esModule",{value:!0});var Ge=xe.default=void 0,br=xr(D()),jr=e;Ge=xe.default=(0,br.default)((0,jr.jsx)("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"}),"BookmarkAdd");var be={},kr=L;Object.defineProperty(be,"__esModule",{value:!0});var je=be.default=void 0,vr=kr(D()),Cr=e;je=be.default=(0,vr.default)((0,Cr.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"Launch");class _{static getChapters(r){return r.map(({chapter:a})=>a)}static getIds(r){return C.getIds(_.getChapters(r))}static getDownloaded(r){return r.filter(({chapter:a})=>C.isDownloaded(a))}static getDeletable(r,a){return r.filter(({chapter:s})=>C.isDeletable(s,a))}static getNonDownloaded(r){return r.filter(({chapter:a})=>!C.isDownloaded(a))}static isDownloadable({chapter:r,downloadChapter:a}){return!C.isDownloaded(r)&&(!a||(a==null?void 0:a.state)===Qe.Error)}static getDownloadable(r){return r.filter(this.isDownloadable)}static getBookmarked(r){return r.filter(({chapter:a})=>C.isBookmarked(a))}static getNonBookmarked(r){return r.filter(({chapter:a})=>!C.isBookmarked(a))}static getRead(r){return r.filter(({chapter:a})=>C.isRead(a))}static getNonRead(r){return r.filter(({chapter:a})=>!C.isRead(a))}}const qe=({chapter:t,allChapters:r,handleSelection:a,canBeDownloaded:s=!1,selectedChapters:n=[],onClose:l})=>{const{t:o}=I(),i=!!t,{isDownloaded:x,isRead:f,isBookmarked:h}=t!=null?t:{},{settings:{deleteChaptersWithBookmark:d}}=Le(),m=kt(i,Bt),b=vt(i),j=Ct(i),{downloadableChapters:c,downloadedChapters:g,unbookmarkedChapters:v,bookmarkedChapters:y,unreadChapters:P,readChapters:F}=u.useMemo(()=>({downloadableChapters:_.getDownloadable(n),downloadedChapters:_.getDownloaded(n),unbookmarkedChapters:_.getNonBookmarked(n),bookmarkedChapters:_.getBookmarked(n),unreadChapters:_.getNonRead(n),readChapters:_.getRead(n)}),[n]),X=()=>{a==null||a(t.id,!0),l()},S=(W,Y)=>{var N;const $=W==="mark_prev_as_read",z=$?"mark_as_read":W;if(z==="delete"&&t&&!C.isDeletable(t,d)){l();return}const A=(()=>{if(!t)return _.getChapters(Y);if(!$)return[t];const H=r.findIndex(({id:Z})=>Z===t.id);return H+1>r.length-1?[]:r.slice(H+1)})();if(!A.length){l();return}C.performAction(z,C.getIds(A),{chapters:A,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(N=A[0])==null?void 0:N.mangaId}).catch(Fe()),l()};return e.jsxs(e.Fragment,{children:[i&&e.jsx(T,{onClick:X,Icon:xt,title:o("chapter.action.label.select")}),i&&e.jsx(T,{Icon:je,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),l()},title:o("chapter.action.label.open_on_source")}),b(s)&&e.jsx(T,{Icon:Be,disabled:j(!c.length),onClick:()=>S("download",c),title:m("download",c.length)}),b(x)&&e.jsx(T,{Icon:Lt,disabled:j(!g.length),onClick:()=>S("delete",_.getDeletable(g,d)),title:m("delete",g.length)}),b(!h)&&e.jsx(T,{Icon:Ge,disabled:j(!v.length),onClick:()=>S("bookmark",v),title:m("bookmark",v.length)}),b(h)&&e.jsx(T,{Icon:Ve,disabled:j(!y.length),onClick:()=>S("unbookmark",y),title:m("unbookmark",y.length)}),b(!f)&&e.jsx(T,{Icon:bt,disabled:j(!P.length),onClick:()=>S("mark_as_read",P),title:m("mark_as_read",P.length)}),b(f)&&e.jsx(T,{Icon:jt,disabled:j(!F.length),onClick:()=>S("mark_as_unread",F),title:m("mark_as_unread",F.length)}),i&&e.jsx(T,{onClick:()=>S("mark_prev_as_read",[]),Icon:fe,title:o("chapter.action.mark_as_read.add.label.action.previous")})]})},_r=t=>{const{t:r}=I(),a=le(),s=u.useRef(null),{chapter:n,allChapters:l,downloadChapter:o,showChapterNumber:i,onSelect:x,selected:f}=t,h=f!==null,{isDownloaded:d}=n,m=c=>{h&&(c.preventDefault(),c.stopPropagation(),x(!f,c.shiftKey))},b=(c,g)=>{c.stopPropagation(),c.preventDefault(),g(c)},j=Pe((c,{context:g})=>{if(!h&&s.current){b(c,()=>g==null?void 0:g(s.current));return}c.shiftKey=!0,m(c)});return e.jsx("li",{children:e.jsx(ie,{variant:"popover",popupId:"chapter-card-action-menu",children:c=>{var g;return e.jsxs(k,{sx:{pt:1,px:1},children:[e.jsx(At,{sx:{touchCallout:"none"},children:e.jsx(Nt,{component:Q,to:"/manga/".concat(n.mangaId,"/chapter/").concat(n.sourceOrder),style:{color:a.palette.text[n.isRead?"disabled":"primary"]},onClick:v=>m(v),...j(c.open),children:e.jsxs(Ot,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5,"&:last-child":{pb:1.5}},children:[e.jsxs(k,{direction:"column",sx:{flex:1},children:[e.jsxs(k,{sx:{flexDirection:"row",gap:.5,alignItems:"center"},children:[n.isBookmarked&&e.jsx(He,{color:"primary"}),e.jsx(Ft,{variant:"h6",component:"h4",children:i?"".concat(r("chapter.title_one")," ").concat(n.chapterNumber):n.name})]}),e.jsx(V,{variant:"caption",children:n.scanlator}),e.jsxs(V,{variant:"caption",children:[Je(Number((g=n.uploadDate)!=null?g:0),!0),d&&" â€¢ ".concat(r("chapter.status.label.downloaded"))]})]}),o&&e.jsx(Dt,{download:o}),e.jsx(k,{sx:{minHeight:"48px"},children:f===null?e.jsx(M,{title:r("global.button.options"),children:e.jsx(w,{ref:s,...J(c),onClick:v=>b(v,c.open),onTouchStart:v=>b(v,c.open),"aria-label":"more",size:"large",children:e.jsx(_t,{})})}):e.jsx(M,{title:r(f?"global.button.deselect":"global.button.select"),children:e.jsx(Et,{checked:f})})})]})})}),!h&&c.isOpen&&e.jsx(yt,{...Ae(c),children:v=>e.jsx(qe,{onClose:v,chapter:n,allChapters:l,handleSelection:()=>x(!0),canBeDownloaded:_.isDownloadable({chapter:n,downloadChapter:o})})})]})}})})};function yr(t){const{t:r}=I(),{chapterIndex:a,mangaId:s}=t;return e.jsxs(zt,{component:Q,variant:"extended",color:"primary",to:"/manga/".concat(s,"/chapter/").concat(a),children:[e.jsx(Pt,{}),r(a===1?"global.button.start":"global.button.resume")]})}const wr={active:!1,unread:void 0,downloaded:void 0,bookmarked:void 0,reverse:!0,sortBy:"source",showChapterNumber:!1};function Ir(t,r){switch(r.type){case"filter":return{...t,active:t.unread!==!1&&t.downloaded!==!1&&t.bookmarked!==!1,[r.filterType]:r.filterValue};case"sortBy":return{...t,sortBy:r.sortBy};case"sortReverse":return{...t,reverse:!t.reverse};case"showChapterNumber":return{...t,showChapterNumber:!t.showChapterNumber};default:throw Error(G("global.error.label.invalid_action"))}}function Sr(t,{isRead:r}){switch(t){case!0:return!r;case!1:return r;default:return!0}}function Mr(t,{isDownloaded:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}function $r(t,{isBookmarked:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}const Rr=(t,{sortBy:r,reverse:a})=>{const s=[...t];switch(r){case"source":s.sort((n,l)=>n.sourceOrder-l.sourceOrder);break;case"fetchedAt":s.sort((n,l)=>{var o,i;return Number((o=n.fetchedAt)!=null?o:0)-Number((i=l.fetchedAt)!=null?i:0)});break;case"chapterNumber":s.sort((n,l)=>n.chapterNumber-l.chapterNumber);break;case"uploadedAt":s.sort((n,l)=>{var o,i;return Number((o=n.uploadDate)!=null?o:0)-Number((i=l.uploadDate)!=null?i:0)});break}return a&&s.reverse(),s};function Tr(t,r){const a=r.active?t.filter(s=>Sr(r.unread,s)&&Mr(r.downloaded,s)&&$r(r.bookmarked,s)):[...t];return Rr(a,r)}const Dr=t=>Xe(Ir,"".concat(t,"filterOptions"),wr),Lr={source:"global.sort.label.by_source",chapterNumber:"global.sort.label.by_chapter_number",uploadedAt:"global.sort.label.by_upload_date",fetchedAt:"global.sort.label.by_fetch_date"},Br=t=>{const{unread:r,downloaded:a,bookmarked:s}=t;return r!=null||a!=null||s!=null},Fr={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},Ar=({open:t,onClose:r,options:a,optionsDispatch:s})=>{const{t:n}=I();return e.jsx(qt,{open:t,onClose:r,minHeight:150,tabs:["filter","sort","display"],tabTitle:l=>n(Fr[l]),tabContent:l=>l==="filter"?e.jsxs(e.Fragment,{children:[e.jsx(se,{label:n("global.filter.label.unread"),checked:a.unread,onChange:o=>s({type:"filter",filterType:"unread",filterValue:o})}),e.jsx(se,{label:n("global.filter.label.downloaded"),checked:a.downloaded,onChange:o=>s({type:"filter",filterType:"downloaded",filterValue:o})}),e.jsx(se,{label:n("global.filter.label.bookmarked"),checked:a.bookmarked,onChange:o=>s({type:"filter",filterType:"bookmarked",filterValue:o})})]}):l==="sort"?Object.entries(Lr).map(([o,i])=>e.jsx(Gt,{label:n(i),checked:a.sortBy===o,sortDescending:a.reverse,onClick:()=>o!==a.sortBy?s({type:"sortBy",sortBy:o}):s({type:"sortReverse"})},o)):l==="display"?e.jsxs(Qt,{onChange:()=>s({type:"showChapterNumber"}),value:a.showChapterNumber,children:[e.jsx($e,{label:n("chapter.option.display.label.source_title"),value:!1}),e.jsx($e,{label:n("chapter.option.display.label.chapter_number"),value:!0})]}):null})},Nr=({options:t,optionsDispatch:r})=>{const{t:a}=I(),[s,n]=u.useState(!1),l=Br(t);return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:a("settings.title"),children:e.jsx(w,{onClick:()=>n(!0),children:e.jsx(Vt,{color:l?"warning":void 0})})}),e.jsx(Ar,{open:s,onClose:()=>n(!1),options:t,optionsDispatch:r})]})},Or=B(k,{shouldForwardProp:ce(["scrollbarWidth"])})(({theme:t,scrollbarWidth:r})=>({padding:t.spacing(1),paddingRight:"calc(".concat(r,"px + ").concat(t.spacing(1),")"),paddingBottom:0,[t.breakpoints.down("md")]:{paddingRight:t.spacing(1)}})),Er=B(mt,{shouldForwardProp:ce(["topOffset"])})(({theme:t,topOffset:r})=>({listStyle:"none",padding:0,[t.breakpoints.up("md")]:{height:"calc(100vh - ".concat(r,"px)"),margin:0}})),Pr=({manga:t,isRefreshing:r})=>{var _e,ye;const{t:a}=I(),{appBarHeight:s}=Ye(),n=we.useIsBelowWidth("md"),[l,o]=u.useState(50),[i,x]=u.useState(null);de(i,u.useCallback(()=>{var p;return o((p=i==null?void 0:i.offsetHeight)!=null?p:0)},[i]));const f=we.useGetScrollbarSize("width"),{data:h}=E.useGetDownloadStatus(),d=(_e=h==null?void 0:h.downloadStatus.queue)!=null?_e:[],[m,b]=Dr(t.id),{data:j,loading:c,error:g,refetch:v}=E.useGetMangaChapters(Ze,t.id,{notifyOnNetworkStatusChange:!0}),y=u.useMemo(()=>{var p;return(p=j==null?void 0:j.chapters.nodes)!=null?p:[]},[j==null?void 0:j.chapters.nodes]),P=u.useMemo(()=>y.map(p=>p.id),[y]),{areNoItemsSelected:F,areAllItemsSelected:X,selectedItemIds:S,handleSelectAll:W,handleSelection:Y}=wt(y.length,{itemIds:P,currentKey:"default"}),$=u.useMemo(()=>Tr(y,m),[y,m]),z=(ye=t.firstUnreadChapter)==null?void 0:ye.sourceOrder,Ce=q.isFullyRead(t),A=q.isFullyDownloaded(t),N=y.length===0,H=!N&&$.length===0,O=u.useMemo(()=>$.map(p=>{const R=d==null?void 0:d.find(Ke=>Ke.chapter.id===p.id),ee=F?null:S.includes(p.id);return{chapter:p,downloadChapter:R,selected:ee}}),[d,S,$]),Z=u.useMemo(()=>{const p=O.filter(R=>R.selected);return p.length?e.jsx(Wt,{selectedItemsCount:p.length,title:"chapter.title_one",children:R=>e.jsx(qe,{selectedChapters:p,onClose:R})}):z!==void 0?e.jsx(yr,{chapterIndex:z,mangaId:t.id}):null},[O]);return c||N&&r?e.jsx(k,{sx:{justifyContent:"center",alignItems:"center",position:"relative",flexGrow:1},children:e.jsx(Ne,{})}):g?e.jsx(k,{sx:{justifyContent:"center",position:"relative",flexGrow:1},children:e.jsx(K,{message:a("global.error.label.failed_to_load_data"),messageExtra:g.message,retry:()=>v().catch(Fe())})}):e.jsxs(e.Fragment,{children:[e.jsxs(k,{direction:"column",sx:{position:"relative",flexBasis:"60%"},children:[e.jsxs(Or,{ref:x,direction:"row",alignItems:"center",justifyContent:"space-between",scrollbarWidth:f,children:[e.jsx(V,{variant:"h5",component:"h3",children:"".concat($.length," ").concat(a("chapter.title_one",{count:$.length}))}),e.jsxs(k,{direction:"row",children:[e.jsx(M,{title:a("chapter.action.mark_as_read.add.label.action.current"),children:e.jsx(w,{disabled:Ce,onClick:()=>C.markAsRead(_.getChapters(_.getNonRead(O)),!0,t.id),children:e.jsx(fe,{})})}),e.jsx(ie,{variant:"popover",popupId:"chapterlist-download-button",children:p=>e.jsxs(e.Fragment,{children:[e.jsx(M,{title:a("chapter.action.download.add.label.action"),children:e.jsx(w,{disabled:A,...J(p),children:e.jsx(Be,{})})}),p.isOpen&&e.jsx(Oe,{...Ae(p),children:e.jsx(It,{mangaIds:[t.id],closeMenu:p.close})})]})}),e.jsx(Nr,{options:m,optionsDispatch:b}),e.jsx(Ut,{areAllItemsSelected:X,areNoItemsSelected:F,onChange:p=>W(p,p?y.map(R=>R.id):[])})]})]}),N&&e.jsx(K,{message:a("chapter.error.label.no_chapter_found")}),H&&e.jsx(K,{message:a("chapter.error.label.no_matches")}),e.jsx(Er,{topOffset:s+l,style:{height:"undefined"},components:{Footer:()=>e.jsx(Ee,{sx:{paddingBottom:Ht}})},totalCount:$.length,itemContent:p=>e.jsx(_r,{...O[p],allChapters:y,showChapterNumber:m.showChapterNumber,onSelect:(R,ee)=>Y(O[p].chapter.id,R,{selectRange:ee})}),useWindowScroll:n,overscan:window.innerHeight*.5})]}),Z]})},zr=t=>{const[r,a]=u.useState(!1),[s,n]=u.useState(null);return[u.useCallback(async()=>{a(!0),n(null),await Promise.all([E.getMangaFetch(t,{awaitRefetchQueries:!0}).response,E.getMangaChaptersFetch(t,{awaitRefetchQueries:!0}).response]).catch(o=>{o instanceof et&&Xt(o.message)==="no chapters found"||n(o)}).finally(()=>a(!1))},[t]),{loading:r,error:s}]};var ke={},Hr=L;Object.defineProperty(ke,"__esModule",{value:!0});var We=ke.default=void 0,Vr=Hr(D()),Gr=e;We=ke.default=(0,Vr.default)((0,Gr.jsx)("path",{d:"M21 11V3h-8l3.29 3.29-10 10L3 13v8h8l-3.29-3.29 10-10z"}),"OpenInFull");var ve={},qr=L;Object.defineProperty(ve,"__esModule",{value:!0});var Ue=ve.default=void 0,Wr=qr(D()),Ur=e;Ue=ve.default=(0,Wr.default)((0,Ur.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");const Kr=({manga:t})=>{var f,h;const{t:r}=I(),a=tt(),s=E.useGetTrackerList(rt),n=(h=(f=s.data)==null?void 0:f.trackers.nodes)!=null?h:[],l=t.trackRecords.nodes,o=ne.getLoggedIn(n),i=ne.getLoggedIn(ne.getTrackers(l,n)),x=d=>{if(s.error){oe(r("tracking.error.label.could_not_load_track_info"),"error");return}if(!o.length){a("/settings/trackingSettings");return}d()};return e.jsx(ie,{variant:"dialog",popupId:"manga-track-modal",children:d=>e.jsxs(e.Fragment,{children:[e.jsxs(ue,{...J(d),size:"medium",disabled:s.loading||!!s.error,onClick:()=>x(d.open),onTouchStart:()=>x(d.open),variant:i.length?"contained":"outlined",children:[i.length?e.jsx(Ue,{}):e.jsx(tr,{}),i.length?r("manga.button.track.active",{count:i.length}):r("manga.button.track.start")]}),e.jsx(at,{...st(d),maxWidth:"md",fullWidth:!0,scroll:"paper",children:e.jsx(St,{manga:t})})]})})},Qr=B("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(2),padding:t.spacing(1),[t.breakpoints.up("md")]:{flexBasis:"40%",height:"calc(100vh - 64px)",overflowY:"auto"}})),Jr=B("div",{shouldForwardProp:ce(["url","mangaThumbnailBackdrop"])})(({theme:t,url:r,mangaThumbnailBackdrop:a})=>({position:"relative",backgroundImage:a?"url(".concat(r,")"):void 0,backgroundRepeat:a?"no-repeat":void 0,backgroundSize:a?"cover":void 0,borderRadius:a?t.shape.borderRadius:void 0,"&::before":a&&{position:"absolute",display:"inline-block",content:'""',top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(to top, ".concat(t.palette.background.default,", transparent 100%, transparent 1px),linear-gradient(to right, ").concat(t.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to bottom, ").concat(t.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to left, ").concat(t.palette.background.default,", transparent 50%, transparent 1px)"),backdropFilter:"blur(4.5px) brightness(0.75)"}})),Xr=B("div")(({theme:t})=>({display:"flex",paddingBottom:t.spacing(1)})),Yr=B("div")(({theme:t})=>({zIndex:1,marginLeft:t.spacing(1)})),U=t=>e.jsx(Rt,{...t}),Zr=B("div")(({theme:t})=>({display:"flex",gap:t.spacing(1)})),ea=({url:t})=>{const{t:r}=I();return e.jsx(M,{title:r("global.button.open_site"),children:e.jsx(ue,{size:"medium",disabled:!t,component:rr,href:t!=null?t:void 0,target:"_blank",rel:"noreferrer",variant:"outlined",children:e.jsx(je,{})})})};function ta(t){var a;return t?Number(t.id)===0?G("source.local_source.title"):(a=t.displayName)!=null?a:t.id:G("global.label.unknown")}function Te(t){return t!=null?t:G("global.label.unknown")}const ra=({manga:t})=>{const r=le(),a=nt({variant:"popover",popupId:"manga-thumbnail-fullscreen"}),[s,n]=u.useState(),[l,o]=u.useState(null);de(l,u.useCallback(()=>n(l==null?void 0:l.clientHeight),[l]));const[i,x]=u.useState(!1),f=i&&!!s;return e.jsxs(e.Fragment,{children:[e.jsxs(k,{sx:{position:"relative",borderRadius:1,overflow:"hidden",backgroundColor:"background.paper",width:"150px",height:"".concat(f?s:225,"px"),flexShrink:0,[r.breakpoints.up("lg")]:{width:"200px",height:"".concat(f?s:300,"px")},[r.breakpoints.up("xl")]:{width:"300px",height:"".concat(f?s:450,"px")}},children:[e.jsx(Re,{ref:o,src:q.getThumbnailUrl(t),alt:"Manga Thumbnail",onImageLoad:()=>x(!0)}),i&&e.jsx(k,{...J(a),sx:{position:"absolute",top:0,bottom:0,width:"100%",justifyContent:"center",alignItems:"center",opacity:0,"&:hover":{background:"rgba(0, 0, 0, 0.4)",cursor:"pointer",opacity:1}},children:e.jsx(We,{fontSize:"large",color:"primary"})})]}),e.jsx(ot,{...lt(a),sx:{outline:0},children:e.jsx(k,{onClick:()=>a.close(),sx:{height:"100vh",py:2,outline:0,justifyContent:"center",alignItems:"center"},children:e.jsx(Re,{src:q.getThumbnailUrl(t),alt:"Manga Thumbnail",imgStyle:{height:"100%",width:"100%",objectFit:"contain"}})})})]})},De=75,aa=({manga:{description:t,genre:r}})=>{const[a,s]=u.useState(null),[n,l]=u.useState();de(a,u.useCallback(()=>l(a==null?void 0:a.clientHeight),[a]));const[o,i]=it("isDescriptionGenreCollapsed",!0),x=t?Math.min(De,n!=null?n:De):0,f=u.useMemo(()=>r.filter(Boolean),[r]);return e.jsxs(e.Fragment,{children:[t&&e.jsxs(k,{sx:{position:"relative"},children:[e.jsx(ar,{collapsedSize:x,in:!o,children:e.jsx(V,{ref:s,style:{whiteSpace:"pre-line",textAlign:"justify",textJustify:"inter-word"},children:t})}),e.jsx(k,{onClick:()=>i(!o),sx:{pt:1,alignItems:"center",cursor:"pointer",position:o?"absolute":null,width:"100%",bottom:0,background:h=>"linear-gradient(transparent 1px, ".concat(h.palette.background.default,")")},children:e.jsx(w,{sx:{color:h=>h.palette.mode==="light"?"black":"text"},children:o?e.jsx(Zt,{}):e.jsx(er,{})})})]}),e.jsx(k,{sx:{flexDirection:"row",flexWrap:o?"no-wrap":"wrap",gap:1,overflowX:o?"auto":null},children:f.map(h=>e.jsx(sr,{label:h,variant:"outlined"},h))})]})},sa=({manga:t})=>{const{t:r}=I(),{settings:{mangaThumbnailBackdrop:a}}=Le();u.useEffect(()=>{t.source||oe(G("source.error.label.source_not_found"),"error")},[t.source]);const{CategorySelectComponent:s,updateLibraryState:n}=Mt(t),l=Pe(async()=>{try{await navigator.clipboard.writeText(t.title),oe(r("global.label.copied"),"info")}catch(o){}});return e.jsxs(e.Fragment,{children:[e.jsxs(Qr,{children:[e.jsxs(Jr,{url:q.getThumbnailUrl(t),mangaThumbnailBackdrop:a,children:[e.jsxs(Xr,{children:[e.jsx(ra,{manga:t}),e.jsxs(Yr,{children:[e.jsx(V,{variant:"h5",component:"h2",sx:{mb:1,"@media not (pointer: fine)":{userSelect:"none"}},...l(),children:t.title}),e.jsx(U,{title:r("manga.label.author"),value:Te(t.author)}),e.jsx(U,{title:r("manga.label.artist"),value:Te(t.artist)}),e.jsx(U,{title:r("manga.label.status"),value:r(Jt[t.status])}),e.jsx(U,{title:r("source.title_one"),value:ta(t.source)})]})]}),e.jsxs(Zr,{children:[e.jsxs(ue,{size:"medium",onClick:n,variant:t.inLibrary?"contained":"outlined",children:[t.inLibrary?e.jsx(Yt,{}):e.jsx($t,{}),t.inLibrary?r("manga.button.in_library"):r("manga.button.add_to_library")]}),e.jsx(Kr,{manga:t}),e.jsx(ea,{url:t.realUrl})]})]}),e.jsx(aa,{manga:t})]}),s]})},na=({manga:t,onRefresh:r,refreshing:a})=>{const{t:s}=I(),n=le(),l=dt(n.breakpoints.up("sm")),[o,i]=ct.useState(null),x=!!o,f=()=>{i(null)},{openCategorySelect:h,CategorySelectComponent:d}=Tt({mangaId:t.id});return e.jsxs(e.Fragment,{children:[l&&e.jsxs(e.Fragment,{children:[e.jsx(M,{title:s("manga.label.reload_from_source"),children:e.jsx(w,{onClick:()=>{r()},disabled:a,color:"inherit",children:e.jsx(Ie,{})})}),t.inLibrary&&e.jsxs(e.Fragment,{children:[e.jsx(M,{title:s("global.button.migrate"),children:e.jsx(Q,{to:"/migrate/source/".concat(t.sourceId,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:e.jsx(w,{color:"inherit",children:e.jsx(Se,{})})})}),e.jsx(M,{title:s("manga.label.edit_categories"),children:e.jsx(w,{onClick:()=>{h(!0)},color:"inherit",children:e.jsx(Me,{})})})]})]}),!l&&e.jsxs(e.Fragment,{children:[e.jsx(w,{id:"chaptersMenuButton","aria-controls":x?"chaptersMenu":void 0,"aria-haspopup":"true","aria-expanded":x?"true":void 0,onClick:m=>i(m.currentTarget),color:"inherit",children:e.jsx(Kt,{})}),e.jsxs(Oe,{id:"chaptersMenu",anchorEl:o,open:x,onClose:f,MenuListProps:{"aria-labelledby":"chaptersMenuButton"},children:[e.jsxs(te,{onClick:()=>{r(),f()},disabled:a,children:[e.jsx(re,{children:e.jsx(Ie,{fontSize:"small"})}),e.jsx(ae,{children:s("manga.label.reload_from_source")})]}),t.inLibrary&&[e.jsxs(te,{component:Q,to:"/migrate/source/".concat(t.sourceId,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:[e.jsx(re,{children:e.jsx(Se,{fontSize:"small"})}),e.jsx(ae,{children:s("migrate.title")})]},"migrate"),e.jsxs(te,{onClick:()=>{h(!0),f()},children:[e.jsx(re,{children:e.jsx(Me,{fontSize:"small"})}),e.jsx(ae,{children:s("manga.label.edit_categories")})]},"categories")]]})]}),d]})},Wa=()=>{const{t}=I(),{setTitle:r,setAction:a}=u.useContext(ut),{id:s}=ht(),n=u.useRef(!1),{data:l,error:o,loading:i,networkStatus:x,refetch:f}=E.useGetManga(pt,s),h=gt(x),d=l==null?void 0:l.manga,[m,{loading:b,error:j}]=zr(s),c=o!=null?o:j;return u.useEffect(()=>{if(d==null)return;!n.current&&!d.initialized&&(n.current=!0,m())},[d]),u.useLayoutEffect(()=>{var g;return r((g=d==null?void 0:d.title)!=null?g:t("manga.title_one")),a(null),()=>{r(""),a(null)}},[t,d==null?void 0:d.title]),u.useLayoutEffect(()=>{var g;return a(e.jsxs(k,{direction:"row",sx:{alignItems:"center"},children:[c&&!h&&!b&&e.jsx(M,{title:e.jsxs(e.Fragment,{children:[t("manga.error.label.request_failure"),e.jsx("br",{}),(g=c.message)!=null?g:c]}),children:e.jsx(w,{onClick:()=>f(),children:e.jsx(ze,{color:"error"})})}),d&&(b||h)&&e.jsx(w,{disabled:!0,children:e.jsx(ft,{size:16})}),d&&e.jsx(na,{manga:d,onRefresh:m,refreshing:b})]})),()=>{a(null)}},[t,c,h,b,d,m]),c&&!d?e.jsx(K,{message:t("manga.error.label.request_failure"),messageExtra:c.message}):e.jsxs(Ee,{sx:{display:{md:"flex"},overflow:"hidden"},children:[i&&e.jsx(Ne,{}),d&&e.jsx(sa,{manga:d}),d&&e.jsx(Pr,{manga:d,isRefreshing:b})]})};export{Wa as Manga};
