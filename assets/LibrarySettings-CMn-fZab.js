import{u as I,r as b,e as v,j as e,aH as D,at as c,_ as R,a0 as G,$ as w,a1 as V,B as N,al as m,m as S,g as f,t as y,aD as _,b1 as F,d as H,h as O,i as L,aE as U,A,n as B,br as P,U as q}from"./index-B9sXdsff.js";import{C as X,a as $}from"./CategoriesInclusionSetting-bXjTpCZ9.js";import{C as z}from"./CheckboxInput-nGAGiIlk.js";import{N as J}from"./NumberSetting-NzOj-zwR.js";import{u as K,g as Q}from"./usePersistedValue-B6FtkoPd.js";import{S as j}from"./Switch-DIPp-SWP.js";import{L as k}from"./ListSubheader-CyIYpzGV.js";import{E as W}from"./EmptyViewAbsoluteCentered-Bt5j7wSo.js";import{u as Y}from"./useAppTitle-DSyYosGS.js";import"./ThreeStateCheckboxInput-kT5QDhvg.js";import"./Checkbox-CplIld-b.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-DktQh-yB.js";import"./SwitchBase-CNV_Zt6H.js";import"./TextField-syre69i-.js";import"./InputAdornment-DtSjeSvy.js";import"./Slider-Dw34jcFb.js";const E={excludeUnreadChapters:"library.settings.global_update.entries.label.unread_chapters",excludeNotStarted:"library.settings.global_update.entries.label.not_started",excludeCompleted:"library.settings.global_update.entries.label.completed"},Z=a=>{const r=[];return a.excludeUnreadChapters&&r.push(m(E.excludeUnreadChapters)),a.excludeNotStarted&&r.push(m(E.excludeNotStarted)),a.excludeCompleted&&r.push(m(E.excludeCompleted)),!r.length&&r.push(m("global.label.none")),r.join(", ")},ee=a=>({excludeCompleted:a.excludeCompleted,excludeNotStarted:a.excludeNotStarted,excludeUnreadChapters:a.excludeUnreadChapters}),te=({serverSettings:a})=>{const{t:r}=I(),t=ee(a),[n]=b.useUpdateServerSettings(),[i,s]=v.useState(t!=null?t:{}),[d,l]=v.useState(!1),u=Z(t),o=async()=>{const g=(t==null?void 0:t.excludeCompleted)!==i.excludeCompleted||t.excludeNotStarted!==i.excludeNotStarted||t.excludeUnreadChapters!==i.excludeUnreadChapters;if(l(!1),!!g)try{await n({variables:{input:{settings:i}}})}catch(x){S(r("global.error.label.failed_to_save_changes"),"error",f(x))}},h=()=>{s(t!=null?t:{}),l(!1)};return v.useEffect(()=>{t&&s(t)},[t==null?void 0:t.excludeCompleted,t==null?void 0:t.excludeNotStarted,t==null?void 0:t.excludeUnreadChapters]),e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:()=>l(!0),children:e.jsx(c,{primary:r("library.settings.global_update.entries.title"),secondary:u,onClick:()=>l(!0)})}),e.jsxs(R,{open:d,onClose:h,children:[e.jsxs(G,{children:[e.jsx(w,{sx:{paddingLeft:0},children:r("library.settings.global_update.entries.title")}),e.jsx(X,{children:Object.entries(i).map(([g,x])=>e.jsx(z,{label:r(E[g]),checked:x,onChange:(T,C)=>{s({...i,[g]:C})}},g))})]}),e.jsxs(V,{children:[e.jsx(N,{onClick:h,color:"primary",children:r("global.button.cancel")}),e.jsx(N,{onClick:o,color:"primary",children:r("global.button.ok")})]})]})]})},M=12,ae=6,re=24*7*4,se=({globalUpdateInterval:a})=>{const{t:r}=I(),t=a,n=!!t,[i]=b.useUpdateServerSettings(),[s,d]=K("lastGlobalUpdateInterval",M,t,Q),l=v.useCallback(o=>{d(o===0?s:o),i({variables:{input:{settings:{globalUpdateInterval:o}}}})},[s]),u=o=>{l(o?s:0)};return e.jsxs(y,{children:[e.jsxs(_,{children:[e.jsx(c,{primary:r("library.settings.global_update.auto_update.label.title")}),e.jsx(j,{edge:"end",checked:n,onChange:o=>u(o.target.checked)})]}),e.jsx(J,{settingTitle:r("library.settings.global_update.auto_update.interval.label.title"),settingValue:r("library.settings.global_update.auto_update.interval.label.value",{hours:s}),value:s,minValue:ae,maxValue:re,defaultValue:M,showSlider:!0,valueUnit:r("global.time.hour_short"),handleUpdate:l,disabled:!n})]})},le=({serverSettings:a,categories:r})=>{const{t}=I(),{updateMangas:n}=a,[i]=b.useUpdateServerSettings(),s=async(d,l)=>{try{await i({variables:{input:{settings:{[d]:l}}}})}catch(u){S(t("global.error.label.failed_to_save_changes"),"error",f(u))}};return e.jsxs(y,{subheader:e.jsx(k,{component:"div",id:"global-update-settings",children:t("library.settings.global_update.title")}),children:[e.jsx(se,{globalUpdateInterval:a.globalUpdateInterval}),e.jsx(te,{serverSettings:a}),e.jsx($,{categories:r,includeField:"includeInUpdate",dialogText:t("library.settings.global_update.categories.label.info")}),e.jsxs(_,{children:[e.jsx(c,{primary:t("library.settings.global_update.metadata.label.title"),secondary:t("library.settings.global_update.metadata.label.description")}),e.jsx(j,{edge:"end",checked:n,onChange:d=>s("updateMangas",d.target.checked)})]})]})},ie=async()=>{try{const a=await b.getMangas(P,{filter:{inLibrary:{equalTo:!1},categoryId:{isNull:!1}}}).response,r=q.getIds(a.data.mangas.nodes);r.length&&await b.updateMangasCategories(r,{clearCategories:!0}).response,S(m("library.settings.advanced.database.cleanup.label.success"),"success")}catch(a){S(m("library.settings.advanced.database.cleanup.label.error"),"error",f(a))}};function ve(){var g,x,T,C;const{t:a}=I();Y(a("library.title"));const r=b.useGetCategories(F),t=b.useGetServerSettings({notifyOnNetworkStatusChange:!0}),{settings:n,loading:i,request:{error:s,refetch:d}}=H(),l=B(p=>S(a("search.error.label.failed_to_save_settings"),"error",f(p))),u=((x=(g=r.data)==null?void 0:g.categories.nodes.length)!=null?x:1)-1;if(t.loading||i||r.loading)return e.jsx(O,{});const h=(C=(T=t.error)!=null?T:s)!=null?C:r.error;return h?e.jsx(W,{message:a("global.error.label.failed_to_load_data"),messageExtra:f(h),retry:()=>{t.error&&(t==null||t.refetch().catch(L())),s&&d().catch(L()),r.error&&r.refetch().catch(L())}}):e.jsxs(y,{sx:{pt:0},children:[e.jsxs(y,{subheader:e.jsx(k,{component:"div",id:"library-category-settings",children:a("category.title.category_other")}),children:[e.jsx(U,{to:A.settings.childRoutes.categories.path,children:e.jsx(c,{primary:a("category.dialog.title.edit_category_other"),secondary:a("category.value",{count:u})})}),e.jsxs(_,{children:[e.jsx(c,{primary:a("library.settings.general.add_to_library.category_selection.label.title"),secondary:a("library.settings.general.add_to_library.category_selection.label.description")}),e.jsx(j,{edge:"end",checked:n.showAddToLibraryCategorySelectDialog,onChange:p=>l("showAddToLibraryCategorySelectDialog",p.target.checked)})]}),e.jsxs(_,{children:[e.jsx(c,{primary:a("library.settings.general.remove_from_library.remove_from_categories.label.title"),secondary:a("library.settings.general.remove_from_library.remove_from_categories.label.description")}),e.jsx(j,{edge:"end",checked:n.removeMangaFromCategories,onChange:p=>l("removeMangaFromCategories",p.target.checked)})]})]}),e.jsx(y,{subheader:e.jsx(k,{component:"div",id:"library-general-settings",children:a("global.label.general")}),children:e.jsxs(_,{children:[e.jsx(c,{primary:a("library.settings.general.search.ignore_filters.label.title"),secondary:a("library.settings.general.search.ignore_filters.label.description")}),e.jsx(j,{edge:"end",checked:n.ignoreFilters,onChange:p=>l("ignoreFilters",p.target.checked)})]})}),e.jsx(le,{serverSettings:t.data.settings,categories:r.data.categories.nodes}),e.jsxs(y,{subheader:e.jsx(k,{component:"div",id:"library-advanced",children:a("global.label.advanced")}),children:[e.jsx(D,{onClick:()=>ie(),children:e.jsx(c,{primary:a("library.settings.advanced.database.cleanup.label.title"),secondary:a("library.settings.advanced.database.cleanup.label.description")})}),e.jsx(U,{to:A.settings.childRoutes.library.childRoutes.duplicates.path,children:e.jsx(c,{primary:a("library.settings.advanced.duplicates.label.title"),secondary:a("library.settings.advanced.duplicates.label.description")})})]})]})}export{ve as LibrarySettings};
