import{u as P,a as G,p as H,b as D,s as I,d as O,r as q,e as i,j as r,g as Q,h as F,i as B,o as A,al as V,A as W,L as z,T,av as J}from"./index-CCIw14dI.js";import{u as K,A as U,S as X}from"./AppbarSearch-BZxjdTpZ.js";import{L as Y,t as Z}from"./LanguageSelect-D9mDFDw8.js";import{u as _}from"./useDebounce-DtL6fyg2.js";import{B as ee}from"./BaseMangaGrid-CbxURP5h.js";import{E as re}from"./EmptyViewAbsoluteCentered-BYJ_1j9v.js";import{S as N}from"./Sources-DfYPKKKn.js";import{C as se}from"./Card-cqFx8CyL.js";import{C as te}from"./CardActionArea-jN0QJyDw.js";import"./ChaptersDownloadActionMenuItems-Czz4wFqt.js";import"./Trackers-D4pSmk7a.js";import"./CardContent-Cgxy_ide.js";import"./Avatar-xNeTUUku.js";import"./TextField-BGX_z3Ha.js";import"./useFormControl-i4Rdm8Nm.js";import"./formControlState-Dq1zat_P.js";import"./InputAdornment-hoHCobKI.js";import"./CheckCircle-Blha3kR6.js";import"./MUI.util-CBC1fb2m.js";import"./Link-CATq7yuI.js";import"./useManageMangaLibraryState-5xywokxs.js";import"./ThreeStateCheckboxInput-CbrfgkmF.js";import"./Checkbox-BwKGBKnK.js";import"./SwitchBase-BzGNTjsZ.js";import"./CheckboxInput-D7naHIgO.js";import"./FormGroup-Bz-ngFVw.js";import"./ListPreference-DPhEBpTD.js";import"./NumberSetting-Cs7VzGeC.js";import"./Slider-CkILtmOS.js";import"./useMobilePicker-DBT-RlKk.js";import"./Chip-BEvVGJSN.js";import"./SelectSetting-fJJk5y0v.js";import"./Select-D9RK5v9j.js";import"./FilterList-DPAAUA6L.js";import"./Switch-fr31DBC6.js";import"./MangaGrid-1Nnb-N7l.js";import"./Delete-C7sxCtq4.js";import"./Download-CeGXLsqD.js";import"./Sync-BDovuK0y.js";import"./ListCardAvatar-BIuMB4cn.js";import"./ListCardContent-jc_5Ywlc.js";import"./PlayArrow-Dg7ZaShp.js";import"./StyledFab-DL8VdI0Z.js";const oe=(a,m)=>a.displayName.localeCompare(m.displayName),ae=(a,m,e)=>{const t=e.get(a.id),s=e.get(m.id),p=!(t!=null&&t.isLoading),c=!!(t!=null&&t.error),l=!(t!=null&&t.hasResults)&&!c,S=!(s!=null&&s.isLoading),n=!!(s!=null&&s.error),d=!(s!=null&&s.hasResults)&&!n;return p&&!S?-1:!p&&S||l&&!d?1:d&&!l||!c&&n?-1:c&&!n?1:0},ne=1e3,ie=V.memo(({source:a,onSearchRequestFinished:m,searchString:e,emptyQuery:t,mode:s})=>{var E,M;const{t:p}=P(),{id:c,displayName:l,lang:S}=a,n=i.useRef(e),d=i.useRef(()=>{});n.current!==e&&(n.current=e,d.current(new Error("SourceSearchPreview(".concat(c,", ").concat(l,"): search string changed"))));const[g,j]=q.useSourceSearch(c,e!=null?e:"",void 0,1,{skipRequest:!e,addAbortSignal:!0}),{data:x,isLoading:f,error:o,abortRequest:b}=j[0];d.current=b;const L=(M=(E=x==null?void 0:x.fetchSourceManga)==null?void 0:E.mangas)!=null?M:[],y=!o&&!f&&!L.length;i.useEffect(()=>{m(a,{isLoading:f,hasResults:!y,emptySearch:!e,error:o})},[f,y,e,o]);let h;return o?h=p("search.error.label.source_search_failed"):y&&(h=p("manga.error.label.no_mangas_found")),!f&&!e||t?null:r.jsxs(r.Fragment,{children:[r.jsx(se,{sx:{mb:1},children:r.jsxs(te,{component:z,to:"".concat(W.sources.childRoutes.browse.path(c),"?query=").concat(e),sx:{p:3},children:[r.jsx(T,{variant:"h5",children:l}),r.jsx(T,{variant:"caption",children:Z(S)})]})}),h?r.jsx(J,{sx:{alignItems:"start",height:void 0},noFaces:!0,message:h,messageExtra:F(o),retry:o?()=>g(1).catch(B("SourceSearchPreview(".concat(a.id,")::refetch"))):void 0}):r.jsx(ee,{gridWrapperProps:{sx:{px:0}},mangas:L,isLoading:f,hasNextPage:!1,loadMore:()=>{},horizontal:!0,noFaces:!0,message:h,inLibraryIndicator:!0,mode:s})]})}),Xe=()=>{const{t:a}=P(),{setTitle:m,setAction:e}=G(),{pathname:t,state:s}=H(),p=t.startsWith("/migrate/source"),c=s==null?void 0:s.mangaTitle,[l]=K("query",X),S=_(l,ne),[n,d]=D("shownSourceLangs",I()),{settings:{showNsfw:w}}=O(),{data:g,loading:j,error:x,refetch:f}=q.useGetSourceList({notifyOnNetworkStatusChange:!0}),o=i.useMemo(()=>{var u;return(u=g==null?void 0:g.sources.nodes)!=null?u:[]},[g==null?void 0:g.sources.nodes]),b=i.useMemo(()=>N.filter(o,{showNsfw:w,languages:n,keepLocalSource:!0}),[o,n]),L=i.useMemo(()=>[...b].toSorted(oe),[b]),[y,h]=i.useState(new Map),E=_(y,500),M=i.useMemo(()=>N.getLanguages(o),[o]),C=i.useMemo(()=>[...L].sort((u,R)=>ae(u,R,E)),[L,E]),k=i.useCallback(({id:u},R)=>{h($=>{const v=new Map($);return v.set(u,R),v})},[h]);return i.useLayoutEffect(()=>(m(a(p?"migrate.search.title":"search.title.global_search",{title:c})),e(r.jsxs(r.Fragment,{children:[r.jsx(U,{isClosable:!1}),r.jsx(Y,{selectedLanguages:n,setSelectedLanguages:d,languages:M})]})),()=>{m(""),e(null)}),[a,n,d,o]),j?r.jsx(Q,{}):x?r.jsx(re,{message:a("global.error.label.failed_to_load_data"),messageExtra:F(x),retry:()=>f().catch(B())}):r.jsx(A,{sx:{p:1},children:C.map((u,R)=>r.jsx(A,{sx:{pb:R+1!==C.length?2:0},children:r.jsx(ie,{source:u,onSearchRequestFinished:k,searchString:S,emptyQuery:!l,mode:p?"migrate.select":"source"})},u.id))})};export{Xe as SearchAll};
