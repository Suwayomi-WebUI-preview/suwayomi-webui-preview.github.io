import{u as I,r as p,e as _,j as e,aI as w,ar as c,D as G,n as V,l as F,aE as O,B as M,ab as x,m as C,h as S,w as m,aD as j,a as H,b2 as B,d as q,g as P,i as L,aF as U,A as D,q as X,bn as z,X as J}from"./index-DWz4TNtd.js";import{C as K,a as Q}from"./CategoriesInclusionSetting-BRkWbGd6.js";import{C as W}from"./CheckboxInput-DJhQhiao.js";import{N as Y}from"./NumberSetting-f5eDW7ri.js";import{u as Z,g as $}from"./usePersistedValue-Cygu5yUa.js";import{S as f}from"./Switch-D7_BGcgb.js";import{L as k}from"./ListSubheader-Fa3Lxm1G.js";import{E as ee}from"./EmptyViewAbsoluteCentered-DPrnddnF.js";import"./ThreeStateCheckboxInput-bOClE9Pj.js";import"./Checkbox-BBcQZP1l.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-BeXl2Zas.js";import"./SwitchBase-DdFM11Au.js";import"./TextField-p1pWQlzT.js";import"./InputAdornment-D2Hu2W11.js";import"./Slider-DpJVGl_w.js";const E={excludeUnreadChapters:"library.settings.global_update.entries.label.unread_chapters",excludeNotStarted:"library.settings.global_update.entries.label.not_started",excludeCompleted:"library.settings.global_update.entries.label.completed"},te=t=>{const r=[];return t.excludeUnreadChapters&&r.push(x(E.excludeUnreadChapters)),t.excludeNotStarted&&r.push(x(E.excludeNotStarted)),t.excludeCompleted&&r.push(x(E.excludeCompleted)),!r.length&&r.push(x("global.label.none")),r.join(", ")},ae=t=>({excludeCompleted:t.excludeCompleted,excludeNotStarted:t.excludeNotStarted,excludeUnreadChapters:t.excludeUnreadChapters}),re=({serverSettings:t})=>{const{t:r}=I(),a=ae(t),[n]=p.useUpdateServerSettings(),[s,l]=_.useState(a!=null?a:{}),[d,o]=_.useState(!1),g=te(a),i=async()=>{const b=(a==null?void 0:a.excludeCompleted)!==s.excludeCompleted||a.excludeNotStarted!==s.excludeNotStarted||a.excludeUnreadChapters!==s.excludeUnreadChapters;if(o(!1),!!b)try{await n({variables:{input:{settings:s}}})}catch(h){C(r("global.error.label.failed_to_save_changes"),"error",S(h))}},y=()=>{l(a!=null?a:{}),o(!1)};return _.useEffect(()=>{a&&l(a)},[a==null?void 0:a.excludeCompleted,a==null?void 0:a.excludeNotStarted,a==null?void 0:a.excludeUnreadChapters]),e.jsxs(e.Fragment,{children:[e.jsx(w,{onClick:()=>o(!0),children:e.jsx(c,{primary:r("library.settings.global_update.entries.title"),secondary:g,onClick:()=>o(!0)})}),e.jsxs(G,{open:d,onClose:y,children:[e.jsxs(V,{children:[e.jsx(F,{sx:{paddingLeft:0},children:r("library.settings.global_update.entries.title")}),e.jsx(K,{children:Object.entries(s).map(([b,h])=>e.jsx(W,{label:r(E[b]),checked:h,onChange:(T,v)=>{l({...s,[b]:v})}},b))})]}),e.jsxs(O,{children:[e.jsx(M,{onClick:y,color:"primary",children:r("global.button.cancel")}),e.jsx(M,{onClick:i,color:"primary",children:r("global.button.ok")})]})]})]})},R=12,se=6,le=24*7*4,ne=({globalUpdateInterval:t})=>{const{t:r}=I(),a=t,n=!!a,[s]=p.useUpdateServerSettings(),[l,d]=Z("lastGlobalUpdateInterval",R,a,$),o=_.useCallback(i=>{d(i===0?l:i),s({variables:{input:{settings:{globalUpdateInterval:i}}}})},[l]),g=i=>{o(i?l:0)};return e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsx(c,{primary:r("library.settings.global_update.auto_update.label.title")}),e.jsx(f,{edge:"end",checked:n,onChange:i=>g(i.target.checked)})]}),e.jsx(Y,{settingTitle:r("library.settings.global_update.auto_update.interval.label.title"),settingValue:r("library.settings.global_update.auto_update.interval.label.value",{hours:l}),value:l,minValue:se,maxValue:le,defaultValue:R,showSlider:!0,valueUnit:r("global.time.hour_short"),handleUpdate:o,disabled:!n})]})},ie=({serverSettings:t,categories:r})=>{const{t:a}=I(),{updateMangas:n}=t,[s]=p.useUpdateServerSettings(),l=async(d,o)=>{try{await s({variables:{input:{settings:{[d]:o}}}})}catch(g){C(a("global.error.label.failed_to_save_changes"),"error",S(g))}};return e.jsxs(m,{subheader:e.jsx(k,{component:"div",id:"global-update-settings",children:a("library.settings.global_update.title")}),children:[e.jsx(ne,{globalUpdateInterval:t.globalUpdateInterval}),e.jsx(re,{serverSettings:t}),e.jsx(Q,{categories:r,includeField:"includeInUpdate",dialogText:a("library.settings.global_update.categories.label.info")}),e.jsxs(j,{children:[e.jsx(c,{primary:a("library.settings.global_update.metadata.label.title"),secondary:a("library.settings.global_update.metadata.label.description")}),e.jsx(f,{edge:"end",checked:n,onChange:d=>l("updateMangas",d.target.checked)})]})]})},oe=async()=>{try{const t=await p.getMangas(z,{filter:{inLibrary:{equalTo:!1},categoryId:{isNull:!1}}}).response,r=J.getIds(t.data.mangas.nodes);r.length&&await p.updateMangasCategories(r,{clearCategories:!0}).response,C(x("library.settings.advanced.database.cleanup.label.success"),"success")}catch(t){C(x("library.settings.advanced.database.cleanup.label.error"),"error",S(t))}};function ke(){var T,v,N,A;const{t}=I(),{setTitle:r,setAction:a}=H();_.useLayoutEffect(()=>(r(t("library.title")),a(null),()=>{r(""),a(null)}),[t]);const n=p.useGetCategories(B),s=p.useGetServerSettings({notifyOnNetworkStatusChange:!0}),{settings:l,loading:d,request:{error:o,refetch:g}}=q(),i=X(u=>C(t("search.error.label.failed_to_save_settings"),"error",S(u))),y=((v=(T=n.data)==null?void 0:T.categories.nodes.length)!=null?v:1)-1;if(s.loading||d||n.loading)return e.jsx(P,{});const h=(A=(N=s.error)!=null?N:o)!=null?A:n.error;return h?e.jsx(ee,{message:t("global.error.label.failed_to_load_data"),messageExtra:S(h),retry:()=>{s.error&&(s==null||s.refetch().catch(L())),o&&g().catch(L()),n.error&&n.refetch().catch(L())}}):e.jsxs(m,{sx:{pt:0},children:[e.jsxs(m,{subheader:e.jsx(k,{component:"div",id:"library-category-settings",children:t("category.title.category_other")}),children:[e.jsx(U,{to:D.settings.childRoutes.categories.path,children:e.jsx(c,{primary:t("category.dialog.title.edit_category_other"),secondary:t("category.value",{count:y})})}),e.jsxs(j,{children:[e.jsx(c,{primary:t("library.settings.general.add_to_library.category_selection.label.title"),secondary:t("library.settings.general.add_to_library.category_selection.label.description")}),e.jsx(f,{edge:"end",checked:l.showAddToLibraryCategorySelectDialog,onChange:u=>i("showAddToLibraryCategorySelectDialog",u.target.checked)})]}),e.jsxs(j,{children:[e.jsx(c,{primary:t("library.settings.general.remove_from_library.remove_from_categories.label.title"),secondary:t("library.settings.general.remove_from_library.remove_from_categories.label.description")}),e.jsx(f,{edge:"end",checked:l.removeMangaFromCategories,onChange:u=>i("removeMangaFromCategories",u.target.checked)})]})]}),e.jsx(m,{subheader:e.jsx(k,{component:"div",id:"library-general-settings",children:t("global.label.general")}),children:e.jsxs(j,{children:[e.jsx(c,{primary:t("library.settings.general.search.ignore_filters.label.title"),secondary:t("library.settings.general.search.ignore_filters.label.description")}),e.jsx(f,{edge:"end",checked:l.ignoreFilters,onChange:u=>i("ignoreFilters",u.target.checked)})]})}),e.jsx(ie,{serverSettings:s.data.settings,categories:n.data.categories.nodes}),e.jsxs(m,{subheader:e.jsx(k,{component:"div",id:"library-advanced",children:t("global.label.advanced")}),children:[e.jsx(w,{onClick:()=>oe(),children:e.jsx(c,{primary:t("library.settings.advanced.database.cleanup.label.title"),secondary:t("library.settings.advanced.database.cleanup.label.description")})}),e.jsx(U,{to:D.settings.childRoutes.library.childRoutes.duplicates.path,children:e.jsx(c,{primary:t("library.settings.advanced.duplicates.label.title"),secondary:t("library.settings.advanced.duplicates.label.description")})})]})]})}export{ke as LibrarySettings};
