import{W as H,u as F,a as T,c as n,j as t,L as I,T as v,az as O,h as P,N as z,ap as Q,d as _,g as V,E as W}from"./index-BpnB-2Sx.js";import{u as J,A as K,S as U}from"./AppbarSearch-W6TbpMzb.js";import{s as A,l as X,a as Y}from"./language-xC-ctCgZ.js";import{t as Z,L as ee}from"./LangSelect-CApE2DPG.js";import{u as B}from"./useDebounce-Db0sTAK0.js";import{B as te}from"./BaseMangaGrid-CY_csyM2.js";import{C as re}from"./Card-BQb1wMaJ.js";import{C as se}from"./CardActionArea-bBiiV_nl.js";import"./useManageMangaLibraryState-Chvov7rZ.js";import"./Trackers-D4pSmk7a.js";import"./CardContent-C0_Kxsn8.js";import"./Avatar-BKFjhfbz.js";import"./Info-DbPVBl1M.js";import"./TextField-O-1jJIHz.js";import"./InputAdornment-Bi99TiTi.js";import"./CheckCircle-C3Lp8bOE.js";import"./SpinnerImage-BBhnUIig.js";import"./TypographyMaxLines-CmsTVwKa.js";import"./Collapse-BLUPv8TT.js";import"./Link-u1UJiuMA.js";import"./ListPreference-BtanAq4A.js";import"./Checkbox-CWmJpaSV.js";import"./SwitchBase-DzUOJTof.js";import"./NumberSetting-C6xZACiC.js";import"./useMobilePicker-DjQFPPuc.js";import"./Chip-CYJzPoEL.js";import"./SelectSetting-DqOm2l1m.js";import"./Select-kDTvHoad.js";import"./CheckboxInput-Z2Eeh6Vu.js";import"./Mangas-BLBn37Jq.js";import"./Chapters-D38Wlj-S.js";import"./ThreeStateCheckboxInput-DnNwkmTY.js";import"./FilterList-Cdwlk2mf.js";import"./cloneObject-DrOPTG0J.js";import"./Switch-D0JrBK31.js";import"./MangaGrid-Bk-v5C6w.js";import"./index-CpKxU2oX.js";import"./Delete-DYe6nni0.js";import"./Sync-Dq6jG5sn.js";import"./PlayArrow-6P_3P1Za.js";import"./StyledFab-CsQcFFk7.js";function oe(r){const s=[];return r.forEach(e=>{s.indexOf(e.lang)===-1&&s.push(e.lang)}),s.sort(X),s}const ae=(r,s)=>r.displayName<s.displayName?-1:r.displayName>s.displayName?1:0,ne=(r,s,e)=>{var l,h,a,p;const g=!((l=e.get(r.id))!=null&&l.isLoading),i=!((h=e.get(s.id))!=null&&h.isLoading);if(g&&!i)return-1;if(!g&&i)return 1;if(!g&&!i)return 0;const m=!((a=e.get(r.id))!=null&&a.hasResults),u=!((p=e.get(s.id))!=null&&p.hasResults);return m&&!u?1:u&&!m?-1:0},ie=1e3,ce=H.memo(({source:r,onSearchRequestFinished:s,searchString:e,emptyQuery:g,mode:i})=>{var L,y;const{t:m}=F(),{id:u,displayName:l,lang:h}=r,[a,p]=T.useSourceSearch(u,e!=null?e:"",void 0,1,{skipRequest:!e,addAbortSignal:!0}),{data:S,isLoading:c,error:x,abortRequest:w}=p[0],j=(y=(L=S==null?void 0:S.fetchSourceManga)==null?void 0:L.mangas)!=null?y:[],d=!c&&!j.length;n.useEffect(()=>{s(r,c,!d,!e)},[c,d,e]);let f;return x?f=m("search.error.label.source_search_failed"):d&&(f=m("manga.error.label.no_mangas_found")),n.useEffect(()=>()=>{w(new Error("SourceSearchPreview(".concat(u,", ").concat(l,"): search string changed")))},[e]),!c&&!e||g?null:t.jsxs(t.Fragment,{children:[t.jsx(re,{sx:{margin:"10px"},children:t.jsxs(se,{component:I,to:"/sources/".concat(u,"?query=").concat(e),sx:{p:3},children:[t.jsx(v,{variant:"h5",children:l}),t.jsx(v,{variant:"caption",children:Z(h)})]})}),f?t.jsx(O,{sx:{alignItems:"start",height:void 0},noFaces:!0,message:f,messageExtra:x&&x.message,retry:x?()=>a(1).catch(P("SourceSearchPreview(".concat(r.id,")::refetch"))):void 0}):t.jsx(te,{mangas:j,isLoading:c,hasNextPage:!1,loadMore:()=>{},horizontal:!0,noFaces:!0,message:f,inLibraryIndicator:!0,mode:i})]})}),Ue=()=>{var R;const{t:r}=F(),{setTitle:s,setAction:e}=n.useContext(z),{pathname:g,state:i}=Q(),m=g.startsWith("/migrate/source"),u=i==null?void 0:i.mangaTitle,[l]=J("query",U),h=B(l,ie),[a,p]=_("shownSourceLangs",Y()),[S]=_("showNsfw",!0),{data:c,loading:x,error:w,refetch:j}=T.useGetSourceList({notifyOnNetworkStatusChange:!0}),d=(R=c==null?void 0:c.sources.nodes)!=null?R:[],[f,L]=n.useState(new Map),y=B(f,500),N=n.useMemo(()=>[...d].sort(ae),[d]),b=n.useMemo(()=>N.filter(o=>a.includes(o.lang)),[N,a]),M=n.useMemo(()=>b.filter(o=>S||!o.isNsfw),[b,S]),q=n.useMemo(()=>[...M].sort((o,E)=>ne(o,E,y)),[M,y]),D=n.useCallback(({id:o},E,$,k)=>{L(G=>{const C=new Map(G);return C.set(o,{isLoading:E,hasResults:$,emptySearch:k}),C})},[L]);return n.useEffect(()=>(s(r(m?"migrate.search.title":"search.title.global_search",{title:u})),e(t.jsxs(t.Fragment,{children:[t.jsx(K,{isClosable:!1}),t.jsx(ee,{shownLangs:a,setShownLangs:p,allLangs:oe(d),forcedLangs:A()})]})),()=>{s(""),e(null)}),[r,a,p,d]),n.useEffect(()=>{const o=A().filter(E=>!a.includes(E));p([...a,...o])},[]),x?t.jsx(V,{}):w?t.jsx(W,{message:r("global.error.label.failed_to_load_data"),messageExtra:w.message,retry:()=>j().catch(P())}):t.jsx(t.Fragment,{children:q.map(o=>t.jsx(ce,{source:o,onSearchRequestFinished:D,searchString:h,emptyQuery:!l,mode:m?"migrate.select":"source"},o.id))})};export{Ue as SearchAll};
