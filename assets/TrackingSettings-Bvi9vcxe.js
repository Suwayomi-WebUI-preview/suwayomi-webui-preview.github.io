import{_ as k,Z as y,s as S,a1 as p,c,a2 as A,a3 as w,be as U,j as t,a4 as F,a5 as P,u as _,a as x,y as M,az as R,z as N,U as I,bf as D,H as E,J as W,ar as $,as as B,at as O,b as f,n as b,N as z,E as H,h as J,v,am as C,aH as V}from"./index-B5aGC8by.js";import{P as q}from"./PasswordTextField-DR2yo-ck.js";import{A as G}from"./Avatar-inmYLceb.js";import{C as Z}from"./Chip-XYuVsKGf.js";import{T as K}from"./TextField-DydWwQbC.js";import{u as Q,c as X}from"./metadataServerSettings-nxgrz9XV.js";import{S as T}from"./Switch-BPPAyCDb.js";import"./InputAdornment-zC2HI-g-.js";import"./metadata-Bm3ZnyOZ.js";import"./SwitchBase-SMFwHQ07.js";function Y(e){return k("MuiListItemAvatar",e)}y("MuiListItemAvatar",["root","alignItemsFlexStart"]);const ee=["className"],te=e=>{const{alignItems:s,classes:n}=e;return P({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},Y,n)},se=S("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[s.root,n.alignItems==="flex-start"&&s.alignItemsFlexStart]}})(({ownerState:e})=>p({minWidth:56,flexShrink:0},e.alignItems==="flex-start"&&{marginTop:8})),ae=c.forwardRef(function(s,n){const i=A({props:s,name:"MuiListItemAvatar"}),{className:d}=i,r=w(i,ee),m=c.useContext(U),o=p({},i,{alignItems:m.alignItems}),u=te(o);return t.jsx(se,p({className:F(u.root,d),ownerState:o,ref:n},r))}),ne=ae,ie=({tracker:e})=>{const{t:s}=_(),[n,{loading:i}]=x.useLoginToTrackerCredentials(),[d]=x.useLogoutFromTracker(),[r,m]=c.useState(""),[o,u]=c.useState(""),g=!e.isLoggedIn&&!!e.authUrl,l=async()=>{try{await d({variables:{trackerId:e.id}})}catch(a){b(s("tracking.action.logout.label.failure",{name:e.name}),"error")}},j=async()=>{if(g){const a={redirectUrl:"".concat(window.location.origin,"/tracker/login/oauth"),clientName:"Suwayomi-WebUI",trackerId:e.id,trackerName:e.name};window.open("".concat(e.authUrl,"&state=").concat(JSON.stringify(a)),"_self");return}try{await n({variables:{input:{trackerId:e.id,username:r,password:o}}})}catch(a){b(s("tracking.action.login.label.failure",{name:e.name}),"error")}},L=a=>{if(!g){a();return}j()};return t.jsx(M,{variant:"popover",popupId:"tracker-dialog",children:a=>t.jsxs(t.Fragment,{children:[t.jsxs(R,{...N(a),onClick:()=>L(a.open),onTouchStart:()=>L(a.open),children:[t.jsx(ne,{sx:{paddingRight:"20px"},children:t.jsx(G,{alt:"".concat(e.name),src:x.getValidImgUrlFor(e.icon),variant:"rounded",sx:{width:64,height:64}})}),t.jsx(I,{primary:e.name}),e.isLoggedIn&&t.jsx(D,{children:t.jsx(Z,{label:s("global.label.logged_in"),color:"success"})})]}),t.jsxs(E,{...W(a),open:(e.isLoggedIn||!e.authUrl)&&a.isOpen,disableRestoreFocus:!0,children:[t.jsx($,{children:s(e.isLoggedIn?"tracking.settings.dialog.title.log_out":"tracking.settings.dialog.title.log_in",{name:e.name})}),!g&&!e.isLoggedIn&&t.jsxs(B,{children:[t.jsx(K,{autoFocus:!0,margin:"dense",id:"username",name:"username",label:s("global.label.username"),type:"text",fullWidth:!0,variant:"standard",onChange:h=>m(h.target.value)}),t.jsx(q,{margin:"dense",fullWidth:!0,variant:"standard",onChange:h=>u(h.target.value)})]}),t.jsxs(O,{children:[t.jsx(f,{onClick:a.close,children:s("global.button.cancel")}),t.jsx(f,{variant:"contained",disabled:!g&&!e.isLoggedIn&&(i||!r.length||!o.length),onClick:()=>e.isLoggedIn?l():j(),children:s(e.isLoggedIn?"global.button.log_out":"global.button.log_in")})]})]})]})})},pe=()=>{var g;const{t:e}=_(),{setTitle:s}=c.useContext(z);c.useEffect(()=>{s(e("tracking.settings.title.settings"))},[e]);const{settings:{updateProgressAfterReading:n,updateProgressManualMarkRead:i}}=Q(),d=X(()=>b(e("global.error.label.failed_to_save_changes"),"error")),{data:r,loading:m,error:o}=x.useGetTrackerList(),u=(g=r==null?void 0:r.trackers.nodes)!=null?g:[];return o?t.jsx(H,{message:o.message}):m?t.jsx(J,{}):t.jsxs(t.Fragment,{children:[t.jsxs(v,{children:[t.jsxs(C,{children:[t.jsx(I,{primary:e("tracking.settings.label.update_progress_reading")}),t.jsx(T,{edge:"end",checked:n,onChange:l=>d("updateProgressAfterReading",l.target.checked)})]}),t.jsxs(C,{children:[t.jsx(I,{primary:e("tracking.settings.label.update_progress_manual"),secondary:e("tracking.settings.label.update_progress_reading_description")}),t.jsx(T,{edge:"end",checked:i,onChange:l=>d("updateProgressManualMarkRead",l.target.checked)})]})]}),t.jsx(v,{subheader:t.jsx(V,{component:"div",id:"tracking-trackers",children:e("tracking.settings.title.trackers")}),children:u.map(l=>t.jsx(ie,{tracker:l},l.id))})]})};export{pe as TrackingSettings};
