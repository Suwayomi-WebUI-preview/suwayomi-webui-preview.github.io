import{aN as A,aO as M,e as x,bw as R,bx as P,j as t,Y as U,aP as F,aQ as E,u as w,b as N,r as f,a2 as D,aH as B,a3 as O,aq as v,by as q,D as G,a9 as W,l as $,n as H,aD as V,B as T,m as C,h as L,a as J,d as K,G as Q,i as S,g as Y,w as k,aC as y,q as z}from"./index-CYOaxZB1.js";import{E as X}from"./EmptyViewAbsoluteCentered-BmMNAYoe.js";import{P as Z}from"./PasswordTextField-Z_jA16JT.js";import{T as h}from"./Trackers-D4pSmk7a.js";import{A as ee}from"./Avatar-BomZ50rK.js";import{C as te}from"./Chip-DJmUFZRX.js";import{T as se}from"./TextField-CYDwjkWd.js";import{S as _}from"./Switch-BRTW7lbV.js";import{L as ae}from"./ListSubheader-DlGh4cQf.js";import"./InputAdornment-Bi-fftNR.js";import"./useFormControl-5b4-eLM3.js";import"./formControlState-Dq1zat_P.js";import"./SwitchBase-DVyqG6ME.js";function re(e){return A("MuiListItemAvatar",e)}M("MuiListItemAvatar",["root","alignItemsFlexStart"]);const ne=e=>{const{alignItems:s,classes:r}=e;return E({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},re,r)},oe=U("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:r}=e;return[s.root,r.alignItems==="flex-start"&&s.alignItemsFlexStart]}})({minWidth:56,flexShrink:0,variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}),ie=x.forwardRef(function(s,r){const l=R({props:s,name:"MuiListItemAvatar"}),{className:m,...n}=l,c=x.useContext(P),g={...l,alignItems:c.alignItems},o=ne(g);return t.jsx(oe,{className:F(o.root,m),ownerState:g,ref:r,...n})}),le=({tracker:e})=>{const{t:s}=w(),[r]=N("serverBaseURL",window.location.origin),[l,{loading:m}]=f.useLoginToTrackerCredentials(),[n]=f.useLogoutFromTracker(),[c,g]=x.useState(""),[o,I]=x.useState(""),d=!e.isLoggedIn&&!!e.authUrl,b=async()=>{try{await n({variables:{trackerId:e.id}})}catch(a){C(s("tracking.action.logout.label.failure",{name:e.name}),"error",L(a))}},p=async()=>{if(d){const a={redirectUrl:"".concat(r,"/tracker/login/oauth"),clientName:"Suwayomi-WebUI",trackerId:e.id,trackerName:e.name};window.open("".concat(e.authUrl,"&state=").concat(JSON.stringify(a)),"_self");return}try{await l({variables:{input:{trackerId:e.id,username:c,password:o}}})}catch(a){C(s("tracking.action.login.label.failure",{name:e.name}),"error",L(a))}},j=a=>{if(!d){a();return}p()};return t.jsx(D,{variant:"popover",popupId:"tracker-dialog",children:a=>t.jsxs(t.Fragment,{children:[t.jsxs(B,{...O(a),onClick:()=>j(a.open),children:[t.jsx(ie,{sx:{paddingRight:"20px"},children:t.jsx(ee,{alt:"".concat(e.name),src:f.getValidImgUrlFor(e.icon),variant:"rounded",sx:{width:64,height:64}})}),t.jsx(v,{primary:e.name}),h.isLoggedIn(e)&&t.jsx(q,{children:t.jsx(te,{label:s("global.label.logged_in"),color:"success"})})]}),t.jsxs(G,{...W(a),open:(h.isLoggedIn(e)||!e.authUrl)&&a.isOpen,disableRestoreFocus:!0,children:[t.jsx($,{children:s(h.isLoggedIn(e)?"tracking.settings.dialog.title.log_out":"tracking.settings.dialog.title.log_in",{name:e.name})}),!d&&!e.isLoggedIn&&t.jsxs(H,{children:[t.jsx(se,{autoFocus:!0,margin:"dense",id:"username",name:"username",label:s("global.label.username"),type:"text",fullWidth:!0,variant:"standard",onChange:u=>g(u.target.value)}),t.jsx(Z,{margin:"dense",fullWidth:!0,variant:"standard",onChange:u=>I(u.target.value)})]}),t.jsxs(V,{children:[t.jsx(T,{onClick:a.close,children:s("global.button.cancel")}),t.jsx(T,{variant:"contained",disabled:!d&&!e.isLoggedIn&&(m||!c.length||!o.length),onClick:()=>h.isLoggedIn(e)?b():p(),children:s(h.isLoggedIn(e)?"global.button.log_out":"global.button.log_in")})]})]})]})})},ve=()=>{var u;const{t:e}=w(),{setTitle:s}=J();x.useLayoutEffect(()=>{s(e("tracking.title"))},[e]);const{settings:{updateProgressAfterReading:r,updateProgressManualMarkRead:l},loading:m,request:{error:n,refetch:c}}=K(),g=z(i=>C(e("global.error.label.failed_to_save_changes"),"error",L(i))),{data:o,loading:I,error:d,refetch:b}=f.useGetTrackerList(Q,{notifyOnNetworkStatusChange:!0}),p=(u=o==null?void 0:o.trackers.nodes)!=null?u:[],j=m||I,a=n!=null?n:d;return a?t.jsx(X,{message:e("global.error.label.failed_to_load_data"),messageExtra:L(a),retry:()=>{n&&c().catch(S()),d&&b().catch(S())}}):j?t.jsx(Y,{}):t.jsxs(t.Fragment,{children:[t.jsxs(k,{sx:{pt:0},children:[t.jsxs(y,{children:[t.jsx(v,{primary:e("tracking.settings.label.update_progress_reading")}),t.jsx(_,{edge:"end",checked:r,onChange:i=>g("updateProgressAfterReading",i.target.checked)})]}),t.jsxs(y,{children:[t.jsx(v,{primary:e("tracking.settings.label.update_progress_manual"),secondary:e("tracking.settings.label.update_progress_reading_description")}),t.jsx(_,{edge:"end",checked:l,onChange:i=>g("updateProgressManualMarkRead",i.target.checked)})]})]}),t.jsx(k,{subheader:t.jsx(ae,{component:"div",id:"tracking-trackers",children:e("tracking.settings.title.trackers")}),children:p.map(i=>t.jsx(le,{tracker:i},i.id))})]})};export{ve as TrackingSettings};
