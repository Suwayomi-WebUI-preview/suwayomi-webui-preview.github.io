import{bQ as Ge,bR as Pe,b as m,bS as Ee,j as t,ae as _e,bT as Ae,bU as Le,ai as Oe,ac as Ne,bV as Be,a1 as Q,ad as $e,am as Fe,ax as We,ay as xe,p as ze,bW as ie,bX as Ue,bY as Ve,O as H,z as $,a6 as He,u as q,L as Z,A as J,i as we,f as Me,d as Ke,az as Ye,a as re,k as Xe,n as Je,y as Qe,q as qe,S as z,B,m as Ze,a4 as et,C as U,I as tt,Z as L,bn as ae,T as ve,a5 as nt,a7 as ot,E as rt,M as be,e as ke,av as st}from"./index-BAZP4aha.js";import{E as it}from"./EmptyViewAbsoluteCentered-DuMOlPPS.js";import{d as at,e as ct,g as A,h as lt,j as dt,k as ut,D as ft,R as pt,F as mt,l as ye,c as ht,V as gt,M as xt}from"./useManageMangaLibraryState-DQHDbOh_.js";import{D as bt}from"./Delete-BJQ-DeGS.js";import{D as yt}from"./Download-Dcoj_SUt.js";import{a as Ct,S as jt,L as wt,T as Mt,C as vt}from"./ContinueReadingTooltip-4c0mV9HX.js";import{S as kt}from"./Sync-Dw_o_yGA.js";import{a as R,c as It,b as Rt}from"./Mangas-CX5VZC_H.js";import{u as ce}from"./use-merged-ref-D8HHT6zX.js";import{C as ne}from"./CheckboxInput-BwcIt1jH.js";import{F as St}from"./FormGroup-B5OLMjFm.js";import{S as Dt}from"./SpinnerImage-IyUGW3d7.js";import{M as X}from"./MUI.util-CEodEA2f.js";import{C as Tt}from"./Checkbox-htJ9OUXz.js";import{L as Gt}from"./Link-Cm2vT6ig.js";import{C as Ie}from"./Card-jrm6SPpH.js";import{C as Re}from"./CardActionArea-DPVx8P-e.js";import{L as Pt}from"./ListCardAvatar-DqLfmlvn.js";import{L as Et}from"./ListCardContent-BFWrYJI6.js";import{P as _t}from"./PlayArrow-DU6_iNJZ.js";import{C as At}from"./Chapters-Bf9M3acE.js";import{D as Lt}from"./StyledFab-BuiWpFA-.js";import{J as Ot}from"./index-RY_r7FNz.js";import{V as Nt}from"./Virtuoso.util-kmWo8pcP.js";const Bt=(e,n)=>e.filter(o=>n.includes(o)),K=(e,n,o)=>{const i=e.keys[0];Array.isArray(n)?n.forEach((s,r)=>{o((a,d)=>{r<=e.keys.length-1&&(r===0?Object.assign(a,d):a[e.up(e.keys[r])]=d)},s)}):n&&typeof n=="object"?(Object.keys(n).length>e.keys.length?e.keys:Bt(e.keys,Object.keys(n))).forEach(r=>{if(e.keys.includes(r)){const a=n[r];a!==void 0&&o((d,f)=>{i===r?Object.assign(d,f):d[e.up(r)]=f},a)}}):(typeof n=="number"||typeof n=="string")&&o((s,r)=>{Object.assign(s,r)},n)};function oe(e){return"--Grid-".concat(e,"Spacing")}function se(e){return"--Grid-parent-".concat(e,"Spacing")}const Ce="--Grid-columns",V="--Grid-parent-columns",$t=({theme:e,ownerState:n})=>{const o={};return K(e.breakpoints,n.size,(i,s)=>{let r={};s==="grow"&&(r={flexBasis:0,flexGrow:1,maxWidth:"100%"}),s==="auto"&&(r={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof s=="number"&&(r={flexGrow:0,flexBasis:"auto",width:"calc(100% * ".concat(s," / var(").concat(V,") - (var(").concat(V,") - ").concat(s,") * (var(").concat(se("column"),") / var(").concat(V,")))")}),i(o,r)}),o},Ft=({theme:e,ownerState:n})=>{const o={};return K(e.breakpoints,n.offset,(i,s)=>{let r={};s==="auto"&&(r={marginLeft:"auto"}),typeof s=="number"&&(r={marginLeft:s===0?"0px":"calc(100% * ".concat(s," / var(").concat(V,") + var(").concat(se("column"),") * ").concat(s," / var(").concat(V,"))")}),i(o,r)}),o},Wt=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={[Ce]:12};return K(e.breakpoints,n.columns,(i,s)=>{const r=s!=null?s:12;i(o,{[Ce]:r,"> *":{[V]:r}})}),o},zt=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return K(e.breakpoints,n.rowSpacing,(i,s)=>{var a;const r=typeof s=="string"?s:(a=e.spacing)==null?void 0:a.call(e,s);i(o,{[oe("row")]:r,"> *":{[se("row")]:r}})}),o},Ut=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return K(e.breakpoints,n.columnSpacing,(i,s)=>{var a;const r=typeof s=="string"?s:(a=e.spacing)==null?void 0:a.call(e,s);i(o,{[oe("column")]:r,"> *":{[se("column")]:r}})}),o},Vt=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return K(e.breakpoints,n.direction,(i,s)=>{i(o,{flexDirection:s})}),o},Ht=({ownerState:e})=>({minWidth:0,boxSizing:"border-box",...e.container&&{display:"flex",flexWrap:"wrap",...e.wrap&&e.wrap!=="wrap"&&{flexWrap:e.wrap},gap:"var(".concat(oe("row"),") var(").concat(oe("column"),")")}}),Kt=e=>{const n=[];return Object.entries(e).forEach(([o,i])=>{i!==!1&&i!==void 0&&n.push("grid-".concat(o,"-").concat(String(i)))}),n},Yt=(e,n="xs")=>{function o(i){return i===void 0?!1:typeof i=="string"&&!Number.isNaN(Number(i))||typeof i=="number"&&i>0}if(o(e))return["spacing-".concat(n,"-").concat(String(e))];if(typeof e=="object"&&!Array.isArray(e)){const i=[];return Object.entries(e).forEach(([s,r])=>{o(r)&&i.push("spacing-".concat(s,"-").concat(String(r)))}),i}return[]},Xt=e=>e===void 0?[]:typeof e=="object"?Object.entries(e).map(([n,o])=>"direction-".concat(n,"-").concat(o)):["direction-xs-".concat(String(e))];function Jt(e,n){e.item!==void 0&&delete e.item,e.zeroMinWidth!==void 0&&delete e.zeroMinWidth,n.keys.forEach(o=>{e[o]!==void 0&&delete e[o]})}const Qt=Be(),qt=Ge("div",{name:"MuiGrid",slot:"Root"});function Zt(e){return Le({props:e,name:"MuiGrid",defaultTheme:Qt})}function en(e={}){const{createStyledComponent:n=qt,useThemeProps:o=Zt,useTheme:i=Pe,componentName:s="MuiGrid"}=e,r=(l,c)=>{const{container:h,direction:u,spacing:x,wrap:g,size:p}=l,M={root:["root",h&&"container",g!=="wrap"&&"wrap-xs-".concat(String(g)),...Xt(u),...Kt(p),...h?Yt(x,c.breakpoints.keys[0]):[]]};return Oe(M,b=>Ne(s,b),{})};function a(l,c,h=()=>!0){const u={};return l===null||(Array.isArray(l)?l.forEach((x,g)=>{x!==null&&h(x)&&c.keys[g]&&(u[c.keys[g]]=x)}):typeof l=="object"?Object.keys(l).forEach(x=>{const g=l[x];g!=null&&h(g)&&(u[x]=g)}):u[c.keys[0]]=l),u}const d=n(Wt,Ut,zt,$t,Vt,Ht,Ft),f=m.forwardRef(function(c,h){var W,de,ue,fe,pe,me;const u=i(),x=o(c),g=Ee(x);Jt(g,u.breakpoints);const{className:p,children:M,columns:b=12,container:v=!1,component:G="div",direction:k="row",wrap:C="wrap",size:j={},offset:w={},spacing:D=0,rowSpacing:P=D,columnSpacing:T=D,unstable_level:I=0,...S}=g,E=a(j,u.breakpoints,_=>_!==!1),Y=a(w,u.breakpoints),ee=(W=c.columns)!=null?W:I?void 0:b,y=(de=c.spacing)!=null?de:I?void 0:D,F=(fe=(ue=c.rowSpacing)!=null?ue:c.spacing)!=null?fe:I?void 0:P,O=(me=(pe=c.columnSpacing)!=null?pe:c.spacing)!=null?me:I?void 0:T,N={...g,level:I,columns:ee,container:v,direction:k,wrap:C,spacing:y,rowSpacing:F,columnSpacing:O,size:E,offset:Y},te=r(N,u);return t.jsx(d,{ref:h,as:G,ownerState:N,className:_e(te.root,p),...S,children:m.Children.map(M,_=>{var he,ge;return m.isValidElement(_)&&Ae(_,["Grid"])&&v&&_.props.container?m.cloneElement(_,{unstable_level:(ge=(he=_.props)==null?void 0:he.unstable_level)!=null?ge:I+1}):_})})});return f.muiName="Grid",f}const le=en({createStyledComponent:Q("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:o}=e;return[n.root,o.container&&n.container]}}),componentName:"MuiGrid",useThemeProps:e=>$e({props:e,name:"MuiGrid"}),useTheme:Fe}),tn=m.forwardRef(({MenuItemProps:e,className:n,label:o,LeftIcon:i,renderLabel:s,RightIcon:r,...a},d)=>t.jsxs(We,{...e,ref:d,className:n,...a,children:[i&&t.jsx(xe,{children:t.jsx(i,{fontSize:"small"})}),t.jsx(ze,{children:o}),r&&t.jsx(xe,{style:{minWidth:0},children:t.jsx(r,{fontSize:"small"})})]})),Se=m.forwardRef((e,n)=>{const{parentMenuOpen:o,label:i,renderLabel:s,RightIcon:r=ie(Ve,Ue),LeftIcon:a,children:d,className:f,tabIndex:l,ContainerProps:c={},MenuProps:h,...u}=e,x=H.useIsTouchDevice(),{ref:g,...p}=c,M=m.useRef(null),b=ce(n,M),v=m.useRef(null),G=ce(g,v),k=m.useRef(null),[C,j]=m.useState(!1),w=y=>{if(C!==y){if(e.disabled){j(!1);return}j(y)}},D=y=>{x||(w(!0),p.onMouseEnter&&p.onMouseEnter(y))},P=y=>{w(!1),p.onMouseLeave&&p.onMouseLeave(y)},T=()=>{var F,O;const y=(O=(F=v.current)==null?void 0:F.ownerDocument.activeElement)!=null?O:null;if(k.current==null)return!1;for(const N of k.current.children)if(N===y)return!0;return!1},I=y=>{x||(y.target===v.current&&w(!0),p.onFocus&&p.onFocus(y))},S=y=>{w(!C),p.onClick&&p.onClick(y)},E=y=>{var O,N,te;if(y.key==="Escape")return;T()&&y.stopPropagation();const F=(O=v.current)==null?void 0:O.ownerDocument.activeElement;if(y.key==="ArrowLeft"&&T()&&((N=v.current)==null||N.focus()),y.key==="ArrowRight"&&y.target===v.current&&y.target===F){const W=(te=k.current)==null?void 0:te.children[0];W==null||W.focus()}},Y=C&&o;let ee;return e.disabled||(ee=l!==void 0?l:-1),t.jsxs($,{...p,ref:G,onFocus:I,onClick:S,tabIndex:ee,onMouseEnter:D,onMouseLeave:P,onKeyDown:E,children:[t.jsx(tn,{MenuItemProps:u,className:f,ref:b,LeftIcon:a,RightIcon:r,label:i,renderLabel:s}),t.jsx(He,{style:{pointerEvents:"none"},anchorEl:M.current,anchorOrigin:{horizontal:ie("right","left"),vertical:"top"},transformOrigin:{horizontal:ie("left","right"),vertical:"top"},open:Y,autoFocus:!1,disableAutoFocus:!0,disableEnforceFocus:!0,onClose:()=>{w(!1)},...h,children:t.jsx($,{ref:k,style:{pointerEvents:"auto"},children:d})})]})});Se.displayName="NestedMenuItem";const nn=["remove_from_library"],on=({manga:e,handleSelection:n,selectedMangas:o,onClose:i,setHideMenu:s})=>{var P,T;const{t:r}=q(),[a,d]=m.useState(!1),f=!!e,l=o!=null?o:[],c=dt(f,It),h=ct(f),u=ut(f),x=!!e&&e.downloadCount===e.chapters.totalCount,g=!!(e!=null&&e.downloadCount),p=!!(e!=null&&e.unreadCount),M=!!e&&e.unreadCount!==e.chapters.totalCount,{openCategorySelect:b,CategorySelectComponent:v}=at({mangaId:e==null?void 0:e.id,mangaIds:o?R.getIds(l):void 0,onClose:()=>i(!0),addToLibrary:!1}),G=()=>{n==null||n(e.id,!0),i(!0)},k=(I,S)=>{R.performAction(I,e?[e.id]:R.getIds(S),{wasManuallyMarkedAsRead:!0}).catch(Me()),i(!nn.includes(I))},{downloadableMangas:C,downloadedMangas:j,unreadMangas:w,readMangas:D}=m.useMemo(()=>({downloadableMangas:[...R.getNotDownloaded(l),...R.getPartiallyDownloaded(l)],downloadedMangas:[...R.getPartiallyDownloaded(l),...R.getFullyDownloaded(l)],unreadMangas:[...R.getUnread(l),...R.getPartiallyRead(l)],readMangas:[...R.getPartiallyRead(l),...R.getFullyRead(l)]}),[l]);return t.jsxs(t.Fragment,{children:[!!n&&f&&t.jsx(A,{onClick:G,Icon:lt,title:r("chapter.action.label.select")}),h(!x)&&t.jsx(Se,{disabled:u(!C.length),LeftIcon:yt,label:c("download",C.length),parentMenuOpen:!0,children:t.jsx(Ct,{mangaIds:f?[e.id]:R.getIds(l),closeMenu:()=>i(!0)})}),h(g)&&t.jsx(A,{Icon:bt,disabled:u(!j.length),onClick:()=>k("delete",j),title:c("delete",j.length)}),h(p)&&t.jsx(A,{Icon:ft,disabled:u(!w.length),onClick:()=>k("mark_as_read",w),title:c("mark_as_read",w.length)}),h(M)&&t.jsx(A,{Icon:pt,disabled:u(!D.length),onClick:()=>k("mark_as_unread",D),title:c("mark_as_unread",D.length)}),f&&t.jsx(Z,{to:J.migrate.childRoutes.search.path((P=e==null?void 0:e.sourceId)!=null?P:-1,(T=e==null?void 0:e.id)!=null?T:-1,e==null?void 0:e.title),state:{mangaTitle:e==null?void 0:e.title},style:{textDecoration:"none",color:"inherit"},children:t.jsx(A,{Icon:jt,title:c("migrate",l.length)})}),f&&t.jsx(A,{onClick:()=>{d(!0),s(!0)},Icon:kt,title:c("track",l.length)}),t.jsx(A,{onClick:()=>{b(!0),s(!0)},Icon:wt,title:c("change_categories",l.length)}),t.jsx(A,{onClick:()=>k("remove_from_library",l),Icon:mt,title:c("remove_from_library",l.length)}),v,a&&t.jsx(we,{open:!0,maxWidth:"md",fullWidth:!0,scroll:"paper",onClose:()=>{d(!1),i(!0)},children:t.jsx(Mt,{manga:e})})]})},rn=({mangaIdToMigrateTo:e,onClose:n})=>{const{t:o}=q(),i=Ke(),{mangaId:s}=Ye(),r=Number(s),{settings:{migrateChapters:a,migrateCategories:d,migrateTracking:f,deleteChapters:l}}=re(),[c,h]=m.useState(!1),u=Qe(Me()),x=async g=>{if(r==null)throw new Error('MigrateDialog::migrate: unexpected mangaId "'.concat(r,'"'));Ze(o("migrate.label.info"),"info"),h(!0);try{await R.migrate(r,e,{mode:g,migrateChapters:a,migrateCategories:d,migrateTracking:f,deleteChapters:l}),i(J.manga.path(e),{replace:!0})}catch(p){h(!1)}};return t.jsxs(we,{open:!0,fullWidth:!0,onClose:n,children:[t.jsx(Xe,{children:o("migrate.dialog.title")}),t.jsx(Je,{dividers:!0,children:t.jsxs(St,{children:[t.jsx(ne,{disabled:c,label:o("chapter.title_one"),checked:a,onChange:(g,p)=>u("migrateChapters",p)}),t.jsx(ne,{disabled:c,label:o("category.title.category_one"),checked:d,onChange:(g,p)=>u("migrateCategories",p)}),t.jsx(ne,{disabled:c,label:o("tracking.title"),checked:f,onChange:(g,p)=>u("migrateTracking",p)}),t.jsx(ne,{disabled:c,label:o("migrate.dialog.label.delete_downloaded"),checked:l,onChange:(g,p)=>u("deleteChapters",p)})]})}),t.jsx(qe,{children:t.jsxs(z,{direction:"row",sx:{justifyContent:"space-between",width:"100%"},children:[t.jsx(B,{disabled:c,component:Z,to:J.manga.path(e),children:o("migrate.dialog.action.button.show_entry")}),t.jsxs(z,{direction:"row",children:[t.jsx(B,{disabled:c,onClick:n,children:o("global.button.cancel")}),t.jsx(B,{disabled:c,onClick:()=>x("copy"),children:o("global.button.copy")}),t.jsx(B,{disabled:c,onClick:()=>x("migrate"),children:o("global.button.migrate")})]})]})})]})},De=m.forwardRef(({id:e,selected:n,handleSelection:o,asCheckbox:i=!1,popupState:s},r)=>{const{t:a}=q(),d=m.useMemo(()=>et(s),[s]),f=h=>{h.stopPropagation(),h.preventDefault()},l=(h,u)=>{f(h),o==null||o(e,u)};return o?n!==null?i?t.jsx(U,{title:a(n?"global.button.deselect":"global.button.select"),children:t.jsx(Tt,{...X.preventRippleProp(),checked:n,onChange:l})}):null:i?t.jsx(U,{title:a("global.button.options"),children:t.jsx(tt,{ref:r,...X.preventRippleProp(d,{onClick:f}),"aria-label":"more",children:t.jsx(ye,{})})}):t.jsx(U,{title:a("global.button.options"),children:t.jsx(B,{ref:r,...X.preventRippleProp(d,{onClick:f}),className:"manga-option-button",size:"small",variant:"contained",sx:{minWidth:"unset",paddingX:"0",paddingY:"2.5px",visibility:s.isOpen?"visible":"hidden",pointerEvents:"none","@media not (pointer: fine)":{visibility:"hidden",width:0,height:0,p:0,m:0}},children:t.jsx(ye,{})})}):null}),sn=Q("div")({position:"absolute",bottom:0,width:"100%",height:"30%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),an=Q("div")({position:"absolute",bottom:0,width:"100%",height:"20%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),cn=m.memo(({manga:e,longPressBind:n,popupState:o,handleClick:i,mangaLinkTo:s,selected:r,inLibraryIndicator:a,isInLibrary:d,gridLayout:f,handleSelection:l,continueReadingButton:c,mangaBadges:h,mode:u})=>{const x=H.usePreventMobileContextMenu(),g=m.useRef(null),{id:p,title:M}=e;return t.jsx(Gt,{component:Z,...n(()=>o.open(g.current)),onClick:i,to:s,state:R.createLocationState(e,u),onContextMenu:x,sx:{...H.preventMobileContextMenuSx(),textDecoration:"none"},children:t.jsxs($,{sx:{display:"flex",flexDirection:"column",m:.25,outline:r?"4px solid":void 0,borderRadius:r?"1px":void 0,outlineColor:b=>b.palette.primary.main,backgroundColor:b=>r?b.palette.primary.main:void 0,"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:u==="source"?"none":"flex"}}},children:[t.jsx(Ie,{sx:{aspectRatio:Rt,display:"flex"},children:t.jsxs(Re,{sx:{position:"relative",height:"100%"},children:[t.jsx(Dt,{alt:M,src:R.getThumbnailUrl(e),imgStyle:a&&d?{height:"100%",width:"100%",objectFit:"cover",filter:"brightness(0.4)"}:{height:"100%",width:"100%",objectFit:"cover"},spinnerStyle:{display:"grid",placeItems:"center"}}),t.jsxs(z,{direction:"row",sx:{alignItems:"start",justifyContent:"space-between",position:"absolute",top:b=>b.spacing(1),left:b=>b.spacing(1),right:b=>b.spacing(1)},children:[h,t.jsx(De,{ref:g,popupState:o,id:p,selected:r,handleSelection:l})]}),t.jsxs(t.Fragment,{children:[f!==L.Comfortable&&t.jsxs(t.Fragment,{children:[t.jsx(sn,{}),t.jsx(an,{})]}),t.jsxs(z,{direction:"row",sx:{justifyContent:f!==L.Comfortable?"space-between":"end",alignItems:"end",position:"absolute",bottom:0,width:"100%",p:1,gap:1},children:[f!==L.Comfortable&&t.jsx(U,{title:M,placement:"top",children:t.jsx(ae,{component:"h3",sx:{color:"white",textShadow:"0px 0px 3px #000000"},children:M})}),c]})]})]})}),f===L.Comfortable&&t.jsx(z,{sx:{pb:1},children:t.jsx(U,{title:M,placement:"top",children:t.jsx(ae,{component:"h3",sx:{color:b=>r?b.palette.primary.contrastText:"text.primary",height:"3rem",pt:.5},children:M})})})]})})}),ln=m.memo(({manga:e,longPressBind:n,popupState:o,handleClick:i,mangaLinkTo:s,selected:r,inLibraryIndicator:a,isInLibrary:d,handleSelection:f,continueReadingButton:l,mangaBadges:c,mode:h})=>{const u=H.usePreventMobileContextMenu(),x=m.useRef(null),{id:g,title:p}=e;return t.jsx(Ie,{children:t.jsx(Re,{component:Z,to:s,state:R.createLocationState(e,h),onClick:i,...n(()=>o.open(x.current)),onContextMenu:u,sx:{...H.preventMobileContextMenuSx(),"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:h==="source"?"none":"inline-flex"}}},children:t.jsxs(Et,{sx:{justifyContent:"space-between",position:"relative"},children:[t.jsx(Pt,{iconUrl:R.getThumbnailUrl(e),alt:e.title,slots:{spinnerImageProps:{imgStyle:{imageRendering:"pixelated",filter:a&&d?"brightness(0.4)":void 0}}}}),t.jsx($,{sx:{display:"flex",flexDirection:"row",flexGrow:1,width:"min-content"},children:t.jsx(U,{title:p,placement:"top",children:t.jsx(ae,{variant:"h6",component:"h3",children:p})})}),t.jsxs(z,{direction:"row",sx:{alignItems:"center",gap:.5},children:[c,l,t.jsx(De,{ref:x,popupState:o,id:g,selected:r,handleSelection:f,asCheckbox:!0})]})]})})})}),dn=({showContinueReadingButton:e,chapter:n,mangaLinkTo:o})=>{if(!e||!n)return null;const{sourceOrder:i,chapterNumber:s,name:r,scanlator:a}=n;return t.jsx(vt,{chapterNumber:s,name:r,sourceOrder:i,scanlator:a,children:t.jsx(B,{...X.preventRippleProp(),variant:"contained",size:"small",sx:{minWidth:"unset",py:.5,px:.75},component:Z,to:"".concat(o,"/chapter/").concat(i),state:At.getReaderOpenChapterLocationState(n),onClick:d=>d.stopPropagation(),children:t.jsx(_t,{})})})},un=Q("div")(({theme:e})=>({display:"flex",height:"fit-content",borderRadius:e.shape.borderRadius,overflow:"hidden"})),je=Q(ve)(({theme:e})=>({color:e.palette.primary.contrastText,paddingInline:e.spacing(.3)})),fn=({inLibraryIndicator:e,updateLibraryState:n,isInLibrary:o,unread:i,downloadCount:s,mode:r})=>{const{t:a}=q(),d=H.useIsTouchDevice(),{settings:{showUnreadBadge:f,showDownloadBadge:l}}=re();return t.jsxs(un,{children:[!d&&e&&r==="source"&&t.jsx(B,{className:"source-manga-library-state-button",component:"div",variant:"contained",size:"small",...X.preventRippleProp(),onClick:c=>{c.preventDefault(),c.stopPropagation(),n()},sx:{display:"none"},color:o?"error":"primary",children:a(o?"manga.action.library.remove.label.action":"manga.button.add_to_library")}),e&&o&&t.jsx(ve,{className:"source-manga-library-state-indicator",sx:{backgroundColor:"primary.dark",color:"primary.contrastText",p:.3},children:a("manga.button.in_library")}),(f&&r==="default"||r==="duplicate")&&(i!=null?i:0)>0&&t.jsx(je,{sx:{backgroundColor:"primary.main",color:"primary.contrastText"},children:i}),(l&&r==="default"||r==="duplicate")&&(s!=null?s:0)>0&&t.jsx(je,{sx:{backgroundColor:"secondary.main",color:"secondary.contrastText"},children:s})]})},pn=(e,n,o,i)=>{switch(e){case"default":case"source":case"duplicate":return J.manga.path(n);case"migrate.search":return J.migrate.childRoutes.search.path(o!=null?o:"-1",n,i);case"migrate.select":return"";default:throw new Error('getMangaLinkTo: unexpected MangaCardMode "'.concat(e,'"'))}},mn=m.memo(e=>{const{manga:n,gridLayout:o,inLibraryIndicator:i,selected:s,handleSelection:r,mode:a="default"}=e,{id:d,firstUnreadChapter:f,downloadCount:l,unreadCount:c}=n,{settings:{showContinueReadingButton:h}}=re(),{CategorySelectComponent:u,updateLibraryState:x,isInLibrary:g}=ht(n,a==="source"),p=pn(a,n.id,n.sourceId,n.title),[M,b]=m.useState(!1),v=m.useCallback((C,j)=>{const w=a==="default",D=a==="source",P=a==="migrate.select",T=s!==null;if(P||T||(w||D)&&j){if(C.preventDefault(),D){x();return}if(T){r==null||r(d,!s,{selectRange:C.shiftKey});return}if(w){j==null||j();return}P&&b(!0)}},[a,s,x,r]),G=gt(m.useCallback((C,{context:j})=>{C.shiftKey=!0,v(C,j)},[v])),k=m.useMemo(()=>o===L.List?ln:cn,[o]);return t.jsxs(t.Fragment,{children:[M&&t.jsx(rn,{mangaIdToMigrateTo:n.id,onClose:()=>b(!1)}),t.jsx(nt,{variant:"popover",popupId:"manga-card-action-menu",children:C=>t.jsxs(t.Fragment,{children:[t.jsx(k,{...e,longPressBind:G,popupState:C,handleClick:v,mangaLinkTo:p,isInLibrary:g,inLibraryIndicator:i,continueReadingButton:t.jsx(dn,{showContinueReadingButton:h&&a==="default",chapter:f,mangaLinkTo:p}),mangaBadges:t.jsx(fn,{inLibraryIndicator:i,isInLibrary:g,unread:c,downloadCount:l,updateLibraryState:x,mode:a})}),!!r&&C.isOpen&&t.jsx(xt,{...ot(C),children:(j,w)=>t.jsx(on,{manga:n,handleSelection:r,onClose:j,setHideMenu:w})}),u]})})]})}),hn=({ref:e,persistKey:n,...o})=>{const{state:i,persistState:s}=Nt.usePersistState(n),r=m.useRef(void 0),a=ce(r,e);return t.jsx(Ot,{...o,ref:a,stateChanged:s,restoreStateFrom:i})},gn=st.forwardRef(({children:e,...n},o)=>t.jsx(le,{...n,ref:o,container:!0,spacing:1,children:e})),xn=(e,n,o,i=12)=>{const s=Math.ceil(e/n),r=o===L.List?i:i/s;return({children:a,...d})=>t.jsx(le,{...d,size:r,children:a})},Te=(e,n,o,i=!1,s,r,a)=>t.jsx(mn,{manga:e,gridLayout:n,inLibraryIndicator:o,selected:i?s==null?void 0:s.includes(e.id):null,handleSelection:r,mode:a}),bn=m.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:i,gridLayout:s,isSelectModeActive:r,selectedMangaIds:a,handleSelection:d,mode:f},l)=>t.jsx(le,{ref:l,container:!0,spacing:1,sx:{width:"100%",overflowX:"auto",display:"-webkit-inline-box",flexWrap:"nowrap"},children:e?t.jsx(ke,{}):n.map(c=>t.jsx(i,{children:Te(c,s,o,r,a,d,f)},c.id))})),yn="MangaGrid-snapshot-location",Cn=m.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:i,gridLayout:s,hasNextPage:r,loadMore:a,isSelectModeActive:d,selectedMangaIds:f,handleSelection:l,mode:c},h)=>t.jsxs(t.Fragment,{children:[t.jsx($,{ref:h,children:t.jsx(hn,{persistKey:yn,useWindowScroll:!0,increaseViewportBy:window.innerHeight*.5,totalCount:n.length,components:{List:gn,Item:i},endReached:()=>a(),computeItemKey:u=>n[u].id,itemContent:u=>Te(n[u],s,o,d,f,l,c)})}),d&&s===L.List?t.jsx($,{sx:{paddingBottom:Lt}}):e?t.jsx(ke,{}):r?t.jsx("div",{style:{height:"75px"}}):null]})),Vn=({mangas:e,isLoading:n,message:o,messageExtra:i,hasNextPage:s,loadMore:r,gridLayout:a,horizontal:d,noFaces:f,inLibraryIndicator:l,isSelectModeActive:c,selectedMangaIds:h,handleSelection:u,mode:x,retry:g,gridWrapperProps:p})=>{var P,T;const{t:M}=q(),{navBarWidth:b}=rt(),{settings:{mangaGridItemWidth:v}}=re(),G=m.useRef(null),k=m.useRef(null),[C,j]=m.useState((T=(P=k.current)==null?void 0:P.offsetWidth)!=null?T:Math.max(0,document.documentElement.offsetWidth-b)),w=m.useMemo(()=>xn(C,v,a),[C,v,a]);return m.useLayoutEffect(()=>{if(d)return()=>{};let I;const S=E=>{I=setTimeout(()=>{if(document.body.style.overflow.includes("hidden")){S(250);return}document.body.style.overflowY=a===L.List?"auto":"scroll"},E)};return S(0),()=>{clearTimeout(I)}},[a]),m.useLayoutEffect(()=>()=>{d||(document.body.style.overflowY="auto")},[]),be(k,m.useCallback(()=>{j((()=>{var E;const S=(E=k.current)==null?void 0:E.offsetWidth;return S||document.documentElement.offsetWidth-b})())},[b])),be(G,m.useCallback((I,S)=>{const E=I[0].target.clientHeight,Y=E>document.documentElement.clientHeight;if(!n&&E){if(Y){S.disconnect();return}r(),S.disconnect()}},[G,r,n])),!n&&e.length===0?t.jsx(it,{noFaces:f,message:o!=null?o:M("manga.error.label.no_mangas_found"),messageExtra:i,retry:g}):t.jsx($,{...p,ref:k,sx:{...p==null?void 0:p.sx,overflow:"hidden"},children:d?t.jsx(bn,{ref:G,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:w,gridLayout:a,isSelectModeActive:c,selectedMangaIds:h,handleSelection:u,mode:x}):t.jsx(Cn,{ref:G,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:w,hasNextPage:s,loadMore:r,gridLayout:a,isSelectModeActive:c,selectedMangaIds:h,handleSelection:u,mode:x})})};export{Vn as M,on as a,yn as b,mn as c};
