var _=Object.defineProperty;var F=s=>{throw TypeError(s)};var A=(s,n,o)=>n in s?_(s,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[n]=o;var l=(s,n,o)=>A(s,typeof n!="symbol"?n+"":n,o),I=(s,n,o)=>n.has(s)||F("Cannot "+o);var m=(s,n,o)=>(I(s,n,"read from private field"),o?o.call(s):n.get(s)),K=(s,n,o)=>n.has(s)?F("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(s):n.set(s,o),y=(s,n,o,w)=>(I(s,n,"write to private field"),w?w.call(s,o):n.set(s,o),o);var N=(s,n,o,w)=>({set _(v){y(s,n,v,o)},get _(){return m(s,n,w)}});(function(){"use strict";var u,M,P,E,C;const s=r=>r.toLowerCase().trim(),n=r=>s(r).normalize("NFKC").replace(/[^\p{L}\p{N}]+/gu," ").trim(),o=r=>{const e=Object.groupBy(r,({title:t})=>n(t));return Object.fromEntries(Object.entries(e).filter(t=>{var i,c;return((c=(i=t[1])==null?void 0:i.length)!=null?c:0)>1}).map(([,t])=>[t[0].title,t]))};class w{constructor(e){l(this,"value");l(this,"next");this.value=e}}let v=(E=class{constructor(){K(this,u);K(this,M);K(this,P);this.clear()}enqueue(e){const t=new w(e);m(this,u)?(m(this,M).next=t,y(this,M,t)):(y(this,u,t),y(this,M,t)),N(this,P)._++}dequeue(){const e=m(this,u);if(e)return y(this,u,m(this,u).next),N(this,P)._--,e.value}peek(){if(m(this,u))return m(this,u).value}clear(){y(this,u,void 0),y(this,M,void 0),y(this,P,0)}get size(){return m(this,P)}*[Symbol.iterator](){let e=m(this,u);for(;e;)yield e.value,e=e.next}},u=new WeakMap,M=new WeakMap,P=new WeakMap,E);function R(r){k(r);const e=new v;let t=0;const i=()=>{t<r&&e.size>0&&(e.dequeue()(),t++)},c=()=>{t--,i()},h=async(a,g,p)=>{const f=(async()=>a(...p))();g(f);try{await f}catch(b){}c()},T=(a,g,p)=>{new Promise(f=>{e.enqueue(f)}).then(h.bind(void 0,a,g,p)),(async()=>(await Promise.resolve(),t<r&&i()))()},d=(a,...g)=>new Promise(p=>{T(a,p,g)});return Object.defineProperties(d,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value(){e.clear()}},concurrency:{get:()=>r,set(a){k(a),r=a,queueMicrotask(()=>{for(;t<r&&e.size>0;)i()})}}}),d}function k(r){if(!((Number.isInteger(r)||r===Number.POSITIVE_INFINITY)&&r>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up")}class q{constructor(){l(this,"orgResolve");l(this,"orgReject");l(this,"promise");this.promise=new Promise((e,t)=>{this.orgResolve=e,this.orgReject=t})}resolve(e){this.orgResolve(e)}reject(e){this.orgReject(e)}}class z{constructor(e){l(this,"queue");l(this,"counter",0);l(this,"pendingKeyToPriorityMap",new Map);l(this,"pendingKeyToFnMap",new Map);l(this,"pendingKeyToPromiseMap",new Map);this.queue=R(e)}clear(){this.pendingKeyToPromiseMap.forEach(e=>{e.reject(new Error("Queue::clear: called"))}),this.pendingKeyToPriorityMap.clear(),this.pendingKeyToFnMap.clear(),this.pendingKeyToPromiseMap.clear()}enqueue(e,t,i=1){this.counter=(this.counter+1)%Number.MAX_SAFE_INTEGER;const c="".concat(e,"_").concat(this.counter);this.pendingKeyToPriorityMap.set(c,i),this.pendingKeyToFnMap.set(c,t);const h=new q;return this.pendingKeyToPromiseMap.set(c,h),this.queue(()=>this.process()),{key:c,promise:h.promise}}isProcessing(e){return!this.pendingKeyToFnMap.has(e)}async process(){const{fn:e,promise:t}=this.getNextItemToProcess();try{const i=await e();t.resolve(i)}catch(i){t.reject(i)}}getNextItemToProcess(){const[e]=[...this.pendingKeyToPriorityMap.entries()].toSorted(([,c],[,h])=>h-c)[0],t=this.pendingKeyToFnMap.get(e),i=this.pendingKeyToPromiseMap.get(e);return this.pendingKeyToPriorityMap.delete(e),this.pendingKeyToFnMap.delete(e),this.pendingKeyToPromiseMap.delete(e),{key:e,fn:t,promise:i}}}const S=new z(((C=navigator.hardwareConcurrency)!=null?C:5)-1),j=200;self.onmessage=async r=>{const{mangas:e,checkAlternativeTitles:t}=r.data;if(!t){postMessage(o(e));return}const i=[];for(let d=0;d<e.length;d+=j)i.push(S.enqueue(d.toString(),()=>{const a=new q,g=new Worker(new URL("/assets/LibraryDuplicatesDescriptionWorker-D8fxrz0M.js",self.location.href),{type:"module"});return g.onmessage=p=>a.resolve(p.data),g.postMessage({mangas:e,mangasToCheck:e.slice(d,d+j)}),a.promise}).promise);const c=await Promise.all(i),h={},T={};c.forEach(d=>Object.entries(d).forEach(([a,g])=>{var b,x;const p=n(a);(b=T[p])!=null||(T[p]=a);const f=T[p];(x=h[f])!=null||(h[f]=g)})),postMessage(h)}})();
