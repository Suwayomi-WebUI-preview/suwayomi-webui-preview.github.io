import{c as te,j as e,u as w,a as Me,S as b,A as P,L as F,r as A,b as q,T as L,l as Ce,B,C as M,I as U,d as Ue,m as N,g as O,e as se,f as l,D as Re,h as Pe,i as ne,k as $,t as H,n as he,o as Be,p as $e,q as De,s as Ge,v as Fe,w as ze,x as He,y as Ee,z as Le,E as Te,F as ve,G as Ve,H as xe,J as Ke,K as Xe,M as qe,N as We,O as ge,P as fe,Q as Qe,R as y}from"./index-CFvHGhLd.js";import{P as Je}from"./PushPin-JvkAyXla.js";import{P as Ze}from"./PushPinOutlined-BXTHm4ai.js";import{SourceContentType as Se}from"./SourceMangas-kGxJQovU.js";import{M as ee}from"./MUI.util-CEodEA2f.js";import{L as re}from"./ListCardAvatar-DLnyQcWB.js";import{L as oe}from"./ListCardContent-nmGQ3mPm.js";import{C as ae}from"./Card-DXDkfudO.js";import{C as ie}from"./CardActionArea-CDHtgB4D.js";import{E as X}from"./EmptyViewAbsoluteCentered-BHlTbtIA.js";import{i as Ye,t as W,g as V,I as et,a as tt,E as Ie,b as G,c as st,u as nt,d as rt,e as ot,f as at,h as it,j as ct,k as lt}from"./Extensions.utils-CLtUl_sM.js";import{u as Ae}from"./useAppAction-80lvrmM5.js";import{S as we,a as ye}from"./StyledGroupHeader-B1DirtVJ.js";import{V as Ne}from"./Virtuoso.util-CcEdigyC.js";import{S as ce}from"./StyledGroupItemWrapper-DXFGddAd.js";import{S as ut}from"./SourceLanguageSelect-BTUi6nFy.js";import{f as dt}from"./file-selector-DlHkLoY8.js";import{A as pt}from"./Add-CGq6pPpE.js";import{A as mt}from"./AppbarSearch-Dp9g2exm.js";import{F as ht}from"./FilterList-DYxMMbvp.js";import{q as xt}from"./index-DlSL6C84.js";import{S as gt}from"./Switch-B7gU19De.js";import{u as je}from"./use-window-event-6dKzL27K.js";import{T as Y,a as K}from"./Tabs-CcPIjMxl.js";import{T as ft}from"./TabsWrapper-CmvUAcw1.js";import{T as St}from"./TabsMenu-CLY1mwtV.js";import{A as jt,a as _t}from"./SortRadioInput-BhYaA3fT.js";import{C as Ct}from"./Chip-DBduDF5y.js";import{u as Et}from"./useAppTitle-Cv4TfQe3.js";import{G as Lt}from"./Virtuoso.constants-DKNufsdf.js";import"./IconWebView-C0ATrbW_.js";import"./GridLayouts-C3aEFPsn.js";import"./Checkbox-BmF8T5uh.js";import"./SwitchBase-CYshp0sh.js";import"./ListPreference-CE6VDSca.js";import"./FormGroup-nVjcvP3k.js";import"./Delete-D_ljgwL8.js";import"./CheckboxInput-BnObPBe2.js";import"./ExpandMore-BfrjOIw1.js";import"./useDebounce-CEtwGQRg.js";import"./ThreeStateCheckboxInput-C9Pqg_QF.js";import"./StyledFab-gm-gf3Gp.js";import"./BaseMangaGrid-DbWZJ1Pm.js";import"./MangaGrid-CBsaCBsh.js";import"./useManageMangaLibraryState-D4U4tVkm.js";import"./Chapters-CGuc_2fW.js";import"./DateHelper-CYQuMHVC.js";import"./Asserts-xItX73wb.js";import"./Mangas-Bvno8yoK.js";import"./Download-KectiWGX.js";import"./ContinueReadingTooltip-DINw_dp5.js";import"./Trackers-BQ19KlF0.js";import"./AvatarSpinner-Bk8u0EEO.js";import"./SpinnerImage-7Tzb5U1e.js";import"./Refresh-B5W5mbuy.js";import"./Image-DV4YsR5E.js";import"./CheckCircle-Bjo0aNSm.js";import"./Metadata-HlplMUtm.js";import"./Link-T5fGFq9q.js";import"./NumberSetting-C4rOzACa.js";import"./Slider-D2UcFIr7.js";import"./useMobilePicker-CfUe9JE9.js";import"./SelectSetting-BEQxtj5x.js";import"./Select-D52kBxQV.js";import"./Sync-CChNZGBP.js";import"./use-merged-ref-DRPnZ14L.js";import"./PlayArrow-DkxWdTLB.js";import"./useAppTitleAndAction-Clep15Ag.js";import"./Strings-CAV0u705.js";import"./ListItemAvatar-BEYBk7FY.js";const Tt=te(e.jsx("path",{d:"M19.3 16.9c.4-.7.7-1.5.7-2.4 0-2.5-2-4.5-4.5-4.5S11 12 11 14.5s2 4.5 4.5 4.5c.9 0 1.7-.3 2.4-.7l3.2 3.2 1.4-1.4zm-3.8.1c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5M12 20v2C6.48 22 2 17.52 2 12S6.48 2 12 2c4.84 0 8.87 3.44 9.8 8h-2.07c-.64-2.46-2.4-4.47-4.73-5.41V5c0 1.1-.9 2-2 2h-2v2c0 .55-.45 1-1 1H8v2h2v3H9l-4.79-4.79C4.08 10.79 4 11.38 4 12c0 4.41 3.59 8 8 8"})),vt=u=>{const{i18n:t,_:p}=w(),{source:n,showSourceRepo:m,showLanguage:o}=u,{id:s,name:r,lang:i,iconUrl:x,supportsLatest:_,isNsfw:c,extension:{repo:g}}=n,{isPinned:d}=Me(n),f=b.isLocalSource(n)?t._({id:"LECJgZ"}):r,S=Ue(n,E=>N(t._({id:"cBoXe4"}),"error",O(E)));return e.jsx(ae,{children:e.jsx(ie,{component:F,to:P.sources.childRoutes.browse.path(s),state:{contentType:Se.POPULAR,clearCache:!0},children:e.jsxs(oe,{children:[e.jsx(re,{iconUrl:A.getValidImgUrlFor(x),alt:f,slots:{spinnerImageProps:{ignoreQueue:!0}}}),e.jsxs(q,{sx:{justifyContent:"center",flexGrow:1,flexShrink:1,wordBreak:"break-word"},children:[e.jsx(L,{variant:"h6",component:"h3",children:f}),e.jsxs(L,{variant:"caption",children:[o&&Ce(i),c&&e.jsx(L,{variant:"caption",color:"error",children:" 18+"})]}),m&&e.jsx(L,{variant:"caption",children:g})]}),_&&e.jsx(B,{...ee.preventRippleProp(),variant:"outlined",component:F,to:P.sources.childRoutes.browse.path(s),state:{contentType:Se.LATEST,clearCache:!0},children:t._({id:"wL3cK8"})}),e.jsx(M,{title:d?t._({id:"e6tI/P"}):t._({id:"KofAFL"}),children:e.jsx(U,{...ee.preventRippleProp(),onClick:E=>{E.preventDefault(),S("isPinned",!d)},color:d?"primary":"inherit",children:d?e.jsx(Je,{}):e.jsx(Ze,{})})})]})})})};function _e({tabsMenuHeight:u}){const{i18n:t,_:p}=w(),{languages:n,setLanguages:m}=b.useLanguages(),{settings:{showNsfw:o,lastUsedSourceId:s}}=se(),{data:r,loading:i,error:x,refetch:_}=A.useGetSourceList({notifyOnNetworkStatusChange:!0}),c=r==null?void 0:r.sources.nodes,g=l.useMemo(()=>b.filter(c!=null?c:[],{showNsfw:o,languages:n,keepLocalSource:!0,enabled:!0}),[c,n]),d=l.useMemo(()=>{const h=b.getLastUsedSource(s,g),j=Object.entries(b.groupByLanguage(g));return h?[[Re.LAST_USED_SOURCE,[h]],...j]:j},[g]),f=l.useMemo(()=>b.getLanguages(c!=null?c:[]),[c]),S=l.useMemo(()=>b.areFromMultipleRepos(g),[g]),E=l.useMemo(()=>d.map(([,h])=>h).flat(1),[d]),I=l.useMemo(()=>d.map(h=>h[1].length),[d]),v=Ne.useCreateGroupedComputeItemKey(I,l.useCallback(h=>d[h][0],[d]),l.useCallback((h,j)=>"".concat(d[j][0],"_").concat(E[h].id),[E])),R=Pe();return Ae(e.jsxs(e.Fragment,{children:[e.jsx(M,{title:t._({id:"kddIOO"}),children:e.jsx(U,{onClick:()=>R(P.sources.childRoutes.searchAll.path()),color:"inherit",children:e.jsx(Tt,{})})}),e.jsx(ut,{selectedLanguages:n,setSelectedLanguages:m,languages:f,sources:c!=null?c:[]})]}),[p,n,f,c]),i?e.jsx(ne,{}):x?e.jsx(X,{message:t._({id:"6m5aox"}),messageExtra:O(x),retry:()=>_().catch($("Sources::refetch"))}):(c==null?void 0:c.length)===0?e.jsx(X,{message:t._({id:"W//hDl"})}):e.jsx(we,{persistKey:"sources",heightToSubtract:u,overscan:window.innerHeight*.5,groupCounts:I,computeItemKey:v,groupContent:h=>{const[j]=d[h];return e.jsx(ye,{isFirstItem:!h,children:e.jsx(L,{variant:"h5",component:"h2",children:W(j)})})},itemContent:(h,j)=>{const D=d[j][0],C=E[h];return e.jsx(ce,{children:e.jsx(vt,{source:C,showSourceRepo:S,showLanguage:Ye(D)})})}})}function It(u){const{i18n:t,_:p}=w(),{selectedLanguages:n,setSelectedLanguages:m,languages:o}=u,[s,r]=l.useState(H(n)),[i,x]=l.useState(!1),_=l.useMemo(()=>H([...s.toSorted(he),...o.toSorted(he)]),[o,s]),c=()=>{x(!1),r(H(n))},g=()=>{x(!1),m(H(s))},d=(f,S)=>{r(S?[...s,f]:s.toSpliced(s.indexOf(f),1))};return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:t._({id:"Tz0i8g"}),children:e.jsx(U,{onClick:()=>x(!0),"aria-label":"display more actions",edge:"end",color:"inherit",children:e.jsx(ht,{})})}),e.jsxs(Be,{fullWidth:!0,maxWidth:"xs",open:i,onClose:c,children:[e.jsx($e,{children:t._({id:"tEL3Xq"})}),e.jsx(De,{dividers:!0,sx:{padding:0},children:e.jsx(xt,{style:{height:_.length*54,minHeight:"25vh",maxHeight:"50vh"},data:_,increaseViewportBy:400,computeItemKey:f=>_[f],itemContent:(f,S)=>e.jsxs(Ge,{children:[e.jsx(Fe,{primary:W(S)}),e.jsx(gt,{checked:s.includes(S),onChange:E=>d(S,E.target.checked)})]})})}),e.jsxs(ze,{children:[e.jsx(B,{autoFocus:!0,onClick:c,color:"primary",children:t._({id:"dEgA5A"})}),e.jsx(B,{onClick:g,color:"primary",children:t._({id:"aP3N/0"})})]})]})]})}const At=({disabled:u,children:t,...p})=>u?t:e.jsx(ie,{component:F,...p,children:t});function wt(u){const{i18n:t,_:p}=w(),{extension:{name:n,lang:m,versionName:o,isInstalled:s,hasUpdate:r,isObsolete:i,pkgName:x,iconUrl:_,isNsfw:c,repo:g},handleUpdate:d,showSourceRepo:f,forcedState:S}=u,[E,I]=l.useState(V(s,i,r)),v=S!=null?S:E;l.useEffect(()=>{I(V(s,i,r))},[V(s,i,r)]);const R=async j=>{const D=rt[j],C=st[j];try{I(C),await nt(x,i,j),I(D),d()}catch(Q){I(V(s,i,r))}};function h(){switch(v){case G.INSTALL:case G.UPDATE:case G.UNINSTALL:R(v).catch($("ExtensionCard:handleButtonClick(".concat(v,")")));break;case Ie.OBSOLETE:R(G.UNINSTALL).catch($("ExtensionCard:handleButtonClick(".concat(v,")")));break}}return e.jsx(ae,{children:e.jsx(At,{disabled:!s,to:P.extension.childRoutes.info.path(x),children:e.jsxs(oe,{children:[e.jsx(re,{iconUrl:A.getValidImgUrlFor(_),alt:n,slots:{spinnerImageProps:{ignoreQueue:!0}}}),e.jsxs(q,{sx:{justifyContent:"center",flexGrow:1,flexShrink:1,wordBreak:"break-word"},children:[e.jsx(L,{variant:"h6",component:"h3",children:n}),e.jsxs(L,{variant:"caption",children:[s?"".concat(Ce(m)," "):"",o,c&&e.jsx(L,{variant:"caption",color:"error",children:" 18+"})]}),f&&e.jsx(L,{variant:"caption",children:g})]}),s&&e.jsx(M,{title:t._({id:"Tz0i8g"}),children:e.jsx(U,{color:"inherit",...ee.preventRippleProp(),children:e.jsx(He,{})})}),e.jsx(B,{variant:"outlined",sx:{color:v===tt.OBSOLETE?"red":"inherit",flexShrink:0},onClick:j=>{j.preventDefault(),h()},children:t._(et[v])})]})})})}const yt=0,Nt=1,Ot=({groupName:u,isFirstItem:t,groupExtensionIds:p,isUpdateGroup:n,updatingExtensionIds:m,setUpdatingExtensionIds:o,handleExtensionUpdate:s})=>{const{i18n:r,_:i}=w();return e.jsxs(ye,{isFirstItem:t,sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",pr:1},children:[e.jsx(L,{variant:"h5",component:"h2",children:W(u)}),n&&e.jsx(B,{disabled:!!m.length,variant:"contained",onClick:()=>{o(p),A.updateExtensions(p,{update:!0}).response.then(()=>s()).catch(x=>N(Ve.t({...lt[G.UPDATE],values:{count:p.length}}),"error",O(x))).finally(()=>o([]))},children:r._({id:"yRCx2T"})})]},u)};function kt({tabsMenuHeight:u}){var pe,me;const{i18n:t,_:p}=w(),{data:n,loading:m,error:o,refetch:s}=A.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[r,{data:i,loading:x,error:_}]=A.useExtensionListFetch(),{settings:{extensionLanguages:c,showNsfw:g}}=se(),d=ve(a=>N(t._({id:"cBoXe4"}),"error",O(a))),[f]=Ee(Te.QUERY,Le),[S,E]=l.useState([]),[I,v]=l.useState({}),R=m||x,h=o!=null?o:_,j=!!(n!=null&&n.settings.extensionRepos.length),D=((pe=n==null?void 0:n.settings.extensionRepos.length)!=null?pe:0)>1,C=(me=i==null?void 0:i.fetchExtensions)==null?void 0:me.extensions,Q=l.useMemo(()=>ot(C!=null?C:[]),[C]),le=l.useMemo(()=>at(C!=null?C:[],{selectedLanguages:c,showNsfw:g,query:f}),[C,c,g,f]),k=l.useMemo(()=>it(le),[le]),ue=l.useMemo(()=>k.map(a=>a[Nt].length),[k]),J=l.useMemo(()=>k.map(([,a])=>a).flat(1),[k]),Oe=Ne.useCreateGroupedComputeItemKey(ue,l.useCallback(a=>k[a][yt],[k]),l.useCallback(a=>J[a].pkgName,[J])),Z=l.useCallback(()=>v({}),[]),de=a=>{if(!a.name.toLowerCase().endsWith("apk")){N(t._({id:"f7vOnJ"}),"error");return}N(t._({id:"K04htz"}),"info"),A.installExternalExtension(a).response.then(()=>{Z(),N(t._({id:"LGq1dg"}),"success")}).catch(T=>N(t._({id:"amOoxI"}),"error",O(T)))};return l.useEffect(()=>{r()},[I]),Ae(e.jsxs(e.Fragment,{children:[e.jsx(mt,{}),e.jsx(M,{title:t._({id:"lpVYKJ"}),children:e.jsx(U,{onClick:()=>{const a=document.createElement("input");a.style.display="none",a.type="file",a.onchange=()=>{var z;const T=(z=a.files)==null?void 0:z[0];T&&de(T)},document.documentElement.appendChild(a),a.click(),document.documentElement.removeChild(a)},color:"inherit",children:e.jsx(pt,{})})}),e.jsx(It,{selectedLanguages:c,setSelectedLanguages:a=>d("extensionLanguages",a),languages:Q})]}),[p,c,Q]),je("drop",async a=>{a.preventDefault();const T=await dt(a);de(T[0])}),je("dragover",a=>{a.preventDefault()}),R?e.jsx(ne,{}):h?e.jsx(X,{message:t._({id:"6m5aox"}),messageExtra:O(h),retry:()=>{o&&s().catch($("Extensions::refetchServerSettings")),_&&r().catch($("Extensions::refetchExtensions"))}}):!(C!=null&&C.length)&&!j?e.jsxs(q,{sx:{alignItems:"center",justifyContent:"center",rowGap:"10px",paddingTop:"20px"},children:[e.jsx(L,{children:t._({id:"BMwO25"})}),e.jsx(B,{component:F,variant:"contained",to:P.settings.childRoutes.browse.path,children:t._({id:"Tz0i8g"})})]}):e.jsx(we,{persistKey:"extensions",heightToSubtract:u,overscan:window.innerHeight*.5,groupCounts:ue,groupContent:a=>{const[T,z]=k[a],ke=T===ct.UPDATE_PENDING;return e.jsx(Ot,{groupName:T,isFirstItem:a===0,groupExtensionIds:z.map(be=>be.pkgName),isUpdateGroup:ke,updatingExtensionIds:S,setUpdatingExtensionIds:E,handleExtensionUpdate:Z})},computeItemKey:Oe,itemContent:a=>{const T=J[a];return e.jsx(ce,{children:e.jsx(wt,{extension:T,handleUpdate:Z,showSourceRepo:D,forcedState:S.includes(T.pkgName)?Ie.UPDATING:void 0})})}})}const bt=te(e.jsx("path",{d:"M14.94 4.66h-4.72l2.36-2.36zm-4.69 14.71h4.66l-2.33 2.33zM6.1 6.27 1.6 17.73h1.84l.92-2.45h5.11l.92 2.45h1.84L7.74 6.27zm-1.13 7.37 1.94-5.18 1.94 5.18zm10.76 2.5h6.12v1.59h-8.53v-1.29l5.92-8.56h-5.88v-1.6h8.3v1.26z"})),Mt=te(e.jsx("path",{d:"M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4zm-6 4h-4v-4h4z"})),Ut=({id:u,name:t,lang:p,iconUrl:n,mangaCount:m})=>{const{i18n:o,_:s}=w(),i=Number(u)===0?o._({id:"LECJgZ"}):t;return e.jsx(ae,{children:e.jsx(ie,{component:F,to:P.migrate.path(u),children:e.jsxs(oe,{sx:{justifyContent:"space-between"},children:[e.jsxs(xe,{sx:{display:"flex",gap:1},children:[e.jsx(re,{iconUrl:A.getValidImgUrlFor(n),alt:i,slots:{spinnerImageProps:{ignoreQueue:!0}}}),e.jsxs(xe,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(L,{variant:"h6",component:"h3",children:i}),e.jsx(L,{variant:"caption",sx:{display:"block"},children:W(p)})]})]}),e.jsx(Ct,{sx:{borderRadius:1},size:"small",label:m})]})})})},Rt=(u,{sortBy:t,sortOrder:p})=>{if(!u)return[];const n={};u.forEach(({sourceId:o,source:s})=>{var i;const r=(i=n[o])!=null?i:{id:o,name:o,lang:"unknown",iconUrl:null,mangaCount:0,...s};n[o]={...r,mangaCount:r.mangaCount+1}});const m=Object.values(n).toSorted((o,s)=>{switch(t){case ge.SOURCE_NAME:return o.name.localeCompare(s.name);case ge.MANGA_COUNT:return o.mangaCount-s.mangaCount;default:throw new Error('Unexpected "sortBy" "'.concat(t,'"'))}});switch(p){case fe.ASC:return m;case fe.DESC:return m.toReversed();default:throw new Error('Unexpected "sortOrder" "'.concat(p,'"'))}},Pt=({tabsMenuHeight:u})=>{const{i18n:t,_:p}=w(),{appBarHeight:n}=Ke(),{settings:{migrateSortSettings:m}}=se(),o=ve(d=>N(t._({id:"cBoXe4"}),"error",O(d))),{sortBy:s,sortOrder:r}=m,{data:i,loading:x,error:_,refetch:c}=A.useGetMigratableSources({notifyOnNetworkStatusChange:!0}),g=l.useMemo(()=>Rt(i==null?void 0:i.mangas.nodes,m),[i==null?void 0:i.mangas.nodes,m]);return x?e.jsx(ne,{}):_?e.jsx(X,{message:t._({id:"6m5aox"}),messageExtra:O(_),retry:()=>c().catch($("Migration::refetch"))}):e.jsxs(e.Fragment,{children:[e.jsxs(q,{sx:{position:"sticky",top:"".concat(n+u,"px"),flexDirection:"row",justifyContent:"end",alignItems:"center",gap:1,p:1,backgroundColor:"background.default",zIndex:1},children:[e.jsx(M,{title:t._(Xe[s]),children:e.jsx(U,{color:"inherit",onClick:()=>o("migrateSortSettings",{sortBy:(s+1)%2,sortOrder:r}),children:s?e.jsx(Mt,{}):e.jsx(bt,{})})}),e.jsx(M,{title:t._(qe[r]),children:e.jsx(U,{color:"inherit",onClick:()=>o("migrateSortSettings",{sortBy:s,sortOrder:(r+1)%2}),children:r?e.jsx(jt,{}):e.jsx(_t,{})})})]}),e.jsx(We,{sx:{p:0},children:g.map(d=>e.jsx(ce,{children:e.jsx(Ut,{...d})},d.id))})]})};function tn(){const{i18n:u,_:t}=w();Et(u._({id:"O2UpM1"}));const p=l.useRef(null),[n,m]=l.useState(0);Qe(p,l.useCallback(()=>m(p.current.offsetHeight),[p.current]));const[o,s]=Ee(Te.TAB,Le,{}),r=o!=null?o:y.SOURCES;return o||s(r,"replaceIn"),e.jsxs(ft,{children:[e.jsxs(St,{ref:p,sx:{zIndex:Lt},variant:"fullWidth",value:r,onChange:(i,x)=>s(x,"replaceIn"),children:[e.jsx(Y,{value:y.SOURCES,sx:{textTransform:"none"},label:u._({id:"wdxz7K"})}),e.jsx(Y,{value:y.EXTENSIONS,sx:{textTransform:"none"},label:u._({id:"V3sher"})}),e.jsx(Y,{value:y.MIGRATE,sx:{textTransform:"none"},label:u._({id:"y5rS9U"})})]}),e.jsx(K,{index:y.SOURCE_DEPRECATED,currentIndex:r,children:e.jsx(_e,{tabsMenuHeight:n})}),e.jsx(K,{index:y.SOURCES,currentIndex:r,children:e.jsx(_e,{tabsMenuHeight:n})}),e.jsx(K,{index:y.EXTENSIONS,currentIndex:r,children:e.jsx(kt,{tabsMenuHeight:n})}),e.jsx(K,{index:y.MIGRATE,currentIndex:r,children:e.jsx(Pt,{tabsMenuHeight:n})})]})}export{tn as Browse};
