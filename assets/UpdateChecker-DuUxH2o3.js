import{c as M,j as e,u as U,M as _,h as j,r as i,n as g,am as P,k as E,I as G,an as R,U as L,d as S,bP as w,ap as F,aq as H,aP as y,p as v,m as T}from"./index-DgNgvAHK.js";import{P as q}from"./Progress-DVBy4iao.js";const J=M(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");let o=!1;function N({categoryId:p,handleFinishedUpdate:n}){const{t:a}=U(),d=_.useIsTouchDevice(),[b,m]=j.useState(!1),{data:l,refetch:f}=i.useGetLastGlobalUpdateTimestamp(),h=l==null?void 0:l.lastUpdateTimestamp.timestamp,{data:c}=i.useGetGlobalUpdateSummary(),t=c==null?void 0:c.libraryUpdateStatus,r=!!(t!=null&&t.jobsInfo.isRunning),x=t?t.jobsInfo.finishedJobs/t.jobsInfo.totalJobs*100:0;j.useEffect(()=>{!o&&r&&(o=!0),o&&x===100&&(o=!1,n==null||n(),f().catch(g()))},[r]);const k=async s=>{try{o=!0,await i.startGlobalUpdate(s!==void 0?[s]:void 0).response,f().catch(g("UpdateChecker::reFetchLastTimestamp"))}catch(I){o=!1,v(a("global.error.label.update_failed"),"error",T(I))}},C=async()=>{try{await i.resetGlobalUpdate()}catch(s){v(a("library.error.label.stop_global_update"),"error",T(s))}},u=async s=>{r?C():k(s)};return e.jsx(P,{variant:"popover",popupId:"library-update-checker-menu",children:s=>e.jsxs(e.Fragment,{children:[e.jsx(E,{title:r?a("library.action.label.stop_update"):a("library.settings.global_update.label.last_update_tooltip",{date:h?w.format(+h):"-"}),children:e.jsx(G,{sx:{position:"relative"},...p!==void 0&&!r?R(s):{onClick:()=>u()},onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),color:"inherit",children:r?e.jsxs(e.Fragment,{children:[e.jsx(J,{sx:{opacity:Number(d||b)}}),e.jsx(S,{sx:{position:"absolute"},children:e.jsx(q,{progress:x,showText:!d&&!b,progressProps:{color:"inherit"}})})]}):e.jsx(L,{})})}),e.jsxs(F,{...H(s),children:[e.jsx(y,{onClick:()=>{s.close(),u()},children:a("library.action.label.update_library")}),e.jsx(y,{onClick:()=>{s.close(),u(p)},children:a("library.action.label.update_category")})]})]})})}export{J as C,N as U};
