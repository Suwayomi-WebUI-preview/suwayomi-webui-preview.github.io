var W=Object.freeze,ie=Object.defineProperty;var Q=(e,t)=>W(ie(e,"raw",{value:W(t||e.slice())}));import{f as r,c as B,j as u,ar as ce,bx as le,v as ue,G as de,B as P,bB as ge,bI as fe,k as D,bJ as he,bK as me,u as te,r as Y,bL as ae,o as be,p as pe,q as ve,w as Me,b as q,A as ne,L as Ce,bM as xe,aJ as ye,m as R,g as O,aF as z,bn as Se,bN as we,bC as Le}from"./index-C-R-YL45.js";import{D as Te}from"./Chapters-2g_N5hFa.js";import{a as $}from"./Mangas-BEzC4Hou.js";import{T as ke}from"./ThreeStateCheckboxInput-DSi4gXoo.js";import{C as Ie}from"./CheckboxInput-C0cMJY8F.js";import{F as Ae}from"./FormGroup-fnIgPa-k.js";var N=(e=>(e.Mouse="mouse",e.Touch="touch",e.Pointer="pointer",e))(N||{}),G=(e=>(e.CancelledByMovement="cancelled-by-movement",e.CancelledByRelease="cancelled-by-release",e.CancelledOutsideElement="cancelled-outside-element",e))(G||{});const Ee=["mousedown","mousemove","mouseup","mouseleave","mouseout"],_e=["touchstart","touchmove","touchend","touchcancel"],De=["pointerdown","pointermove","pointerup","pointerleave","pointerout"];function je(e){return typeof e=="object"&&e!==null&&"pageX"in e&&typeof e.pageX=="number"&&"pageY"in e&&typeof e.pageY=="number"}function Fe(e){var t;return Ee.includes((t=e==null?void 0:e.nativeEvent)==null?void 0:t.type)}function se(e){var t;return _e.includes((t=e==null?void 0:e.nativeEvent)==null?void 0:t.type)||"touches"in e}function Re(e){const{nativeEvent:t}=e;return t?De.includes(t==null?void 0:t.type)||"pointerId"in t:!1}function K(e){return Fe(e)||se(e)||Re(e)}function Z(e){var t;const a=se(e)?(t=e==null?void 0:e.touches)==null?void 0:t[0]:e;return je(a)?{x:a.pageX,y:a.pageY}:null}function Oe(e){return{target:e.target,currentTarget:e.currentTarget,nativeEvent:e,persist:()=>{}}}function it(e,{threshold:t=400,captureEvent:a=!1,detect:o=N.Pointer,cancelOnMovement:i=!1,cancelOutsideElement:l=!0,filterEvents:c,onStart:d,onMove:w,onFinish:L,onCancel:T}={}){const C=r.useRef(!1),x=r.useRef(!1),k=r.useRef(),h=r.useRef(),p=r.useRef(e),y=r.useRef(null),v=r.useCallback(n=>s=>{x.current||K(s)&&(c!==void 0&&!c(s)||(a&&s.persist(),d==null||d(s,{context:n}),y.current=Z(s),x.current=!0,k.current=s.currentTarget,h.current=setTimeout(()=>{p.current&&(p.current(s,{context:n}),C.current=!0)},t)))},[a,c,d,t]),f=r.useCallback(n=>(s,g)=>{K(s)&&x.current&&(y.current=null,a&&s.persist(),C.current?L==null||L(s,{context:n}):x.current&&(T==null||T(s,{context:n,reason:g!=null?g:G.CancelledByRelease})),C.current=!1,x.current=!1,h.current!==void 0&&clearTimeout(h.current))},[a,L,T]),S=r.useCallback(n=>s=>{if(K(s)&&(w==null||w(s,{context:n}),i!==!1&&y.current)){const g=Z(s);if(g){const m=i===!0?25:i,_={x:Math.abs(g.x-y.current.x),y:Math.abs(g.y-y.current.y)};(_.x>m||_.y>m)&&f(n)(s,G.CancelledByMovement)}}},[f,i,w]),M=r.useCallback(n=>{if(e===null)return{};switch(o){case N.Mouse:{const s={onMouseDown:v(n),onMouseMove:S(n),onMouseUp:f(n)};return l&&(s.onMouseLeave=g=>{f(n)(g,G.CancelledOutsideElement)}),s}case N.Touch:return{onTouchStart:v(n),onTouchMove:S(n),onTouchEnd:f(n)};case N.Pointer:{const s={onPointerDown:v(n),onPointerMove:S(n),onPointerUp:f(n)};return l&&(s.onPointerLeave=g=>f(n)(g,G.CancelledOutsideElement)),s}}},[e,f,l,o,S,v]);return r.useEffect(()=>{function n(s){const g=Oe(s);f()(g)}return window.addEventListener("mouseup",n),window.addEventListener("touchend",n),window.addEventListener("pointerup",n),()=>{window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),window.removeEventListener("pointerup",n)}},[f]),r.useEffect(()=>()=>{h.current!==void 0&&clearTimeout(h.current)},[]),r.useEffect(()=>{p.current=e},[e]),M}const ct=B(u.jsx("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"})),lt=B(u.jsx("path",{d:"m1.79 12 5.58 5.59L5.96 19 .37 13.41zm.45-7.78L12.9 14.89l-1.28 1.28L7.44 12l-1.41 1.41L11.62 19l2.69-2.69 4.89 4.89 1.41-1.41L3.65 2.81zm14.9 9.27L23.62 7 22.2 5.59l-6.48 6.48zM17.96 7l-1.41-1.41-3.65 3.66 1.41 1.41z"})),ut=B(u.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"})),dt=B(u.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"})),gt=({title:e,Icon:t,...a})=>u.jsxs(ce,{...a,children:[u.jsx(le,{children:u.jsx(t,{fontSize:"small"})}),u.jsx(ue,{children:e})]}),ft=(e,t)=>(a,o)=>{const i=o>0?" (".concat(o,")"):"";return"".concat(de._(t[a].action[e?"single":"selected"])).concat(i)},ht=e=>(t=!1)=>e?t:!0,mt=e=>t=>e?!1:t,bt=({children:e,...t})=>u.jsx(P,{...t,sx:{minWidth:"unset",px:"10px",...t.sx},children:e}),pt=B(u.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),vt=({children:e,onClose:t,...a})=>{const[o,i]=r.useState(!1);return u.jsx(ge,{...a,open:a.open,onClose:t,sx:{visibility:!a.open||o?"hidden":"visible"},children:e(()=>{t({},"backdropClick"),i(!1)},i)})},Ne={...Te},Ge=e=>({...e,excludedScanlators:JSON.stringify(e.excludedScanlators)}),Be=(e,t=Ne,a)=>he("manga",e,t,void 0,a),re=(e,t,a)=>Be({...e,meta:me(e.meta)},t,a),Mt=(e,t)=>re(e,t),Ue=(e,t)=>{const a=re(e,t,r.useEffect);return r.useMemo(()=>a,[e,t])},Pe=async(e,t,a)=>fe(e,[[t,Ge({[t]:a})[t]]]),$e=(e,t=D("createUpdateMangaMetadata"))=>(a,o)=>Pe(e,a,o).catch(t);function Ye(e,{isRead:t}){switch(e){case!0:return!t;case!1:return t;default:return!0}}function qe(e,{isDownloaded:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function ze(e,{isBookmarked:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function Ke(e,{scanlator:t}){return!t||!e.includes(t)}const He=(e,{sortBy:t,reverse:a})=>{const o=[...e];switch(t){case"source":o.sort((i,l)=>i.sourceOrder-l.sourceOrder);break;case"fetchedAt":o.sort((i,l)=>{var c,d;return Number((c=i.fetchedAt)!=null?c:0)-Number((d=l.fetchedAt)!=null?d:0)});break;case"chapterNumber":o.sort((i,l)=>i.chapterNumber-l.chapterNumber);break;case"uploadedAt":o.sort((i,l)=>{var c,d;return Number((c=i.uploadDate)!=null?c:0)-Number((d=l.uploadDate)!=null?d:0)});break}return a&&o.reverse(),o};function Ve(e,t){return e.filter(a=>Ye(t.unread,a)&&qe(t.downloaded,a)&&ze(t.bookmarked,a)&&Ke(t.excludedScanlators,a))}function Ct(e,t){const a=Ve(e,t);return He(a,t)}const xt=e=>{const{unread:t,downloaded:a,bookmarked:o,excludedScanlators:i}=e;return t!=null||a!=null||o!=null||!!i.length},yt=e=>{const{unread:t,downloaded:a,bookmarked:o,reverse:i,sortBy:l,showChapterNumber:c,excludedScanlators:d}=Ue(e);return r.useMemo(()=>({unread:t,downloaded:a,bookmarked:o,reverse:i,sortBy:l,showChapterNumber:c,excludedScanlators:d}),[t,a,o,i,l,c,d])},St=(e,t=D("createUpdateMangaMetadata"))=>$e(e,t),Xe=(e,{itemIds:t=[],keyCount:a=e,currentKey:o,initialState:i={}})=>{var M;const[l,c]=r.useState(i),d=r.useRef(void 0),w=[...new Set(Object.values(l).flat())],L=w.length===e,T=!w.length,C=(M=l[o])!=null?M:[],x=C.length===a,k=C.length===0;k&&(d.current=void 0);const h=r.useCallback((n,s,{selectRange:g=!1,key:m=o}={})=>{var X;const _=!s,{id:b,key:I}=(X=d.current)!=null?X:{};d.current={id:n,key:m};const U=g&&m===I&&b!==void 0,A=U?t.indexOf(b):-1,H=U?t.indexOf(n):-1,V=U?t.slice(Math.min(A,H),Math.max(A,H)+1):[n];if(_){c(j=>{var F,J;return{...j,[m]:(J=(F=j[m])==null?void 0:F.filter(oe=>!V.includes(oe)))!=null?J:[]}});return}c(j=>{var F;return{...j,[m]:[...new Set([...(F=j[m])!=null?F:[],...V])]}})},[o,t]),p=r.useCallback((n,s,g=o)=>{switch(n){case!0:c(m=>({...m,[g]:[...s]}));break;case!1:c(m=>({...m,[g]:[]}));break}},[o]),y=r.useCallback((n,s)=>{c(g=>({...g,[n]:[...s]}))},[]),v=r.useCallback(n=>l[n],[l]),f=r.useCallback(()=>{c({})},[]),S=r.useCallback(()=>{f(),c(i)},[f,i]);return{selectedItemIds:w,keySelectedItemIds:C,handleSelection:h,handleSelectAll:p,areAllItemsSelected:L,areNoItemsSelected:T,areAllItemsForKeySelected:x,areNoItemsForKeySelected:k,setSelectionForKey:y,getSelectionForKey:v,clearSelection:f,reset:S}},Je=0;class E{static getIds(t){return t.map(a=>a.id)}static getUserCreated(t){return t.filter(a=>a.id!==Je)}static getDefaults(t){return t.filter(a=>a.default)}}const We=e=>{const{data:t}=Y.useGetManga(xe,e!=null?e:-1,{skip:e===void 0});return r.useMemo(()=>e===void 0||!t?[]:E.getIds(t.manga.categories.nodes),[t==null?void 0:t.manga.categories.nodes,e])},Qe=(e,t,a,o)=>{if(t.includes(e))return!0;if(!o&&a.includes(e))return!1};function Ze(e){const{i18n:t,_:a}=te(),{onDismiss:o,onSubmit:i,isVisible:l,onExitComplete:c,mangaId:d,mangaIds:w,addToLibrary:L=!1}=e,T=d!==void 0,C=w!=null?w:[d],[x,k]=r.useState(!1),h=We(d),{data:p}=Y.useGetCategories(ae),y=p==null?void 0:p.categories.nodes,v=r.useMemo(()=>E.getUserCreated(y!=null?y:[]),[y]),f=r.useMemo(()=>L?E.getIds(E.getDefaults(v)):[],[v]),{handleSelection:S,setSelectionForKey:M,getSelectionForKey:n}=Xe(v.length,{currentKey:"categoriesToAdd",initialState:{categoriesToAdd:[...h,...f],categoriesToRemove:[]}});r.useEffect(()=>{M("categoriesToAdd",[...h,...f]),M("categoriesToRemove",[])},[h]);const s=n("categoriesToAdd"),g=n("categoriesToRemove"),m=()=>{M("categoriesToAdd",h),M("categoriesToRemove",[]),o()},_=()=>{const b=T?s.filter(A=>!h.includes(A)):s,I=T?h.filter(A=>!s.includes(A)):g;i({addToCategories:b,removeFromCategories:I}),x&&ye("showAddToLibraryCategorySelectDialog",!1).catch(A=>R(t._({id:"p43DY9"}),"error",O(A))),(b.length||I.length)&&(L||$.performAction("change_categories",C,{changeCategoriesPatch:{addToCategories:b,removeFromCategories:I}}).catch(D("CategorySelect::handleOk")))};return u.jsxs(be,{sx:{".MuiDialog-paper":{maxHeight:435,width:"80%"}},maxWidth:"xs",open:l,onTransitionExited:c,onClose:m,children:[u.jsx(pe,{children:t._({id:"Q2vtcn"})}),u.jsx(ve,{dividers:!0,children:u.jsxs(Ae,{children:[v.length===0&&u.jsx("span",{children:t._({id:"hgP50e"})}),v.map(b=>u.jsx(ke,{checked:Qe(b.id,s,g,T),onChange:I=>{S(b.id,!1,{key:"categoriesToAdd"}),S(b.id,!1,{key:"categoriesToRemove"}),I&&S(b.id,!0,{key:"categoriesToAdd"}),I===!1&&S(b.id,!0,{key:"categoriesToRemove"})},label:b.name},b.id))]})}),u.jsx(Me,{children:u.jsxs(q,{sx:{width:"100%"},children:[L&&u.jsx(Ie,{sx:{margin:0},size:"small",label:t._({id:"kDUFNa"}),onChange:b=>k(b.target.checked)}),u.jsxs(q,{direction:"row",sx:{justifyContent:"space-between",alignItems:"end",width:"100%"},children:[u.jsx(P,{component:Ce,to:ne.settings.childRoutes.categories.path,onClick:o,children:v.length?t._({id:"ePK91l"}):t._({id:"hYgDIe"})}),u.jsxs(q,{direction:"row",children:[u.jsx(P,{autoFocus:!0,onClick:m,color:"primary",children:t._({id:"dEgA5A"})}),!!v.length&&u.jsx(P,{onClick:_,color:"primary",children:t._({id:"aP3N/0"})})]})]})]})})]})}var ee;const wt=(e,t=!1)=>{var L,T;const{i18n:a,_:o}=te(),[i,l]=r.useState(!!e.inLibrary);r.useEffect(()=>{l(!!e.inLibrary)},[e.id]);const c=r.useCallback((C=[],x=[])=>{Y.updateManga(e.id,{updateManga:{inLibrary:!0},updateMangaCategories:{addToCategories:C,removeFromCategories:x}}).response.then(()=>R(a._({id:"lMioEB"}),"success")).then(()=>l(!0)).catch(k=>{R(a._({id:"Y5/o4t"}),"error",O(k))})},[e.id]),d=r.useCallback(async()=>{t&&await z.show({title:a._({id:"6foA8n"}),message:a._({id:"PfsayX",values:{0:e.title}}),actions:{confirm:{title:a._({id:"t/YqKh"})}}},{id:"manga-library-state-remove-".concat(e.id)}),await $.removeFromLibrary([e.id],!0),l(!1)},[e.id,t]);return{updateLibraryState:r.useCallback(()=>{const C=async()=>{if(i){d().catch(D("useManageMangaLibraryState::updateLibraryState::removeFromLibrary"));return}let x;try{x=(await we()).showAddToLibraryCategorySelectDialog}catch(M){R(a._({id:"6m5aox"}),"error",O(M));return}let k;try{k=await Y.getCategories(ae).response}catch(M){R(a._({id:"2HCkNR"}),"error",O(M));return}const h=E.getUserCreated(k.data.categories.nodes);let p;try{p=await $.getDuplicateLibraryMangas(e.title).response}catch(M){const n=O(M);await z.show({title:a._({id:"6m5aox"}),message:a._({id:"3l2Hmw",values:{errorMessage:n}}),actions:{extra:{show:!0,title:a._({id:"6gRgw8"}),contain:!0},confirm:{title:a._({id:"m16xKo"})}},onExtra:()=>C().catch(D("useManageMangaLibraryState::update: retry duplicate check"))},{id:"manga-library-state-add-".concat(e.id)})}if((p==null?void 0:p.data.mangas.totalCount)&&await z.show({title:a._({id:"6foA8n"}),message:a._({id:"jc6MlM"}),actions:{extra:{show:!0,title:a._({id:"BbYYZ3"}),contain:!0,link:ne.manga.path(p.data.mangas.nodes[0].id)},confirm:{title:a._({id:"m16xKo"})}},onExtra:()=>{}},{id:"manga-library-state-add-duplicated-".concat(e.id)}),!(x&&!!h.length)){c(E.getIds(E.getDefaults(h)));return}const{addToCategories:f,removeFromCategories:S}=await Le.show(Ze,{mangaId:e.id,addToLibrary:!0},{id:"manga-library-state-add-categories-".concat(e.id)});c(f,S)};C().catch(D("useManageMangaLibraryState::updateLibraryState"))},[i,d,c]),isInLibrary:(T=(L=$.getFromCache(e.id,Se(ee||(ee=Q(["\n                    fragment MangaInLibraryState on MangaType {\n                        inLibrary\n                    }\n                "]))),"MangaInLibraryState"))==null?void 0:L.inLibrary)!=null?T:i}};export{bt as C,ut as D,dt as F,pt as M,lt as R,it as V,vt as a,gt as b,ht as c,ct as d,ft as e,Ve as f,Mt as g,mt as h,Ze as i,Xe as j,xt as k,yt as l,Ct as m,St as n,wt as u};
