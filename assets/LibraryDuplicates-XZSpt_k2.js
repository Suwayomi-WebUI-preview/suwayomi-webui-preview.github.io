import{u as S,aq as y,Z as x,r as G,bP as v,b as s,j as e,e as A,g as E,f as D,T as f,z as B,a5 as _,I as F,a4 as P,s as w,a6 as V,a7 as K,ax as U}from"./index-TsR_l2G6.js";import{G as W}from"./GridLayouts-B2uE_1LD.js";import{C as q}from"./CheckboxInput-CYjYUrTi.js";import{E as z}from"./EmptyViewAbsoluteCentered-DMbN8ZrL.js";import{c as H}from"./MangaGrid-DmfvuQud.js";import{S as N,a as b}from"./StyledGroupHeader-D7x5cXbd.js";import{B as R}from"./BaseMangaGrid-DLVGzLID.js";import{S as $}from"./StyledGroupItemWrapper-CkRqtJg2.js";import{V as O}from"./Virtuoso.util-CJyo-MfT.js";import{u as Z}from"./useAppTitleAndAction-S9-YQGKC.js";import"./Checkbox-CjIbYzdK.js";import"./SwitchBase-BjKUrdvE.js";import"./ListPreference-CZTXqhY1.js";import"./FormGroup-DqlddPAJ.js";import"./useManageMangaLibraryState-Bz09gOKx.js";import"./Chapters-BumiL_h7.js";import"./DateHelper-B2USb8im.js";import"./Asserts-DxNwYpSQ.js";import"./Mangas-BUrrPiNN.js";import"./ThreeStateCheckboxInput-BkDvurOs.js";import"./Delete-wiUblFG2.js";import"./Download-CD7_eijK.js";import"./ContinueReadingTooltip-C0iiIjh0.js";import"./Trackers-Bgo8y--2.js";import"./AvatarSpinner-rtPdqOoM.js";import"./SpinnerImage-Cfl4QtPD.js";import"./Refresh-uwpVVQqj.js";import"./Card-DOCtNtqN.js";import"./ListCardContent-Bir2AlmA.js";import"./CheckCircle-JwvtjF0x.js";import"./Metadata-DHLgRo_z.js";import"./MUI.util-CEodEA2f.js";import"./CardActionArea-CjH6H-Qz.js";import"./Link-DcyZX0cS.js";import"./NumberSetting-CkDeDUnj.js";import"./Slider-7jcvvXwW.js";import"./useMobilePicker-Gi7ATISV.js";import"./Chip-BZgVLi44.js";import"./SelectSetting-DkB87Y25.js";import"./Select-yXM0RpMZ.js";import"./Sync-kBFaXKQU.js";import"./use-merged-ref-MxNcTAsc.js";import"./ListCardAvatar-BoiFeC6b.js";import"./PlayArrow-TT11gORn.js";import"./StyledFab-BDTkTzuH.js";import"./index-CGwS7rKH.js";import"./useAppTitle-AjYOPGtd.js";import"./useAppAction-DCsgRSD_.js";const Ht=()=>{const{t:p}=S(),[n,j]=y("libraryDuplicatesGridLayout",x.List),[m,C]=y("libraryDuplicatesCheckAlternativeTitles",!1);Z(p("library.settings.advanced.duplicates.label.title"),e.jsxs(e.Fragment,{children:[e.jsx(W,{gridLayout:n,onChange:j}),e.jsx(_,{variant:"popover",popupId:"library-dupliactes-settings",children:t=>e.jsxs(e.Fragment,{children:[e.jsx(F,{...P(t),color:"inherit",children:e.jsx(w,{})}),e.jsx(V,{...K(t),children:e.jsx(U,{children:e.jsx(q,{label:p("library.settings.advanced.duplicates.settings.label.check_description"),checked:m,onChange:(r,l)=>C(l)})})})]})})]}),[p,n,m]);const{data:i,loading:M,error:u,refetch:L}=G.useGetMangas(v,{condition:{inLibrary:!0}}),[T,d]=s.useState(!0),[o,g]=s.useState({});s.useEffect(()=>{var l;d(!0);const t=(l=i==null?void 0:i.mangas.nodes)!=null?l:[];if(!t.length)return g({}),()=>{};const r=new Worker(new URL("/assets/LibraryDuplicatesWorker-DSTy3Dmj.js",import.meta.url),{type:"module"});return r.onmessage=I=>{g(I.data),d(!1)},r.postMessage({mangas:t,checkAlternativeTitles:m}),()=>r.terminate()},[i==null?void 0:i.mangas.nodes,m]);const a=s.useMemo(()=>Object.keys(o).toSorted((t,r)=>t.localeCompare(r)),[o]),c=s.useMemo(()=>a.map(t=>o[t]).flat(),[o]),h=s.useMemo(()=>a.map(t=>o[t]).map(t=>t.length),[o]),k=O.useCreateGroupedComputeItemKey(h,s.useCallback(t=>a[t],[a]),s.useCallback((t,r)=>"".concat(a[r],"-").concat(c[t].id,"}"),[a,c]));return M||T?e.jsx(A,{}):u?e.jsx(z,{message:p("global.error.label.failed_to_load_data"),messageExtra:E(u),retry:()=>L().catch(D())}):n===x.List?e.jsx(N,{persistKey:"library-duplicates",groupCounts:h,groupContent:t=>e.jsx(b,{isFirstItem:t===0,children:e.jsx(f,{variant:"h5",component:"h2",children:a[t]})}),computeItemKey:k,itemContent:t=>e.jsx($,{children:e.jsx(H,{manga:c[t],gridLayout:n,selected:null,mode:"duplicate"})})}):a.map((t,r)=>e.jsxs(B,{children:[e.jsx(b,{sx:{pt:r===0?void 0:0,pb:0},isFirstItem:!1,children:e.jsx(f,{variant:"h5",component:"h2",children:t})}),e.jsx(R,{mangas:o[t],hasNextPage:!1,loadMore:()=>{},isLoading:!1,gridLayout:n,inLibraryIndicator:!1,horizontal:!0,mode:"duplicate"},m.toString())]},t))};export{Ht as LibraryDuplicates};
