import{f as _,c as U,j as i,u as V,L as at,o as Gt,p as ue,q as de,w as he,b as k,B as it,ct as Ut,aA as gt,C as $,I as E,az as qt,bA as Qt,bi as ge,J as fe,aX as lt,Q as Jt,r as F,bn as me,i as Xt,g as ct,k as Kt,Y as P,T as ut,H as Zt,ae as Yt,G as bt,m as dt,cu as pe,U as xe,V as be,W as ve,X as _e,cv as Ce,cw as je,Z as R,_ as we,a0 as Se,aR as Mt,h as ye,cm as Me,aB as Ie,A as G,a6 as te,cx as Le,cy as ke,b2 as Te,bF as It,an as Be,au as Re,e as ee,b3 as De,S as Ee,bf as $e,ak as Ve,cs as Ae,ap as Y,bw as tt,v as et,bB as Lt,aE as Oe,af as He,cz as ze,cA as Fe,bE as Pe}from"./index-Dg11ME2R.js";import{P as We}from"./PlayArrow--_Cs0sH4.js";import{S as Ne,D as Ge}from"./StyledFab-Ddln6yV0.js";import{a as H,c as Ue}from"./Chapters-B5l930U9.js";import{b as qe,C as Qe,T as Je,a as kt,L as Tt}from"./ContinueReadingTooltip-Cwxzf3pL.js";import{j as re,k as Xe,l as Ke,m as Ze,n as Ye,u as tr,F as er,C as Bt,i as rr}from"./useManageMangaLibraryState-C_XeXGI8.js";import{E as st}from"./EmptyViewAbsoluteCentered-BpXH3EyT.js";import{F as nr}from"./FilterList-DO7pilnI.js";import{D as ir}from"./Download-CvDZirnH.js";import{D as sr}from"./DoneAll-CWVH2x-f.js";import{S as or,R as Rt}from"./SortRadioInput-CSMmQper.js";import{D as ar,T as ft}from"./ThreeStateCheckboxInput-QJ2AwHAF.js";import{O as lr,S as cr,a as ur}from"./SelectionFAB-BGbspDle.js";import{C as ne}from"./CheckboxInput-DLrwItSF.js";import{F as dr}from"./FormGroup-Zzx3kc2E.js";import{a as hr}from"./ListPreference-B6lXSlZa.js";import{C as gr,a as fr,I as mr}from"./ChapterListCard-fJfutAEO.js";import{V as pr}from"./VirtuosoPersisted-DHiwdU8h.js";import{b as xr}from"./Strings-CAV0u705.js";import{F as br,I as vr}from"./IconWebView-BKD85kli.js";import{a as ot,M as _r,c as Cr}from"./Mangas-DS370Z5E.js";import{S as vt}from"./SpinnerImage-BeONRM1-.js";import{S as jr}from"./Sync-2HdhXmjJ.js";import{T as mt}from"./Trackers-BQ19KlF0.js";import{M as wr}from"./Metadata-CHRxaprE.js";import{a as Sr,E as yr}from"./ExpandMore-B4XSEbZP.js";import{L as _t}from"./Link-Bk7B9P7X.js";import{C as Mr}from"./Chip-B2WV1Iyz.js";import{R as Dt}from"./Refresh-M7Isng9V.js";import{T as Ir}from"./CreateThemeDialog-BV0ufD22.js";import{u as Lr}from"./useAppTitleAndAction-CGbKL5yF.js";import"./DateHelper-CwhPxo-b.js";import"./Asserts-xItX73wb.js";import"./AvatarSpinner-Ltl6A7ef.js";import"./Card-wL-hmBzS.js";import"./ListCardContent-B10b9ECT.js";import"./CheckCircle-D4X2m11X.js";import"./MUI.util-CEodEA2f.js";import"./CardActionArea-CgHE5voS.js";import"./NumberSetting-DmaF25zg.js";import"./Slider-Cm_K4TFZ.js";import"./useMobilePicker-Dh9obHxy.js";import"./SelectSetting-CedvK6rK.js";import"./Select-DOADqnMg.js";import"./Checkbox-BR9wiiA8.js";import"./SwitchBase-Dy2wk2ln.js";import"./Tabs-C_xRFe6t.js";import"./ChapterCardMetadata-DASQuT1A.js";import"./Delete-UwEN77yq.js";import"./index-DGMz90gj.js";import"./Virtuoso.util-D1RV4DYJ.js";import"./use-merged-ref-BjmutRWW.js";import"./Image-CSWZ2_qY.js";import"./useAppTitle-CkeQAyCc.js";import"./useAppAction-D-qUSktg.js";function kr(t){return _.Children.toArray(t).filter(e=>_.isValidElement(e))}const Tr=U(i.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}));function Br({chapter:t}){const{i18n:e,_:r}=V(),{sourceOrder:n,name:s,chapterNumber:o,scanlator:a}=t,l=n===1;return i.jsx(qe,{chapterNumber:o,name:s,sourceOrder:n,scanlator:a,children:i.jsxs(Ne,{component:at,variant:"extended",color:"primary",to:H.getReaderUrl(t),state:H.getReaderOpenChapterLocationState(t),children:[i.jsx(We,{}),l?e._({id:"tXkhj/"}):e._({id:"v39wLo"})]})})}const Et=U(i.jsx("path",{d:"M16.67 13.13C18.04 14.06 19 15.32 19 17v3h4v-3c0-2.18-3.57-3.47-6.33-3.87M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4c-.47 0-.91.1-1.33.24C14.5 5.27 15 6.58 15 8s-.5 2.73-1.33 3.76c.42.14.86.24 1.33.24m-6 0c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0-6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 7c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4m6 5H3v-.99C3.2 16.29 6.3 15 9 15s5.8 1.29 6 2z"}));function Rr({title:t,emptyMessage:e,items:r,getId:n,getLabel:s,isChecked:o,open:a,onClose:l,slotProps:c}){const{i18n:u,_:h}=V(),d=_.useMemo(()=>r.map(n),[r]),f=_.useMemo(()=>r.filter(o).map(n),[r]),{selectedItemIds:g,handleSelection:m,handleSelectAll:p,reset:v}=re(r.length,{currentKey:"default",itemIds:d,initialState:{default:f}}),C=()=>{l(),v()},b=_.useCallback(()=>{const I=g.length!==f.length||g.some(L=>!f.includes(L)),S=r.filter(L=>g.includes(n(L)));l(I?S:void 0)},[g]);return i.jsxs(Gt,{sx:{".MuiDialog-paper":{maxHeight:435,width:"80%"}},maxWidth:"xs",open:a,onClose:C,children:[i.jsx(ue,{children:t}),i.jsx(de,{dividers:!0,children:i.jsxs(dr,{children:[r.length===0&&i.jsx("span",{children:e}),r.map(I=>_.createElement(ne,{...c==null?void 0:c.checkbox,checked:g.includes(n(I)),onChange:(S,L)=>m(n(I),L),label:s(I),key:n(I)}))]})}),i.jsx(he,{children:i.jsx(k,{sx:{width:"100%"},children:i.jsxs(k,{direction:"row",sx:{justifyContent:"space-between",alignItems:"end",width:"100%"},children:[i.jsx(it,{onClick:()=>p(!g.length,r.map(n)),children:g.length?u._({id:"OfhWJH"}):u._({id:"wgNoIs"})}),i.jsxs(k,{direction:"row",children:[i.jsx(it,{autoFocus:!0,onClick:C,color:"primary",children:u._({id:"dEgA5A"})}),!!r.length&&i.jsx(it,{onClick:b,color:"primary",children:u._({id:"aP3N/0"})})]})]})})})]})}const Dr=({updateOption:t,scanlators:e,excludedScanlators:r})=>{const{i18n:n,_:s}=V(),o=Ut({variant:"dialog",popupId:"chapter-list-options-scanlator-filter-dialog"});return e.length?i.jsxs(i.Fragment,{children:[i.jsx(ne,{...gt(o),label:n._({id:"uPtLnM"}),icon:i.jsx(Et,{}),checkedIcon:i.jsx(Et,{color:"warning"}),checked:!!r.length}),i.jsx(Rr,{title:n._({id:"T5rRv7"}),open:o.isOpen,onClose:a=>{a&&t("excludedScanlators",a),o.close()},items:e,getId:a=>a,getLabel:a=>a,isChecked:a=>r.includes(a),slotProps:{checkbox:{checkedIcon:i.jsx(ar,{})}}})]}):null},Er={filter:{id:"o7J4JM"},sort:{id:"f6Hub0"},display:{id:"Xm/s+u"}},$r=({open:t,onClose:e,options:r,updateOption:n,scanlators:s,excludedScanlators:o})=>{const{i18n:a,_:l}=V();return i.jsx(lr,{open:t,onClose:e,minHeight:150,tabs:["filter","sort","display"],tabTitle:c=>a._(Er[c]),tabContent:c=>c==="filter"?i.jsxs(i.Fragment,{children:[i.jsx(ft,{label:a._({id:"KuVpz+"}),checked:r.unread,onChange:u=>n("unread",u)}),i.jsx(ft,{label:a._({id:"Vv4iDV"}),checked:r.downloaded,onChange:u=>n("downloaded",u)}),i.jsx(ft,{label:a._({id:"1C/9Sa"}),checked:r.bookmarked,onChange:u=>n("bookmarked",u)}),i.jsx(Dr,{scanlators:s,excludedScanlators:o,updateOption:n})]}):c==="sort"?Object.entries(Ue).map(([u,h])=>i.jsx(or,{label:a._(h),checked:r.sortBy===u,sortDescending:r.reverse,onClick:()=>u!==r.sortBy?n("sortBy",u):n("reverse",!r.reverse)},u)):c==="display"?i.jsxs(hr,{onChange:()=>n("showChapterNumber",!r.showChapterNumber),value:r.showChapterNumber,children:[i.jsx(Rt,{label:a._({id:"VlO8KP"}),value:!1}),i.jsx(Rt,{label:a._({id:"hFuUTP"}),value:!0})]}):null})},Vr=({mangaId:t,options:e,updateOption:r,chapters:n,scanlators:s,excludeScanlators:o})=>{const{i18n:a,_:l}=V(),[c,u]=_.useState(!1),h=Xe(e),d=_.useMemo(()=>n.every(H.isRead),[n]),f=_.useMemo(()=>n.every(H.isDownloaded),[n]);return i.jsxs(i.Fragment,{children:[i.jsx($,{title:a._({id:"onllUU"}),disabled:d,children:i.jsx(E,{disabled:d,onClick:()=>H.markAsRead(H.getNonRead(n),!0,t),color:"inherit",children:i.jsx(sr,{})})}),i.jsx(qt,{variant:"popover",popupId:"chapterlist-download-button",children:g=>i.jsxs(i.Fragment,{children:[i.jsx($,{title:a._({id:"mzI/c+"}),disabled:d,children:i.jsx(E,{disabled:f,...gt(g),color:"inherit",children:i.jsx(ir,{})})}),g.isOpen&&i.jsx(Qt,{...ge(g),children:i.jsx(Qe,{mangaIds:[t],closeMenu:g.close})})]})}),i.jsx($,{title:a._({id:"mGW0K2"}),children:i.jsx(E,{onClick:()=>u(!0),color:"inherit",children:i.jsx(nr,{color:h?"warning":void 0})})}),i.jsx($r,{open:c,onClose:()=>u(!1),options:e,updateOption:r,scanlators:s,excludedScanlators:o})]})},Ar=P(k,{shouldForwardProp:Yt(["scrollbarWidth"])})(({theme:t,scrollbarWidth:e})=>({padding:t.spacing(1),paddingRight:"calc(".concat(e,"px + ").concat(t.spacing(1),")"),paddingBottom:0,[t.breakpoints.down("md")]:{paddingRight:t.spacing(1)}})),Or=P(pr,{shouldForwardProp:Yt(["topOffset"])})(({theme:t,topOffset:e})=>({listStyle:"none",padding:0,[t.breakpoints.up("md")]:{height:"calc(100vh - ".concat(e,"px)"),margin:0}})),Hr=({selectedChapters:t,firstUnreadChapter:e,onFABMenuClose:r})=>t.length?i.jsx(ur,{title:bt._({id:"2zwLiX",values:{0:t.length}}),children:n=>i.jsx(fr,{selectedChapters:t,onClose:()=>{r==null||r(),n()}})}):e?i.jsx(Br,{chapter:e}):null,zr=({manga:t,isRefreshing:e})=>{const{i18n:r,_:n}=V(),{appBarHeight:s}=fe(),o=lt.useIsBelowWidth("md"),[a,l]=_.useState(50),[c,u]=_.useState(null);Jt(c,_.useCallback(()=>{var y;return l((y=c==null?void 0:c.offsetHeight)!=null?y:0)},[c]));const h=lt.useGetScrollbarSize("width"),d=Ke(t),f=Ye(t,y=>dt(r._({id:"cBoXe4"}),"error",ct(y))),{data:g,loading:m,error:p,refetch:v}=F.useGetMangaChapters(me,t.id,{notifyOnNetworkStatusChange:!0}),C=_.useMemo(()=>{var y;return(y=g==null?void 0:g.chapters.nodes)!=null?y:[]},[g==null?void 0:g.chapters.nodes]),b=_.useMemo(()=>Ze(C,d),[C,d]),I=_.useMemo(()=>H.getIds(b),[b]),S=_.useMemo(()=>H.getMissingCount(b),[b]),L=C.length===0,j=!L&&b.length===0,{areNoItemsSelected:w,areAllItemsSelected:M,selectedItemIds:T,handleSelectAll:B,handleSelection:q,clearSelection:K}=re(I.length,{itemIds:I,currentKey:"default"}),Z=_.useCallback((y,W,ce)=>q(y,W,{selectRange:ce}),[q]);return m||L&&e?i.jsx(k,{sx:{justifyContent:"center",alignItems:"center",position:"relative",flexGrow:1},children:i.jsx(Xt,{})}):p?i.jsx(k,{sx:{justifyContent:"center",position:"relative",flexGrow:1},children:i.jsx(st,{message:r._({id:"6m5aox"}),messageExtra:ct(p),retry:()=>v().catch(Kt("ChapterList::refetch"))})}):i.jsxs(i.Fragment,{children:[i.jsxs(k,{direction:"column",sx:{position:"relative",flexBasis:"60%"},children:[i.jsxs(Ar,{ref:u,direction:"row",alignItems:"center",justifyContent:"space-between",scrollbarWidth:h,children:[i.jsxs(k,{children:[i.jsx(ut,{variant:"h5",component:"h3",children:r._({id:"2zwLiX",values:{0:b.length}})}),!!S&&i.jsx(ut,{variant:"body2",color:"warning",children:r._({id:"xFU/Nr",values:{missingChapterCount:S}})})]}),i.jsxs(k,{direction:"row",children:[w&&i.jsx(Vr,{mangaId:t.id,options:d,updateOption:f,chapters:b,scanlators:H.getScanlators(C),excludeScanlators:d.excludedScanlators}),!!I.length&&i.jsx(cr,{areAllItemsSelected:M,areNoItemsSelected:w,onChange:y=>B(y,y?I:[])})]})]}),L&&i.jsx(st,{message:r._({id:"1tQM/6"})}),j&&i.jsx(st,{message:r._({id:"cDTTdi"})}),i.jsx(Or,{persistKey:"manga-".concat(t.id,"-chapter-list"),topOffset:s+a,style:{height:"undefined"},components:{Footer:()=>i.jsx(Zt,{sx:{paddingBottom:Ge}})},totalCount:b.length,computeItemKey:y=>b[y].id,itemContent:y=>i.jsx(gr,{index:y,isSortDesc:d.reverse,chapters:b,selected:w?null:T.includes(b[y].id),showChapterNumber:d.showChapterNumber,onSelect:Z}),useWindowScroll:o,overscan:window.innerHeight*.5})]}),i.jsx(Hr,{selectedChapters:T.map(y=>C.find(W=>W.id===y)).filter(y=>y!=null),firstUnreadChapter:t.firstUnreadChapter,onFABMenuClose:K})]})},Fr=t=>{const[e,r]=_.useState(!1),[n,s]=_.useState(null);return[_.useCallback(async()=>{r(!0),s(null),await Promise.all([F.getMangaFetch(t,{awaitRefetchQueries:!0}).response,F.getMangaChaptersFetch(t,{awaitRefetchQueries:!0}).response]).catch(a=>{a instanceof pe&&xr(a.message)==="no chapters found"||s(a)}).finally(()=>r(!1))},[t]),{loading:e,error:n}]},Pr=U(i.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}));function Wr(t){return be("MuiButtonGroup",t)}const x=xe("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","horizontal","vertical","colorPrimary","colorSecondary","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]),Nr=(t,e)=>{const{ownerState:r}=t;return[{["& .".concat(x.grouped)]:e.grouped},{["& .".concat(x.grouped)]:e["grouped".concat(R(r.orientation))]},{["& .".concat(x.grouped)]:e["grouped".concat(R(r.variant))]},{["& .".concat(x.grouped)]:e["grouped".concat(R(r.variant)).concat(R(r.orientation))]},{["& .".concat(x.grouped)]:e["grouped".concat(R(r.variant)).concat(R(r.color))]},{["& .".concat(x.firstButton)]:e.firstButton},{["& .".concat(x.lastButton)]:e.lastButton},{["& .".concat(x.middleButton)]:e.middleButton},e.root,e[r.variant],r.disableElevation===!0&&e.disableElevation,r.fullWidth&&e.fullWidth,r.orientation==="vertical"&&e.vertical]},Gr=t=>{const{classes:e,color:r,disabled:n,disableElevation:s,fullWidth:o,orientation:a,variant:l}=t,c={root:["root",l,a,o&&"fullWidth",s&&"disableElevation","color".concat(R(r))],grouped:["grouped","grouped".concat(R(a)),"grouped".concat(R(l)),"grouped".concat(R(l)).concat(R(a)),"grouped".concat(R(l)).concat(R(r)),n&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return we(c,Wr,e)},Ur=P("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:Nr})(Se(({theme:t})=>({display:"inline-flex",borderRadius:(t.vars||t).shape.borderRadius,variants:[{props:{variant:"contained"},style:{boxShadow:(t.vars||t).shadows[2]}},{props:{disableElevation:!0},style:{boxShadow:"none"}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"vertical"},style:{flexDirection:"column",["& .".concat(x.lastButton,",& .").concat(x.middleButton)]:{borderTopRightRadius:0,borderTopLeftRadius:0},["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderBottomRightRadius:0,borderBottomLeftRadius:0}}},{props:{orientation:"horizontal"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderTopRightRadius:0,borderBottomRightRadius:0},["& .".concat(x.lastButton,",& .").concat(x.middleButton)]:{borderTopLeftRadius:0,borderBottomLeftRadius:0}}},{props:{variant:"text",orientation:"horizontal"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderRight:t.vars?"1px solid ".concat(t.alpha(t.vars.palette.common.onBackground,.23)):"1px solid ".concat(t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"),["&.".concat(x.disabled)]:{borderRight:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},{props:{variant:"text",orientation:"vertical"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderBottom:t.vars?"1px solid ".concat(t.alpha(t.vars.palette.common.onBackground,.23)):"1px solid ".concat(t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"),["&.".concat(x.disabled)]:{borderBottom:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},...Object.entries(t.palette).filter(Mt()).flatMap(([e])=>[{props:{variant:"text",color:e},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderColor:t.alpha((t.vars||t).palette[e].main,.5)}}}]),{props:{variant:"outlined",orientation:"horizontal"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderRightColor:"transparent","&:hover":{borderRightColor:"currentColor"}},["& .".concat(x.lastButton,",& .").concat(x.middleButton)]:{marginLeft:-1}}},{props:{variant:"outlined",orientation:"vertical"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderBottomColor:"transparent","&:hover":{borderBottomColor:"currentColor"}},["& .".concat(x.lastButton,",& .").concat(x.middleButton)]:{marginTop:-1}}},{props:{variant:"contained",orientation:"horizontal"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderRight:"1px solid ".concat((t.vars||t).palette.grey[400]),["&.".concat(x.disabled)]:{borderRight:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},{props:{variant:"contained",orientation:"vertical"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderBottom:"1px solid ".concat((t.vars||t).palette.grey[400]),["&.".concat(x.disabled)]:{borderBottom:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},...Object.entries(t.palette).filter(Mt(["dark"])).map(([e])=>({props:{variant:"contained",color:e},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderColor:(t.vars||t).palette[e].dark}}}))],["& .".concat(x.grouped)]:{minWidth:40,boxShadow:"none",props:{variant:"contained"},style:{"&:hover":{boxShadow:"none"}}}}))),qr=_.forwardRef(function(e,r){const n=ve({props:e,name:"MuiButtonGroup"}),{children:s,className:o,color:a="primary",component:l="div",disabled:c=!1,disableElevation:u=!1,disableFocusRipple:h=!1,disableRipple:d=!1,fullWidth:f=!1,orientation:g="horizontal",size:m="medium",variant:p="outlined",...v}=n,C={...n,color:a,component:l,disabled:c,disableElevation:u,disableFocusRipple:h,disableRipple:d,fullWidth:f,orientation:g,size:m,variant:p},b=Gr(C),I=_.useMemo(()=>({className:b.grouped,color:a,disabled:c,disableElevation:u,disableFocusRipple:h,disableRipple:d,fullWidth:f,size:m,variant:p}),[a,c,u,h,d,f,m,p,b.grouped]),S=kr(s),L=S.length,j=w=>{const M=w===0,T=w===L-1;return M&&T?"":M?b.firstButton:T?b.lastButton:b.middleButton};return i.jsx(Ur,{as:l,role:"group",className:_e(b.root,o),ref:r,ownerState:C,...v,children:i.jsx(Ce.Provider,{value:I,children:S.map((w,M)=>i.jsx(je.Provider,{value:j(M),children:w},M))})})}),ie=({children:t,...e})=>i.jsx(it,{...e,children:i.jsx(k,{direction:"row",sx:{alignItems:"center",justifyContent:"center",gap:1,flexWrap:"wrap"},children:t})}),Qr=U(i.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),Jr=({manga:t})=>{var h,d;const{i18n:e,_:r}=V(),n=ye(),s=F.useGetTrackerList(Me),o=(d=(h=s.data)==null?void 0:h.trackers.nodes)!=null?d:[],a=t.trackRecords.nodes,l=mt.getLoggedIn(o),c=mt.getLoggedIn(mt.getTrackers(a,o)),u=f=>{var g;if(s.error){dt(e._({id:"GIyQgE"}),"error",(g=s.error)==null?void 0:g.toString());return}if(!l.length){n(G.settings.childRoutes.tracking.path);return}f()};return i.jsx(qt,{variant:"dialog",popupId:"manga-track-modal",children:f=>i.jsxs(i.Fragment,{children:[i.jsxs(ie,{...gt(f),size:lt.useIsMobileWidth()?"small":"medium",disabled:s.loading||!!s.error,onClick:()=>u(f.open),variant:c.length?"contained":"outlined",children:[c.length?i.jsx(Qr,{}):i.jsx(jr,{}),c.length?e._({id:"skmzin",values:{0:c.length}}):e._({id:"U0HZma"})]}),f.isOpen&&i.jsx(Gt,{...Ie(f),maxWidth:"md",fullWidth:!0,scroll:"paper",children:i.jsx(Je,{manga:t})})]})})},Xr=U(i.jsx("path",{d:"M21 11V3h-8l3.29 3.29-10 10L3 13v8h8l-3.29-3.29 10-10z"}));class Kr{constructor(e,r){this.pixels=e,this.opts=r;const{sigBits:n}=r,s=(S,L,j)=>(S<<2*n)+(L<<n)+j;this.getColorIndex=s;const o=8-n,a=1<<3*n,l=new Uint32Array(a);let c,u,h,d,f,g,m,p,v,C;c=h=f=0,u=d=g=Number.MAX_VALUE;const b=e.length/4;let I=0;for(;I<b;){const S=I*4;if(I++,m=e[S+0],p=e[S+1],v=e[S+2],C=e[S+3],C===0)continue;m=m>>o,p=p>>o,v=v>>o;const L=s(m,p,v);l[L]===void 0&&(l[L]=0),l[L]+=1,m>c&&(c=m),m<u&&(u=m),p>h&&(h=p),p<d&&(d=p),v>f&&(f=v),v<g&&(g=v)}this._colorCount=l.reduce((S,L)=>L>0?S+1:S,0),this.hist=l,this.rmax=c,this.rmin=u,this.gmax=h,this.gmin=d,this.bmax=f,this.bmin=g}get colorCount(){return this._colorCount}}class Zr{scaleDown(e){const r=this.getWidth(),n=this.getHeight();let s=1;if(e.maxDimension>0){const o=Math.max(r,n);o>e.maxDimension&&(s=e.maxDimension/o)}else s=1/e.quality;s<1&&this.resize(r*s,n*s,s)}}function Yr(t,e){var r;if(e.length>0){const n=t.data,s=n.length/4;let o,a,l,c,u;for(let h=0;h<s;h++){o=h*4,a=n[o+0],l=n[o+1],c=n[o+2],u=n[o+3];for(let d=0;d<e.length;d++)if(!((r=e[d])!=null&&r.call(e,a,l,c,u))){n[o+3]=0;break}}}return t}function tn(t){const e=new URL(t,location.href);return e.protocol===location.protocol&&e.host===location.host&&e.port===location.port}function en(t,e){const r=new URL(t),n=new URL(e);return r.protocol===n.protocol&&r.hostname===n.hostname&&r.port===n.port}class rn extends Zr{_getCanvas(){if(!this._canvas)throw new Error("Canvas is not initialized");return this._canvas}_getContext(){if(!this._context)throw new Error("Context is not initialized");return this._context}_getWidth(){if(!this._width)throw new Error("Width is not initialized");return this._width}_getHeight(){if(!this._height)throw new Error("Height is not initialized");return this._height}_initCanvas(){const e=this.image;if(!e)throw new Error("Image is not initialized");const r=this._canvas=document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new ReferenceError("Failed to create canvas context");this._context=n,r.className="@vibrant/canvas",r.style.display="none",this._width=r.width=e.width,this._height=r.height=e.height,n.drawImage(e,0,0),document.body.appendChild(r)}load(e){let r,n;if(typeof e=="string")r=document.createElement("img"),n=e,!tn(n)&&!en(window.location.href,n)&&(r.crossOrigin="anonymous"),r.src=n;else if(e instanceof HTMLImageElement)r=e,n=e.src;else return Promise.reject(new Error("Cannot load buffer as an image in browser"));return this.image=r,new Promise((s,o)=>{const a=()=>{this._initCanvas(),s(this)};r.complete?a():(r.onload=a,r.onerror=l=>o(new Error("Fail to load image: ".concat(n))))})}clear(){this._getContext().clearRect(0,0,this._getWidth(),this._getHeight())}update(e){this._getContext().putImageData(e,0,0)}getWidth(){return this._getWidth()}getHeight(){return this._getHeight()}resize(e,r,n){if(!this.image)throw new Error("Image is not initialized");this._width=this._getCanvas().width=e,this._height=this._getCanvas().height=r,this._getContext().scale(n,n),this._getContext().drawImage(this.image,0,0)}getPixelCount(){return this._getWidth()*this._getHeight()}getImageData(){return this._getContext().getImageData(0,0,this._getWidth(),this._getHeight())}remove(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}}function X(t,...e){return e.forEach(r=>{if(r){for(const n in r)if(r.hasOwnProperty(n)){const s=r[n];Array.isArray(s)?t[n]=s.slice(0):typeof s=="object"?(t[n]||(t[n]={}),X(t[n],s)):t[n]=s}}}),t}function nn(t,e){const{colorCount:r,quantizer:n,generators:s,filters:o}=t,a={colorCount:r},l=typeof n=="string"?{name:n,options:{}}:n;return l.options=X({},a,l.options),X({},{quantizer:l,generators:s,filters:o},e)}class sn{constructor(e,r={}){this._src=e,this._opts=X({},z.DefaultOpts,r)}maxColorCount(e){return this._opts.colorCount=e,this}maxDimension(e){return this._opts.maxDimension=e,this}addFilter(e){return this._opts.filters?this._opts.filters.push(e):this._opts.filters=[e],this}removeFilter(e){if(this._opts.filters){const r=this._opts.filters.indexOf(e);r>0&&this._opts.filters.splice(r)}return this}clearFilters(){return this._opts.filters=[],this}quality(e){return this._opts.quality=e,this}useImageClass(e){return this._opts.ImageClass=e,this}useGenerator(e,r){return this._opts.generators||(this._opts.generators=[]),this._opts.generators.push(r?{name:e,options:r}:e),this}useQuantizer(e,r){return this._opts.quantizer=r?{name:e,options:r}:e,this}build(){return new z(this._src,this._opts)}getPalette(){return this.build().getPalette()}}class pt{constructor(e){this.pipeline=e,this._map={}}names(){return Object.keys(this._map)}has(e){return!!this._map[e]}get(e){return this._map[e]}register(e,r){return this._map[e]=r,this.pipeline}}class on{constructor(){this.filter=new pt(this),this.quantizer=new pt(this),this.generator=new pt(this)}_buildProcessTasks({filters:e,quantizer:r,generators:n}){return n.length===1&&n[0]==="*"&&(n=this.generator.names()),{filters:e.map(o=>s(this.filter,o)),quantizer:s(this.quantizer,r),generators:n.map(o=>s(this.generator,o))};function s(o,a){let l,c;return typeof a=="string"?l=a:(l=a.name,c=a.options),{name:l,fn:o.get(l),options:c}}}async process(e,r){const{filters:n,quantizer:s,generators:o}=this._buildProcessTasks(r),a=await this._filterColors(n,e),l=await this._generateColors(s,a),c=await this._generatePalettes(o,l);return{colors:l,palettes:c}}_filterColors(e,r){return Promise.resolve(Yr(r,e.map(({fn:n})=>n)))}_generateColors(e,r){return Promise.resolve(e.fn(r.data,e.options))}async _generatePalettes(e,r){const n=await Promise.all(e.map(({fn:s,options:o})=>Promise.resolve(s(r,o))));return Promise.resolve(n.reduce((s,o,a)=>(s[e[a].name]=o,s),{}))}}function an(t,e,r){return"#"+((1<<24)+(t<<16)+(e<<8)+r).toString(16).slice(1,7)}function ln(t,e,r){t/=255,e/=255,r/=255;const n=Math.max(t,e,r),s=Math.min(t,e,r);let o=0,a=0;const l=(n+s)/2;if(n!==s){const c=n-s;switch(a=l>.5?c/(2-n-s):c/(n+s),n){case t:o=(e-r)/c+(e<r?6:0);break;case e:o=(r-t)/c+2;break;case r:o=(t-e)/c+4;break}o/=6}return[o,a,l]}function O(t,e,r){let n,s,o;function a(l,c,u){return u<0&&(u+=1),u>1&&(u-=1),u<1/6?l+(c-l)*6*u:u<1/2?c:u<2/3?l+(c-l)*(2/3-u)*6:l}if(e===0)n=s=o=r;else{const l=r<.5?r*(1+e):r+e-r*e,c=2*r-l;n=a(c,l,t+1/3),s=a(c,l,t),o=a(c,l,t-1/3)}return[n*255,s*255,o*255]}class D{static applyFilters(e,r){return r.length>0?e.filter(({r:n,g:s,b:o})=>{var a;for(let l=0;l<r.length;l++)if(!((a=r[l])!=null&&a.call(r,n,s,o,255)))return!1;return!0}):e}static clone(e){return new D(e._rgb,e._population)}get r(){return this._rgb[0]}get g(){return this._rgb[1]}get b(){return this._rgb[2]}get rgb(){return this._rgb}get hsl(){if(!this._hsl){const[e,r,n]=this._rgb;this._hsl=ln(e,r,n)}return this._hsl}get hex(){if(!this._hex){const[e,r,n]=this._rgb;this._hex=an(e,r,n)}return this._hex}get population(){return this._population}toJSON(){return{rgb:this.rgb,population:this.population}}getYiq(){if(!this._yiq){const e=this._rgb;this._yiq=(e[0]*299+e[1]*587+e[2]*114)/1e3}return this._yiq}get titleTextColor(){return this._titleTextColor||(this._titleTextColor=this.getYiq()<200?"#fff":"#000"),this._titleTextColor}get bodyTextColor(){return this._bodyTextColor||(this._bodyTextColor=this.getYiq()<150?"#fff":"#000"),this._bodyTextColor}constructor(e,r){this._rgb=e,this._population=r}}const se=class Ct{constructor(e,r){this._src=e,this.opts=X({},Ct.DefaultOpts,r)}static use(e){this._pipeline=e}static from(e){return new sn(e)}get result(){return this._result}_process(e,r){e.scaleDown(this.opts);const n=nn(this.opts,r);return Ct._pipeline.process(e.getImageData(),n)}async getPalette(){const e=new this.opts.ImageClass;try{const r=await e.load(this._src),n=await this._process(r,{generators:["default"]});this._result=n;const s=n.palettes.default;if(!s)throw new Error("Something went wrong and a palette was not found, please file a bug against our GitHub repo: https://github.com/vibrant-Colors/node-vibrant/");return e.remove(),s}catch(r){return e.remove(),Promise.reject(r)}}async getPalettes(){const e=new this.opts.ImageClass;try{const r=await e.load(this._src),n=await this._process(r,{generators:["*"]});this._result=n;const s=n.palettes;return e.remove(),s}catch(r){return e.remove(),Promise.reject(r)}}};se.DefaultOpts={colorCount:64,quality:5,filters:[]};let z=se;z.DefaultOpts.quantizer="mmcq";z.DefaultOpts.generators=["default"];z.DefaultOpts.filters=["default"];z.DefaultOpts.ImageClass=rn;const jt=5,xt=8-jt;class ht{constructor(e,r,n,s,o,a,l){this.histogram=l,this._volume=-1,this._avg=null,this._count=-1,this.dimension={r1:e,r2:r,g1:n,g2:s,b1:o,b2:a}}static build(e){const r=new Kr(e,{sigBits:jt}),{rmin:n,rmax:s,gmin:o,gmax:a,bmin:l,bmax:c}=r;return new ht(n,s,o,a,l,c,r)}invalidate(){this._volume=this._count=-1,this._avg=null}volume(){if(this._volume<0){const{r1:e,r2:r,g1:n,g2:s,b1:o,b2:a}=this.dimension;this._volume=(r-e+1)*(s-n+1)*(a-o+1)}return this._volume}count(){if(this._count<0){const{hist:e,getColorIndex:r}=this.histogram,{r1:n,r2:s,g1:o,g2:a,b1:l,b2:c}=this.dimension;let u=0;for(let h=n;h<=s;h++)for(let d=o;d<=a;d++)for(let f=l;f<=c;f++){const g=r(h,d,f);e[g]&&(u+=e[g])}this._count=u}return this._count}clone(){const{histogram:e}=this,{r1:r,r2:n,g1:s,g2:o,b1:a,b2:l}=this.dimension;return new ht(r,n,s,o,a,l,e)}avg(){if(!this._avg){const{hist:e,getColorIndex:r}=this.histogram,{r1:n,r2:s,g1:o,g2:a,b1:l,b2:c}=this.dimension;let u=0;const h=1<<8-jt;let d,f,g;d=f=g=0;for(let m=n;m<=s;m++)for(let p=o;p<=a;p++)for(let v=l;v<=c;v++){const C=r(m,p,v),b=e[C];b&&(u+=b,d+=b*(m+.5)*h,f+=b*(p+.5)*h,g+=b*(v+.5)*h)}u?this._avg=[~~(d/u),~~(f/u),~~(g/u)]:this._avg=[~~(h*(n+s+1)/2),~~(h*(o+a+1)/2),~~(h*(l+c+1)/2)]}return this._avg}contains(e){let[r,n,s]=e;const{r1:o,r2:a,g1:l,g2:c,b1:u,b2:h}=this.dimension;return r>>=xt,n>>=xt,s>>=xt,r>=o&&r<=a&&n>=l&&n<=c&&s>=u&&s<=h}split(){const{hist:e,getColorIndex:r}=this.histogram,{r1:n,r2:s,g1:o,g2:a,b1:l,b2:c}=this.dimension,u=this.count();if(!u)return[];if(u===1)return[this.clone()];const h=s-n+1,d=a-o+1,f=c-l+1,g=Math.max(h,d,f);let m=null,p,v;p=v=0;let C=null;if(g===h){C="r",m=new Uint32Array(s+1);for(let j=n;j<=s;j++){p=0;for(let w=o;w<=a;w++)for(let M=l;M<=c;M++){const T=r(j,w,M);e[T]&&(p+=e[T])}v+=p,m[j]=v}}else if(g===d){C="g",m=new Uint32Array(a+1);for(let j=o;j<=a;j++){p=0;for(let w=n;w<=s;w++)for(let M=l;M<=c;M++){const T=r(w,j,M);e[T]&&(p+=e[T])}v+=p,m[j]=v}}else{C="b",m=new Uint32Array(c+1);for(let j=l;j<=c;j++){p=0;for(let w=n;w<=s;w++)for(let M=o;M<=a;M++){const T=r(w,M,j);e[T]&&(p+=e[T])}v+=p,m[j]=v}}let b=-1;const I=new Uint32Array(m.length);for(let j=0;j<m.length;j++){const w=m[j];w&&(b<0&&w>v/2&&(b=j),I[j]=v-w)}const S=this;function L(j){const w=j+"1",M=j+"2",T=S.dimension[w];let B=S.dimension[M];const q=S.clone(),K=S.clone(),Z=b-T,y=B-b;for(Z<=y?(B=Math.min(B-1,~~(b+y/2)),B=Math.max(0,B)):(B=Math.max(T,~~(b-1-Z/2)),B=Math.min(S.dimension[M],B));!m[B];)B++;let W=I[B];for(;!W&&m[B-1];)W=I[--B];return q.dimension[M]=B,K.dimension[w]=B+1,[q,K]}return L(C)}}class $t{_sort(){this._sorted||(this.contents.sort(this._comparator),this._sorted=!0)}constructor(e){this._comparator=e,this.contents=[],this._sorted=!1}push(e){this.contents.push(e),this._sorted=!1}peek(e){return this._sort(),e=typeof e=="number"?e:this.contents.length-1,this.contents[e]}pop(){return this._sort(),this.contents.pop()}size(){return this.contents.length}map(e){return this._sort(),this.contents.map(e)}}const cn=.75;function Vt(t,e){let r=t.size();for(;t.size()<e;){const n=t.pop();if(n&&n.count()>0){const[s,o]=n.split();if(!s||(t.push(s),o&&o.count()>0&&t.push(o),t.size()===r))break;r=t.size()}else break}}const un=(t,e)=>{if(t.length===0||e.colorCount<2||e.colorCount>256)throw new Error("Wrong MMCQ parameters");const r=ht.build(t);r.histogram.colorCount;const n=new $t((o,a)=>o.count()-a.count());n.push(r),Vt(n,cn*e.colorCount);const s=new $t((o,a)=>o.count()*o.volume()-a.count()*a.volume());return s.contents=n.contents,Vt(s,e.colorCount-s.size()),dn(s)};function dn(t){const e=[];for(;t.size();){const r=t.pop(),n=r.avg();e.push(new D(n,r.count()))}return e}const hn={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function gn(t){let e=0;return t.forEach(r=>{e=Math.max(e,r.population)}),e}function fn(t,e){return t.Vibrant===e||t.DarkVibrant===e||t.LightVibrant===e||t.Muted===e||t.DarkMuted===e||t.LightMuted===e}function mn(t,e,r,n,s,o,a){function l(...u){let h=0,d=0;for(let f=0;f<u.length;f+=2){const g=u[f],m=u[f+1];!g||!m||(h+=g*m,d+=m)}return h/d}function c(u,h){return 1-Math.abs(u-h)}return l(c(t,e),a.weightSaturation,c(r,n),a.weightLuma,s/o,a.weightPopulation)}function N(t,e,r,n,s,o,a,l,c,u){let h=null,d=0;return e.forEach(f=>{const[,g,m]=f.hsl;if(g>=l&&g<=c&&m>=s&&m<=o&&!fn(t,f)){const p=mn(g,a,m,n,f.population,r,u);(h===null||p>d)&&(h=f,d=p)}}),h}function pn(t,e,r){const n={Vibrant:null,DarkVibrant:null,LightVibrant:null,Muted:null,DarkMuted:null,LightMuted:null};return n.Vibrant=N(n,t,e,r.targetNormalLuma,r.minNormalLuma,r.maxNormalLuma,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.LightVibrant=N(n,t,e,r.targetLightLuma,r.minLightLuma,1,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.DarkVibrant=N(n,t,e,r.targetDarkLuma,0,r.maxDarkLuma,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.Muted=N(n,t,e,r.targetNormalLuma,r.minNormalLuma,r.maxNormalLuma,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n.LightMuted=N(n,t,e,r.targetLightLuma,r.minLightLuma,1,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n.DarkMuted=N(n,t,e,r.targetDarkLuma,0,r.maxDarkLuma,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n}function xn(t,e,r){if(!t.Vibrant&&!t.DarkVibrant&&!t.LightVibrant){if(!t.DarkVibrant&&t.DarkMuted){let[n,s,o]=t.DarkMuted.hsl;o=r.targetDarkLuma,t.DarkVibrant=new D(O(n,s,o),0)}if(!t.LightVibrant&&t.LightMuted){let[n,s,o]=t.LightMuted.hsl;o=r.targetDarkLuma,t.DarkVibrant=new D(O(n,s,o),0)}}if(!t.Vibrant&&t.DarkVibrant){let[n,s,o]=t.DarkVibrant.hsl;o=r.targetNormalLuma,t.Vibrant=new D(O(n,s,o),0)}else if(!t.Vibrant&&t.LightVibrant){let[n,s,o]=t.LightVibrant.hsl;o=r.targetNormalLuma,t.Vibrant=new D(O(n,s,o),0)}if(!t.DarkVibrant&&t.Vibrant){let[n,s,o]=t.Vibrant.hsl;o=r.targetDarkLuma,t.DarkVibrant=new D(O(n,s,o),0)}if(!t.LightVibrant&&t.Vibrant){let[n,s,o]=t.Vibrant.hsl;o=r.targetLightLuma,t.LightVibrant=new D(O(n,s,o),0)}if(!t.Muted&&t.Vibrant){let[n,s,o]=t.Vibrant.hsl;o=r.targetMutesSaturation,t.Muted=new D(O(n,s,o),0)}if(!t.DarkMuted&&t.DarkVibrant){let[n,s,o]=t.DarkVibrant.hsl;o=r.targetMutesSaturation,t.DarkMuted=new D(O(n,s,o),0)}if(!t.LightMuted&&t.LightVibrant){let[n,s,o]=t.LightVibrant.hsl;o=r.targetMutesSaturation,t.LightMuted=new D(O(n,s,o),0)}}const bn=(t,e)=>{e=Object.assign({},hn,e);const r=gn(t),n=pn(t,r,e);return xn(n,r,e),n},vn=new on().filter.register("default",(t,e,r,n)=>n>=125&&!(t>250&&e>250&&r>250)).quantizer.register("mmcq",un).generator.register("default",bn);z.use(vn);function _n(t){var e=t.toString(16);return e.length===1?"0"+e:e}function At(t){return"#"+t.map(_n).join("")}function Cn(t){var e=(t[0]*299+t[1]*587+t[2]*114)/1e3;return e<128}function jn(t){return t?wn(t)?t:[t]:[]}function wn(t){return Array.isArray(t[0])}function St(t,e,r){for(var n=0;n<r.length;n++)if(Sn(t,e,r[n]))return!0;return!1}function Sn(t,e,r){switch(r.length){case 3:if(yn(t,e,r))return!0;break;case 4:if(Mn(t,e,r))return!0;break;case 5:if(In(t,e,r))return!0;break;default:return!1}}function yn(t,e,r){return t[e+3]!==255||t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]}function Mn(t,e,r){return t[e+3]&&r[3]?t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]&&t[e+3]===r[3]:t[e+3]===r[3]}function rt(t,e,r){return t>=e-r&&t<=e+r}function In(t,e,r){var n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=t[e+3],u=rt(c,a,l);return a?!!(!c&&u||rt(t[e],n,l)&&rt(t[e+1],s,l)&&rt(t[e+2],o,l)&&u):u}var Ln=24;function kn(t,e,r){for(var n={},s=r.dominantDivider||Ln,o=r.ignoredColor,a=r.step,l=[0,0,0,0,0],c=0;c<e;c+=a){var u=t[c],h=t[c+1],d=t[c+2],f=t[c+3];if(!(o&&St(t,c,o))){var g=Math.round(u/s)+","+Math.round(h/s)+","+Math.round(d/s);n[g]?n[g]=[n[g][0]+u*f,n[g][1]+h*f,n[g][2]+d*f,n[g][3]+f,n[g][4]+1]:n[g]=[u*f,h*f,d*f,f,1],l[4]<n[g][4]&&(l=n[g])}}var m=l[0],p=l[1],v=l[2],C=l[3],b=l[4];return C?[Math.round(m/C),Math.round(p/C),Math.round(v/C),Math.round(C/b)]:r.defaultColor}function Tn(t,e,r){for(var n=0,s=0,o=0,a=0,l=0,c=r.ignoredColor,u=r.step,h=0;h<e;h+=u){var d=t[h+3],f=t[h]*d,g=t[h+1]*d,m=t[h+2]*d;c&&St(t,h,c)||(n+=f,s+=g,o+=m,a+=d,l++)}return a?[Math.round(n/a),Math.round(s/a),Math.round(o/a),Math.round(a/l)]:r.defaultColor}function Bn(t,e,r){for(var n=0,s=0,o=0,a=0,l=0,c=r.ignoredColor,u=r.step,h=0;h<e;h+=u){var d=t[h],f=t[h+1],g=t[h+2],m=t[h+3];c&&St(t,h,c)||(n+=d*d*m,s+=f*f*m,o+=g*g*m,a+=m,l++)}return a?[Math.round(Math.sqrt(n/a)),Math.round(Math.sqrt(s/a)),Math.round(Math.sqrt(o/a)),Math.round(a/l)]:r.defaultColor}function Ot(t){return J(t,"defaultColor",[0,0,0,0])}function J(t,e,r){return t[e]===void 0?r:t[e]}var Ht=10,wt=100;function Rn(t){return t.search(/\.svg(\?|$)/i)!==-1}function Dn(t){if(oe(t)){var e=t.naturalWidth,r=t.naturalHeight;return!t.naturalWidth&&Rn(t.src)&&(e=r=wt),{width:e,height:r}}return $n(t)?{width:t.videoWidth,height:t.videoHeight}:le(t)?{width:t.codedWidth,height:t.codedHeight}:{width:t.width,height:t.height}}function zt(t){return Vn(t)?"canvas":En(t)?"offscreencanvas":le(t)?"videoframe":An(t)?"imagebitmap":t.src}function oe(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement}var ae=typeof OffscreenCanvas<"u";function En(t){return ae&&t instanceof OffscreenCanvas}function $n(t){return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement}function le(t){return typeof VideoFrame<"u"&&t instanceof VideoFrame}function Vn(t){return typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement}function An(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap}function On(t,e){var r=J(e,"left",0),n=J(e,"top",0),s=J(e,"width",t.width),o=J(e,"height",t.height),a=s,l=o;if(e.mode==="precision")return{srcLeft:r,srcTop:n,srcWidth:s,srcHeight:o,destWidth:a,destHeight:l};var c;return s>o?(c=s/o,a=wt,l=Math.round(a/c)):(c=o/s,l=wt,a=Math.round(l/c)),(a>s||l>o||a<Ht||l<Ht)&&(a=s,l=o),{srcLeft:r,srcTop:n,srcWidth:s,srcHeight:o,destWidth:a,destHeight:l}}var Hn=typeof window>"u";function zn(){return Hn?ae?new OffscreenCanvas(1,1):null:document.createElement("canvas")}var Fn="FastAverageColor: ";function A(t){return Error(Fn+t)}function Q(t,e){e||console.error(t)}var Pn=function(){function t(){this.canvas=null,this.ctx=null}return t.prototype.getColorAsync=function(e,r){if(!e)return Promise.reject(A("call .getColorAsync() without resource"));if(typeof e=="string"){if(typeof Image>"u")return Promise.reject(A("resource as string is not supported in this environment"));var n=new Image;return n.crossOrigin=r&&r.crossOrigin||"",n.src=e,this.bindImageEvents(n,r)}else{if(oe(e)&&!e.complete)return this.bindImageEvents(e,r);var s=this.getColor(e,r);return s.error?Promise.reject(s.error):Promise.resolve(s)}},t.prototype.getColor=function(e,r){r=r||{};var n=Ot(r);if(!e){var s=A("call .getColor() without resource");return Q(s,r.silent),this.prepareResult(n,s)}var o=Dn(e),a=On(o,r);if(!a.srcWidth||!a.srcHeight||!a.destWidth||!a.destHeight){var s=A('incorrect sizes for resource "'.concat(zt(e),'"'));return Q(s,r.silent),this.prepareResult(n,s)}if(!this.canvas&&(this.canvas=zn(),!this.canvas)){var s=A("OffscreenCanvas is not supported in this browser");return Q(s,r.silent),this.prepareResult(n,s)}if(!this.ctx){if(this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),!this.ctx){var s=A("Canvas Context 2D is not supported in this browser");return Q(s,r.silent),this.prepareResult(n)}this.ctx.imageSmoothingEnabled=!1}this.canvas.width=a.destWidth,this.canvas.height=a.destHeight;try{this.ctx.clearRect(0,0,a.destWidth,a.destHeight),this.ctx.drawImage(e,a.srcLeft,a.srcTop,a.srcWidth,a.srcHeight,0,0,a.destWidth,a.destHeight);var l=this.ctx.getImageData(0,0,a.destWidth,a.destHeight).data;return this.prepareResult(this.getColorFromArray4(l,r))}catch(c){var s=A("security error (CORS) for resource ".concat(zt(e),".\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image"));return Q(s,r.silent),r.silent||console.error(c),this.prepareResult(n,s)}},t.prototype.getColorFromArray4=function(e,r){r=r||{};var n=4,s=e.length,o=Ot(r);if(s<n)return o;var a=s-s%n,l=(r.step||1)*n,c;switch(r.algorithm||"sqrt"){case"simple":c=Tn;break;case"sqrt":c=Bn;break;case"dominant":c=kn;break;default:throw A("".concat(r.algorithm," is unknown algorithm"))}return c(e,a,{defaultColor:o,ignoredColor:jn(r.ignoredColor),step:l,dominantDivider:r.dominantDivider})},t.prototype.prepareResult=function(e,r){var n=e.slice(0,3),s=[e[0],e[1],e[2],e[3]/255],o=Cn(e);return{value:[e[0],e[1],e[2],e[3]],rgb:"rgb("+n.join(",")+")",rgba:"rgba("+s.join(",")+")",hex:At(n),hexa:At(e),isDark:o,isLight:!o,error:r}},t.prototype.destroy=function(){this.canvas&&(this.canvas.width=1,this.canvas.height=1,this.canvas=null),this.ctx=null},t.prototype.bindImageEvents=function(e,r){var n=this;return new Promise(function(s,o){var a=function(){u();var h=n.getColor(e,r);h.error?o(h.error):s(h)},l=function(){u(),o(A('Error loading image "'.concat(e.src,'"')))},c=function(){u(),o(A('Image "'.concat(e.src,'" loading aborted')))},u=function(){e.removeEventListener("load",a),e.removeEventListener("error",l),e.removeEventListener("abort",c)};e.addEventListener("load",a),e.addEventListener("error",l),e.addEventListener("abort",c)})},t}();const Wn=({manga:t,mangaDynamicColorSchemes:e})=>{const r=te(),{setDynamicColor:n}=Le(),s=Ut({variant:"popover",popupId:"manga-thumbnail-fullscreen"}),[o,a]=_.useState(!1),l=ot.getThumbnailUrl(t);return _.useLayoutEffect(()=>{if(!e)return()=>{};let c={response:Promise.resolve(""),cleanup:It,abortRequest:It,fromCache:!1};return(async()=>{c=await F.requestImage(l);const h=await c.response,d=new Image;d.crossOrigin="anonymous",d.src=h,d.onload=()=>{const f=d.width>600&&d.height>900;Promise.all([z.from(d).getPalette(),new Pn().getColor(d,{algorithm:"dominant",mode:f?"speed":"precision",ignoredColor:[[255,255,255,255,75],[0,0,0,255,75]]})]).then(([g,m])=>{!g.Vibrant||!g.DarkVibrant||!g.LightVibrant||!g.LightMuted||!g.Muted||!g.DarkMuted||n({...g,average:m})})}})().catch(()=>{}),()=>{c.cleanup(),n(null)}},[l,e]),i.jsxs(i.Fragment,{children:[i.jsxs(k,{sx:{position:"relative",borderRadius:1,overflow:"hidden",backgroundColor:"background.paper",width:"125px",maxHeight:"fit-content",aspectRatio:_r,flexShrink:0,flexGrow:0,[r.breakpoints.up("lg")]:{width:"200px",maxHeight:"fit-content"},[r.breakpoints.up("xl")]:{width:"300px",maxHeight:"fit-content"}},children:[i.jsx(vt,{src:l,alt:"Manga Thumbnail",onLoad:()=>a(!0),imgStyle:{width:"100%",height:"100%",objectFit:"cover"}}),o&&i.jsx(k,{...gt(s),sx:{position:"absolute",top:0,bottom:0,width:"100%",justifyContent:"center",alignItems:"center",opacity:0,"&:hover":{background:"rgba(0, 0, 0, 0.4)",cursor:"pointer",opacity:1}},children:i.jsx(Xr,{fontSize:"large",color:"primary"})})]}),i.jsx(ke,{...Te(s),sx:{outline:0},children:i.jsx(k,{onClick:()=>s.close(),sx:{height:"100vh",p:2,outline:0,justifyContent:"center",alignItems:"center"},children:i.jsx(vt,{src:l,alt:"Manga Thumbnail",imgStyle:{height:"100%",width:"100%",objectFit:"contain"}})})})]})},yt=({query:t,sourceId:e,mode:r,children:n})=>{const s=r==="source"&&e!==void 0?G.sources.childRoutes.browse.path(e,t):r==="source.global-search"?G.sources.childRoutes.searchAll.path(t):G.library.path(void 0,t);return i.jsx(_t,{component:at,to:s,sx:{textDecoration:"none",color:"inherit"},children:n!=null?n:t})},Ft="35px",Pt=75,Nn=({manga:{description:t,genre:e,sourceId:r},mode:n})=>{const[s,o]=_.useState(null),[a,l]=_.useState();Jt(s,_.useCallback(()=>l(s==null?void 0:s.clientHeight),[s]));const[c,u]=Be("isDescriptionGenreCollapsed",!0),h=t?Math.min(Pt,a!=null?a:Pt):0,d=_.useMemo(()=>e.filter(Boolean),[e]);return i.jsxs(i.Fragment,{children:[t&&i.jsxs(k,{sx:{position:"relative"},children:[i.jsx(Re,{collapsedSize:h,in:!c,children:i.jsx(ut,{ref:o,sx:{whiteSpace:"pre-line",textAlign:"justify",textJustify:"inter-word",mb:Ft},children:t})}),i.jsx(k,{onClick:()=>u(!c),sx:{justifyContent:"flex-start",alignItems:"center",cursor:"pointer",position:"absolute",width:"100%",height:Ft,bottom:0,background:f=>"linear-gradient(transparent -15px, ".concat(f.palette.background.default,")")},children:i.jsx(E,{sx:{color:f=>f.palette.mode==="light"?"black":"text"},children:c?i.jsx(Sr,{}):i.jsx(yr,{})})})]}),i.jsx(k,{sx:{flexDirection:"row",flexWrap:c?"no-wrap":"wrap",gap:1,overflowX:c?"auto":null},children:d.map(f=>i.jsx(yt,{query:f,sourceId:r,mode:n,children:i.jsx(Mr,{label:f,variant:"outlined",onClick:()=>{}})},f))})]})},Gn=P("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(2),padding:t.spacing(1),[t.breakpoints.up("md")]:{flexBasis:"40%",height:"calc(100vh - 64px)",overflowY:"auto"}})),Un=({url:t,mangaThumbnailBackdrop:e,children:r})=>i.jsxs(k,{sx:{position:"relative"},children:[e&&i.jsxs(k,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden"},children:[i.jsx(vt,{spinnerStyle:{display:"none"},imgStyle:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"},src:t,alt:"Manga Thumbnail"}),i.jsx(k,{sx:{"&::before":n=>De(e,{position:"absolute",display:"inline-block",content:'""',top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(to top, ".concat(n.palette.background.default,", transparent 100%, transparent 1px),linear-gradient(to right, ").concat(n.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to bottom, ").concat(n.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to left, ").concat(n.palette.background.default,", transparent 50%, transparent 1px)"),backdropFilter:"blur(4.5px) brightness(0.75)"})}})]}),r]}),qn=P("div")(({theme:t})=>({display:"flex",paddingBottom:t.spacing(1)})),Qn=P("div")(({theme:t})=>({zIndex:1,marginLeft:t.spacing(1)})),nt=t=>i.jsx(wr,{...t}),Jn=P("div")(({theme:t})=>({display:"flex",gap:t.spacing(1)})),Xn=({url:t})=>{const{i18n:e,_:r}=V();return i.jsxs(qr,{children:[i.jsx($,{title:e._({id:"ZdWg0V"}),disabled:!t,children:i.jsx(Bt,{size:"medium",disabled:!t,component:_t,href:t!=null?t:void 0,target:"_blank",rel:"noreferrer",variant:"outlined",children:i.jsx(mr,{})})}),i.jsx($,{title:e._({id:"Xrk3+q"}),disabled:!t,children:i.jsx(Bt,{size:"medium",disabled:!t,component:_t,href:t?F.getWebviewUrl(t):void 0,target:"_blank",rel:"noreferrer",variant:"outlined",children:i.jsx(vr,{})})})]})};function Kn(t){var e;return t?Ee.isLocalSource(t)?bt._({id:"LECJgZ"}):(e=t.displayName)!=null?e:t.id:bt._({id:"Ef7StM"})}const Wt=(t,e,r)=>t==null?void 0:t.map(n=>i.jsx(yt,{query:n,sourceId:e,mode:r},n)).reduce((n,s)=>i.jsxs(i.Fragment,{children:[n,", ",s]})),Zn=({manga:t,mode:e})=>{var c,u;const{i18n:r,_:n}=V(),{settings:{mangaThumbnailBackdrop:s,mangaDynamicColorSchemes:o}}=ee();_.useEffect(()=>{t.source||dt(r._({id:"wGxz70"}),"error")},[t.source,n]);const{updateLibraryState:a}=tr(t),l=async()=>{try{await navigator.clipboard.writeText(t.title),dt(r._({id:"FxVG/l"}),"info")}catch(h){Kt("MangaDetails::copyTitleLongPress")(h)}};return i.jsxs(Gn,{children:[i.jsxs(Un,{url:ot.getThumbnailUrl(t),mangaThumbnailBackdrop:s,children:[i.jsxs(qn,{children:[i.jsx(Wn,{manga:t,mangaDynamicColorSchemes:o}),i.jsxs(Qn,{children:[i.jsxs(k,{sx:{flexDirection:"row",gap:1,alignItems:"flex-start",mb:1},children:[i.jsx(yt,{query:t.title,sourceId:t.sourceId,mode:"source.global-search",children:i.jsx(ut,{variant:"h5",component:"h2",sx:{wordBreak:"break-word"},children:t.title})}),i.jsx($,{title:r._({id:"he3ygx"}),children:i.jsx(E,{onClick:l,color:"inherit",children:i.jsx(Pr,{fontSize:"small"})})})]}),t.author&&i.jsx(nt,{title:r._({id:"VbeIOx"}),value:Wt(ot.getAuthors(t),(c=t.source)==null?void 0:c.id,e)}),t.artist&&i.jsx(nt,{title:r._({id:"0s5Sjx"}),value:Wt(ot.getArtists(t),(u=t.source)==null?void 0:u.id,e)}),i.jsx(nt,{title:r._({id:"uAQUqI"}),value:r._(Cr[t.status])}),i.jsx(nt,{title:r._({id:"wdxz7K"}),value:Kn(t.source)})]})]}),i.jsxs(Jn,{children:[i.jsxs(ie,{size:lt.useIsMobileWidth()?"small":"medium",onClick:a,variant:t.inLibrary?"contained":"outlined",children:[t.inLibrary?i.jsx(br,{}):i.jsx(er,{}),t.inLibrary?r._({id:"GcCthe"}):r._({id:"RsaYWP"})]}),i.jsx(Jr,{manga:t}),i.jsx(Xn,{url:t.realUrl})]})]}),i.jsx(Nn,{manga:t,mode:e})]})},Nt=U(i.jsx("path",{d:"M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8m-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12m3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8m5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8m3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"})),Yn=({manga:t,onRefresh:e,refreshing:r})=>{const{i18n:n,_:s}=V(),o=te(),a=$e(o.breakpoints.up("sm")),{settings:l}=ee(),[c,u]=Ve.useState(null),h=!!c,d=()=>{u(null)},f=()=>{Lt.show(rr,{mangaId:t.id})},g=()=>{Lt.show(Ir,{mode:"save_dynamic"})};return i.jsxs(i.Fragment,{children:[a&&i.jsxs(i.Fragment,{children:[i.jsx($,{title:n._({id:"+NckRw"}),disabled:r,children:i.jsx(E,{onClick:()=>{e()},disabled:r,color:"inherit",children:i.jsx(Dt,{})})}),l.mangaDynamicColorSchemes&&i.jsx($,{title:n._({id:"Bs1P1+"}),children:i.jsx(E,{onClick:g,color:"inherit",children:i.jsx(Nt,{})})}),t.inLibrary&&i.jsxs(i.Fragment,{children:[i.jsx($,{title:n._({id:"y5rS9U"}),children:i.jsx(at,{to:G.migrate.childRoutes.search.path(t.sourceId,t.id,t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:i.jsx(E,{color:"inherit",children:i.jsx(kt,{})})})}),i.jsx($,{title:n._({id:"wSseJ9"}),children:i.jsx(E,{onClick:()=>{f()},color:"inherit",children:i.jsx(Tt,{})})})]})]}),!a&&i.jsxs(i.Fragment,{children:[i.jsx(E,{id:"chaptersMenuButton","aria-controls":h?"chaptersMenu":void 0,"aria-haspopup":"true","aria-expanded":h?"true":void 0,onClick:m=>u(m.currentTarget),color:"inherit",children:i.jsx(Ae,{})}),i.jsxs(Qt,{id:"chaptersMenu",anchorEl:c,open:h,onClose:d,MenuListProps:{"aria-labelledby":"chaptersMenuButton"},children:[i.jsxs(Y,{onClick:()=>{e(),d()},disabled:r,children:[i.jsx(tt,{children:i.jsx(Dt,{fontSize:"small"})}),i.jsx(et,{children:n._({id:"+NckRw"})})]}),l.mangaDynamicColorSchemes&&i.jsxs(Y,{onClick:g,children:[i.jsx(tt,{children:i.jsx(Nt,{fontSize:"small"})}),i.jsx(et,{children:n._({id:"Bs1P1+"})})]}),t.inLibrary&&[i.jsxs(Y,{component:at,to:G.migrate.childRoutes.search.path(t.sourceId,t.id,t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:[i.jsx(tt,{children:i.jsx(kt,{fontSize:"small"})}),i.jsx(et,{children:n._({id:"y5rS9U"})})]},"migrate"),i.jsxs(Y,{onClick:()=>{f(),d()},children:[i.jsx(tt,{children:i.jsx(Tt,{fontSize:"small"})}),i.jsx(et,{children:n._({id:"wSseJ9"})})]},"categories")]]})]})]})},es=()=>{var v,C;const{i18n:t,_:e}=V(),{id:r}=Oe(),{mode:n}=(v=He().state)!=null?v:{},s=_.useRef(!1),{data:o,error:a,loading:l,networkStatus:c,refetch:u}=F.useGetManga(ze,r),h=Fe(c),d=o==null?void 0:o.manga,[f,{loading:g,error:m}]=Fr(r),p=a!=null?a:m;return _.useEffect(()=>{if(d==null)return;!s.current&&!d.initialized&&(s.current=!0,f())},[d]),Lr((C=d==null?void 0:d.title)!=null?C:t._({id:"uB8LjK"}),i.jsxs(k,{direction:"row",sx:{alignItems:"center"},children:[p&&!h&&!g&&i.jsx($,{title:i.jsxs(i.Fragment,{children:[t._({id:"wCaJj1"}),i.jsx("br",{}),ct(p)]}),children:i.jsx(E,{onClick:()=>u(),children:i.jsx(Tr,{color:"error"})})}),d&&(g||h)&&i.jsx(E,{disabled:!0,children:i.jsx(Pe,{size:16})}),d&&i.jsx(Yn,{manga:d,onRefresh:f,refreshing:g})]}),[e,p,h,g,d,f]),p&&!d?i.jsx(st,{message:t._({id:"wCaJj1"}),messageExtra:ct(p)}):i.jsxs(Zt,{sx:{display:{md:"flex"},overflow:"hidden"},children:[l&&i.jsx(Xt,{}),d&&i.jsx(Zn,{manga:d,mode:n}),d&&i.jsx(zr,{manga:d,isRefreshing:g})]})};export{es as Manga};
