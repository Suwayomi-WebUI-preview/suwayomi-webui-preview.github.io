import{r as k,i as R,j as a,u as U,M as J,c as m,a as c,h as j,P,f as I,bn as E,I as G,K as S,S as q,V as L,O as N,a2 as C,m as _}from"./index-BVmGrBUs.js";import{d as w}from"./Refresh-CKR4F3wd.js";import{P as F}from"./Progress-B4a3pMXA.js";var b={},H=R;Object.defineProperty(b,"__esModule",{value:!0});var y=b.default=void 0,D=H(k()),O=a;y=b.default=(0,D.default)((0,O.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");const z=r=>{if(!r)return 0;const s=r.failedJobs.mangas.totalCount+r.completeJobs.mangas.totalCount,o=s+r.pendingJobs.mangas.totalCount+r.runningJobs.mangas.totalCount,i=100*(s/o);return Number.isNaN(i)?0:i};let n=!1;function $({categoryId:r,handleFinishedUpdate:s}){const{t:o}=U(),i=J.useIsTouchDevice(),[g,f]=m.useState(!1),{data:u,refetch:x}=c.useGetLastGlobalUpdateTimestamp(),h=u==null?void 0:u.lastUpdateTimestamp.timestamp,{data:d}=c.useGetGlobalUpdateSummary(),e=d==null?void 0:d.updateStatus,l=!!(e!=null&&e.isRunning),v=m.useMemo(()=>z(e),[e==null?void 0:e.failedJobs.mangas.totalCount,e==null?void 0:e.completeJobs.mangas.totalCount,e==null?void 0:e.pendingJobs.mangas.totalCount,e==null?void 0:e.runningJobs.mangas.totalCount]);m.useEffect(()=>{!n&&(e!=null&&e.isRunning)&&(n=!0),n&&v===100&&(n=!1,s==null||s(),x().catch(j()))},[e==null?void 0:e.isRunning]);const M=async t=>{try{n=!0,await c.startGlobalUpdate(t!==void 0?[t]:void 0).response,x().catch(j("UpdateChecker::reFetchLastTimestamp"))}catch(B){n=!1,_(o("global.error.label.update_failed"),"error")}},T=async()=>{try{await c.resetGlobalUpdate()}catch(t){_(o("library.error.label.stop_global_update"),"error")}},p=async t=>{l?T():M(t)};return a.jsx(P,{variant:"popover",popupId:"library-update-checker-menu",children:t=>a.jsxs(a.Fragment,{children:[a.jsx(I,{title:l?o("library.action.label.stop_update"):o("library.settings.global_update.label.last_update_tooltip",{date:h?E.format(+h):"-"}),children:a.jsx(G,{sx:{position:"relative"},...r!==void 0&&!l?S(t):{onClick:()=>p()},onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),color:"inherit",children:l?a.jsxs(a.Fragment,{children:[a.jsx(y,{sx:{opacity:Number(i||g)}}),a.jsx(q,{sx:{position:"absolute"},children:a.jsx(F,{progress:v,showText:!i&&!g,progressProps:{color:"inherit"}})})]}):a.jsx(w,{})})}),a.jsxs(L,{...N(t),children:[a.jsx(C,{onClick:()=>{t.close(),p()},children:o("library.action.label.update_library")}),a.jsx(C,{onClick:()=>{t.close(),p(r)},children:o("library.action.label.update_category")})]})]})})}export{$ as U,y as d};
