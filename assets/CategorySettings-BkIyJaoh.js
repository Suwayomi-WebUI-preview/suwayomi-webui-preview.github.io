import{u as F,j as e,B as u,T as O,S as P,f as _,I as T,a as i,c as s,N as v,a_ as M,H as $,g as q,h as z,X as U,aF as V,aG as W,aH as X,b as S}from"./index-BLgYiawO.js";import{d as J,D as K,S as Q,P as Y}from"./StrictModeDroppable-b8mJGYnI.js";import{d as Z}from"./Add-CSZKIl-5.js";import{D as ee,F as te}from"./StyledFab-Bn_g68I2.js";import{E as ae}from"./EmptyViewAbsoluteCentered-DdVIYYLb.js";import{d as oe}from"./Edit-DxjZDWIi.js";import{d as re}from"./Delete-yg-QzkHg.js";import{C as se}from"./Card-qMlyKuip.js";import{C as ne}from"./CardContent-CSR8wzft.js";import{T as le}from"./TextField-DjPg3JDd.js";import{F as ie,C as ce}from"./Checkbox-C2R3MqBz.js";import"./SwitchBase-C5DQKxRJ.js";const de=({category:a,provided:n,onEdit:c})=>{const{t:r}=F(),m=()=>{i.deleteCategory(a.id)};return e.jsx(u,{sx:{p:1,pb:0},...n.draggableProps,...n.dragHandleProps,ref:n.innerRef,children:e.jsx(se,{children:e.jsxs(ne,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5,"&:last-child":{paddingBottom:1.5},gap:2},children:[e.jsx(J,{}),e.jsx(O,{sx:{flexGrow:1},variant:"h6",component:"h2",children:a.name}),e.jsxs(P,{sx:{flexDirection:"row"},children:[e.jsx(_,{title:r("global.button.edit"),children:e.jsx(T,{component:u,onClick:c,size:"large",children:e.jsx(oe,{})})}),e.jsx(_,{title:r("chapter.action.download.delete.label.action"),children:e.jsx(T,{component:u,onClick:m,size:"large",children:e.jsx(re,{})})})]})]})})})};function Ee(){const{t:a}=F(),{setTitle:n,setAction:c}=s.useContext(v);s.useLayoutEffect(()=>(n(a("category.title.category_other")),c(null),()=>{n(""),c(null)}),[a]);const{data:r,loading:m,error:y,refetch:k}=i.useGetCategories(M,{notifyOnNetworkStatusChange:!0}),l=s.useMemo(()=>{var o;const t=[...(o=r==null?void 0:r.categories.nodes)!=null?o:[]];return t.length>0&&t[0].name==="Default"&&t.shift(),t},[r]),[p,b]=s.useState(-1),[B,d]=s.useState(!1),[f,x]=s.useState(""),[h,C]=s.useState(!1),[I,{reset:w}]=i.useReorderCategory(),D=$(),G=(t,o,g)=>{const j=t[o];I({variables:{input:{id:j.id,position:g+1}}}).catch(()=>w())},R=t=>{t.destination&&G(l,t.source.index,t.destination.index)},A=()=>{x(""),C(!1),b(-1)},H=()=>{A(),d(!0)},L=t=>{x(l[t].name),C(l[t].default),b(t),d(!0)},E=()=>{d(!1)},N=()=>{if(d(!1),p===-1)i.createCategory({name:f,default:h});else{const t=l[p];i.updateCategory(t.id,{name:f,default:h})}};return m?e.jsx(q,{}):y?e.jsx(ae,{message:a("category.error.label.request_failure"),messageExtra:y.message,retry:()=>k().catch(z())}):e.jsxs(e.Fragment,{children:[e.jsx(K,{onDragEnd:R,children:e.jsx(Q,{droppableId:"droppable",children:t=>e.jsxs(u,{ref:t.innerRef,sx:{paddingBottom:ee},children:[l.map((o,g)=>e.jsx(Y,{draggableId:o.id.toString(),index:g,children:j=>e.jsx(de,{provided:j,category:o,onEdit:()=>L(g)})},o.id)),t.placeholder]})})}),e.jsx(te,{color:"primary","aria-label":"add",style:{position:"fixed",bottom:D.spacing(2),right:D.spacing(2)},onClick:H,children:e.jsx(Z,{})}),e.jsxs(U,{open:B,onClose:E,children:[e.jsx(V,{id:"form-dialog-title",children:a(p===-1?"category.dialog.title.new_category":"category.dialog.title.edit_category")}),e.jsxs(W,{children:[e.jsx(le,{autoFocus:!0,margin:"dense",id:"name",label:a("category.label.category_name"),type:"text",fullWidth:!0,value:f,onChange:t=>x(t.target.value)}),e.jsx(ie,{control:e.jsx(ce,{checked:h,onChange:t=>C(t.target.checked)}),label:a("category.label.use_as_default_category")})]}),e.jsxs(X,{children:[e.jsx(S,{onClick:E,color:"primary",children:a("global.button.cancel")}),e.jsx(S,{onClick:N,color:"primary",children:a("global.button.submit")})]})]})]})}export{Ee as CategorySettings};
