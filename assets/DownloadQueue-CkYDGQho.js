import{r as k,i as $,j as e,u as T,a as n,c as j,N,f as m,I as u,D as x,g as F,h as R,B as w,L as G,S as K,T as P,w as W,m as v}from"./index-DCLtpUvd.js";import{d as J}from"./Delete-CmQHBm0P.js";import{D as U,S as X,P as Y,d as Z}from"./StrictModeDroppable-D17Ds8Bm.js";import{d as ee}from"./PlayArrow-DYMumPhT.js";import{V as te}from"./index-CUtiZdHq.js";import{d as re}from"./Refresh-BvluAULJ.js";import{D as ae}from"./DownloadStateIndicator-DYkbVZHR.js";import{E as z}from"./EmptyViewAbsoluteCentered-CW_zNQ4R.js";import{C as oe}from"./Card-C0ry1gLE.js";import{C as se}from"./CardActionArea-BZXNbXAI.js";import{C as ne}from"./CardContent-DvoLRTUo.js";var b={},le=$;Object.defineProperty(b,"__esModule",{value:!0});var H=b.default=void 0,ie=le(k()),de=e;H=b.default=(0,ie.default)((0,de.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause");var D={},ce=$;Object.defineProperty(D,"__esModule",{value:!0});var L=D.default=void 0,ue=ce(k()),pe=e;L=D.default=(0,ue.default)((0,pe.jsx)("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3zM14 5h-3l-1-1H6L5 5H2v2h12z"}),"DeleteSweep");const he=({children:r,...o})=>e.jsx(w,{...o,style:{height:o["data-known-size"]||void 0},children:r}),q=({provided:r,item:o,handleDelete:f,handleRetry:d})=>{const{t:p}=T();return e.jsx(w,{...r.draggableProps,...r.dragHandleProps,ref:r.innerRef,sx:{p:1,pb:0},children:e.jsx(oe,{children:e.jsx(se,{component:G,to:"/manga/".concat(o.manga.id),children:e.jsxs(ne,{sx:{display:"flex",alignItems:"center",p:1.5},children:[e.jsx(u,{sx:{pointerEvents:"none"},children:e.jsx(Z,{})}),e.jsxs(K,{sx:{flex:1,ml:1},direction:"column",children:[e.jsx(P,{variant:"h6",component:"h3",children:o.manga.title}),e.jsx(P,{variant:"caption",sx:{display:"block"},children:o.chapter.name})]}),e.jsx(ae,{download:o}),o.state===W.Error&&e.jsx(m,{title:p("global.button.retry"),children:e.jsx(u,{onClick:l=>{l.preventDefault(),l.stopPropagation(),d(o.chapter)},size:"large",children:e.jsx(re,{})})}),e.jsx(m,{title:p("chapter.action.download.delete.label.action"),children:e.jsx(u,{onClick:l=>{l.preventDefault(),l.stopPropagation(),f(o.chapter)},size:"large",children:e.jsx(J,{})})})]})})})})},ye=()=>{var E,I;const{t:r}=T(),[o,{reset:f}]=n.useReorderChapterInDownloadQueue(),{data:d,loading:p,error:l,refetch:M}=n.useGetDownloadStatus({notifyOnNetworkStatusChange:!0}),i=d==null?void 0:d.downloadStatus,h=(E=i==null?void 0:i.queue)!=null?E:[],c=(I=i==null?void 0:i.state)!=null?I:"STARTED",g=!h.length,{setTitle:_,setAction:C}=j.useContext(N),Q=async()=>{try{await n.clearDownloads().response}catch(t){v(r("download.queue.error.label.failed_delete_all"),"error")}},V=()=>{c===x.Stopped?n.startDownloads():n.stopDownloads()};j.useLayoutEffect(()=>(_(r("download.queue.title")),C(e.jsxs(e.Fragment,{children:[e.jsx(m,{title:r("download.queue.label.delete_all"),children:e.jsx(u,{onClick:Q,size:"large",color:"inherit",children:e.jsx(L,{})})}),e.jsx(m,{title:r(c===x.Started?"global.button.start":"global.button.stop"),children:e.jsx(u,{onClick:V,size:"large",disabled:g,color:"inherit",children:c===x.Stopped?e.jsx(ee,{}):e.jsx(H,{})})})]})),()=>{_(""),C(null)}),[r,c,g]),j.useEffect(()=>{const t=a=>{(a.message==="ResizeObserver loop completed with undelivered notifications."||a.message==="ResizeObserver loop limit exceeded")&&a.stopImmediatePropagation()};return window.addEventListener("error",t),()=>window.removeEventListener("error",t)},[]);const A=(t,a,s)=>{a!==s&&o({variables:{input:{chapterId:t[a].chapter.id,to:s}}}).catch(()=>{f()})},O=t=>{t.destination&&A(h,t.source.index,t.destination.index)},y=async t=>{try{await n.addChapterToDownloadQueue(t.id).response}catch(a){v(r("download.queue.error.label.failed_to_remove"),"error")}},S=async t=>{const a=c===x.Started;try{a&&await n.stopDownloads().response,await Promise.all([n.removeChapterFromDownloadQueue(t.id).response,n.deleteDownloadedChapter(t.id).response])}catch(s){v(r("download.queue.error.label.failed_to_retry"),"error")}a&&n.startDownloads().response.catch(R())};return p?e.jsx(F,{}):l?e.jsx(z,{message:r("global.error.label.failed_to_load_data"),messageExtra:l.message,retry:()=>M().catch(R())}):g?e.jsx(z,{message:r("download.queue.label.no_downloads")}):e.jsx(U,{onDragEnd:O,children:e.jsx(X,{droppableId:"droppable",mode:"virtual",renderClone:(t,a,s)=>e.jsx(q,{provided:t,item:h[s.source.index],handleDelete:S,handleRetry:y}),children:t=>e.jsx(w,{ref:t.innerRef,children:e.jsx(te,{useWindowScroll:!0,overscan:window.innerHeight*.5,data:h,components:{Item:he},computeItemKey:(a,s)=>s.chapter.id,itemContent:(a,s)=>e.jsx(Y,{draggableId:"".concat(s.chapter.id),index:a,children:B=>e.jsx(q,{provided:B,item:s,handleDelete:S,handleRetry:y})})})})})})};export{ye as DownloadQueue};
