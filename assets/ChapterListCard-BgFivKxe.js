import{c as v,j as e,u as W,r as $,bk as X,e as Z,f as B,k as J,a8 as Y,U as z,aB as ee,b as y,b0 as j,L as te,C as O,I as re,aC as ae,bf as oe,H as E,T as se,G as ne}from"./index-BeKqgGKZ.js";import{c as ie,b as m,d as le,e as de,h as ce,D as me,R as pe,V as he,M as xe,a as ue}from"./useManageMangaLibraryState-5JG7wS-l.js";import{g as ke}from"./DateHelper-CUG5tu8R.js";import{C as Ce,D as ge}from"./ChapterCardMetadata-BpXGnoyt.js";import{D as be}from"./Delete-ByM-3zaS.js";import{D as Ie}from"./Download-DRF1_ytV.js";import{D as fe}from"./DoneAll-DOc3qM4K.js";import{a as i,C as _e}from"./Chapters-AzercDRH.js";import{I as je}from"./IconWebView-CCrDxjrZ.js";import{M as Me}from"./MUI.util-CEodEA2f.js";import{L as De}from"./ListCardContent-CUvsnK_z.js";import{C as we}from"./Card-2kPOafNu.js";import{C as ye}from"./CardActionArea-BAvksYw8.js";import{C as ve}from"./Checkbox-B_--xYMy.js";const Te=v(e.jsx("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"})),Re=v(e.jsx("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"})),Ae=v(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),Ve=Ae,Be=({chapter:t,handleSelection:o,canBeDownloaded:_=!1,selectedChapters:s=[],onClose:d,selectable:g=!0})=>{var S,P,G;const{i18n:n,_:a}=W(),c=!!t,{isDownloaded:b,isRead:u,isBookmarked:M}=t!=null?t:{},I=(G=(P=$.useGetMangaChapters(X,(S=t==null?void 0:t.mangaId)!=null?S:-1,{skip:!t,fetchPolicy:"cache-only"}).data)==null?void 0:P.chapters.nodes)!=null?G:[],{settings:{deleteChaptersWithBookmark:D}}=Z(),p=de(c,_e),h=ie(c),C=ce(c),{downloadableChapters:r,downloadedChapters:l,unbookmarkedChapters:x,bookmarkedChapters:T,unreadChapters:R,readChapters:A}=B.useMemo(()=>({downloadableChapters:i.getDownloadable(s),downloadedChapters:i.getDownloaded(s),unbookmarkedChapters:i.getNonBookmarked(s),bookmarkedChapters:i.getBookmarked(s),unreadChapters:i.getNonRead(s),readChapters:i.getRead(s)}),[s]),F=()=>{o==null||o(t.id,!0),d()},f=(N,K)=>{var H;const L=N==="mark_prev_as_read",U=L?"mark_as_read":N;if(U==="delete"&&t&&!i.isDeletable(t,D)){d();return}const w=(()=>{if(!t)return K;if(!L)return[t];const V=I.findIndex(({id:q})=>q===t.id);if(V+1>I.length-1)return[];const Q=I.slice(V+1);return i.getNonRead(Q)})();if(!w.length){d();return}i.performAction(U,i.getIds(w),{chapters:w,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(H=w[0])==null?void 0:H.mangaId}).catch(J("ChapterActionMenuItems::performAction")),d()};return e.jsxs(e.Fragment,{children:[c&&g&&e.jsx(m,{onClick:F,Icon:le,title:n._({id:"rG3WVm"})}),c&&e.jsxs(e.Fragment,{children:[e.jsx(m,{Icon:Ve,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),d()},title:n._({id:"ZdWg0V"})}),e.jsx(m,{Icon:je,disabled:!t.realUrl,onClick:()=>{window.open($.getWebviewUrl(t.realUrl),"_blank","noopener,noreferrer"),d()},title:n._({id:"Xrk3+q"})})]}),h(_)&&e.jsx(m,{Icon:Ie,disabled:C(!r.length),onClick:()=>f("download",r),title:p("download",r.length)}),h(b)&&e.jsx(m,{Icon:be,disabled:C(!l.length),onClick:()=>f("delete",i.getDeletable(l,D)),title:p("delete",l.length)}),h(!M)&&e.jsx(m,{Icon:Re,disabled:C(!x.length),onClick:()=>f("bookmark",x),title:p("bookmark",x.length)}),h(M)&&e.jsx(m,{Icon:Te,disabled:C(!T.length),onClick:()=>f("unbookmark",T),title:p("unbookmark",T.length)}),h(!u)&&e.jsx(m,{Icon:me,disabled:C(!R.length),onClick:()=>f("mark_as_read",R),title:p("mark_as_read",R.length)}),h(u)&&e.jsx(m,{Icon:pe,disabled:C(!A.length),onClick:()=>f("mark_as_unread",A),title:p("mark_as_unread",A.length)}),c&&e.jsx(m,{onClick:()=>f("mark_prev_as_read",[]),Icon:fe,title:n._({id:"7phaC/"})})]})},Se=v(e.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"})),Pe=B.memo(t=>{const{i18n:o,_}=W(),s=Y(),d=z.usePreventMobileContextMenu(),g=B.useRef(null),{mode:n="manga.page",chapter:a,showChapterNumber:c,onSelect:b,selected:u,selectable:M=!0,isActiveChapter:k=!1}=t,I=u!==null,{isDownloaded:D}=a,p=r=>{I&&(r.preventDefault(),r.stopPropagation(),b(a.id,!u,r.shiftKey))},h=(r,l)=>{r.stopPropagation(),r.preventDefault(),l==null||l(r)},C=he((r,{context:l})=>{if(!I&&g.current){h(r,()=>l==null?void 0:l(g.current));return}r.shiftKey=!0,p(r)});return e.jsx(ee,{variant:"popover",popupId:"chapter-card-action-menu",children:r=>{var l;return e.jsxs(y,{sx:{pt:1,px:1},children:[e.jsx(we,{sx:{...j(n==="reader"&&k,{backgroundColor:"primary.main"})},children:e.jsx(ye,{component:te,to:i.getReaderUrl(a),onContextMenu:d,sx:z.preventMobileContextMenuSx(),style:{color:s.palette.text[a.isRead?"disabled":"primary"]},state:i.getReaderOpenChapterLocationState(a,!0),replace:n==="reader",onClick:x=>p(x),...C(r.open),children:e.jsxs(De,{children:[e.jsx(Ce,{title:c?"".concat(o._({id:"QIei5D"})," ").concat(a.chapterNumber):a.name,secondaryText:a.scanlator,ternaryText:"".concat(ke(Number((l=a.uploadDate)!=null?l:0),!0)).concat(D?" â€¢ ".concat(o._({id:"Vv4iDV"})):""),infoIcons:a.isBookmarked&&e.jsx(Se,{color:n==="reader"&&k?"secondary":"primary"}),slotProps:{title:{variant:"h6",component:"h3",sx:j(n==="reader"&&k,{color:s.palette.primary.contrastText})},secondaryText:{sx:j(n==="reader"&&k,{color:s.palette.primary.contrastText})},ternaryText:{sx:j(n==="reader"&&k,{color:s.palette.primary.contrastText})}}}),e.jsx(ge,{chapterId:a.id,color:n==="reader"&&k?s.palette.primary.contrastText:void 0}),e.jsx(y,{sx:{minHeight:"48px"},children:u===null?e.jsx(O,{title:o._({id:"0zpgxV"}),children:e.jsx(re,{ref:g,...Me.preventRippleProp(ae(r),{onClick:x=>h(x)}),"aria-label":"more",sx:{color:"inherit",...j(n==="reader"&&k,{color:"primary.contrastText"})},children:e.jsx(xe,{})})}):e.jsx(O,{title:u?o._({id:"HlKgQk"}):o._({id:"rG3WVm"}),children:e.jsx(ve,{checked:u})})})]})})}),!I&&r.isOpen&&e.jsx(ue,{...oe(r),children:x=>e.jsx(Be,{onClose:x,chapter:a,handleSelection:()=>b(a.id,!0),canBeDownloaded:i.isDownloadable(a),selectable:M})})]})}})}),Ge=({missingChaptersGap:t})=>e.jsxs(y,{sx:{width:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",p:2,pt:3.5,pb:2.5},children:[e.jsx(E,{sx:{flexGrow:1,border:"1px solid",borderColor:o=>o.palette.text.secondary}}),e.jsx(se,{sx:{px:2},variant:"body2",color:"textSecondary",children:ne._({id:"xFU/Nr",values:{missingChapterCount:t}})}),e.jsx(E,{sx:{flexGrow:1,border:"1px solid",borderColor:o=>o.palette.text.secondary}})]}),Ye=({index:t,isSortDesc:o,chapters:_,...s})=>{var b;const d=o?t+1:t-1,g=_[t],n=(b=_[d])!=null?b:{chapterNumber:0},a=i.getGap(g,n),c=a>0;return e.jsxs(y,{sx:j(!o,{flexDirection:"column-reverse"}),children:[e.jsx(Pe,{...s,chapter:_[t]}),c&&e.jsx(Ge,{missingChaptersGap:a})]})};export{Se as B,Ye as C,Ve as I,Be as a};
