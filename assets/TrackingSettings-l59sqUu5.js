import{u as C,j as r,av as M,r as _,v as S,dt as U,bG as k,m,g as c,e as E,cl as $,k as j,i as A,N as T,s as v,F as G}from"./index-B2DqTbID.js";import{E as P}from"./EmptyViewAbsoluteCentered-BVIzquZB.js";import{T as f}from"./Trackers-BQ19KlF0.js";import{A as R}from"./AvatarSpinner-Bnf5KqOt.js";import{C as b}from"./LoginDialog-DIkm5Rph.js";import{L as N}from"./ListItemAvatar-X4lKEubv.js";import{C as O}from"./Chip-FCnTFzq7.js";import{u as F}from"./useAppTitle-DOOoVvoM.js";import{S as I}from"./Switch-C8bRhv9M.js";import{L as H}from"./ListSubheader-BWD1jJMR.js";import"./SpinnerImage-Bd4Q_lL4.js";import"./Refresh-C3-DWmSs.js";import"./Image-juLltWaB.js";import"./SwitchBase-CCmC1nuH.js";const V=({tracker:e})=>{const{i18n:s,_:w}=C(),l=!e.isLoggedIn&&!!e.authUrl,L=async()=>{try{await _.logoutFromTracker(e.id).response}catch(i){m(s._({id:"cM90Xp",values:{0:e.name}}),"error",c(i))}},d=async(i,n)=>{if(l){const t={redirectUrl:"".concat(window.location.origin,"/tracker/login/oauth"),clientName:"Suwayomi-WebUI",trackerId:e.id,trackerName:e.name};window.open("".concat(e.authUrl,"&state=").concat(JSON.stringify(t)),"_self");return}try{await _.loginTrackerCredentials(e.id,i,n).response}catch(t){m(s._({id:"o2GrG0",values:{0:e.name}}),"error",c(t))}},u=async(i,n)=>{if(l){const o={redirectUrl:"".concat(window.location.origin,"/tracker/login/oauth"),clientName:"Suwayomi-WebUI",trackerId:e.id,trackerName:e.name};window.open("".concat(e.authUrl,"&state=").concat(JSON.stringify(o)),"_self");return}const t=b.showControlled({title:f.isLoggedIn(e)?s._({id:"X27vYx",values:{0:e.name}}):s._({id:"HW0+hI",values:{0:e.name}}),isLoading:!1,isLoggedIn:f.isLoggedIn(e),username:i,password:n,loginLogout:async(o,p)=>{if(t.update({isLoading:!0,loginLogout:k}),f.isLoggedIn(e)){try{await L(),t.submit()}catch(g){m(s._({id:"cM90Xp",values:{0:e.name}}),"error",c(g))}return}try{await d(o,p),t.submit()}catch(g){m(s._({id:"o2GrG0",values:{0:e.name}}),"error",c(g));const h="__retry__";await Promise.race([t.promise,Promise.resolve(h)])===h&&u(o,p)}}},{id:"tracker-login-dialog"});await t.promise};return r.jsxs(M,{onClick:()=>u(),children:[r.jsx(N,{sx:{paddingRight:"20px"},children:r.jsx(R,{alt:"".concat(e.name),iconUrl:_.getValidImgUrlFor(e.icon),slots:{avatarProps:{variant:"rounded",sx:{width:64,height:64}},spinnerImageProps:{ignoreQueue:!0}}})}),r.jsx(S,{primary:e.name}),f.isLoggedIn(e)&&r.jsx(U,{children:r.jsx(O,{label:s._({id:"UTVOJ/"}),color:"success"})})]})},se=()=>{var y;const{i18n:e,_:s}=C();F(e._({id:"U0HZma"}));const{settings:{updateProgressAfterReading:w,updateProgressManualMarkRead:l},loading:L,request:{error:d,refetch:u}}=E(),i=G(a=>m(e._({id:"cBoXe4"}),"error",c(a))),{data:n,loading:t,error:o,refetch:p}=_.useGetTrackerList($,{notifyOnNetworkStatusChange:!0}),g=(y=n==null?void 0:n.trackers.nodes)!=null?y:[],h=L||t,x=d!=null?d:o;return x?r.jsx(P,{message:e._({id:"6m5aox"}),messageExtra:c(x),retry:()=>{d&&u().catch(j("TrackingSettings::refetchMetadataServerSettings")),o&&p().catch(j("TrackingSettings::refetchTrackersList"))}}):h?r.jsx(A,{}):r.jsxs(r.Fragment,{children:[r.jsxs(T,{sx:{pt:0},children:[r.jsxs(v,{children:[r.jsx(S,{primary:e._({id:"iuHV1g"})}),r.jsx(I,{edge:"end",checked:w,onChange:a=>i("updateProgressAfterReading",a.target.checked)})]}),r.jsxs(v,{children:[r.jsx(S,{primary:e._({id:"9UwLZL"}),secondary:e._({id:"xGavjG"})}),r.jsx(I,{edge:"end",checked:l,onChange:a=>i("updateProgressManualMarkRead",a.target.checked)})]})]}),r.jsx(T,{subheader:r.jsx(H,{component:"div",id:"tracking-trackers",children:e._({id:"KwWe8w"})}),children:g.map(a=>r.jsx(V,{tracker:a},a.id))})]})};export{se as TrackingSettings};
