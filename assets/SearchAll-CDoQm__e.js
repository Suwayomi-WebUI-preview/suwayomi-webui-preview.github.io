import{u as P,o as k,a as B,s as $,b as G,r as T,d as c,j as r,f as H,g as q,h as N,n as C,ak as D,A as I,L as O,T as A,au as Q}from"./index-CBxbdOZa.js";import{u as V,S as W,A as z}from"./AppbarSearch-DDqDFRU_.js";import{t as J,L as K}from"./LanguageSelect-D96QFEAj.js";import{u as v}from"./useDebounce-Cy8G1E5s.js";import{B as U}from"./BaseMangaGrid-B507VjY3.js";import{E as X}from"./EmptyViewAbsoluteCentered-DCgg8ff9.js";import{S as _}from"./Sources-3VCFbudu.js";import{u as Y}from"./useAppTitleAndAction-D4rw2KWz.js";import{C as Z}from"./Card-BbGJVXOW.js";import{C as ee}from"./CardActionArea-Dl3PGSnS.js";import"./ChaptersDownloadActionMenuItems-BVTXZK2z.js";import"./Trackers-D4pSmk7a.js";import"./ListCardContent-DPbnp6xG.js";import"./Avatar-CczBYppx.js";import"./TextField-DuGJKvvj.js";import"./useFormControl-EdH_WGd-.js";import"./formControlState-Dq1zat_P.js";import"./InputAdornment-PGzZQUDk.js";import"./CheckCircle-BNV6sksU.js";import"./MUI.util-Bs9Vl2GD.js";import"./Link-CO7UWlYn.js";import"./useManageMangaLibraryState-DEU-P4Qb.js";import"./ThreeStateCheckboxInput-wiEnqza-.js";import"./Checkbox-D5Y8DhmM.js";import"./SwitchBase-Bt1MmkrC.js";import"./CheckboxInput-0NO2rdo0.js";import"./FormGroup-BzOyOVHv.js";import"./ListPreference-CfCfOuBQ.js";import"./NumberSetting-CFmaU-S2.js";import"./Slider-yvhelXje.js";import"./useMobilePicker-Dq_KXUip.js";import"./Chip-BeTPtnoR.js";import"./SelectSetting-BMUn1mO-.js";import"./Select-DcTUCpv6.js";import"./FilterList-DX5t4YRj.js";import"./Switch-Bv3Q3BvN.js";import"./MangaGrid-BdnTyJHa.js";import"./Delete-CPYpmXa7.js";import"./Download-Dvr2tlzK.js";import"./Sync-QsScqzp8.js";import"./use-merged-ref-BIpNM0cx.js";import"./ListCardAvatar-Olf2Zaaj.js";import"./PlayArrow-Bu-WWWUu.js";import"./StyledFab-tc657Z86.js";import"./useAppTitle-BmkqDPsV.js";import"./useAppAction-mbKoUHfz.js";const re=(i,d)=>i.displayName.localeCompare(d.displayName),se=(i,d,e)=>{const s=e.get(i.id),o=e.get(d.id),g=!(s!=null&&s.isLoading),a=!!(s!=null&&s.error),u=!(s!=null&&s.hasResults)&&!a,f=!(o!=null&&o.isLoading),t=!!(o!=null&&o.error),h=!(o!=null&&o.hasResults)&&!t;return g&&!f?-1:!g&&f||u&&!h?1:h&&!u||!a&&t?-1:a&&!t?1:0},oe=1e3,te=D.memo(({source:i,onSearchRequestFinished:d,searchString:e,emptyQuery:s,mode:o})=>{var E,n;const{t:g}=P(),{id:a,displayName:u,lang:f}=i,t=c.useRef(e),h=c.useRef(()=>{});t.current!==e&&(t.current=e,h.current(new Error("SourceSearchPreview(".concat(a,", ").concat(u,"): search string changed"))));const[j,S]=T.useSourceSearch(a,e!=null?e:"",void 0,1,{skipRequest:!e,addAbortSignal:!0}),{data:x,isLoading:m,error:p,abortRequest:b}=S[0];h.current=b;const y=(n=(E=x==null?void 0:x.fetchSourceManga)==null?void 0:E.mangas)!=null?n:[],L=!p&&!m&&!y.length;c.useEffect(()=>{d(i,{isLoading:m,hasResults:!L,emptySearch:!e,error:p})},[m,L,e,p]);let l;return p?l=g("search.error.label.source_search_failed"):L&&(l=g("manga.error.label.no_mangas_found")),!m&&!e||s?null:r.jsxs(r.Fragment,{children:[r.jsx(Z,{sx:{mb:1},children:r.jsxs(ee,{component:O,to:"".concat(I.sources.childRoutes.browse.path(a),"?query=").concat(e),sx:{p:3},children:[r.jsx(A,{variant:"h5",children:u}),r.jsx(A,{variant:"caption",children:J(f)})]})}),l?r.jsx(Q,{sx:{alignItems:"start",height:void 0},noFaces:!0,message:l,messageExtra:q(p),retry:p?()=>j(1).catch(N("SourceSearchPreview(".concat(i.id,")::refetch"))):void 0}):r.jsx(U,{gridWrapperProps:{sx:{px:0}},mangas:y,isLoading:m,hasNextPage:!1,loadMore:()=>{},horizontal:!0,noFaces:!0,message:l,inLibraryIndicator:!0,mode:o})]})}),Xe=()=>{const{t:i}=P(),{pathname:d,state:e}=k(),s=d.startsWith("/migrate/source"),[o]=V("query",W),g=v(o,oe),[a,u]=B("shownSourceLangs",$()),{settings:{showNsfw:f}}=G(),{data:t,loading:h,error:M,refetch:j}=T.useGetSourceList({notifyOnNetworkStatusChange:!0}),S=c.useMemo(()=>{var n;return(n=t==null?void 0:t.sources.nodes)!=null?n:[]},[t==null?void 0:t.sources.nodes]),x=c.useMemo(()=>_.filter(S,{showNsfw:f,languages:a,keepLocalSource:!0}),[S,a]),m=c.useMemo(()=>[...x].toSorted(re),[x]),[p,b]=c.useState(new Map),y=v(p,500),L=c.useMemo(()=>_.getLanguages(S),[S]),l=c.useMemo(()=>[...m].sort((n,R)=>se(n,R,y)),[m,y]),E=c.useCallback(({id:n},R)=>{b(F=>{const w=new Map(F);return w.set(n,R),w})},[b]);return Y(i(s?"migrate.search.title":"search.title.global_search",{title:e==null?void 0:e.mangaTitle}),r.jsxs(r.Fragment,{children:[r.jsx(z,{isClosable:!1}),r.jsx(K,{selectedLanguages:a,setSelectedLanguages:u,languages:L})]}),[a,u,L]),h?r.jsx(H,{}):M?r.jsx(X,{message:i("global.error.label.failed_to_load_data"),messageExtra:q(M),retry:()=>j().catch(N())}):r.jsx(C,{sx:{p:1},children:l.map((n,R)=>r.jsx(C,{sx:{pb:R+1!==l.length?2:0},children:r.jsx(te,{source:n,onSearchRequestFinished:E,searchString:g,emptyQuery:!o,mode:s?"migrate.select":"source"})},n.id))})};export{Xe as SearchAll};
