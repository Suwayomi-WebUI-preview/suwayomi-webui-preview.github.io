import{c as r,l as Ee,j as t,B,a as V,al as q,r as ce,i as le,z as ot,am as Et,an as Pt,ao as Lt,ap as St,aq as Ke,t as de,u as it,x as Dt,e as ct,ar as lt,as as Tt,at as jt,f as ne,I as ae,T as kt,au as _t,a0 as Nt,av as Ot,_ as Ue,aw as At,a1 as It,ax as $t,ay as Ge,s as Ye,N as Wt,m as Ze,h as K,M as Mt,a3 as zt,E as Qe,az as Bt,aA as Ht}from"./index-lMCVQ9L9.js";import{b as U,C as _}from"./Chapters-CVHYugbV.js";import{P as ge,i as Ft,R as qt,u as Vt,g as Je,c as Xt}from"./ReaderSettingsOptions-DJRVbQKr.js";import{S as et}from"./SpinnerImage-OBJTi3Fi.js";import{S as tt}from"./Select-BMAzkNZu.js";import{C as Kt}from"./CustomIconButton-D0Jmzn_0.js";import{C as Ut}from"./Collapse-DEDLByZu.js";import{a as rt}from"./TextField-CxRf_Sst.js";import{u as Gt}from"./useDebounce-DaZoKzm2.js";import"./NumberSetting-JPZ_AFwO.js";import"./Info-Dk8WxbOa.js";import"./InputAdornment-Dm1Za2iv.js";import"./Switch-CBJGHJ52.js";import"./SwitchBase-D3WmpHnl.js";const Yt=a=>{for(let n=0;n<a.children.length;n++){const s=a.children.item(n);if(s){const{left:p,right:c}=s.getBoundingClientRect();if(p<=window.innerWidth/2&&c>window.innerWidth/2)return n}}return-1},Zt=5,Qt=()=>window.innerWidth+window.scrollX>=document.body.scrollWidth-Zt,Jt=()=>window.scrollX<=0;function er(a){const{pages:n,curPage:s,initialPage:p,settings:c,setCurPage:i,prevChapter:v,nextChapter:h}=a,g=r.useRef(p),d=r.useRef(null),x=r.useRef([]);function E(){var e;s<n.length-1?((e=x.current[s+1])==null||e.scrollIntoView({inline:"center"}),i(f=>f+1)):c.loadNextOnEnding&&h()}function u(){var e;s>0?((e=x.current[s-1])==null||e.scrollIntoView({inline:"center"}),i(s-1)):s===0&&v()}function b(){c.readerType==="ContinuesHorizontalLTR"?u():E()}function L(){c.readerType==="ContinuesHorizontalLTR"?E():u()}const y=r.useRef(0);function l(e){window.scrollBy(y.current-e.pageX,0)}function o(e){var f;y.current=e.pageX,(f=d.current)==null||f.addEventListener("mousemove",l)}function m(){var e;(e=d.current)==null||e.removeEventListener("mousemove",l)}function S(e){e.clientX>=window.innerWidth*.85?L():e.clientX<=window.innerWidth*.15&&b()}function k(e){window.scrollBy({left:c.readerType==="ContinuesHorizontalLTR"?e.deltaY:e.deltaY*-1})}const z=()=>{c.readerType==="ContinuesHorizontalLTR"?window.scrollX+window.innerWidth>=document.body.scrollWidth&&h():c.readerType==="ContinuesHorizontalRTL"&&window.scrollX<=window.innerWidth&&h()};return Ee(x.current[p],r.useCallback((e,f)=>{const D=x.current[p];D!=null&&D.offsetHeight&&(D.scrollIntoView({inline:"center"}),f.disconnect())},[x.current[p],p])),r.useEffect(()=>{var e,f;return(e=d.current)==null||e.addEventListener("mousedown",o),(f=d.current)==null||f.addEventListener("mouseup",m),()=>{var D,N;(D=d.current)==null||D.removeEventListener("mousedown",o),(N=d.current)==null||N.removeEventListener("mouseup",m)}},[d]),r.useEffect(()=>(c.loadNextOnEnding&&document.addEventListener("scroll",z),()=>{document.removeEventListener("scroll",z)}),[d,s,v,h]),r.useEffect(()=>{const e=()=>{if(!d.current)return;const f=Yt(d.current);f!==g.current&&(g.current=f,i(f)),(c.readerType==="ContinuesHorizontalLTR"?Qt():Jt())&&(g.current=n.length-1,i(g.current))};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[c.readerType]),t.jsx(B,{ref:d,sx:{display:"flex",flexDirection:c.readerType==="ContinuesHorizontalLTR"?"row":"row-reverse",justifyContent:c.readerType==="ContinuesHorizontalLTR"?"flex-start":"flex-end",width:"auto",height:"auto",overflowX:"visible",userSelect:"none"},onClick:S,onWheel:k,children:n.map(e=>t.jsx(ge,{index:e.index,src:e.src,onImageLoad:()=>{},settings:c,ref:f=>{x.current[e.index]=f}},e.index))})}function tr(a){const{settings:n,curPage:s,pageCount:p}=a;return t.jsx(B,{sx:{display:n.showPageNumber?"block":"none",position:"fixed",bottom:"50px",padding:"2px",paddingLeft:"4px",paddingRight:"4px",textAlign:"center",backgroundColor:"rgba(0, 0, 0, 0.3)",borderRadius:"10px"},children:"".concat(s+1," / ").concat(p)})}function rr(a){const{pages:n,settings:s,setCurPage:p,initialPage:c,curPage:i,nextChapter:v,prevChapter:h,chapter:g}=a,d=r.useRef(null);r.useEffect(()=>{const o=n.map(m=>{const S=V.requestImage(m.src);return S.response.catch(()=>{}),S});return()=>{o.forEach(m=>m.abortRequest(new Error("PagedPager::preload: chapter changed")))}},[g.id]);const x=o=>{p(o),window.scroll({top:0})};function E(){i<n.length-1?x(i+1):s.loadNextOnEnding&&v()}function u(){i>0?x(i-1):h()}function b(){s.readerType==="SingleLTR"?u():s.readerType==="SingleRTL"&&E()}function L(){s.readerType==="SingleLTR"?E():s.readerType==="SingleRTL"&&u()}function y(o){switch(o.key){case"Space":o.preventDefault(),E();break;case"ArrowRight":L();break;case"ArrowLeft":b();break}}function l(o){o.clientX>window.innerWidth/2?L():b()}return r.useEffect(()=>(document.addEventListener("keydown",y),()=>{document.removeEventListener("keydown",y)}),[d,i,s.readerType,h,v]),r.useEffect(()=>{setTimeout(()=>{x(c)},0)},[c]),t.jsx(B,{ref:d,sx:{display:"flex",flexDirection:"column",justifyContent:"center",width:"auto",height:"auto"},onClick:l,children:t.jsx(ge,{index:i,onImageLoad:()=>{},src:n[i].src,settings:s},i)})}const nr=r.forwardRef((a,n)=>{const{image1src:s,image2src:p,index:c,onImageLoad:i,settings:v}=a,h=Ft(v),g={...h,width:v.fitPageToWindow?h.width:"calc(".concat(h.width," * 0.5)"),minWidth:v.fitPageToWindow&&v.scalePage?"calc(".concat(h.minWidth," * 0.5)"):h.minWidth,maxWidth:v.fitPageToWindow?"calc(".concat(h.maxWidth," * 0.5)"):h.maxWidth},d={...g,height:"100vh",width:"50%",backgroundColor:"#525252"};return t.jsxs(B,{ref:n,sx:{display:"flex",flexDirection:v.readerType==="DoubleLTR"?"row":"row-reverse",justifyContent:"center",width:"100%"},children:[t.jsx(et,{src:s,onImageLoad:i,alt:"Page #".concat(c),spinnerStyle:d,imgStyle:{...g,objectPosition:v.readerType==="DoubleLTR"?q("right","left"):q("left","right")}}),t.jsx(et,{src:p,onImageLoad:i,alt:"Page #".concat(c+1),spinnerStyle:{...d,width:"calc(50% - 5px)",marginLeft:"5px"},imgStyle:{...g,objectPosition:v.readerType==="DoubleLTR"?q("left","right"):q("right","left")}})]})}),ar=a=>a.height/a.width<1,be=(a,n,s)=>{if(n[a]||n[a+1]||a===n.length-1)return!0;const p=n.lastIndexOf(!0,a-1),c=a-(p+1);return s?c%2===0:c%2===1};function sr(a){const{pages:n,settings:s,setCurPage:p,initialPage:c,curPage:i,chapter:v,nextChapter:h,prevChapter:g}=a,d=r.useRef(null),[x,E]=r.useState(Array(n.length).fill(!1)),[u,b]=r.useState(Array(n.length).fill(!1));function L(){let e=1;if(i<n.length&&u[i]&&(e=1,x[i]))return e;if(i+1<n.length&&u[i+1]){if(be(i,x,s.offsetFirstPage))return e;e=2}return e}function y(){return be(i-2,x,s.offsetFirstPage)?1:2}function l(){if(i<n.length-1){const e=i+L();p(e>=n.length?n.length-1:e)}else s.loadNextOnEnding&&h()}function o(){if(i>0){const e=i-y();p(e<0?0:e)}else g()}function m(){s.readerType==="DoubleLTR"?o():l()}function S(){s.readerType==="DoubleLTR"?l():o()}function k(e){switch(e.key){case"Space":e.preventDefault(),l();break;case"ArrowRight":S();break;case"ArrowLeft":m();break}}function z(e){e.clientX>window.innerWidth/2?S():m()}return r.useEffect(()=>(document.addEventListener("keydown",k),()=>{document.removeEventListener("keydown",k)}),[d,i,s.readerType,g,h,u,x]),r.useEffect(()=>{p(c)},[c]),r.useEffect(()=>{s.offsetFirstPage?L()===2&&p(i+1):i>0&&!be(i-1,x,s.offsetFirstPage)&&p(i-1)},[s.offsetFirstPage]),r.useEffect(()=>{const e=n.map(f=>[f.index,V.requestImage(f.src)]);return e.forEach(async([f,D])=>{try{const N=await D.response,A=new Image;A.onload=()=>{URL.revokeObjectURL(N),b(I=>I.toSpliced(f,1,!0)),E(I=>I.toSpliced(f,1,ar(A)))},A.src=N}catch(N){}}),()=>{e.forEach(([f,D])=>D.abortRequest(new Error("DoublePagedPager::preload(".concat(f,"): chapter changed"))))}},[v.id]),t.jsx(B,{ref:d,onClick:z,children:t.jsx(B,{id:"display",sx:{display:"flex",flexDirection:s.readerType==="DoubleLTR"?"row":"row-reverse",justifyContent:"center",width:"auto",height:"auto"},children:L()===2?t.jsx(nr,{index:i,image1src:n[i].src,image2src:n[i+1].src,settings:s},i):t.jsx(ge,{index:i,src:n[i].src,onImageLoad:()=>{},settings:s},i)})})}const or=a=>{for(let n=0;n<a.children.length;n++){const s=a.children.item(n);if(s){const{top:p,bottom:c}=s.getBoundingClientRect();if(p<=window.innerHeight&&c>1)return n}}return-1},ir=5,cr=.95,nt=.25,lr="smooth",at=()=>window.innerHeight+window.scrollY>=document.body.offsetHeight-ir,dr=()=>window.scrollY<=0;function st(a){const{pages:n,settings:s,setCurPage:p,initialPage:c,nextChapter:i,prevChapter:v}=a,h=r.useRef(c),g=r.useRef(null),d=r.useRef([]);r.useEffect(()=>{let l=!1;const o=()=>{if(g.current)if(at()){if(l)return;l=!0,h.current=n.length-1,p(h.current),s.loadNextOnEnding&&i()}else{l=!1;const m=or(g.current);m!==h.current&&(h.current=m,p(m))}};return window.addEventListener("scroll",o),()=>{window.removeEventListener("scroll",o)}},[s.loadNextOnEnding,i]);const x=r.useRef(0),E=r.useRef(!1);function u(l){E.current=!0,window.scrollBy(0,x.current-l.pageY)}function b(l){var o;x.current=l.pageY,(o=g.current)==null||o.addEventListener("mousemove",u)}function L(){var l;(l=g.current)==null||l.removeEventListener("mousemove",u)}r.useEffect(()=>{var l,o;return(l=g.current)==null||l.addEventListener("mousedown",b),(o=g.current)==null||o.addEventListener("mouseup",L),()=>{var m,S;(m=g.current)==null||m.removeEventListener("mousedown",b),(S=g.current)==null||S.removeEventListener("mouseup",L)}},[g]);const y=r.useCallback((l,o=cr)=>{if(l==="down"&&at()){i();return}if(l==="up"&&dr()){v();return}window.scroll({top:window.scrollY+window.innerHeight*o*(l==="up"?-1:1),behavior:lr})},[i,v]);return r.useEffect(()=>{const l=o=>{switch(o.key){case"Space":o.preventDefault(),y(o.shiftKey?"up":"down");break;case"ArrowDown":o.preventDefault(),y(o.shiftKey?"up":"down",nt);break;case"ArrowRight":o.preventDefault(),y(o.shiftKey?"up":"down");break;case"ArrowUp":o.preventDefault(),y(o.shiftKey?"down":"up",nt);break;case"ArrowLeft":o.preventDefault(),y(o.shiftKey?"down":"up");break}};return document.addEventListener("keydown",l,!1),()=>{document.removeEventListener("keydown",l)}},[y]),Ee(d.current[c],r.useCallback((l,o)=>{const m=d.current[c];m!=null&&m.offsetHeight&&(m.scrollIntoView(),o.disconnect())},[d.current[c],c])),t.jsx(B,{ref:g,sx:{display:"flex",flexDirection:"column",justifyContent:"center",width:"auto",height:"auto",userSelect:"none"},onClick:l=>{if(E.current){E.current=!1;return}y(l.clientX>window.innerWidth/2?"down":"up")},children:n.map(l=>t.jsx(ge,{index:l.index,src:l.src,onImageLoad:()=>{},settings:s,ref:o=>{d.current[l.index]=o}},l.index))})}var Pe={},ur=le;Object.defineProperty(Pe,"__esModule",{value:!0});var dt=Pe.default=void 0,fr=ur(ce()),pr=t;dt=Pe.default=(0,fr.default)((0,pr.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var Le={},gr=le;Object.defineProperty(Le,"__esModule",{value:!0});var oe=Le.default=void 0,hr=gr(ce()),xr=t;oe=Le.default=(0,hr.default)((0,xr.jsx)("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"}),"KeyboardArrowLeft");var Se={},mr=le;Object.defineProperty(Se,"__esModule",{value:!0});var ie=Se.default=void 0,Cr=mr(ce()),vr=t;ie=Se.default=(0,Cr.default)((0,vr.jsx)("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"}),"KeyboardArrowRight");var De={},wr=le;Object.defineProperty(De,"__esModule",{value:!0});var ut=De.default=void 0,Rr=wr(ce()),yr=t;ut=De.default=(0,Rr.default)((0,yr.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown");var Te={},br=le;Object.defineProperty(Te,"__esModule",{value:!0});var ft=Te.default=void 0,Er=br(ce()),Pr=t;ft=Te.default=(0,Er.default)((0,Pr.jsx)("path",{d:"M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp");const Lr={entering:{transform:"none"},entered:{transform:"none"}},Sr=r.forwardRef(function(n,s){const p=ot(),c={enter:p.transitions.duration.enteringScreen,exit:p.transitions.duration.leavingScreen},{addEndListener:i,appear:v=!0,children:h,easing:g,in:d,onEnter:x,onEntered:E,onEntering:u,onExit:b,onExited:L,onExiting:y,style:l,timeout:o=c,TransitionComponent:m=Lt,...S}=n,k=r.useRef(null),z=Et(k,Pt(h),s),e=C=>T=>{if(C){const $=k.current;T===void 0?C($):C($,T)}},f=e(u),D=e((C,T)=>{St(C);const $=Ke({style:l,timeout:o,easing:g},{mode:"enter"});C.style.webkitTransition=p.transitions.create("transform",$),C.style.transition=p.transitions.create("transform",$),x&&x(C,T)}),N=e(E),A=e(y),I=e(C=>{const T=Ke({style:l,timeout:o,easing:g},{mode:"exit"});C.style.webkitTransition=p.transitions.create("transform",T),C.style.transition=p.transitions.create("transform",T),b&&b(C)}),H=e(L),te=C=>{i&&i(k.current,C)};return t.jsx(m,{appear:v,in:d,nodeRef:k,onEnter:D,onEntered:N,onEntering:f,onExit:I,onExited:H,onExiting:A,addEndListener:te,timeout:o,...S,children:(C,T)=>r.cloneElement(h,{style:{transform:"scale(0)",visibility:C==="exited"&&!d?"hidden":void 0,...Lr[C],...l,...h.props.style},ref:z,...T})})}),Dr=de("div")({zIndex:10}),Tr=de("div")(({theme:a})=>({position:"fixed",top:0,left:0,minWidth:"240px",maxWidth:"400px",height:"100vh",overflowY:"auto",backgroundColor:a.palette.background.default,"& header":{backgroundColor:a.palette.action.hover,display:"flex",alignItems:"center",padding:"".concat(a.spacing(1)," ").concat(a.spacing(3)),transition:"left 2s ease"}})),jr=de("div")(({theme:a})=>({margin:"0 ".concat(a.spacing(2))})),kr=de("div")({display:"flex",flexWrap:"wrap",alignContent:"center",alignItems:"center",justifyContent:"center"}),_r=de("div")(({theme:a})=>({display:"grid",gridTemplateRows:"auto auto auto",gridTemplateColumns:"0fr 1fr 0fr",gridTemplateAreas:'"pre current next"',gridColumnGap:a.spacing(.5),margin:"".concat(a.spacing(1)," 0"),"& a":{textDecoration:"none",color:"inherit",display:"flex",flexWrap:"wrap",alignContent:"center"}}));function Nr(a){var G;const{t:n}=it(),{setReaderNavBarWidth:s}=Dt(),p=ot(),c=ct(),i=lt(),{prevDrawerOpen:v,prevSettingsCollapseOpen:h}=(G=i.state)!=null?G:{},g=r.useRef(null);Ee(g,r.useCallback(()=>{var R;((R=g.current)==null?void 0:R.offsetWidth)!==void 0&&s(g.current.offsetWidth)},[g.current])),r.useLayoutEffect(()=>()=>s(0),[g]);const{settings:d,setSettingValue:x,manga:E,chapter:u,chapters:b,curPage:L,scrollToPage:y,openNextChapter:l,retrievingNextChapter:o}=a,m=Tt(),S=r.useMemo(()=>new Set(b.map(({scanlator:R})=>R)).size>1,[b]),[k,z]=r.useState(d.staticNav||v),[e,f]=r.useState(!0),[D,N]=r.useState(d.staticNav||v),[A,I]=r.useState(0),[H,te]=r.useState(h!=null?h:!0),C=o,T=(R,O,Y)=>{f(R!=="staticNav"),x(R,O,Y)},$=R=>{z(R),N(R)},F=()=>{const R=window.pageYOffset;Math.abs(R-A)>20&&(N(R>A),I(R))};return r.useEffect(()=>{e&&$(d.staticNav)},[d.staticNav]),r.useEffect(()=>{window.addEventListener("scroll",F);const R=document.querySelector("#root"),O=document.querySelector("#appMainContainer");return R.style.display="flex",R.style.flexDirection="column",O.style.display="none",()=>{R.style.display="block",O.style.display="block",window.removeEventListener("scroll",F)}},[F]),t.jsxs(Dr,{children:[t.jsx(jt,{direction:q("right","left"),in:k,timeout:200,appear:!1,mountOnEnter:!0,unmountOnExit:!0,children:t.jsxs(Tr,{ref:g,children:[t.jsxs("header",{children:[!d.staticNav&&t.jsx(ne,{title:n("reader.button.close_menu"),children:t.jsx(ae,{edge:"start",color:"inherit","aria-label":"menu",onClick:()=>$(!1),size:"large",children:q(t.jsx(oe,{}),t.jsx(ie,{}))})}),t.jsx(kt,{variant:"h6",component:"h1",sx:{textOverflow:"ellipsis",overflow:"hidden",py:1,flexGrow:1},children:u.name}),t.jsx(ne,{title:n("reader.button.exit"),children:t.jsx(ae,{edge:"start",color:"inherit","aria-label":"menu",onClick:m,size:"large",sx:{mr:-1},children:t.jsx(dt,{})})})]}),t.jsxs(_t,{ContainerComponent:"div",sx:{"& span":{fontWeight:"bold"}},children:[t.jsx(Nt,{primary:n("reader.settings.title.reader_settings")}),t.jsxs(ae,{edge:"start",color:"inherit","aria-label":"menu",disableRipple:!0,disableFocusRipple:!0,onClick:()=>te(!H),size:"large",children:[H&&t.jsx(ft,{}),!H&&t.jsx(ut,{})]})]}),t.jsx(Ut,{in:H,timeout:"auto",unmountOnExit:!0,children:t.jsx(qt,{setSettingValue:T,staticNav:d.staticNav,showPageNumber:d.showPageNumber,loadNextOnEnding:d.loadNextOnEnding,skipDupChapters:d.skipDupChapters,fitPageToWindow:d.fitPageToWindow,scalePage:d.scalePage,readerType:d.readerType,offsetFirstPage:d.offsetFirstPage,readerWidth:d.readerWidth})}),t.jsx(Ot,{sx:{my:1,mx:2}}),t.jsxs(jr,{children:[t.jsxs(kr,{children:[t.jsx("span",{children:n("reader.page_info.label.currently_on_page")}),t.jsx(rt,{size:"small",sx:{mx:.5},disabled:C||u.pageCount===-1,children:t.jsx(tt,{value:u.pageCount>-1?"".concat(L):"",displayEmpty:!0,onChange:({target:{value:R}})=>{y(Number(R))},children:Array(Math.max(0,u.pageCount)).fill(1).map((R,O)=>t.jsx(Ue,{value:O,children:O+1},"Page#".concat(O)))})}),t.jsx("span",{children:n("reader.page_info.label.of_max_pages",{maxPages:u.pageCount})})]}),t.jsxs(_r,{children:[t.jsx(ne,{title:n("reader.button.previous_chapter"),children:t.jsx(ae,{sx:{gridArea:"pre"},disabled:C||u.sourceOrder<=1,onClick:()=>l(U.PREV),children:q(t.jsx(oe,{}),t.jsx(ie,{}))})}),t.jsx(rt,{sx:{gridArea:"current"},size:"small",disabled:C||u.sourceOrder<1,children:t.jsx(tt,{value:u.sourceOrder>=1?"".concat(u.sourceOrder):"",displayEmpty:!0,onChange:({target:{value:R}})=>{c("/manga/".concat(E.id,"/chapter/").concat(R),{replace:!0,state:{prevDrawerOpen:k,prevSettingsCollapseOpen:H}})},children:b.map(({id:R,sourceOrder:O,name:Y,chapterNumber:he,scanlator:re})=>t.jsx(Ue,{value:O,children:"#".concat(he).concat(S&&re!=null?" (".concat(re,")"):""," | ").concat(Y)},R))})}),t.jsx(ne,{title:n("reader.button.next_chapter"),children:t.jsx(ae,{sx:{gridArea:"next"},disabled:C||u.sourceOrder<1||u.sourceOrder>=E.chapters.totalCount,onClick:()=>l(U.NEXT),children:q(t.jsx(ie,{}),t.jsx(oe,{}))})})]})]})]})}),t.jsx(Sr,{in:!k,children:t.jsx(At,{in:!D,children:t.jsx(ne,{title:n("reader.button.open_menu"),children:t.jsx(Kt,{sx:{position:"fixed",top:20,left:20,backgroundColor:"rgba(255, 255, 255, 0.75);",color:"black",...p.applyStyles("dark",{backgroundColor:"rgba(0, 0, 0, 0.75);",color:"white"})},size:"large",variant:"contained",onClick:()=>$(!0),children:q(t.jsx(ie,{}),t.jsx(oe,{}))})})})})]})}const se=a=>_.getFromCache(a,Bt,"CHAPTER_READER_FIELDS"),Or=a=>{switch(a){case"ContinuesVertical":case"Webtoon":return st;case"SingleVertical":case"SingleRTL":case"SingleLTR":return rr;case"DoubleVertical":case"DoubleRTL":case"DoubleLTR":return sr;case"ContinuesHorizontalLTR":case"ContinuesHorizontalRTL":return er;default:return st}},Ar=a=>Array.from({length:a},(n,s)=>s),ee={pageCount:-1,sourceOrder:-1,chapterCount:0,lastPageRead:0,name:"Loading...",manga:{id:-1}};function Zr(){var We,Me,ze,Be,He,Fe,qe,Ve;const{t:a}=it(),n=ct(),s=lt(),{chapterIndex:p,mangaId:c}=It(),i=r.useMemo(()=>({id:+c,title:"",thumbnailUrl:"",genre:[],inLibraryAt:0,lastReadAt:0,chapters:{totalCount:0},trackRecords:{totalCount:0}}),[c]),{data:v,loading:h,error:g,refetch:d}=V.useGetManga($t,c),x=r.useRef(null),E=Number(c)===((We=x.current)==null?void 0:We.mangaId)&&Number(p)===((Me=x.current)==null?void 0:Me.sourceOrder)&&((ze=x.current)==null?void 0:ze.pageCount)!==-1,u=(Be=v==null?void 0:v.manga)!=null?Be:i,{data:b,loading:L,error:y,refetch:l}=V.useGetChapters(Ge,{condition:{mangaId:Number(c),sourceOrder:Number(p)}},{notifyOnNetworkStatusChange:!0}),o=b==null?void 0:b.chapters.nodes[0],m=r.useRef(!1),{settings:{downloadAheadLimit:S}}=Ye(),k=!!S,z=()=>{var M;return x.current&&E?o&&((M=x.current)==null?void 0:M.pageCount)!==o.pageCount?o:x.current:(m.current=!1,o||null)};x.current=z();const e=(He=x.current)!=null?He:ee,f=r.useRef(ee);f.current===ee&&(f.current=e),e.mangaId!==((Fe=f.current)==null?void 0:Fe.mangaId)&&(f.current=ee);const[D,{loading:N,error:A}]=V.useGetChapterPagesFetch(e.id),I=()=>{L||D().then(()=>{m.current=!0}).catch(K())};r.useEffect(()=>{I()},[e.id]);const[H,te]=r.useState(!1),[C,T]=r.useState(0),$=C===e.pageCount-1,F=Gt(C,$?0:1e3),[G,R]=r.useState(void 0),{setOverride:O,setTitle:Y,readerNavBarWidth:he}=r.useContext(Wt),[re,je]=r.useState(!1),{data:xe,loading:pt,error:ke,refetch:gt}=V.useGetMangaChapters(Ge,c,{nextFetchPolicy:"standby"}),w=xe==null?void 0:xe.chapters.nodes,me=h||L||pt||N||!m.current&&!y&&!A,_e=(Ve=(qe=g!=null?g:y)!=null?qe:ke)!=null?Ve:A,{settings:Ce,loading:Ne}=Vt(),[P,Oe]=r.useState(Je(u,Ce)),{settings:ue}=Ye(),Ae=r.useMemo(()=>P.skipDupChapters?_.removeDuplicates(f.current,w!=null?w:[]):w!=null?w:[],[f.current,w,P.skipDupChapters]),ht=r.useMemo(()=>_.getNextChapters(e,w!=null?w:[],{offset:U.PREV,skipDupe:P.skipDupChapters,skipDupeChapter:f.current}),[e,f.current,w,P.skipDupChapters]),xt=r.useMemo(()=>_.getNextChapters(e,w!=null?w:[],{skipDupe:P.skipDupChapters,skipDupeChapter:f.current}),[e,f.current,w,P.skipDupChapters]),fe=r.useMemo(()=>_.getNextChapter(e,w!=null?w:[],{offset:U.PREV,skipDupe:P.skipDupChapters,skipDupeChapter:f.current}),[e,f.current,w,P.skipDupChapters]),Z=r.useMemo(()=>_.getNextChapter(e,w!=null?w:[],{skipDupe:P.skipDupChapters,skipDupeChapter:f.current}),[e,f.current,w,P.skipDupChapters]),Ie=j=>{if(e===ee)return;const W=()=>{if(!(!!j.isRead&&!!ue.deleteChaptersWhileReading)||!w)return[];const J=[e,...ht][ue.deleteChaptersWhileReading-1];if(!J)return[];const we=se(J.id);return we.isRead&&_.isDeletable(we,ue.deleteChaptersWithBookmark)?P.skipDupChapters?_.getIds(_.addDuplicates([J],w)):_.getIds([J]):[]};(()=>{var Re;const pe=se(e.id),J=((Re=j.lastPageRead)!=null?Re:0)/e.pageCount>.25;if(k&&u.inLibrary&&!!(pe!=null&&pe.isDownloaded)&&J){const ye=Z?se(Z.id):null;if(!(ye!=null&&ye.isDownloaded))return;const Xe=_.getNonRead(xt).map(X=>se(X.id)).slice(-S).filter(X=>!X.isDownloaded).map(X=>X.id).filter(X=>!_.isDownloading(X));if(!Xe.length)return;_.download(Xe).catch(K())}})();const ve=P.skipDupChapters?_.getIds(_.addDuplicates([e],w!=null?w:[e])):[e.id];V.updateChapters(ve,{...j,chapterIdsToDelete:W(),trackProgressMangaId:ue.updateProgressAfterReading&&j.isRead&&u.trackRecords.totalCount?u.id:void 0},{errorPolicy:"all"}).response.catch(K())},mt=(j,W,M=!0)=>{Oe({...P,[j]:W}),M&&Ht(u,[[j,W]]).catch(()=>Ze(a("reader.settings.error.label.failed_to_save_settings"),"warning"))},Q=r.useCallback(j=>{const W=j===U.NEXT,M=W?Z:fe;if(!M){Ze(a(W?"reader.error.label.next_chapter_does_not_exist":"reader.error.label.prev_chapter_does_not_exist"),"error");return}je(!0),T(0),n("/manga/".concat(u.id,"/chapter/").concat(M.sourceOrder),{replace:!0,state:s.state}),je(!1)},[u.id,fe==null?void 0:fe.id,Z==null?void 0:Z.id]);r.useEffect(()=>{if(me||!e){T(0);return}te(!0),e.lastPageRead===e.pageCount-1?T(0):T(e.lastPageRead)},[e,me]),r.useEffect(()=>{!(u!=null&&u.title)||e.name===a("global.label.loading")?Y(a("reader.title")):Y("".concat(u.title,": ").concat(e.name))},[a,u,e]),r.useEffect(()=>{!Ne&&!h&&(Xt(u,"manga",Ce).catch(K()),Oe(Je(u,Ce)))},[Ne,h]),r.useEffect(()=>(O({status:!0,value:t.jsx(Nr,{settings:P,setSettingValue:mt,manga:u,chapter:e,chapters:Ae,curPage:C,scrollToPage:R,openNextChapter:Q,retrievingNextChapter:re})}),()=>O({status:!1,value:t.jsx("div",{})})),[u,e,P,C,p,re,Q,Ae]),r.useEffect(()=>{if(!H||e===ee)return;const j=se(e.id);if(F===(j==null?void 0:j.lastPageRead))return;const W=F!==-1,M=F===e.pageCount-1;(W||M)&&Ie({lastPageRead:W?F:void 0,isRead:M?!0:void 0})},[F,k]);const Ct=r.useCallback(()=>{Ie({lastPageRead:e.pageCount-1,isRead:!0}),Q(U.NEXT)},[e.pageCount,Q,e,u]),vt=r.useCallback(()=>{Q(U.PREV)},[Q]),wt=Mt.useGetScrollbarSize("height");if(me)return t.jsx(B,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:t.jsx(zt,{thickness:5})});if(_e)return t.jsx(Qe,{message:a("global.error.label.failed_to_load_data"),messageExtra:_e.message,retry:()=>{g&&d().catch(K()),y&&l().catch(K()),ke&&gt().catch(K()),A&&I()}});if(!e.pageCount)return t.jsx(Qe,{message:a("reader.error.label.no_pages_found"),retry:I});const Rt=Ar(e.pageCount).map(j=>({index:j,src:V.getChapterPageUrl(c,p,j)})),yt=Or(P.readerType),bt=G!=null?G:e.lastPageRead===e.pageCount-1?0:e.lastPageRead,$e=P.staticNav?he:0;return t.jsxs(B,{sx:{display:"flex",flexDirection:"column",alignContent:"center",alignItems:"center",justifyContent:"center",minWidth:"calc((100vw - (100vw - 100%)) - ".concat($e,"px)"),minHeight:"calc(100vh - ".concat(wt,"px)"),marginLeft:"".concat($e,"px")},children:[t.jsx(tr,{settings:P,curPage:C,pageCount:e.pageCount}),t.jsx(B,{sx:{alignSelf:"stretch"},children:t.jsx(yt,{pages:Rt,pageCount:e.pageCount,setCurPage:T,initialPage:bt,curPage:C,settings:P,manga:u,chapter:e,nextChapter:Ct,prevChapter:vt},e.id)})]})}export{Zr as Reader};
