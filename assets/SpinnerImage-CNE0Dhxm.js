import{c as M,j as e,b as t,u as K,r as $,S as E,z as U,at as A,aE as _,B as G}from"./index-B8EETnhg.js";import{R as H}from"./Refresh-BvRVle64.js";const J=M(e.jsx("path",{d:"M21 5v6.59l-3-3.01-4 4.01-4-4-4 4-3-3.01V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2m-3 6.42 3 3.01V19c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2v-6.58l3 2.99 4-4 4 4z"})),N=M(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"})),Q=(n,h,{ignoreInitialObserve:l=!1,root:d,rootMargin:f,threshold:m}={})=>{const[a,j]=t.useState(()=>{});return t.useLayoutEffect(()=>{const o=n instanceof HTMLElement?n:n==null?void 0:n.current;if(!o)return()=>{};let i=!0;const r=new IntersectionObserver((...I)=>{if(l&&i){i=!1;return}h(...I)},{root:d,rootMargin:f,threshold:m});return r.observe(o),j(()=>()=>r.disconnect()),()=>r.disconnect()},[n,h,l,d,f,m]),a},Z=({ref:n,...h})=>{const{shouldLoad:l=!0,shouldDecode:d,useFetchApi:f,disableCors:m,src:a,alt:j,onLoad:o,onError:i,spinnerStyle:{small:r,...I}={},imgStyle:g,hideImgStyle:R,priority:P,retryKeyPrefix:k}=h,{t:T}=K(),L=t.useRef(null),S=!a.length,[p,V]=t.useState(),[z,q]=t.useState(0),[x,B]=t.useState(),[y,O]=t.useState(!1),[D,F]=t.useState(!1),b=(s,c=!1,C=!1)=>{B(s),O(c),c&&!s&&!C&&(i==null||i()),!s&&!c&&!C&&(o==null||o())};return Q(L,t.useCallback(s=>F(s[0].isIntersecting),[])),t.useEffect(()=>{if(S||!l)return()=>{};const s=$.requestImage(a,{priority:P,shouldDecode:d,useFetchApi:f,disableCors:m});let c;return(async()=>{try{const u=async()=>{const v=await s.response;b(!1),V(v)};if(!!await Promise.race([s.response,new Promise(v=>{c=setTimeout(v,50)})])){await u();return}b(!0),await u()}catch(u){const w=u instanceof Error&&(u.name==="AbortError"||u.message==="Component was unmounted");b(!1,!w,w)}})().catch(()=>{}),()=>{s.cleanup(),clearTimeout(c),s.abortRequest(new Error("Component was unmounted"))}},[a,z,k,S,l]),e.jsxs(e.Fragment,{children:[S?e.jsx(E,{ref:n,sx:{height:"100%",alignItems:"center",justifyContent:"center",background:s=>s.palette.background.default,...I},children:e.jsx(N,{fontSize:"large"})}):e.jsx(U,{component:"img",sx:[...Array.isArray(g)?g!=null?g:[]:[g],A(!p||x||y,{...R,...A(!R,{display:"none"})})],ref:n,crossOrigin:m?void 0:"anonymous",src:p,alt:j,draggable:!1},"".concat(a,"_").concat(z,"_").concat(k)),(x||a&&!p||y)&&e.jsx(E,{ref:L,sx:{height:"100%",justifyContent:"center",alignItems:"center",...I},children:e.jsxs(E,{sx:{height:"100%",alignItems:"center",justifyContent:"center"},children:[D&&(x||a&&!p&&!y)&&e.jsx(_,{thickness:5}),y&&x===!1&&e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsx(G,{startIcon:!r&&e.jsx(H,{}),onClick:s=>{s.stopPropagation(),s.preventDefault(),q(c=>(c+1)%100)},size:r?"small":"large",children:r?e.jsx(H,{}):T("global.button.retry")})]})]})})]})};export{Z as S,Q as u};
