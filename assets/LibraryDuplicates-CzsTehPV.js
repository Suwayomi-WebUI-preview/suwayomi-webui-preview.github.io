import{u as A,d as b,p as y,c,N as D,j as t,P as v,I as C,z as T,b7 as E,H as G,A as B,U as I,a as S,bD as _,g as w,E as O,h as P,B as k}from"./index-Ds0K65iN.js";import{G as F}from"./GridLayouts-B3190U3b.js";import{C as N}from"./CheckboxInput-CJzWXTND.js";import{b as H}from"./MangaGrid-DXDcws6g.js";import{S as z,a as L,b as U}from"./StyledGroupItemWrapper-BcC1p6A8.js";import{B as V}from"./BaseMangaGrid-DUCjz0V3.js";import"./ViewModule-Dp4EuQ-f.js";import"./Checkbox-BnKF-QYl.js";import"./TextField-Rz9VVMXX.js";import"./SwitchBase-Cu10u0sS.js";import"./ListPreference-aYx0WRV4.js";import"./index-BlCVCax8.js";import"./useManageMangaLibraryState-DD1eHw1P.js";import"./Trackers-D4pSmk7a.js";import"./TypographyMaxLines-DPjYtNCP.js";import"./Avatar-DqTWD0z2.js";import"./Info-B7tQ8Zwz.js";import"./InputAdornment-CiQkaRlX.js";import"./SpinnerImage-Ci4RZpD_.js";import"./Collapse-D7MrGaEb.js";import"./Link-DvylPd6o.js";import"./NumberSetting-CIuuVbBV.js";import"./useMobilePicker-OddyNqSh.js";import"./Chip-BhBIBUeY.js";import"./SelectSetting-WQoho_UY.js";import"./Select-B4ys9IXq.js";import"./Mangas-Uiwc1dOm.js";import"./Chapters-rcIErG3N.js";import"./ThreeStateCheckboxInput-07ivetIF.js";import"./Delete-j6qJ5a5E.js";import"./Sync-Bf_ANv-g.js";import"./PlayArrow-MgvGf0Dx.js";import"./StyledFab-BwN0yYLV.js";const q=a=>{const i=Object.groupBy(a,({title:r})=>r.toLowerCase().trim());return Object.fromEntries(Object.entries(i).filter(r=>{var e,o;return((o=(e=r[1])==null?void 0:e.length)!=null?o:0)>1}).map(([,r])=>[r[0].title,r]))},R=a=>{const i={},r={};return a.forEach(e=>a.forEach(o=>{var p,u,f;if(!(e.id!==o.id))return;const d=e.title.toLowerCase().trim(),n=o.title.toLowerCase().trim()===d,h=!!((p=o.description)!=null&&p.toLowerCase().trim().includes(d));!(n||h)||(!i[e.id]&&(i[e.id]=!0,r[e.title]=[...(u=r[e.title])!=null?u:[],e]),i[o.id])||(i[o.id]=!0,r[e.title]=[...(f=r[e.title])!=null?f:[],o])})),r},vt=()=>{const{t:a}=A(),[i,r]=b("libraryDuplicatesGridLayout",y.List),[e,o]=b("libraryDuplicatesCheckAlternativeTitles",!1),{setTitle:g,setAction:d}=c.useContext(D);c.useEffect(()=>(g(a("library.settings.advanced.duplicates.label.title")),d(t.jsxs(t.Fragment,{children:[t.jsx(F,{gridLayout:i,onChange:r}),t.jsx(v,{variant:"popover",popupId:"library-dupliactes-settings",children:s=>t.jsxs(t.Fragment,{children:[t.jsx(C,{...T(s),children:t.jsx(E,{})}),t.jsx(G,{...B(s),children:t.jsx(I,{children:t.jsx(N,{label:a("library.settings.advanced.duplicates.settings.label.check_description"),checked:e,onChange:(m,M)=>o(M)})})})]})})]})),()=>{g(""),d(null)}),[a,i,e]);const{data:n,loading:h,error:x,refetch:j}=S.useGetMangas(_,{condition:{inLibrary:!0}}),l=c.useMemo(()=>{var m;const s=(m=n==null?void 0:n.mangas.nodes)!=null?m:[];return e?R(s):q(s)},[n==null?void 0:n.mangas.nodes,e]),p=c.useMemo(()=>Object.keys(l),[l]),u=c.useMemo(()=>Object.values(l).flat(),[l]),f=c.useMemo(()=>Object.values(l).map(s=>s.length),[l]);return h?t.jsx(w,{}):x?t.jsx(O,{message:a("global.error.label.failed_to_load_data"),messageExtra:x.message,retry:()=>j().catch(P())}):i===y.List?t.jsx(z,{groupCounts:f,groupContent:s=>t.jsx(L,{variant:"h5",isFirstItem:s===0,children:p[s]}),itemContent:s=>t.jsx(U,{children:t.jsx(H,{manga:u[s],gridLayout:i,selected:null,mode:"duplicate"})},u[s].id)}):p.map((s,m)=>t.jsxs(k,{children:[t.jsx(L,{sx:{pt:m===0?void 0:0,pb:0},variant:"h5",isFirstItem:!1,children:s}),t.jsx(V,{mangas:l[s],hasNextPage:!1,loadMore:()=>{},isLoading:!1,gridLayout:i,inLibraryIndicator:!1,horizontal:!0,mode:"duplicate"})]},s))};export{vt as LibraryDuplicates};
