import{u as v,c as b,f as m,j as e,aQ as M,aA as u,ao as A,aK as U,aJ as D,Z as R,aM as w,e as T,a9 as x,n as f,o as k,w as y,aL as _,aV as N,N as G,b8 as V,s as F,l as O,E as H,m as I,aN as B,A as P,bF as q,z}from"./index-C-NRbn2J.js";import{C as J,a as K}from"./CategoriesInclusionSetting-B1-H3HId.js";import{N as Q}from"./NumberSetting-CWXMAhoj.js";import{u as X,g as Z}from"./usePersistedValue-YxGPUEUZ.js";import{S}from"./Switch-Cx6nj76p.js";import{M as W}from"./Mangas-BPXmRPR1.js";import"./ThreeStateCheckboxInput-DU2px-ZJ.js";import"./Info-s1022MQE.js";import"./TextField-DbGGHPPy.js";import"./InputAdornment-Ba1B_yfN.js";const C={excludeUnreadChapters:"library.settings.global_update.entries.label.unread_chapters",excludeNotStarted:"library.settings.global_update.entries.label.not_started",excludeCompleted:"library.settings.global_update.entries.label.completed"},Y=t=>{const r=[];return t.excludeUnreadChapters&&r.push(x(C.excludeUnreadChapters)),t.excludeNotStarted&&r.push(x(C.excludeNotStarted)),t.excludeCompleted&&r.push(x(C.excludeCompleted)),!r.length&&r.push(x("global.label.none")),r.join(", ")},$=t=>({excludeCompleted:t.excludeCompleted,excludeNotStarted:t.excludeNotStarted,excludeUnreadChapters:t.excludeUnreadChapters}),ee=({serverSettings:t})=>{const{t:r}=v(),a=$(t),[i]=b.useUpdateServerSettings(),[s,l]=m.useState(a!=null?a:{}),[d,o]=m.useState(!1),p=Y(a),n=async()=>{const g=(a==null?void 0:a.excludeCompleted)!==s.excludeCompleted||a.excludeNotStarted!==s.excludeNotStarted||a.excludeUnreadChapters!==s.excludeUnreadChapters;if(o(!1),!!g)try{await i({variables:{input:{settings:s}}})}catch(h){f(r("global.error.label.failed_to_save_changes"),"error",k(h))}},j=()=>{l(a!=null?a:{}),o(!1)};return m.useEffect(()=>{a&&l(a)},[a==null?void 0:a.excludeCompleted,a==null?void 0:a.excludeNotStarted,a==null?void 0:a.excludeUnreadChapters]),e.jsxs(e.Fragment,{children:[e.jsx(M,{onClick:()=>o(!0),children:e.jsx(u,{primary:r("library.settings.global_update.entries.title"),secondary:p,onClick:()=>o(!0)})}),e.jsxs(A,{open:d,onClose:j,children:[e.jsxs(U,{children:[e.jsx(D,{sx:{paddingLeft:0},children:r("library.settings.global_update.entries.title")}),e.jsx(J,{children:Object.entries(s).map(([g,h])=>e.jsx(R,{label:r(C[g]),checked:h,onChange:(E,c)=>{l({...s,[g]:c})}},g))})]}),e.jsxs(w,{children:[e.jsx(T,{onClick:j,color:"primary",children:r("global.button.cancel")}),e.jsx(T,{onClick:n,color:"primary",children:r("global.button.ok")})]})]})]})},L=12,te=6,ae=24*7*4,re=({globalUpdateInterval:t})=>{const{t:r}=v(),a=t,i=!!a,[s]=b.useUpdateServerSettings(),[l,d]=X("lastGlobalUpdateInterval",L,a,Z),o=m.useCallback(n=>{d(n===0?l:n),s({variables:{input:{settings:{globalUpdateInterval:n}}}})},[l]),p=n=>{o(n?l:0)};return e.jsxs(y,{children:[e.jsxs(_,{children:[e.jsx(u,{primary:r("library.settings.global_update.auto_update.label.title")}),e.jsx(S,{edge:"end",checked:i,onChange:n=>p(n.target.checked)})]}),e.jsx(Q,{settingTitle:r("library.settings.global_update.auto_update.interval.label.title"),settingValue:r("library.settings.global_update.auto_update.interval.label.value",{hours:l}),value:l,minValue:te,maxValue:ae,defaultValue:L,showSlider:!0,valueUnit:r("global.time.hour_short"),handleUpdate:o,disabled:!i})]})},se=({serverSettings:t,categories:r})=>{const{t:a}=v(),{updateMangas:i}=t,[s]=b.useUpdateServerSettings(),l=async(d,o)=>{try{await s({variables:{input:{settings:{[d]:o}}}})}catch(p){f(a("global.error.label.failed_to_save_changes"),"error",k(p))}};return e.jsxs(y,{subheader:e.jsx(N,{component:"div",id:"global-update-settings",children:a("library.settings.global_update.title")}),children:[e.jsx(re,{globalUpdateInterval:t.globalUpdateInterval}),e.jsx(ee,{serverSettings:t}),e.jsx(K,{categories:r,includeField:"includeInUpdate",dialogText:a("library.settings.global_update.categories.label.info")}),e.jsxs(_,{children:[e.jsx(u,{primary:a("library.settings.global_update.metadata.label.title"),secondary:a("library.settings.global_update.metadata.label.description")}),e.jsx(S,{edge:"end",checked:i,onChange:d=>l("updateMangas",d.target.checked)})]})]})},le=async()=>{try{const t=await b.getMangas(q,{filter:{inLibrary:{equalTo:!1},categoryId:{isNull:!1}}}).response,r=W.getIds(t.data.mangas.nodes);r.length&&await b.updateMangasCategories(r,{clearCategories:!0}).response,f(x("library.settings.advanced.database.cleanup.label.success"),"success")}catch(t){f(x("library.settings.advanced.database.cleanup.label.error"),"error",k(t))}};function xe(){var h,E;const{t}=v(),{setTitle:r,setAction:a}=m.useContext(G);m.useLayoutEffect(()=>(r(t("library.settings.title")),a(null),()=>{r(""),a(null)}),[t]);const i=b.useGetCategories(V),s=b.useGetServerSettings({notifyOnNetworkStatusChange:!0}),{settings:l,loading:d,request:{error:o,refetch:p}}=F(),n=z(c=>f(t("search.error.label.failed_to_save_settings"),"error",k(c)));if(s.loading||d||i.loading)return e.jsx(O,{});const g=(E=(h=s.error)!=null?h:o)!=null?E:i.error;return g?e.jsx(H,{message:t("global.error.label.failed_to_load_data"),messageExtra:g.message,retry:()=>{s.error&&(s==null||s.refetch().catch(I())),o&&p().catch(I()),i.error&&i.refetch().catch(I())}}):e.jsxs(y,{sx:{pt:0},children:[e.jsxs(y,{subheader:e.jsx(N,{component:"div",id:"library-general-settings",children:t("global.label.general")}),children:[e.jsxs(_,{children:[e.jsx(u,{primary:t("library.settings.general.search.ignore_filters.label.title"),secondary:t("library.settings.general.search.ignore_filters.label.description")}),e.jsx(S,{edge:"end",checked:l.ignoreFilters,onChange:c=>n("ignoreFilters",c.target.checked)})]}),e.jsxs(_,{children:[e.jsx(u,{primary:t("library.settings.general.add_to_library.category_selection.label.title"),secondary:t("library.settings.general.add_to_library.category_selection.label.description")}),e.jsx(S,{edge:"end",checked:l.showAddToLibraryCategorySelectDialog,onChange:c=>n("showAddToLibraryCategorySelectDialog",c.target.checked)})]}),e.jsxs(_,{children:[e.jsx(u,{primary:t("library.settings.general.remove_from_library.remove_from_categories.label.title"),secondary:t("library.settings.general.remove_from_library.remove_from_categories.label.description")}),e.jsx(S,{edge:"end",checked:l.removeMangaFromCategories,onChange:c=>n("removeMangaFromCategories",c.target.checked)})]})]}),e.jsx(se,{serverSettings:s.data.settings,categories:i.data.categories.nodes}),e.jsxs(y,{subheader:e.jsx(N,{component:"div",id:"library-advanced",children:t("global.label.advanced")}),children:[e.jsx(M,{onClick:()=>le(),children:e.jsx(u,{primary:t("library.settings.advanced.database.cleanup.label.title"),secondary:t("library.settings.advanced.database.cleanup.label.description")})}),e.jsx(B,{to:P.settings.childRoutes.library.childRoutes.duplicates.path,children:e.jsx(u,{primary:t("library.settings.advanced.duplicates.label.title"),secondary:t("library.settings.advanced.duplicates.label.description")})})]})]})}export{xe as LibrarySettings};
