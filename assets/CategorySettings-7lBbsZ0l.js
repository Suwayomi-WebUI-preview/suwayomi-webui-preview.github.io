var I=Object.freeze,M=Object.defineProperty;var k=(o,l)=>I(M(o,"raw",{value:I(l||o.slice())}));import{u as v,j as e,G as C,T as q,b as U,C as A,I as F,r as p,f as g,o as P,p as W,q as K,b7 as V,w as Y,B as O,m as w,g as y,b8 as z,i as J,k as Q,b9 as X}from"./index-ZE1rjjwW.js";import{A as Z}from"./Add-m-5ky_Z_.js";import{D as $,a as ee,b as te,c as oe,S as re,v as ae,d as se,e as ne}from"./DragHandle-D4TaozcE.js";import{D as ie,F as le}from"./StyledFab-BPNIHaPN.js";import{E as de}from"./EmptyViewAbsoluteCentered-o28tLxDU.js";import{E as ce}from"./Edit-DMGljztx.js";import{D as ge}from"./Delete-DTz4BJTD.js";import{L as me}from"./ListCardContent-CZMRWdbJ.js";import{C as ue}from"./Card-BYM9Jdja.js";import{u as xe}from"./useAppTitle-BS-n0Bj4.js";import{a as pe}from"./Asserts-D5Kyx99Q.js";import{F as he,C as fe}from"./Checkbox-B140h3Wc.js";import"./SwitchBase-DhK_X3zI.js";const G=({category:o,onEdit:l})=>{const{t:s}=v(),r=()=>{p.deleteCategory(o.id)};return e.jsx(C,{sx:{p:1,pb:0},children:e.jsx(ue,{children:e.jsxs(me,{sx:{gap:2},children:[e.jsx($,{}),e.jsx(q,{sx:{flexGrow:1},variant:"h6",component:"h2",children:o.name}),e.jsxs(U,{sx:{flexDirection:"row"},children:[e.jsx(A,{title:s("global.button.edit"),children:e.jsx(F,{component:C,onClick:l,children:e.jsx(ce,{})})}),e.jsx(A,{title:s("chapter.action.download.delete.label.action"),children:e.jsx(F,{component:C,onClick:r,children:e.jsx(ge,{})})})]})]})})})},S=-1;var L;const Ce=({category:o,onClose:l})=>{const s=!!o,{t:r}=v(),[n,b]=g.useState(o==null?void 0:o.name),[m,j]=g.useState(!!(o!=null&&o.default)),u=n!==void 0&&!n.trim().length,h=n!==void 0&&!u,D=()=>{if(pe(n),l(),s){p.updateCategory(o.id,{name:n,default:m}).response.catch(i=>w(r("global.error.label.failed_to_save_changes"),"error",y(i)));return}p.createCategory({name:n,default:m}).response.catch(i=>w(r("category.error.label.create_failure"),"error",y(i)))};return e.jsxs(P,{open:!0,onClose:l,children:[e.jsx(W,{id:"form-dialog-title",children:r(s?"category.dialog.title.edit_category_one":"category.dialog.title.new_category")}),e.jsxs(K,{children:[e.jsx(V,{autoFocus:!0,margin:"dense",id:"name",label:r("category.label.category_name"),type:"text",fullWidth:!0,value:n,onChange:i=>b(i.target.value.trim()),error:u,helperText:u?r(L||(L=k(["global.error.label.invalid_input"]))):void 0}),e.jsx(he,{control:e.jsx(fe,{checked:m,onChange:i=>j(i.target.checked)}),label:r("category.label.use_as_default_category")})]}),e.jsxs(Y,{children:[e.jsx(O,{onClick:l,color:"primary",children:r("global.button.cancel")}),e.jsx(O,{onClick:D,color:"primary",disabled:!h,children:r("global.button.submit")})]})]})};function we(){const{t:o}=v(),l=ee.useSensorsForDevice();xe(o("category.dialog.title.edit_category_other"));const{data:s,loading:r,error:n,refetch:b}=p.useGetCategories(z,{notifyOnNetworkStatusChange:!0}),[m,{reset:j}]=p.useReorderCategory(),[u,h]=g.useState(S),[D,i]=g.useState(!1),[x,f]=g.useState(null),d=g.useMemo(()=>{var a;const t=[...(a=s==null?void 0:s.categories.nodes)!=null?a:[]];return t.length>0&&t[0].name==="Default"&&t.shift(),t},[s]),R=(t,a,c)=>{const E=t[a];m({variables:{input:{id:E.id,position:c+1}}}).catch(()=>j())},B=t=>{const{active:a,over:c}=t;if(f(null),!c||a.id===c.id)return;const E=d.findIndex(_=>_.id===a.id),H=d.findIndex(_=>_.id===c.id);R(d,E,H)},T=t=>{h(t!=null?t:S),i(!0)},N=()=>{h(S),i(!1)};return r?e.jsx(J,{}):n?e.jsx(de,{message:o("category.error.label.request_failure"),messageExtra:y(n),retry:()=>b().catch(Q())}):e.jsxs(e.Fragment,{children:[e.jsx(te,{sensors:l,collisionDetection:oe,onDragStart:t=>{var a;return f((a=d.find(c=>c.id===t.active.id))!=null?a:null)},onDragEnd:B,onDragCancel:()=>f(null),onDragAbort:()=>f(null),children:e.jsxs(C,{sx:{paddingBottom:ie},children:[e.jsx(re,{items:d,strategy:ae,children:d.map((t,a)=>e.jsx(se,{id:t.id,isDragging:t.id===(x==null?void 0:x.id),children:e.jsx(G,{category:t,onEdit:()=>T(a)})},t.id))}),e.jsx(ne,{isActive:!!x,children:e.jsx(G,{category:x,onEdit:X})})]})}),e.jsx(le,{color:"primary","aria-label":"add",sx:{position:"fixed",bottom:t=>t.spacing(2),right:t=>t.spacing(2)},onClick:()=>T(),children:e.jsx(Z,{})}),D&&e.jsx(Ce,{category:d[u],onClose:N})]})}export{we as CategorySettings};
