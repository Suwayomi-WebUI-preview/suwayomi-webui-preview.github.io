import{f as j,c as q,j as i,u as V,L as at,o as Nt,p as le,q as ce,w as ue,b as k,B as ot,a7 as Gt,a8 as ht,C as A,I as E,a9 as Ut,aa as qt,ab as de,H as he,R as bt,P as Qt,r as U,ac as ge,i as Kt,g as lt,k as me,a5 as z,T as ct,G as Yt,ad as Jt,m as ut,ae as fe,af as pe,ag as be,ah as xe,ai as ve,aj as Ce,ak as _e,al as R,am as je,an as we,ao as Mt,h as ye,Y as Se,ap as Me,A as N,a1 as Xt,aq as Zt,ar as ke,as as Ie,at as Le,au as Te,e as te,av as xt,aw as Be,S as Re,ax as De,ay as Ee,az as Ae,aA as tt,aB as et,v as rt,aC as kt,aD as Ve,aE as $e,aF as Oe,aG as He,aH as Fe,aI as ze,aJ as Pe}from"./index-LuRfpAul.js";import{P as We}from"./PlayArrow-YllcmED0.js";import{S as Ne,D as Ge}from"./StyledFab-Di1pyMCC.js";import{C as H,a as Ue}from"./Chapters-BRAm19f6.js";import{C as qe,a as Qe,T as Ke,S as It,L as Lt}from"./ContinueReadingTooltip-bdIHl0MF.js";import{u as ee,i as Ye,a as Je,f as Xe,b as Ze,c as tr,F as er,C as Tt,d as rr}from"./useManageMangaLibraryState-KaKmbQNX.js";import{E as st}from"./EmptyViewAbsoluteCentered-CG8OzJNr.js";import{F as nr}from"./FilterList-Cc5JqZGL.js";import{D as ir}from"./Download-BibP4BOt.js";import{D as or}from"./DoneAll-BGQ-q2dd.js";import{S as sr,R as Bt}from"./SortRadioInput-Cu-UeZHB.js";import{D as ar,T as gt}from"./ThreeStateCheckboxInput-CCNOEL4t.js";import{O as lr,S as cr,a as ur}from"./SelectionFAB-DSJyISs-.js";import{C as re}from"./CheckboxInput-DNi2D9mP.js";import{F as dr}from"./FormGroup-CXSbTVhE.js";import{R as hr}from"./ListPreference-BaOoz4jP.js";import{C as gr,a as mr,I as fr}from"./ChapterListCard-HOCqEEee.js";import{V as pr}from"./VirtuosoPersisted-C_94Q6OJ.js";import{b as br}from"./Strings-CAV0u705.js";import{F as xr,I as vr}from"./IconWebView-CC5Mu3zX.js";import{a as G,b as Cr,M as _r}from"./Mangas-3OGaa-Ji.js";import{S as vt}from"./SpinnerImage-Bx512Ifd.js";import{S as jr}from"./Sync-D7PD4seM.js";import{T as mt}from"./Trackers-Bgo8y--2.js";import{M as wr}from"./Metadata-nlXIQKzQ.js";import{E as yr,a as Sr}from"./ExpandMore-DECnkmIu.js";import{L as Ct}from"./Link-EgZtWGSp.js";import{C as Mr}from"./Chip-CpRZiERU.js";import{R as Rt}from"./Refresh-D4vYYVyG.js";import{T as kr}from"./CreateThemeDialog-oQj3KI9-.js";import{u as Ir}from"./useAppTitleAndAction-DTZ17xPZ.js";import"./DateHelper-BCdsAYO-.js";import"./Asserts-DNMCi6ar.js";import"./AvatarSpinner-Ba0ZbUec.js";import"./Card-Cn142Txi.js";import"./ListCardContent-BNA9FzJm.js";import"./CheckCircle-DnxvzzEv.js";import"./MUI.util-CEodEA2f.js";import"./CardActionArea-CfK54VWb.js";import"./NumberSetting-Bifm9KJA.js";import"./Slider--oKI9R4X.js";import"./useMobilePicker-DI2whiFT.js";import"./SelectSetting-F4IFr8hg.js";import"./Select-BydMHwoW.js";import"./Checkbox-BZmjBZWi.js";import"./SwitchBase-8hP1GUdL.js";import"./Tabs-CiQfn4Rl.js";import"./ChapterCardMetadata-D7k-4mLD.js";import"./Delete-C39Fxflk.js";import"./index-DSrzPTbQ.js";import"./Virtuoso.util-BNN2EJ6V.js";import"./use-merged-ref-DTm_2N0b.js";import"./Image-Bn5kOV6B.js";import"./Trans-CXVK19fM.js";import"./useAppTitle-BLkwhwB5.js";import"./useAppAction-DDskQL_S.js";function Lr(t){return j.Children.toArray(t).filter(e=>j.isValidElement(e))}const Tr=q(i.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}));function Br({chapter:t}){const{t:e}=V(),{sourceOrder:r,name:n,chapterNumber:o,scanlator:s}=t,a=r===1;return i.jsx(qe,{chapterNumber:o,name:n,sourceOrder:r,scanlator:s,children:i.jsxs(Ne,{component:at,variant:"extended",color:"primary",to:H.getReaderUrl(t),state:H.getReaderOpenChapterLocationState(t),children:[i.jsx(We,{}),e(a?"global.button.start":"global.button.resume")]})})}const Dt=q(i.jsx("path",{d:"M16.67 13.13C18.04 14.06 19 15.32 19 17v3h4v-3c0-2.18-3.57-3.47-6.33-3.87M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4c-.47 0-.91.1-1.33.24C14.5 5.27 15 6.58 15 8s-.5 2.73-1.33 3.76c.42.14.86.24 1.33.24m-6 0c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0-6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 7c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4m6 5H3v-.99C3.2 16.29 6.3 15 9 15s5.8 1.29 6 2z"}));function Rr({title:t,emptyMessage:e,items:r,getId:n,getLabel:o,isChecked:s,open:a,onClose:l,slotProps:c}){const{t:d}=V(),u=j.useMemo(()=>r.map(n),[r]),g=j.useMemo(()=>r.filter(s).map(n),[r]),{selectedItemIds:h,handleSelection:f,handleSelectAll:m,reset:p}=ee(r.length,{currentKey:"default",itemIds:u,initialState:{default:g}}),b=()=>{l(),p()},v=j.useCallback(()=>{const C=h.length!==g.length||h.some(w=>!g.includes(w)),T=r.filter(w=>h.includes(n(w)));l(C?T:void 0)},[h]);return i.jsxs(Nt,{sx:{".MuiDialog-paper":{maxHeight:435,width:"80%"}},maxWidth:"xs",open:a,onClose:b,children:[i.jsx(le,{children:t}),i.jsx(ce,{dividers:!0,children:i.jsxs(dr,{children:[r.length===0&&i.jsx("span",{children:e}),r.map(C=>j.createElement(re,{...c==null?void 0:c.checkbox,checked:h.includes(n(C)),onChange:(T,w)=>f(n(C),w),label:o(C),key:n(C)}))]})}),i.jsx(ue,{children:i.jsx(k,{sx:{width:"100%"},children:i.jsxs(k,{direction:"row",sx:{justifyContent:"space-between",alignItems:"end",width:"100%"},children:[i.jsx(ot,{onClick:()=>m(!h.length,r.map(n)),children:d(h.length?"global.button.reset":"global.button.select_all")}),i.jsxs(k,{direction:"row",children:[i.jsx(ot,{autoFocus:!0,onClick:b,color:"primary",children:d("global.button.cancel")}),!!r.length&&i.jsx(ot,{onClick:v,color:"primary",children:d("global.button.ok")})]})]})})})]})}const Dr=({updateOption:t,scanlators:e,excludedScanlators:r})=>{const{t:n}=V(),o=Gt({variant:"dialog",popupId:"chapter-list-options-scanlator-filter-dialog"});return e.length?i.jsxs(i.Fragment,{children:[i.jsx(re,{...ht(o),label:n("global.label.scanlator"),icon:i.jsx(Dt,{}),checkedIcon:i.jsx(Dt,{color:"warning"}),checked:!!r.length}),i.jsx(Rr,{title:n("chapter.option.exclude_scanlators"),open:o.isOpen,onClose:s=>{s&&t("excludedScanlators",s),o.close()},items:e,getId:s=>s,getLabel:s=>s,isChecked:s=>r.includes(s),slotProps:{checkbox:{checkedIcon:i.jsx(ar,{})}}})]}):null},Er={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},Ar=({open:t,onClose:e,options:r,updateOption:n,scanlators:o,excludedScanlators:s})=>{const{t:a}=V();return i.jsx(lr,{open:t,onClose:e,minHeight:150,tabs:["filter","sort","display"],tabTitle:l=>a(Er[l]),tabContent:l=>l==="filter"?i.jsxs(i.Fragment,{children:[i.jsx(gt,{label:a("global.filter.label.unread"),checked:r.unread,onChange:c=>n("unread",c)}),i.jsx(gt,{label:a("global.filter.label.downloaded"),checked:r.downloaded,onChange:c=>n("downloaded",c)}),i.jsx(gt,{label:a("global.filter.label.bookmarked"),checked:r.bookmarked,onChange:c=>n("bookmarked",c)}),i.jsx(Dr,{scanlators:o,excludedScanlators:s,updateOption:n})]}):l==="sort"?Object.entries(Ue).map(([c,d])=>i.jsx(sr,{label:a(d),checked:r.sortBy===c,sortDescending:r.reverse,onClick:()=>c!==r.sortBy?n("sortBy",c):n("reverse",!r.reverse)},c)):l==="display"?i.jsxs(hr,{onChange:()=>n("showChapterNumber",!r.showChapterNumber),value:r.showChapterNumber,children:[i.jsx(Bt,{label:a("chapter.option.display.label.source_title"),value:!1}),i.jsx(Bt,{label:a("chapter.option.display.label.chapter_number"),value:!0})]}):null})},Vr=({mangaId:t,options:e,updateOption:r,chapters:n,scanlators:o,excludeScanlators:s})=>{const{t:a}=V(),[l,c]=j.useState(!1),d=Ye(e),u=j.useMemo(()=>n.every(H.isRead),[n]),g=j.useMemo(()=>n.every(H.isDownloaded),[n]);return i.jsxs(i.Fragment,{children:[i.jsx(A,{title:a("chapter.action.mark_as_read.add.label.action.all"),disabled:u,children:i.jsx(E,{disabled:u,onClick:()=>H.markAsRead(H.getNonRead(n),!0,t),color:"inherit",children:i.jsx(or,{})})}),i.jsx(Ut,{variant:"popover",popupId:"chapterlist-download-button",children:h=>i.jsxs(i.Fragment,{children:[i.jsx(A,{title:a("global.button.download"),disabled:u,children:i.jsx(E,{disabled:g,...ht(h),color:"inherit",children:i.jsx(ir,{})})}),h.isOpen&&i.jsx(qt,{...de(h),children:i.jsx(Qe,{mangaIds:[t],closeMenu:h.close})})]})}),i.jsx(A,{title:a("chapter.action.filter_and_sort.label"),children:i.jsx(E,{onClick:()=>c(!0),color:"inherit",children:i.jsx(nr,{color:d?"warning":void 0})})}),i.jsx(Ar,{open:l,onClose:()=>c(!1),options:e,updateOption:r,scanlators:o,excludedScanlators:s})]})},$r=z(k,{shouldForwardProp:Jt(["scrollbarWidth"])})(({theme:t,scrollbarWidth:e})=>({padding:t.spacing(1),paddingRight:"calc(".concat(e,"px + ").concat(t.spacing(1),")"),paddingBottom:0,[t.breakpoints.down("md")]:{paddingRight:t.spacing(1)}})),Or=z(pr,{shouldForwardProp:Jt(["topOffset"])})(({theme:t,topOffset:e})=>({listStyle:"none",padding:0,[t.breakpoints.up("md")]:{height:"calc(100vh - ".concat(e,"px)"),margin:0}})),Hr=({selectedChapters:t,firstUnreadChapter:e,onFABMenuClose:r})=>t.length?i.jsx(ur,{selectedItemsCount:t.length,title:"chapter.title_one",children:n=>i.jsx(mr,{selectedChapters:t,onClose:()=>{r==null||r(),n()}})}):e?i.jsx(Br,{chapter:e}):null,Fr=({manga:t,isRefreshing:e})=>{const{t:r}=V(),{appBarHeight:n}=he(),o=bt.useIsBelowWidth("md"),[s,a]=j.useState(50),[l,c]=j.useState(null);Qt(l,j.useCallback(()=>{var M;return a((M=l==null?void 0:l.offsetHeight)!=null?M:0)},[l]));const d=bt.useGetScrollbarSize("width"),u=Je(t),g=Ze(t,M=>ut(r("global.error.label.failed_to_save_changes"),"error",lt(M))),{data:h,loading:f,error:m,refetch:p}=U.useGetMangaChapters(ge,t.id,{notifyOnNetworkStatusChange:!0}),b=j.useMemo(()=>{var M;return(M=h==null?void 0:h.chapters.nodes)!=null?M:[]},[h==null?void 0:h.chapters.nodes]),v=j.useMemo(()=>Xe(b,u),[b,u]),C=j.useMemo(()=>H.getIds(v),[v]),T=j.useMemo(()=>H.getMissingCount(v),[v]),w=b.length===0,B=!w&&v.length===0,{areNoItemsSelected:_,areAllItemsSelected:y,selectedItemIds:S,handleSelectAll:L,handleSelection:I,clearSelection:J}=ee(C.length,{itemIds:C,currentKey:"default"}),X=j.useCallback((M,P,Z)=>I(M,P,{selectRange:Z}),[I]);return f||w&&e?i.jsx(k,{sx:{justifyContent:"center",alignItems:"center",position:"relative",flexGrow:1},children:i.jsx(Kt,{})}):m?i.jsx(k,{sx:{justifyContent:"center",position:"relative",flexGrow:1},children:i.jsx(st,{message:r("global.error.label.failed_to_load_data"),messageExtra:lt(m),retry:()=>p().catch(me())})}):i.jsxs(i.Fragment,{children:[i.jsxs(k,{direction:"column",sx:{position:"relative",flexBasis:"60%"},children:[i.jsxs($r,{ref:c,direction:"row",alignItems:"center",justifyContent:"space-between",scrollbarWidth:d,children:[i.jsxs(k,{children:[i.jsx(ct,{variant:"h5",component:"h3",children:r("chapter.value",{count:v.length})}),!!T&&i.jsx(ct,{variant:"body2",color:"warning",children:"".concat(r("chapter.missing",{count:T}))})]}),i.jsxs(k,{direction:"row",children:[_&&i.jsx(Vr,{mangaId:t.id,options:u,updateOption:g,chapters:v,scanlators:H.getScanlators(b),excludeScanlators:u.excludedScanlators}),!!C.length&&i.jsx(cr,{areAllItemsSelected:y,areNoItemsSelected:_,onChange:M=>L(M,M?C:[])})]})]}),w&&i.jsx(st,{message:r("chapter.error.label.no_chapter_found")}),B&&i.jsx(st,{message:r("chapter.error.label.no_matches")}),i.jsx(Or,{persistKey:"manga-".concat(t.id,"-chapter-list"),topOffset:n+s,style:{height:"undefined"},components:{Footer:()=>i.jsx(Yt,{sx:{paddingBottom:Ge}})},totalCount:v.length,computeItemKey:M=>v[M].id,itemContent:M=>i.jsx(gr,{index:M,isSortDesc:u.reverse,chapters:v,selected:_?null:S.includes(v[M].id),showChapterNumber:u.showChapterNumber,onSelect:X}),useWindowScroll:o,overscan:window.innerHeight*.5})]}),i.jsx(Hr,{selectedChapters:S.map(M=>b.find(P=>P.id===M)).filter(M=>M!=null),firstUnreadChapter:t.firstUnreadChapter,onFABMenuClose:J})]})},zr=t=>{const[e,r]=j.useState(!1),[n,o]=j.useState(null);return[j.useCallback(async()=>{r(!0),o(null),await Promise.all([U.getMangaFetch(t,{awaitRefetchQueries:!0}).response,U.getMangaChaptersFetch(t,{awaitRefetchQueries:!0}).response]).catch(a=>{a instanceof fe&&br(a.message)==="no chapters found"||o(a)}).finally(()=>r(!1))},[t]),{loading:e,error:n}]},Pr=q(i.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}));function Wr(t){return be("MuiButtonGroup",t)}const x=pe("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","horizontal","vertical","colorPrimary","colorSecondary","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]),Nr=(t,e)=>{const{ownerState:r}=t;return[{["& .".concat(x.grouped)]:e.grouped},{["& .".concat(x.grouped)]:e["grouped".concat(R(r.orientation))]},{["& .".concat(x.grouped)]:e["grouped".concat(R(r.variant))]},{["& .".concat(x.grouped)]:e["grouped".concat(R(r.variant)).concat(R(r.orientation))]},{["& .".concat(x.grouped)]:e["grouped".concat(R(r.variant)).concat(R(r.color))]},{["& .".concat(x.firstButton)]:e.firstButton},{["& .".concat(x.lastButton)]:e.lastButton},{["& .".concat(x.middleButton)]:e.middleButton},e.root,e[r.variant],r.disableElevation===!0&&e.disableElevation,r.fullWidth&&e.fullWidth,r.orientation==="vertical"&&e.vertical]},Gr=t=>{const{classes:e,color:r,disabled:n,disableElevation:o,fullWidth:s,orientation:a,variant:l}=t,c={root:["root",l,a,s&&"fullWidth",o&&"disableElevation","color".concat(R(r))],grouped:["grouped","grouped".concat(R(a)),"grouped".concat(R(l)),"grouped".concat(R(l)).concat(R(a)),"grouped".concat(R(l)).concat(R(r)),n&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return je(c,Wr,e)},Ur=z("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:Nr})(we(({theme:t})=>({display:"inline-flex",borderRadius:(t.vars||t).shape.borderRadius,variants:[{props:{variant:"contained"},style:{boxShadow:(t.vars||t).shadows[2]}},{props:{disableElevation:!0},style:{boxShadow:"none"}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"vertical"},style:{flexDirection:"column",["& .".concat(x.lastButton,",& .").concat(x.middleButton)]:{borderTopRightRadius:0,borderTopLeftRadius:0},["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderBottomRightRadius:0,borderBottomLeftRadius:0}}},{props:{orientation:"horizontal"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderTopRightRadius:0,borderBottomRightRadius:0},["& .".concat(x.lastButton,",& .").concat(x.middleButton)]:{borderTopLeftRadius:0,borderBottomLeftRadius:0}}},{props:{variant:"text",orientation:"horizontal"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderRight:t.vars?"1px solid ".concat(t.alpha(t.vars.palette.common.onBackground,.23)):"1px solid ".concat(t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"),["&.".concat(x.disabled)]:{borderRight:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},{props:{variant:"text",orientation:"vertical"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderBottom:t.vars?"1px solid ".concat(t.alpha(t.vars.palette.common.onBackground,.23)):"1px solid ".concat(t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"),["&.".concat(x.disabled)]:{borderBottom:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},...Object.entries(t.palette).filter(Mt()).flatMap(([e])=>[{props:{variant:"text",color:e},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderColor:t.alpha((t.vars||t).palette[e].main,.5)}}}]),{props:{variant:"outlined",orientation:"horizontal"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderRightColor:"transparent","&:hover":{borderRightColor:"currentColor"}},["& .".concat(x.lastButton,",& .").concat(x.middleButton)]:{marginLeft:-1}}},{props:{variant:"outlined",orientation:"vertical"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderBottomColor:"transparent","&:hover":{borderBottomColor:"currentColor"}},["& .".concat(x.lastButton,",& .").concat(x.middleButton)]:{marginTop:-1}}},{props:{variant:"contained",orientation:"horizontal"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderRight:"1px solid ".concat((t.vars||t).palette.grey[400]),["&.".concat(x.disabled)]:{borderRight:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},{props:{variant:"contained",orientation:"vertical"},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderBottom:"1px solid ".concat((t.vars||t).palette.grey[400]),["&.".concat(x.disabled)]:{borderBottom:"1px solid ".concat((t.vars||t).palette.action.disabled)}}}},...Object.entries(t.palette).filter(Mt(["dark"])).map(([e])=>({props:{variant:"contained",color:e},style:{["& .".concat(x.firstButton,",& .").concat(x.middleButton)]:{borderColor:(t.vars||t).palette[e].dark}}}))],["& .".concat(x.grouped)]:{minWidth:40,boxShadow:"none",props:{variant:"contained"},style:{"&:hover":{boxShadow:"none"}}}}))),qr=j.forwardRef(function(e,r){const n=xe({props:e,name:"MuiButtonGroup"}),{children:o,className:s,color:a="primary",component:l="div",disabled:c=!1,disableElevation:d=!1,disableFocusRipple:u=!1,disableRipple:g=!1,fullWidth:h=!1,orientation:f="horizontal",size:m="medium",variant:p="outlined",...b}=n,v={...n,color:a,component:l,disabled:c,disableElevation:d,disableFocusRipple:u,disableRipple:g,fullWidth:h,orientation:f,size:m,variant:p},C=Gr(v),T=j.useMemo(()=>({className:C.grouped,color:a,disabled:c,disableElevation:d,disableFocusRipple:u,disableRipple:g,fullWidth:h,size:m,variant:p}),[a,c,d,u,g,h,m,p,C.grouped]),w=Lr(o),B=w.length,_=y=>{const S=y===0,L=y===B-1;return S&&L?"":S?C.firstButton:L?C.lastButton:C.middleButton};return i.jsx(Ur,{as:l,role:"group",className:ve(C.root,s),ref:r,ownerState:v,...b,children:i.jsx(Ce.Provider,{value:T,children:w.map((y,S)=>i.jsx(_e.Provider,{value:_(S),children:y},S))})})}),ne=({children:t,...e})=>i.jsx(ot,{...e,children:i.jsx(k,{direction:"row",sx:{alignItems:"center",justifyContent:"center",gap:1,flexWrap:"wrap"},children:t})}),Qr=q(i.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),Kr=({manga:t})=>{var d,u;const{t:e}=V(),r=ye(),n=U.useGetTrackerList(Se),o=(u=(d=n.data)==null?void 0:d.trackers.nodes)!=null?u:[],s=t.trackRecords.nodes,a=mt.getLoggedIn(o),l=mt.getLoggedIn(mt.getTrackers(s,o)),c=g=>{var h;if(n.error){ut(e("tracking.error.label.could_not_load_track_info"),"error",(h=n.error)==null?void 0:h.toString());return}if(!a.length){r(N.settings.childRoutes.tracking.path);return}g()};return i.jsx(Ut,{variant:"dialog",popupId:"manga-track-modal",children:g=>i.jsxs(i.Fragment,{children:[i.jsxs(ne,{...ht(g),size:"medium",disabled:n.loading||!!n.error,onClick:()=>c(g.open),variant:l.length?"contained":"outlined",children:[l.length?i.jsx(Qr,{}):i.jsx(jr,{}),l.length?e("manga.button.track.active",{count:l.length}):e("manga.button.track.start")]}),g.isOpen&&i.jsx(Nt,{...Me(g),maxWidth:"md",fullWidth:!0,scroll:"paper",children:i.jsx(Ke,{manga:t})})]})})},Yr=q(i.jsx("path",{d:"M21 11V3h-8l3.29 3.29-10 10L3 13v8h8l-3.29-3.29 10-10z"}));class Jr{constructor(e,r){this.pixels=e,this.opts=r;const{sigBits:n}=r,o=(w,B,_)=>(w<<2*n)+(B<<n)+_;this.getColorIndex=o;const s=8-n,a=1<<3*n,l=new Uint32Array(a);let c,d,u,g,h,f,m,p,b,v;c=u=h=0,d=g=f=Number.MAX_VALUE;const C=e.length/4;let T=0;for(;T<C;){const w=T*4;if(T++,m=e[w+0],p=e[w+1],b=e[w+2],v=e[w+3],v===0)continue;m=m>>s,p=p>>s,b=b>>s;const B=o(m,p,b);l[B]===void 0&&(l[B]=0),l[B]+=1,m>c&&(c=m),m<d&&(d=m),p>u&&(u=p),p<g&&(g=p),b>h&&(h=b),b<f&&(f=b)}this._colorCount=l.reduce((w,B)=>B>0?w+1:w,0),this.hist=l,this.rmax=c,this.rmin=d,this.gmax=u,this.gmin=g,this.bmax=h,this.bmin=f}get colorCount(){return this._colorCount}}class Xr{scaleDown(e){const r=this.getWidth(),n=this.getHeight();let o=1;if(e.maxDimension>0){const s=Math.max(r,n);s>e.maxDimension&&(o=e.maxDimension/s)}else o=1/e.quality;o<1&&this.resize(r*o,n*o,o)}}function Zr(t,e){var r;if(e.length>0){const n=t.data,o=n.length/4;let s,a,l,c,d;for(let u=0;u<o;u++){s=u*4,a=n[s+0],l=n[s+1],c=n[s+2],d=n[s+3];for(let g=0;g<e.length;g++)if(!((r=e[g])!=null&&r.call(e,a,l,c,d))){n[s+3]=0;break}}}return t}function tn(t){const e=new URL(t,location.href);return e.protocol===location.protocol&&e.host===location.host&&e.port===location.port}function en(t,e){const r=new URL(t),n=new URL(e);return r.protocol===n.protocol&&r.hostname===n.hostname&&r.port===n.port}class rn extends Xr{_getCanvas(){if(!this._canvas)throw new Error("Canvas is not initialized");return this._canvas}_getContext(){if(!this._context)throw new Error("Context is not initialized");return this._context}_getWidth(){if(!this._width)throw new Error("Width is not initialized");return this._width}_getHeight(){if(!this._height)throw new Error("Height is not initialized");return this._height}_initCanvas(){const e=this.image;if(!e)throw new Error("Image is not initialized");const r=this._canvas=document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new ReferenceError("Failed to create canvas context");this._context=n,r.className="@vibrant/canvas",r.style.display="none",this._width=r.width=e.width,this._height=r.height=e.height,n.drawImage(e,0,0),document.body.appendChild(r)}load(e){let r,n;if(typeof e=="string")r=document.createElement("img"),n=e,!tn(n)&&!en(window.location.href,n)&&(r.crossOrigin="anonymous"),r.src=n;else if(e instanceof HTMLImageElement)r=e,n=e.src;else return Promise.reject(new Error("Cannot load buffer as an image in browser"));return this.image=r,new Promise((o,s)=>{const a=()=>{this._initCanvas(),o(this)};r.complete?a():(r.onload=a,r.onerror=l=>s(new Error("Fail to load image: ".concat(n))))})}clear(){this._getContext().clearRect(0,0,this._getWidth(),this._getHeight())}update(e){this._getContext().putImageData(e,0,0)}getWidth(){return this._getWidth()}getHeight(){return this._getHeight()}resize(e,r,n){if(!this.image)throw new Error("Image is not initialized");this._width=this._getCanvas().width=e,this._height=this._getCanvas().height=r,this._getContext().scale(n,n),this._getContext().drawImage(this.image,0,0)}getPixelCount(){return this._getWidth()*this._getHeight()}getImageData(){return this._getContext().getImageData(0,0,this._getWidth(),this._getHeight())}remove(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)}}function Y(t,...e){return e.forEach(r=>{if(r){for(const n in r)if(r.hasOwnProperty(n)){const o=r[n];Array.isArray(o)?t[n]=o.slice(0):typeof o=="object"?(t[n]||(t[n]={}),Y(t[n],o)):t[n]=o}}}),t}function nn(t,e){const{colorCount:r,quantizer:n,generators:o,filters:s}=t,a={colorCount:r},l=typeof n=="string"?{name:n,options:{}}:n;return l.options=Y({},a,l.options),Y({},{quantizer:l,generators:o,filters:s},e)}class on{constructor(e,r={}){this._src=e,this._opts=Y({},F.DefaultOpts,r)}maxColorCount(e){return this._opts.colorCount=e,this}maxDimension(e){return this._opts.maxDimension=e,this}addFilter(e){return this._opts.filters?this._opts.filters.push(e):this._opts.filters=[e],this}removeFilter(e){if(this._opts.filters){const r=this._opts.filters.indexOf(e);r>0&&this._opts.filters.splice(r)}return this}clearFilters(){return this._opts.filters=[],this}quality(e){return this._opts.quality=e,this}useImageClass(e){return this._opts.ImageClass=e,this}useGenerator(e,r){return this._opts.generators||(this._opts.generators=[]),this._opts.generators.push(r?{name:e,options:r}:e),this}useQuantizer(e,r){return this._opts.quantizer=r?{name:e,options:r}:e,this}build(){return new F(this._src,this._opts)}getPalette(){return this.build().getPalette()}}class ft{constructor(e){this.pipeline=e,this._map={}}names(){return Object.keys(this._map)}has(e){return!!this._map[e]}get(e){return this._map[e]}register(e,r){return this._map[e]=r,this.pipeline}}class sn{constructor(){this.filter=new ft(this),this.quantizer=new ft(this),this.generator=new ft(this)}_buildProcessTasks({filters:e,quantizer:r,generators:n}){return n.length===1&&n[0]==="*"&&(n=this.generator.names()),{filters:e.map(s=>o(this.filter,s)),quantizer:o(this.quantizer,r),generators:n.map(s=>o(this.generator,s))};function o(s,a){let l,c;return typeof a=="string"?l=a:(l=a.name,c=a.options),{name:l,fn:s.get(l),options:c}}}async process(e,r){const{filters:n,quantizer:o,generators:s}=this._buildProcessTasks(r),a=await this._filterColors(n,e),l=await this._generateColors(o,a),c=await this._generatePalettes(s,l);return{colors:l,palettes:c}}_filterColors(e,r){return Promise.resolve(Zr(r,e.map(({fn:n})=>n)))}_generateColors(e,r){return Promise.resolve(e.fn(r.data,e.options))}async _generatePalettes(e,r){const n=await Promise.all(e.map(({fn:o,options:s})=>Promise.resolve(o(r,s))));return Promise.resolve(n.reduce((o,s,a)=>(o[e[a].name]=s,o),{}))}}function an(t,e,r){return"#"+((1<<24)+(t<<16)+(e<<8)+r).toString(16).slice(1,7)}function ln(t,e,r){t/=255,e/=255,r/=255;const n=Math.max(t,e,r),o=Math.min(t,e,r);let s=0,a=0;const l=(n+o)/2;if(n!==o){const c=n-o;switch(a=l>.5?c/(2-n-o):c/(n+o),n){case t:s=(e-r)/c+(e<r?6:0);break;case e:s=(r-t)/c+2;break;case r:s=(t-e)/c+4;break}s/=6}return[s,a,l]}function O(t,e,r){let n,o,s;function a(l,c,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?l+(c-l)*6*d:d<1/2?c:d<2/3?l+(c-l)*(2/3-d)*6:l}if(e===0)n=o=s=r;else{const l=r<.5?r*(1+e):r+e-r*e,c=2*r-l;n=a(c,l,t+1/3),o=a(c,l,t),s=a(c,l,t-1/3)}return[n*255,o*255,s*255]}class D{static applyFilters(e,r){return r.length>0?e.filter(({r:n,g:o,b:s})=>{var a;for(let l=0;l<r.length;l++)if(!((a=r[l])!=null&&a.call(r,n,o,s,255)))return!1;return!0}):e}static clone(e){return new D(e._rgb,e._population)}get r(){return this._rgb[0]}get g(){return this._rgb[1]}get b(){return this._rgb[2]}get rgb(){return this._rgb}get hsl(){if(!this._hsl){const[e,r,n]=this._rgb;this._hsl=ln(e,r,n)}return this._hsl}get hex(){if(!this._hex){const[e,r,n]=this._rgb;this._hex=an(e,r,n)}return this._hex}get population(){return this._population}toJSON(){return{rgb:this.rgb,population:this.population}}getYiq(){if(!this._yiq){const e=this._rgb;this._yiq=(e[0]*299+e[1]*587+e[2]*114)/1e3}return this._yiq}get titleTextColor(){return this._titleTextColor||(this._titleTextColor=this.getYiq()<200?"#fff":"#000"),this._titleTextColor}get bodyTextColor(){return this._bodyTextColor||(this._bodyTextColor=this.getYiq()<150?"#fff":"#000"),this._bodyTextColor}constructor(e,r){this._rgb=e,this._population=r}}const ie=class _t{constructor(e,r){this._src=e,this.opts=Y({},_t.DefaultOpts,r)}static use(e){this._pipeline=e}static from(e){return new on(e)}get result(){return this._result}_process(e,r){e.scaleDown(this.opts);const n=nn(this.opts,r);return _t._pipeline.process(e.getImageData(),n)}async getPalette(){const e=new this.opts.ImageClass;try{const r=await e.load(this._src),n=await this._process(r,{generators:["default"]});this._result=n;const o=n.palettes.default;if(!o)throw new Error("Something went wrong and a palette was not found, please file a bug against our GitHub repo: https://github.com/vibrant-Colors/node-vibrant/");return e.remove(),o}catch(r){return e.remove(),Promise.reject(r)}}async getPalettes(){const e=new this.opts.ImageClass;try{const r=await e.load(this._src),n=await this._process(r,{generators:["*"]});this._result=n;const o=n.palettes;return e.remove(),o}catch(r){return e.remove(),Promise.reject(r)}}};ie.DefaultOpts={colorCount:64,quality:5,filters:[]};let F=ie;F.DefaultOpts.quantizer="mmcq";F.DefaultOpts.generators=["default"];F.DefaultOpts.filters=["default"];F.DefaultOpts.ImageClass=rn;const jt=5,pt=8-jt;class dt{constructor(e,r,n,o,s,a,l){this.histogram=l,this._volume=-1,this._avg=null,this._count=-1,this.dimension={r1:e,r2:r,g1:n,g2:o,b1:s,b2:a}}static build(e){const r=new Jr(e,{sigBits:jt}),{rmin:n,rmax:o,gmin:s,gmax:a,bmin:l,bmax:c}=r;return new dt(n,o,s,a,l,c,r)}invalidate(){this._volume=this._count=-1,this._avg=null}volume(){if(this._volume<0){const{r1:e,r2:r,g1:n,g2:o,b1:s,b2:a}=this.dimension;this._volume=(r-e+1)*(o-n+1)*(a-s+1)}return this._volume}count(){if(this._count<0){const{hist:e,getColorIndex:r}=this.histogram,{r1:n,r2:o,g1:s,g2:a,b1:l,b2:c}=this.dimension;let d=0;for(let u=n;u<=o;u++)for(let g=s;g<=a;g++)for(let h=l;h<=c;h++){const f=r(u,g,h);e[f]&&(d+=e[f])}this._count=d}return this._count}clone(){const{histogram:e}=this,{r1:r,r2:n,g1:o,g2:s,b1:a,b2:l}=this.dimension;return new dt(r,n,o,s,a,l,e)}avg(){if(!this._avg){const{hist:e,getColorIndex:r}=this.histogram,{r1:n,r2:o,g1:s,g2:a,b1:l,b2:c}=this.dimension;let d=0;const u=1<<8-jt;let g,h,f;g=h=f=0;for(let m=n;m<=o;m++)for(let p=s;p<=a;p++)for(let b=l;b<=c;b++){const v=r(m,p,b),C=e[v];C&&(d+=C,g+=C*(m+.5)*u,h+=C*(p+.5)*u,f+=C*(b+.5)*u)}d?this._avg=[~~(g/d),~~(h/d),~~(f/d)]:this._avg=[~~(u*(n+o+1)/2),~~(u*(s+a+1)/2),~~(u*(l+c+1)/2)]}return this._avg}contains(e){let[r,n,o]=e;const{r1:s,r2:a,g1:l,g2:c,b1:d,b2:u}=this.dimension;return r>>=pt,n>>=pt,o>>=pt,r>=s&&r<=a&&n>=l&&n<=c&&o>=d&&o<=u}split(){const{hist:e,getColorIndex:r}=this.histogram,{r1:n,r2:o,g1:s,g2:a,b1:l,b2:c}=this.dimension,d=this.count();if(!d)return[];if(d===1)return[this.clone()];const u=o-n+1,g=a-s+1,h=c-l+1,f=Math.max(u,g,h);let m=null,p,b;p=b=0;let v=null;if(f===u){v="r",m=new Uint32Array(o+1);for(let _=n;_<=o;_++){p=0;for(let y=s;y<=a;y++)for(let S=l;S<=c;S++){const L=r(_,y,S);e[L]&&(p+=e[L])}b+=p,m[_]=b}}else if(f===g){v="g",m=new Uint32Array(a+1);for(let _=s;_<=a;_++){p=0;for(let y=n;y<=o;y++)for(let S=l;S<=c;S++){const L=r(y,_,S);e[L]&&(p+=e[L])}b+=p,m[_]=b}}else{v="b",m=new Uint32Array(c+1);for(let _=l;_<=c;_++){p=0;for(let y=n;y<=o;y++)for(let S=s;S<=a;S++){const L=r(y,S,_);e[L]&&(p+=e[L])}b+=p,m[_]=b}}let C=-1;const T=new Uint32Array(m.length);for(let _=0;_<m.length;_++){const y=m[_];y&&(C<0&&y>b/2&&(C=_),T[_]=b-y)}const w=this;function B(_){const y=_+"1",S=_+"2",L=w.dimension[y];let I=w.dimension[S];const J=w.clone(),X=w.clone(),M=C-L,P=I-C;for(M<=P?(I=Math.min(I-1,~~(C+P/2)),I=Math.max(0,I)):(I=Math.max(L,~~(C-1-M/2)),I=Math.min(w.dimension[S],I));!m[I];)I++;let Z=T[I];for(;!Z&&m[I-1];)Z=T[--I];return J.dimension[S]=I,X.dimension[y]=I+1,[J,X]}return B(v)}}class Et{_sort(){this._sorted||(this.contents.sort(this._comparator),this._sorted=!0)}constructor(e){this._comparator=e,this.contents=[],this._sorted=!1}push(e){this.contents.push(e),this._sorted=!1}peek(e){return this._sort(),e=typeof e=="number"?e:this.contents.length-1,this.contents[e]}pop(){return this._sort(),this.contents.pop()}size(){return this.contents.length}map(e){return this._sort(),this.contents.map(e)}}const cn=.75;function At(t,e){let r=t.size();for(;t.size()<e;){const n=t.pop();if(n&&n.count()>0){const[o,s]=n.split();if(!o||(t.push(o),s&&s.count()>0&&t.push(s),t.size()===r))break;r=t.size()}else break}}const un=(t,e)=>{if(t.length===0||e.colorCount<2||e.colorCount>256)throw new Error("Wrong MMCQ parameters");const r=dt.build(t);r.histogram.colorCount;const n=new Et((s,a)=>s.count()-a.count());n.push(r),At(n,cn*e.colorCount);const o=new Et((s,a)=>s.count()*s.volume()-a.count()*a.volume());return o.contents=n.contents,At(o,e.colorCount-o.size()),dn(o)};function dn(t){const e=[];for(;t.size();){const r=t.pop(),n=r.avg();e.push(new D(n,r.count()))}return e}const hn={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function gn(t){let e=0;return t.forEach(r=>{e=Math.max(e,r.population)}),e}function mn(t,e){return t.Vibrant===e||t.DarkVibrant===e||t.LightVibrant===e||t.Muted===e||t.DarkMuted===e||t.LightMuted===e}function fn(t,e,r,n,o,s,a){function l(...d){let u=0,g=0;for(let h=0;h<d.length;h+=2){const f=d[h],m=d[h+1];!f||!m||(u+=f*m,g+=m)}return u/g}function c(d,u){return 1-Math.abs(d-u)}return l(c(t,e),a.weightSaturation,c(r,n),a.weightLuma,o/s,a.weightPopulation)}function W(t,e,r,n,o,s,a,l,c,d){let u=null,g=0;return e.forEach(h=>{const[,f,m]=h.hsl;if(f>=l&&f<=c&&m>=o&&m<=s&&!mn(t,h)){const p=fn(f,a,m,n,h.population,r,d);(u===null||p>g)&&(u=h,g=p)}}),u}function pn(t,e,r){const n={Vibrant:null,DarkVibrant:null,LightVibrant:null,Muted:null,DarkMuted:null,LightMuted:null};return n.Vibrant=W(n,t,e,r.targetNormalLuma,r.minNormalLuma,r.maxNormalLuma,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.LightVibrant=W(n,t,e,r.targetLightLuma,r.minLightLuma,1,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.DarkVibrant=W(n,t,e,r.targetDarkLuma,0,r.maxDarkLuma,r.targetVibrantSaturation,r.minVibrantSaturation,1,r),n.Muted=W(n,t,e,r.targetNormalLuma,r.minNormalLuma,r.maxNormalLuma,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n.LightMuted=W(n,t,e,r.targetLightLuma,r.minLightLuma,1,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n.DarkMuted=W(n,t,e,r.targetDarkLuma,0,r.maxDarkLuma,r.targetMutesSaturation,0,r.maxMutesSaturation,r),n}function bn(t,e,r){if(!t.Vibrant&&!t.DarkVibrant&&!t.LightVibrant){if(!t.DarkVibrant&&t.DarkMuted){let[n,o,s]=t.DarkMuted.hsl;s=r.targetDarkLuma,t.DarkVibrant=new D(O(n,o,s),0)}if(!t.LightVibrant&&t.LightMuted){let[n,o,s]=t.LightMuted.hsl;s=r.targetDarkLuma,t.DarkVibrant=new D(O(n,o,s),0)}}if(!t.Vibrant&&t.DarkVibrant){let[n,o,s]=t.DarkVibrant.hsl;s=r.targetNormalLuma,t.Vibrant=new D(O(n,o,s),0)}else if(!t.Vibrant&&t.LightVibrant){let[n,o,s]=t.LightVibrant.hsl;s=r.targetNormalLuma,t.Vibrant=new D(O(n,o,s),0)}if(!t.DarkVibrant&&t.Vibrant){let[n,o,s]=t.Vibrant.hsl;s=r.targetDarkLuma,t.DarkVibrant=new D(O(n,o,s),0)}if(!t.LightVibrant&&t.Vibrant){let[n,o,s]=t.Vibrant.hsl;s=r.targetLightLuma,t.LightVibrant=new D(O(n,o,s),0)}if(!t.Muted&&t.Vibrant){let[n,o,s]=t.Vibrant.hsl;s=r.targetMutesSaturation,t.Muted=new D(O(n,o,s),0)}if(!t.DarkMuted&&t.DarkVibrant){let[n,o,s]=t.DarkVibrant.hsl;s=r.targetMutesSaturation,t.DarkMuted=new D(O(n,o,s),0)}if(!t.LightMuted&&t.LightVibrant){let[n,o,s]=t.LightVibrant.hsl;s=r.targetMutesSaturation,t.LightMuted=new D(O(n,o,s),0)}}const xn=(t,e)=>{e=Object.assign({},hn,e);const r=gn(t),n=pn(t,r,e);return bn(n,r,e),n},vn=new sn().filter.register("default",(t,e,r,n)=>n>=125&&!(t>250&&e>250&&r>250)).quantizer.register("mmcq",un).generator.register("default",xn);F.use(vn);function Cn(t){var e=t.toString(16);return e.length===1?"0"+e:e}function Vt(t){return"#"+t.map(Cn).join("")}function _n(t){var e=(t[0]*299+t[1]*587+t[2]*114)/1e3;return e<128}function jn(t){return t?wn(t)?t:[t]:[]}function wn(t){return Array.isArray(t[0])}function yt(t,e,r){for(var n=0;n<r.length;n++)if(yn(t,e,r[n]))return!0;return!1}function yn(t,e,r){switch(r.length){case 3:if(Sn(t,e,r))return!0;break;case 4:if(Mn(t,e,r))return!0;break;case 5:if(kn(t,e,r))return!0;break;default:return!1}}function Sn(t,e,r){return t[e+3]!==255||t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]}function Mn(t,e,r){return t[e+3]&&r[3]?t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]&&t[e+3]===r[3]:t[e+3]===r[3]}function nt(t,e,r){return t>=e-r&&t<=e+r}function kn(t,e,r){var n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],c=t[e+3],d=nt(c,a,l);return a?!!(!c&&d||nt(t[e],n,l)&&nt(t[e+1],o,l)&&nt(t[e+2],s,l)&&d):d}var In=24;function Ln(t,e,r){for(var n={},o=r.dominantDivider||In,s=r.ignoredColor,a=r.step,l=[0,0,0,0,0],c=0;c<e;c+=a){var d=t[c],u=t[c+1],g=t[c+2],h=t[c+3];if(!(s&&yt(t,c,s))){var f=Math.round(d/o)+","+Math.round(u/o)+","+Math.round(g/o);n[f]?n[f]=[n[f][0]+d*h,n[f][1]+u*h,n[f][2]+g*h,n[f][3]+h,n[f][4]+1]:n[f]=[d*h,u*h,g*h,h,1],l[4]<n[f][4]&&(l=n[f])}}var m=l[0],p=l[1],b=l[2],v=l[3],C=l[4];return v?[Math.round(m/v),Math.round(p/v),Math.round(b/v),Math.round(v/C)]:r.defaultColor}function Tn(t,e,r){for(var n=0,o=0,s=0,a=0,l=0,c=r.ignoredColor,d=r.step,u=0;u<e;u+=d){var g=t[u+3],h=t[u]*g,f=t[u+1]*g,m=t[u+2]*g;c&&yt(t,u,c)||(n+=h,o+=f,s+=m,a+=g,l++)}return a?[Math.round(n/a),Math.round(o/a),Math.round(s/a),Math.round(a/l)]:r.defaultColor}function Bn(t,e,r){for(var n=0,o=0,s=0,a=0,l=0,c=r.ignoredColor,d=r.step,u=0;u<e;u+=d){var g=t[u],h=t[u+1],f=t[u+2],m=t[u+3];c&&yt(t,u,c)||(n+=g*g*m,o+=h*h*m,s+=f*f*m,a+=m,l++)}return a?[Math.round(Math.sqrt(n/a)),Math.round(Math.sqrt(o/a)),Math.round(Math.sqrt(s/a)),Math.round(a/l)]:r.defaultColor}function $t(t){return K(t,"defaultColor",[0,0,0,0])}function K(t,e,r){return t[e]===void 0?r:t[e]}var Ot=10,wt=100;function Rn(t){return t.search(/\.svg(\?|$)/i)!==-1}function Dn(t){if(oe(t)){var e=t.naturalWidth,r=t.naturalHeight;return!t.naturalWidth&&Rn(t.src)&&(e=r=wt),{width:e,height:r}}return An(t)?{width:t.videoWidth,height:t.videoHeight}:ae(t)?{width:t.codedWidth,height:t.codedHeight}:{width:t.width,height:t.height}}function Ht(t){return Vn(t)?"canvas":En(t)?"offscreencanvas":ae(t)?"videoframe":$n(t)?"imagebitmap":t.src}function oe(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement}var se=typeof OffscreenCanvas<"u";function En(t){return se&&t instanceof OffscreenCanvas}function An(t){return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement}function ae(t){return typeof VideoFrame<"u"&&t instanceof VideoFrame}function Vn(t){return typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement}function $n(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap}function On(t,e){var r=K(e,"left",0),n=K(e,"top",0),o=K(e,"width",t.width),s=K(e,"height",t.height),a=o,l=s;if(e.mode==="precision")return{srcLeft:r,srcTop:n,srcWidth:o,srcHeight:s,destWidth:a,destHeight:l};var c;return o>s?(c=o/s,a=wt,l=Math.round(a/c)):(c=s/o,l=wt,a=Math.round(l/c)),(a>o||l>s||a<Ot||l<Ot)&&(a=o,l=s),{srcLeft:r,srcTop:n,srcWidth:o,srcHeight:s,destWidth:a,destHeight:l}}var Hn=typeof window>"u";function Fn(){return Hn?se?new OffscreenCanvas(1,1):null:document.createElement("canvas")}var zn="FastAverageColor: ";function $(t){return Error(zn+t)}function Q(t,e){e||console.error(t)}var Pn=function(){function t(){this.canvas=null,this.ctx=null}return t.prototype.getColorAsync=function(e,r){if(!e)return Promise.reject($("call .getColorAsync() without resource"));if(typeof e=="string"){if(typeof Image>"u")return Promise.reject($("resource as string is not supported in this environment"));var n=new Image;return n.crossOrigin=r&&r.crossOrigin||"",n.src=e,this.bindImageEvents(n,r)}else{if(oe(e)&&!e.complete)return this.bindImageEvents(e,r);var o=this.getColor(e,r);return o.error?Promise.reject(o.error):Promise.resolve(o)}},t.prototype.getColor=function(e,r){r=r||{};var n=$t(r);if(!e){var o=$("call .getColor() without resource");return Q(o,r.silent),this.prepareResult(n,o)}var s=Dn(e),a=On(s,r);if(!a.srcWidth||!a.srcHeight||!a.destWidth||!a.destHeight){var o=$('incorrect sizes for resource "'.concat(Ht(e),'"'));return Q(o,r.silent),this.prepareResult(n,o)}if(!this.canvas&&(this.canvas=Fn(),!this.canvas)){var o=$("OffscreenCanvas is not supported in this browser");return Q(o,r.silent),this.prepareResult(n,o)}if(!this.ctx){if(this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),!this.ctx){var o=$("Canvas Context 2D is not supported in this browser");return Q(o,r.silent),this.prepareResult(n)}this.ctx.imageSmoothingEnabled=!1}this.canvas.width=a.destWidth,this.canvas.height=a.destHeight;try{this.ctx.clearRect(0,0,a.destWidth,a.destHeight),this.ctx.drawImage(e,a.srcLeft,a.srcTop,a.srcWidth,a.srcHeight,0,0,a.destWidth,a.destHeight);var l=this.ctx.getImageData(0,0,a.destWidth,a.destHeight).data;return this.prepareResult(this.getColorFromArray4(l,r))}catch(c){var o=$("security error (CORS) for resource ".concat(Ht(e),".\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image"));return Q(o,r.silent),r.silent||console.error(c),this.prepareResult(n,o)}},t.prototype.getColorFromArray4=function(e,r){r=r||{};var n=4,o=e.length,s=$t(r);if(o<n)return s;var a=o-o%n,l=(r.step||1)*n,c;switch(r.algorithm||"sqrt"){case"simple":c=Tn;break;case"sqrt":c=Bn;break;case"dominant":c=Ln;break;default:throw $("".concat(r.algorithm," is unknown algorithm"))}return c(e,a,{defaultColor:s,ignoredColor:jn(r.ignoredColor),step:l,dominantDivider:r.dominantDivider})},t.prototype.prepareResult=function(e,r){var n=e.slice(0,3),o=[e[0],e[1],e[2],e[3]/255],s=_n(e);return{value:[e[0],e[1],e[2],e[3]],rgb:"rgb("+n.join(",")+")",rgba:"rgba("+o.join(",")+")",hex:Vt(n),hexa:Vt(e),isDark:s,isLight:!s,error:r}},t.prototype.destroy=function(){this.canvas&&(this.canvas.width=1,this.canvas.height=1,this.canvas=null),this.ctx=null},t.prototype.bindImageEvents=function(e,r){var n=this;return new Promise(function(o,s){var a=function(){d();var u=n.getColor(e,r);u.error?s(u.error):o(u)},l=function(){d(),s($('Error loading image "'.concat(e.src,'"')))},c=function(){d(),s($('Image "'.concat(e.src,'" loading aborted')))},d=function(){e.removeEventListener("load",a),e.removeEventListener("error",l),e.removeEventListener("abort",c)};e.addEventListener("load",a),e.addEventListener("error",l),e.addEventListener("abort",c)})},t}();const Wn=({manga:t,mangaDynamicColorSchemes:e})=>{const r=Xt(),{setDynamicColor:n}=Zt(),o=Gt({variant:"popover",popupId:"manga-thumbnail-fullscreen"}),[s,a]=j.useState(!1);return j.useLayoutEffect(()=>{if(!e)return()=>{};const l=new Image;return l.crossOrigin="anonymous",l.src=G.getThumbnailUrl(t),l.onload=()=>{const c=l.width>600&&l.height>900;Promise.all([F.from(l).getPalette(),new Pn().getColor(l,{algorithm:"dominant",mode:c?"speed":"precision",ignoredColor:[[255,255,255,255,75],[0,0,0,255,75]]})]).then(([d,u])=>{!d.Vibrant||!d.DarkVibrant||!d.LightVibrant||!d.LightMuted||!d.Muted||!d.DarkMuted||n({...d,average:u})})},()=>{n(null)}},[]),i.jsxs(i.Fragment,{children:[i.jsxs(k,{sx:{position:"relative",borderRadius:1,overflow:"hidden",backgroundColor:"background.paper",width:"150px",maxHeight:"fit-content",aspectRatio:Cr,flexShrink:0,flexGrow:0,[r.breakpoints.up("lg")]:{width:"200px"},[r.breakpoints.up("xl")]:{width:"300px"}},children:[i.jsx(vt,{src:G.getThumbnailUrl(t),alt:"Manga Thumbnail",onLoad:()=>a(!0),imgStyle:{width:"100%",height:"100%",objectFit:"cover"}}),s&&i.jsx(k,{...ht(o),sx:{position:"absolute",top:0,bottom:0,width:"100%",justifyContent:"center",alignItems:"center",opacity:0,"&:hover":{background:"rgba(0, 0, 0, 0.4)",cursor:"pointer",opacity:1}},children:i.jsx(Yr,{fontSize:"large",color:"primary"})})]}),i.jsx(ke,{...Ie(o),sx:{outline:0},children:i.jsx(k,{onClick:()=>o.close(),sx:{height:"100vh",p:2,outline:0,justifyContent:"center",alignItems:"center"},children:i.jsx(vt,{src:G.getThumbnailUrl(t),alt:"Manga Thumbnail",imgStyle:{height:"100%",width:"100%",objectFit:"contain"}})})})]})},St=({query:t,sourceId:e,mode:r,children:n})=>{const o=r==="source"&&e!==void 0?N.sources.childRoutes.browse.path(e,t):r==="source.global-search"?N.sources.childRoutes.searchAll.path(t):N.library.path(void 0,t);return i.jsx(Ct,{component:at,to:o,sx:{textDecoration:"none",color:"inherit"},children:n!=null?n:t})},Ft="35px",zt=75,Nn=({manga:{description:t,genre:e,sourceId:r},mode:n})=>{const[o,s]=j.useState(null),[a,l]=j.useState();Qt(o,j.useCallback(()=>l(o==null?void 0:o.clientHeight),[o]));const[c,d]=Le("isDescriptionGenreCollapsed",!0),u=t?Math.min(zt,a!=null?a:zt):0,g=j.useMemo(()=>e.filter(Boolean),[e]);return i.jsxs(i.Fragment,{children:[t&&i.jsxs(k,{sx:{position:"relative"},children:[i.jsx(Te,{collapsedSize:u,in:!c,children:i.jsx(ct,{ref:s,sx:{whiteSpace:"pre-line",textAlign:"justify",textJustify:"inter-word",mb:Ft},children:t})}),i.jsx(k,{onClick:()=>d(!c),sx:{justifyContent:"flex-start",alignItems:"center",cursor:"pointer",position:"absolute",width:"100%",height:Ft,bottom:0,background:h=>"linear-gradient(transparent -15px, ".concat(h.palette.background.default,")")},children:i.jsx(E,{sx:{color:h=>h.palette.mode==="light"?"black":"text"},children:c?i.jsx(yr,{}):i.jsx(Sr,{})})})]}),i.jsx(k,{sx:{flexDirection:"row",flexWrap:c?"no-wrap":"wrap",gap:1,overflowX:c?"auto":null},children:g.map(h=>i.jsx(St,{query:h,sourceId:r,mode:n,children:i.jsx(Mr,{label:h,variant:"outlined",onClick:()=>{}})},h))})]})},Gn=z("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(2),padding:t.spacing(1),[t.breakpoints.up("md")]:{flexBasis:"40%",height:"calc(100vh - 64px)",overflowY:"auto"}})),Un=({url:t,mangaThumbnailBackdrop:e,children:r})=>i.jsxs(k,{sx:{position:"relative"},children:[e&&i.jsxs(i.Fragment,{children:[i.jsx(vt,{spinnerStyle:{display:"none"},imgStyle:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"},src:t,alt:"Manga Thumbnail"}),i.jsx(k,{sx:{"&::before":n=>Be(e,{position:"absolute",display:"inline-block",content:'""',top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(to top, ".concat(n.palette.background.default,", transparent 100%, transparent 1px),linear-gradient(to right, ").concat(n.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to bottom, ").concat(n.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to left, ").concat(n.palette.background.default,", transparent 50%, transparent 1px)"),backdropFilter:"blur(4.5px) brightness(0.75)"})}})]}),r]}),qn=z("div")(({theme:t})=>({display:"flex",paddingBottom:t.spacing(1)})),Qn=z("div")(({theme:t})=>({zIndex:1,marginLeft:t.spacing(1)})),it=t=>i.jsx(wr,{...t}),Kn=z("div")(({theme:t})=>({display:"flex",gap:t.spacing(1)})),Yn=({url:t})=>{const{t:e}=V();return i.jsxs(qr,{children:[i.jsx(A,{title:e("global.button.open_browser"),disabled:!t,children:i.jsx(Tt,{size:"medium",disabled:!t,component:Ct,href:t!=null?t:void 0,target:"_blank",rel:"noreferrer",variant:"outlined",children:i.jsx(fr,{})})}),i.jsx(A,{title:e("global.button.open_webview"),disabled:!t,children:i.jsx(Tt,{size:"medium",disabled:!t,component:Ct,href:t?U.getWebviewUrl(t):void 0,target:"_blank",rel:"noreferrer",variant:"outlined",children:i.jsx(vr,{})})})]})};function Jn(t){var e;return t?Re.isLocalSource(t)?xt("source.local_source.title"):(e=t.displayName)!=null?e:t.id:xt("global.label.unknown")}const Pt=(t,e,r)=>t==null?void 0:t.map(n=>i.jsx(St,{query:n,sourceId:e,mode:r},n)).reduce((n,o)=>i.jsxs(i.Fragment,{children:[n,", ",o]})),Xn=({manga:t,mode:e})=>{var l,c;const{t:r}=V(),{settings:{mangaThumbnailBackdrop:n,mangaDynamicColorSchemes:o}}=te();j.useEffect(()=>{t.source||ut(xt("source.error.label.source_not_found"),"error")},[t.source]);const{updateLibraryState:s}=tr(t),a=async()=>{try{await navigator.clipboard.writeText(t.title),ut(r("global.label.copied_clipboard"),"info")}catch(d){}};return i.jsxs(Gn,{children:[i.jsxs(Un,{url:G.getThumbnailUrl(t),mangaThumbnailBackdrop:n,children:[i.jsxs(qn,{children:[i.jsx(Wn,{manga:t,mangaDynamicColorSchemes:o}),i.jsxs(Qn,{children:[i.jsxs(k,{sx:{flexDirection:"row",gap:1,alignItems:"flex-start",mb:1},children:[i.jsx(St,{query:t.title,sourceId:t.sourceId,mode:"source.global-search",children:i.jsx(ct,{variant:"h5",component:"h2",sx:{wordBreak:"break-word"},children:t.title})}),i.jsx(A,{title:r("global.button.copy"),children:i.jsx(E,{onClick:a,color:"inherit",children:i.jsx(Pr,{fontSize:"small"})})})]}),t.author&&i.jsx(it,{title:r("manga.label.author"),value:Pt(G.getAuthors(t),(l=t.source)==null?void 0:l.id,e)}),t.artist&&i.jsx(it,{title:r("manga.label.artist"),value:Pt(G.getArtists(t),(c=t.source)==null?void 0:c.id,e)}),i.jsx(it,{title:r("manga.label.status"),value:r(_r[t.status])}),i.jsx(it,{title:r("source.title_one"),value:Jn(t.source)})]})]}),i.jsxs(Kn,{children:[i.jsxs(ne,{size:"medium",onClick:s,variant:t.inLibrary?"contained":"outlined",children:[t.inLibrary?i.jsx(xr,{}):i.jsx(er,{}),t.inLibrary?r("manga.button.in_library"):r("manga.button.add_to_library")]}),i.jsx(Kr,{manga:t}),i.jsx(Yn,{url:t.realUrl})]})]}),i.jsx(Nn,{manga:t,mode:e})]})},Wt=q(i.jsx("path",{d:"M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8m-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12m3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8m5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8m3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"})),Zn=({manga:t,onRefresh:e,refreshing:r})=>{const{t:n}=V(),o=Xt(),s=De(o.breakpoints.up("sm")),{settings:a}=te(),{dynamicColor:l,appTheme:c,shouldUsePureBlackMode:d,themeMode:u}=Zt(),[g,h]=Ee.useState(null),f=!!g,m=()=>{h(null)},p=()=>{kt.show(rr,{mangaId:t.id})},b=()=>{kt.show(kr,{mode:"save_dynamic",appTheme:{id:"",getName:()=>"",isCustom:!0,muiTheme:Ve($e(c,a.customThemes).muiTheme,l,d,bt.getThemeMode(u))}})};return i.jsxs(i.Fragment,{children:[s&&i.jsxs(i.Fragment,{children:[i.jsx(A,{title:n("manga.label.reload_from_source"),disabled:r,children:i.jsx(E,{onClick:()=>{e()},disabled:r,color:"inherit",children:i.jsx(Rt,{})})}),a.mangaDynamicColorSchemes&&i.jsx(A,{title:n("settings.appearance.manga_dynamic_color_schemes.save"),children:i.jsx(E,{onClick:b,color:"inherit",children:i.jsx(Wt,{})})}),t.inLibrary&&i.jsxs(i.Fragment,{children:[i.jsx(A,{title:n("global.button.migrate"),children:i.jsx(at,{to:N.migrate.childRoutes.search.path(t.sourceId,t.id,t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:i.jsx(E,{color:"inherit",children:i.jsx(It,{})})})}),i.jsx(A,{title:n("manga.label.edit_categories"),children:i.jsx(E,{onClick:()=>{p()},color:"inherit",children:i.jsx(Lt,{})})})]})]}),!s&&i.jsxs(i.Fragment,{children:[i.jsx(E,{id:"chaptersMenuButton","aria-controls":f?"chaptersMenu":void 0,"aria-haspopup":"true","aria-expanded":f?"true":void 0,onClick:v=>h(v.currentTarget),color:"inherit",children:i.jsx(Ae,{})}),i.jsxs(qt,{id:"chaptersMenu",anchorEl:g,open:f,onClose:m,MenuListProps:{"aria-labelledby":"chaptersMenuButton"},children:[i.jsxs(tt,{onClick:()=>{e(),m()},disabled:r,children:[i.jsx(et,{children:i.jsx(Rt,{fontSize:"small"})}),i.jsx(rt,{children:n("manga.label.reload_from_source")})]}),a.mangaDynamicColorSchemes&&i.jsxs(tt,{onClick:b,children:[i.jsx(et,{children:i.jsx(Wt,{fontSize:"small"})}),i.jsx(rt,{children:n("settings.appearance.manga_dynamic_color_schemes.save")})]}),t.inLibrary&&[i.jsxs(tt,{component:at,to:N.migrate.childRoutes.search.path(t.sourceId,t.id,t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:[i.jsx(et,{children:i.jsx(It,{fontSize:"small"})}),i.jsx(rt,{children:n("migrate.title")})]},"migrate"),i.jsxs(tt,{onClick:()=>{p(),m()},children:[i.jsx(et,{children:i.jsx(Lt,{fontSize:"small"})}),i.jsx(rt,{children:n("manga.label.edit_categories")})]},"categories")]]})]})]})},ro=()=>{var p,b;const{t}=V(),{id:e}=Oe(),{mode:r}=(p=He().state)!=null?p:{},n=j.useRef(!1),{data:o,error:s,loading:a,networkStatus:l,refetch:c}=U.useGetManga(Fe,e),d=ze(l),u=o==null?void 0:o.manga,[g,{loading:h,error:f}]=zr(e),m=s!=null?s:f;return j.useEffect(()=>{if(u==null)return;!n.current&&!u.initialized&&(n.current=!0,g())},[u]),Ir((b=u==null?void 0:u.title)!=null?b:t("manga.title_one"),i.jsxs(k,{direction:"row",sx:{alignItems:"center"},children:[m&&!d&&!h&&i.jsx(A,{title:i.jsxs(i.Fragment,{children:[t("manga.error.label.request_failure"),i.jsx("br",{}),lt(m)]}),children:i.jsx(E,{onClick:()=>c(),children:i.jsx(Tr,{color:"error"})})}),u&&(h||d)&&i.jsx(E,{disabled:!0,children:i.jsx(Pe,{size:16})}),u&&i.jsx(Zn,{manga:u,onRefresh:g,refreshing:h})]}),[t,m,d,h,u,g]),m&&!u?i.jsx(st,{message:t("manga.error.label.request_failure"),messageExtra:lt(m)}):i.jsxs(Yt,{sx:{display:{md:"flex"},overflow:"hidden"},children:[a&&i.jsx(Kt,{}),u&&i.jsx(Xn,{manga:u,mode:r}),u&&i.jsx(Fr,{manga:u,isRefreshing:h})]})};export{ro as Manga};
