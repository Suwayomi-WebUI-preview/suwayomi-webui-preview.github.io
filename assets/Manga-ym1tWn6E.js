import{r as L,i as A,j as e,u as y,o as Fe,c as x,p as Ce,h as _e,q as we,t as ne,S as w,L as H,T as G,v as Oe,f as T,I as R,w as oe,x as ye,y as Ne,z as U,s as I,a as z,g as Ie,E as q,A as Me,B as Re,b as ze,e as Pe,D as We,C as Ee,m as se,F as Ve,R as qe,H as be,J as X,K as Z,O as ee,N as He,Q as Ge,U as Ue,V as Ke}from"./index-Dk3evM22.js";import{C as Qe,a as Je,V as Ye}from"./index-l5SbcfCU.js";import{M as $,d as Xe,a as Ze,b as et,c as tt,e as rt,f as at,J as Se,g as st,h as nt,u as ot,C as lt,T as it,i as dt,j as ct,k as ut,l as ht,m as je,n as ke}from"./useManageMangaLibraryState-C2muUN_t.js";import{D as pt}from"./DownloadStateIndicator-DNiva5jx.js";import{d as mt}from"./Delete-vNDXq9Mw.js";import{C as v,a as ft}from"./Chapters-BrKnupEp.js";import{C as gt,T as xt}from"./TypographyMaxLines-DqqMyla0.js";import{C as bt}from"./Checkbox-Dg3iacm0.js";import{d as jt}from"./PlayArrow-Cs6TdtDL.js";import{S as kt,D as vt}from"./StyledFab-DMKwIkYi.js";import{d as Ct}from"./FilterList-CHjJ3ggE.js";import{S as _t,R as ve}from"./SortRadioInput-BajEfFGY.js";import{T as te}from"./ThreeStateCheckboxInput-BsVY_tTx.js";import{O as wt,a as yt,S as It,d as Mt}from"./SelectionFAB-JvhfXm0x.js";import{R as Rt}from"./ListPreference-CGDX4hiE.js";import{d as St}from"./Favorite-DQ47f1ko.js";import{M as $t}from"./Mangas-DjdaaETO.js";import{S as Tt}from"./SpinnerImage-DwAMaCI3.js";import{d as Bt}from"./Sync-CFQniJco.js";import{T as re}from"./Trackers-y2kGZe-r.js";import{L as Dt}from"./Link-F3Dk8mwd.js";import"./Avatar-BV6wLhu-.js";import"./Info-hMvXlY1W.js";import"./TextField-BrUu_0I2.js";import"./InputAdornment-D4bngkVQ.js";import"./Collapse-BQSfT_wp.js";import"./NumberSetting-BdHRoB9V.js";import"./useMobilePicker-DiSzu7Fq.js";import"./Chip-CaShj2-o.js";import"./SelectSetting-1EgEuYIm.js";import"./Select-D7gXRjDY.js";import"./CheckboxInput-Bv0Ihyt3.js";import"./SwitchBase-CIJZyjD0.js";import"./Tabs-1N-TkL8I.js";var le={},Lt=A;Object.defineProperty(le,"__esModule",{value:!0});var $e=le.default=void 0,At=Lt(L()),Ft=e;$e=le.default=(0,At.default)((0,Ft.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");var ie={},Ot=A;Object.defineProperty(ie,"__esModule",{value:!0});var de=ie.default=void 0,Nt=Ot(L()),zt=e;de=ie.default=(0,Nt.default)((0,zt.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll");var ce={},Pt=A;Object.defineProperty(ce,"__esModule",{value:!0});var Te=ce.default=void 0,Wt=Pt(L()),Et=e;Te=ce.default=(0,Wt.default)((0,Et.jsx)("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"}),"Bookmark");var ue={},Vt=A;Object.defineProperty(ue,"__esModule",{value:!0});var Be=ue.default=void 0,qt=Vt(L()),Ht=e;Be=ue.default=(0,qt.default)((0,Ht.jsx)("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"}),"BookmarkRemove");var he={},Gt=A;Object.defineProperty(he,"__esModule",{value:!0});var De=he.default=void 0,Ut=Gt(L()),Kt=e;De=he.default=(0,Ut.default)((0,Kt.jsx)("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"}),"BookmarkAdd");var pe={},Qt=A;Object.defineProperty(pe,"__esModule",{value:!0});var me=pe.default=void 0,Jt=Qt(L()),Yt=e;me=pe.default=(0,Jt.default)((0,Yt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39"}),"Public");class C{static getChapters(r){return r.map(({chapter:a})=>a)}static getIds(r){return v.getIds(C.getChapters(r))}static getDownloaded(r){return r.filter(({chapter:a})=>v.isDownloaded(a))}static getDeletable(r,a){return r.filter(({chapter:s})=>v.isDeletable(s,a))}static getNonDownloaded(r){return r.filter(({chapter:a})=>!v.isDownloaded(a))}static getDownloadable(r){return r.filter(({chapter:a,downloadChapter:s})=>!v.isDownloaded(a)&&!s)}static getBookmarked(r){return r.filter(({chapter:a})=>v.isBookmarked(a))}static getNonBookmarked(r){return r.filter(({chapter:a})=>!v.isBookmarked(a))}static getRead(r){return r.filter(({chapter:a})=>v.isRead(a))}static getNonRead(r){return r.filter(({chapter:a})=>!v.isRead(a))}}const Le=({chapter:t,allChapters:r,handleSelection:a,canBeDownloaded:s=!1,selectedChapters:n=[],onClose:o})=>{const{t:l}=y(),c=!!t,{isDownloaded:b,isRead:f,isBookmarked:h}=t!=null?t:{},{settings:{deleteChaptersWithBookmark:i}}=Fe(),g=tt(c,ft),p=rt(c),j=at(c),{downloadableChapters:d,downloadedChapters:m,unbookmarkedChapters:k,bookmarkedChapters:M,unreadChapters:P,readChapters:F}=x.useMemo(()=>({downloadableChapters:C.getDownloadable(n),downloadedChapters:C.getDownloaded(n),unbookmarkedChapters:C.getNonBookmarked(n),bookmarkedChapters:C.getBookmarked(n),unreadChapters:C.getNonRead(n),readChapters:C.getRead(n)}),[n]),K=()=>{a==null||a(t.id,!0),o()},S=(O,Q)=>{var W;const B=O==="mark_prev_as_read",E=B?"mark_as_read":O;if(E==="delete"&&t&&!v.isDeletable(t,i)){o();return}const D=(()=>{if(!t)return C.getChapters(Q);if(!B)return[t];const N=r.findIndex(({id:_})=>_===t.id);return N+1>r.length-1?[]:r.slice(N+1)})();if(!D.length){o();return}v.performAction(E,v.getIds(D),{chapters:D,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(W=D[0])==null?void 0:W.mangaId}).catch(_e()),o()};return e.jsxs(e.Fragment,{children:[c&&e.jsx($,{onClick:K,Icon:Xe,title:l("chapter.action.label.select")}),c&&e.jsx($,{Icon:me,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),o()},title:l("chapter.action.label.open_on_source")}),p(s)&&e.jsx($,{Icon:Ce,disabled:j(!d.length),onClick:()=>S("download",d),title:g("download",d.length)}),p(b)&&e.jsx($,{Icon:mt,disabled:j(!m.length),onClick:()=>S("delete",C.getDeletable(m,i)),title:g("delete",m.length)}),p(!h)&&e.jsx($,{Icon:De,disabled:j(!k.length),onClick:()=>S("bookmark",k),title:g("bookmark",k.length)}),p(h)&&e.jsx($,{Icon:Be,disabled:j(!M.length),onClick:()=>S("unbookmark",M),title:g("unbookmark",M.length)}),p(!f)&&e.jsx($,{Icon:Ze,disabled:j(!P.length),onClick:()=>S("mark_as_read",P),title:g("mark_as_read",P.length)}),p(f)&&e.jsx($,{Icon:et,disabled:j(!F.length),onClick:()=>S("mark_as_unread",F),title:g("mark_as_unread",F.length)}),c&&e.jsx($,{onClick:()=>S("mark_prev_as_read",[]),Icon:de,title:l("chapter.action.mark_as_read.add.label.action.previous")})]})},Xt=t=>{const{t:r}=y(),a=we(),s=x.useRef(null),{chapter:n,allChapters:o,downloadChapter:l,showChapterNumber:c,onSelect:b,selected:f}=t,h=f!==null,{isDownloaded:i}=n,g=d=>{h&&(d.preventDefault(),d.stopPropagation(),b(!f,d.shiftKey))},p=(d,m)=>{d.stopPropagation(),d.preventDefault(),m(d)},j=Se((d,{context:m})=>{if(!h&&s.current){p(d,()=>m==null?void 0:m(s.current));return}d.shiftKey=!0,g(d)});return e.jsx("li",{children:e.jsx(ne,{variant:"popover",popupId:"chapter-card-action-menu",children:d=>{var m;return e.jsxs(w,{sx:{pt:1,px:1},children:[e.jsx(Qe,{sx:{touchCallout:"none"},children:e.jsx(Je,{component:H,to:"/manga/".concat(n.manga.id,"/chapter/").concat(n.sourceOrder),style:{color:a.palette.text[n.isRead?"disabled":"primary"]},onClick:k=>g(k),...j(d.open),children:e.jsxs(gt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:2,"&:last-child":{pb:2}},children:[e.jsxs(w,{direction:"column",flex:1,children:[e.jsxs(w,{sx:{flexDirection:"row",gap:.5,alignItems:"center"},children:[n.isBookmarked&&e.jsx(Te,{color:"primary"}),e.jsx(xt,{variant:"h5",component:"h2",children:c?"".concat(r("chapter.title")," ").concat(n.chapterNumber):n.name})]}),e.jsx(G,{variant:"caption",children:n.scanlator}),e.jsxs(G,{variant:"caption",children:[Oe(Number((m=n.uploadDate)!=null?m:0),!0),i&&" â€¢ ".concat(r("chapter.status.label.downloaded"))]})]}),l&&e.jsx(pt,{download:l}),e.jsx(w,{sx:{minHeight:"48px"},children:f===null?e.jsx(T,{title:r("global.button.options"),children:e.jsx(R,{ref:s,...oe(d),onClick:k=>p(k,d.open),onTouchStart:k=>p(k,d.open),"aria-label":"more",size:"large",children:e.jsx(st,{})})}):e.jsx(T,{title:r(f?"global.button.deselect":"global.button.select"),children:e.jsx(bt,{checked:f})})})]})})}),!h&&d.isOpen&&e.jsx(nt,{...ye(d),children:k=>e.jsx(Le,{onClose:k,chapter:n,allChapters:o,handleSelection:()=>b(!0),canBeDownloaded:!n.isDownloaded&&!l})})]})}})})};function Zt(t){const{t:r}=y(),{chapterIndex:a,mangaId:s}=t;return e.jsxs(kt,{component:H,variant:"extended",color:"primary",to:"/manga/".concat(s,"/chapter/").concat(a),children:[e.jsx(jt,{}),r(a===1?"global.button.start":"global.button.resume")]})}const er={active:!1,unread:void 0,downloaded:void 0,bookmarked:void 0,reverse:!0,sortBy:"source",showChapterNumber:!1};function tr(t,r){switch(r.type){case"filter":return{...t,active:t.unread!==!1&&t.downloaded!==!1&&t.bookmarked!==!1,[r.filterType]:r.filterValue};case"sortBy":return{...t,sortBy:r.sortBy};case"sortReverse":return{...t,reverse:!t.reverse};case"showChapterNumber":return{...t,showChapterNumber:!t.showChapterNumber};default:throw Error(U("global.error.label.invalid_action"))}}function rr(t,{isRead:r}){switch(t){case!0:return!r;case!1:return r;default:return!0}}function ar(t,{isDownloaded:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}function sr(t,{isBookmarked:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}const nr=(t,{sortBy:r,reverse:a})=>{const s=[...t];switch(r){case"source":s.sort((n,o)=>n.sourceOrder-o.sourceOrder);break;case"fetchedAt":s.sort((n,o)=>{var l,c;return Number((l=n.fetchedAt)!=null?l:0)-Number((c=o.fetchedAt)!=null?c:0)});break;case"chapterNumber":s.sort((n,o)=>n.chapterNumber-o.chapterNumber);break;case"uploadedAt":s.sort((n,o)=>{var l,c;return Number((l=n.uploadDate)!=null?l:0)-Number((c=o.uploadDate)!=null?c:0)});break}return a&&s.reverse(),s};function or(t,r){const a=r.active?t.filter(s=>rr(r.unread,s)&&ar(r.downloaded,s)&&sr(r.bookmarked,s)):[...t];return nr(a,r)}const lr=t=>Ne(tr,"".concat(t,"filterOptions"),er),ir={source:"global.sort.label.by_source",chapterNumber:"global.sort.label.by_chapter_number",uploadedAt:"global.sort.label.by_upload_date",fetchedAt:"global.sort.label.by_fetch_date"},dr=t=>{const{unread:r,downloaded:a,bookmarked:s}=t;return r!=null||a!=null||s!=null},cr={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},ur=({open:t,onClose:r,options:a,optionsDispatch:s})=>{const{t:n}=y();return e.jsx(wt,{open:t,onClose:r,minHeight:150,tabs:["filter","sort","display"],tabTitle:o=>n(cr[o]),tabContent:o=>o==="filter"?e.jsxs(e.Fragment,{children:[e.jsx(te,{label:n("global.filter.label.unread"),checked:a.unread,onChange:l=>s({type:"filter",filterType:"unread",filterValue:l})}),e.jsx(te,{label:n("global.filter.label.downloaded"),checked:a.downloaded,onChange:l=>s({type:"filter",filterType:"downloaded",filterValue:l})}),e.jsx(te,{label:n("global.filter.label.bookmarked"),checked:a.bookmarked,onChange:l=>s({type:"filter",filterType:"bookmarked",filterValue:l})})]}):o==="sort"?Object.entries(ir).map(([l,c])=>e.jsx(_t,{label:n(c),checked:a.sortBy===l,sortDescending:a.reverse,onClick:()=>l!==a.sortBy?s({type:"sortBy",sortBy:l}):s({type:"sortReverse"})},l)):o==="display"?e.jsxs(Rt,{onChange:()=>s({type:"showChapterNumber"}),value:a.showChapterNumber,children:[e.jsx(ve,{label:n("chapter.option.display.label.source_title"),value:!1}),e.jsx(ve,{label:n("chapter.option.display.label.chapter_number"),value:!0})]}):null})},hr=({options:t,optionsDispatch:r})=>{const{t:a}=y(),[s,n]=x.useState(!1),o=dr(t);return e.jsxs(e.Fragment,{children:[e.jsx(T,{title:a("settings.title"),children:e.jsx(R,{onClick:()=>n(!0),children:e.jsx(Ct,{color:o?"warning":void 0})})}),e.jsx(ur,{open:s,onClose:()=>n(!1),options:t,optionsDispatch:r})]})},pr=I(w)(({theme:t})=>({margin:8,marginBottom:0,marginRight:"10px",minHeight:40,[t.breakpoints.down("md")]:{marginRight:0}})),mr=I(Ye)(({theme:t})=>({listStyle:"none",padding:0,minHeight:"200px",[t.breakpoints.up("md")]:{width:"50vw",height:"calc(100vh - 64px - 48px)",margin:0}})),fr=({manga:t,isRefreshing:r})=>{var J,D,W,N;const{t:a}=y(),{data:s}=z.useGetDownloadStatus(),n=(J=s==null?void 0:s.downloadStatus.queue)!=null?J:[],[o,l]=lr(t.id),{data:c,loading:b,error:f,refetch:h}=z.useGetMangaChapters(t.id,{notifyOnNetworkStatusChange:!0}),i=x.useMemo(()=>{var u;return(u=c==null?void 0:c.chapters.nodes)!=null?u:[]},[c==null?void 0:c.chapters.nodes]),g=x.useMemo(()=>i.map(u=>u.id),[i]),{areNoItemsSelected:p,areAllItemsSelected:j,selectedItemIds:d,handleSelectAll:m,handleSelection:k}=ot(i.length,{itemIds:g,currentKey:"default"}),M=x.useMemo(()=>or(i,o),[i,o]),P=(W=(D=t.firstUnreadChapter)==null?void 0:D.sourceOrder)!=null?W:1,F=t.chapters.totalCount===((N=t.latestReadChapter)==null?void 0:N.sourceOrder),K=t.unreadCount===0,S=t.downloadCount===t.chapters.totalCount,O=i.length===0,Q=!O&&M.length===0,B=x.useMemo(()=>M.map(u=>{const _=n==null?void 0:n.find(xe=>xe.chapter.sourceOrder===u.sourceOrder&&xe.chapter.manga.id===u.manga.id),Y=p?null:d.includes(u.id);return{chapter:u,downloadChapter:_,selected:Y}}),[n,d,M]),E=x.useMemo(()=>{const u=B.filter(_=>_.selected);return u.length?e.jsx(yt,{selectedItemsCount:u.length,title:"chapter.title",children:_=>e.jsx(Le,{selectedChapters:u,onClose:_})}):F?null:e.jsx(Zt,{chapterIndex:P,mangaId:t.id})},[B,F]);return b||O&&r?e.jsx(w,{sx:{justifyContent:"center",alignItems:"center",position:"relative",flexGrow:1},children:e.jsx(Ie,{})}):f?e.jsx(w,{sx:{justifyContent:"center",position:"relative",flexGrow:1},children:e.jsx(q,{message:a("global.error.label.failed_to_load_data"),messageExtra:f.message,retry:()=>h().catch(_e())})}):e.jsxs(e.Fragment,{children:[e.jsxs(w,{direction:"column",sx:{position:"relative"},children:[e.jsxs(pr,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(G,{variant:"h5",children:"".concat(M.length," ").concat(a("chapter.title",{count:M.length}))}),e.jsxs(w,{direction:"row",sx:{paddingRight:"24px"},children:[e.jsx(T,{title:a("chapter.action.mark_as_read.add.label.action.current"),children:e.jsx(R,{disabled:K,onClick:()=>v.markAsRead(C.getChapters(C.getNonRead(B)),!0,t.id),children:e.jsx(de,{})})}),e.jsx(ne,{variant:"popover",popupId:"chapterlist-download-button",children:u=>e.jsxs(e.Fragment,{children:[e.jsx(T,{title:a("chapter.action.download.add.label.action"),children:e.jsx(R,{disabled:S,...oe(u),children:e.jsx(Ce,{})})}),u.isOpen&&e.jsx(Me,{...ye(u),children:e.jsx(lt,{mangaIds:[t.id],closeMenu:u.close})})]})}),e.jsx(hr,{options:o,optionsDispatch:l}),e.jsx(It,{areAllItemsSelected:j,areNoItemsSelected:p,onChange:u=>m(u,u?i.map(_=>_.id):[])})]})]}),O&&e.jsx(q,{message:a("chapter.error.label.no_chapter_found")}),Q&&e.jsx(q,{message:a("chapter.error.label.no_matches")}),e.jsx(mr,{style:{height:"undefined",overflowY:window.innerWidth<900?"visible":"auto"},components:{Footer:()=>e.jsx(Re,{sx:{paddingBottom:vt}})},totalCount:M.length,itemContent:u=>e.jsx(Xt,{...B[u],allChapters:i,showChapterNumber:o.showChapterNumber,onSelect:(_,Y)=>k(B[u].chapter.id,_,{selectRange:Y})}),useWindowScroll:window.innerWidth<900,overscan:window.innerHeight*.5})]}),E]})},gr=t=>{const[r,a]=x.useState(!1),[s,n]=x.useState(null);return[x.useCallback(async()=>{a(!0),n(null),await Promise.all([z.getMangaFetch(t,{awaitRefetchQueries:!0}).response,z.getMangaChaptersFetch(t,{awaitRefetchQueries:!0}).response]).catch(l=>n(l)).finally(()=>a(!1))},[t]),{loading:r,error:s}]},fe=({children:t,...r})=>e.jsx(ze,{...r,children:e.jsx(w,{direction:"row",alignItems:"center",justifyContent:"center",gap:"10px",flexWrap:"wrap",children:t})});var ge={},xr=A;Object.defineProperty(ge,"__esModule",{value:!0});var Ae=ge.default=void 0,br=xr(L()),jr=e;Ae=ge.default=(0,br.default)((0,jr.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");const kr=({manga:t})=>{var b,f;const{t:r}=y(),a=Pe(),s=z.useGetTrackerList(),n=t.trackRecords.nodes,o=re.getLoggedIn((f=(b=s.data)==null?void 0:b.trackers.nodes)!=null?f:[]),l=re.getLoggedIn(re.getTrackers(n)),c=h=>{if(s.error){se(r("tracking.error.label.could_not_load_track_info"),"error");return}if(!o.length){a("/settings/trackingSettings");return}h()};return e.jsx(ne,{variant:"dialog",popupId:"manga-track-modal",children:h=>e.jsxs(e.Fragment,{children:[e.jsxs(fe,{...oe(h),disabled:s.loading||!!s.error,onClick:()=>c(h.open),onTouchStart:()=>c(h.open),size:"large",sx:{color:l.length?"#2196f3":"inherit"},children:[l.length?e.jsx(Ae,{}):e.jsx(Bt,{}),l.length?r("manga.button.track.active",{count:l.length}):r("manga.button.track.start")]}),e.jsx(We,{...Ee(h),maxWidth:"md",fullWidth:!0,scroll:"paper",children:e.jsx(it,{manga:t})})]})})},vr=I("div")(({theme:t})=>({width:"100%",[t.breakpoints.up("md")]:{position:"sticky",top:"64px",left:"0px",width:"50vw",height:"calc(100vh - 64px)",alignSelf:"flex-start",overflowY:"auto"}})),Cr=I("div")(()=>({padding:"10px"})),_r=I("div")(()=>({display:"flex"})),wr=I("div")(()=>({"& img":{borderRadius:4,maxWidth:"100%",minWidth:"100%",height:"auto"},maxWidth:"50%"})),yr=I("div")(({theme:t})=>({marginLeft:15,maxWidth:"100%","& span":{fontWeight:"400"},[t.breakpoints.up("lg")]:{fontSize:"1.3em"}})),V=t=>e.jsx(ut,{...t,titleProps:{variant:"h6"},valueProps:{variant:"h6"}}),Ir=I("div")(({theme:t})=>({display:"flex",justifyContent:"space-around","& button, a":{borderRadius:"25px",textTransform:"none",paddingLeft:"20px",paddingRight:"20px",fontSize:"x-large",[t.breakpoints.down("sm")]:{fontSize:"larger"}}})),Mr=I("div")(({theme:t})=>({paddingLeft:"10px",paddingRight:"10px",[t.breakpoints.up("md")]:{fontSize:"1.2em"},[t.breakpoints.up("lg")]:{fontSize:"1.3em"}})),Rr=I("div")(()=>({"& h4":{marginTop:"1em",marginBottom:0},"& p":{textAlign:"justify",textJustify:"inter-word"}})),Sr=I("div")(()=>({display:"flex",flexWrap:"wrap","& h5":{border:"2px solid #2196f3",borderRadius:"1.13em",marginRight:"1em",marginTop:0,marginBottom:"10px",padding:"0.3em",color:"#2196f3"}})),$r=({url:t})=>{const{t:r}=y(),a=x.useMemo(()=>e.jsxs(fe,{size:"large",disabled:!t,sx:{color:"inherit"},component:Dt,href:t!=null?t:void 0,target:"_blank",rel:"noreferrer",children:[e.jsx(me,{}),r("global.button.open_site")]}),[t]);return a};function Tr(t){var r;return t?(r=t.displayName)!=null?r:t.id:U("global.label.unknown")}function ae(t){return t!=null?t:U("global.label.unknown")}const Br=({manga:t})=>{const{t:r}=y();x.useEffect(()=>{t.source||se(U("source.error.label.source_not_found"),"error")},[t.source]);const{CategorySelectComponent:a,updateLibraryState:s}=dt(t),n=Se(async()=>{try{await navigator.clipboard.writeText(t.title),se(r("global.label.copied"),"info")}catch(o){}});return e.jsxs(e.Fragment,{children:[e.jsxs(vr,{children:[e.jsxs(Cr,{children:[e.jsxs(_r,{children:[e.jsx(wr,{children:e.jsx(Tt,{src:$t.getThumbnailUrl(t),alt:"Manga Thumbnail"})}),e.jsxs(yr,{children:[e.jsx(G,{variant:"h4",component:"h1",sx:{mb:1,"@media not (pointer: fine)":{userSelect:"none"}},...n(),children:t.title}),e.jsx(V,{title:r("manga.label.author"),value:ae(t.author)}),e.jsx(V,{title:r("manga.label.artist"),value:ae(t.artist)}),e.jsx(V,{title:r("manga.label.status"),value:ae(t.status)}),e.jsx(V,{title:r("source.title"),value:Tr(t.source)})]})]}),e.jsxs(Ir,{children:[e.jsxs(fe,{onClick:s,size:"large",sx:{color:t.inLibrary?"#2196f3":"inherit"},children:[t.inLibrary?e.jsx(St,{}):e.jsx(ct,{}),t.inLibrary?r("manga.button.in_library"):r("manga.button.add_to_library")]}),e.jsx(kr,{manga:t}),e.jsx($r,{url:t.realUrl})]})]}),e.jsxs(Mr,{children:[e.jsxs(Rr,{children:[e.jsx("h4",{children:r("settings.about.title")}),e.jsx("p",{style:{whiteSpace:"pre-line"},children:t.description})]}),e.jsx(Sr,{children:t.genre.map(o=>e.jsx("h5",{children:o},o))})]})]}),a]})},Dr=({manga:t,onRefresh:r,refreshing:a})=>{var g,p;const{t:s}=y(),n=we(),o=Ve(n.breakpoints.up("sm")),[l,c]=qe.useState(null),b=!!l,f=()=>{c(null)},{openCategorySelect:h,CategorySelectComponent:i}=ht({mangaId:t.id});return e.jsxs(e.Fragment,{children:[o&&e.jsxs(e.Fragment,{children:[e.jsx(T,{title:s("manga.label.reload_from_source"),children:e.jsx(R,{onClick:()=>{r()},disabled:a,children:e.jsx(be,{})})}),t.inLibrary&&e.jsxs(e.Fragment,{children:[e.jsx(T,{title:s("global.button.migrate"),children:e.jsx(H,{to:"/migrate/source/".concat((g=t.source)==null?void 0:g.id,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:e.jsx(R,{children:e.jsx(je,{})})})}),e.jsx(T,{title:s("manga.label.edit_categories"),children:e.jsx(R,{onClick:()=>{h(!0)},children:e.jsx(ke,{})})})]})]}),!o&&e.jsxs(e.Fragment,{children:[e.jsx(R,{id:"chaptersMenuButton","aria-controls":b?"chaptersMenu":void 0,"aria-haspopup":"true","aria-expanded":b?"true":void 0,onClick:j=>c(j.currentTarget),children:e.jsx(Mt,{})}),e.jsxs(Me,{id:"chaptersMenu",anchorEl:l,open:b,onClose:f,MenuListProps:{"aria-labelledby":"chaptersMenuButton"},children:[e.jsxs(X,{onClick:()=>{r(),f()},disabled:a,children:[e.jsx(Z,{children:e.jsx(be,{fontSize:"small"})}),e.jsx(ee,{children:s("manga.label.reload_from_source")})]}),t.inLibrary&&[e.jsxs(X,{component:H,to:"/migrate/source/".concat((p=t.source)==null?void 0:p.id,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:[e.jsx(Z,{children:e.jsx(je,{fontSize:"small"})}),e.jsx(ee,{children:s("migrate.title")})]},"migrate"),e.jsxs(X,{onClick:()=>{h(!0),f()},children:[e.jsx(Z,{children:e.jsx(ke,{fontSize:"small"})}),e.jsx(ee,{children:s("manga.label.edit_categories")})]},"categories")]]})]}),i]})},ma=()=>{const{t}=y(),{setTitle:r,setAction:a}=x.useContext(He),{id:s}=Ge(),n=x.useRef(!1),{data:o,error:l,loading:c,networkStatus:b,refetch:f}=z.useGetManga(s),h=Ke(b),i=o==null?void 0:o.manga,[g,{loading:p,error:j}]=gr(s),d=l!=null?l:j;return x.useEffect(()=>{if(i==null)return;!n.current&&!i.initialized&&(n.current=!0,g())},[i]),x.useEffect(()=>{var m;return r((m=i==null?void 0:i.title)!=null?m:t("manga.title")),a(null),()=>{r(""),a(null)}},[t,i==null?void 0:i.title]),x.useEffect(()=>{var m;return a(e.jsxs(w,{direction:"row",alignItems:"center",children:[d&&!h&&!p&&e.jsx(T,{title:e.jsxs(e.Fragment,{children:[t("manga.error.label.request_failure"),e.jsx("br",{}),(m=d.message)!=null?m:d]}),children:e.jsx(R,{onClick:()=>f(),children:e.jsx($e,{color:"error"})})}),i&&(p||h)&&e.jsx(R,{disabled:!0,children:e.jsx(Ue,{size:16})}),i&&e.jsx(Dr,{manga:i,onRefresh:g,refreshing:p})]})),()=>{a(null)}},[t,d,h,p,i,g]),d&&!i?e.jsx(q,{message:t("manga.error.label.request_failure"),messageExtra:d.message}):e.jsxs(Re,{sx:{display:{md:"flex"},overflow:"hidden"},children:[c&&e.jsx(Ie,{}),i&&e.jsx(Br,{manga:i}),i&&e.jsx(fr,{manga:i,isRefreshing:p})]})};export{ma as Manga};
