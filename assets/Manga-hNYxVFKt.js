import{r as A,i as L,j as e,u as I,q as Le,c as g,w as ke,h as ve,x as _e,P as ae,S as y,L as G,T as q,y as Fe,f as $,I as S,z as se,A as Ce,C as Ne,D as H,s as M,a as N,F as Oe,g as we,E as V,H as ye,B as Ie,J as Ee,b as ze,e as Pe,G as We,K as Ve,O as Ge,m as te,Q as qe,R as He,U as ge,V as Q,W as J,X as Y,N as Ue,Y as Ke,Z as Qe,_ as Je,$ as Ye}from"./index-BrquQMfM.js";import{C as Xe,a as Ze,V as et}from"./index-Pqrrb45E.js";import{M as T,d as tt,a as rt,b as at,c as st,e as nt,f as ot,J as Me,g as lt,h as it,u as dt,C as ct,T as ut,i as ht,j as pt,k as mt,l as ft,m as xe,n as be}from"./useManageMangaLibraryState-Dvs-mQQH.js";import{D as gt}from"./DownloadStateIndicator-F2Nm4eWW.js";import{d as xt}from"./Delete-cXqv-zpG.js";import{C as k,a as bt}from"./Chapters-D35I0r5Y.js";import{C as jt,T as kt}from"./TypographyMaxLines-wKKxz7u_.js";import{C as vt}from"./Checkbox-CqOPDIia.js";import{d as _t}from"./PlayArrow-CXNXzxJO.js";import{S as Ct,D as wt}from"./StyledFab-D8Tfj3Ij.js";import{d as yt}from"./FilterList-BwOUJyDC.js";import{S as It,R as je}from"./SortRadioInput-BdAkEnda.js";import{T as X}from"./ThreeStateCheckboxInput-GGY3gBLy.js";import{O as Mt,a as Rt,S as St,d as Tt}from"./SelectionFAB-B5IVBmxj.js";import{R as $t}from"./ListPreference-GksgC4qX.js";import{M as re}from"./Mangas-BCssk0VF.js";import{b as Bt}from"./Strings-CWt9sr6N.js";import{d as Dt}from"./Favorite-DQkunbFW.js";import{S as At}from"./SpinnerImage-BvzT2hsZ.js";import{d as Lt}from"./Sync-BtguDigs.js";import{T as Z}from"./Trackers-D4pSmk7a.js";import{L as Ft}from"./Link-CZ4Sf9N_.js";import"./Avatar-D-nUOEQt.js";import"./Info-BSxGokBs.js";import"./TextField-DYhDxUry.js";import"./InputAdornment-OTC68-bu.js";import"./Collapse-C423HXK1.js";import"./NumberSetting-XjeBT1pk.js";import"./useMobilePicker-gYHJgWAd.js";import"./Chip-C24vjT3T.js";import"./SelectSetting-CO-lbwIh.js";import"./Select-B--ztZeu.js";import"./CheckboxInput-CyKW56MF.js";import"./SwitchBase-B1k-T08K.js";import"./Tabs-8WCrdKm7.js";var ne={},Nt=L;Object.defineProperty(ne,"__esModule",{value:!0});var Re=ne.default=void 0,Ot=Nt(A()),Et=e;Re=ne.default=(0,Ot.default)((0,Et.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");var oe={},zt=L;Object.defineProperty(oe,"__esModule",{value:!0});var le=oe.default=void 0,Pt=zt(A()),Wt=e;le=oe.default=(0,Pt.default)((0,Wt.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll");var ie={},Vt=L;Object.defineProperty(ie,"__esModule",{value:!0});var Se=ie.default=void 0,Gt=Vt(A()),qt=e;Se=ie.default=(0,Gt.default)((0,qt.jsx)("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"}),"Bookmark");var de={},Ht=L;Object.defineProperty(de,"__esModule",{value:!0});var Te=de.default=void 0,Ut=Ht(A()),Kt=e;Te=de.default=(0,Ut.default)((0,Kt.jsx)("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"}),"BookmarkRemove");var ce={},Qt=L;Object.defineProperty(ce,"__esModule",{value:!0});var $e=ce.default=void 0,Jt=Qt(A()),Yt=e;$e=ce.default=(0,Jt.default)((0,Yt.jsx)("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"}),"BookmarkAdd");var ue={},Xt=L;Object.defineProperty(ue,"__esModule",{value:!0});var he=ue.default=void 0,Zt=Xt(A()),er=e;he=ue.default=(0,Zt.default)((0,er.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39"}),"Public");class C{static getChapters(r){return r.map(({chapter:a})=>a)}static getIds(r){return k.getIds(C.getChapters(r))}static getDownloaded(r){return r.filter(({chapter:a})=>k.isDownloaded(a))}static getDeletable(r,a){return r.filter(({chapter:s})=>k.isDeletable(s,a))}static getNonDownloaded(r){return r.filter(({chapter:a})=>!k.isDownloaded(a))}static getDownloadable(r){return r.filter(({chapter:a,downloadChapter:s})=>!k.isDownloaded(a)&&!s)}static getBookmarked(r){return r.filter(({chapter:a})=>k.isBookmarked(a))}static getNonBookmarked(r){return r.filter(({chapter:a})=>!k.isBookmarked(a))}static getRead(r){return r.filter(({chapter:a})=>k.isRead(a))}static getNonRead(r){return r.filter(({chapter:a})=>!k.isRead(a))}}const Be=({chapter:t,allChapters:r,handleSelection:a,canBeDownloaded:s=!1,selectedChapters:n=[],onClose:o})=>{const{t:i}=I(),d=!!t,{isDownloaded:b,isRead:p,isBookmarked:f}=t!=null?t:{},{settings:{deleteChaptersWithBookmark:l}}=Le(),x=st(d,bt),m=nt(d),v=ot(d),{downloadableChapters:c,downloadedChapters:h,unbookmarkedChapters:j,bookmarkedChapters:R,unreadChapters:F,readChapters:O}=g.useMemo(()=>({downloadableChapters:C.getDownloadable(n),downloadedChapters:C.getDownloaded(n),unbookmarkedChapters:C.getNonBookmarked(n),bookmarkedChapters:C.getBookmarked(n),unreadChapters:C.getNonRead(n),readChapters:C.getRead(n)}),[n]),U=()=>{a==null||a(t.id,!0),o()},w=(z,B)=>{var _;const P=z==="mark_prev_as_read",E=P?"mark_as_read":z;if(E==="delete"&&t&&!k.isDeletable(t,l)){o();return}const u=(()=>{if(!t)return C.getChapters(B);if(!P)return[t];const D=r.findIndex(({id:Ae})=>Ae===t.id);return D+1>r.length-1?[]:r.slice(D+1)})();if(!u.length){o();return}k.performAction(E,k.getIds(u),{chapters:u,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(_=u[0])==null?void 0:_.mangaId}).catch(ve()),o()};return e.jsxs(e.Fragment,{children:[d&&e.jsx(T,{onClick:U,Icon:tt,title:i("chapter.action.label.select")}),d&&e.jsx(T,{Icon:he,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),o()},title:i("chapter.action.label.open_on_source")}),m(s)&&e.jsx(T,{Icon:ke,disabled:v(!c.length),onClick:()=>w("download",c),title:x("download",c.length)}),m(b)&&e.jsx(T,{Icon:xt,disabled:v(!h.length),onClick:()=>w("delete",C.getDeletable(h,l)),title:x("delete",h.length)}),m(!f)&&e.jsx(T,{Icon:$e,disabled:v(!j.length),onClick:()=>w("bookmark",j),title:x("bookmark",j.length)}),m(f)&&e.jsx(T,{Icon:Te,disabled:v(!R.length),onClick:()=>w("unbookmark",R),title:x("unbookmark",R.length)}),m(!p)&&e.jsx(T,{Icon:rt,disabled:v(!F.length),onClick:()=>w("mark_as_read",F),title:x("mark_as_read",F.length)}),m(p)&&e.jsx(T,{Icon:at,disabled:v(!O.length),onClick:()=>w("mark_as_unread",O),title:x("mark_as_unread",O.length)}),d&&e.jsx(T,{onClick:()=>w("mark_prev_as_read",[]),Icon:le,title:i("chapter.action.mark_as_read.add.label.action.previous")})]})},tr=t=>{const{t:r}=I(),a=_e(),s=g.useRef(null),{chapter:n,allChapters:o,downloadChapter:i,showChapterNumber:d,onSelect:b,selected:p}=t,f=p!==null,{isDownloaded:l}=n,x=c=>{f&&(c.preventDefault(),c.stopPropagation(),b(!p,c.shiftKey))},m=(c,h)=>{c.stopPropagation(),c.preventDefault(),h(c)},v=Me((c,{context:h})=>{if(!f&&s.current){m(c,()=>h==null?void 0:h(s.current));return}c.shiftKey=!0,x(c)});return e.jsx("li",{children:e.jsx(ae,{variant:"popover",popupId:"chapter-card-action-menu",children:c=>{var h;return e.jsxs(y,{sx:{pt:1,px:1},children:[e.jsx(Xe,{sx:{touchCallout:"none"},children:e.jsx(Ze,{component:G,to:"/manga/".concat(n.mangaId,"/chapter/").concat(n.sourceOrder),style:{color:a.palette.text[n.isRead?"disabled":"primary"]},onClick:j=>x(j),...v(c.open),children:e.jsxs(jt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:2,"&:last-child":{pb:2}},children:[e.jsxs(y,{direction:"column",flex:1,children:[e.jsxs(y,{sx:{flexDirection:"row",gap:.5,alignItems:"center"},children:[n.isBookmarked&&e.jsx(Se,{color:"primary"}),e.jsx(kt,{variant:"h5",component:"h2",children:d?"".concat(r("chapter.title_one")," ").concat(n.chapterNumber):n.name})]}),e.jsx(q,{variant:"caption",children:n.scanlator}),e.jsxs(q,{variant:"caption",children:[Fe(Number((h=n.uploadDate)!=null?h:0),!0),l&&" â€¢ ".concat(r("chapter.status.label.downloaded"))]})]}),i&&e.jsx(gt,{download:i}),e.jsx(y,{sx:{minHeight:"48px"},children:p===null?e.jsx($,{title:r("global.button.options"),children:e.jsx(S,{ref:s,...se(c),onClick:j=>m(j,c.open),onTouchStart:j=>m(j,c.open),"aria-label":"more",size:"large",children:e.jsx(lt,{})})}):e.jsx($,{title:r(p?"global.button.deselect":"global.button.select"),children:e.jsx(vt,{checked:p})})})]})})}),!f&&c.isOpen&&e.jsx(it,{...Ce(c),children:j=>e.jsx(Be,{onClose:j,chapter:n,allChapters:o,handleSelection:()=>b(!0),canBeDownloaded:!n.isDownloaded&&!i})})]})}})})};function rr(t){const{t:r}=I(),{chapterIndex:a,mangaId:s}=t;return e.jsxs(Ct,{component:G,variant:"extended",color:"primary",to:"/manga/".concat(s,"/chapter/").concat(a),children:[e.jsx(_t,{}),r(a===1?"global.button.start":"global.button.resume")]})}const ar={active:!1,unread:void 0,downloaded:void 0,bookmarked:void 0,reverse:!0,sortBy:"source",showChapterNumber:!1};function sr(t,r){switch(r.type){case"filter":return{...t,active:t.unread!==!1&&t.downloaded!==!1&&t.bookmarked!==!1,[r.filterType]:r.filterValue};case"sortBy":return{...t,sortBy:r.sortBy};case"sortReverse":return{...t,reverse:!t.reverse};case"showChapterNumber":return{...t,showChapterNumber:!t.showChapterNumber};default:throw Error(H("global.error.label.invalid_action"))}}function nr(t,{isRead:r}){switch(t){case!0:return!r;case!1:return r;default:return!0}}function or(t,{isDownloaded:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}function lr(t,{isBookmarked:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}const ir=(t,{sortBy:r,reverse:a})=>{const s=[...t];switch(r){case"source":s.sort((n,o)=>n.sourceOrder-o.sourceOrder);break;case"fetchedAt":s.sort((n,o)=>{var i,d;return Number((i=n.fetchedAt)!=null?i:0)-Number((d=o.fetchedAt)!=null?d:0)});break;case"chapterNumber":s.sort((n,o)=>n.chapterNumber-o.chapterNumber);break;case"uploadedAt":s.sort((n,o)=>{var i,d;return Number((i=n.uploadDate)!=null?i:0)-Number((d=o.uploadDate)!=null?d:0)});break}return a&&s.reverse(),s};function dr(t,r){const a=r.active?t.filter(s=>nr(r.unread,s)&&or(r.downloaded,s)&&lr(r.bookmarked,s)):[...t];return ir(a,r)}const cr=t=>Ne(sr,"".concat(t,"filterOptions"),ar),ur={source:"global.sort.label.by_source",chapterNumber:"global.sort.label.by_chapter_number",uploadedAt:"global.sort.label.by_upload_date",fetchedAt:"global.sort.label.by_fetch_date"},hr=t=>{const{unread:r,downloaded:a,bookmarked:s}=t;return r!=null||a!=null||s!=null},pr={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},mr=({open:t,onClose:r,options:a,optionsDispatch:s})=>{const{t:n}=I();return e.jsx(Mt,{open:t,onClose:r,minHeight:150,tabs:["filter","sort","display"],tabTitle:o=>n(pr[o]),tabContent:o=>o==="filter"?e.jsxs(e.Fragment,{children:[e.jsx(X,{label:n("global.filter.label.unread"),checked:a.unread,onChange:i=>s({type:"filter",filterType:"unread",filterValue:i})}),e.jsx(X,{label:n("global.filter.label.downloaded"),checked:a.downloaded,onChange:i=>s({type:"filter",filterType:"downloaded",filterValue:i})}),e.jsx(X,{label:n("global.filter.label.bookmarked"),checked:a.bookmarked,onChange:i=>s({type:"filter",filterType:"bookmarked",filterValue:i})})]}):o==="sort"?Object.entries(ur).map(([i,d])=>e.jsx(It,{label:n(d),checked:a.sortBy===i,sortDescending:a.reverse,onClick:()=>i!==a.sortBy?s({type:"sortBy",sortBy:i}):s({type:"sortReverse"})},i)):o==="display"?e.jsxs($t,{onChange:()=>s({type:"showChapterNumber"}),value:a.showChapterNumber,children:[e.jsx(je,{label:n("chapter.option.display.label.source_title"),value:!1}),e.jsx(je,{label:n("chapter.option.display.label.chapter_number"),value:!0})]}):null})},fr=({options:t,optionsDispatch:r})=>{const{t:a}=I(),[s,n]=g.useState(!1),o=hr(t);return e.jsxs(e.Fragment,{children:[e.jsx($,{title:a("settings.title"),children:e.jsx(S,{onClick:()=>n(!0),children:e.jsx(yt,{color:o?"warning":void 0})})}),e.jsx(mr,{open:s,onClose:()=>n(!1),options:t,optionsDispatch:r})]})},gr=M(y)(({theme:t})=>({margin:8,marginBottom:0,marginRight:"10px",minHeight:40,[t.breakpoints.down("md")]:{marginRight:0}})),xr=M(et)(({theme:t})=>({listStyle:"none",padding:0,minHeight:"200px",[t.breakpoints.up("md")]:{width:"50vw",height:"calc(100vh - 64px - 48px)",margin:0}})),br=({manga:t,isRefreshing:r})=>{var E,K;const{t:a}=I(),{data:s}=N.useGetDownloadStatus(),n=(E=s==null?void 0:s.downloadStatus.queue)!=null?E:[],[o,i]=cr(t.id),{data:d,loading:b,error:p,refetch:f}=N.useGetMangaChapters(Oe,t.id,{notifyOnNetworkStatusChange:!0}),l=g.useMemo(()=>{var u;return(u=d==null?void 0:d.chapters.nodes)!=null?u:[]},[d==null?void 0:d.chapters.nodes]),x=g.useMemo(()=>l.map(u=>u.id),[l]),{areNoItemsSelected:m,areAllItemsSelected:v,selectedItemIds:c,handleSelectAll:h,handleSelection:j}=dt(l.length,{itemIds:x,currentKey:"default"}),R=g.useMemo(()=>dr(l,o),[l,o]),F=(K=t.firstUnreadChapter)==null?void 0:K.sourceOrder,O=re.isFullyRead(t),U=re.isFullyDownloaded(t),w=l.length===0,z=!w&&R.length===0,B=g.useMemo(()=>R.map(u=>{const _=n==null?void 0:n.find(fe=>fe.chapter.id===u.id),D=m?null:c.includes(u.id);return{chapter:u,downloadChapter:_,selected:D}}),[n,c,R]),P=g.useMemo(()=>{const u=B.filter(_=>_.selected);return u.length?e.jsx(Rt,{selectedItemsCount:u.length,title:"chapter.title_one",children:_=>e.jsx(Be,{selectedChapters:u,onClose:_})}):F!==void 0?e.jsx(rr,{chapterIndex:F,mangaId:t.id}):null},[B]);return b||w&&r?e.jsx(y,{sx:{justifyContent:"center",alignItems:"center",position:"relative",flexGrow:1},children:e.jsx(we,{})}):p?e.jsx(y,{sx:{justifyContent:"center",position:"relative",flexGrow:1},children:e.jsx(V,{message:a("global.error.label.failed_to_load_data"),messageExtra:p.message,retry:()=>f().catch(ve())})}):e.jsxs(e.Fragment,{children:[e.jsxs(y,{direction:"column",sx:{position:"relative"},children:[e.jsxs(gr,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(q,{variant:"h5",children:"".concat(R.length," ").concat(a("chapter.title_one",{count:R.length}))}),e.jsxs(y,{direction:"row",sx:{paddingRight:"24px"},children:[e.jsx($,{title:a("chapter.action.mark_as_read.add.label.action.current"),children:e.jsx(S,{disabled:O,onClick:()=>k.markAsRead(C.getChapters(C.getNonRead(B)),!0,t.id),children:e.jsx(le,{})})}),e.jsx(ae,{variant:"popover",popupId:"chapterlist-download-button",children:u=>e.jsxs(e.Fragment,{children:[e.jsx($,{title:a("chapter.action.download.add.label.action"),children:e.jsx(S,{disabled:U,...se(u),children:e.jsx(ke,{})})}),u.isOpen&&e.jsx(ye,{...Ce(u),children:e.jsx(ct,{mangaIds:[t.id],closeMenu:u.close})})]})}),e.jsx(fr,{options:o,optionsDispatch:i}),e.jsx(St,{areAllItemsSelected:v,areNoItemsSelected:m,onChange:u=>h(u,u?l.map(_=>_.id):[])})]})]}),w&&e.jsx(V,{message:a("chapter.error.label.no_chapter_found")}),z&&e.jsx(V,{message:a("chapter.error.label.no_matches")}),e.jsx(xr,{style:{height:"undefined",overflowY:window.innerWidth<900?"visible":"auto"},components:{Footer:()=>e.jsx(Ie,{sx:{paddingBottom:wt}})},totalCount:R.length,itemContent:u=>e.jsx(tr,{...B[u],allChapters:l,showChapterNumber:o.showChapterNumber,onSelect:(_,D)=>j(B[u].chapter.id,_,{selectRange:D})}),useWindowScroll:window.innerWidth<900,overscan:window.innerHeight*.5})]}),P]})},jr=t=>{const[r,a]=g.useState(!1),[s,n]=g.useState(null);return[g.useCallback(async()=>{a(!0),n(null),await Promise.all([N.getMangaFetch(t,{awaitRefetchQueries:!0}).response,N.getMangaChaptersFetch(t,{awaitRefetchQueries:!0}).response]).catch(i=>{i instanceof Ee&&Bt(i.message)==="no chapters found"||n(i)}).finally(()=>a(!1))},[t]),{loading:r,error:s}]},pe=({children:t,...r})=>e.jsx(ze,{...r,children:e.jsx(y,{direction:"row",alignItems:"center",justifyContent:"center",gap:"10px",flexWrap:"wrap",children:t})});var me={},kr=L;Object.defineProperty(me,"__esModule",{value:!0});var De=me.default=void 0,vr=kr(A()),_r=e;De=me.default=(0,vr.default)((0,_r.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");const Cr=({manga:t})=>{var p,f;const{t:r}=I(),a=Pe(),s=N.useGetTrackerList(We),n=(f=(p=s.data)==null?void 0:p.trackers.nodes)!=null?f:[],o=t.trackRecords.nodes,i=Z.getLoggedIn(n),d=Z.getLoggedIn(Z.getTrackers(o,n)),b=l=>{if(s.error){te(r("tracking.error.label.could_not_load_track_info"),"error");return}if(!i.length){a("/settings/trackingSettings");return}l()};return e.jsx(ae,{variant:"dialog",popupId:"manga-track-modal",children:l=>e.jsxs(e.Fragment,{children:[e.jsxs(pe,{...se(l),disabled:s.loading||!!s.error,onClick:()=>b(l.open),onTouchStart:()=>b(l.open),size:"large",sx:{color:d.length?"#2196f3":"inherit"},children:[d.length?e.jsx(De,{}):e.jsx(Lt,{}),d.length?r("manga.button.track.active",{count:d.length}):r("manga.button.track.start")]}),e.jsx(Ve,{...Ge(l),maxWidth:"md",fullWidth:!0,scroll:"paper",children:e.jsx(ut,{manga:t})})]})})},wr=M("div")(({theme:t})=>({width:"100%",[t.breakpoints.up("md")]:{position:"sticky",top:"64px",left:"0px",width:"50vw",height:"calc(100vh - 64px)",alignSelf:"flex-start",overflowY:"auto"}})),yr=M("div")(()=>({padding:"10px"})),Ir=M("div")(()=>({display:"flex"})),Mr=M("div")(()=>({"& img":{borderRadius:4,maxWidth:"100%",minWidth:"100%",height:"auto"},maxWidth:"50%"})),Rr=M("div")(({theme:t})=>({marginLeft:15,maxWidth:"100%","& span":{fontWeight:"400"},[t.breakpoints.up("lg")]:{fontSize:"1.3em"}})),W=t=>e.jsx(mt,{...t,titleProps:{variant:"h6"},valueProps:{variant:"h6"}}),Sr=M("div")(({theme:t})=>({display:"flex",justifyContent:"space-around","& button, a":{borderRadius:"25px",textTransform:"none",paddingLeft:"20px",paddingRight:"20px",fontSize:"x-large",[t.breakpoints.down("sm")]:{fontSize:"larger"}}})),Tr=M("div")(({theme:t})=>({paddingLeft:"10px",paddingRight:"10px",[t.breakpoints.up("md")]:{fontSize:"1.2em"},[t.breakpoints.up("lg")]:{fontSize:"1.3em"}})),$r=M("div")(()=>({"& h4":{marginTop:"1em",marginBottom:0},"& p":{textAlign:"justify",textJustify:"inter-word"}})),Br=M("div")(()=>({display:"flex",flexWrap:"wrap","& h5":{border:"2px solid #2196f3",borderRadius:"1.13em",marginRight:"1em",marginTop:0,marginBottom:"10px",padding:"0.3em",color:"#2196f3"}})),Dr=({url:t})=>{const{t:r}=I(),a=g.useMemo(()=>e.jsxs(pe,{size:"large",disabled:!t,sx:{color:"inherit"},component:Ft,href:t!=null?t:void 0,target:"_blank",rel:"noreferrer",children:[e.jsx(he,{}),r("global.button.open_site")]}),[t]);return a};function Ar(t){var r;return t?(r=t.displayName)!=null?r:t.id:H("global.label.unknown")}function ee(t){return t!=null?t:H("global.label.unknown")}const Lr=({manga:t})=>{const{t:r}=I();g.useEffect(()=>{t.source||te(H("source.error.label.source_not_found"),"error")},[t.source]);const{CategorySelectComponent:a,updateLibraryState:s}=ht(t),n=Me(async()=>{try{await navigator.clipboard.writeText(t.title),te(r("global.label.copied"),"info")}catch(o){}});return e.jsxs(e.Fragment,{children:[e.jsxs(wr,{children:[e.jsxs(yr,{children:[e.jsxs(Ir,{children:[e.jsx(Mr,{children:e.jsx(At,{src:re.getThumbnailUrl(t),alt:"Manga Thumbnail"})}),e.jsxs(Rr,{children:[e.jsx(q,{variant:"h4",component:"h1",sx:{mb:1,"@media not (pointer: fine)":{userSelect:"none"}},...n(),children:t.title}),e.jsx(W,{title:r("manga.label.author"),value:ee(t.author)}),e.jsx(W,{title:r("manga.label.artist"),value:ee(t.artist)}),e.jsx(W,{title:r("manga.label.status"),value:ee(t.status)}),e.jsx(W,{title:r("source.title_one"),value:Ar(t.source)})]})]}),e.jsxs(Sr,{children:[e.jsxs(pe,{onClick:s,size:"large",sx:{color:t.inLibrary?"#2196f3":"inherit"},children:[t.inLibrary?e.jsx(Dt,{}):e.jsx(pt,{}),t.inLibrary?r("manga.button.in_library"):r("manga.button.add_to_library")]}),e.jsx(Cr,{manga:t}),e.jsx(Dr,{url:t.realUrl})]})]}),e.jsxs(Tr,{children:[e.jsxs($r,{children:[e.jsx("h4",{children:r("settings.about.title")}),e.jsx("p",{style:{whiteSpace:"pre-line"},children:t.description})]}),e.jsx(Br,{children:t.genre.map(o=>e.jsx("h5",{children:o},o))})]})]}),a]})},Fr=({manga:t,onRefresh:r,refreshing:a})=>{const{t:s}=I(),n=_e(),o=qe(n.breakpoints.up("sm")),[i,d]=He.useState(null),b=!!i,p=()=>{d(null)},{openCategorySelect:f,CategorySelectComponent:l}=ft({mangaId:t.id});return e.jsxs(e.Fragment,{children:[o&&e.jsxs(e.Fragment,{children:[e.jsx($,{title:s("manga.label.reload_from_source"),children:e.jsx(S,{onClick:()=>{r()},disabled:a,children:e.jsx(ge,{})})}),t.inLibrary&&e.jsxs(e.Fragment,{children:[e.jsx($,{title:s("global.button.migrate"),children:e.jsx(G,{to:"/migrate/source/".concat(t.sourceId,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:e.jsx(S,{children:e.jsx(xe,{})})})}),e.jsx($,{title:s("manga.label.edit_categories"),children:e.jsx(S,{onClick:()=>{f(!0)},children:e.jsx(be,{})})})]})]}),!o&&e.jsxs(e.Fragment,{children:[e.jsx(S,{id:"chaptersMenuButton","aria-controls":b?"chaptersMenu":void 0,"aria-haspopup":"true","aria-expanded":b?"true":void 0,onClick:x=>d(x.currentTarget),children:e.jsx(Tt,{})}),e.jsxs(ye,{id:"chaptersMenu",anchorEl:i,open:b,onClose:p,MenuListProps:{"aria-labelledby":"chaptersMenuButton"},children:[e.jsxs(Q,{onClick:()=>{r(),p()},disabled:a,children:[e.jsx(J,{children:e.jsx(ge,{fontSize:"small"})}),e.jsx(Y,{children:s("manga.label.reload_from_source")})]}),t.inLibrary&&[e.jsxs(Q,{component:G,to:"/migrate/source/".concat(t.sourceId,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:[e.jsx(J,{children:e.jsx(xe,{fontSize:"small"})}),e.jsx(Y,{children:s("migrate.title")})]},"migrate"),e.jsxs(Q,{onClick:()=>{f(!0),p()},children:[e.jsx(J,{children:e.jsx(be,{fontSize:"small"})}),e.jsx(Y,{children:s("manga.label.edit_categories")})]},"categories")]]})]}),l]})},ba=()=>{const{t}=I(),{setTitle:r,setAction:a}=g.useContext(Ue),{id:s}=Ke(),n=g.useRef(!1),{data:o,error:i,loading:d,networkStatus:b,refetch:p}=N.useGetManga(Qe,s),f=Ye(b),l=o==null?void 0:o.manga,[x,{loading:m,error:v}]=jr(s),c=i!=null?i:v;return g.useEffect(()=>{if(l==null)return;!n.current&&!l.initialized&&(n.current=!0,x())},[l]),g.useEffect(()=>{var h;return r((h=l==null?void 0:l.title)!=null?h:t("manga.title_one")),a(null),()=>{r(""),a(null)}},[t,l==null?void 0:l.title]),g.useEffect(()=>{var h;return a(e.jsxs(y,{direction:"row",alignItems:"center",children:[c&&!f&&!m&&e.jsx($,{title:e.jsxs(e.Fragment,{children:[t("manga.error.label.request_failure"),e.jsx("br",{}),(h=c.message)!=null?h:c]}),children:e.jsx(S,{onClick:()=>p(),children:e.jsx(Re,{color:"error"})})}),l&&(m||f)&&e.jsx(S,{disabled:!0,children:e.jsx(Je,{size:16})}),l&&e.jsx(Fr,{manga:l,onRefresh:x,refreshing:m})]})),()=>{a(null)}},[t,c,f,m,l,x]),c&&!l?e.jsx(V,{message:t("manga.error.label.request_failure"),messageExtra:c.message}):e.jsxs(Ie,{sx:{display:{md:"flex"},overflow:"hidden"},children:[d&&e.jsx(we,{}),l&&e.jsx(Lr,{manga:l}),l&&e.jsx(br,{manga:l,isRefreshing:m})]})};export{ba as Manga};
