import{c as ae,j as e,u as L,M as Re,A as k,L as G,B as U,S as ie,r as f,T as m,a as le,b as F,d as K,e as Pe,s as Be,f as ce,g as c,h as de,C as R,I as P,i as X,k as C,l as N,m as Ce,n as w,D as be,o as De,p as Ge,q as Fe,t as Le,v as He,w as ze,x as Ve,y as Ee,z as ve,E as We}from"./index-CPG18q5k.js";import{u as Te,S as we,A as qe}from"./AppbarSearch-C0cmayIs.js";import{SourceContentType as ne}from"./SourceMangas-D6GXN2NX.js";import{t as z,L as Ae,g as q,I as Ke,a as Xe,E as _e,b as T,c as $e,d as Qe,e as Ie,f as Ye,h as Je,i as Ze,j as et}from"./LanguageSelect-F2eGBGOm.js";import{M as ye}from"./MUI.util-CXceox0g.js";import{S as O}from"./Sources-Df3Y0kUe.js";import{C as $}from"./Card-_YmKHhZZ.js";import{C as ke}from"./CardActionArea-i_0bbDTx.js";import{C as Q}from"./CardContent-51FQcGi3.js";import{A as ue}from"./Avatar-OQkAp4FE.js";import{E as H}from"./EmptyViewAbsoluteCentered-CYa1kN0A.js";import{f as tt}from"./file-selector-DlHkLoY8.js";import{A as st}from"./Add-Cabj0qU_.js";import{S as pe,V as nt,a as ot,b as rt}from"./Virtuoso.util-Dmxa9fJQ.js";import{T as oe,a as re}from"./Tabs-D0Pz4jtK.js";import{T as at}from"./TabsWrapper-BwoD32fP.js";import{T as it}from"./TabsMenu-BjlEnTIx.js";import{A as lt,a as ct}from"./SortRadioInput-DKThz4kL.js";import{C as dt}from"./Chip-iWDd1oOc.js";import"./ChaptersDownloadActionMenuItems-KBLyHb7V.js";import"./Trackers-D4pSmk7a.js";import"./TextField-BqVP9txQ.js";import"./useFormControl-CVA1_vKa.js";import"./formControlState-Dq1zat_P.js";import"./InputAdornment-BC-rSsrp.js";import"./CheckCircle-D997XEd_.js";import"./Link-CJ4bhH_E.js";import"./useManageMangaLibraryState-BeESMuU2.js";import"./ThreeStateCheckboxInput-BLZmAb-z.js";import"./Checkbox-DjhcsvUZ.js";import"./SwitchBase-C0ZIMf0H.js";import"./CheckboxInput-CLS1auKC.js";import"./FormGroup-DLMVLJpb.js";import"./ListPreference-Znp-Be1b.js";import"./NumberSetting-DgfbBGYq.js";import"./Slider-BWx4P90d.js";import"./useMobilePicker-Bf65E0EZ.js";import"./SelectSetting-C2oCEuxK.js";import"./Select-xh4893D3.js";import"./Favorite-g2_FHPD_.js";import"./FilterList-Bv8vyB6S.js";import"./GridLayouts-gH3oNAYn.js";import"./Delete-DdK8VLT6.js";import"./ExpandMore-C-bHQdYf.js";import"./useDebounce-DRLf-jgJ.js";import"./StyledFab-DiS_27ex.js";import"./BaseMangaGrid-CdokIQh7.js";import"./MangaGrid-DaLxMg-h.js";import"./Download-CUqC2TGf.js";import"./Sync-NP9NECSh.js";import"./PlayArrow-BSyRFvlb.js";import"./Switch-mlGw0kfN.js";const ut=ae(e.jsx("path",{d:"M19.3 16.9c.4-.7.7-1.5.7-2.4 0-2.5-2-4.5-4.5-4.5S11 12 11 14.5s2 4.5 4.5 4.5c.9 0 1.7-.3 2.4-.7l3.2 3.2 1.4-1.4zm-3.8.1c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5M12 20v2C6.48 22 2 17.52 2 12S6.48 2 12 2c4.84 0 8.87 3.44 9.8 8h-2.07c-.64-2.46-2.4-4.47-4.73-5.41V5c0 1.1-.9 2-2 2h-2v2c0 .55-.45 1-1 1H8v2h2v3H9l-4.79-4.79C4.08 10.79 4 11.38 4 12c0 4.41 3.59 8 8 8"})),pt=o=>{const{t:s}=L(),r=Re.useIsMobileWidth(),{source:d,showSourceRepo:u}=o,{id:t,name:a,lang:n,iconUrl:p,supportsLatest:l,isNsfw:x,extension:{repo:b}}=d,h=O.isLocalSource(d)?s("source.local_source.title"):a;return e.jsx($,{sx:{margin:1,marginTop:0},children:e.jsx(ke,{component:G,to:k.sources.childRoutes.browse.path(t),state:{contentType:ne.POPULAR,clearCache:!0},children:e.jsxs(Q,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5},children:[e.jsxs(U,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{variant:"rounded",alt:h,sx:{width:56,height:56,flex:"0 0 auto",mr:1,background:"transparent"},children:e.jsx(ie,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%"},alt:h,src:f.getValidImgUrlFor(p)})}),e.jsxs(U,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(m,{variant:"h6",component:"h3",children:h}),e.jsxs(m,{variant:"caption",sx:{display:"block"},children:[z(n),x&&e.jsx(m,{variant:"caption",color:"error",sx:{display:"inline"},children:" 18+"}),u&&e.jsx(m,{variant:"caption",sx:{display:"block"},children:b})]})]})]}),e.jsxs(le,{sx:{flexDirection:"row",gap:1},children:[l&&e.jsx(F,{...ye.preventRippleProp(),variant:"outlined",component:G,to:k.sources.childRoutes.browse.path(t),state:{contentType:ne.LATEST,clearCache:!0},children:s("global.button.latest")}),!r&&e.jsx(F,{...ye.preventRippleProp(),variant:"outlined",component:G,to:k.sources.childRoutes.browse.path(t),state:{contentType:ne.POPULAR,clearCache:!0},children:s("global.button.popular")})]})]})})})};function ht(){const{t:o}=L(),{setAction:s}=K(),[r,d]=Pe("shownSourceLangs",Be()),{settings:{showNsfw:u}}=ce(),{data:t,loading:a,error:n,refetch:p}=f.useGetSourceList({notifyOnNetworkStatusChange:!0}),l=t==null?void 0:t.sources.nodes,x=c.useMemo(()=>O.filter(l!=null?l:[],{showNsfw:u,languages:r,keepLocalSource:!0}),[l,r]),b=c.useMemo(()=>Object.entries(O.groupByLanguage(x)),[x]),h=c.useMemo(()=>O.getLanguages(l!=null?l:[]),[l]),A=c.useMemo(()=>O.areFromMultipleRepos(x),[x]),B=de();return c.useLayoutEffect(()=>(s(e.jsxs(e.Fragment,{children:[e.jsx(R,{title:o("search.title.global_search"),children:e.jsx(P,{onClick:()=>B(k.sources.childRoutes.searchAll.path),color:"inherit",children:e.jsx(ut,{})})}),e.jsx(Ae,{selectedLanguages:r,setSelectedLanguages:d,languages:h})]})),()=>{s(null)}),[o,r,h]),a?e.jsx(X,{}):n?e.jsx(H,{message:o("global.error.label.failed_to_load_data"),messageExtra:C(n),retry:()=>p().catch(N())}):(l==null?void 0:l.length)===0?e.jsx(H,{message:o("source.error.label.no_sources_found")}):e.jsx(e.Fragment,{children:b.map(([S,E])=>e.jsxs(c.Fragment,{children:[e.jsx(m,{variant:"h5",component:"h2",sx:{paddingLeft:3,paddingTop:1,paddingBottom:2,fontWeight:"bold"},children:z(S)},S),E.map(v=>e.jsx(pt,{source:v,showSourceRepo:A},v.id))]},S))})}function xt(o){const{t:s}=L(),{extension:{name:r,lang:d,versionName:u,isInstalled:t,hasUpdate:a,isObsolete:n,pkgName:p,iconUrl:l,isNsfw:x,repo:b},handleUpdate:h,showOptions:A,showSourceRepo:B,forcedState:S}=o,[E,v]=c.useState(q(t,n,a)),M=S!=null?S:E;c.useEffect(()=>{v(q(t,n,a))},[q(t,n,a)]);const V=d==="all"?s("extension.language.all"):d.toUpperCase(),D=async _=>{const J=Qe[_],Z=$e[_];try{switch(v(Z),_){case T.INSTALL:await f.updateExtension(p,{install:!0,isObsolete:n}).response;break;case T.UNINSTALL:await f.updateExtension(p,{uninstall:!0,isObsolete:n}).response;break;case T.UPDATE:await f.updateExtension(p,{update:!0,isObsolete:n}).response;break;default:throw new Error('Unexpected ExtensionAction "'.concat(_,'"'))}v(J),h()}catch(W){v(q(t,n,a)),w(s(Ie[_],{count:1}),"error",C(W))}};function Y(){switch(M){case T.INSTALL:case T.UPDATE:case T.UNINSTALL:D(M).catch(N());break;case _e.OBSOLETE:D(T.UNINSTALL).catch(N());break}}return e.jsx($,{children:e.jsxs(Q,{sx:{display:"flex",alignItems:"center",gap:1,p:1.5,"&:last-child":{paddingBottom:1.5}},children:[e.jsx(ue,{variant:"rounded",sx:{width:56,height:56,flex:"0 0 auto",background:"transparent"},alt:r,children:e.jsx(ie,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%"},alt:r,src:f.getValidImgUrlFor(l)})}),e.jsxs(U,{sx:{display:"flex",flexDirection:"column",flexGrow:1,flexShrink:1,wordBreak:"break-word",justifyContent:"center"},children:[e.jsx(m,{variant:"h6",component:"h3",children:r}),e.jsxs(m,{variant:"caption",sx:{display:"block"},children:[V," ",u,x&&e.jsx(m,{variant:"caption",color:"error",sx:{display:"inline"},children:" 18+"})]}),B&&e.jsx(m,{variant:"caption",sx:{display:"block"},children:b})]}),t&&e.jsx(R,{title:s("settings.title"),children:e.jsx(P,{onClick:A,color:"inherit",children:e.jsx(Ce,{})})}),e.jsx(F,{variant:"outlined",sx:{color:M===Xe.OBSOLETE?"red":"inherit",flexShrink:0},onClick:()=>Y(),children:s(Ke[M])})]})})}function gt({extensionId:o,closeDialog:s}){const{t:r}=L(),d=de(),{data:u,loading:t,error:a,refetch:n}=f.useGetSourceList({notifyOnNetworkStatusChange:!0});if(a)return e.jsx(be,{open:!!o,onClose:s});const p=c.useMemo(()=>o?u==null?void 0:u.sources.nodes.filter(l=>l.extension.pkgName===o):[],[u==null?void 0:u.sources.nodes,o]);return e.jsxs(be,{open:!!o,onClose:s,maxWidth:"md",fullWidth:!0,children:[e.jsx(De,{children:r("extension.settings.dialog.title")}),e.jsxs(Ge,{children:[t&&e.jsx(X,{}),a&&e.jsx(H,{message:r("global.error.label.failed_to_load_data"),messageExtra:C(a),retry:()=>n().catch(N())}),!t&&!a&&e.jsx(U,{children:p==null?void 0:p.map(l=>e.jsx(pe,{sx:{px:0},children:e.jsx($,{children:e.jsxs(Q,{sx:{display:"flex",alignItems:"center",gap:1,p:1.5,"&:last-child":{paddingBottom:1.5}},children:[e.jsx(m,{variant:"h6",component:"h3",sx:{flexGrow:1},children:z(O.getLanguage(l))}),l.isConfigurable&&e.jsx(R,{title:r("settings.title"),children:e.jsx(P,{onClick:()=>d(k.sources.childRoutes.configure.path(l.id)),color:"inherit",children:e.jsx(Ce,{})})})]})})},l.id))})]})]})}const mt=0,ft=1,jt=({groupName:o,isFirstItem:s,groupExtensionIds:r,isUpdateGroup:d,updatingExtensionIds:u,setUpdatingExtensionIds:t,handleExtensionUpdate:a})=>{const{t:n}=L();return e.jsxs(rt,{isFirstItem:s,sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",pr:1},children:[e.jsx(m,{variant:"h5",component:"h2",children:z(o)}),d&&e.jsx(F,{disabled:!!u.length,variant:"contained",onClick:()=>{t(r),f.updateExtensions(r,{update:!0}).response.then(()=>a()).catch(p=>w(n(Ie[T.UPDATE],{count:r.length}),"error",C(p))).finally(()=>t([]))},children:n("extension.action.label.update_all")})]},o)};function St({tabsMenuHeight:o}){var je,Se;const{t:s}=L(),{setAction:r}=K(),d=de(),{pathname:u,search:t,state:a}=Fe(),n=a==null?void 0:a.selectedExtensionPkg,{data:p,loading:l,error:x,refetch:b}=f.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[h,{data:A,loading:B,error:S}]=f.useExtensionListFetch(),{settings:{extensionLanguages:E,showNsfw:v}}=ce(),M=Le(i=>w(s("global.error.label.failed_to_save_changes"),"error",C(i))),[V]=Te("query",we),[D,Y]=c.useState([]),[_,J]=c.useState({}),Z=l||B,W=x!=null?x:S,Ne=!!(p!=null&&p.settings.extensionRepos.length),Me=((je=p==null?void 0:p.settings.extensionRepos.length)!=null?je:0)>1,j=(Se=A==null?void 0:A.fetchExtensions)==null?void 0:Se.extensions,he=c.useMemo(()=>Ye(j!=null?j:[]),[j]),xe=c.useMemo(()=>Je(j!=null?j:[],E,v,V),[j,E,E,V]),I=c.useMemo(()=>Ze(xe),[xe]),ge=c.useMemo(()=>I.map(i=>i[ft].length),[I]),ee=c.useMemo(()=>I.map(([,i])=>i).flat(1),[I]),Oe=nt.useCreateGroupedComputeItemKey(ge,c.useCallback(i=>I[i][mt],[I]),c.useCallback(i=>ee[i].pkgName,[ee])),te=c.useCallback(()=>J({}),[]),me=i=>{d(u+t,{replace:!0,state:{selectedExtensionPkg:i}})},fe=i=>{if(!i.name.toLowerCase().endsWith("apk")){w(s("global.error.label.invalid_file_type"),"error");return}w(s("extension.label.installing_file"),"info"),f.installExternalExtension(i).response.then(()=>{te(),w(s("extension.label.installed_successfully"),"success")}).catch(g=>w(s("extension.label.installation_failed"),"error",C(g)))};return c.useEffect(()=>{h()},[_]),c.useLayoutEffect(()=>(r(e.jsxs(e.Fragment,{children:[e.jsx(qe,{}),e.jsx(R,{title:s("extension.action.label.install_external"),children:e.jsx(P,{onClick:()=>{const i=document.createElement("input");i.style.display="none",i.type="file",i.onchange=()=>{var y;const g=(y=i.files)==null?void 0:y[0];g&&fe(g)},document.documentElement.appendChild(i),i.click(),document.documentElement.removeChild(i)},color:"inherit",children:e.jsx(st,{})})}),e.jsx(Ae,{selectedLanguages:E,setSelectedLanguages:i=>M("extensionLanguages",i),languages:he})]})),()=>{r(null)}),[s,E,he]),c.useEffect(()=>{const i=async y=>{y.preventDefault();const se=await tt(y);fe(se[0])},g=y=>{y.preventDefault()};return document.addEventListener("drop",i),document.addEventListener("dragover",g),()=>{document.removeEventListener("drop",i),document.removeEventListener("dragover",g)}},[]),Z?e.jsx(X,{}):W?e.jsx(H,{message:s("global.error.label.failed_to_load_data"),messageExtra:C(W),retry:()=>{x&&b().catch(N()),S&&h().catch(N())}}):!(j!=null&&j.length)&&!Ne?e.jsxs(le,{sx:{alignItems:"center",justifyContent:"center",rowGap:"10px",paddingTop:"20px"},children:[e.jsx(m,{children:s("extension.label.add_repository_info")}),e.jsx(F,{component:G,variant:"contained",to:k.browse.path,children:s("settings.title")})]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{heightToSubtract:o,overscan:window.innerHeight*.5,groupCounts:ge,groupContent:i=>{const[g,y]=I[i],se=g===et.UPDATE_PENDING;return e.jsx(jt,{groupName:g,isFirstItem:i===0,groupExtensionIds:y.map(Ue=>Ue.pkgName),isUpdateGroup:se,updatingExtensionIds:D,setUpdatingExtensionIds:Y,handleExtensionUpdate:te})},computeItemKey:Oe,itemContent:i=>{const g=ee[i];return e.jsx(pe,{children:e.jsx(xt,{extension:g,handleUpdate:te,showSourceRepo:Me,forcedState:D.includes(g.pkgName)?_e.UPDATING:void 0,showOptions:()=>me(g.pkgName)})})}}),e.jsx(gt,{extensionId:n,closeDialog:()=>me(void 0)})]})}const bt=ae(e.jsx("path",{d:"M14.94 4.66h-4.72l2.36-2.36zm-4.69 14.71h4.66l-2.33 2.33zM6.1 6.27 1.6 17.73h1.84l.92-2.45h5.11l.92 2.45h1.84L7.74 6.27zm-1.13 7.37 1.94-5.18 1.94 5.18zm10.76 2.5h6.12v1.59h-8.53v-1.29l5.92-8.56h-5.88v-1.6h8.3v1.26z"})),Et=ae(e.jsx("path",{d:"M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4zm-6 4h-4v-4h4z"})),vt=({id:o,name:s,lang:r,iconUrl:d,mangaCount:u})=>{const{t}=L(),n=Number(o)===0?t("source.local_source.title"):s;return e.jsx($,{children:e.jsx(ke,{component:G,to:k.migrate.path(o),children:e.jsxs(Q,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:1.5},children:[e.jsxs(U,{sx:{display:"flex"},children:[e.jsx(ue,{variant:"rounded",sx:{width:56,height:56,flex:"0 0 auto",mr:1,background:"transparent"},children:e.jsx(ie,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%"},alt:n,src:f.getValidImgUrlFor(d)})}),e.jsxs(U,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(m,{variant:"h6",component:"h3",children:n}),e.jsx(m,{variant:"caption",sx:{display:"block"},children:z(r)})]})]}),e.jsx(dt,{sx:{borderRadius:1},size:"small",label:u})]})})})},yt=(o,{sortBy:s,sortOrder:r})=>{if(!o)return[];const d={};o.forEach(({sourceId:t,source:a})=>{var p;const n=(p=d[t])!=null?p:{id:t,name:t,lang:"unknown",iconUrl:null,mangaCount:0,...a};d[t]={...n,mangaCount:n.mangaCount+1}});const u=Object.values(d).toSorted((t,a)=>{switch(s){case Ee.SOURCE_NAME:return t.name.localeCompare(a.name);case Ee.MANGA_COUNT:return t.mangaCount-a.mangaCount;default:throw new Error('Unexpected "sortBy" "'.concat(s,'"'))}});switch(r){case ve.ASC:return u;case ve.DESC:return u.toReversed();default:throw new Error('Unexpected "sortOrder" "'.concat(r,'"'))}},Ct=({tabsMenuHeight:o})=>{const{t:s}=L(),{appBarHeight:r}=K(),{settings:{migrateSortSettings:d}}=ce(),u=Le(h=>w(s("global.error.label.failed_to_save_changes"),"error",C(h))),{sortBy:t,sortOrder:a}=d,{data:n,loading:p,error:l,refetch:x}=f.useGetMigratableSources({notifyOnNetworkStatusChange:!0}),b=c.useMemo(()=>yt(n==null?void 0:n.mangas.nodes,d),[n==null?void 0:n.mangas.nodes,d]);return p?e.jsx(X,{}):l?e.jsx(H,{message:s("global.error.label.failed_to_load_data"),messageExtra:C(l),retry:()=>x().catch(N())}):e.jsxs(e.Fragment,{children:[e.jsxs(le,{sx:{position:"sticky",top:"".concat(r+o,"px"),flexDirection:"row",justifyContent:"end",alignItems:"center",gap:1,p:1,backgroundColor:"background.default",zIndex:1},children:[e.jsx(R,{title:s(He[t]),children:e.jsx(P,{color:"inherit",onClick:()=>u("migrateSortSettings",{sortBy:(t+1)%2,sortOrder:a}),children:t?e.jsx(Et,{}):e.jsx(bt,{})})}),e.jsx(R,{title:s(ze[a]),children:e.jsx(P,{color:"inherit",onClick:()=>u("migrateSortSettings",{sortBy:t,sortOrder:(a+1)%2}),children:a?e.jsx(lt,{}):e.jsx(ct,{})})})]}),e.jsx(Ve,{sx:{p:0},children:b.map(h=>e.jsx(pe,{children:e.jsx(vt,{...h})},h.id))})]})};function Cs(){const{t:o}=L(),{setTitle:s}=K();c.useLayoutEffect(()=>{s(o("global.label.browse"))},[o]);const r=c.useRef(null),[d,u]=c.useState(0);We(r,c.useCallback(()=>u(r.current.offsetHeight),[r.current]));const[t,a]=Te("tab",we,{}),n=t!=null?t:"source";return t||a(n,"replaceIn"),e.jsxs(at,{children:[e.jsxs(it,{ref:r,variant:"fullWidth",value:n,onChange:(p,l)=>a(l,"replaceIn"),children:[e.jsx(oe,{value:"source",sx:{textTransform:"none"},label:o("source.title_one")}),e.jsx(oe,{value:"extensions",sx:{textTransform:"none"},label:o("extension.title_other")}),e.jsx(oe,{value:"migrate",sx:{textTransform:"none"},label:o("migrate.title")})]}),e.jsx(re,{index:"source",currentIndex:n,children:e.jsx(ht,{})}),e.jsx(re,{index:"extensions",currentIndex:n,children:e.jsx(St,{tabsMenuHeight:d})}),e.jsx(re,{index:"migrate",currentIndex:n,children:e.jsx(Ct,{tabsMenuHeight:d})})]})}export{Cs as Browse};
