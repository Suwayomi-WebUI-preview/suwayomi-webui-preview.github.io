import{aM as w,aN as A,d as L,bv as M,bw as R,j as t,Z as P,aO as U,aP as F,u as y,a as E,r as f,a1 as N,aG as D,a2 as B,ap as j,bx as O,D as G,a8 as W,k as $,l as q,aC as V,B as T,m as v,g as I,b as H,N as J,h as C,f as K,w as k,aB as S,p as Z}from"./index-CBxbdOZa.js";import{E as z}from"./EmptyViewAbsoluteCentered-DCgg8ff9.js";import{P as Q}from"./PasswordTextField-B0HL_3JF.js";import{T as u}from"./Trackers-D4pSmk7a.js";import{A as X}from"./Avatar-CczBYppx.js";import{C as Y}from"./Chip-BeTPtnoR.js";import{T as ee}from"./TextField-DuGJKvvj.js";import{u as te}from"./useAppTitle-BmkqDPsV.js";import{S as _}from"./Switch-Bv3Q3BvN.js";import{L as se}from"./ListSubheader-ChTMvLky.js";import"./InputAdornment-PGzZQUDk.js";import"./useFormControl-EdH_WGd-.js";import"./formControlState-Dq1zat_P.js";import"./SwitchBase-Bt1MmkrC.js";function ae(e){return w("MuiListItemAvatar",e)}A("MuiListItemAvatar",["root","alignItemsFlexStart"]);const re=e=>{const{alignItems:s,classes:n}=e;return F({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},ae,n)},ne=P("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[s.root,n.alignItems==="flex-start"&&s.alignItemsFlexStart]}})({minWidth:56,flexShrink:0,variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}),ie=L.forwardRef(function(s,n){const l=M({props:s,name:"MuiListItemAvatar"}),{className:i,...m}=l,g=L.useContext(R),o={...l,alignItems:g.alignItems},d=re(o);return t.jsx(ne,{className:U(d.root,i),ownerState:o,ref:n,...m})}),oe=({tracker:e})=>{const{t:s}=y(),[n]=E("serverBaseURL",window.location.origin),[l,{loading:i}]=f.useLoginToTrackerCredentials(),[m]=f.useLogoutFromTracker(),[g,o]=L.useState(""),[d,h]=L.useState(""),c=!e.isLoggedIn&&!!e.authUrl,b=async()=>{try{await m({variables:{trackerId:e.id}})}catch(a){v(s("tracking.action.logout.label.failure",{name:e.name}),"error",I(a))}},p=async()=>{if(c){const a={redirectUrl:"".concat(n,"/tracker/login/oauth"),clientName:"Suwayomi-WebUI",trackerId:e.id,trackerName:e.name};window.open("".concat(e.authUrl,"&state=").concat(JSON.stringify(a)),"_self");return}try{await l({variables:{input:{trackerId:e.id,username:g,password:d}}})}catch(a){v(s("tracking.action.login.label.failure",{name:e.name}),"error",I(a))}},x=a=>{if(!c){a();return}p()};return t.jsx(N,{variant:"popover",popupId:"tracker-dialog",children:a=>t.jsxs(t.Fragment,{children:[t.jsxs(D,{...B(a),onClick:()=>x(a.open),children:[t.jsx(ie,{sx:{paddingRight:"20px"},children:t.jsx(X,{alt:"".concat(e.name),src:f.getValidImgUrlFor(e.icon),variant:"rounded",sx:{width:64,height:64}})}),t.jsx(j,{primary:e.name}),u.isLoggedIn(e)&&t.jsx(O,{children:t.jsx(Y,{label:s("global.label.logged_in"),color:"success"})})]}),t.jsxs(G,{...W(a),open:(u.isLoggedIn(e)||!e.authUrl)&&a.isOpen,disableRestoreFocus:!0,children:[t.jsx($,{children:s(u.isLoggedIn(e)?"tracking.settings.dialog.title.log_out":"tracking.settings.dialog.title.log_in",{name:e.name})}),!c&&!e.isLoggedIn&&t.jsxs(q,{children:[t.jsx(ee,{autoFocus:!0,margin:"dense",id:"username",name:"username",label:s("global.label.username"),type:"text",fullWidth:!0,variant:"standard",onChange:r=>o(r.target.value)}),t.jsx(Q,{margin:"dense",fullWidth:!0,variant:"standard",onChange:r=>h(r.target.value)})]}),t.jsxs(V,{children:[t.jsx(T,{onClick:a.close,children:s("global.button.cancel")}),t.jsx(T,{variant:"contained",disabled:!c&&!e.isLoggedIn&&(i||!g.length||!d.length),onClick:()=>u.isLoggedIn(e)?b():p(),children:s(u.isLoggedIn(e)?"global.button.log_out":"global.button.log_in")})]})]})]})})},ve=()=>{var a;const{t:e}=y();te(e("tracking.title"));const{settings:{updateProgressAfterReading:s,updateProgressManualMarkRead:n},loading:l,request:{error:i,refetch:m}}=H(),g=Z(r=>v(e("global.error.label.failed_to_save_changes"),"error",I(r))),{data:o,loading:d,error:h,refetch:c}=f.useGetTrackerList(J,{notifyOnNetworkStatusChange:!0}),b=(a=o==null?void 0:o.trackers.nodes)!=null?a:[],p=l||d,x=i!=null?i:h;return x?t.jsx(z,{message:e("global.error.label.failed_to_load_data"),messageExtra:I(x),retry:()=>{i&&m().catch(C()),h&&c().catch(C())}}):p?t.jsx(K,{}):t.jsxs(t.Fragment,{children:[t.jsxs(k,{sx:{pt:0},children:[t.jsxs(S,{children:[t.jsx(j,{primary:e("tracking.settings.label.update_progress_reading")}),t.jsx(_,{edge:"end",checked:s,onChange:r=>g("updateProgressAfterReading",r.target.checked)})]}),t.jsxs(S,{children:[t.jsx(j,{primary:e("tracking.settings.label.update_progress_manual"),secondary:e("tracking.settings.label.update_progress_reading_description")}),t.jsx(_,{edge:"end",checked:n,onChange:r=>g("updateProgressManualMarkRead",r.target.checked)})]})]}),t.jsx(k,{subheader:t.jsx(se,{component:"div",id:"tracking-trackers",children:e("tracking.settings.title.trackers")}),children:b.map(r=>t.jsx(oe,{tracker:r},r.id))})]})};export{ve as TrackingSettings};
