import{f as s,j as e,A as y,L as b,G as I,u as w,r as R,g as E,k as G,T as L,i as S}from"./index-B0UwsKMl.js";import{E as c}from"./EmptyViewAbsoluteCentered-Bs5AD096.js";import{S as T,a as A}from"./StyledGroupHeader-LZIge1mF.js";import{S as M}from"./StyledGroupItemWrapper-DdcqChQF.js";import{V as d}from"./Virtuoso.util-Bxir-kqr.js";import{C as P,D as k}from"./ChapterCardMetadata-C_bRtF8D.js";import{C as h}from"./Chapters-D6Ju3num.js";import{t as O,e as U}from"./DateHelper-Ct80tg9h.js";import{C as v,a as F}from"./ChapterDownloadButton-DxMniCgG.js";import{C as _}from"./ChapterDownloadRetryButton-DTkrQBOt.js";import{L as B}from"./ListCardContent-merDFDsh.js";import{C as N}from"./Card-BZt02v0e.js";import{C as V}from"./CardActionArea-BaIGu5xk.js";import{u as D}from"./useAppTitle-DqHPF1XK.js";import"./index-DeLo89Jy.js";import"./use-merged-ref-CaF8PN0v.js";import"./Asserts-BTvS50Ww.js";import"./Mangas-Y1Ak7Os2.js";import"./ListCardAvatar-CxaFD5ss.js";import"./AvatarSpinner-DqrfcPAj.js";import"./SpinnerImage-DhBU3Hmo.js";import"./Refresh-BAAuuYyu.js";import"./Image-BjjbaAmX.js";import"./Download-B_v7a91W.js";import"./MUI.util-CEodEA2f.js";const K=s.memo(({chapter:r})=>{const{manga:t}=r;return e.jsx(N,{children:e.jsx(V,{component:b,to:y.reader.path(r.manga.id,r.sourceOrder),state:h.getReaderOpenChapterLocationState(r),sx:{color:i=>i.palette.text[r.isRead?"disabled":"primary"]},children:e.jsxs(B,{sx:{justifyContent:"space-between"},children:[e.jsxs(I,{sx:{display:"flex",flexGrow:1,gap:1},children:[e.jsx(v,{mangaId:t.id,sourceId:t.sourceId,mangaTitle:t.title,thumbnailUrl:t.thumbnailUrl,thumbnailUrlLastFetched:t.thumbnailUrlLastFetched}),e.jsx(P,{title:t.title,secondaryText:"".concat(r.name," â€” ").concat(O.format(U(Number(r.lastReadAt)).valueOf()))})]}),e.jsx(k,{chapterId:r.id}),e.jsx(_,{chapterId:r.id}),e.jsx(F,{chapterId:r.id,isDownloaded:r.isDownloaded})]})})})}),Ce=()=>{var u;const{t:r}=w();D(r("history.title"));const{data:t,loading:i,error:m,fetchMore:C,refetch:f}=R.useGetRecentlyReadChapters(void 0,{fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),l=!!(t!=null&&t.chapters.pageInfo.hasNextPage),g=t==null?void 0:t.chapters.pageInfo.endCursor,a=(u=t==null?void 0:t.chapters.nodes)!=null?u:[],n=s.useMemo(()=>Object.entries(h.groupByDate(a,"lastReadAt")),[a]),p=s.useMemo(()=>n.map(o=>o[d.ITEMS].length),[n]),x=d.useCreateGroupedComputeItemKey(p,s.useCallback(o=>n[o][d.GROUP],[n]),s.useCallback(o=>a[o].id,[a])),j=s.useCallback(()=>{l&&C({variables:{offset:a.length}})},[l,g]);return m?e.jsx(c,{message:r("global.error.label.failed_to_load_data"),messageExtra:E(m),retry:()=>f().catch(G())}):!i&&a.length===0?e.jsx(c,{message:r("history.error.label.no_history_available")}):e.jsx(T,{persistKey:"history",components:{Footer:()=>i?e.jsx(S,{usePadding:!0}):null},overscan:window.innerHeight*.5,endReached:j,groupCounts:p,groupContent:o=>e.jsx(A,{isFirstItem:o===0,children:e.jsx(L,{variant:"h5",component:"h2",children:n[o][d.GROUP]})}),computeItemKey:x,itemContent:o=>e.jsx(M,{children:e.jsx(K,{chapter:a[o]})})})};export{Ce as History};
