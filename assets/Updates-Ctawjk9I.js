import{f as s,j as e,A as S,L as _,H as P,u as A,J as O,r as j,g as H,k as M,T as y,i as v}from"./index-D9MaEs9E.js";import{E as I}from"./EmptyViewAbsoluteCentered-DZ6ABKnL.js";import{U as B}from"./UpdateChecker-BKroAf81.js";import{S as F,a as N}from"./StyledGroupHeader-86g94ZAE.js";import{S as V}from"./StyledGroupItemWrapper-t9PG95li.js";import{d as K}from"./DateHelper-2of1AIhG.js";import{V as m}from"./Virtuoso.util-BOZwCiso.js";import{C as D,D as q}from"./ChapterCardMetadata-CUj5eHkA.js";import{C as W,a as $}from"./ChapterDownloadButton-CcoMBn6B.js";import{C as z}from"./ChapterDownloadRetryButton-CMMxRSne.js";import{a as b}from"./Chapters-D9IjxkKV.js";import{L as J}from"./ListCardContent-VY20TdSy.js";import{C as Q}from"./Card-BkTqqInW.js";import{C as X}from"./CardActionArea-DI4PBFTF.js";import{u as Z}from"./useAppTitleAndAction-JWtO6kvQ.js";import{G as Y}from"./Virtuoso.constants-DKNufsdf.js";import"./Refresh-B_vyuVi3.js";import"./Progress-C54RmXwO.js";import"./index-DT9vT6J8.js";import"./use-merged-ref-B2M-mDG1.js";import"./Mangas-CH1hraOn.js";import"./Asserts-xItX73wb.js";import"./ListCardAvatar-CmHHq0H2.js";import"./AvatarSpinner-Bh-DHeyl.js";import"./SpinnerImage-DJqBBLY8.js";import"./Image-W15CBo3Q.js";import"./Download-C4ncbRSM.js";import"./MUI.util-CEodEA2f.js";import"./useAppTitle-DsOircGX.js";import"./useAppAction-CyIRREiS.js";const ee=s.memo(({chapter:t})=>{const{manga:a}=t;return e.jsx(Q,{children:e.jsx(X,{component:_,to:S.reader.path(t.manga.id,t.sourceOrder),state:b.getReaderOpenChapterLocationState(t),sx:{color:d=>d.palette.text[t.isRead?"disabled":"primary"]},children:e.jsxs(J,{sx:{justifyContent:"space-between"},children:[e.jsxs(P,{sx:{display:"flex",flexGrow:1,gap:1},children:[e.jsx(W,{mangaId:a.id,sourceId:a.sourceId,mangaTitle:a.title,thumbnailUrl:a.thumbnailUrl,thumbnailUrlLastFetched:a.thumbnailUrlLastFetched}),e.jsx(D,{title:a.title,secondaryText:t.name})]}),e.jsx(q,{chapterId:t.id}),e.jsx(z,{chapterId:t.id}),e.jsx($,{chapterId:t.id,isDownloaded:t.isDownloaded})]})})})}),Se=()=>{var x;const{i18n:t,_:a}=A(),{appBarHeight:d}=O(),{data:r,loading:u,error:c,fetchMore:T,refetch:U}=j.useGetRecentlyUpdatedChapters(void 0,{fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),h=!!(r!=null&&r.chapters.pageInfo.hasNextPage),L=r==null?void 0:r.chapters.pageInfo.endCursor,i=(x=r==null?void 0:r.chapters.nodes)!=null?x:[],n=s.useMemo(()=>Object.entries(b.groupByDate(i,"fetchedAt")),[i]),f=s.useMemo(()=>n.map(o=>o[m.ITEMS].length),[n]),k=m.useCreateGroupedComputeItemKey(f,s.useCallback(o=>n[o][m.GROUP],[n]),s.useCallback(o=>i[o].id,[i])),p=s.useRef(null),[R,w]=s.useState(0);s.useLayoutEffect(()=>{var o,C;w((C=(o=p.current)==null?void 0:o.clientHeight)!=null?C:0)},[p.current]);const{data:l}=j.useGetLastGlobalUpdateTimestamp({fetchPolicy:"cache-only"}),g=l==null?void 0:l.lastUpdateTimestamp.timestamp,E=g?K.format(+g):"-";Z(t._({id:"qIrtcK"}),e.jsx(B,{}));const G=s.useCallback(()=>{h&&T({variables:{offset:i.length}})},[h,L]);return c?e.jsx(I,{message:t._({id:"6m5aox"}),messageExtra:H(c),retry:()=>U().catch(M("Updates::refetch"))}):!u&&i.length===0?e.jsx(I,{message:t._({id:"8QWKNI"})}):e.jsxs(e.Fragment,{children:[e.jsx(y,{ref:p,sx:{position:"sticky",top:d,zIndex:Y,backgroundColor:"background.default",marginLeft:"10px",paddingTop:o=>({[o.breakpoints.up("sm")]:{paddingTop:"6px"}})},children:t._({id:"ikVsfm",values:{date:E}})}),e.jsx(F,{persistKey:"updates",heightToSubtract:R,components:{Footer:()=>u?e.jsx(v,{usePadding:!0}):null},overscan:window.innerHeight*.5,endReached:G,groupCounts:f,groupContent:o=>e.jsx(N,{isFirstItem:o===0,children:e.jsx(y,{variant:"h5",component:"h2",children:n[o][m.GROUP]})}),computeItemKey:k,itemContent:o=>e.jsx(V,{children:e.jsx(ee,{chapter:i[o]})})})]})};export{Se as Updates};
