import{u as D,j as a,o as p,ab as i,y as h,m as j,c as v,N as U,A as I,a as x,g as M,E as R,h as b,as as C}from"./index-Zl59rTnr.js";import{T as V}from"./TextSetting-DikKBxMa.js";import{N as k}from"./NumberSetting-D95Za2Yx.js";import{u as P,g as W}from"./usePersistedValue-DpgK_ISR.js";import{a as z,u as O,c as B}from"./metadataServerSettings-Bu9SBxLq.js";import{S as c}from"./Switch-Dz039eWF.js";import{S as H}from"./SelectSetting-DVozOvvZ.js";import{a as q}from"./CategoriesInclusionSetting-C83N_EDv.js";import"./PasswordTextField-D4MXzy1a.js";import"./TextField-lew-bJf8.js";import"./InputAdornment-C6brfzM8.js";import"./Info-CBdRtVcr.js";import"./metadata-3dsaWhfv.js";import"./SwitchBase-B5dQFXOZ.js";import"./Select-BndaAxxl.js";import"./MenuItem-DWrnvo_k.js";import"./ThreeStateCheckboxInput-wO9QFGNa.js";import"./Checkbox-STjbDH5e.js";const S=2,F=10,T=S,G=({downloadAheadLimit:e})=>{const{t:d}=D(),n=!!e,[s,r]=P("lastDownloadAheadLimit",T,e,W),w=l=>{r(l===0?s:l),z("downloadAheadLimit",l).catch(()=>j(d("search.error.label.failed_to_save_settings"),"warning"))},g=l=>{w(l?s:0)};return a.jsxs(p,{children:[a.jsxs(i,{children:[a.jsx(h,{primary:d("download.settings.download_ahead.label.while_reading")}),a.jsx(c,{edge:"end",checked:n,onChange:l=>g(l.target.checked)})]}),a.jsx(k,{settingTitle:d("download.settings.download_ahead.label.unread_chapters_to_download"),settingValue:d("download.settings.download_ahead.label.value",{chapters:s,count:s}),value:s,minValue:S,maxValue:F,defaultValue:T,showSlider:!0,dialogDescription:d("download.settings.download_ahead.label.description"),dialogDisclaimer:d("download.settings.download_ahead.label.disclaimer"),valueUnit:d("chapter.title"),handleUpdate:w,disabled:!n})]})},K=[0,1,2,3,4,5],X={0:{text:"global.label.disabled"},1:{text:"download.settings.delete_chapters.while_reading.option.label.first"},2:{text:"download.settings.delete_chapters.while_reading.option.label.second"},3:{text:"download.settings.delete_chapters.while_reading.option.label.third"},4:{text:"download.settings.delete_chapters.while_reading.option.label.fourth"},5:{text:"download.settings.delete_chapters.while_reading.option.label.fifth"}},Y=K.map(e=>[e,X[e]]),J=e=>typeof e=="boolean"?Number(e):e,Q=({chapterToDelete:e,handleChange:d})=>{const{t:n}=D(),s=J(e);return a.jsx(H,{settingName:n("download.settings.delete_chapters.while_reading.label.title"),value:s,values:Y,handleChange:d})},Z=e=>({downloadAsCbz:e.downloadAsCbz,downloadsPath:e.downloadsPath,autoDownloadNewChapters:e.autoDownloadNewChapters,autoDownloadNewChaptersLimit:e.autoDownloadNewChaptersLimit,excludeEntryWithUnreadChapters:e.excludeEntryWithUnreadChapters,autoDownloadIgnoreReUploads:e.autoDownloadIgnoreReUploads}),xe=()=>{var E,L,N;const{t:e}=D(),{setTitle:d,setAction:n}=v.useContext(U);I("settings"),v.useEffect(()=>(d(e("download.settings.title")),n(null),()=>{d(""),n(null)}),[e]);const s=x.useGetCategories(),r=x.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[w]=x.useUpdateServerSettings(),{settings:g,loading:l,request:{error:m,refetch:A}}=O();if(r.loading||l||s.loading)return a.jsx(M,{});const f=(L=(E=r.error)!=null?E:m)!=null?L:s.error;if(f)return a.jsx(R,{message:e("global.error.label.failed_to_load_data"),messageExtra:f.message,retry:()=>{r.error&&r.refetch().catch(b()),m&&A().catch(b()),s.error&&s.refetch().catch(b())}});const t=Z(r.data.settings),u=(o,y)=>{w({variables:{input:{settings:{[o]:y}}}}).catch(()=>j(e("global.error.label.failed_to_save_changes"),"error"))},_=B(()=>j(e("global.error.label.failed_to_save_changes"),"error"));return a.jsxs(p,{children:[a.jsx(V,{settingName:e("download.settings.download_path.label.title"),dialogDescription:e("download.settings.download_path.label.description"),value:t==null?void 0:t.downloadsPath,handleChange:o=>u("downloadsPath",o)}),a.jsxs(i,{children:[a.jsx(h,{primary:e("download.settings.file_type.label.cbz")}),a.jsx(c,{edge:"end",checked:!!(t!=null&&t.downloadAsCbz),onChange:o=>u("downloadAsCbz",o.target.checked)})]}),a.jsxs(p,{subheader:a.jsx(C,{component:"div",id:"download-settings-auto-delete-downloads",children:e("download.settings.delete_chapters.title")}),children:[a.jsxs(i,{children:[a.jsx(h,{primary:e("download.settings.delete_chapters.label.manually_marked_as_read")}),a.jsx(c,{edge:"end",checked:g.deleteChaptersManuallyMarkedRead,onChange:o=>_("deleteChaptersManuallyMarkedRead",o.target.checked)})]}),a.jsx(Q,{chapterToDelete:g.deleteChaptersWhileReading,handleChange:o=>_("deleteChaptersWhileReading",o)}),a.jsxs(i,{children:[a.jsx(h,{primary:e("download.settings.delete_chapters.label.allow_deletion_of_bookmarked")}),a.jsx(c,{edge:"end",checked:g.deleteChaptersWithBookmark,onChange:o=>_("deleteChaptersWithBookmark",o.target.checked)})]})]}),a.jsxs(p,{subheader:a.jsx(C,{component:"div",id:"download-settings-auto-download",children:e("download.settings.auto_download.title")}),children:[a.jsxs(i,{children:[a.jsx(h,{primary:e("download.settings.auto_download.label.new_chapters")}),a.jsx(c,{edge:"end",checked:!!(t!=null&&t.autoDownloadNewChapters),onChange:o=>u("autoDownloadNewChapters",o.target.checked)})]}),a.jsx(k,{disabled:!(t!=null&&t.autoDownloadNewChapters),settingTitle:e("download.settings.auto_download.download_limit.label.title"),dialogDescription:e("download.settings.auto_download.download_limit.label.description"),value:(N=t==null?void 0:t.autoDownloadNewChaptersLimit)!=null?N:0,settingValue:t.autoDownloadNewChaptersLimit?e("download.settings.download_ahead.label.value",{chapters:t.autoDownloadNewChaptersLimit,count:t.autoDownloadNewChaptersLimit}):e("global.label.none"),defaultValue:0,minValue:0,maxValue:20,showSlider:!0,valueUnit:e("chapter.title"),handleUpdate:o=>u("autoDownloadNewChaptersLimit",o)}),a.jsxs(i,{disabled:!(t!=null&&t.autoDownloadNewChapters),children:[a.jsx(h,{primary:e("download.settings.auto_download.label.ignore_with_unread_chapters")}),a.jsx(c,{edge:"end",checked:!!(t!=null&&t.excludeEntryWithUnreadChapters),onChange:o=>u("excludeEntryWithUnreadChapters",o.target.checked),disabled:!(t!=null&&t.autoDownloadNewChapters)})]}),a.jsxs(i,{disabled:!(t!=null&&t.autoDownloadNewChapters),children:[a.jsx(h,{primary:e("download.settings.auto_download.label.ignore_re_uploads")}),a.jsx(c,{edge:"end",checked:!!(t!=null&&t.autoDownloadIgnoreReUploads),onChange:o=>u("autoDownloadIgnoreReUploads",o.target.checked),disabled:!(t!=null&&t.autoDownloadNewChapters)})]}),a.jsx(q,{categories:s.data.categories.nodes,includeField:"includeInDownload",dialogText:e("download.settings.auto_download.categories.label.include_in_download")})]}),a.jsx(p,{subheader:a.jsx(C,{component:"div",id:"download-settings-download-ahead",children:e("download.settings.download_ahead.title")}),children:a.jsx(G,{downloadAheadLimit:g.downloadAheadLimit})})]})};export{xe as DownloadSettings};
