var E=Object.freeze,I=Object.defineProperty;var G=(t,o)=>E(I(t,"raw",{value:E(o||t.slice())}));import{u as N,c,N as T,V as _,d as P,G as q,a as m,bb as v,j as u,h as A,E as K,k as M}from"./index-D6RYBNhe.js";import{M as O}from"./MangaGrid-C-UKN7ot.js";import{G as Q}from"./GridLayouts-CfA7dJdS.js";import"./index-DGjB4x9H.js";import"./useManageMangaLibraryState-ubfWXGhl.js";import"./CardContent-sLHFs3NZ.js";import"./Avatar-5bJ3DWwf.js";import"./TextField-BsPhsFsz.js";import"./InputAdornment-BMkJJMlZ.js";import"./SpinnerImage--77B1QOy.js";import"./Collapse-DlmjrCDx.js";import"./Link-BNRcdOsD.js";import"./ListPreference-BkA9zf4t.js";import"./Checkbox-CMGh2nfj.js";import"./SwitchBase-B0rT0SwT.js";import"./NumberSetting-B1PCWSx9.js";import"./Info-6eil46u_.js";import"./useMobilePicker-DgqptBYP.js";import"./Chip-BUCSdFfL.js";import"./SelectSetting-8dZue8Rn.js";import"./Select-D4SlXrdS.js";import"./CheckboxInput-CUyC7wfn.js";import"./metadataServerSettings-BzXqSfB-.js";import"./metadata-S3rj_Joy.js";import"./Mangas-DTU0K87K.js";import"./Chapters-CPKjKZCN.js";import"./ThreeStateCheckboxInput-C41jOK86.js";import"./Delete-B9pGU81w.js";import"./Sync-BWeuXktb.js";import"./PlayArrow-COuFmoWi.js";import"./StyledFab-WdkP40Ol.js";import"./ViewModule-m-4_Hwa8.js";var C;const Gr=()=>{var x;const{t}=N(),{setTitle:o,setAction:L}=c.useContext(T),{sourceId:a}=_(),[p,j]=P("migrateGridLayout",q.List),S=m.graphQLClient.client.cache.readFragment({id:m.graphQLClient.client.cache.identify({__typename:"SourceType",id:a}),fragment:v(C||(C=G(["\n            fragment MigratableSource on SourceType {\n                id\n                name\n            }\n        "])))}),[e,w]=c.useState(S!==null?!0:void 0),{data:s,loading:d,error:r,refetch:b}=m.useGetSource(a,{skip:!!e,notifyOnNetworkStatusChange:!0}),{sourceId:g,name:i}={sourceId:a,name:a,...S,...s==null?void 0:s.source},{data:l,loading:y,error:f,refetch:k}=m.useGetMigratableSourceMangas(g,{skip:!e,notifyOnNetworkStatusChange:!0});if(c.useEffect(()=>{var n;return o((n=i!=null?i:g)!=null?n:t("migrate.title")),L(u.jsx(Q,{gridLayout:p,onChange:j})),()=>{o(""),L(null)}},[t,i,g,p]),c.useEffect(()=>{d||e||w(!!s||!!(r!=null&&r.message.includes("The field at path '/source' was declared as a non null type")))},[d,r]),d||!r&&!e||y)return u.jsx(A,{});const h=r&&e===!1;if(h||f){const n=h?r:f;return u.jsx(K,{message:t("global.error.label.failed_to_load_data"),messageExtra:n.message,retry:()=>{h&&b().catch(M()),f&&k().catch(M())}})}return u.jsx(O,{hasNextPage:!1,loadMore:()=>{},isLoading:y,mangas:(x=l==null?void 0:l.mangas.nodes)!=null?x:[],gridLayout:p,mode:"migrate.search"})};export{Gr as Migrate};
