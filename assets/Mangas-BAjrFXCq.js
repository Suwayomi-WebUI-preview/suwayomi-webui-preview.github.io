import{bN as N,bO as D,r as u,bP as U,bQ as L,bM as E,aD as v,G as S,m as I,g as B}from"./index-ChwTeEsl.js";import{b as G,C as W,a as A}from"./Chapters-BwBqMYka.js";import{a as _}from"./Asserts-xItX73wb.js";var s=function(m){return m[m.MANGA=0]="MANGA",m[m.COMIC=1]="COMIC",m[m.WEBTOON=2]="WEBTOON",m[m.MANHWA=3]="MANHWA",m[m.MANHUA=4]="MANHUA",m}({});const Q={id:-1},K={id:-2},V="1 / 1.5",z={[N.Cancelled]:{id:"vv7kpg"},[N.Completed]:{id:"qqWcBV"},[N.Licensed]:{id:"TEl87L"},[N.Ongoing]:{id:"J6n7sl"},[N.OnHiatus]:{id:"VIPoy2"},[N.PublishingFinished]:{id:"bVVRMk"},[N.Unknown]:{id:"Ef7StM"}},F={...G,remove_from_library:{always:!0,bulkAction:!0},change_categories:{always:!1,bulkAction:!1},migrate:{always:!1,bulkAction:!1},track:{always:!1,bulkAction:!1}},k={...W,remove_from_library:{action:{single:{id:"mfwy3x"},selected:{id:"KxYWvv"}},confirmation:{id:"4e5fWk"},success:{id:"weSL4s"},error:{id:"ScjE3w"}},change_categories:{action:{single:{id:"8q9LgC"},selected:{id:"X9czI3"}},confirmation:{id:"huuRa7"},success:{id:"mSZq9u"},error:{id:"tdyb5X"}},migrate:{action:{single:{id:"y5rS9U"},selected:{id:"y5rS9U"}},success:{id:"sogdbA"},error:{id:"bZ8iYS"}},track:{action:{single:{id:"J2ZTMa"},selected:{id:"J2ZTMa"}},success:{id:"hg1vrh"},error:{id:"t0VaCQ"}}},P={[s.MANGA]:[],[s.COMIC]:["8muses","allporncomic","ciayo comics","comicextra","comicpunch","cyanide","dilbert","eggporncomics","existential comics","hiveworks comics","milftoon","myhentaicomics","myhentaigallery","gunnerkrigg","oglaf","patch friday","porncomix","questionable content","readcomiconline","read comics online","swords comic","teabeer comics","xkcd"],[s.WEBTOON]:["mangatoon","manmanga","toomics","webcomics","webtoons","webtoon"],[s.MANHWA]:["hiperdex","hmanhwa","instamanhwa","manhwa18","manhwa68","manhwa365","manhwahentaime","manhwamanga","manhwatop","manhwa","manytoon","manwha","readmanhwa","skymanga","toonily","webtoonxyz"],[s.MANHUA]:["1st kiss manhua","hero manhua","manhuabox","manhuaus","manhuas","manhuas","readmanhua","wuxiaworld","manhua"]};s.MANGA+"",s.COMIC+"",s.WEBTOON+"",s.MANHWA+"",s.MANHUA+"";const H={[s.MANGA]:["Manga","مانگا","Mangá","Манга","மங்கா-","Truyện Nhật"],[s.COMIC]:["Comic","کمیک","Komik","Fumetti","アメコミ","만화","Komiks","Quadrinhos","Комикс","காமிக்","Çizgi roman","Truyện Hoa Kỳ","美漫"],[s.WEBTOON]:["Webtoon","Long strip","ويبتون","وبتون","ウェブトゥーン","웹툰","Веб-комикс","வெப்டூன்-","Вебтун","条漫","條漫","Tira larga","نوار بلند","Bande continue","Függőleges folyamatos","Strip panjang","Striscia lunga","縦読み漫画","긴 스트립","Długi pasek","Tira longa","Длинная полоска","நீண்ட துண்டு","Uzun şerit"],[s.MANHWA]:["Manhwa","Long strip","مانهوا","韓国マンガ","만화","Манхва","மன்அ்வா","Truyện Hàn","韩漫","韓漫","Tira larga","نوار بلند","Bande continue","Függőleges folyamatos","Strip panjang","Striscia lunga","긴 스트립","Długi pasek","Tira longa","Длинная полоска","நீண்ட துண்டு","Uzun şerit","Cuộn dọc","条漫","條漫"],[s.MANHUA]:["Manhua","Long strip","مانها","漫画","만화","Маньхуа","மன்உவா","Truyện Trung","國漫","Tira larga","نوار بلند","Bande continue","Függőleges folyamatos","Strip panjang","Striscia lunga","縦読み漫画","긴 스트립","Długi pasek","Tira longa","Длинная полоска","நீண்ட துண்டு","Uzun şerit","Cuộn dọc","条漫","條漫"]},M=/\s*[,|、]\s*/;class a{static getIds(e){return e.map(t=>t.id)}static getFromCache(e,t=D,r="MANGA_BASE_FIELDS"){return u.graphQLClient.client.cache.readFragment({id:u.graphQLClient.client.cache.identify({__typename:"MangaType",id:e}),fragment:t,fragmentName:r})}static isNotDownloaded({downloadCount:e}){return e===0}static getNotDownloaded(e){return e.filter(a.isNotDownloaded)}static isFullyDownloaded({downloadCount:e,chapters:{totalCount:t}}){return e===t}static getFullyDownloaded(e){return e.filter(a.isFullyDownloaded)}static isPartiallyDownloaded(e){return!a.isNotDownloaded(e)&&!a.isFullyDownloaded(e)}static getPartiallyDownloaded(e){return e.filter(a.isPartiallyDownloaded)}static isUnread({unreadCount:e,chapters:{totalCount:t}}){return e===t}static getUnread(e){return e.filter(a.isUnread)}static isFullyRead({unreadCount:e}){return e===0}static getFullyRead(e){return e.filter(a.isFullyRead)}static isPartiallyRead(e){return!a.isUnread(e)&&!a.isFullyRead(e)}static getPartiallyRead(e){return e.filter(a.isPartiallyRead)}static getThumbnailUrl(e){var r;const t=U.addParams((r=e.thumbnailUrl)!=null?r:"",{fetchedAt:e.thumbnailUrlLastFetched,sourceId:e.sourceId});return u.getValidImgUrlFor(t)}static getDuplicateLibraryMangas(e){return u.getMangas(L,{condition:{inLibrary:!0},filter:{title:{likeInsensitive:e}}})}static async getChapterIdsWithState(e,t){const{data:r}=await u.getMangasChapterIdsWithState(e,t).response;return r.chapters.nodes}static async downloadChapters(e,{size:t,onlyUnread:r,downloadAhead:c=!1}={},i){const[n,d]=await Promise.all([a.getChapterIdsWithState(e,{isRead:r?!1:void 0,isDownloaded:!1}),c?a.getChapterIdsWithState(e,{isRead:!1,isDownloaded:!0}):[]]),p=e.map(h=>[String(h),t]),l=Object.groupBy(n,({mangaId:h})=>h),o=Object.groupBy(d,({mangaId:h})=>h),T=Object.entries(o).map(([h,w=[]])=>{const g=Math.max(0,(t!=null?t:w.length)-w.length);return[h,c?g:t]}),y=Object.entries(Object.fromEntries([...p,...T])).map(([h,w])=>{var R;const g=(R=l[Number(h)])!=null?R:[];if(!g.length)return[];if(w===void 0)return g;const C=A.removeDuplicates(g[0],g).slice(0,w);return A.addDuplicates(C,g)}).flat();return y.length?A.download(A.getIds(y),i):Promise.resolve()}static async deleteChapters(e,t){const r=await a.getChapterIdsWithState(e,{isDownloaded:!0});return A.delete(A.getIds(r),t)}static async markAsRead(e,t=!1,r){const c=await a.getChapterIdsWithState(e,{isRead:!1});return A.markAsRead(c,t,e.length===1?e[0]:void 0,r)}static async markAsUnread(e,t){const r=await a.getChapterIdsWithState(e,{isRead:!0});return A.markAsUnread(A.getIds(r),t)}static async removeFromLibrary(e,t){const{removeMangaFromCategories:r}=await E();return a.executeAction("remove_from_library",e.length,()=>u.updateMangas(e,{updateMangas:{inLibrary:!1},updateMangasCategories:r?{clearCategories:!0}:void 0}).response,t)}static async changeCategories(e,t,r){return a.executeAction("change_categories",e.length,()=>u.updateMangasCategories(e,t).response,r)}static migrateChapters(e,t,r,c){var o,T;if(!t.chapters||!((o=r.fetchChapters)!=null&&o.chapters))throw new Error("Chapters are missing");const i=t.chapters.nodes,n=(T=r.fetchChapters)==null?void 0:T.chapters,d=A.getMatchingChapterNumberChapters(i,n),p=[],l=[];return d.forEach(([f,y])=>{const{isRead:h,isBookmarked:w}=f;h&&p.push(y.id),w&&l.push(y.id)}),{copy:()=>[p.length&&u.updateChapters(p,{isRead:!0}).response,l.length&&u.updateChapters(l,{isBookmarked:!0}).response].filter(f=>!!f),cleanup:()=>{var f,y;return e==="migrate"?[c?u.deleteDownloadedChapters(A.getIds(A.getDownloaded((y=(f=t.chapters)==null?void 0:f.nodes)!=null?y:[]))).response:Promise.resolve()]:[]}}}static migrateTracking(e,t,r){if(!t.trackRecords)throw new Error("TrackRecords of manga to migrate are missing");if(!r.trackRecords)throw new Error("TrackRecords of manga to migrate to are missing");const c=t.trackRecords.nodes.filter(i=>{var n;return(n=r.trackRecords)==null?void 0:n.nodes.every(d=>i.remoteId!==d.remoteId)});return{copy:()=>c.map(i=>u.bindTracker(r.id,i.trackerId,i.remoteId,i.private).response),cleanup:()=>{var i,n;return e==="migrate"?(n=(i=t.trackRecords)==null?void 0:i.nodes.map(d=>u.unbindTracker(d.id).response))!=null?n:[]:[]}}}static migrateManga(e,t,r,c,i){if(c&&!(t!=null&&t.categories))throw new Error("Categories are missing");return{copy:()=>{var n;return[u.updateManga(r.id,{updateManga:{inLibrary:!0},updateMangaCategories:c?{addToCategories:(n=t.categories)==null?void 0:n.nodes.map(d=>d.id)}:void 0}).response]},cleanup:()=>e==="migrate"?[u.updateManga(t.id,{updateManga:{inLibrary:!1},updateMangaCategories:i?{clearCategories:!0}:void 0}).response]:[]}}static async migrate(e,t,{mode:r,migrateChapters:c,migrateCategories:i,migrateTracking:n,deleteChapters:d},p){return a.executeAction("migrate",1,async()=>{var h,w;const[{data:l},{data:o},{removeMangaFromCategories:T}]=await Promise.all([u.getMangaToMigrate(e,{migrateChapters:c,migrateCategories:i,migrateTracking:n,deleteChapters:d}).response,u.getMangaToMigrateToFetch(t,{migrateChapters:c,migrateCategories:i,migrateTracking:n,apolloOptions:{errorPolicy:"all"}}).response,E()]);if(!l.manga||!((h=o==null?void 0:o.fetchManga)!=null&&h.manga))throw new Error("Mangas::migrate: missing manga data");if(c&&!l.manga.chapters)throw new Error("Mangas::migrate: missing chapters data");(w=o.fetchChapters)!=null&&w.chapters||(o.fetchChapters={chapters:[]});const f=async(g,...O)=>Promise.all(O.map(b=>b[g]()).flat());await(async(...g)=>{const O=["copy","cleanup"],b=g.filter(([C])=>C).map(([,C])=>C());for(const C of O)await f(C,...b)})([c,()=>a.migrateChapters(r,l.manga,o,!!d)],[n,()=>a.migrateTracking(r,l.manga,o.fetchManga.manga)],[!0,()=>a.migrateManga(r,l.manga,o.fetchManga.manga,!!i,T)])},p)}static async executeAction(e,t,r,c){const{always:i,bulkAction:n,bulkActionCountForce:d}=F[e],p=!c&&(i||n&&t>1||d&&t>=d),l=k[e].confirmation;try{if(p){_(l);try{await v.show({title:S._({id:"6foA8n"}),message:S.t({...l,values:{count:t}}),actions:{confirm:{title:S._({id:"aP3N/0"})}}})}catch(o){return}}await r(),I(S.t({...k[e].success,values:{count:t}}),"success")}catch(o){throw I(S.t({...k[e].error,values:{count:t}}),"error",B(o)),o}}static async performAction(e,t,{wasManuallyMarkedAsRead:r,changeCategoriesPatch:c,mangaIdToMigrateTo:i,downloadAhead:n,onlyUnread:d,size:p,...l},o){switch(e){case"download":return a.downloadChapters(t,{downloadAhead:n,onlyUnread:d,size:p},o);case"delete":return a.deleteChapters(t,o);case"mark_as_read":return a.markAsRead(t,r,o);case"mark_as_unread":return a.markAsUnread(t,o);case"remove_from_library":return a.removeFromLibrary(t,o);case"change_categories":return a.changeCategories(t,c,o);case"migrate":return a.migrate(t[0],i,l,o);default:throw new Error('Mangas::performAction: unknown action "'.concat(e,'"'))}}static getType(e){return a.isType(e,s.MANGA)?s.MANGA:a.isType(e,s.COMIC)?s.COMIC:a.isType(e,s.WEBTOON)?s.WEBTOON:a.isType(e,s.MANHWA)?s.MANHWA:a.isType(e,s.MANHUA)?s.MANHUA:s.MANGA}static isType(e,t){var i,n;const r=e.genre.some(d=>H[t].some(p=>d.toLowerCase().includes(p.toLowerCase()))),c=P[t].includes((n=(i=e.source)==null?void 0:i.name.toLowerCase())!=null?n:"");return r||c}static isLongStripType(e){return a.isType(e,s.WEBTOON)||a.isType(e,s.MANHWA)||a.isType(e,s.MANHUA)}static getArtists(e){var t;return(t=e.artist)==null?void 0:t.split(M)}static getAuthors(e){var t;return(t=e.author)==null?void 0:t.split(M)}static createLocationState(e,t){return{mangaTitle:e.title,mode:t}}}export{Q as F,K as G,V as M,a,k as b,z as c};
