var W=Object.freeze,ce=Object.defineProperty;var J=(e,t)=>W(ce(e,"raw",{value:W(t||e.slice())}));import{b as s,c as N,j as d,ax as le,ay as ie,p as ue,as as de,B,a6 as ge,dx as fe,f as A,Q as me,R as he,u as ee,r as z,dy as te,i as be,k as pe,n as ve,q as ye,S as q,A as ae,L as Ce,dz as xe,Y as Me,m as j,g as F,d as Se,az as G,cf as Te,dA as we}from"./index-BaJ3TZfy.js";import{D as Ie}from"./Chapters-D2DBFFpr.js";import{a as U}from"./Mangas-BKtpmsN7.js";import{T as Le}from"./ThreeStateCheckboxInput-cwg6xhzU.js";import{C as ke}from"./CheckboxInput-o14X05oY.js";import{F as Ae}from"./FormGroup-CLnpizbz.js";var R=(e=>(e.Mouse="mouse",e.Touch="touch",e.Pointer="pointer",e))(R||{}),O=(e=>(e.CancelledByMovement="cancelled-by-movement",e.CancelledByRelease="cancelled-by-release",e.CancelledOutsideElement="cancelled-outside-element",e))(O||{});const Ee=["mousedown","mousemove","mouseup","mouseleave","mouseout"],_e=["touchstart","touchmove","touchend","touchcancel"],De=["pointerdown","pointermove","pointerup","pointerleave","pointerout"];function je(e){return typeof e=="object"&&e!==null&&"pageX"in e&&typeof e.pageX=="number"&&"pageY"in e&&typeof e.pageY=="number"}function Fe(e){var t;return Ee.includes((t=e==null?void 0:e.nativeEvent)==null?void 0:t.type)}function re(e){var t;return _e.includes((t=e==null?void 0:e.nativeEvent)==null?void 0:t.type)||"touches"in e}function Re(e){const{nativeEvent:t}=e;return t?De.includes(t==null?void 0:t.type)||"pointerId"in t:!1}function $(e){return Fe(e)||re(e)||Re(e)}function Q(e){var t;const a=re(e)?(t=e==null?void 0:e.touches)==null?void 0:t[0]:e;return je(a)?{x:a.pageX,y:a.pageY}:null}function Oe(e){return{target:e.target,currentTarget:e.currentTarget,nativeEvent:e,persist:()=>{}}}function ct(e,{threshold:t=400,captureEvent:a=!1,detect:c=R.Pointer,cancelOnMovement:o=!1,cancelOutsideElement:u=!0,filterEvents:i,onStart:g,onMove:T,onFinish:w,onCancel:I}={}){const m=s.useRef(!1),p=s.useRef(!1),v=s.useRef(),b=s.useRef(),y=s.useRef(e),C=s.useRef(null),S=s.useCallback(r=>l=>{p.current||$(l)&&(i!==void 0&&!i(l)||(a&&l.persist(),g==null||g(l,{context:r}),C.current=Q(l),p.current=!0,v.current=l.currentTarget,b.current=setTimeout(()=>{y.current&&(y.current(l,{context:r}),m.current=!0)},t)))},[a,i,g,t]),h=s.useCallback(r=>(l,n)=>{$(l)&&p.current&&(C.current=null,a&&l.persist(),m.current?w==null||w(l,{context:r}):p.current&&(I==null||I(l,{context:r,reason:n!=null?n:O.CancelledByRelease})),m.current=!1,p.current=!1,b.current!==void 0&&clearTimeout(b.current))},[a,w,I]),x=s.useCallback(r=>l=>{if($(l)&&(T==null||T(l,{context:r}),o!==!1&&C.current)){const n=Q(l);if(n){const f=o===!0?25:o,E={x:Math.abs(n.x-C.current.x),y:Math.abs(n.y-C.current.y)};(E.x>f||E.y>f)&&h(r)(l,O.CancelledByMovement)}}},[h,o,T]),M=s.useCallback(r=>{if(e===null)return{};switch(c){case R.Mouse:{const l={onMouseDown:S(r),onMouseMove:x(r),onMouseUp:h(r)};return u&&(l.onMouseLeave=n=>{h(r)(n,O.CancelledOutsideElement)}),l}case R.Touch:return{onTouchStart:S(r),onTouchMove:x(r),onTouchEnd:h(r)};case R.Pointer:{const l={onPointerDown:S(r),onPointerMove:x(r),onPointerUp:h(r)};return u&&(l.onPointerLeave=n=>h(r)(n,O.CancelledOutsideElement)),l}}},[e,h,u,c,x,S]);return s.useEffect(()=>{function r(l){const n=Oe(l);h()(n)}return window.addEventListener("mouseup",r),window.addEventListener("touchend",r),window.addEventListener("pointerup",r),()=>{window.removeEventListener("mouseup",r),window.removeEventListener("touchend",r),window.removeEventListener("pointerup",r)}},[h]),s.useEffect(()=>()=>{b.current!==void 0&&clearTimeout(b.current)},[]),s.useEffect(()=>{y.current=e},[e]),M}const lt=N(d.jsx("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"})),it=N(d.jsx("path",{d:"m1.79 12 5.58 5.59L5.96 19 .37 13.41zm.45-7.78L12.9 14.89l-1.28 1.28L7.44 12l-1.41 1.41L11.62 19l2.69-2.69 4.89 4.89 1.41-1.41L3.65 2.81zm14.9 9.27L23.62 7 22.2 5.59l-6.48 6.48zM17.96 7l-1.41-1.41-3.65 3.66 1.41 1.41z"})),ut=N(d.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"})),dt=N(d.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"})),gt=({title:e,Icon:t,...a})=>d.jsxs(le,{...a,children:[d.jsx(ie,{children:d.jsx(t,{fontSize:"small"})}),d.jsx(ue,{children:e})]}),ft=(e,t)=>(a,c)=>{const o=c>0?" (".concat(c,")"):"";return"".concat(de(t[a].action[e?"single":"selected"])).concat(o)},mt=e=>(t=!1)=>e?t:!0,ht=e=>t=>e?!1:t,bt=({children:e,...t})=>d.jsx(B,{...t,sx:{minWidth:"unset",px:"10px",...t.sx},children:e}),pt=N(d.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),vt=({children:e,onClose:t,...a})=>{const[c,o]=s.useState(!1);return d.jsx(ge,{...a,open:a.open,onClose:t,sx:{visibility:!a.open||c?"hidden":"visible"},children:e(()=>{t({},"backdropClick"),o(!1)},o)})},Ne={...Ie},Ge=e=>({...e,excludedScanlators:JSON.stringify(e.excludedScanlators)}),Be=(e,t=Ne,a)=>me("manga",e,t,void 0,a),oe=(e,t,a)=>Be({...e,meta:he(e.meta)},t,a),yt=(e,t)=>oe(e,t),Ue=(e,t)=>{const a=oe(e,t,s.useEffect);return s.useMemo(()=>a,[e,t])},ze=async(e,t,a)=>fe(e,[[t,Ge({[t]:a})[t]]]),Pe=(e,t=A())=>(a,c)=>ze(e,a,c).catch(t);function qe(e,{isRead:t}){switch(e){case!0:return!t;case!1:return t;default:return!0}}function $e(e,{isDownloaded:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function He(e,{isBookmarked:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function Ye(e,{scanlator:t}){return!t||!e.includes(t)}const Ve=(e,{sortBy:t,reverse:a})=>{const c=[...e];switch(t){case"source":c.sort((o,u)=>o.sourceOrder-u.sourceOrder);break;case"fetchedAt":c.sort((o,u)=>{var i,g;return Number((i=o.fetchedAt)!=null?i:0)-Number((g=u.fetchedAt)!=null?g:0)});break;case"chapterNumber":c.sort((o,u)=>o.chapterNumber-u.chapterNumber);break;case"uploadedAt":c.sort((o,u)=>{var i,g;return Number((i=o.uploadDate)!=null?i:0)-Number((g=u.uploadDate)!=null?g:0)});break}return a&&c.reverse(),c};function Ke(e,t){return e.filter(a=>qe(t.unread,a)&&$e(t.downloaded,a)&&He(t.bookmarked,a)&&Ye(t.excludedScanlators,a))}function Ct(e,t){const a=Ke(e,t);return Ve(a,t)}const xt=e=>{const{unread:t,downloaded:a,bookmarked:c,excludedScanlators:o}=e;return t!=null||a!=null||c!=null||!!o.length},Mt=e=>{const{unread:t,downloaded:a,bookmarked:c,reverse:o,sortBy:u,showChapterNumber:i,excludedScanlators:g}=Ue(e);return s.useMemo(()=>({unread:t,downloaded:a,bookmarked:c,reverse:o,sortBy:u,showChapterNumber:i,excludedScanlators:g}),[t,a,c,o,u,i,g])},St=(e,t=A())=>Pe(e,t),Xe=(e,{itemIds:t=[],keyCount:a=e,currentKey:c,initialState:o={}})=>{var M;const[u,i]=s.useState(o),g=s.useRef(void 0),T=[...new Set(Object.values(u).flat())],w=T.length===e,I=!T.length,m=(M=u[c])!=null?M:[],p=m.length===a,v=m.length===0;v&&(g.current=void 0);const b=s.useCallback((r,l,{selectRange:n=!1,key:f=c}={})=>{var K;const E=!l,{id:L,key:ne}=(K=g.current)!=null?K:{};g.current={id:r,key:f};const P=n&&f===ne&&L!==void 0,H=P?t.indexOf(L):-1,Y=P?t.indexOf(r):-1,V=P?t.slice(Math.min(H,Y),Math.max(H,Y)+1):[r];if(E){i(_=>{var D,X;return{..._,[f]:(X=(D=_[f])==null?void 0:D.filter(se=>!V.includes(se)))!=null?X:[]}});return}i(_=>{var D;return{..._,[f]:[...new Set([...(D=_[f])!=null?D:[],...V])]}})},[c,t]),y=s.useCallback((r,l,n=c)=>{switch(r){case!0:i(f=>({...f,[n]:[...l]}));break;case!1:i(f=>({...f,[n]:[]}));break}},[c]),C=s.useCallback((r,l)=>{i(n=>({...n,[r]:[...l]}))},[]),S=s.useCallback(r=>u[r],[u]),h=s.useCallback(()=>{i({})},[]),x=s.useCallback(()=>{h(),i(o)},[h,o]);return{selectedItemIds:T,keySelectedItemIds:m,handleSelection:b,handleSelectAll:y,areAllItemsSelected:w,areNoItemsSelected:I,areAllItemsForKeySelected:p,areNoItemsForKeySelected:v,setSelectionForKey:C,getSelectionForKey:S,clearSelection:h,reset:x}},We=0;class k{static getIds(t){return t.map(a=>a.id)}static getUserCreated(t){return t.filter(a=>a.id!==We)}static getDefaults(t){return t.filter(a=>a.default)}}const Je=e=>{const{data:t}=z.useGetManga(xe,e!=null?e:-1,{skip:e===void 0});return s.useMemo(()=>e===void 0||!t?[]:k.getIds(t.manga.categories.nodes),[t==null?void 0:t.manga.categories.nodes,e])},Qe=(e,t,a,c)=>{if(t.includes(e))return!0;if(!c&&a.includes(e))return!1};function Ze(e){const{t}=ee(),{onCancel:a,onConfirm:c,mangaId:o,mangaIds:u,addToLibrary:i=!1}=e,g=o!==void 0,T=u!=null?u:[o],[w,I]=s.useState(!1),m=Je(o),{data:p}=z.useGetCategories(te),v=p==null?void 0:p.categories.nodes,b=s.useMemo(()=>k.getUserCreated(v!=null?v:[]),[v]),y=s.useMemo(()=>i?k.getIds(k.getDefaults(b)):[],[b]),{handleSelection:C,setSelectionForKey:S,getSelectionForKey:h}=Xe(b.length,{currentKey:"categoriesToAdd",initialState:{categoriesToAdd:[...m,...y],categoriesToRemove:[]}});s.useEffect(()=>{S("categoriesToAdd",[...m,...y]),S("categoriesToRemove",[])},[m]);const x=h("categoriesToAdd"),M=h("categoriesToRemove"),r=()=>{S("categoriesToAdd",m),S("categoriesToRemove",[]),a()},l=()=>{const n=g?x.filter(L=>!m.includes(L)):x,f=g?m.filter(L=>!x.includes(L)):M;c({addToCategories:n,removeFromCategories:f}),w&&Me("showAddToLibraryCategorySelectDialog",!1).catch(L=>j(t("search.error.label.failed_to_save_settings"),"error",F(L))),(n.length||f.length)&&(i||U.performAction("change_categories",T,{changeCategoriesPatch:{addToCategories:n,removeFromCategories:f}}).catch(A()))};return d.jsxs(be,{sx:{".MuiDialog-paper":{maxHeight:435,width:"80%"}},maxWidth:"xs",open:!0,onClose:r,children:[d.jsx(pe,{children:t("category.title.set_categories")}),d.jsx(ve,{dividers:!0,children:d.jsxs(Ae,{children:[b.length===0&&d.jsx("span",{children:t("category.error.no_categories_found.label.info")}),b.map(n=>d.jsx(Le,{checked:Qe(n.id,x,M,g),onChange:f=>{C(n.id,!1,{key:"categoriesToAdd"}),C(n.id,!1,{key:"categoriesToRemove"}),f&&C(n.id,!0,{key:"categoriesToAdd"}),f===!1&&C(n.id,!0,{key:"categoriesToRemove"})},label:n.name},n.id))]})}),d.jsx(ye,{children:d.jsxs(q,{sx:{width:"100%"},children:[i&&d.jsx(ke,{sx:{margin:0},size:"small",label:t("global.button.dont_show_dialog_again"),onChange:n=>I(n.target.checked)}),d.jsxs(q,{direction:"row",sx:{justifyContent:"space-between",alignItems:"end",width:"100%"},children:[d.jsx(B,{component:Ce,to:ae.settings.childRoutes.categories.path,children:t(b.length?"global.button.edit":"global.button.create")}),d.jsxs(q,{direction:"row",children:[d.jsx(B,{autoFocus:!0,onClick:r,color:"primary",children:t("global.button.cancel")}),!!b.length&&d.jsx(B,{onClick:l,color:"primary",children:t("global.button.ok")})]})]})]})})]})}var Z;const Tt=(e,t=!1)=>{var w,I;const{t:a}=ee(),c=Se(),[o,u]=s.useState(!!e.inLibrary),i=s.useCallback((m=[],p=[])=>{z.updateManga(e.id,{updateManga:{inLibrary:!0},updateMangaCategories:{addToCategories:m,removeFromCategories:p}}).response.then(()=>j(a("library.info.label.added_to_library"),"success")).then(()=>u(!0)).catch(v=>{j(a("library.error.label.add_to_library"),"error",F(v))})},[e.id]),g=s.useCallback(async()=>{t&&await G.confirm("manga-library-state-remove-".concat(e.id),{title:a("global.label.are_you_sure"),message:a("manga.action.library.remove.dialog.label.message",{title:e.title}),actions:{confirm:{title:a("global.button.remove")}}}),await U.removeFromLibrary([e.id],!0),u(!1)},[e.id,t]);return{updateLibraryState:s.useCallback(()=>{const m=async()=>{if(o){g().catch(A());return}let p;try{p=(await we()).showAddToLibraryCategorySelectDialog}catch(M){j(a("global.error.label.failed_to_load_data"),"error",F(M));return}let v;try{v=await z.getCategories(te).response}catch(M){j(a("category.error.label.request_failure"),"error",F(M));return}const b=k.getUserCreated(v.data.categories.nodes);let y;try{y=await U.getDuplicateLibraryMangas(e.title).response}catch(M){await G.confirm("manga-library-state-add-".concat(e.id),{title:a("global.error.label.failed_to_load_data"),message:a("manga.action.library.add.dialog.duplicate.label.failure",{error:F(M)}),actions:{extra:{show:!0,title:a("global.button.retry"),contain:!0},confirm:{title:a("global.button.add")}},onExtra:()=>m().catch(A())})}if((y==null?void 0:y.data.mangas.totalCount)&&await G.confirm("manga-library-state-add-duplicated-".concat(e.id),{title:a("global.label.are_you_sure"),message:a("manga.action.library.add.dialog.duplicate.label.info"),actions:{extra:{show:!0,title:a("migrate.dialog.action.button.show_entry"),contain:!0},confirm:{title:a("global.button.add")}},onExtra:()=>c(ae.manga.path(y.data.mangas.nodes[0].id))}),!(p&&!!b.length)){i(k.getIds(k.getDefaults(b)));return}const{addToCategories:h,removeFromCategories:x}=await G.show("manga-library-state-add-categories-".concat(e.id),Ze,{mangaId:e.id,addToLibrary:!0});i(h,x)};m().catch(A())},[o,g,i]),isInLibrary:(I=(w=U.getFromCache(e.id,Te(Z||(Z=J(["\n                    fragment MangaInLibraryState on MangaType {\n                        inLibrary\n                    }\n                "]))),"MangaInLibraryState"))==null?void 0:w.inLibrary)!=null?I:o}};export{bt as C,ut as D,dt as F,vt as M,it as R,ct as V,Mt as a,St as b,Tt as c,Ze as d,mt as e,Ct as f,gt as g,lt as h,xt as i,ft as j,ht as k,pt as l,yt as m,Ke as n,Xe as u};
