var S=Object.defineProperty;var I=s=>{throw TypeError(s)};var O=(s,n,r)=>n in s?S(s,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[n]=r;var l=(s,n,r)=>O(s,typeof n!="symbol"?n+"":n,r),R=(s,n,r)=>n.has(s)||I("Cannot "+r);var m=(s,n,r)=>(R(s,n,"read from private field"),r?r.call(s):n.get(s)),K=(s,n,r)=>n.has(s)?I("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(s):n.set(s,r),y=(s,n,r,w)=>(R(s,n,"write to private field"),w?w.call(s,r):n.set(s,r),r);var k=(s,n,r,w)=>({set _(v){y(s,n,v,r)},get _(){return m(s,n,w)}});(function(){"use strict";var u,M,P,N,x;const s=i=>i.toLowerCase().trim(),n=i=>s(i).replace(/[^a-zA-Z0-9\\s]+/g," ").trim(),r=i=>{const e=Object.groupBy(i,({title:t})=>n(t));return Object.fromEntries(Object.entries(e).filter(t=>{var o,c;return((c=(o=t[1])==null?void 0:o.length)!=null?c:0)>1}).map(([,t])=>[t[0].title,t]))};class w{constructor(e){l(this,"value");l(this,"next");this.value=e}}let v=(N=class{constructor(){K(this,u);K(this,M);K(this,P);this.clear()}enqueue(e){const t=new w(e);m(this,u)?(m(this,M).next=t,y(this,M,t)):(y(this,u,t),y(this,M,t)),k(this,P)._++}dequeue(){const e=m(this,u);if(e)return y(this,u,m(this,u).next),k(this,P)._--,e.value}peek(){if(m(this,u))return m(this,u).value}clear(){y(this,u,void 0),y(this,M,void 0),y(this,P,0)}get size(){return m(this,P)}*[Symbol.iterator](){let e=m(this,u);for(;e;)yield e.value,e=e.next}},u=new WeakMap,M=new WeakMap,P=new WeakMap,N);function F(i){q(i);const e=new v;let t=0;const o=()=>{t<i&&e.size>0&&(e.dequeue()(),t++)},c=()=>{t--,o()},h=async(a,g,p)=>{const f=(async()=>a(...p))();g(f);try{await f}catch(b){}c()},T=(a,g,p)=>{new Promise(f=>{e.enqueue(f)}).then(h.bind(void 0,a,g,p)),(async()=>(await Promise.resolve(),t<i&&o()))()},d=(a,...g)=>new Promise(p=>{T(a,p,g)});return Object.defineProperties(d,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value(){e.clear()}},concurrency:{get:()=>i,set(a){q(a),i=a,queueMicrotask(()=>{for(;t<i&&e.size>0;)o()})}}}),d}function q(i){if(!((Number.isInteger(i)||i===Number.POSITIVE_INFINITY)&&i>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up")}class j{constructor(){l(this,"orgResolve");l(this,"orgReject");l(this,"promise");this.promise=new Promise((e,t)=>{this.orgResolve=e,this.orgReject=t})}resolve(e){this.orgResolve(e)}reject(e){this.orgReject(e)}}class z{constructor(e){l(this,"queue");l(this,"counter",0);l(this,"pendingKeyToPriorityMap",new Map);l(this,"pendingKeyToFnMap",new Map);l(this,"pendingKeyToPromiseMap",new Map);this.queue=F(e)}clear(){this.pendingKeyToPromiseMap.forEach(e=>{e.reject(new Error("Queue::clear: called"))}),this.pendingKeyToPriorityMap.clear(),this.pendingKeyToFnMap.clear(),this.pendingKeyToPromiseMap.clear()}enqueue(e,t,o=1){this.counter=(this.counter+1)%(1/0);const c="".concat(e,"_").concat(this.counter);this.pendingKeyToPriorityMap.set(c,o),this.pendingKeyToFnMap.set(c,t);const h=new j;return this.pendingKeyToPromiseMap.set(c,h),this.queue(()=>this.process()),{key:c,promise:h.promise}}isProcessing(e){return!this.pendingKeyToFnMap.has(e)}async process(){const{fn:e,promise:t}=this.getNextItemToProcess();try{const o=await e();t.resolve(o)}catch(o){t.reject(o)}}getNextItemToProcess(){const[e]=[...this.pendingKeyToPriorityMap.entries()].toSorted(([,c],[,h])=>h-c)[0],t=this.pendingKeyToFnMap.get(e),o=this.pendingKeyToPromiseMap.get(e);return this.pendingKeyToPriorityMap.delete(e),this.pendingKeyToFnMap.delete(e),this.pendingKeyToPromiseMap.delete(e),{key:e,fn:t,promise:o}}}const Q=new z(((x=navigator.hardwareConcurrency)!=null?x:5)-1),C=200;self.onmessage=async i=>{const{mangas:e,checkAlternativeTitles:t}=i.data;if(!t){postMessage(r(e));return}const o=[];for(let d=0;d<e.length;d+=C)o.push(Q.enqueue(d.toString(),()=>{const a=new j,g=new Worker(new URL("/assets/LibraryDuplicatesDescriptionWorker-Bd9y3Q0p.js",self.location.href),{type:"module"});return g.onmessage=p=>a.resolve(p.data),g.postMessage({mangas:e,mangasToCheck:e.slice(d,d+C)}),a.promise}).promise);const c=await Promise.all(o),h={},T={};c.forEach(d=>Object.entries(d).forEach(([a,g])=>{var b,E;const p=n(a);(b=T[p])!=null||(T[p]=a);const f=T[p];(E=h[f])!=null||(h[f]=g)})),postMessage(h)}})();
