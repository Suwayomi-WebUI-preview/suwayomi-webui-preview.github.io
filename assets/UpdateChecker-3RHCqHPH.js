import{c as U,j as s,u as M,aX as E,f as j,r as i,k as g,az as G,C as L,I as P,aA as R,b as S,bA as D,bi as F,ap as v,m as C,g as I}from"./index-B2GoEHwF.js";import{R as w}from"./Refresh-BMiGKSzZ.js";import{P as z}from"./Progress-1gGStKMM.js";import{d as H}from"./DateHelper-D3lpn-0-.js";const J=U(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}));let o=!1;function q({categoryId:m,handleFinishedUpdate:n}){const{i18n:t,_:A}=M(),u=E.useIsTouchDevice(),[p,f]=j.useState(!1),{data:c,refetch:h}=i.useGetLastGlobalUpdateTimestamp(),{data:l}=i.useGetGlobalUpdateSummary(),a=l==null?void 0:l.libraryUpdateStatus,x=c==null?void 0:c.lastUpdateTimestamp.timestamp,T=x?H.format(+x):"-",r=!!(a!=null&&a.jobsInfo.isRunning),b=a?a.jobsInfo.finishedJobs/a.jobsInfo.totalJobs*100:0;j.useEffect(()=>{!o&&r&&(o=!0),o&&b===100&&(o=!1,n==null||n(),h().catch(g("UpdateChecker::reFetchLastTimestamp")))},[r]);const k=async e=>{try{o=!0,await i.startGlobalUpdate(e!==void 0?[e]:void 0).response,h().catch(g("UpdateChecker::reFetchLastTimestamp"))}catch(y){o=!1,C(t._({id:"GIPEGD"}),"error",I(y))}},_=async()=>{try{await i.resetGlobalUpdate()}catch(e){C(t._({id:"fDi5p7"}),"error",I(e))}},d=async e=>{r?_():k(e)};return s.jsx(G,{variant:"popover",popupId:"library-update-checker-menu",children:e=>s.jsxs(s.Fragment,{children:[s.jsx(L,{title:r?t._({id:"DVE+rc"}):t._({id:"XN5JBu",values:{date:T}}),children:s.jsx(P,{sx:{position:"relative"},...m!==void 0&&!r?R(e):{onClick:()=>d()},onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),color:"inherit",children:r?s.jsxs(s.Fragment,{children:[s.jsx(J,{sx:{opacity:Number(u||p)}}),s.jsx(S,{sx:{position:"absolute"},children:s.jsx(z,{progress:b,showText:!u&&!p,progressProps:{color:"inherit"}})})]}):s.jsx(w,{})})}),s.jsxs(D,{...F(e),children:[s.jsx(v,{onClick:()=>{e.close(),d()},children:t._({id:"t5Cp+z"})}),s.jsx(v,{onClick:()=>{e.close(),d(m)},children:t._({id:"xdDySy"})})]})]})})}export{J as C,q as U};
