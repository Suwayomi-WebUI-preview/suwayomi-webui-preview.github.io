import{e as s,j as e,Z as T,A as S,L as P,o as k,u as M,a as A,r as b,h as _,i as v,T as j,bj as F,g as H}from"./index-aZAYJyS4.js";import{E as y}from"./EmptyViewAbsoluteCentered-DuhzzeXt.js";import{U as O}from"./UpdateChecker-BRrOgoH3.js";import{V as l,a as B,S as N,b as V}from"./Virtuoso.util-CnjvRNKg.js";import{C as K,D as q}from"./ChapterCardMetadata-Ip78TzrF.js";import{C as D,a as W}from"./ChapterDownloadButton-NOtf72Kc.js";import{C as Z}from"./ChapterDownloadRetryButton-CPfUE3kd.js";import{L as z}from"./ListCardContent-B85hFp28.js";import{C as J}from"./Card-CH9zzWdx.js";import{C as Q}from"./CardActionArea-CfoAtrDw.js";import"./Progress-BHo3_l4t.js";import"./MUI.util-r5Z85em7.js";import"./ListCardAvatar-BJZxAsGP.js";import"./Avatar-oPpylDbK.js";import"./Download-CujgmOGc.js";import"./CardContent-588ia9mS.js";const X=s.memo(({chapter:t})=>{const{manga:o}=t;return e.jsx(J,{children:e.jsx(Q,{component:P,to:S.reader.path(t.manga.id,t.sourceOrder),state:T.getReaderOpenChapterLocationState(t),sx:{color:d=>d.palette.text[t.isRead?"disabled":"primary"]},children:e.jsxs(z,{sx:{justifyContent:"space-between"},children:[e.jsxs(k,{sx:{display:"flex",flexGrow:1,gap:1},children:[e.jsx(D,{mangaId:o.id,mangaTitle:o.title,thumbnailUrl:o.thumbnailUrl,thumbnailUrlLastFetched:o.thumbnailUrlLastFetched}),e.jsx(K,{title:o.title,secondaryText:t.name})]}),e.jsx(q,{chapterId:t.id}),e.jsx(Z,{chapterId:t.id}),e.jsx(W,{chapterId:t.id,isDownloaded:t.isDownloaded})]})})})}),he=()=>{var x;const{t}=M(),{setTitle:o,setAction:d}=A(),{data:r,loading:c,error:h,fetchMore:L,refetch:U}=b.useGetRecentlyUpdatedChapters(void 0,{fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),g=!!(r!=null&&r.chapters.pageInfo.hasNextPage),w=r==null?void 0:r.chapters.pageInfo.endCursor,n=(x=r==null?void 0:r.chapters.nodes)!=null?x:[],i=s.useMemo(()=>Object.entries(T.groupByDate(n,"fetchedAt")),[n]),f=s.useMemo(()=>i.map(a=>a[l.ITEMS].length),[i]),I=l.useCreateGroupedComputeItemKey(f,s.useCallback(a=>i[a][l.GROUP],[i]),s.useCallback(a=>n[a].id,[n])),m=s.useRef(null),[E,R]=s.useState(0);s.useLayoutEffect(()=>{var a,C;R((C=(a=m.current)==null?void 0:a.clientHeight)!=null?C:0)},[m.current]);const{data:p}=b.useGetLastGlobalUpdateTimestamp({fetchPolicy:"cache-only"}),u=p==null?void 0:p.lastUpdateTimestamp.timestamp;s.useLayoutEffect(()=>(o(t("updates.title")),d(e.jsx(O,{})),()=>{o(""),d(null)}),[t,u]);const G=s.useCallback(()=>{g&&L({variables:{offset:n.length}})},[g,w]);return h?e.jsx(y,{message:t("global.error.label.failed_to_load_data"),messageExtra:_(h),retry:()=>U().catch(v())}):!c&&n.length===0?e.jsx(y,{message:t("updates.error.label.no_updates_available")}):e.jsxs(e.Fragment,{children:[e.jsx(j,{ref:m,sx:{marginLeft:"10px",paddingTop:a=>({[a.breakpoints.up("sm")]:{paddingTop:"6px"}})},children:t("library.settings.global_update.label.last_update",{date:u?F.format(+u):"-"})}),e.jsx(B,{heightToSubtract:E,style:{height:"undefined"},components:{Footer:()=>c?e.jsx(H,{usePadding:!0}):null},overscan:window.innerHeight*.5,endReached:G,groupCounts:f,groupContent:a=>e.jsx(V,{isFirstItem:a===0,children:e.jsx(j,{variant:"h5",component:"h2",children:i[a][l.GROUP]})}),computeItemKey:I,itemContent:a=>e.jsx(N,{children:e.jsx(X,{chapter:n[a]})})})]})};export{he as Updates};
