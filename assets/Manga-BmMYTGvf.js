import{r as B,i as L,j as e,u as w,q as He,c as x,x as Se,h as Re,y as le,P as ie,S as j,L as Q,T as z,z as Ge,f as I,I as y,A as X,C as $e,D as qe,F as Y,s as A,H as We,w as Ue,M as Ke,n as Qe,a as O,J as Je,g as Te,E as K,K as De,B as Be,O as Xe,e as Ye,G as Ze,Q as et,R as tt,m as oe,U as rt,V as at,W as st,d as nt,X as ot,Y as lt,Z as _e,_ as ee,$ as te,a0 as re,N as it,a1 as dt,a2 as ct,a3 as ut,a4 as ht}from"./index-CkjnowZ5.js";import{C as pt,V as ft}from"./index-D6uGDnTt.js";import{M as $,d as mt,a as gt,b as xt,c as bt,e as jt,f as kt,J as Le,g as vt,h as Ct,u as _t,C as yt,T as wt,i as It,j as Mt,k as St,l as Rt,m as ye,n as we}from"./useManageMangaLibraryState-DEW_hV5h.js";import{D as $t}from"./DownloadStateIndicator-DIxwj1Sk.js";import{d as Tt}from"./Delete-D4W5gDVg.js";import{C as v,a as Dt}from"./Chapters-bz-c3F-B.js";import{T as Bt}from"./TypographyMaxLines-zMpwJlAC.js";import{C as Lt,a as At}from"./CardContent-CHKE7sTP.js";import{C as Ft}from"./Checkbox-TAMhYvzJ.js";import{d as Ot}from"./PlayArrow-vuuOT1v2.js";import{S as Nt,D as Et}from"./StyledFab-CYta0SLz.js";import{d as Pt}from"./FilterList-DTTsS0v1.js";import{S as zt,R as Ie}from"./SortRadioInput-B9wPO_Wj.js";import{T as ae}from"./ThreeStateCheckboxInput-DJ5ObDwA.js";import{O as Vt,a as Ht,S as Gt,d as qt}from"./SelectionFAB-K75ds_nM.js";import{R as Wt}from"./ListPreference-D8a6JRV9.js";import{M as J}from"./Mangas-Bnch4SYr.js";import{b as Ut}from"./Strings-CWt9sr6N.js";import{d as Kt,a as Qt,b as Jt}from"./ExpandMore-DTgW9b5L.js";import{S as Me}from"./SpinnerImage-Bf7RqXFe.js";import{C as de}from"./CustomIconButton-moaH6fvl.js";import{d as Xt}from"./Sync-C-J1NqAW.js";import{T as se}from"./Trackers-D4pSmk7a.js";import{L as Yt}from"./Link-BC81DK2a.js";import{C as Zt}from"./Collapse-BSRT7jVv.js";import{C as er}from"./Chip-lTwdG_wj.js";import"./Avatar-gQRJJGg7.js";import"./Info-nz9elGvL.js";import"./TextField-CJnfilCU.js";import"./InputAdornment-BVJgoBQ7.js";import"./NumberSetting-C3bwLpe2.js";import"./useMobilePicker-BYN2KXIk.js";import"./SelectSetting-Cgu0Xpqa.js";import"./Select-Bvz65aY1.js";import"./CheckboxInput-DCmj9yHg.js";import"./SwitchBase-FvMIbsQX.js";import"./Tabs-ChdrTNO8.js";var ce={},tr=L;Object.defineProperty(ce,"__esModule",{value:!0});var Ae=ce.default=void 0,rr=tr(B()),ar=e;Ae=ce.default=(0,rr.default)((0,ar.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");var ue={},sr=L;Object.defineProperty(ue,"__esModule",{value:!0});var he=ue.default=void 0,nr=sr(B()),or=e;he=ue.default=(0,nr.default)((0,or.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll");var pe={},lr=L;Object.defineProperty(pe,"__esModule",{value:!0});var Fe=pe.default=void 0,ir=lr(B()),dr=e;Fe=pe.default=(0,ir.default)((0,dr.jsx)("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"}),"Bookmark");var fe={},cr=L;Object.defineProperty(fe,"__esModule",{value:!0});var Oe=fe.default=void 0,ur=cr(B()),hr=e;Oe=fe.default=(0,ur.default)((0,hr.jsx)("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"}),"BookmarkRemove");var me={},pr=L;Object.defineProperty(me,"__esModule",{value:!0});var Ne=me.default=void 0,fr=pr(B()),mr=e;Ne=me.default=(0,fr.default)((0,mr.jsx)("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"}),"BookmarkAdd");var ge={},gr=L;Object.defineProperty(ge,"__esModule",{value:!0});var xe=ge.default=void 0,xr=gr(B()),br=e;xe=ge.default=(0,xr.default)((0,br.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"Launch");class _{static getChapters(r){return r.map(({chapter:a})=>a)}static getIds(r){return v.getIds(_.getChapters(r))}static getDownloaded(r){return r.filter(({chapter:a})=>v.isDownloaded(a))}static getDeletable(r,a){return r.filter(({chapter:n})=>v.isDeletable(n,a))}static getNonDownloaded(r){return r.filter(({chapter:a})=>!v.isDownloaded(a))}static getDownloadable(r){return r.filter(({chapter:a,downloadChapter:n})=>!v.isDownloaded(a)&&!n)}static getBookmarked(r){return r.filter(({chapter:a})=>v.isBookmarked(a))}static getNonBookmarked(r){return r.filter(({chapter:a})=>!v.isBookmarked(a))}static getRead(r){return r.filter(({chapter:a})=>v.isRead(a))}static getNonRead(r){return r.filter(({chapter:a})=>!v.isRead(a))}}const Ee=({chapter:t,allChapters:r,handleSelection:a,canBeDownloaded:n=!1,selectedChapters:s=[],onClose:i})=>{const{t:o}=w(),d=!!t,{isDownloaded:k,isRead:p,isBookmarked:f}=t!=null?t:{},{settings:{deleteChaptersWithBookmark:l}}=He(),b=bt(d,Dt),h=jt(d),C=kt(d),{downloadableChapters:c,downloadedChapters:m,unbookmarkedChapters:g,bookmarkedChapters:N,unreadChapters:F,readChapters:E}=x.useMemo(()=>({downloadableChapters:_.getDownloadable(s),downloadedChapters:_.getDownloaded(s),unbookmarkedChapters:_.getNonBookmarked(s),bookmarkedChapters:_.getBookmarked(s),unreadChapters:_.getNonRead(s),readChapters:_.getRead(s)}),[s]),V=()=>{a==null||a(t.id,!0),i()},M=(H,T)=>{var q;const P=H==="mark_prev_as_read",G=P?"mark_as_read":H;if(G==="delete"&&t&&!v.isDeletable(t,l)){i();return}const D=(()=>{if(!t)return _.getChapters(T);if(!P)return[t];const S=r.findIndex(({id:W})=>W===t.id);return S+1>r.length-1?[]:r.slice(S+1)})();if(!D.length){i();return}v.performAction(G,v.getIds(D),{chapters:D,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(q=D[0])==null?void 0:q.mangaId}).catch(Re()),i()};return e.jsxs(e.Fragment,{children:[d&&e.jsx($,{onClick:V,Icon:mt,title:o("chapter.action.label.select")}),d&&e.jsx($,{Icon:xe,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),i()},title:o("chapter.action.label.open_on_source")}),h(n)&&e.jsx($,{Icon:Se,disabled:C(!c.length),onClick:()=>M("download",c),title:b("download",c.length)}),h(k)&&e.jsx($,{Icon:Tt,disabled:C(!m.length),onClick:()=>M("delete",_.getDeletable(m,l)),title:b("delete",m.length)}),h(!f)&&e.jsx($,{Icon:Ne,disabled:C(!g.length),onClick:()=>M("bookmark",g),title:b("bookmark",g.length)}),h(f)&&e.jsx($,{Icon:Oe,disabled:C(!N.length),onClick:()=>M("unbookmark",N),title:b("unbookmark",N.length)}),h(!p)&&e.jsx($,{Icon:gt,disabled:C(!F.length),onClick:()=>M("mark_as_read",F),title:b("mark_as_read",F.length)}),h(p)&&e.jsx($,{Icon:xt,disabled:C(!E.length),onClick:()=>M("mark_as_unread",E),title:b("mark_as_unread",E.length)}),d&&e.jsx($,{onClick:()=>M("mark_prev_as_read",[]),Icon:he,title:o("chapter.action.mark_as_read.add.label.action.previous")})]})},jr=t=>{const{t:r}=w(),a=le(),n=x.useRef(null),{chapter:s,allChapters:i,downloadChapter:o,showChapterNumber:d,onSelect:k,selected:p}=t,f=p!==null,{isDownloaded:l}=s,b=c=>{f&&(c.preventDefault(),c.stopPropagation(),k(!p,c.shiftKey))},h=(c,m)=>{c.stopPropagation(),c.preventDefault(),m(c)},C=Le((c,{context:m})=>{if(!f&&n.current){h(c,()=>m==null?void 0:m(n.current));return}c.shiftKey=!0,b(c)});return e.jsx("li",{children:e.jsx(ie,{variant:"popover",popupId:"chapter-card-action-menu",children:c=>{var m;return e.jsxs(j,{sx:{pt:1,px:1},children:[e.jsx(Lt,{sx:{touchCallout:"none"},children:e.jsx(pt,{component:Q,to:"/manga/".concat(s.mangaId,"/chapter/").concat(s.sourceOrder),style:{color:a.palette.text[s.isRead?"disabled":"primary"]},onClick:g=>b(g),...C(c.open),children:e.jsxs(At,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5,"&:last-child":{pb:1.5}},children:[e.jsxs(j,{direction:"column",flex:1,children:[e.jsxs(j,{sx:{flexDirection:"row",gap:.5,alignItems:"center"},children:[s.isBookmarked&&e.jsx(Fe,{color:"primary"}),e.jsx(Bt,{variant:"h6",component:"h4",children:d?"".concat(r("chapter.title_one")," ").concat(s.chapterNumber):s.name})]}),e.jsx(z,{variant:"caption",children:s.scanlator}),e.jsxs(z,{variant:"caption",children:[Ge(Number((m=s.uploadDate)!=null?m:0),!0),l&&" â€¢ ".concat(r("chapter.status.label.downloaded"))]})]}),o&&e.jsx($t,{download:o}),e.jsx(j,{sx:{minHeight:"48px"},children:p===null?e.jsx(I,{title:r("global.button.options"),children:e.jsx(y,{ref:n,...X(c),onClick:g=>h(g,c.open),onTouchStart:g=>h(g,c.open),"aria-label":"more",size:"large",children:e.jsx(vt,{})})}):e.jsx(I,{title:r(p?"global.button.deselect":"global.button.select"),children:e.jsx(Ft,{checked:p})})})]})})}),!f&&c.isOpen&&e.jsx(Ct,{...$e(c),children:g=>e.jsx(Ee,{onClose:g,chapter:s,allChapters:i,handleSelection:()=>k(!0),canBeDownloaded:!s.isDownloaded&&!o})})]})}})})};function kr(t){const{t:r}=w(),{chapterIndex:a,mangaId:n}=t;return e.jsxs(Nt,{component:Q,variant:"extended",color:"primary",to:"/manga/".concat(n,"/chapter/").concat(a),children:[e.jsx(Ot,{}),r(a===1?"global.button.start":"global.button.resume")]})}const vr={active:!1,unread:void 0,downloaded:void 0,bookmarked:void 0,reverse:!0,sortBy:"source",showChapterNumber:!1};function Cr(t,r){switch(r.type){case"filter":return{...t,active:t.unread!==!1&&t.downloaded!==!1&&t.bookmarked!==!1,[r.filterType]:r.filterValue};case"sortBy":return{...t,sortBy:r.sortBy};case"sortReverse":return{...t,reverse:!t.reverse};case"showChapterNumber":return{...t,showChapterNumber:!t.showChapterNumber};default:throw Error(Y("global.error.label.invalid_action"))}}function _r(t,{isRead:r}){switch(t){case!0:return!r;case!1:return r;default:return!0}}function yr(t,{isDownloaded:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}function wr(t,{isBookmarked:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}const Ir=(t,{sortBy:r,reverse:a})=>{const n=[...t];switch(r){case"source":n.sort((s,i)=>s.sourceOrder-i.sourceOrder);break;case"fetchedAt":n.sort((s,i)=>{var o,d;return Number((o=s.fetchedAt)!=null?o:0)-Number((d=i.fetchedAt)!=null?d:0)});break;case"chapterNumber":n.sort((s,i)=>s.chapterNumber-i.chapterNumber);break;case"uploadedAt":n.sort((s,i)=>{var o,d;return Number((o=s.uploadDate)!=null?o:0)-Number((d=i.uploadDate)!=null?d:0)});break}return a&&n.reverse(),n};function Mr(t,r){const a=r.active?t.filter(n=>_r(r.unread,n)&&yr(r.downloaded,n)&&wr(r.bookmarked,n)):[...t];return Ir(a,r)}const Sr=t=>qe(Cr,"".concat(t,"filterOptions"),vr),Rr={source:"global.sort.label.by_source",chapterNumber:"global.sort.label.by_chapter_number",uploadedAt:"global.sort.label.by_upload_date",fetchedAt:"global.sort.label.by_fetch_date"},$r=t=>{const{unread:r,downloaded:a,bookmarked:n}=t;return r!=null||a!=null||n!=null},Tr={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},Dr=({open:t,onClose:r,options:a,optionsDispatch:n})=>{const{t:s}=w();return e.jsx(Vt,{open:t,onClose:r,minHeight:150,tabs:["filter","sort","display"],tabTitle:i=>s(Tr[i]),tabContent:i=>i==="filter"?e.jsxs(e.Fragment,{children:[e.jsx(ae,{label:s("global.filter.label.unread"),checked:a.unread,onChange:o=>n({type:"filter",filterType:"unread",filterValue:o})}),e.jsx(ae,{label:s("global.filter.label.downloaded"),checked:a.downloaded,onChange:o=>n({type:"filter",filterType:"downloaded",filterValue:o})}),e.jsx(ae,{label:s("global.filter.label.bookmarked"),checked:a.bookmarked,onChange:o=>n({type:"filter",filterType:"bookmarked",filterValue:o})})]}):i==="sort"?Object.entries(Rr).map(([o,d])=>e.jsx(zt,{label:s(d),checked:a.sortBy===o,sortDescending:a.reverse,onClick:()=>o!==a.sortBy?n({type:"sortBy",sortBy:o}):n({type:"sortReverse"})},o)):i==="display"?e.jsxs(Wt,{onChange:()=>n({type:"showChapterNumber"}),value:a.showChapterNumber,children:[e.jsx(Ie,{label:s("chapter.option.display.label.source_title"),value:!1}),e.jsx(Ie,{label:s("chapter.option.display.label.chapter_number"),value:!0})]}):null})},Br=({options:t,optionsDispatch:r})=>{const{t:a}=w(),[n,s]=x.useState(!1),i=$r(t);return e.jsxs(e.Fragment,{children:[e.jsx(I,{title:a("settings.title"),children:e.jsx(y,{onClick:()=>s(!0),children:e.jsx(Pt,{color:i?"warning":void 0})})}),e.jsx(Dr,{open:n,onClose:()=>s(!1),options:t,optionsDispatch:r})]})},Lr=A(j)(({theme:t})=>({padding:t.spacing(1),paddingRight:"calc(".concat(We,"px + ").concat(t.spacing(1),")"),paddingBottom:0,[t.breakpoints.down("md")]:{paddingRight:t.spacing(1)}})),Ar=A(ft,{shouldForwardProp:t=>t!=="topOffset"})(({theme:t,topOffset:r})=>({listStyle:"none",padding:0,[t.breakpoints.up("md")]:{height:"calc(100vh - ".concat(r,"px)"),margin:0}})),Fr=({manga:t,isRefreshing:r})=>{var W,Ce;const{t:a}=w(),{appBarHeight:n}=Ue(),s=Ke.useIsBelowWidth("md"),[i,o]=x.useState(0),[d,k]=x.useState(null);Qe(d,x.useCallback(()=>{var u;return o((u=d==null?void 0:d.offsetHeight)!=null?u:0)},[d]));const{data:p}=O.useGetDownloadStatus(),f=(W=p==null?void 0:p.downloadStatus.queue)!=null?W:[],[l,b]=Sr(t.id),{data:h,loading:C,error:c,refetch:m}=O.useGetMangaChapters(Je,t.id,{notifyOnNetworkStatusChange:!0}),g=x.useMemo(()=>{var u;return(u=h==null?void 0:h.chapters.nodes)!=null?u:[]},[h==null?void 0:h.chapters.nodes]),N=x.useMemo(()=>g.map(u=>u.id),[g]),{areNoItemsSelected:F,areAllItemsSelected:E,selectedItemIds:V,handleSelectAll:M,handleSelection:H}=_t(g.length,{itemIds:N,currentKey:"default"}),T=x.useMemo(()=>Mr(g,l),[g,l]),P=(Ce=t.firstUnreadChapter)==null?void 0:Ce.sourceOrder,G=J.isFullyRead(t),ke=J.isFullyDownloaded(t),D=g.length===0,q=!D&&T.length===0,S=x.useMemo(()=>T.map(u=>{const R=f==null?void 0:f.find(Ve=>Ve.chapter.id===u.id),Z=F?null:V.includes(u.id);return{chapter:u,downloadChapter:R,selected:Z}}),[f,V,T]),ve=x.useMemo(()=>{const u=S.filter(R=>R.selected);return u.length?e.jsx(Ht,{selectedItemsCount:u.length,title:"chapter.title_one",children:R=>e.jsx(Ee,{selectedChapters:u,onClose:R})}):P!==void 0?e.jsx(kr,{chapterIndex:P,mangaId:t.id}):null},[S]);return C||D&&r?e.jsx(j,{sx:{justifyContent:"center",alignItems:"center",position:"relative",flexGrow:1},children:e.jsx(Te,{})}):c?e.jsx(j,{sx:{justifyContent:"center",position:"relative",flexGrow:1},children:e.jsx(K,{message:a("global.error.label.failed_to_load_data"),messageExtra:c.message,retry:()=>m().catch(Re())})}):e.jsxs(e.Fragment,{children:[e.jsxs(j,{direction:"column",sx:{position:"relative",flexBasis:"60%"},children:[e.jsxs(Lr,{ref:k,direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(z,{variant:"h5",component:"h3",children:"".concat(T.length," ").concat(a("chapter.title_one",{count:T.length}))}),e.jsxs(j,{direction:"row",children:[e.jsx(I,{title:a("chapter.action.mark_as_read.add.label.action.current"),children:e.jsx(y,{disabled:G,onClick:()=>v.markAsRead(_.getChapters(_.getNonRead(S)),!0,t.id),children:e.jsx(he,{})})}),e.jsx(ie,{variant:"popover",popupId:"chapterlist-download-button",children:u=>e.jsxs(e.Fragment,{children:[e.jsx(I,{title:a("chapter.action.download.add.label.action"),children:e.jsx(y,{disabled:ke,...X(u),children:e.jsx(Se,{})})}),u.isOpen&&e.jsx(De,{...$e(u),children:e.jsx(yt,{mangaIds:[t.id],closeMenu:u.close})})]})}),e.jsx(Br,{options:l,optionsDispatch:b}),e.jsx(Gt,{areAllItemsSelected:E,areNoItemsSelected:F,onChange:u=>M(u,u?g.map(R=>R.id):[])})]})]}),D&&e.jsx(K,{message:a("chapter.error.label.no_chapter_found")}),q&&e.jsx(K,{message:a("chapter.error.label.no_matches")}),e.jsx(Ar,{topOffset:n+i,style:{height:"undefined"},components:{Footer:()=>e.jsx(Be,{sx:{paddingBottom:Et}})},totalCount:T.length,itemContent:u=>e.jsx(jr,{...S[u],allChapters:g,showChapterNumber:l.showChapterNumber,onSelect:(R,Z)=>H(S[u].chapter.id,R,{selectRange:Z})}),useWindowScroll:s,overscan:window.innerHeight*.5})]}),ve]})},Or=t=>{const[r,a]=x.useState(!1),[n,s]=x.useState(null);return[x.useCallback(async()=>{a(!0),s(null),await Promise.all([O.getMangaFetch(t,{awaitRefetchQueries:!0}).response,O.getMangaChaptersFetch(t,{awaitRefetchQueries:!0}).response]).catch(o=>{o instanceof Xe&&Ut(o.message)==="no chapters found"||s(o)}).finally(()=>a(!1))},[t]),{loading:r,error:n}]};var be={},Nr=L;Object.defineProperty(be,"__esModule",{value:!0});var Pe=be.default=void 0,Er=Nr(B()),Pr=e;Pe=be.default=(0,Er.default)((0,Pr.jsx)("path",{d:"M21 11V3h-8l3.29 3.29-10 10L3 13v8h8l-3.29-3.29 10-10z"}),"OpenInFull");var je={},zr=L;Object.defineProperty(je,"__esModule",{value:!0});var ze=je.default=void 0,Vr=zr(B()),Hr=e;ze=je.default=(0,Vr.default)((0,Hr.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");const Gr=({manga:t})=>{var p,f;const{t:r}=w(),a=Ye(),n=O.useGetTrackerList(Ze),s=(f=(p=n.data)==null?void 0:p.trackers.nodes)!=null?f:[],i=t.trackRecords.nodes,o=se.getLoggedIn(s),d=se.getLoggedIn(se.getTrackers(i,s)),k=l=>{if(n.error){oe(r("tracking.error.label.could_not_load_track_info"),"error");return}if(!o.length){a("/settings/trackingSettings");return}l()};return e.jsx(ie,{variant:"dialog",popupId:"manga-track-modal",children:l=>e.jsxs(e.Fragment,{children:[e.jsxs(de,{...X(l),size:"medium",disabled:n.loading||!!n.error,onClick:()=>k(l.open),onTouchStart:()=>k(l.open),variant:d.length?"contained":"outlined",children:[d.length?e.jsx(ze,{}):e.jsx(Xt,{}),d.length?r("manga.button.track.active",{count:d.length}):r("manga.button.track.start")]}),e.jsx(et,{...tt(l),maxWidth:"md",fullWidth:!0,scroll:"paper",children:e.jsx(wt,{manga:t})})]})})},qr=A("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(2),padding:t.spacing(1),[t.breakpoints.up("md")]:{flexBasis:"40%",height:"calc(100vh - 64px)",overflowY:"auto"}})),Wr=A("div")(()=>({})),Ur=A("div")(({theme:t})=>({display:"flex",paddingBottom:t.spacing(1)})),Kr=A("div")(({theme:t})=>({marginLeft:t.spacing(1)})),U=t=>e.jsx(St,{...t}),Qr=A("div")(({theme:t})=>({display:"flex",gap:t.spacing(1)})),Jr=({url:t})=>{const{t:r}=w();return e.jsx(I,{title:r("global.button.open_site"),children:e.jsx(de,{size:"medium",disabled:!t,component:Yt,href:t!=null?t:void 0,target:"_blank",rel:"noreferrer",variant:"outlined",children:e.jsx(xe,{})})})};function Xr(t){var r;return t?(r=t.displayName)!=null?r:t.id:Y("global.label.unknown")}function ne(t){return t!=null?t:Y("global.label.unknown")}const Yr=({manga:t})=>{const r=le(),a=rt({variant:"popover",popupId:"manga-thumbnail-fullscreen"});return e.jsxs(e.Fragment,{children:[e.jsxs(j,{sx:{position:"relative","& img":{borderRadius:.5,width:"150px",height:"auto",[r.breakpoints.up("lg")]:{width:"200px"},[r.breakpoints.up("xl")]:{width:"300px"}}},children:[e.jsx(Me,{src:J.getThumbnailUrl(t),alt:"Manga Thumbnail",spinnerStyle:{borderRadius:.5,width:"150px",height:"225px",[r.breakpoints.up("lg")]:{width:"200px",height:"300px"},[r.breakpoints.up("xl")]:{width:"300px",height:"450px"}}}),e.jsx(j,{...X(a),sx:{position:"absolute",top:0,bottom:0,width:"100%",justifyContent:"center",alignItems:"center",opacity:0,"&:hover":{background:"rgba(0, 0, 0, 0.4)",cursor:"pointer",opacity:1}},children:e.jsx(Pe,{fontSize:"large"})})]}),e.jsx(at,{...st(a),sx:{outline:0},children:e.jsx(j,{onClick:()=>a.close(),sx:{height:"100vh",py:2,outline:0,justifyContent:"center",alignItems:"center"},children:e.jsx(Me,{src:J.getThumbnailUrl(t),alt:"Manga Thumbnail",imgStyle:{height:"100%",width:"100%",objectFit:"contain"}})})})]})},Zr=75,ea=({manga:{description:t,genre:r}})=>{const[a,n]=nt("isDescriptionGenreCollapsed",!0);return e.jsxs(e.Fragment,{children:[e.jsxs(j,{sx:{position:"relative"},children:[e.jsx(Zt,{collapsedSize:Zr,in:!a,children:e.jsx(z,{style:{whiteSpace:"pre-line",textAlign:"justify",textJustify:"inter-word"},children:t})}),e.jsx(j,{onClick:()=>n(!a),sx:{pt:1,alignItems:"center",cursor:"pointer",position:a?"absolute":null,width:"100%",bottom:0,background:s=>"linear-gradient(transparent 1px, ".concat(s.palette.background.paper,")")},children:e.jsx(y,{sx:{color:s=>s.palette.mode==="light"?"black":"text"},children:a?e.jsx(Qt,{}):e.jsx(Jt,{})})})]}),e.jsx(j,{sx:{flexDirection:"row",flexWrap:a?"no-wrap":"wrap",gap:1,overflowX:a?"auto":null},children:r.map(s=>e.jsx(er,{label:s,variant:"outlined"}))})]})},ta=({manga:t})=>{const{t:r}=w();x.useEffect(()=>{t.source||oe(Y("source.error.label.source_not_found"),"error")},[t.source]);const{CategorySelectComponent:a,updateLibraryState:n}=It(t),s=Le(async()=>{try{await navigator.clipboard.writeText(t.title),oe(r("global.label.copied"),"info")}catch(i){}});return e.jsxs(e.Fragment,{children:[e.jsxs(qr,{children:[e.jsxs(Wr,{children:[e.jsxs(Ur,{children:[e.jsx(Yr,{manga:t}),e.jsxs(Kr,{children:[e.jsx(z,{variant:"h5",component:"h2",sx:{mb:1,"@media not (pointer: fine)":{userSelect:"none"}},...s(),children:t.title}),e.jsx(U,{title:r("manga.label.author"),value:ne(t.author)}),e.jsx(U,{title:r("manga.label.artist"),value:ne(t.artist)}),e.jsx(U,{title:r("manga.label.status"),value:ne(t.status)}),e.jsx(U,{title:r("source.title_one"),value:Xr(t.source)})]})]}),e.jsxs(Qr,{children:[e.jsxs(de,{size:"medium",onClick:n,variant:t.inLibrary?"contained":"outlined",children:[t.inLibrary?e.jsx(Kt,{}):e.jsx(Mt,{}),t.inLibrary?r("manga.button.in_library"):r("manga.button.add_to_library")]}),e.jsx(Gr,{manga:t}),e.jsx(Jr,{url:t.realUrl})]})]}),e.jsx(ea,{manga:t})]}),a]})},ra=({manga:t,onRefresh:r,refreshing:a})=>{const{t:n}=w(),s=le(),i=ot(s.breakpoints.up("sm")),[o,d]=lt.useState(null),k=!!o,p=()=>{d(null)},{openCategorySelect:f,CategorySelectComponent:l}=Rt({mangaId:t.id});return e.jsxs(e.Fragment,{children:[i&&e.jsxs(e.Fragment,{children:[e.jsx(I,{title:n("manga.label.reload_from_source"),children:e.jsx(y,{onClick:()=>{r()},disabled:a,children:e.jsx(_e,{})})}),t.inLibrary&&e.jsxs(e.Fragment,{children:[e.jsx(I,{title:n("global.button.migrate"),children:e.jsx(Q,{to:"/migrate/source/".concat(t.sourceId,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:e.jsx(y,{children:e.jsx(ye,{})})})}),e.jsx(I,{title:n("manga.label.edit_categories"),children:e.jsx(y,{onClick:()=>{f(!0)},children:e.jsx(we,{})})})]})]}),!i&&e.jsxs(e.Fragment,{children:[e.jsx(y,{id:"chaptersMenuButton","aria-controls":k?"chaptersMenu":void 0,"aria-haspopup":"true","aria-expanded":k?"true":void 0,onClick:b=>d(b.currentTarget),children:e.jsx(qt,{})}),e.jsxs(De,{id:"chaptersMenu",anchorEl:o,open:k,onClose:p,MenuListProps:{"aria-labelledby":"chaptersMenuButton"},children:[e.jsxs(ee,{onClick:()=>{r(),p()},disabled:a,children:[e.jsx(te,{children:e.jsx(_e,{fontSize:"small"})}),e.jsx(re,{children:n("manga.label.reload_from_source")})]}),t.inLibrary&&[e.jsxs(ee,{component:Q,to:"/migrate/source/".concat(t.sourceId,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:[e.jsx(te,{children:e.jsx(ye,{fontSize:"small"})}),e.jsx(re,{children:n("migrate.title")})]},"migrate"),e.jsxs(ee,{onClick:()=>{f(!0),p()},children:[e.jsx(te,{children:e.jsx(we,{fontSize:"small"})}),e.jsx(re,{children:n("manga.label.edit_categories")})]},"categories")]]})]}),l]})},Pa=()=>{const{t}=w(),{setTitle:r,setAction:a}=x.useContext(it),{id:n}=dt(),s=x.useRef(!1),{data:i,error:o,loading:d,networkStatus:k,refetch:p}=O.useGetManga(ct,n),f=ht(k),l=i==null?void 0:i.manga,[b,{loading:h,error:C}]=Or(n),c=o!=null?o:C;return x.useEffect(()=>{if(l==null)return;!s.current&&!l.initialized&&(s.current=!0,b())},[l]),x.useEffect(()=>{var m;return r((m=l==null?void 0:l.title)!=null?m:t("manga.title_one")),a(null),()=>{r(""),a(null)}},[t,l==null?void 0:l.title]),x.useEffect(()=>{var m;return a(e.jsxs(j,{direction:"row",alignItems:"center",children:[c&&!f&&!h&&e.jsx(I,{title:e.jsxs(e.Fragment,{children:[t("manga.error.label.request_failure"),e.jsx("br",{}),(m=c.message)!=null?m:c]}),children:e.jsx(y,{onClick:()=>p(),children:e.jsx(Ae,{color:"error"})})}),l&&(h||f)&&e.jsx(y,{disabled:!0,children:e.jsx(ut,{size:16})}),l&&e.jsx(ra,{manga:l,onRefresh:b,refreshing:h})]})),()=>{a(null)}},[t,c,f,h,l,b]),c&&!l?e.jsx(K,{message:t("manga.error.label.request_failure"),messageExtra:c.message}):e.jsxs(Be,{sx:{display:{md:"flex"},overflow:"hidden"},children:[d&&e.jsx(Te,{}),l&&e.jsx(ta,{manga:l}),l&&e.jsx(Fr,{manga:l,isRefreshing:h})]})};export{Pa as Manga};
