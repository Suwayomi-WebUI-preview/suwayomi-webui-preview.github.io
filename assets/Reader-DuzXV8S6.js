var xs=Object.defineProperty;var ms=(e,t,s)=>t in e?xs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var ve=(e,t,s)=>ms(e,typeof t!="symbol"?t+"":t,s);import{cP as kr,b as l,cQ as Tt,j as a,i as Kt,at as S,n as Zt,cR as vs,E as Ke,cS as it,cT as qt,S as _,z as X,T as et,cw as Ss,cU as bs,cV as Rs,cW as Gt,a1 as Ze,a9 as tr,C as G,cX as _r,cY as H,cZ as pt,c_ as lr,as as mt,c$ as Hr,d0 as Cs,d1 as Ie,f as bt,b5 as Ps,d2 as Rt,d3 as de,a as Vr,d4 as Ye,d5 as z,d6 as ue,bW as q,M as Fe,cB as Es,d7 as Ts,d8 as ws,d9 as As,cC as Is,am as st,da as dr,aO as tt,db as ur,bn as Ct,A as rr,L as _t,c as Me,u as $,c2 as zr,a$ as Ur,b0 as Fr,ax as Pt,a3 as Lt,a4 as Bt,c4 as Ms,ap as Os,B as rt,dc as js,dd as gr,de as Wr,df as Jt,dg as Gr,dh as ys,di as hr,dj as $r,aV as Ds,dk as ze,b3 as Ls,dl as ot,s as Xr,I as ae,r as wt,c3 as Bs,aE as Ns,bb as ks,e as Ht,aN as _s,dm as sr,a6 as Hs,a7 as Vs,m as Yr,dn as vt,al as pr,bd as zs,aX as Ve,dp as Us,dq as Kr,g as Zr,aA as qr,dr as fr,O as xr,ds as ft,dt as ee,bc as Fs,du as Qt,d as Ws,az as Gs,dv as $s,dw as Xs}from"./index-DtQrBt4M.js";import{b as J,R as Ys,a as y,w as ge,c as ct,d as qe,e as Vt,g as Ne,f as be,i as fe,h as Qe,j as St,k as Z,l as mr,m as vr,n as le,o as Ks,p as Et,q as Zs,r as qs,s as Js,t as Qs,v as Jr,x as Qr,y as es,S as en,z as tn,A as zt,B as At,C as Ue,D as nr,E as rn,F as sn,G as nn,H as an,I as ar,J as on,K as cn,L as ts,M as ln,N as ke,O as dn,P as Sr,Q as Ot,T as un,U as gn,V as hn,W as pn,X as rs,Y as ss,Z as fn,_ as xn,$ as or,a0 as mn,a1 as vn,a2 as yt,a3 as br,a4 as Sn,a5 as bn,a6 as $t,a7 as Rn}from"./ReaderSettingsTabs-DQo0M-N0.js";import{r as Cn}from"./Strings-CAV0u705.js";import{C as Be,b as er,F as ns}from"./Chapters-GxJSDZJ7.js";import{P as Pn}from"./PushPin-DfY0fCQ8.js";import{P as En}from"./PushPinOutlined-B2AZYcgu.js";import{L as Dt}from"./Link-DkBDjiPX.js";import{S as as}from"./Select-XMo28PZU.js";import{C as os,c as Tn,F as wn,l as An,n as In,a as Mn}from"./useManageMangaLibraryState-ov3VZlXp.js";import{q as On}from"./index-CvZdBQYg.js";import{C as jn,B as yn,I as Dn}from"./ChapterListCard-JxekfUL2.js";import{D as Ln}from"./Download-BCPaQv4d.js";import{D as Bn}from"./Delete-FiCE_LSZ.js";import{D as Nn}from"./ChapterCardMetadata-BEY1doZt.js";import{F as kn,I as _n}from"./IconWebView-DUVxRfC1.js";import{F as ir}from"./Mangas-CKRoohmQ.js";import{C as Hn}from"./CheckboxInput-nUettrcV.js";import{E as Nt}from"./EmptyViewAbsoluteCentered-DI8B4Znn.js";import{u as Vn}from"./SpinnerImage-C9pQjMpG.js";import{u as zn}from"./use-window-event-BP8DrvhF.js";import{u as Un}from"./use-merged-ref-D-ccnGyI.js";import{u as Fn}from"./useAppTitle-BJQWe9Un.js";import"./TabsMenu-CsOpSTM1.js";import"./Tabs-JUEnBLcg.js";import"./Trans-jmnGDAjQ.js";import"./Slider-BzYEmfyX.js";import"./ListSubheader-BvzzTlus.js";import"./Add-DcmrN_3d.js";import"./DateHelper-BqLcb6il.js";import"./Asserts-C0856h9S.js";import"./ThreeStateCheckboxInput-C25RFnac.js";import"./Checkbox-BflEth31.js";import"./SwitchBase-DsJUurlx.js";import"./FormGroup-CGnUOrUb.js";import"./DoneAll-7JBAKBFV.js";import"./MUI.util-CEodEA2f.js";import"./ListCardContent-CNnYMY6x.js";import"./Card-BbwqA1T1.js";import"./CardActionArea-CHU1s-nP.js";import"./Refresh-DJLFrVAM.js";const Wn=e=>{const{activeScopes:t,enableScope:s,disableScope:r}=kr(),n=l.useRef([]);l.useEffect(()=>e?(n.current=[...t],s(Tt.NONE),n.current.forEach(r),()=>{r(Tt.NONE),n.current.forEach(s)}):()=>{},[e])},Gn=({isOpen:e,close:t})=>{const s=J(c=>c.settings);Wn(e);const[r,n]=l.useState(0),[o,i]=l.useState(!1);return e?a.jsx(Kt,{open:e,maxWidth:"md",fullWidth:!0,onClose:t,hideBackdrop:r===vs.FILTER,sx:{...S(o,{opacity:.75})},children:a.jsx(Zt,{sx:{p:0},children:a.jsx(Ys,{activeTab:r,setActiveTab:n,settings:s,updateSetting:(...c)=>y.updateSetting(...c),deleteSetting:(...c)=>y.deleteSetting(...c),setTransparent:i})})}):null},$n=({isDesktop:e,readerNavBarWidth:t})=>{const s=ct(u=>u.scrollbar),{currentPageIndex:r,pages:n,totalPages:o}=qe(u=>({currentPageIndex:u.pages.currentPageIndex,pages:u.pages.pages,totalPages:u.pages.totalPages})),{readingDirection:i,shouldShowPageNumber:c,progressBarType:d}=J(u=>({readingDirection:u.settings.readingDirection.value,shouldShowPageNumber:u.settings.shouldShowPageNumber,progressBarType:u.settings.progressBarType})),p=Vt(u=>u.progressBar.isMaximized),g=l.useMemo(()=>{const u=Ne(r,n).name,h="/",f="".concat(u).concat(h).concat(o);return i===it.LTR?f:Cn(f,h)},[r,n,o,i]);return!c||p||e&&d===qt.STANDARD||p&&d===qt.HIDDEN?null:a.jsx(_,{sx:{position:"fixed",left:t,right:0,bottom:u=>"max(calc(".concat(u.spacing(1)," + ").concat(s.xSize,"px), env(safe-area-inset-bottom))"),alignItems:"center",transition:u=>"left 0.".concat(u.transitions.duration.shortest,"s")},children:a.jsx(X,{sx:{p:.5,borderRadius:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:a.jsx(et,{sx:{color:"white"},children:g})})})},Xn=ge($n,[y.useOverlayMode,Ke],["isDesktop","readerNavBarWidth"]);function Rr(e){return e.substring(2).toLowerCase()}function Yn(e,t){return t.documentElement.clientWidth<e.clientX||t.documentElement.clientHeight<e.clientY}function Kn(e){const{children:t,disableReactTree:s=!1,mouseEvent:r="onClick",onClickAway:n,touchEvent:o="onTouchEnd"}=e,i=l.useRef(!1),c=l.useRef(null),d=l.useRef(!1),p=l.useRef(!1);l.useEffect(()=>(setTimeout(()=>{d.current=!0},0),()=>{d.current=!1}),[]);const g=Ss(bs(t),c),u=Rs(x=>{const b=p.current;p.current=!1;const C=Gt(c.current);if(!d.current||!c.current||"clientX"in x&&Yn(x,C))return;if(i.current){i.current=!1;return}let m;x.composedPath?m=x.composedPath().includes(c.current):m=!C.documentElement.contains(x.target)||c.current.contains(x.target),!m&&(s||!b)&&n(x)}),h=x=>b=>{p.current=!0;const C=t.props[x];C&&C(b)},f={ref:g};return o!==!1&&(f[o]=h(o)),l.useEffect(()=>{if(o!==!1){const x=Rr(o),b=Gt(c.current),C=()=>{i.current=!0};return b.addEventListener(x,u),b.addEventListener("touchmove",C),()=>{b.removeEventListener(x,u),b.removeEventListener("touchmove",C)}}},[u,o]),r!==!1&&(f[r]=h(r)),l.useEffect(()=>{if(r!==!1){const x=Rr(r),b=Gt(c.current);return b.addEventListener(x,u),()=>{b.removeEventListener(x,u)}}},[u,r]),l.cloneElement(t,f)}const Cr=Ze(et)({boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",textAlign:"center",userSelect:"none",cursor:"pointer"}),Zn=Ze(_,{shouldForwardProp:tr(["progressBarPosition"])})(({theme:e,progressBarPosition:t})=>({position:"fixed",pointerEvents:"all",touchAction:"none",...S(be(t).isHorizontal,{justifyContent:"flex-end",bottom:0,right:0}),...S(be(t).isVertical,{top:0,bottom:0}),...S(be(t).isLeft,{alignItems:e.direction==="ltr"?"flex-start":"flex-end"}),...S(be(t).isRight,{alignItems:e.direction==="ltr"?"flex-end":"flex-start"})})),qn=Ze(_)(({theme:e})=>({flexDirection:"row",justifyContent:"center",alignItems:"center",gap:e.spacing(.5)})),Jn=Ze(_)({flexDirection:"row",flexGrow:1,overflow:"hidden"}),Qn=Ze(X,{shouldForwardProp:tr(["currentPagesIndex","pagesLength","progressBarPosition"])})(({currentPagesIndex:e,pagesLength:t,progressBarPosition:s})=>({position:"absolute",pointerEvents:"none",...S(be(s).isHorizontal,{left:0,width:"".concat((e+1)/t*100,"%"),height:"100%"}),...S(be(s).isVertical,{top:0,width:"100%",height:"".concat((e+1)/t*100,"%")})})),ea=({pageName:e,currentPagesIndex:t,pagesLength:s,isDragging:r,boxProps:n,children:o,progressBarPosition:i})=>a.jsx(G,{title:e,slotProps:{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}},placement:_r[i],children:a.jsx(X,{...n,sx:{position:"absolute",cursor:r?"grabbing":"grab",...S(be(i).isHorizontal,{left:"".concat(Math.max(0,t-1)/(s-1)*100,"%"),width:"calc(100% / ".concat(s-1,")"),height:"100%"}),...S(be(i).isVertical,{top:"".concat(Math.max(0,t-1)/(s-1)*100,"%"),width:"100%",height:"calc(100% / ".concat(s-1,")")}),...n==null?void 0:n.sx},children:o})}),ta=Ze(_)({position:"relative",flexDirection:"row",flexGrow:1}),ra={[pt.EDGE]:[{rect:[0,0,100,33.33],type:H.NEXT},{rect:[0,33.33,33.33,66.66],type:H.NEXT},{rect:[66.66,33.33,33.33,66.66],type:H.NEXT},{rect:[33.33,33.33,33.33,33.33],type:H.MENU},{rect:[33.33,66.66,33.33,33.33],type:H.PREVIOUS}],[pt.KINDLE]:[{rect:[0,0,100,33.33],type:H.MENU},{rect:[0,33.33,33.33,66.66],type:H.PREVIOUS},{rect:[33.33,33.33,66.66,66.66],type:H.NEXT}],[pt.L_SHAPE]:[{rect:[0,0,100,33.33],type:H.PREVIOUS},{rect:[0,33.33,33.33,33.33],type:H.PREVIOUS},{rect:[33.33,33.33,33.33,33.33],type:H.MENU},{rect:[66.66,33.33,33.33,33.33],type:H.NEXT},{rect:[0,66.66,100,33.33],type:H.NEXT}],[pt.RIGHT_LEFT]:[{rect:[0,0,33.33,100],type:H.PREVIOUS},{rect:[33.33,0,33.33,100],type:H.MENU},{rect:[66.66,0,33.33,100],type:H.NEXT}],[pt.DISABLED]:[{rect:[0,0,100,100],type:H.MENU}]},sa={[H.PREVIOUS]:{text:"global.label.previous",color:"rgba(255, 114, 118, .5)"},[H.NEXT]:{text:"global.label.next",color:"rgba(144, 238, 144, .5)"},[H.MENU]:{text:"global.label.menu",color:"rgba(0, 0, 0, .5)"}};class Se{static invertRect(t,{vertical:s,horizontal:r,isRTL:n}){const o=s?this.invertVertical(t):t,i=r?this.invertHorizontal(o):o;return n?this.invertHorizontal(i):i}static getRegions(t,s){return ra[t].map(({type:n,rect:o})=>({type:n,rect:this.invertRect(o,s)}))}static isCanvasReusable(t,s,r,n,o){var f;const i=this.layout===t,c=this.width===s,d=this.height===r,p=!!this.canvas,g=this.language===lr.language,u=((f=this.invertMode)==null?void 0:f.vertical)===o.vertical&&this.invertMode.horizontal===o.horizontal&&this.invertMode.isRTL===o.isRTL,h=this.fontStyle===n;return p&&c&&d&&i&&g&&u&&h}static drawCanvas(t,s,r,n,o){o.forEach(({type:i,rect:[c,d,p,g]})=>{const{text:u,color:h}=sa[i],f=mt(u),x=(w,R)=>w/100*R,b=x(c,s),C=x(d,r),m=x(p,s),P=x(g,r),A=(w,R)=>(w+R)*.5+w*.5,E=A(b,m),I=A(C,P);t.beginPath(),t.rect(b,C,m,P),t.fillStyle=h,t.strokeStyle=h,t.lineWidth=.1,t.stroke(),t.fill(),t.strokeStyle="black",t.textAlign="center",t.textBaseline="middle",t.font="".concat(n.fontSize," ").concat(n.fontFamily),t.strokeStyle="black",t.lineWidth=3,t.strokeText(f,E,I),t.lineWidth=1,t.fillStyle="white",t.fillText(f,E,I)})}static getOrCreateCanvas(t,s,r,n,o){if(this.isCanvasReusable(t,s,r,n,o))return this.canvas;const i=document.createElement("canvas"),c=i.getContext("2d");c.canvas.width=s,c.canvas.height=r;const d=this.getRegions(t,o);return this.drawCanvas(c,s,r,n,d),this.layout=t,this.canvas=i,this.width=s,this.height=r,this.language=lr.language,this.invertMode=o,this.regions=d,this.fontStyle=n,i}static doesRegionContainPos(t,s,r){const[n,o,i,c]=t.rect;return s>=n&&s<=n+i&&r>=o&&r<=o+c}static getAction(t,s){var i;const r=t/this.width*100,n=s/this.height*100,o=(i=this.regions)==null?void 0:i.find(c=>this.doesRegionContainPos(c,r,n));return o?o.type:H.MENU}}ve(Se,"layout",null),ve(Se,"canvas",null),ve(Se,"width",null),ve(Se,"height",null),ve(Se,"language",null),ve(Se,"invertMode",null),ve(Se,"regions",null),ve(Se,"fontStyle",null),ve(Se,"invertVertical",([t,s,r,n])=>[t,100-(s+n),r,n]),ve(Se,"invertHorizontal",([t,s,r,n])=>[100-(t+r),s,r,n]);const na=(e,t,s)=>{if(e===Ie.X){if(t===ue.BACKWARD)return s==="ltr"?-1:1;if(t===ue.FORWARD)return s==="ltr"?1:-1}return t===ue.BACKWARD?-1:1},pe=class pe{static scroll(t,s,r,n,o,i,c=Hr.LARGE){if(!o)return;const d=Rt[n],p=Cs().direction===d,g=fe(r),u=Math.abs(o.scrollTop)<=1,h=Math.floor(o.scrollTop)===o.scrollHeight-o.clientHeight||Math.ceil(o.scrollTop)===o.scrollHeight-o.clientHeight,f=Math.abs(o.scrollLeft)<=1,x=o.scrollWidth-o.clientWidth-Math.floor(Math.abs(o.scrollLeft))<=1||o.scrollWidth-o.clientWidth-Math.ceil(Math.abs(o.scrollLeft))<=1,b=p?f:x,C=p?x:f,m=c/100,P=na(s,t,d),A=(I,w)=>I+w*m*P;Qe().setIsVisible(!1),i(!1);const E=(I,w,R)=>{if(I&&t===ue.BACKWARD&&g){pe.openChapter("previous");return}if(w&&t===ue.FORWARD&&g){pe.openChapter("next");return}o.scroll({...R,behavior:"smooth"})};switch(s){case Ie.X:E(b,C,{left:A(o.scrollLeft,o.clientWidth)});break;case Ie.Y:E(u,h,{top:A(o.scrollTop,o.clientHeight)});break;default:throw new Error('Unexpected "ScrollDirection" ('.concat(s,")"))}}static openChapter(t,s=!0,r=!0){const{currentChapter:n,previousChapter:o,nextChapter:i,chapters:c,visibleChapters:{lastLeadingChapterSourceOrder:d,lastTrailingChapterSourceOrder:p},setReaderStateChapters:g}=St(),{shouldInformAboutMissingChapter:u,shouldInformAboutScanlatorChange:h,shouldUseInfiniteScroll:f}=Z();if(!n)return;const x=typeof t=="number",b=t==="previous";if(!(x||b&&!!o||!b&&!!i))return;(async()=>{const E=x?c.find(w=>w.id===t):b?o:i;if(!E)return;const I=E.sourceOrder<n.sourceOrder;try{s&&await pe.checkNextChapterConsistency(I?"previous":"next",n,E,u,h);const w=d<=E.sourceOrder&&p>=E.sourceOrder,R=f&&(!r||w);R&&g(v=>Js(I,v,E.sourceOrder,r,I?!1:void 0,I?void 0:!1)),y.navigateToChapter(E,{resumeMode:Qs(x||!R,I),updateInitialChapter:!R})}catch(w){}})().catch(bt())}static async checkNextChapterConsistency(t,s,r,n,o){if(!s||!r)return;const i=Be.getGap(s,r),c=!o||s.scanlator===r.scanlator,d=!n||!i;if(!(!c||!d))return;const g={previous:{scanlator:"reader.chapter_transition.warning.previous.scanlator",chapter_number:"reader.chapter_transition.warning.previous.chapter_number"},next:{scanlator:"reader.chapter_transition.warning.next.scanlator",chapter_number:"reader.chapter_transition.warning.next.chapter_number"}},u=c?"":mt(g[t].scanlator,{nextScanlator:r.scanlator,currentScanlator:s.scanlator}),h=d?"":mt(g[t].chapter_number,{count:i,nextChapter:"#".concat(r.chapterNumber," ").concat(r.name),currentChapter:"#".concat(s.chapterNumber," ").concat(s.name)}),f=!c&&!d?"\n\n":"",x="".concat(u).concat(f).concat(h);await Ps({title:mt("reader.chapter_transition.warning.title"),message:x,actions:{confirm:{title:mt("global.button.open")}}})}static openPage(t,s,r=!0){const{currentPageIndex:n,setPageToScrollToIndex:o,pages:i,transitionPageMode:c,setTransitionPageMode:d}=mr(),{readingDirection:p,readingMode:g,shouldShowTransitionPage:u}=Z(),h=Rt[p.value],f=q(t,t==="previous"?"next":"previous",s!=null?s:h),x=Ne(n,i),b=vr("previous",x.pagesIndex,i),C=vr("next",x.pagesIndex,i),m=le(i[0]),P=le(i[i.length-1]),A=x.primary.index===0,E=n===P,I=Ks(c,g.value),w=fe(g.value);r&&(Qe().setIsVisible(!1),Et().setShowPreview(!1));const R=()=>d(de.NONE);if(typeof t=="number"){o(t),R();return}const v=w&&I,M=!w&&c===de.PREVIOUS||v,j=!w&&c===de.NEXT||v;if(A&&(!u||M)&&f==="previous"&&!!St().previousChapter){pe.openChapter("previous");return}if(E&&(!u||j)&&f==="next"&&!!St().nextChapter){pe.openChapter("next");return}const L=f==="previous",U=f==="next";if(I&&!w&&(M&&U||j&&L)){R(),o(M?m:P);return}if((A&&L||E&&U)&&!w){d(L?de.PREVIOUS:de.NEXT);return}o(L?b:C)}static useUpdateCurrentPageIndex(){const t=y.useUpdateChapter(),{settings:{downloadAheadLimit:s}}=Vr();return l.useCallback((r,n=!0,o=!1)=>{const{currentPageIndex:i,setCurrentPageIndex:c}=mr(),{currentChapter:d,chapters:p,previousChapter:g,nextChapter:u,visibleChapters:h,setReaderStateChapters:f}=St();if(r===i&&!o||(c(r),!d))return;const x=Be.getNextChapters(d,p,{offset:Ye.NEXT}),b=i>r?Ye.PREVIOUS:Ye.NEXT;y.downloadAhead(d,u,x,r,s),y.preloadChapter(r,d.pageCount,b===Ye.NEXT?u:g,h.lastLeadingChapterSourceOrder,h.lastTrailingChapterSourceOrder,f,b);const C=()=>{const m=Jr(d.id);if(!m)return;const P=o?m.pageCount-1:r,A=P===m.pageCount-1;t({lastPageRead:P,isRead:A?!0:void 0})};if(clearTimeout(pe.updateCurrentPageTimeout),n){pe.updateCurrentPageTimeout=setTimeout(C,1e3);return}C()},[s])}static updateCurrentPageOnScroll(t,s,r,n,o){var g;const i=Rt[o],c=t.current.findIndex(u=>u&&Zs(u,n,{bottom:1,left:q(0,window.innerWidth+1,i),right:q(1,0,i)})),d=(g=t.current)==null?void 0:g[t.current.length-1],p=d&&qs(d,n,o);if(c!==-1){if(p){r(c,!1,!0);return}r(c,c!==s)}}static handleClick(t,s){if(!t)return;const{readingMode:r,readingDirection:n,isStaticNav:o,scrollAmount:i}=Z(),c=s.currentTarget.getBoundingClientRect(),d=s.clientX-c.left,p=s.clientY-c.top,g=Se.getAction(d,p);Et().setShowPreview(!1);const u=fe(r.value),h=r.value===z.CONTINUOUS_HORIZONTAL?Ie.X:Ie.Y;switch(g){case H.MENU:Qe().setIsVisible(o||!Qe().isVisible);break;case H.PREVIOUS:case H.NEXT:u?pe.scroll(g===H.PREVIOUS?ue.BACKWARD:ue.FORWARD,h,r.value,n.value,t,Et().setShowPreview,i):pe.openPage(g===H.PREVIOUS?"previous":"next","ltr");break;default:throw new Error('Unexpected "TapZoneRegionType" ('.concat(g,")"))}}static useHandleProgressDragging(t,s,r,n,o,i,c){l.useEffect(()=>{if(!s)return()=>{};const{isHorizontal:d}=be(o),p=h=>{if(!t.current)return;const f=le(Qr(h,t.current,n,d,c,i));le(r)!==f&&pe.openPage(f,void 0,!1)},g=h=>{p(h)},u=h=>{h.touches.length>0&&p(h.touches[0])};return document.addEventListener("mousemove",g),document.addEventListener("touchmove",u),()=>{document.removeEventListener("mousemove",g),document.removeEventListener("touchmove",u)}},[s,r,n,o])}};ve(pe,"updateCurrentPageTimeout");let V=pe;const aa=l.memo(Ze(X,{shouldForwardProp:tr(["isFirstPage","isLastPage"])})(({isFirstPage:e,isLastPage:t})=>({flexGrow:1,height:"100%",cursor:"pointer",borderLeftWidth:e?0:void 0,borderRightWidth:t?0:void 0}))),oa=l.memo(({page:e,pagesIndex:t,isCurrentPage:s,isLeadingPage:r,isTrailingPage:n,totalPages:o,showDraggingStyle:i,primaryPageLoadState:c,secondaryPageLoadState:d,createProgressBarSlot:p,...g})=>{const u=l.useMemo(()=>p(e,t,c,d,s,r,n,o,i),[p,e,t,c,d,s,r,n,o,i]);return a.jsx(aa,{...g,isFirstPage:t===0,isLastPage:t===o-1,children:u})}),ia=({slotProps:e,slots:t,createProgressBarSlot:s,progressBarPosition:r,direction:n,fullSegmentClicks:o})=>{var v,M,j,N,k,L,U,Re,oe,ne,K,Q,W,D,Oe,ie,Ce,xe,We,Ge,Pe,Ee,_e,me,$e,Je,nt,je,Te,Y,ye,He;const{pages:i,pageLoadStates:c,totalPages:d,currentPageIndex:p}=qe(B=>({pages:B.pages.pages,pageLoadStates:B.pages.pageLoadStates,totalPages:B.pages.totalPages,currentPageIndex:B.pages.currentPageIndex})),g=J(B=>B.settings.readingMode.value),{isDragging:u,setIsDragging:h}=Vt(B=>({isDragging:B.progressBar.isDragging,setIsDragging:B.progressBar.setIsDragging})),f=l.useRef(null),x=l.useRef(void 0),[b,C]=l.useState(0),m=l.useRef(null);Fe(m,l.useCallback(()=>{const B=m.current;if(!B)return;const{paddingLeft:T,paddingRight:De}=getComputedStyle(B),he=6,F=B.clientWidth-parseFloat(T)-parseFloat(De),we=g===z.DOUBLE_PAGE?F*2+he:F;C(we)},[g]));const P=l.useMemo(()=>Ne(p,i).pagesIndex,[p,i]),A=be(r).isHorizontal,E=l.useMemo(()=>Ne(p,i),[p,i]),I=l.useCallback((...B)=>q(B[0],B[1],n),[n]);V.useHandleProgressDragging(f,u,E,i,r,I,o);const w=B=>{if(!f.current)return;const T="touches"in B;V.openPage(le(Qr(T?B.touches[0]:B,f.current,i,A,o,I)),void 0,!1),clearTimeout(x.current),x.current=setTimeout(()=>h(!0),250)},R=()=>{h(!1),clearTimeout(x.current)};return a.jsx(Zn,{...e==null?void 0:e.container,progressBarPosition:r,children:a.jsxs(qn,{...e==null?void 0:e.progressBarRoot,children:[a.jsx(Cr,{...(v=e==null?void 0:e.progressBarPageTexts)==null?void 0:v.base,...(M=e==null?void 0:e.progressBarPageTexts)==null?void 0:M.current,sx:[{width:"".concat(b,"px")},...Array.isArray((N=(j=e==null?void 0:e.progressBarPageTexts)==null?void 0:j.base)==null?void 0:N.sx)?(U=(L=(k=e==null?void 0:e.progressBarPageTexts)==null?void 0:k.base)==null?void 0:L.sx)!=null?U:[]:[(oe=(Re=e==null?void 0:e.progressBarPageTexts)==null?void 0:Re.base)==null?void 0:oe.sx],...Array.isArray((K=(ne=e==null?void 0:e.progressBarPageTexts)==null?void 0:ne.current)==null?void 0:K.sx)?(D=(W=(Q=e==null?void 0:e.progressBarPageTexts)==null?void 0:Q.current)==null?void 0:W.sx)!=null?D:[]:[(ie=(Oe=e==null?void 0:e.progressBarPageTexts)==null?void 0:Oe.current)==null?void 0:ie.sx]],onClick:()=>V.openPage("previous","ltr",!1),children:E.name}),a.jsx(Kn,{onClickAway:()=>h(!1),children:a.jsxs(ta,{...e==null?void 0:e.progressBarSlotsActionArea,onMouseDown:w,onMouseUp:R,onTouchStart:w,onTouchEnd:R,children:[a.jsxs(Jn,{ref:f,...e==null?void 0:e.progressBarSlotsContainer,children:[i.map((B,T)=>l.createElement(oa,{...e==null?void 0:e.progressBarSlot,key:B.primary.index,page:B,pagesIndex:T,isCurrentPage:T===P,isLeadingPage:T<P,isTrailingPage:T>P,totalPages:i.length,primaryPageLoadState:c[B.primary.index].loaded,secondaryPageLoadState:B.secondary?c[B.secondary.index].loaded:void 0,createProgressBarSlot:s,showDraggingStyle:T===P&&u})),a.jsx(Qn,{...e==null?void 0:e.progressBarReadPages,currentPagesIndex:E.pagesIndex,pagesLength:i.length,progressBarPosition:r})]}),a.jsx(ea,{boxProps:e==null?void 0:e.progressBarCurrentPageSlot,pageName:E.name,currentPagesIndex:E.pagesIndex,pagesLength:i.length,isDragging:u,progressBarPosition:r,children:t==null?void 0:t.progressBarCurrentPage})]})}),a.jsx(Cr,{ref:m,...(Ce=e==null?void 0:e.progressBarPageTexts)==null?void 0:Ce.base,...(xe=e==null?void 0:e.progressBarPageTexts)==null?void 0:xe.total,sx:[{minWidth:"unset"},...Array.isArray((Ge=(We=e==null?void 0:e.progressBarPageTexts)==null?void 0:We.base)==null?void 0:Ge.sx)?(_e=(Ee=(Pe=e==null?void 0:e.progressBarPageTexts)==null?void 0:Pe.base)==null?void 0:Ee.sx)!=null?_e:[]:[($e=(me=e==null?void 0:e.progressBarPageTexts)==null?void 0:me.base)==null?void 0:$e.sx],...Array.isArray((nt=(Je=e==null?void 0:e.progressBarPageTexts)==null?void 0:Je.total)==null?void 0:nt.sx)?(Y=(Te=(je=e==null?void 0:e.progressBarPageTexts)==null?void 0:je.total)==null?void 0:Te.sx)!=null?Y:[]:[(He=(ye=e==null?void 0:e.progressBarPageTexts)==null?void 0:ye.total)==null?void 0:He.sx]],onClick:()=>V.openPage("next","ltr",!1),children:d})]})})},is=l.memo(ia),ca=l.forwardRef(({direction:e,...t},s)=>{const{settings:{customThemes:r,appTheme:n,themeMode:o,shouldUsePureBlackMode:i}}=Vr(),c=l.useMemo(()=>Es(o,Ts(n,r),i,e),[o,n,r,i,e]);return a.jsx(ws,{value:As[e],children:a.jsx(Is,{theme:c,children:a.jsx(X,{...t,ref:s,dir:e})})})}),cs=ge(ca,[()=>({direction:y.useGetThemeDirection()})],["direction"]),ls=l.memo(({pageName:e,progressBarPosition:t,slotProps:s,children:r})=>{var n;return a.jsx(G,{...s==null?void 0:s.tooltip,title:e,placement:_r[t],children:a.jsx(X,{...s==null?void 0:s.box,sx:{width:"100%",height:"100%",...(n=s==null?void 0:s.box)==null?void 0:n.sx},children:r})})}),la=l.memo(({pageName:e,primaryPageLoadState:t,secondaryPageLoadState:s,progressBarPosition:r,isCurrentPage:n,isLeadingPage:o,showDraggingStyle:i})=>{const c=st();return a.jsx(ls,{pageName:e,progressBarPosition:r,slotProps:{box:{sx:{cursor:"pointer",backgroundColor:dr(c.palette.background.paper,.2),...c.applyStyles("dark",{backgroundColor:ur(c.palette.background.paper,.1)}),...S(t&&(s==null||s),{backgroundColor:dr(c.palette.background.paper,.35),...c.applyStyles("dark",{backgroundColor:ur(c.palette.background.paper,.25)})})}},tooltip:{slotProps:n?{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}}:void 0}},children:a.jsx(X,{sx:{width:"100%",height:"100%",...S(o,{backgroundColor:tt(c.palette.primary.main,.5)}),...S(n,{cursor:i?"grabbing":"grab",pointer:"grabbing",borderRadius:2,backgroundColor:"primary.dark",...c.applyStyles("dark",{backgroundColor:"primary.light"})})}})})}),da=({readerNavBarWidth:e,readerDirection:t})=>{const s=st(),r=ct(w=>w.scrollbar),n=qe(w=>w.pages.totalPages),{progressBarType:o,progressBarSize:i,progressBarPosition:c,progressBarPositionAutoVertical:d}=J(w=>({progressBarType:w.settings.progressBarType,progressBarSize:w.settings.progressBarSize,progressBarPosition:w.settings.progressBarPosition,progressBarPositionAutoVertical:w.settings.progressBarPositionAutoVertical})),{isMaximized:p,setIsMaximized:g,isDragging:u}=Vt(w=>({isMaximized:w.progressBar.isMaximized,setIsMaximized:w.progressBar.setIsMaximized,isDragging:w.progressBar.isDragging})),[,h]=l.useState({});Fe(window.document.documentElement,l.useCallback(()=>h({}),[]));const f=es(c,d,r.ySize,e+r.xSize),{isBottom:x,isLeft:b,isRight:C,isVertical:m,isHorizontal:P}=be(f),A=!!n,E=o===qt.HIDDEN,I=!p&&!u;return a.jsx(cs,{children:a.jsx(is,{direction:P?t:"ltr",progressBarPosition:f,fullSegmentClicks:!0,createProgressBarSlot:l.useCallback((w,R,v,M,j,N,k,L,U)=>a.jsx(la,{pageName:w.name,primaryPageLoadState:v,secondaryPageLoadState:M,progressBarPosition:f,isCurrentPage:j,isLeadingPage:N,showDraggingStyle:U}),[f]),slotProps:{container:{sx:{overflow:"hidden",transition:"all 0.".concat(s.transitions.duration.shortest,"s"),...S(P,{minHeight:"100px",...S(s.direction==="ltr",{left:t==="ltr"?e:r.ySize,right:t==="rtl"?e:r.ySize}),...S(s.direction==="rtl",{left:t==="rtl"?e:r.ySize,right:t==="ltr"?e:r.ySize})}),...S(m,{minWidth:"100px",bottom:"".concat(r.xSize,"px")}),...S(x,{bottom:"".concat(r.xSize,"px")}),...S(b,{...S(s.direction==="ltr",{left:t==="ltr"?e:"unset",right:t==="rtl"?e:"unset"}),...S(s.direction==="rtl",{right:t==="rtl"?r.ySize:"unset",left:t==="ltr"?r.ySize:"unset"})}),...S(C,{...S(s.direction==="ltr",{right:t==="ltr"?r.ySize:"unset",left:t==="rtl"?r.ySize:"unset"}),...S(s.direction==="rtl",{left:t==="rtl"?e:"unset",right:t==="ltr"?e:"unset"})}),...S(I,{opacity:E?0:.85}),...S(!A,{pointerEvents:"none"})},onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1)},progressBarRoot:{sx:{gap:0,transition:"all 0.1s ease-in-out",backgroundColor:"background.paper",...S(m,{flexDirection:"column",height:"100%"}),...S(I,{backgroundColor:"unset",pointerEvents:"none",...S(P,{px:2}),...S(m,{py:2}),...S(x,{pb:.25}),...S(b,{...S(s.direction==="ltr",{pl:t==="ltr"?.25:0,pr:t==="rtl"?.25:0}),...S(s.direction==="rtl",{pr:t==="rtl"?.25:0,pl:t==="ltr"?.25:0})}),...S(C,{...S(s.direction==="ltr",{pr:t==="ltr"?.25:0,pl:t==="rtl"?.25:0}),...S(s.direction==="rtl",{pl:t==="rtl"?.25:0,pr:t==="ltr"?.25:0})})})}},progressBarSlotsContainer:{sx:{gap:.25,borderRadius:2,transition:"height 0.1s ease-in-out",...S(P,{height:"20px"}),...S(m,{flexDirection:"column",width:"20px"}),...S(I,{...S(P,{height:"".concat(i,"px")}),...S(m,{width:"".concat(i,"px")})})}},progressBarReadPages:{sx:{display:"none"}},progressBarCurrentPageSlot:{sx:{display:"none"}},progressBarPageTexts:{base:{sx:{px:1,py:1.5,transition:"all 0.1s ease-in-out",...S(I,{transform:"scale(0)",p:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})}}}}})})},ua=ge(l.memo(da),[Ke,()=>({readerDirection:y.useGetThemeDirection()})],["readerNavBarWidth","readerDirection"]),ga=Ze(_)({width:"400px",minWidth:"400px",maxWidth:"400px",height:"100vh",overflowY:"auto"}),ha=l.memo(({mangaId:e,mangaTitle:t,chapterTitle:s,scanlator:r})=>a.jsxs(_,{children:[a.jsx(G,{title:t,placement:"right",children:a.jsx(Ct,{lines:3,variant:"h6",component:"h1",sx:{textAlign:"center"},children:a.jsx(Dt,{component:_t,to:rr.manga.path(e),sx:{textDecoration:"none",color:"inherit"},children:t})})}),a.jsx(G,{title:s,placement:"right",children:a.jsx(Ct,{lines:4,variant:"body1",component:"h2",sx:{textAlign:"center"},children:s})}),r&&a.jsx(G,{title:r,placement:"right",children:a.jsx(Ct,{lines:4,variant:"body2",component:"h3",color:"textDisabled",sx:{textAlign:"center"},children:r})})]})),pa=Me(a.jsx("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"})),fa=Me(a.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),kt=({title:e,type:t,disabled:s,...r})=>a.jsx(G,{title:e,disabled:s,children:a.jsx(os,{sx:{flexBasis:"15%"},variant:"contained",disabled:s,...r,children:t==="previous"?a.jsx(pa,{}):a.jsx(fa,{})})}),xa=()=>{const{t:e}=$(),t=zr(),{currentPageIndex:s,pages:r}=qe(c=>({currentPageIndex:c.pages.currentPageIndex,pages:c.pages.pages})),n=J(c=>c.settings.readingDirection.value),o=l.useMemo(()=>Ne(s,r),[s,r]),i=Rt[n];return a.jsxs(_,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[a.jsx(kt,{type:"previous",title:e(t("reader.button.previous_page","reader.button.next_page",i)),disabled:t(!o.primary.index,le(o)===le(r.slice(-1)[0]),i),onClick:()=>V.openPage("previous",void 0,!1)}),a.jsxs(Ur,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[a.jsx(Fr,{id:"reader-nav-bar-desktop-page-select",children:e("reader.page_info.label.page")}),a.jsx(as,{labelId:"reader-nav-bar-desktop-page-select",label:e("reader.page_info.label.page"),value:le(o),onChange:c=>V.openPage(c.target.value,void 0,!1),children:r.map(c=>a.jsx(Pt,{value:le(c),children:c.name},le(c)))})]}),a.jsx(kt,{type:"next",title:e(t("reader.button.next_page","reader.button.previous_page",i)),disabled:t(le(o)===le(r.slice(-1)[0]),!o.primary.index,i),onClick:()=>V.openPage("next",void 0,!1)})]})},ma=l.memo(xa),va=()=>{},ds=({currentChapter:e,chapters:t,style:s})=>{const r=l.useMemo(()=>e&&t.findIndex(n=>n.id===e.id),[e,t]);return a.jsx(On,{style:{height:"calc(".concat(t.length," * 100px)"),...s},initialTopMostItemIndex:r!=null?r:0,totalCount:t.length,computeItemKey:n=>t[n].id,itemContent:n=>a.jsx(jn,{index:n,chapters:t,isSortDesc:!0,mode:"reader",showChapterNumber:!1,selected:null,onSelect:va,selectable:!1,isActiveChapter:n===r}),increaseViewportBy:400})},Sa=({currentChapter:e,previousChapter:t,nextChapter:s,chapters:r=[],readerThemeDirection:n})=>{var c,d;const{t:o}=$(),i=Lt({variant:"popover",popupId:"reader-nav-bar-desktop-chapter-list"});return l.useLayoutEffect(()=>{i.close()},[e==null?void 0:e.id]),a.jsxs(_,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[a.jsx(kt,{type:"previous",title:o(q("reader.button.previous_chapter","reader.button.next_chapter",n)),onClick:()=>{V.openChapter(q("previous","next",n))},disabled:q(!t,!s,n)}),a.jsxs(Ur,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[a.jsx(Fr,{id:"reader-nav-bar-desktop-chapter-select",children:o("chapter.title_one")}),a.jsx(as,{...Bt(i),open:i.isOpen,value:(c=e==null?void 0:e.id)!=null?c:0,MenuProps:{sx:{visibility:"hidden"}},label:o("chapter.title_one"),labelId:"reader-nav-bar-desktop-chapter-select",children:a.jsx(Pt,{value:(d=e==null?void 0:e.id)!=null?d:0,children:e?"#".concat(e.chapterNumber," ").concat(e.name):""},e==null?void 0:e.id)})]}),a.jsx(kt,{component:_t,type:"next",title:o(q("reader.button.next_chapter","reader.button.previous_chapter",n)),onClick:()=>{V.openChapter(q("next","previous",n))},disabled:q(!s,!t,n)}),a.jsx(Ms,{...Os(i),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:a.jsx(X,{sx:{mb:1},children:a.jsx(ds,{style:{width:"500px",maxWidth:"90vw",minHeight:"150px",maxHeight:"300px"},currentChapter:e,chapters:r})})})]})},ba=ge(l.memo(Sa),[()=>({readerThemeDirection:y.useGetThemeDirection()})],["readerThemeDirection"]),Ra=Me(a.jsx("path",{d:"M17 4h3c1.1 0 2 .9 2 2v2h-2V6h-3zM4 8V6h3V4H4c-1.1 0-2 .9-2 2v2zm16 8v2h-3v2h3c1.1 0 2-.9 2-2v-2zM7 18H4v-2H2v2c0 1.1.9 2 2 2h3zM18 8H6v8h12z"})),us=(e,t,s)=>{const n=(e+1)%t.length===0;if(!(s&&n))return t[(e+1)%t.length]},cr=({tooltip:e,value:t,defaultValue:s,values:r,setValue:n,valueToDisplayData:o,isDefaultable:i,onDefault:c,defaultIcon:d})=>{const{t:p}=$(),g=t===void 0,u=l.useMemo(()=>g?-1:r.indexOf(t),[t,r]);return a.jsx(G,{title:e,children:g?a.jsx(rt,{onClick:()=>n(r[0]),sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:d,size:"large",children:s===void 0?p("global.label.default"):a.jsx(en,{i18nKey:"settings.default_value",value:o[s].isTitleString?o[s].title:p(o[s].title)})}):a.jsx(rt,{onClick:()=>{const h=us(u,r,i);if(h===void 0){c==null||c();return}n(h)},sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:o[t].icon,size:"large",children:o[t].isTitleString?o[t].title:p(o[t].title)})})},Ca=({pageScaleMode:e,shouldStretchPage:t,updateSetting:s,...r})=>{const{t:n}=$();return a.jsxs(_,{sx:{flexDirection:"row",gap:1},children:[a.jsx(cr,{...r,tooltip:n("reader.settings.page_scale.title"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Wr,setValue:o=>s("pageScaleMode",o),valueToDisplayData:gr,defaultIcon:gr[e.value].icon}),js[e.value]&&a.jsx(G,{title:n("reader.settings.page_scale.stretch"),children:a.jsx(os,{onClick:()=>s("shouldStretchPage",!t.value),sx:{px:void 0},variant:"contained",color:t.value?"secondary":"primary",children:a.jsx(Ra,{})})})]})},Pa=({readingMode:e,setReadingMode:t,...s})=>{const{t:r}=$();return a.jsx(cr,{...s,tooltip:r("reader.settings.label.reading_mode"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Gr,setValue:t,valueToDisplayData:Jt,defaultIcon:Jt[e.value].icon})},Ea=()=>a.jsx(ys,{children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:a.jsx("path",{d:"M2 4h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2m20 0h-6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6M2 12h20m-3-3 3 3-3 3M5 9l-3 3 3 3"})})}),Ta=({readingMode:e,shouldOffsetDoubleSpreads:t,setShouldOffsetDoubleSpreads:s})=>{const{t:r}=$();return tn(e)?a.jsx(rt,{sx:{justifyContent:"start",textTransform:"unset"},size:"large",onClick:()=>s(!t),color:t?"secondary":"primary",variant:"contained",startIcon:a.jsx(Ea,{}),children:r("reader.settings.label.offset_double_spread")}):null},wa=({readingDirection:e,setReadingDirection:t,...s})=>{const{t:r}=$();return a.jsx(cr,{...s,tooltip:r("reader.settings.label.reading_direction"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:$r,setValue:t,valueToDisplayData:hr,defaultIcon:hr[e.value].icon})},Aa=Me(a.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 14H9V8h2zm4 0h-2V8h2z"})),Ia=Me(a.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 14.5v-9l6 4.5z"})),Ma=({autoScroll:e,setAutoScroll:t})=>{const{t:s}=$(),{isActive:r,toggleActive:n}=zt(i=>({isActive:i.autoScroll.isActive,toggleActive:i.autoScroll.toggleActive})),o=l.useRef(void 0);return a.jsxs(_,{sx:{flexDirection:"row",gap:1},children:[a.jsx(rt,{sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},size:"large",onClick:n,color:r?"secondary":"primary",variant:"contained",startIcon:r?a.jsx(Aa,{}):a.jsx(Ia,{}),children:s("reader.settings.auto_scroll.title")}),a.jsx(Ds,{value:e.value,type:"number",size:"small",onBlur:i=>{const c=ot(+i.target.value,ze.min,ze.max);c!==e.value&&(clearTimeout(o.current),t({...e,value:c},!0))},onChange:i=>{const c=ot(+i.target.value,ze.min,ze.max);t({...e,value:c},!1),clearTimeout(o.current),o.current=setTimeout(()=>t({...e,value:c},!0),1e3)},slotProps:{input:{inputProps:ze,endAdornment:a.jsx(Ls,{position:"end",children:s("global.time.seconds.second",{count:e.value})})}}})]})},Oa=({openSettings:e})=>{const{t}=$(),{readingMode:s,shouldOffsetDoubleSpreads:r,pageScaleMode:n,shouldStretchPage:o,readingDirection:i,autoScroll:c}=J(d=>({readingMode:d.settings.readingMode,shouldOffsetDoubleSpreads:d.settings.shouldOffsetDoubleSpreads,pageScaleMode:d.settings.pageScaleMode,shouldStretchPage:d.settings.shouldStretchPage,readingDirection:d.settings.readingDirection,autoScroll:d.settings.autoScroll}));return a.jsxs(_,{sx:{gap:1},children:[a.jsx(Pa,{readingMode:s,setReadingMode:d=>y.updateSetting("readingMode",d),isDefaultable:!0,onDefault:()=>y.deleteSetting("readingMode")}),a.jsx(Ta,{readingMode:s.value,shouldOffsetDoubleSpreads:r.value,setShouldOffsetDoubleSpreads:d=>y.updateSetting("shouldOffsetDoubleSpreads",d)}),a.jsx(Ca,{pageScaleMode:n,shouldStretchPage:o,updateSetting:y.updateSetting,isDefaultable:!0,onDefault:()=>y.deleteSetting("pageScaleMode")}),a.jsx(wa,{readingDirection:i,setReadingDirection:d=>y.updateSetting("readingDirection",d),isDefaultable:!0,onDefault:()=>y.deleteSetting("readingDirection")}),a.jsx(Ma,{autoScroll:c,setAutoScroll:(...d)=>y.updateSetting("autoScroll",...d)}),a.jsx(rt,{onClick:()=>e(),size:"large",sx:{justifyContent:"start",textTransform:"none"},variant:"contained",startIcon:a.jsx(Xr,{}),children:t("settings.title")})]})},ja=l.memo(Oa),ya=Me(a.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"})),Pr={...ir,title:"Fallback",inLibrary:!1},gs=l.memo(()=>{const e=At(o=>o.manga),{inLibrary:t}=e!=null?e:Pr,{t:s}=$(),{CategorySelectComponent:r,updateLibraryState:n}=Tn(e!=null?e:Pr,!0);return a.jsxs(a.Fragment,{children:[a.jsx(G,{title:s(t?"manga.action.library.remove.label.action":"manga.button.add_to_library"),children:a.jsx(ae,{onClick:n,color:"inherit",children:t?a.jsx(kn,{}):a.jsx(wn,{})})}),r]})}),Da=Me(a.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),La=({id:e,isBookmarked:t})=>{const{t:s}=$(),r=t?"unbookmark":"bookmark";return a.jsx(G,{title:s(er[r].action.single),children:a.jsx(ae,{onClick:()=>Be.performAction(r,[e],{}),color:"inherit",children:t?a.jsx(yn,{}):a.jsx(Da,{})})})},hs=l.memo(La),Ba=({currentChapter:e})=>{var r;const{t}=$(),s=Be.useDownloadStatusFromCache((r=e==null?void 0:e.id)!=null?r:-1);return e&&Be.isDownloaded(e)?a.jsx(G,{title:t(er.delete.action.single),children:a.jsx(ae,{onClick:()=>Be.performAction("delete",[e.id],{}),color:"inherit",children:a.jsx(Bn,{})})}):s?a.jsx(Nn,{chapterId:s.chapter.id}):a.jsx(G,{title:t(er.download.action.single),disabled:!e,children:a.jsx(ae,{disabled:!e,onClick:()=>{var n;return Be.performAction("download",[(n=e==null?void 0:e.id)!=null?n:-1],{})},color:"inherit",children:a.jsx(Ln,{})})})},Na=l.memo(()=>{const e=Ue(g=>g.chapters.currentChapter),{id:t,isBookmarked:s,realUrl:r}=e!=null?e:ns,{t:n}=$(),{pageLoadStates:o,setPageLoadStates:i,setRetryFailedPagesKeyPrefix:c}=qe(g=>({pageLoadStates:g.pages.pageLoadStates,setPageLoadStates:g.pages.setPageLoadStates,setRetryFailedPagesKeyPrefix:g.pages.setRetryFailedPagesKeyPrefix})),d=l.useRef(0),p=l.useMemo(()=>o.some(g=>g.error),[o]);return a.jsxs(_,{sx:{flexDirection:"row",justifyContent:"center",gap:1},children:[a.jsx(gs,{}),a.jsx(hs,{id:t,isBookmarked:s}),a.jsx(G,{title:n("reader.button.retry_load_pages"),disabled:!p,children:a.jsx(ae,{onClick:()=>{i(g=>g.map(u=>({url:u.url,loaded:u.loaded}))),c("".concat(d.current)),d.current=(d.current+1)%1e3},disabled:!p,color:"inherit",children:a.jsx(ya,{})})}),a.jsx(Ba,{currentChapter:e}),a.jsx(G,{title:n("global.button.open_browser"),disabled:!r,children:a.jsx(ae,{disabled:!r,href:r!=null?r:"",rel:"noreferrer",target:"_blank",color:"inherit",children:a.jsx(Dn,{})})}),a.jsx(G,{title:n("global.button.open_webview"),disabled:!r,children:a.jsx(ae,{disabled:!r,href:r?wt.getWebviewUrl(r):"",rel:"noreferrer",target:"_blank",color:"inherit",children:a.jsx(_n,{})})})]})}),ka=({exit:e})=>{const{t}=$(),s=zr();return a.jsx(G,{title:t("reader.button.exit"),children:a.jsx(ae,{sx:{marginRight:2},onClick:e,color:"inherit",children:s(a.jsx(Bs,{}),a.jsx(Ns,{}))})})},ps=ge(l.memo(ka),[()=>({exit:y.useExit()})],["exit"]),_a=(e,t)=>{const s=l.useRef(t),r=l.useRef(t);return r.current!==s.current&&!e&&(s.current=!1),r.current!==t&&(s.current=r.current,r.current=t),s.current},Ha=({isVisible:e,openSettings:t,setReaderNavBarWidth:s})=>{const{t:r}=$(),n=At(b=>b.manga),{chapters:o,currentChapter:i,previousChapter:c,nextChapter:d}=Ue(b=>({chapters:b.chapters.chapters,currentChapter:b.chapters.currentChapter,previousChapter:b.chapters.previousChapter,nextChapter:b.chapters.nextChapter})),p=J(b=>b.settings.isStaticNav),[g,u]=l.useState();Fe(g,l.useCallback(()=>{p&&s(g.offsetWidth)},[g,p])),l.useLayoutEffect(()=>()=>s(0),[]);const x=_a(e,p)&&e?0:void 0;return a.jsx(ks,{variant:p?"permanent":"persistent",open:e||p,transitionDuration:x,SlideProps:{unmountOnExit:!0},PaperProps:{ref:b=>u(b)},children:a.jsxs(ga,{sx:{backgroundColor:"background.paper",pointerEvents:"all"},children:[a.jsxs(_,{sx:{p:2,gap:2,backgroundColor:"action.hover"},children:[a.jsxs(_,{sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[a.jsx(ps,{}),a.jsx(G,{title:r("reader.settings.label.static_navigation"),children:a.jsx(ae,{onClick:()=>{s(0),y.updateSetting("isStaticNav",!p)},color:p?"primary":"inherit",children:p?a.jsx(Pn,{}):a.jsx(En,{})})})]}),n&&i?a.jsxs(a.Fragment,{children:[a.jsx(ha,{mangaId:n.id,mangaTitle:n.title,chapterTitle:i.name,scanlator:i.scanlator}),a.jsx(Na,{})]}):a.jsx(Ht,{})]}),a.jsxs(_,{sx:{p:2,gap:2},children:[a.jsxs(_,{sx:{gap:1},children:[a.jsx(ma,{}),a.jsx(ba,{chapters:o,currentChapter:i,nextChapter:d,previousChapter:c})]}),a.jsx(_s,{}),a.jsx(ja,{openSettings:t})]})]})})},Va=ge(l.memo(Ha),[Ke],["setReaderNavBarWidth"]),za={...ir,title:""},Ua=l.forwardRef(({isVisible:e},t)=>{const{t:s}=$(),r=Lt({popupId:"reader-overlay-more-menu",variant:"popover"}),n=Ue(f=>f.chapters.currentChapter),o=At(f=>f.manga),i=ct(f=>f.scrollbar),{id:c,title:d}=o!=null?o:za,{id:p,name:g,realUrl:u,isBookmarked:h}=n!=null?n:ns;return a.jsx(sr,{direction:"down",in:e,ref:t,children:a.jsxs(_,{sx:{flexDirection:"row",alignItems:"center",position:"fixed",top:0,left:0,right:"".concat(i.ySize,"px"),p:2,pt:f=>"max(env(safe-area-inset-top), ".concat(f.spacing(2),")"),backgroundColor:f=>tt(f.palette.background.paper,.95),pointerEvents:"all",boxShadow:2},children:[a.jsx(ps,{}),a.jsx(_,{sx:{flexGrow:1},children:o&&n?a.jsxs(a.Fragment,{children:[a.jsx(G,{title:d,children:a.jsx(Ct,{lines:1,component:"h1",variant:"h5",children:a.jsx(Dt,{component:_t,to:rr.manga.path(c),sx:{textDecoration:"none",color:"inherit"},children:d})})}),a.jsx(G,{title:g,children:a.jsx(Ct,{lines:1,children:g})})]}):a.jsx(Ht,{})}),a.jsx(gs,{}),a.jsx(hs,{id:p,isBookmarked:h}),a.jsx(ae,{...Bt(r),color:"inherit",children:a.jsx(An,{})}),a.jsxs(Hs,{...Vs(r),children:[a.jsx(Pt,{component:Dt,disabled:!u,href:u!=null?u:"",rel:"noreferrer",target:"_blank",children:s("global.button.open_browser")}),a.jsx(Pt,{component:Dt,disabled:!u,href:u?wt.getWebviewUrl(u):"",rel:"noreferrer",target:"_blank",children:s("global.button.open_webview")}),a.jsx(Pt,{disabled:!u,onClick:async()=>{await navigator.clipboard.writeText(d),Yr(s("global.label.copied_clipboard"),"info")},children:s("global.label.share")})]})]})})}),Fa=l.memo(Ua),Wa=Me(a.jsx("path",{d:"m21.81 12.74-.82-.63v-.22l.8-.63c.16-.12.2-.34.1-.51l-.85-1.48c-.07-.13-.21-.2-.35-.2q-.075 0-.15.03l-.95.38c-.08-.05-.11-.07-.19-.11l-.15-1.01c-.03-.21-.2-.36-.4-.36h-1.71c-.2 0-.37.15-.4.34l-.14 1.01c-.03.02-.07.03-.1.05l-.09.06-.95-.38q-.075-.03-.15-.03c-.14 0-.27.07-.35.2l-.85 1.48c-.1.17-.06.39.1.51l.8.63v.23l-.8.63c-.16.12-.2.34-.1.51l.85 1.48c.07.13.21.2.35.2q.075 0 .15-.03l.95-.37c.08.05.12.07.2.11l.15 1.01c.03.2.2.34.4.34h1.71c.2 0 .37-.15.4-.34l.15-1.01c.03-.02.07-.03.1-.05l.09-.06.95.38q.075.03.15.03c.14 0 .27-.07.35-.2l.85-1.48c.1-.17.06-.39-.1-.51M18 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M17 17h2v4c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v4h-2V6H7v12h10z"})),Ga=Me(a.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5M7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"})),Er=Me(a.jsx("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})),Tr=Me(a.jsx("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"})),$a={display:"flex",alignItems:"center",justifyContent:"end",position:"relative",backgroundColor:"background.default"},wr="3px",Xa=l.memo(({isTrailingPage:e,pagesIndex:t,totalPages:s,isVertical:r,isHorizontal:n})=>{const o="".concat(t/(s-1)*100,"%");return a.jsx(X,{sx:{position:"absolute",...S(r,{top:o,left:"50%"}),...S(n,{top:"50%",left:o}),transform:"translate(-50%, -50%)",width:wr,height:wr,borderRadius:100,backgroundColor:"background.paper",...S(e,{backgroundColor:"primary.main"}),zIndex:1}})}),Ya=l.memo(({pageName:e,isTrailingPage:t,isCurrentPage:s,pagesIndex:r,totalPages:n,isVertical:o,isHorizontal:i})=>a.jsx(ls,{pageName:e,progressBarPosition:vt.BOTTOM,slotProps:{box:{sx:$a}},children:!s&&a.jsx(Xa,{isTrailingPage:t,pagesIndex:r,totalPages:n,isVertical:o,isHorizontal:i})})),Ka={[vt.BOTTOM]:"up",[vt.LEFT]:"right",[vt.RIGHT]:"left",[vt.AUTO]:"left"},Za=({direction:e,topOffset:t=0,bottomOffset:s=0})=>{const r=ct(R=>R.scrollbar),n=nr(R=>R.overlay.isVisible),{currentPageIndex:o,pages:i}=qe(R=>({currentPageIndex:R.pages.currentPageIndex,pages:R.pages.pages})),{previousChapter:c,nextChapter:d}=Ue(R=>({previousChapter:R.chapters.previousChapter,nextChapter:R.chapters.nextChapter})),{progressBarPosition:p,progressBarPositionAutoVertical:g}=J(R=>({progressBarPosition:R.settings.progressBarPosition,progressBarPositionAutoVertical:R.settings.progressBarPositionAutoVertical})),{setIsMaximized:u,isDragging:h}=Vt(R=>({setIsMaximized:R.progressBar.setIsMaximized,isDragging:R.progressBar.isDragging})),[,f]=l.useState({});Fe(window.document.documentElement,l.useCallback(()=>f({}),[]));const x=es(p,g,t+s,r.xSize),{isLeft:b,isRight:C,isVertical:m,isHorizontal:P}=be(x),A=P?e:"ltr",E=l.useMemo(()=>Ne(o,i).pagesIndex,[o,i]),I=l.useMemo(()=>({container:{sx:{flexGrow:1,position:"relative",display:"flex",justifyItems:"center",alignItems:"stretch",backgroundColor:R=>tt(R.palette.background.paper,.85),borderRadius:100,boxShadow:2}},progressBarRoot:{sx:{flexGrow:1,gap:0,...S(m,{flexDirection:"column"}),...S(P,{alignItems:"stretch"})}},progressBarSlotsActionArea:{sx:{alignItems:"center",cursor:"pointer",...S(m,{width:"100%",flexDirection:"column",px:2}),...S(P,{height:"100%",py:2})}},progressBarSlotsContainer:{sx:{borderRadius:100,backgroundColor:"background.default",...S(m,{flexDirection:"column",py:1}),...S(P,{px:1})}},progressBarSlot:{sx:{...S(m,{width:"20px"}),...S(P,{height:"20px"})}},progressBarCurrentPageSlot:{sx:{display:"flex",zIndex:1,cursor:"inherit",...S(m,{justifyContent:"center"}),...S(P,{alignItems:"center"})}},progressBarPageTexts:{base:{sx:{...S(m,{py:1}),...S(P,{px:1})}}}}),[m,P]),w=l.useMemo(()=>({progressBarCurrentPage:a.jsx(X,{sx:{position:"absolute",...S(m,{top:"calc(100% - 6px)",...S(E===0,{top:"0"}),width:"75%",height:"6px"}),...S(P,{left:"calc(100% - 0px)",...S(E===0,{left:"0"}),width:"6px",height:"75%"}),backgroundColor:"primary.main",borderRadius:100,cursor:h?"grabbing":"grab"}})}),[E,i.length,h,m,P]);return l.useLayoutEffect(()=>(u(n),()=>u(!1)),[n]),a.jsx(sr,{direction:Ka[x],in:n,children:a.jsx(cs,{sx:{position:"relative",display:"flex",alignItems:"end",height:"100%",pointerEvents:"none",...S(b,{justifyContent:e==="ltr"?"start":"end"}),...S(C,{justifyContent:e==="ltr"?"end":"start"})},children:a.jsxs(_,{sx:{p:2,gap:1,pointerEvents:"all",alignItems:"center",...S(m,{height:"100%",flexDirection:"column"}),...S(P,{width:"100%",flexDirection:"row"})},children:[a.jsx(ae,{onClick:()=>V.openChapter("previous"),disabled:!c,sx:{backgroundColor:R=>tt(R.palette.background.paper,.85),boxShadow:2},children:q(a.jsx(Er,{sx:{...S(m,{transform:"rotate(90deg)"})}}),a.jsx(Tr,{sx:{...S(m,{transform:"rotate(90deg)"})}}),A)}),a.jsx(is,{direction:A,progressBarPosition:x,fullSegmentClicks:!1,createProgressBarSlot:l.useCallback((R,v,M,j,N,k,L,U)=>a.jsx(Ya,{pageName:R.name,isTrailingPage:L,isCurrentPage:N,pagesIndex:v,totalPages:U,isVertical:m,isHorizontal:P}),[m,P]),slotProps:{...I,progressBarReadPages:{sx:{backgroundColor:"primary.main",...S(m,{width:"20px",height:"".concat(Math.max(0,Ne(o,i).pagesIndex)/(i.length-1)*100,"%"),borderRadius:"400px 400px 0 0"}),...S(P,{width:"".concat(Math.max(0,Ne(o,i).pagesIndex)/(i.length-1)*100,"%"),height:"20px",borderRadius:"400px 0 0 400px"})}}},slots:w}),a.jsx(ae,{onClick:()=>V.openChapter("next"),disabled:!d,sx:{backgroundColor:R=>tt(R.palette.background.paper,.85),boxShadow:2},children:q(a.jsx(Tr,{sx:{...S(m,{transform:"rotate(90deg)"})}}),a.jsx(Er,{sx:{...S(m,{transform:"rotate(90deg)"})}}),A)})]})})})},qa=ge(l.memo(Za),[()=>({direction:y.useGetThemeDirection()})],["direction"]),Ja=()=>{const{t:e}=$(),{isActive:t,toggleActive:s}=zt(i=>({isActive:i.autoScroll.isActive,toggleActive:i.autoScroll.toggleActive})),{readingMode:r,readingDirection:n,autoScroll:o}=J(i=>({readingMode:i.settings.readingMode,readingDirection:i.settings.readingDirection,autoScroll:i.settings.autoScroll}));return a.jsxs(_,{sx:{gap:2},children:[a.jsx(rn,{}),a.jsx(sn,{readingMode:r,setReadingMode:i=>y.updateSetting("readingMode",i),isDefaultable:!0,onDefault:()=>y.deleteSetting("readingMode")}),a.jsx(nn,{readingDirection:n,setReadingDirection:i=>y.updateSetting("readingDirection",i),isDefaultable:!0,onDefault:()=>y.deleteSetting("readingDirection")}),a.jsx(Hn,{label:e("reader.settings.auto_scroll.title"),checked:t,onChange:()=>s()}),a.jsx(an,{autoScroll:o,setAutoScroll:(...i)=>y.updateSetting("autoScroll",...i)})]})},Qa=l.memo(Ja),eo=({openSettings:e,isVisible:t,topOffset:s=0})=>{const{t:r}=$(),{currentChapter:n,chapters:o}=Ue(h=>({currentChapter:h.chapters.currentChapter,chapters:h.chapters.chapters})),i=Lt({variant:"dialog",popupId:"reader-chapter-list-dialog"}),c=Lt({variant:"dialog",popupId:"reader-quick-settings-dialog"}),d=ct(h=>h.scrollbar),[p,g]=l.useState(0),u=l.useRef(null);return Fe(u,l.useCallback(()=>{var h,f;return g((f=(h=u.current)==null?void 0:h.clientHeight)!=null?f:0)},[p])),l.useLayoutEffect(()=>{i.close()},[n==null?void 0:n.id]),a.jsxs(a.Fragment,{children:[a.jsxs(_,{sx:{position:"fixed",right:"".concat(d.ySize,"px"),bottom:0,left:0,height:"calc(100% - ".concat(s,"px)")},children:[a.jsx(qa,{topOffset:s,bottomOffset:p}),a.jsx(sr,{direction:"up",in:t,children:a.jsx(_,{ref:u,sx:{alignItems:"center",backgroundColor:h=>tt(h.palette.background.paper,.95),pb:"max(".concat(d.xSize,"px, env(safe-area-inset-bottom))"),boxShadow:2,pointerEvents:"all"},children:a.jsxs(_,{sx:{width:"50%",flexDirection:"row",p:2,gap:1,justifyContent:"space-evenly",alignItems:"center"},children:[a.jsx(G,{title:r("reader.button.chapter_list"),children:a.jsx(ae,{...Bt(i),color:"inherit",children:a.jsx(Ga,{})})}),a.jsx(G,{title:r("reader.settings.title.quick_settings"),children:a.jsx(ae,{...Bt(c),color:"inherit",children:a.jsx(Wa,{})})}),a.jsx(G,{title:r("settings.title"),children:a.jsx(ae,{onClick:e,color:"inherit",children:a.jsx(Xr,{})})})]})})})]}),i.isOpen&&a.jsx(Kt,{...pr(i),fullWidth:!0,maxWidth:"md",scroll:"paper",children:a.jsx(Zt,{sx:{p:0,pb:1},children:a.jsx(ds,{style:{minHeight:"15vh",maxHeight:"75vh"},currentChapter:n,chapters:o})})}),c.isOpen&&a.jsx(Kt,{...pr(c),fullWidth:!0,maxWidth:"md",scroll:"paper",children:a.jsx(Zt,{children:a.jsx(Qa,{})})})]})},to=l.memo(eo),ro=({isVisible:e,isDesktop:t,isMobile:s})=>{const[r,n]=l.useState(!1),[o,i]=l.useState(0),c=l.useRef(null);return Fe(c,l.useCallback(()=>{var d,p;return i((p=(d=c.current)==null?void 0:d.clientHeight)!=null?p:0)},[s])),a.jsxs(X,{sx:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none",zIndex:1},children:[t&&a.jsxs(a.Fragment,{children:[a.jsx(ua,{}),a.jsx(Va,{isVisible:e,openSettings:()=>n(!0)})]}),s&&a.jsxs(a.Fragment,{children:[a.jsx(Fa,{ref:c,isVisible:e}),a.jsx(to,{openSettings:()=>n(!0),isVisible:e,topOffset:o})]}),a.jsx(Gn,{isOpen:r,close:()=>n(!1)}),a.jsx(Xn,{})]})},so=ge(l.memo(ro),[y.useOverlayMode],["isDesktop","isMobile"]),Ar="reader-tap-zone-layout-canvas",no=({readerNavBarWidth:e})=>{const t=st(),{tapZoneLayout:s,tapZoneInvertMode:r,readingDirection:n}=J(f=>({tapZoneLayout:f.settings.tapZoneLayout.value,tapZoneInvertMode:f.settings.tapZoneInvertMode.value,readingDirection:f.settings.readingDirection.value})),o=ar(f=>f.tapZone.showPreview),[i,c]=l.useState(0),[d,p]=l.useState(0),[g,u]=l.useState(null);Fe(g,l.useCallback(()=>{var f,x;c((f=g==null?void 0:g.clientWidth)!=null?f:0),p((x=g==null?void 0:g.clientHeight)!=null?x:0)},[g]));const h=Se.getOrCreateCanvas(s,i,d,t.typography.h3,{vertical:r.vertical,horizontal:r.horizontal,isRTL:n===it.RTL});return l.useLayoutEffect(()=>{const f=document.getElementById(Ar);f==null||f.replaceChildren(h)},[h,o]),a.jsx(X,{ref:u,sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none"},children:o&&a.jsx("div",{id:Ar})})},ao=ge(no,[Ke],["readerNavBarWidth"]),oo=({readerNavBarWidth:e})=>{const{value:{red:t,green:s,blue:r,alpha:n,blendMode:o},enabled:i}=J(c=>c.settings.customFilter.rgba);return i?a.jsx(X,{sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none",background:"rgba(".concat(t," ").concat(s," ").concat(r," / ").concat(n,"%)"),mixBlendMode:"".concat(o)}}):null},io=ge(oo,[Ke],["readerNavBarWidth"]),Ir=2,xt=0,te=0,re=1,co=(e,t=Ie.XY)=>{const[s,r]=l.useState(!1),n=l.useRef(void 0),o=l.useRef([0,0,0]),i=l.useRef([0,0,0]),c=l.useRef([0,0,0]),d=l.useRef([0,0]),p=l.useRef(void 0),g=l.useRef([0,0]),u=l.useRef([0,0]);return l.useEffect(()=>{const h=e==null?void 0:e.current;if(!h)return()=>{};const f=()=>{n.current||(n.current=getComputedStyle(h));const v=n.current.direction==="rtl",M=n.current.flexDirection==="row-reverse";return v||!v&&M},x=()=>(n.current||(n.current=getComputedStyle(h)),n.current.flexDirection==="column-reverse"),b=t!==Ie.Y,C=t!==Ie.X,m=()=>{p.current!==void 0&&(cancelAnimationFrame(p.current),p.current=void 0)},P=()=>{const v=(ie,Ce,xe)=>(ie[xt]-ie[Ir])/(Ce[xt]-Ce[Ir])*1e3/xe,M=[b?v(o.current,c.current,h.clientWidth):0,C?v(i.current,c.current,h.clientHeight):0],j=b&&C?Math.sqrt(M[te]**2+M[re]**2):Math.abs(C?M[re]:M[te]),N=[M[te]/j,M[re]/j],k=ot(1.2*j,-12,12),L=(Date.now()-c.current[xt])/1e3,U=k-14.278*L+75.24*L**2/k-149.72*L**3/k/k;if(!(k!==0&&U>0&&!Number.isNaN(k))){m();return}const oe=(ie,Ce)=>ie*Ce*(k*L-7.1397*L**2+25.08*L**3/k-37.43*L**4/k/k),ne=[oe(h.clientWidth,N[te]),oe(h.clientHeight,N[re])],K=[h.scrollWidth-h.clientWidth,h.scrollHeight-h.clientHeight],Q=[ot(d.current[te]-ne[te],f()?-K[te]:0,K[te]),ot(d.current[re]-ne[re],x()?-K[re]:0,K[re])],W=Q[te]!==0||Q[te]!==K[te],D=Q[re]!==0||Q[re]!==K[re];W||D||m(),b&&(h.scrollLeft=Q[te]),C&&(h.scrollTop=Q[re])};let A=!1;const E=v=>{if(A)return!0;const M=[h.clientHeight<h.scrollHeight,h.clientWidth<h.scrollWidth],j=[Math.abs(o.current[xt]-v.pageX)>0,Math.abs(i.current[xt]-v.pageY)>0];return M[te]&&j[te]||M[re]&&j[re]},I=v=>{E(v)&&(A=!0,r(!0),o.current=[...o.current.slice(1),v.pageX],i.current=[...i.current.slice(1),v.pageY],c.current=[...c.current.slice(1),Date.now()],b&&(h.scrollLeft=u.current[te]-(v.pageX-g.current[te])),C&&(h.scrollTop=u.current[re]-(v.pageY-g.current[re])))},w=()=>{h.removeEventListener("mousemove",I),h.removeEventListener("mouseup",w),setTimeout(()=>{A=!1,r(!1)},0),d.current=[h.scrollLeft,h.scrollTop];const v=()=>{P(),p.current=requestAnimationFrame(v)};p.current=requestAnimationFrame(v)},R=v=>{v.button===0&&(v.preventDefault(),g.current=[v.pageX,v.pageY],u.current=[h.scrollLeft,h.scrollTop],o.current=[v.pageX,v.pageX,v.pageX],i.current=[v.pageY,v.pageY,v.pageY],c.current=[Date.now()-2,Date.now()-1,Date.now()],h.addEventListener("mousemove",I),h.addEventListener("mouseup",w),m())};return h.addEventListener("mousedown",R),h.addEventListener("wheel",m),()=>{h.removeEventListener("mousedown",R),h.removeEventListener("wheel",m),m()}},[e,t]),s},lo=(e,t,s,r,n)=>{l.useEffect(()=>{if(e&&!n){s();return}r()},[e,t,n])},uo=(e,t,s,r)=>{l.useEffect(()=>{var o,i;const n=()=>{e&&Qe().setIsVisible(!1),t&&s(!1)};return(o=r.current)==null||o.addEventListener("wheel",n),(i=r.current)==null||i.addEventListener("touchmove",n),()=>{var c,d;(c=r.current)==null||c.removeEventListener("wheel",n),(d=r.current)==null||d.removeEventListener("touchmove",n)}},[e,t])},go=(e,t,s)=>{l.useEffect(()=>{if(e!==z.CONTINUOUS_HORIZONTAL)return()=>{};if(!s.current)return()=>{};let r,n,o;const i=c=>{var u,h;if(o===!0)return;c.preventDefault();const d=!Math.abs(Math.abs(r!=null?r:c.deltaX)-Math.abs(c.deltaX)),p=!Math.abs(Math.abs(n!=null?n:c.deltaY)-Math.abs(c.deltaY));if(r=c.deltaX,n=c.deltaY,o||(o=!d||!p),o!==void 0){if(c.shiftKey){(u=s.current)==null||u.scrollBy({top:c.deltaY});return}(h=s.current)==null||h.scrollBy({left:t===it.LTR?c.deltaY:c.deltaY*-1})}};return s.current.addEventListener("wheel",i),()=>{var c;return(c=s.current)==null?void 0:c.removeEventListener("wheel",i)}},[e,t])},ho=e=>{const t=l.useRef(void 0);l.useEffect(()=>{const s=n=>{const o=e.current;o&&(o.style.cursor=n?"default":"none")},r=()=>{s(!0),clearTimeout(t.current),t.current=setTimeout(()=>{s(!1)},5e3)};return r(),window.addEventListener("mousemove",r),()=>{s(!0),window.removeEventListener("mousemove",r),clearTimeout(t.current)}},[])},po=(e,t,s,r,n)=>{l.useLayoutEffect(()=>{var o;t||(o=n.current)==null||o.scrollTo(on(n.current,s,r),0)},[e])},fo=(e,t,s,r,n,o,i,c,d,p)=>{l.useLayoutEffect(()=>{if(e==null)return;const g=Ne(e,s);if(i){const f=e>t?Ye.PREVIOUS:Ye.NEXT,x=c.current[g.pagesIndex];x==null||x.scrollIntoView({block:"start",inline:cn(f,d,p)})}const u=le(g),h=u===r-1;n(null),o(u,!h,h)},[e])},xo=(e,t,s,r,n,o,i)=>{const[c,d]=l.useState(i===z.DOUBLE_PAGE);l.useLayoutEffect(()=>{if(c&&i!==z.DOUBLE_PAGE){d(!1);const u=ts(s);r(u),n(u.map(({primary:{url:h}})=>({url:h,isSpread:!1})));return}i===z.DOUBLE_PAGE&&(c||o(le(Ne(e,t))),r(t),d(i===z.DOUBLE_PAGE))},[t,i])},Xt=({title:e,name:t,scanlator:s,backgroundColor:r})=>{const n=st(),o=n.palette.getContrastText(Us(n.palette,Kr[r])),i=tt(o,.5);return t?a.jsxs(_,{children:[a.jsx(et,{color:o,children:e}),a.jsx(et,{color:o,variant:"h6",component:"h1",children:t}),s&&a.jsx(et,{variant:"body2",color:i,children:s})]}):null},mo=({type:e,currentChapterName:t,currentChapterScanlator:s,previousChapterName:r,previousChapterScanlator:n,nextChapterName:o,nextChapterScanlator:i,readerNavBarWidth:c,handleBack:d})=>{var R;const{t:p}=$(),g=At(v=>v.manga),u=ct(v=>v.scrollbar),h=qe(v=>v.pages.transitionPageMode),{readingMode:f,backgroundColor:x,shouldShowTransitionPage:b}=J(v=>({readingMode:v.settings.readingMode.value,backgroundColor:v.settings.backgroundColor,shouldShowTransitionPage:v.settings.shouldShowTransitionPage})),C=e===de.PREVIOUS,m=e===de.NEXT,P=!!t&&!r,A=!!t&&!o,E=P&&e===de.PREVIOUS,I=A&&e===de.NEXT;return!b&&!(E||I)||!ln(e,h,f)?null:a.jsx(_,{sx:{justifyContent:"center",alignItems:"center",...S(!fe(f),{width:"100%",height:"100%"}),...S(fe(f),{position:"sticky",...S(ke(f),{left:0,maxWidth:"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px)"),minHeight:"calc(100vh - ".concat(u.xSize,"px)")}),...S(f===z.CONTINUOUS_HORIZONTAL,{top:0,minWidth:"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px)"),maxHeight:"calc(100vh - ".concat(u.xSize,"px)")})})},children:a.jsxs(_,{sx:{gap:2,maxWidth:v=>"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px - ").concat(v.spacing(2),")"),maxHeight:"calc(100vh - ".concat(u.xSize,"px)"),width:"max-content",p:1},children:[C&&P&&a.jsx(et,{variant:"h6",children:p("reader.transition_page.first_chapter")}),a.jsxs(_,{sx:{gap:5},children:[C&&!P&&a.jsx(Xt,{title:p("reader.transition_page.previous"),name:r,scanlator:n,backgroundColor:x}),!!t&&a.jsx(Xt,{title:p(C?"reader.transition_page.current":"reader.transition_page.finished"),name:t,scanlator:s,backgroundColor:x}),m&&!A&&a.jsx(Xt,{title:p("reader.transition_page.next"),name:o,scanlator:i,backgroundColor:x})]}),m&&A&&a.jsx(et,{variant:"h6",children:p("reader.transition_page.last_chapter")}),(C&&P||m&&A)&&a.jsxs(_,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:[a.jsx(rt,{sx:{flexGrow:1},onClick:v=>{v.stopPropagation(),d()},variant:"contained",children:p("reader.transition_page.exit.previous_page")}),a.jsx(rt,{sx:{flexGrow:1},component:_t,onClick:v=>{v.stopPropagation()},variant:"contained",to:rr.manga.path((R=g==null?void 0:g.id)!=null?R:-1),children:p("reader.transition_page.exit.manga_page")})]})]})})},Mr=ge(l.memo(mo),[({chapterId:e})=>{const t=Ue(i=>i.chapters.chapters),s=l.useMemo(()=>t.findIndex(i=>i.id===e),[e,t]),r=t[s],n=l.useMemo(()=>t[s+1],[s,t]),o=l.useMemo(()=>t[s-1],[s,t]);return{currentChapterName:r==null?void 0:r.name,currentChapterScanlator:r==null?void 0:r.scanlator,previousChapterName:n==null?void 0:n.name,previousChapterScanlator:n==null?void 0:n.name,nextChapterName:o==null?void 0:o.name,nextChapterScanlator:o==null?void 0:o.scanlator}},Ke,({chapterId:e,type:t})=>{const s=zs(),r=Ue(g=>g.chapters.chapters),n=l.useMemo(()=>r.findIndex(g=>g.id===e),[e,r]),o=n===0,i=n===r.length-1,c=t===de.PREVIOUS&&i,d=t===de.NEXT&&o;return{handleBack:c||d?s:Ve}}],["currentChapterName","currentChapterScanlator","previousChapterName","previousChapterScanlator","nextChapterName","nextChapterScanlator","readerNavBarWidth","handleBack"]),vo=(e,t,s,r,n,o,i,c,d,p,g,u,h,f,x,b,C,m)=>{var A,E;const P=l.useRef(void 0);l.useLayoutEffect(()=>{var j;const I=(j=t.data)==null?void 0:j.fetchChapterPages;if(!I)return;const{pages:w}=I,R=w.length?w:[""],v=dn(s,r!=null?r:0,R.length-1),M=P.current!==(I==null?void 0:I.pages);if(M){P.current=I.pages;const N=ts(R);d(!0),u(N),h(R),f(N.map(({primary:{url:k}})=>({url:k,loaded:!1}))),x(N.map(({primary:{url:k}})=>({url:k,isSpread:!1})))}else u(n),f(o),x(i);g(I.pages.length),h(R),b(v),C(v),p(N=>({...N,isCurrentChapterReady:c||M})),m(de.NONE)},[(E=(A=t.data)==null?void 0:A.fetchChapterPages)==null?void 0:E.pages,e])},Or=0,jt="-10px",So=(e,t,s)=>{if(!fe(t))return;const r=Rt[s],n="0px ".concat(jt," 0px 0px"),o="0px 0px 0px ".concat(jt);return ke(t)?e==="first"?"0px 0px ".concat(jt," 0px"):"".concat(jt," 0px 0px 0px"):e==="first"?q(n,o,r):q(o,n,r)},bo=(e,t,s,r)=>e===it.LTR?{start:s>=r,end:t<0}:{start:t<0,end:s>=r},Ro=(e,{top:t,right:s,bottom:r,left:n},o,i)=>{const c=window.innerWidth-i,d=window.innerHeight-o;return{[z.CONTINUOUS_VERTICAL]:{start:r>=d,end:t<0},[z.CONTINUOUS_HORIZONTAL]:bo(e,n,s,c)}},Co=({[z.CONTINUOUS_VERTICAL]:e,[z.CONTINUOUS_HORIZONTAL]:t},s)=>ke(s)?e.start||e.end:t.start||t.end,Po=({[z.CONTINUOUS_VERTICAL]:e,[z.CONTINUOUS_HORIZONTAL]:t},s)=>ke(s)?e:t,jr=(e,t,s,r,n,o,i)=>{const{readingMode:c,readingDirection:d,shouldUseInfiniteScroll:p,shouldShowTransitionPage:g}=J(u=>({readingMode:u.settings.readingMode.value,readingDirection:u.settings.readingDirection.value,shouldUseInfiniteScroll:u.settings.shouldUseInfiniteScroll,shouldShowTransitionPage:u.settings.shouldShowTransitionPage}));l.useEffect(()=>{const u=fe(c),h=ke(c);if(g||!i||!u||!p||!r||n||s===void 0)return()=>{};const f=()=>{const x=i.scrollLeft===0,b=i.scrollLeft===i.scrollWidth-i.clientWidth,C=i.scrollTop===0,m=i.scrollTop===i.scrollHeight-i.clientHeight;(e==="first"&&(h?C:x)||e==="last"&&(h?m:b))&&V.openChapter(s,void 0,!1)};return i.addEventListener("scroll",f),()=>i.removeEventListener("scroll",f)},[c,i,g,p,r,n,s]),Vn(o,l.useCallback(u=>{if(!p||!fe(c)||s===void 0||!g&&!n)return;const h=u[u.length-1],f=Ro(d,h.target.getBoundingClientRect(),Sr().xSize,Sr().ySize),{start:x,end:b}=Po(f,c),C=h.intersectionRatio<=Or;if(!Co(f,c))return;const m=e==="first"&&x&&!n,P=e==="last"&&!r&&b;if(m||e==="last"&&b&&C){V.openChapter(s,!n,!1);return}P&&V.openChapter(t,!1,!1)},[e,t,s,r,n,c,d,p,g]),l.useMemo(()=>({root:i,threshold:[Or],rootMargin:So(e,c,d),ignoreInitialObserve:!0}),[e,c,d]))},Eo=({chapterId:e,previousChapterId:t,nextChapterId:s,isPreviousChapterVisible:r,isCurrentChapter:n,isNextChapterVisible:o,imageWrapper:i,scrollElement:c})=>(jr("first",e,t,n,r,i,c),jr("last",e,s,n,o,i,c),null),To=l.memo(Eo),wo=({currentPageIndex:e,setPages:t,setPageLoadStates:s,setTotalPages:r,setCurrentPageIndex:n,updateCurrentPageIndex:o,setPageToScrollToIndex:i,transitionPageMode:c,retryFailedPagesKeyPrefix:d,setTransitionPageMode:p,readingMode:g,readerWidth:u,pageScaleMode:h,shouldOffsetDoubleSpreads:f,readingDirection:x,imagePreLoadAmount:b,pageGap:C,chapterId:m,previousChapterId:P,nextChapterId:A,isPreviousChapterVisible:E,isNextChapterVisible:I,lastPageRead:w,isInitialChapter:R,isCurrentChapter:v,isPreviousChapter:M,isNextChapter:j,isLeadingChapter:N,isTrailingChapter:k,isPreloadMode:L,imageRefs:U,scrollIntoView:Re,setReaderStateChapters:oe,resumeMode:ne,customFilter:K,shouldStretchPage:Q,readerNavBarWidth:W,onSizeChange:D,minWidth:Oe,minHeight:ie,scrollElement:Ce})=>{const{t:xe}=$(),{direction:We}=st(),[Ge,Pe]=wt.useGetChapterPagesFetch(m!=null?m:-1),[Ee,_e]=l.useState(!1),[me,$e]=l.useState(Ot.totalPages),[Je,nt]=l.useState(Ot.pageUrls),[je,Te]=l.useState(Ot.pages),[Y,ye]=l.useState(Ot.pageLoadStates),[He,B]=l.useState(Y.map(({url:O})=>({url:O,isSpread:!1}))),T=l.useRef(null),De=l.useRef(v),he=l.useRef(je.map(()=>null)),F=l.useRef(null),we=l.useMemo(()=>!!!me||!(me===He.length)?je:g===z.DOUBLE_PAGE?un(Je,He,f,x):je,[He,g,f,x,me]),lt=l.useMemo(()=>gn(g),[g]),dt=x===it.LTR,Ae=fe(g),Xe=!Ae&&!v||L,It=!Ae&&v,ut=!Xe&&(It||Ae&&(R||N)),gt=!Xe&&(It||Ae&&(R||k));De.current=v,v&&(U.current=he.current);const ht=l.useCallback(()=>{m&&(_e(!1),Ge({variables:{input:{chapterId:m}}}).catch(bt()))},[Ge,m]),Ut=l.useMemo(()=>hn(we,B,O=>{De.current&&s(O),ye(O)},g),[we,g]),Ft=l.useMemo(()=>pn(O=>{De.current&&s(O),ye(O)}),[]);l.useEffect(()=>{ht()},[m]),Fe(T,l.useCallback(O=>{const{clientWidth:Le,clientHeight:at}=O[0].target;D(Le,at,m)},[D,T.current,m]));const ce=(O,Le,at,Mt=!1)=>{(Mt||!Ee)&&Le(O),v&&at(O)};return vo(v,Pe,ne,w,we,Y,He,Ee,_e,O=>ce(O,Ve,oe),O=>ce(O,$e,r),O=>ce(O,Te,t),O=>ce(O,nt,Ve),O=>ce(O,ye,s),O=>ce(O,B,Ve),O=>ce(O,Ve,n),O=>{(R&&!Ee||Re)&&(i(O),oe(Le=>({...Le,visibleChapters:{...Le.visibleChapters,scrollIntoView:!1,resumeMode:void 0}})))},O=>ce(O,Ve,p)),xo(e,we,Je,O=>ce(O,Te,t,!0),O=>ce(O,B,Ve,!0),O=>ce(O,Ve,o),g),Ae||v||M||j?Pe.error?Xe?null:a.jsx(X,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center",position:"relative"},children:a.jsx(Nt,{message:xe("global.error.label.failed_to_load_data"),messageExtra:Zr(Pe.error),retry:()=>{ht()}})}):Pe.loading||!Ee?Xe?null:a.jsx(X,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center"},children:a.jsx(Ht,{})}):m!=null&&!me?Xe?null:a.jsx(X,{sx:{minWidth:"100%",minHeight:"100%",position:"relative"},children:a.jsx(Nt,{message:xe("reader.error.label.no_pages_found"),retry:ht})}):a.jsxs(_,{ref:T,sx:{width:"fit-content",height:"fit-content",margin:"auto",flexWrap:"nowrap",...S(g===z.CONTINUOUS_HORIZONTAL,{minHeight:ie}),...S(ke(g),{minWidth:Oe}),...S(Xe,{maxWidth:0,maxHeight:0,minWidth:"unset",minHeight:"unset",overflow:"hidden",margin:"unset"}),...S(ke(g)&&rs(u,h),{alignItems:"center"}),...S(g===z.CONTINUOUS_HORIZONTAL,{...S(We==="ltr",{flexDirection:dt?"row":"row-reverse"}),...S(We==="rtl",{flexDirection:dt?"row-reverse":"row"})})},children:[!L&&a.jsx(To,{chapterId:m,previousChapterId:P,nextChapterId:A,isCurrentChapter:v,isPreviousChapterVisible:E,isNextChapterVisible:I,imageWrapper:F.current,scrollElement:Ce}),ut&&a.jsx(Mr,{chapterId:m,type:de.PREVIOUS}),a.jsx(lt,{ref:F,totalPages:me,currentPageIndex:e,pages:we,transitionPageMode:c,pageLoadStates:Y,retryFailedPagesKeyPrefix:d,imageRefs:he,onLoad:Ut,onError:Ft,isCurrentChapter:v,isPreviousChapter:M,isNextChapter:j,readingMode:g,imagePreLoadAmount:b,readingDirection:x,pageScaleMode:h,pageGap:C,customFilter:K,shouldStretchPage:Q,readerWidth:u,readerNavBarWidth:W,isPreloadMode:L,resumeMode:ne,handleAsInitialRender:Re}),gt&&a.jsx(Mr,{chapterId:m,type:de.NEXT})]}):null},Ao=l.memo(wo),Io=(e,t,s,r)=>{const n=fn(t),o=xn(t),i=s!==window.innerWidth,c=r!==window.innerHeight,d=n&&i,p=o&&c;return!ke(e)&&i?!0:d||p},yr=(e,t,s)=>{l.useLayoutEffect(()=>{s(t)},[e])},Mo=(e,t,s,r)=>{const n=l.useRef({width:window.innerWidth,height:window.innerHeight}),o=l.useCallback(()=>{const{width:i,height:c}=n.current;n.current={width:window.innerWidth,height:window.innerHeight},Io(e,t,i,c)&&s(r)},[e,t,r]);zn("resize",o)},fs=e=>{const t=l.useRef({left:0,top:0,visibleElement:void 0,visibleElementLeft:0,visibleElementTop:0});return l.useEffect(()=>{const s=e.current;if(!s)return()=>{};const r=()=>{var o,i;const{visibleElement:n}=t.current;t.current={...t.current,left:s.scrollLeft,top:s.scrollTop,visibleElementLeft:(o=n==null?void 0:n.offsetLeft)!=null?o:0,visibleElementTop:(i=n==null?void 0:n.offsetTop)!=null?i:0}};return s.addEventListener("scroll",r),()=>s.removeEventListener("scroll",r)},[]),l.useEffect(()=>{const s=e.current;if(!s)return()=>{};const r=(i,c)=>Array.from(i).filter(d=>d instanceof HTMLElement).flatMap(d=>d instanceof HTMLImageElement?[d]:Array.from(d.querySelectorAll("img"))).forEach(c),n=new IntersectionObserver(i=>{const c=i.find(d=>d.isIntersecting);(c==null?void 0:c.target)instanceof HTMLElement&&(t.current={...t.current,visibleElement:c.target,visibleElementLeft:c.target.offsetLeft,visibleElementTop:c.target.offsetTop})}),o=new MutationObserver(i=>{for(const c of i)r(c.addedNodes,d=>n.observe(d)),r(c.removedNodes,d=>n.unobserve(d))});return o.observe(s,{childList:!0,subtree:!0}),()=>{o.disconnect(),n.disconnect()}},[]),t},Oo=(e,t)=>{const s=fs(e),r=fe(t),n=ke(t);l.useEffect(()=>{const o=e.current;if(!o||!r)return()=>{};const i=g=>{const{left:u,top:h,visibleElement:f,visibleElementLeft:x,visibleElementTop:b}=s.current;if(!f||!!!g.filter(E=>!(E.target instanceof HTMLElement)||!E.target.clientWidth&&!E.target.clientHeight?!1:n?E.target.offsetTop<h:Math.abs(E.target.offsetLeft)<Math.abs(u)).length)return;const P=u-x+f.offsetLeft,A=h-b+f.offsetTop;o.scrollTo(P,A)},c=(g,u)=>Array.from(g).filter(h=>h instanceof HTMLElement).flatMap(h=>h instanceof HTMLImageElement?[h]:Array.from(h.querySelectorAll("img"))).forEach(u),d=new ResizeObserver(i),p=new MutationObserver(g=>{for(const u of g)c(u.addedNodes,h=>d.observe(h)),c(u.removedNodes,h=>d.unobserve(h))});return p.observe(o,{childList:!0,subtree:!0}),()=>{p.disconnect(),d.disconnect()}},[r,n])},jo=(e,t,s,r,n,o,i)=>{const c=fs(e),d=()=>{const p=e.current,{left:g,top:u,visibleElementLeft:h,visibleElementTop:f,visibleElement:x}=c.current;if(!p||!i||!x)return!1;const b=ss(s,n,o),C=r===0;if(!(!b.previous&&C))return!1;const P=g-h+x.offsetLeft,A=u-f+x.offsetTop;return p.scrollTo(P,A),!0};l.useEffect(()=>{const p=e.current;if(!p||!i)return()=>{};let g=!1;const u=(x,b)=>{Array.from(x).filter(C=>C instanceof HTMLElement).flatMap(C=>C instanceof HTMLImageElement?[C]:Array.from(C.querySelectorAll("img"))).forEach(b)},h=new ResizeObserver(()=>{g||(g=d(),g&&h.disconnect())}),f=new MutationObserver(x=>{for(const b of x)u(b.addedNodes,C=>h.observe(C)),u(b.removedNodes,C=>h.unobserve(C))});return f.observe(p,{childList:!0,subtree:!0}),()=>{f.disconnect(),h.disconnect()}},[t]),l.useLayoutEffect(()=>{d()},[t])},yo=(e,t,s,r,n,o,i,c,d,p)=>{jo(e,t,s,r,n,o,fe(i)),Oo(e,i),Mo(i,p,d,r),yr(c,r,d),yr(i,r,d)},Do={[z.SINGLE_PAGE]:ft.X,[z.DOUBLE_PAGE]:ft.X,[z.CONTINUOUS_VERTICAL]:ft.Y,[z.CONTINUOUS_HORIZONTAL]:ft.X,[z.WEBTOON]:ft.Y},Lo=l.forwardRef(({readerNavBarWidth:e,updateCurrentPageIndex:t},s)=>{var B;const{direction:r}=st(),n=nr(T=>T.overlay.isVisible),{currentPageIndex:o,pageToScrollToIndex:i,setPageToScrollToIndex:c,pages:d,totalPages:p,setPages:g,setPageLoadStates:u,setTotalPages:h,setCurrentPageIndex:f,transitionPageMode:x,retryFailedPagesKeyPrefix:b,setTransitionPageMode:C}=qe(T=>({currentPageIndex:T.pages.currentPageIndex,pageToScrollToIndex:T.pages.pageToScrollToIndex,setPageToScrollToIndex:T.pages.setPageToScrollToIndex,pages:T.pages.pages,totalPages:T.pages.totalPages,setPages:T.pages.setPages,setPageLoadStates:T.pages.setPageLoadStates,setTotalPages:T.pages.setTotalPages,setCurrentPageIndex:T.pages.setCurrentPageIndex,transitionPageMode:T.pages.transitionPageMode,retryFailedPagesKeyPrefix:T.pages.retryFailedPagesKeyPrefix,setTransitionPageMode:T.pages.setTransitionPageMode})),{initialChapter:m,currentChapter:P,chapters:A,visibleChapters:E,setReaderStateChapters:I,isCurrentChapterReady:w}=Ue(T=>({initialChapter:T.chapters.initialChapter,currentChapter:T.chapters.currentChapter,chapters:T.chapters.chapters,visibleChapters:T.chapters.visibleChapters,setReaderStateChapters:T.chapters.setReaderStateChapters,isCurrentChapterReady:T.chapters.isCurrentChapterReady})),{readingMode:R,readingDirection:v,readerWidth:M,pageScaleMode:j,shouldOffsetDoubleSpreads:N,imagePreLoadAmount:k,pageGap:L,customFilter:U,shouldStretchPage:Re,isStaticNav:oe}=J(T=>({readingMode:T.settings.readingMode.value,readingDirection:T.settings.readingDirection.value,readerWidth:T.settings.readerWidth.value,pageScaleMode:T.settings.pageScaleMode.value,shouldOffsetDoubleSpreads:T.settings.shouldOffsetDoubleSpreads.value,imagePreLoadAmount:T.settings.imagePreLoadAmount,pageGap:T.settings.pageGap.value,customFilter:T.settings.customFilter,shouldStretchPage:T.settings.shouldStretchPage.value,isStaticNav:T.settings.isStaticNav})),{showPreview:ne,setShowPreview:K}=ar(T=>({showPreview:T.tapZone.showPreview,setShowPreview:T.tapZone.setShowPreview})),{resumeMode:Q=fr.START}=(B=qr().state)!=null?B:{resumeMode:fr.START},W=l.useRef(null),D=Un(s,W),Oe=ke(R),ie=fe(R),Ce=co(W),xe=zt(T=>({isPaused:T.autoScroll.isPaused,pause:T.autoScroll.pause,resume:T.autoScroll.resume,setScrollRef:T.autoScroll.setScrollRef}));l.useEffect(()=>xe.setScrollRef(W.current),[]);const We=xr.useGetScrollbarSize("width",W.current),Ge=xr.useGetScrollbarSize("height",W.current);l.useLayoutEffect(()=>{const{scrollbar:T}=or();T.setXSize(We),T.setYSize(Ge)},[We,Ge]);const Pe=l.useRef(d.map(()=>null)),[{minChapterViewWidth:Ee,minChapterViewHeight:_e,minChapterSizeSourceChapterId:me},$e]=l.useState({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),[,Je]=l.useState({}),nt=Do[R],je=v===it.LTR,Te=l.useMemo(()=>A.findIndex(T=>T.id===(m==null?void 0:m.id)),[A,m==null?void 0:m.id]),Y=l.useMemo(()=>A.slice(Math.max(0,Te-E.trailing),Math.min(A.length,Te+E.leading+1)),[A,Te,E.trailing,E.leading]),ye=l.useMemo(()=>Y.findIndex(T=>T.id===(P==null?void 0:P.id)),[P,Y]),He=l.useCallback((T,De,he)=>{if(!ie)return;const F=he===me;if(Oe){if(!F&&Ee>=T)return;$e({minChapterViewWidth:T,minChapterViewHeight:0,minChapterSizeSourceChapterId:he});return}(F||_e<De)&&$e({minChapterViewWidth:0,minChapterViewHeight:De,minChapterSizeSourceChapterId:he})},[ie,Oe,Ee,_e,me]);if(fo(i,o,d,p,c,t,ie,Pe,r,v),po(o,ie,r,v,W),ho(W),go(R,v,W),uo(n,ne,K,W),lo(n,xe.isPaused,xe.pause,xe.resume,oe),yo(W,P==null?void 0:P.id,ye,o,Y,E,R,v,c,j),l.useLayoutEffect(()=>{$e({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),Je({})},[R]),!m||!P)throw new Error("ReaderViewer: illegal state - initialChapter and currentChapter should not be undefined");return a.jsx(_,{ref:D,sx:{width:"100%",height:"100%",overflow:"auto",flexWrap:"nowrap",...S(Oe&&rs(M,j),{alignItems:"center"}),...S(!Oe,{...S(r==="ltr",{flexDirection:je?"row":"row-reverse"}),...S(r==="rtl",{flexDirection:je?"row-reverse":"row"})})},onClick:T=>!Ce&&V.handleClick(W.current,T),onScroll:()=>V.updateCurrentPageOnScroll(Pe,p-1,t,nt,v),children:Y.map((T,De)=>{var O,Le,at,Mt;const he=Math.max(0,Y.length-De-1),F=Y[he],we=(O=Y[he+1])!=null?O:A[Te+E.leading+1],lt=(Le=Y[he-1])!=null?Le:A[Te-E.trailing-1],dt=F.id===m.id,Ae=F.id===P.id,Xe=F.id===((at=Y[ye+1])==null?void 0:at.id),It=F.id===((Mt=Y[ye-1])==null?void 0:Mt.id),ut=m.sourceOrder>F.sourceOrder,gt=m.sourceOrder<F.sourceOrder,ht=E.lastLeadingChapterSourceOrder===F.sourceOrder,Ut=E.lastTrailingChapterSourceOrder===F.sourceOrder,Ft=ht&&E.isLeadingChapterPreloadMode||Ut&&E.isTrailingChapterPreloadMode,ce=ss(he,Y,E),Wt=F.id===me;return a.jsx(Ao,{chapterId:F.id,previousChapterId:we==null?void 0:we.id,nextChapterId:lt==null?void 0:lt.id,isPreviousChapterVisible:ce.previous,isNextChapterVisible:ce.next,lastPageRead:ot(F.lastPageRead,0,F.pageCount-1),currentPageIndex:vn(o,F,P,Ae,w,ut,gt,E),isInitialChapter:dt,isCurrentChapter:Ae,isPreviousChapter:Xe,isNextChapter:It,isLeadingChapter:ut,isTrailingChapter:gt,isPreloadMode:Ft,imageRefs:Pe,setPages:g,setPageLoadStates:u,setTotalPages:h,setCurrentPageIndex:f,setPageToScrollToIndex:c,transitionPageMode:x,retryFailedPagesKeyPrefix:b,readingMode:R,readerWidth:M,pageScaleMode:j,shouldOffsetDoubleSpreads:N,readingDirection:v,updateCurrentPageIndex:Ae?t:Ve,scrollIntoView:Ae&&E.scrollIntoView,resumeMode:mn(Ae,dt,ut,gt,E.resumeMode,Q),setReaderStateChapters:I,setTransitionPageMode:C,pageGap:L,imagePreLoadAmount:k,customFilter:U,shouldStretchPage:Re,readerNavBarWidth:e,onSizeChange:He,minWidth:Wt?0:Ee,minHeight:Wt?0:_e,scrollElement:W.current},F.id)})})}),Bo=ge(l.memo(Lo),[()=>({updateCurrentPageIndex:V.useUpdateCurrentPageIndex()}),Ke],["readerNavBarWidth","updateCurrentPageIndex"]),No=Object.fromEntries(Object.values(Tt).map(e=>[e,{scopes:e}])),se=(...e)=>{const[t,s,r,n]=e;return Fs(t,s,{...r,...No.reader},n)},Yt=(e,t,s,r,n)=>{if(r){y.updateSetting(e,s[0]);return}const o=us(s.indexOf(t),s,n);if(o===void 0){y.deleteSetting(e);return}y.updateSetting(e,o)},ko=({scrollElementRef:e})=>{const t=y.useGetThemeDirection(),{enableScope:s,disableScope:r}=kr(),{hotkeys:n}=J(i=>({hotkeys:i.settings.hotkeys})),o=y.useExit();return se(n[ee.PREVIOUS_PAGE],()=>V.openPage("previous")),se(n[ee.NEXT_PAGE],()=>V.openPage("next")),se(n[ee.SCROLL_BACKWARD],()=>{const i=yt(),{readingMode:c,readingDirection:d,scrollAmount:p}=Z();if(i.isActive){i.setDirection(ue.BACKWARD);return}e.current&&V.scroll(ue.BACKWARD,Qt[c.value],c.value,d.value,e.current,Et().setShowPreview,p)},{preventDefault:!0}),se(n[ee.SCROLL_FORWARD],()=>{const i=yt(),{readingMode:c,readingDirection:d,scrollAmount:p}=Z();if(i.isActive){i.setDirection(ue.FORWARD);return}e.current&&V.scroll(ue.FORWARD,Qt[c.value],c.value,d.value,e.current,Et().setShowPreview,p)},{preventDefault:!0}),se(n[ee.PREVIOUS_CHAPTER],()=>V.openChapter(q("previous","next",t)),[t]),se(n[ee.NEXT_CHAPTER],()=>V.openChapter(q("next","previous",t)),[t]),se(n[ee.TOGGLE_MENU],()=>Qe().setIsVisible(!Qe().isVisible)),se(n[ee.CYCLE_SCALE_TYPE],()=>{Yt("pageScaleMode",Z().pageScaleMode.value,Wr,Z().pageScaleMode.isDefault,!0)},[]),se(n[ee.STRETCH_IMAGE],()=>y.updateSetting("shouldStretchPage",!Z().shouldStretchPage.value)),se(n[ee.OFFSET_SPREAD_PAGES],()=>y.updateSetting("shouldOffsetDoubleSpreads",!Z().shouldOffsetDoubleSpreads.value)),se(n[ee.CYCLE_READING_MODE],()=>{Yt("readingMode",Z().readingMode.value,Gr,Z().readingMode.isDefault,!0)}),se(n[ee.CYCLE_READING_DIRECTION],()=>{Yt("readingDirection",Z().readingDirection.value,$r,Z().readingDirection.isDefault,!0)}),se(n[ee.TOGGLE_AUTO_SCROLL],()=>yt().toggleActive(),{preventDefault:!0}),se(n[ee.AUTO_SCROLL_SPEED_DECREASE],()=>y.updateSetting("autoScroll",{...Z().autoScroll,value:Math.min(ze.max,Z().autoScroll.value+ze.step)})),se(n[ee.AUTO_SCROLL_SPEED_INCREASE],()=>y.updateSetting("autoScroll",{...Z().autoScroll,value:Math.max(ze.min,Z().autoScroll.value-ze.step)})),se(n[ee.EXIT_READER],o,[o]),l.useEffect(()=>(s(Tt.READER),()=>r(Tt.READER)),[]),null},_o=()=>{l.useEffect(()=>()=>{or().reset()},[])},Ho=(e,t,s,r,n,o)=>{var i;l.useEffect(()=>{var x;const c=(x=e.data)==null?void 0:x.manga;if(!c||t.loading||t.error)return;const d=br(c,s),p=Sn(c,d.shouldUseAutoWebtoonMode,d.readingMode),g={...s,readingMode:p?z.WEBTOON:s.readingMode},u=p?z.WEBTOON:d.readingMode.value,h=bn("global",{meta:r},g,void 0,u),f=br(c,h);n(f),o(!0)},[(i=e.data)==null?void 0:i.manga,s])},Dr=5e3,Vo=(e,t,s,r,n,o,i,c,d)=>{const{t:p}=$(),g=l.useRef(void 0),u=l.useRef(void 0),h=l.useRef(void 0),f=l.useRef(!0);l.useEffect(()=>{if(e||t||!s)return;const x=JSON.stringify(r)!==JSON.stringify(g.current);i&&x&&Yr(p(Jt[r.value].title),{autoHideDuration:Dr}),g.current=r;const C=JSON.stringify(n)!==JSON.stringify(u.current)||JSON.stringify(o)!==JSON.stringify(h.current);c&&C&&(d(!0),f.current&&setTimeout(()=>d(!1),Dr)),u.current=n,h.current=o,f.current=!1},[e,t,s,r.value,r.isDefault,n.value,n.isDefault,o.value,o.isDefault])},zo=(e,t,s,r,n,o,i,c)=>{var h;const d=Ws(),p=qr().state,{updateInitialChapter:g}=p!=null?p:{},u=g?void 0:r;l.useEffect(()=>{var I,w;const f=(I=e.data)==null?void 0:I.chapters.nodes,x=f?(w=f[f.length-t])!=null?w:null:void 0,b=u!=null?u:x,C=n!=null?n:x,m=(()=>{if(!f||!C)return[];const R=i?In(s!=null?s:f,c):f;return(o?Be.removeDuplicates(C,R):R).map(M=>Jr(M.id))})(),P=x&&Be.getNextChapter(x,m,{offset:Ye.NEXT}),A=x&&Be.getNextChapter(x,m,{offset:Ye.PREVIOUS}),E=b!=null&&b.id!==(u==null?void 0:u.id);E&&d("",{replace:!0,state:{...p,updateInitialChapter:void 0}}),St().setReaderStateChapters(R=>{var M,j,N,k;const v=(x==null?void 0:x.id)!==((M=R.currentChapter)==null?void 0:M.id);return{...R,mangaChapters:(j=R.mangaChapters)!=null?j:f,chapters:m,initialChapter:b,chapterForDuplicatesHandling:C,currentChapter:x,nextChapter:P,previousChapter:A,isCurrentChapterReady:v?!1:R.isCurrentChapterReady,visibleChapters:E?{...$t.chapters.visibleChapters,lastLeadingChapterSourceOrder:(N=b==null?void 0:b.sourceOrder)!=null?N:$t.chapters.visibleChapters.lastLeadingChapterSourceOrder,lastTrailingChapterSourceOrder:(k=b==null?void 0:b.sourceOrder)!=null?k:$t.chapters.visibleChapters.lastTrailingChapterSourceOrder,isLeadingChapterPreloadMode:!1,isTrailingChapterPreloadMode:!1,scrollIntoView:!!R.initialChapter}:R.visibleChapters}})},[(h=e.data)==null?void 0:h.chapters.nodes,t,o,i,u,c])},Uo=1,Lr=(e,t,s=!1,r=!1)=>{const n=Math.max(e*t,Uo),o=s?-n:n;return r?o*-1:o},Br=(e,t,s)=>e*(t/100)/s;function Nr(e,t,s,r,n){if(n(),!e){s(setInterval(()=>{r(t)},t),"interval");return}let o;const i=c=>{const d=c-(o!=null?o:c);o=c,r(d),s(requestAnimationFrame(i),"animationFrame")};s(requestAnimationFrame(i),"animationFrame")}const Fo=(e,t,s=Ie.Y,r=100,n=!1,o=!1)=>{const i=typeof e=="function",c=l.useRef(void 0),d=l.useRef(void 0),p=l.useRef(-1),[g,u]=l.useState(!1),[h,f]=l.useState(!1),[x,b]=l.useState({width:window.innerWidth,height:window.innerHeight});Fe(document.documentElement,l.useCallback(()=>{const w=window.innerWidth,R=window.innerHeight;(x.width!==w||x.height!==R)&&b({width:w,height:R})},[]));const C=l.useCallback(()=>{clearTimeout(d.current),cancelAnimationFrame(p.current)},[]),m=l.useCallback(()=>{u(!0)},[]),P=l.useCallback(()=>{u(!1),f(!1),C()},[]),A=l.useCallback(()=>{if(g){P();return}m()},[g]),E=l.useCallback(()=>{f(!0)},[]),I=l.useCallback(()=>{f(!1)},[]);return l.useEffect(()=>{if(!e||!g)return()=>{};if(h)return C(),()=>{};const w=t*1e3;if(i)return Nr(!1,w,L=>{d.current=L},e,C),()=>C();const R=e.current;if(!R)return()=>{};c.current||(c.current=getComputedStyle(R));const v=c.current.direction==="rtl",M=s!==Ie.Y,j=s!==Ie.X,N=Br(window.innerWidth,r,w),k=Br(window.innerHeight,r,w);return Nr(o,w,(L,U)=>{switch(U){case"interval":d.current=L;break;case"animationFrame":p.current=L;break;default:throw new Error('Unexpected "type" ('.concat(U,")"))}},L=>{R.scrollBy({top:Number(j)*Lr(k,L,!1,n),left:Number(M)*Lr(N,L,v,n),behavior:o?void 0:"smooth"})},C),()=>C()},[e,t,r,x,g,h,n,o]),l.useMemo(()=>({isActive:g,isPaused:h,start:m,cancel:P,toggleActive:A,pause:E,resume:I}),[g,h,m,P,A,E,I])},Wo=({themeDirection:e,combinedDirection:t})=>{const{scrollRef:s,direction:r}=zt(u=>({scrollRef:u.autoScroll.scrollRef,direction:u.autoScroll.direction})),{readingMode:n,autoScroll:o}=J(u=>({readingMode:u.settings.readingMode.value,autoScroll:u.settings.autoScroll})),c=n===z.CONTINUOUS_HORIZONTAL&&e!==t?q(r===ue.BACKWARD,r===ue.FORWARD,t):r===ue.BACKWARD,d=fe(n),p=l.useCallback(()=>{V.openPage("next","ltr")},[]),g=Fo(d?s:p,o.value,Qt[n],Hr.MEDIUM,c,o.smooth);return l.useEffect(()=>{const u=yt();u.setIsActive(g.isActive),u.setIsPaused(g.isPaused),u.setStart(g.start),u.setCancel(g.cancel),u.setToggleActive(g.toggleActive),u.setPause(g.pause),u.setResume(g.resume)},[g]),null},Go=ge(l.memo(Wo),[()=>({themeDirection:st().direction}),()=>({combinedDirection:y.useGetThemeDirection()})],["themeDirection","combinedDirection"]),$o=({setOverride:e,readerNavBarWidth:t})=>{var K,Q,W;const{t:s}=$(),r=At(D=>D.manga),n=nr(D=>D.overlay),{mangaChapters:o,initialChapter:i,chapterForDuplicatesHandling:c,currentChapter:d}=Ue(D=>({mangaChapters:D.chapters.mangaChapters,initialChapter:D.chapters.initialChapter,chapterForDuplicatesHandling:D.chapters.chapterForDuplicatesHandling,currentChapter:D.chapters.currentChapter})),{shouldSkipDupChapters:p,shouldSkipFilteredChapters:g,backgroundColor:u,readingMode:h,tapZoneLayout:f,tapZoneInvertMode:x,shouldShowReadingModePreview:b,shouldShowTapZoneLayoutPreview:C,setSettings:m}=J(D=>({shouldSkipDupChapters:D.settings.shouldSkipDupChapters,shouldSkipFilteredChapters:D.settings.shouldSkipFilteredChapters,backgroundColor:D.settings.backgroundColor,readingMode:D.settings.readingMode,tapZoneLayout:D.settings.tapZoneLayout,tapZoneInvertMode:D.settings.tapZoneInvertMode,shouldShowReadingModePreview:D.settings.shouldShowReadingModePreview,shouldShowTapZoneLayoutPreview:D.settings.shouldShowTapZoneLayoutPreview,setSettings:D.settings.setSettings})),P=ar(D=>D.tapZone.setShowPreview),A=l.useRef(null),[E,I]=l.useState(!1),{chapterSourceOrder:w,mangaId:R}=Gs(),v=Number(w),M=Number(R),j=wt.useGetManga($s,M),N=wt.useGetMangaChapters(Xs,M);Fn(!r||!d?s("reader.title",{mangaId:M,chapterIndex:v}):"".concat(r.title,": ").concat(d.name));const{metadata:k,settings:L,request:U}=Rn(),Re=Mn(r!=null?r:ir),oe=d===void 0||!E||j.loading||N.loading||U.loading,ne=(Q=(K=j.error)!=null?K:N.error)!=null?Q:U.error;return l.useEffect(()=>{var D;or().setManga((D=j.data)==null?void 0:D.manga)},[(W=j.data)==null?void 0:W.manga]),_o(),Ho(j,U,L,k,m,I),Vo(oe,ne,E,h,f,x,b,C,P),zo(N,v,o,i,c,p,g,Re),l.useLayoutEffect(()=>(e({status:!0,value:a.jsxs(X,{sx:{position:"absolute"},children:[a.jsx(ko,{scrollElementRef:A}),a.jsx(so,{isVisible:n.isVisible}),!A.current&&a.jsx(X,{onClick:()=>n.setIsVisible(!n.isVisible),sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"transparent"}})]})}),()=>e({status:!1,value:null})),[n.isVisible,A.current]),ne?a.jsx(Nt,{message:s("global.error.label.failed_to_load_data"),messageExtra:Zr(ne),retry:()=>{j.error&&j.refetch().catch(bt()),U.error&&U.refetch().catch(bt()),N.error&&N.refetch().catch(bt())}}):oe?a.jsx(X,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:a.jsx(Ht,{})}):d===null?a.jsx(Nt,{message:s("reader.error.label.chapter_not_found")}):!r||!d?null:a.jsxs(X,{sx:{position:"relative",display:"flex",flexDirection:"column",width:"calc(100vw - ".concat(t,"px)"),height:"100vh",marginLeft:"".concat(t,"px"),transition:D=>"width 0.".concat(D.transitions.duration.shortest,"s, margin-left 0.").concat(D.transitions.duration.shortest,"s"),overflow:"auto",backgroundColor:Kr[u]},children:[a.jsx(Bo,{ref:A}),a.jsx(ao,{}),a.jsx(io,{}),a.jsx(Go,{})]})},Li=ge(l.memo($o),[Ke],["setOverride","readerNavBarWidth"]);export{Li as Reader};
