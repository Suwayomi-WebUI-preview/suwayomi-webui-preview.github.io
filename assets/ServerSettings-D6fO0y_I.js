import{u as I,ay as Y,j as r,r as E,a as $,b as W,H as d,o as n,p as i,y as X,e as Q,g as w,f as M,bC as C,bD as Z,bE as m,bF as U,b0 as v,bG as P,bH as D,bI as F,bJ as x,bK as T,m as R,aA as z,bL as O}from"./index-DNzWMDIq.js";import{T as l}from"./TextSetting-DF9aedhu.js";import{N as c}from"./NumberSetting-tqPdI90a.js";import{S as p}from"./SelectSetting-C3igilQn.js";import{E as ee}from"./EmptyViewAbsoluteCentered-CpTPQwzc.js";import{u as se}from"./useAppTitle-C0CxbCoH.js";import{S as o}from"./Switch-CJVhClLx.js";import{L as g}from"./ListSubheader-D5OE2zUh.js";import{T as re}from"./Trans-DoS4AKYZ.js";import{L as te}from"./Link-DjMK5Xop.js";import"./Slider-lSeQ03vP.js";import"./Select-CwEzC7pv.js";import"./SwitchBase-DxMBGP13.js";const ae=()=>{const{t:s}=I(),[b,y]=Y("serverBaseURL",window.location.origin),h=S=>{const j=S.replaceAll(/(\/)+$/g,"");y(j),E.reset()};return r.jsx(l,{settingName:s("settings.about.server.label.address"),handleChange:h,value:b,placeholder:"http://localhost:4567"})},le=s=>s===0?z("global.label.never"):z("settings.server.misc.log_files.file_cleanup.value",{days:s,count:s}),Se=()=>{var L,A;const{t:s}=I();se(s("settings.server.title.server"));const{settings:{serverInformAvailableUpdate:b},loading:y,request:{error:h,refetch:S}}=$(),j=X(e=>R(s("global.error.label.failed_to_save_changes"),"error",w(e))),{data:B,loading:H,error:N,refetch:K}=E.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[q]=E.useUpdateServerSettings(),a=async(e,k,u)=>{try{await q({variables:{input:{settings:{[e]:k}}}}),u==null||u(!0)}catch(J){R(s("global.error.label.failed_to_save_changes"),"error",w(J)),u==null||u(!1)}},_=W.useMemo(()=>r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-client",children:s("global.label.client")}),children:[r.jsx(ae,{}),r.jsxs(n,{children:[r.jsx(i,{primary:s("global.update.settings.inform.label.title"),secondary:s("global.update.settings.inform.label.description")}),r.jsx(o,{edge:"end",checked:b,onChange:e=>j("serverInformAvailableUpdate",e.target.checked)})]})]}),[b]);if(y||H)return r.jsxs(r.Fragment,{children:[_,r.jsx(Q,{})]});const V=h!=null?h:N;if(V)return r.jsxs(r.Fragment,{children:[_,r.jsx(ee,{message:s("global.error.label.failed_to_load_data"),messageExtra:w(V),retry:()=>{h&&S().catch(M()),N&&K().catch(M())}})]});const t=B.settings,G=!((L=t.authUsername)!=null&&L.trim())||!((A=t.authPassword)!=null&&A.trim()),f=t.databaseType===C.H2;return r.jsxs(d,{sx:{pt:0},children:[_,r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-server-address",children:s("settings.server.address.server.title")}),children:[r.jsx(l,{settingName:s("settings.server.address.server.label.ip"),handleChange:e=>a("ip",e),value:t.ip,placeholder:"0.0.0.0"}),r.jsx(c,{settingTitle:s("settings.server.address.server.label.port"),settingValue:t.port.toString(),handleUpdate:e=>a("port",e),value:t.port,defaultValue:4567,valueUnit:s("settings.server.address.server.label.port")})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-socks-proxy",children:s("settings.server.socks_proxy.title")}),children:[r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.socks_proxy.label.enable")}),r.jsx(o,{edge:"end",checked:t.socksProxyEnabled,onChange:e=>a("socksProxyEnabled",e.target.checked)})]}),r.jsx(p,{settingName:s("settings.server.socks_proxy.label.version"),value:t.socksProxyVersion,values:[[4,{text:"4"}],[5,{text:"5"}]],handleChange:e=>a("socksProxyVersion",e)}),r.jsx(l,{settingName:s("settings.server.socks_proxy.label.host"),value:t.socksProxyHost,handleChange:e=>a("socksProxyHost",e)}),r.jsx(l,{settingName:s("settings.server.socks_proxy.label.port"),value:t.socksProxyPort,handleChange:e=>a("socksProxyPort",e)}),r.jsx(l,{settingName:s("settings.server.socks_proxy.label.username"),value:t.socksProxyUsername,handleChange:e=>a("socksProxyUsername",e)}),r.jsx(l,{settingName:s("settings.server.socks_proxy.label.password"),value:t.socksProxyPassword,handleChange:e=>a("socksProxyPassword",e),isPassword:!0})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-auth",children:s("settings.server.auth.title")}),children:[r.jsx(p,{settingName:s("settings.server.auth.label.title"),value:t.authMode,values:Z,handleChange:e=>{a("authMode",e,k=>{k&&(e!==m.UiLogin&&O.removeTokens(),O.setAuthRequired(e===m.UiLogin))})},disabled:G}),r.jsx(l,{settingName:s("settings.server.auth.label.username"),value:t.authUsername,validate:e=>t.authMode===m.None||!!e.trim(),handleChange:e=>a("authUsername",e)}),r.jsx(l,{settingName:s("settings.server.auth.label.password"),value:t.authPassword,isPassword:!0,validate:e=>t.authMode===m.None||!!e.trim(),handleChange:e=>a("authPassword",e)}),t.authMode===m.UiLogin&&r.jsxs(r.Fragment,{children:[r.jsx(l,{settingName:s("settings.server.auth.jwt.audience"),value:t.jwtAudience,handleChange:e=>a("jwtAudience",e)}),r.jsx(c,{settingTitle:s("settings.server.auth.jwt.access_token_expiry"),settingValue:v.duration(t.jwtTokenExpiry).humanize(),value:v.duration(t.jwtTokenExpiry).asMinutes(),valueUnit:s("global.time.minutes.minute_other"),defaultValue:U.default,minValue:U.min,maxValue:U.max,handleUpdate:e=>a("jwtTokenExpiry",v.duration(e,"minute").toISOString()),showSlider:!0}),r.jsx(c,{settingTitle:s("settings.server.auth.jwt.refresh_token_expiry"),settingValue:v.duration(t.jwtRefreshExpiry).humanize(),value:v.duration(t.jwtRefreshExpiry).asDays(),valueUnit:s("global.time.days.day_other"),defaultValue:P.default,minValue:P.min,maxValue:P.max,handleUpdate:e=>a("jwtRefreshExpiry",v.duration(e,"day").toISOString()),showSlider:!0})]})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-clouadflare-bypass",children:s("settings.server.cloudflare.title")}),children:[r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.cloudflare.flaresolverr.enabled.label.title"),secondary:r.jsxs(re,{i18nKey:"settings.server.cloudflare.flaresolverr.enabled.label.description",children:["See"," ",r.jsx(te,{href:"https://github.com/FlareSolverr/FlareSolverr?tab=readme-ov-file#installation",target:"_blank",rel:"noreferrer",children:"FlareSolverr"})," ","for information on how to set it up"]})}),r.jsx(o,{edge:"end",checked:t.flareSolverrEnabled,onChange:e=>a("flareSolverrEnabled",e.target.checked)})]}),r.jsx(l,{settingName:s("settings.server.cloudflare.flaresolverr.url.label.title"),dialogDescription:s("settings.server.cloudflare.flaresolverr.url.label.description"),value:t.flareSolverrUrl,handleChange:e=>a("flareSolverrUrl",e)}),r.jsx(c,{settingTitle:s("settings.server.cloudflare.flaresolverr.timeout.label.title"),settingValue:s("global.time.seconds.value",{count:t.flareSolverrTimeout}),dialogDescription:s("settings.server.cloudflare.flaresolverr.timeout.label.description"),value:t.flareSolverrTimeout,defaultValue:60,minValue:20,maxValue:60*5,stepSize:1,showSlider:!0,valueUnit:s("global.time.seconds.second_other"),handleUpdate:e=>a("flareSolverrTimeout",e)}),r.jsx(l,{settingName:s("settings.server.cloudflare.flaresolverr.session.name.label.title"),value:t.flareSolverrSessionName,handleChange:e=>a("flareSolverrSessionName",e)}),r.jsx(c,{settingTitle:s("settings.server.cloudflare.flaresolverr.session.ttl.label.title"),settingValue:s("global.time.minutes.value",{count:t.flareSolverrSessionTtl}),dialogDescription:s("settings.server.cloudflare.flaresolverr.session.ttl.label.description"),value:t.flareSolverrSessionTtl,defaultValue:15,minValue:1,maxValue:60,stepSize:1,showSlider:!0,valueUnit:s("global.time.minutes.minute_other"),handleUpdate:e=>a("flareSolverrSessionTtl",e)}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.cloudflare.flaresolverr.response_fallback.label.title"),secondary:s("settings.server.cloudflare.flaresolverr.response_fallback.label.description")}),r.jsx(o,{edge:"end",checked:t.flareSolverrAsResponseFallback,onChange:e=>a("flareSolverrAsResponseFallback",e.target.checked)})]})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-opds",children:s("settings.server.opds.title")}),children:[r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.opds.binary_file_sizes.label.title"),secondary:s("settings.server.opds.binary_file_sizes.label.description")}),r.jsx(o,{edge:"end",checked:t.opdsUseBinaryFileSizes,onChange:e=>a("opdsUseBinaryFileSizes",e.target.checked)})]}),r.jsx(c,{settingTitle:s("settings.server.opds.items_per_page.label.title"),settingValue:t.opdsItemsPerPage.toString(),dialogDescription:s("settings.server.opds.items_per_page.label.description"),value:t.opdsItemsPerPage,defaultValue:50,minValue:10,maxValue:5e3,stepSize:10,showSlider:!0,valueUnit:s("settings.server.opds.items_per_page.label.unit_other"),handleUpdate:e=>a("opdsItemsPerPage",e)}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.opds.enable_page_read_progress.label.title"),secondary:s("settings.server.opds.enable_page_read_progress.label.description")}),r.jsx(o,{edge:"end",checked:t.opdsEnablePageReadProgress,onChange:e=>a("opdsEnablePageReadProgress",e.target.checked)})]}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.opds.mark_as_read_on_download.label.title"),secondary:s("settings.server.opds.mark_as_read_on_download.label.description")}),r.jsx(o,{edge:"end",checked:t.opdsMarkAsReadOnDownload,onChange:e=>a("opdsMarkAsReadOnDownload",e.target.checked)})]}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.opds.show_only_unread_chapters.label.title"),secondary:s("settings.server.opds.show_only_unread_chapters.label.description")}),r.jsx(o,{edge:"end",checked:t.opdsShowOnlyUnreadChapters,onChange:e=>a("opdsShowOnlyUnreadChapters",e.target.checked)})]}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.opds.show_only_downloaded_chapters.label.title"),secondary:s("settings.server.opds.show_only_downloaded_chapters.label.description")}),r.jsx(o,{edge:"end",checked:t.opdsShowOnlyDownloadedChapters,onChange:e=>a("opdsShowOnlyDownloadedChapters",e.target.checked)})]}),r.jsx(p,{settingName:s("settings.server.opds.chapter_sort_order.label.title"),dialogDescription:s("settings.server.opds.chapter_sort_order.label.description"),value:t.opdsChapterSortOrder,values:[[D.Asc,{text:s("global.sort.label.asc")}],[D.Desc,{text:s("global.sort.label.desc")}]],handleChange:e=>a("opdsChapterSortOrder",e)})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-koreader-sync",children:s("settings.server.koreader.sync.title")}),children:[r.jsx(l,{settingName:s("settings.server.koreader.sync.server_address"),handleChange:e=>a("koreaderSyncServerUrl",e),value:t.koreaderSyncServerUrl,placeholder:"http://localhost:17200"}),r.jsx(l,{settingName:s("settings.server.koreader.sync.username"),value:t.koreaderSyncUsername,handleChange:e=>a("koreaderSyncUsername",e)}),r.jsx(l,{settingName:s("settings.server.koreader.sync.user_key"),value:t.koreaderSyncUserkey,handleChange:e=>a("koreaderSyncUserkey",e),isPassword:!0}),r.jsx(l,{settingName:s("settings.server.koreader.sync.device_id"),value:t.koreaderSyncDeviceId,handleChange:e=>a("koreaderSyncDeviceId",e)}),r.jsx(p,{settingName:s("settings.server.koreader.sync.check_sum_method.title"),value:t.koreaderSyncChecksumMethod,values:[[F.Binary,{text:s("settings.server.koreader.sync.check_sum_method.binary")}],[F.Filename,{text:s("settings.server.koreader.sync.check_sum_method.filename")}]],handleChange:e=>a("koreaderSyncChecksumMethod",e)}),r.jsx(p,{settingName:s("settings.server.koreader.sync.strategy.title"),value:t.koreaderSyncStrategy,values:[[x.Disabled,{text:s("settings.server.koreader.sync.strategy.disabled")}],[x.Prompt,{text:s("settings.server.koreader.sync.strategy.prompt")}],[x.Silent,{text:s("settings.server.koreader.sync.strategy.silent")}],[x.Send,{text:s("settings.server.koreader.sync.strategy.send")}],[x.Receive,{text:s("settings.server.koreader.sync.strategy.receive")}]],handleChange:e=>a("koreaderSyncStrategy",e)}),r.jsx(c,{settingTitle:s("settings.server.koreader.sync.tolerance.title"),dialogDescription:s("settings.server.koreader.sync.tolerance.description"),settingValue:t.koreaderSyncPercentageTolerance.toString(),value:t.koreaderSyncPercentageTolerance,defaultValue:T.default,minValue:T.min,maxValue:T.max,valueUnit:"",handleUpdate:e=>a("koreaderSyncPercentageTolerance",e)})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-database",children:s("settings.server.database.title")}),children:[r.jsx(p,{settingName:s("settings.server.database.type.title"),value:t.databaseType,values:[[C.H2,{text:s("settings.server.database.type.h2")}],[C.Postgresql,{text:s("settings.server.database.type.postgresql")}]],handleChange:e=>a("databaseType",e)}),r.jsx(l,{settingName:s("settings.server.database.address"),handleChange:e=>a("databaseUrl",e),value:t.databaseUrl,placeholder:"postgresql://localhost:5432/suwayomi",disabled:f}),r.jsx(l,{settingName:s("settings.server.database.username"),value:t.databaseUsername,handleChange:e=>a("databaseUsername",e),disabled:f}),r.jsx(l,{settingName:s("settings.server.database.password"),value:t.databasePassword,handleChange:e=>a("databasePassword",e),disabled:f,isPassword:!0})]}),r.jsxs(d,{subheader:r.jsx(g,{component:"div",id:"server-settings-misc",children:s("settings.server.misc.title")}),children:[r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.misc.log_level.label.server")}),r.jsx(o,{edge:"end",checked:t.debugLogsEnabled,onChange:e=>a("debugLogsEnabled",e.target.checked)})]}),r.jsxs(n,{children:[r.jsx(i,{primary:s("settings.server.misc.tray_icon.label.title"),secondary:s("settings.server.misc.tray_icon.label.description")}),r.jsx(o,{edge:"end",checked:t.systemTrayEnabled,onChange:e=>a("systemTrayEnabled",e.target.checked)})]}),r.jsx(c,{settingTitle:s("settings.server.misc.log_files.file_cleanup.title"),settingValue:le(t.maxLogFiles),value:t.maxLogFiles,valueUnit:s("global.date.label.day_one"),handleUpdate:e=>a("maxLogFiles",e)}),r.jsx(l,{settingName:s("settings.server.misc.log_files.file_size.title"),value:t.maxLogFileSize,dialogDescription:s("settings.server.misc.log_files.file_size.description"),validate:e=>!!e.match(/^[0-9]+(|kb|KB|mb|MB|gb|GB)$/g),handleChange:e=>a("maxLogFileSize",e)}),r.jsx(l,{settingName:s("settings.server.misc.log_files.total_size.title"),value:t.maxLogFolderSize,dialogDescription:s("settings.server.misc.log_files.total_size.description"),validate:e=>!!e.match(/^[0-9]+(|kb|KB|mb|MB|gb|GB)$/g),handleChange:e=>a("maxLogFolderSize",e)})]})]})};export{Se as ServerSettings};
