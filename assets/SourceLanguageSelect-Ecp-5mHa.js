import{u as O,b as r,t as l,h as C,j as e,C as _,I as w,i as D,k as U,n as q,o as L,p as k,w as A,r as K,q as W,B as y,m as H,g as P}from"./index-CVkligGD.js";import{F as V}from"./FilterList-BixfVVf4.js";import{K as R}from"./index-BGtr8Kgs.js";import{t as z}from"./Extensions.utils-BRfnCMDb.js";import{S as G,g as J,a as N}from"./Sources-DhdlFwoM.js";import{L as Q}from"./ListCardAvatar-B7AlrycU.js";import{S as I}from"./Switch-CnoPbTRf.js";import{L as X}from"./ListItemAvatar-D2pPRoV1.js";const ne=({selectedLanguages:p,setSelectedLanguages:E,languages:u,sources:c})=>{const{t:n}=O(),[d,m]=r.useState({}),[o,g]=r.useState(l(p)),[T,h]=r.useState(!1),B=r.useMemo(()=>G.groupByLanguage(c),[c]),x=r.useMemo(()=>l([...o.toSorted(C),...u.toSorted(C)]),[u,o]),S=()=>{h(!1),m({}),g(l(p))},v=()=>{h(!1),Promise.all(Object.entries(d).map(([t,s])=>N(c.find(i=>i.id===t),"isEnabled",s))).catch(t=>H(n("global.error.label.failed_to_save_changes"),"error",P(t))),m({}),E(l(o))},F=(t,s)=>{g(s?[...o,t]:o.toSpliced(o.indexOf(t),1))};return e.jsxs(e.Fragment,{children:[e.jsx(_,{title:n("settings.title"),children:e.jsx(w,{onClick:()=>h(!0),"aria-label":"display more actions",edge:"end",color:"inherit",children:e.jsx(V,{})})}),e.jsxs(D,{fullWidth:!0,maxWidth:"xs",open:T,onClose:S,children:[e.jsx(U,{children:n("global.language.title.enabled_languages")}),e.jsx(q,{dividers:!0,sx:{padding:0},children:e.jsx(R,{style:{height:x.length*54,minHeight:"25vh",maxHeight:"50vh"},data:x,increaseViewportBy:400,computeItemKey:t=>x[t],itemContent:(t,s)=>{var f;const i=(f=B[s])!=null?f:[],j=o.includes(s);return e.jsxs(e.Fragment,{children:[e.jsxs(L,{children:[e.jsx(k,{primary:z(s)}),e.jsx(I,{checked:j,onChange:a=>F(s,a.target.checked)})]}),j&&i.length&&e.jsx(A,{sx:{ml:1},children:i.map(a=>{var b;return e.jsxs(L,{children:[e.jsx(X,{sx:{minWidth:32,mr:1},children:e.jsx(Q,{iconUrl:K.getValidImgUrlFor(a.iconUrl),alt:a.name,slots:{avatarProps:{sx:{width:32,height:32}}}})}),e.jsx(k,{primary:a.name}),e.jsx(I,{checked:(b=d[a.id])!=null?b:J(a).isEnabled,onChange:M=>m({...d,[a.id]:M.target.checked})})]},a.id)})})]})}})}),e.jsxs(W,{children:[e.jsx(y,{autoFocus:!0,onClick:S,color:"primary",children:n("global.button.cancel")}),e.jsx(y,{onClick:v,color:"primary",children:n("global.button.ok")})]})]})]})};export{ne as S};
