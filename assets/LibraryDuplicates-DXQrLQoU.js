import{u as S,aq as y,Z as x,r as G,bP as v,b as s,j as e,e as A,g as E,f as D,T as f,z as B,a5 as _,I as F,a4 as P,s as w,a6 as V,a7 as K,ax as U}from"./index-BODSeEcu.js";import{G as W}from"./GridLayouts-xS2klQ3P.js";import{C as q}from"./CheckboxInput-Dc79Wi4Q.js";import{E as z}from"./EmptyViewAbsoluteCentered-DDmWfOqL.js";import{c as H}from"./MangaGrid-rhDGpJvR.js";import{S as N,a as b}from"./StyledGroupHeader-CrnjINMw.js";import{B as R}from"./BaseMangaGrid-BTIrIU5R.js";import{S as $}from"./StyledGroupItemWrapper-Ds7xL2N2.js";import{V as O}from"./Virtuoso.util-D1vaYJ3x.js";import{u as Z}from"./useAppTitleAndAction-DjvPqS1-.js";import"./Checkbox-CioYox1s.js";import"./SwitchBase-BGJ0w6m2.js";import"./ListPreference-Dn2mK3Rd.js";import"./FormGroup-CiuXBMcc.js";import"./useManageMangaLibraryState-BsQKg7Hx.js";import"./Chapters-BQO7Cj43.js";import"./DateHelper-BQJx35Tj.js";import"./Asserts-DqTDQ0qD.js";import"./Mangas-BBFZHpo3.js";import"./ThreeStateCheckboxInput-DxIR9tgV.js";import"./Delete-Dme4SPcJ.js";import"./Download-DPXUoycH.js";import"./ContinueReadingTooltip-SArmT1A0.js";import"./Trackers-Bgo8y--2.js";import"./AvatarSpinner-DLZmnKat.js";import"./SpinnerImage-3Ixkj_Zv.js";import"./Refresh-D5fsx4KL.js";import"./Card-DRWdKBfF.js";import"./ListCardContent-Dck7VY3D.js";import"./CheckCircle-OcuBpxtC.js";import"./Metadata-951T2OSL.js";import"./MUI.util-CEodEA2f.js";import"./CardActionArea-BjuaT9KR.js";import"./Link-nJB0fSg9.js";import"./NumberSetting-DwU6n1-8.js";import"./Slider-DV5OgDSk.js";import"./useMobilePicker-bHHAo6gD.js";import"./Chip-zaGcYvq8.js";import"./SelectSetting-B9GnQ3eB.js";import"./Select-BQKZWRp4.js";import"./Sync-qkLL6JX8.js";import"./use-merged-ref-BItSWjvV.js";import"./ListCardAvatar-D0NGFYOW.js";import"./PlayArrow-DYCVlk68.js";import"./StyledFab-CVZ9Koug.js";import"./index-DOG5W0FP.js";import"./useAppTitle-DKEUgI89.js";import"./useAppAction-BzoKyZgk.js";const Ht=()=>{const{t:p}=S(),[n,j]=y("libraryDuplicatesGridLayout",x.List),[m,C]=y("libraryDuplicatesCheckAlternativeTitles",!1);Z(p("library.settings.advanced.duplicates.label.title"),e.jsxs(e.Fragment,{children:[e.jsx(W,{gridLayout:n,onChange:j}),e.jsx(_,{variant:"popover",popupId:"library-dupliactes-settings",children:t=>e.jsxs(e.Fragment,{children:[e.jsx(F,{...P(t),color:"inherit",children:e.jsx(w,{})}),e.jsx(V,{...K(t),children:e.jsx(U,{children:e.jsx(q,{label:p("library.settings.advanced.duplicates.settings.label.check_description"),checked:m,onChange:(r,l)=>C(l)})})})]})})]}),[p,n,m]);const{data:i,loading:M,error:u,refetch:L}=G.useGetMangas(v,{condition:{inLibrary:!0}}),[T,d]=s.useState(!0),[o,g]=s.useState({});s.useEffect(()=>{var l;d(!0);const t=(l=i==null?void 0:i.mangas.nodes)!=null?l:[];if(!t.length)return g({}),()=>{};const r=new Worker(new URL("/assets/LibraryDuplicatesWorker-DSTy3Dmj.js",import.meta.url),{type:"module"});return r.onmessage=I=>{g(I.data),d(!1)},r.postMessage({mangas:t,checkAlternativeTitles:m}),()=>r.terminate()},[i==null?void 0:i.mangas.nodes,m]);const a=s.useMemo(()=>Object.keys(o).toSorted((t,r)=>t.localeCompare(r)),[o]),c=s.useMemo(()=>a.map(t=>o[t]).flat(),[o]),h=s.useMemo(()=>a.map(t=>o[t]).map(t=>t.length),[o]),k=O.useCreateGroupedComputeItemKey(h,s.useCallback(t=>a[t],[a]),s.useCallback((t,r)=>"".concat(a[r],"-").concat(c[t].id,"}"),[a,c]));return M||T?e.jsx(A,{}):u?e.jsx(z,{message:p("global.error.label.failed_to_load_data"),messageExtra:E(u),retry:()=>L().catch(D())}):n===x.List?e.jsx(N,{persistKey:"library-duplicates",groupCounts:h,groupContent:t=>e.jsx(b,{isFirstItem:t===0,children:e.jsx(f,{variant:"h5",component:"h2",children:a[t]})}),computeItemKey:k,itemContent:t=>e.jsx($,{children:e.jsx(H,{manga:c[t],gridLayout:n,selected:null,mode:"duplicate"})})}):a.map((t,r)=>e.jsxs(B,{children:[e.jsx(b,{sx:{pt:r===0?void 0:0,pb:0},isFirstItem:!1,children:e.jsx(f,{variant:"h5",component:"h2",children:t})}),e.jsx(R,{mangas:o[t],hasNextPage:!1,loadMore:()=>{},isLoading:!1,gridLayout:n,inLibraryIndicator:!1,horizontal:!0,mode:"duplicate"},m.toString())]},t))};export{Ht as LibraryDuplicates};
