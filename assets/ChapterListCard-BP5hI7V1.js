import{c as w,j as e,u as S,r as O,a8 as q,a as Q,b as B,a1 as n,cd as J,f as X,ao as Y,M as z,a5 as Z,S as D,ax as f,L as ee,e9 as te,C as E,I as ae,a3 as re,a7 as oe,w as $,T as se}from"./index-DfKtWX_m.js";import{e as ne,g as h,h as le,j as ie,k as ce,D as de,R as pe,V as me,l as he,M as xe}from"./useManageMangaLibraryState-DdL9j6yU.js";import{C as ue,D as ke}from"./ChapterCardMetadata-CaGKwLz1.js";import{D as be}from"./Delete-BkmNeQWe.js";import{D as ge}from"./Download--JQWKfX-.js";import{D as Ce}from"./DoneAll-fULALqnt.js";import{M as Ie}from"./MUI.util-CYBuX_Wz.js";import{L as je}from"./ListCardContent-Cy1JhWRI.js";import{C as fe}from"./Card-BLPF1lkl.js";import{C as we}from"./CardActionArea-B1btdw_x.js";import{C as Me}from"./Checkbox-X0XiF4fh.js";const ve=w(e.jsx("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"})),ye=w(e.jsx("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"})),De=w(e.jsx("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2m-7 6-4 4h3v6h2v-6h3z"})),_e=De,Te=w(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),Re=Te,Ae=({chapter:t,handleSelection:l,canBeDownloaded:o=!1,selectedChapters:d=[],onClose:i,selectable:c=!0})=>{var V,P,H;const{t:a}=S(),p=!!t,{isDownloaded:j,isRead:m,isBookmarked:M}=t!=null?t:{},C=(H=(P=O.useGetMangaChapters(q,(V=t==null?void 0:t.mangaId)!=null?V:-1,{skip:!t,fetchPolicy:"cache-only"}).data)==null?void 0:P.chapters.nodes)!=null?H:[],{settings:{deleteChaptersWithBookmark:v}}=Q(),x=ie(p,J),u=ne(p),g=ce(p),{downloadableChapters:r,downloadedChapters:s,unbookmarkedChapters:k,bookmarkedChapters:_,unreadChapters:T,readChapters:R}=B.useMemo(()=>({downloadableChapters:n.getDownloadable(d),downloadedChapters:n.getDownloaded(d),unbookmarkedChapters:n.getNonBookmarked(d),bookmarkedChapters:n.getBookmarked(d),unreadChapters:n.getNonRead(d),readChapters:n.getRead(d)}),[d]),F=()=>{l==null||l(t.id,!0),i()},I=(L,W)=>{var G;const N=L==="mark_prev_as_read",U=N?"mark_as_read":L;if(U==="delete"&&t&&!n.isDeletable(t,v)){i();return}const y=(()=>{if(!t)return W;if(!N)return[t];const A=C.findIndex(({id:K})=>K===t.id);return A+1>C.length-1?[]:C.slice(A+1)})();if(!y.length){i();return}n.performAction(U,n.getIds(y),{chapters:y,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(G=y[0])==null?void 0:G.mangaId}).catch(X()),i()};return e.jsxs(e.Fragment,{children:[p&&c&&e.jsx(h,{onClick:F,Icon:le,title:a("chapter.action.label.select")}),p&&e.jsxs(e.Fragment,{children:[e.jsx(h,{Icon:Re,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),i()},title:a("global.button.open_browser")}),e.jsx(h,{Icon:_e,disabled:!t.realUrl,onClick:()=>{window.open(O.getWebviewUrl(t.realUrl),"_blank","noopener,noreferrer"),i()},title:a("global.button.open_webview")})]}),u(o)&&e.jsx(h,{Icon:ge,disabled:g(!r.length),onClick:()=>I("download",r),title:x("download",r.length)}),u(j)&&e.jsx(h,{Icon:be,disabled:g(!s.length),onClick:()=>I("delete",n.getDeletable(s,v)),title:x("delete",s.length)}),u(!M)&&e.jsx(h,{Icon:ye,disabled:g(!k.length),onClick:()=>I("bookmark",k),title:x("bookmark",k.length)}),u(M)&&e.jsx(h,{Icon:ve,disabled:g(!_.length),onClick:()=>I("unbookmark",_),title:x("unbookmark",_.length)}),u(!m)&&e.jsx(h,{Icon:de,disabled:g(!T.length),onClick:()=>I("mark_as_read",T),title:x("mark_as_read",T.length)}),u(m)&&e.jsx(h,{Icon:pe,disabled:g(!R.length),onClick:()=>I("mark_as_unread",R),title:x("mark_as_unread",R.length)}),p&&e.jsx(h,{onClick:()=>I("mark_prev_as_read",[]),Icon:Ce,title:a("chapter.action.mark_as_read.add.label.action.previous")})]})},Be=w(e.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"})),Se=B.memo(t=>{const{t:l}=S(),o=Y(),d=z.usePreventMobileContextMenu(),i=B.useRef(null),{mode:c="manga.page",chapter:a,showChapterNumber:p,onSelect:j,selected:m,selectable:M=!0,isActiveChapter:b=!1}=t,C=m!==null,{isDownloaded:v}=a,x=r=>{C&&(r.preventDefault(),r.stopPropagation(),j(a.id,!m,r.shiftKey))},u=(r,s)=>{r.stopPropagation(),r.preventDefault(),s==null||s(r)},g=me((r,{context:s})=>{if(!C&&i.current){u(r,()=>s==null?void 0:s(i.current));return}r.shiftKey=!0,x(r)});return e.jsx(Z,{variant:"popover",popupId:"chapter-card-action-menu",children:r=>{var s;return e.jsxs(D,{sx:{pt:1,px:1},children:[e.jsx(fe,{sx:{...f(c==="reader"&&b,{backgroundColor:"primary.main"})},children:e.jsx(we,{component:ee,to:n.getReaderUrl(a),onContextMenu:d,sx:z.preventMobileContextMenuSx(),style:{color:o.palette.text[a.isRead?"disabled":"primary"]},state:n.getReaderOpenChapterLocationState(a,!0),replace:c==="reader",onClick:k=>x(k),...g(r.open),children:e.jsxs(je,{children:[e.jsx(ue,{title:p?"".concat(l("chapter.title_one")," ").concat(a.chapterNumber):a.name,secondaryText:a.scanlator,ternaryText:"".concat(te(Number((s=a.uploadDate)!=null?s:0),!0)).concat(v?" â€¢ ".concat(l("chapter.status.label.downloaded")):""),infoIcons:a.isBookmarked&&e.jsx(Be,{color:c==="reader"&&b?"secondary":"primary"}),slotProps:{title:{variant:"h6",component:"h3",sx:f(c==="reader"&&b,{color:o.palette.primary.contrastText})},secondaryText:{sx:f(c==="reader"&&b,{color:o.palette.primary.contrastText})},ternaryText:{sx:f(c==="reader"&&b,{color:o.palette.primary.contrastText})}}}),e.jsx(ke,{chapterId:a.id,color:c==="reader"&&b?o.palette.primary.contrastText:void 0}),e.jsx(D,{sx:{minHeight:"48px"},children:m===null?e.jsx(E,{title:l("global.button.options"),children:e.jsx(ae,{ref:i,...Ie.preventRippleProp(re(r),{onClick:k=>u(k)}),"aria-label":"more",sx:{color:"inherit",...f(c==="reader"&&b,{color:"primary.contrastText"})},children:e.jsx(he,{})})}):e.jsx(E,{title:l(m?"global.button.deselect":"global.button.select"),children:e.jsx(Me,{checked:m})})})]})})}),!C&&r.isOpen&&e.jsx(xe,{...oe(r),children:k=>e.jsx(Ae,{onClose:k,chapter:a,handleSelection:()=>j(a.id,!0),canBeDownloaded:n.isDownloadable(a),selectable:M})})]})}})}),Ve=({missingChaptersGap:t})=>{const{t:l}=S();return e.jsxs(D,{sx:{width:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",p:2,pt:3.5,pb:2.5},children:[e.jsx($,{sx:{flexGrow:1,border:"1px solid",borderColor:o=>o.palette.text.secondary}}),e.jsx(se,{sx:{px:2},variant:"body2",color:"textSecondary",children:l("chapter.missing",{count:t})}),e.jsx($,{sx:{flexGrow:1,border:"1px solid",borderColor:o=>o.palette.text.secondary}})]})},qe=({index:t,isSortDesc:l,chapters:o,...d})=>{var m;const i=l?t+1:t-1,c=o[t],a=(m=o[i])!=null?m:{chapterNumber:0},p=n.getGap(c,a),j=p>0;return e.jsxs(D,{sx:f(!l,{flexDirection:"column-reverse"}),children:[e.jsx(Se,{...d,chapter:o[t]}),j&&e.jsx(Ve,{missingChaptersGap:p})]})};export{Be as B,qe as C,Re as I,Ae as a,_e as b};
