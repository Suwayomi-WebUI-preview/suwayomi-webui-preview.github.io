import{u as R,r as D,F as Se,H as ue,d as G,j as a,J as je,K as ke,N as _e,O as v,P as M,q as Te,m as ne,h as ie,e as m,Q as ge,C as me,I as Me,R as K,U as Fe,V as Ae,W as Le,i as P,X as Ie,Y as we,a as Be,g as Re,Z as Oe}from"./index-DWz4TNtd.js";import{u as be,S as ve,A as Ee,N as Ne}from"./AppbarSearch-I-jhwbd8.js";import{E as ce}from"./EmptyViewAbsoluteCentered-DPrnddnF.js";import{T as De,a as Ge}from"./Tabs-CgaLWDU0.js";import{F as Ue}from"./FilterList-dvyjNZLc.js";import{C as E}from"./CheckboxInput-DJhQhiao.js";import{S as Pe,R as z}from"./SortRadioInput-CDwC33C3.js";import{T as _}from"./ThreeStateCheckboxInput-bOClE9Pj.js";import{O as ze,S as Ke,a as We}from"./SelectionFAB-BoZXE15X.js";import{T as Ye}from"./Trackers-D4pSmk7a.js";import{F as I}from"./TextField-p1pWQlzT.js";import{R as He}from"./ListPreference-O4j_Xj-q.js";import{M as Ve,a as Qe}from"./MangaGrid-DcHgkAx9.js";import{C as Je,U as Xe}from"./UpdateChecker-CvrdlEcf.js";import{u as Ze}from"./useManageMangaLibraryState-SIk1Scuh.js";import{C as $e}from"./Checkbox-BBcQZP1l.js";import{T as qe}from"./TabsMenu-Dgyz8PyL.js";import{T as et}from"./TabsWrapper-CJBHW_jV.js";import{C as tt}from"./Chip-vNVf609j.js";import"./ChaptersDownloadActionMenuItems-B7yKOewR.js";import"./Card-8Hlh2tNY.js";import"./CardContent-CJ5i7b3K.js";import"./Avatar-aJufYokf.js";import"./InputAdornment-D2Hu2W11.js";import"./useFormControl-BeXl2Zas.js";import"./CheckCircle-V9AVHnfh.js";import"./MUI.util-BHb8I4Fi.js";import"./CardActionArea-DZr1-Ien.js";import"./Link-CkgbKDy3.js";import"./NumberSetting-f5eDW7ri.js";import"./Slider-DpJVGl_w.js";import"./useMobilePicker-Din-egOw.js";import"./SelectSetting-Bb9lWjRf.js";import"./Select-DTupB29O.js";import"./FormGroup-CzBp0i4z.js";import"./formControlState-Dq1zat_P.js";import"./StyledFab-CsCAQaVn.js";import"./SwitchBase-DdFM11Au.js";import"./Delete-Da55i9yt.js";import"./Download-BNw0zcIk.js";import"./Sync-DNaSioGT.js";import"./ListCardAvatar-DBmIeoJi.js";import"./ListCardContent-D0gc0Fug.js";import"./PlayArrow-PCjqY2mO.js";import"./Progress-CRYkx6IF.js";const at={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},st=[["unreadChapters","library.option.sort.label.by_unread_chapters"],["totalChapters","library.option.sort.label.by_total_chapters"],["alphabetically","library.option.sort.label.alphabetically"],["dateAdded","library.option.sort.label.by_date_added"],["lastRead","library.option.sort.label.by_last_read"],["latestFetchedChapter","library.option.sort.label.by_latest_fetched_chapter"],["latestUploadedChapter","library.option.sort.label.by_latest_uploaded_chapter"]],rt=({category:e,open:s,onClose:n})=>{var f,p;const{t}=R(),o=D.useGetTrackerList(Se),l=Ye.getLoggedIn((p=(f=o.data)==null?void 0:f.trackers.nodes)!=null?p:[]),r=ue(e),i=je(e,u=>ne(t("global.error.label.failed_to_save_changes"),"error",ie(u))),{settings:{showTabSize:g,showContinueReadingButton:x,showDownloadBadge:F,showUnreadBadge:y,gridLayout:b}}=G(),h=Te(u=>ne(t("search.error.label.failed_to_save_settings"),"error",ie(u)));return a.jsx(ze,{open:s,onClose:n,tabs:["filter","sort","display"],tabTitle:u=>t(at[u]),tabContent:u=>u==="filter"?a.jsxs(a.Fragment,{children:[a.jsx(_,{label:t("global.filter.label.unread"),checked:r.hasUnreadChapters,onChange:d=>i("hasUnreadChapters",d)}),a.jsx(_,{label:t("global.filter.label.started"),checked:r.hasReadChapters,onChange:d=>i("hasReadChapters",d)}),a.jsx(_,{label:t("global.filter.label.downloaded"),checked:r.hasDownloadedChapters,onChange:d=>i("hasDownloadedChapters",d)}),a.jsx(_,{label:t("global.filter.label.bookmarked"),checked:r.hasBookmarkedChapters,onChange:d=>i("hasBookmarkedChapters",d)}),a.jsx(_,{label:t("global.filter.label.duplicate_chapters"),checked:r.hasDuplicateChapters,onChange:d=>i("hasDuplicateChapters",d)}),a.jsx(I,{sx:{mt:2},children:t("manga.label.status")}),Object.values(ke).map(d=>a.jsx(_,{label:t(_e[d]),checked:r.hasStatus[d],onChange:S=>i("hasStatus",{...r.hasStatus,[d]:S})},d)),a.jsx(I,{sx:{mt:2},children:t("global.filter.label.tracked")}),l.map(d=>a.jsx(_,{label:d.name,checked:r.hasTrackerBinding[d.id],onChange:S=>i("hasTrackerBinding",{...r.hasTrackerBinding,[d.id]:S})},d.id))]}):u==="sort"?st.map(([d,S])=>a.jsx(Pe,{label:t(S),checked:r.sortBy===d,sortDescending:r.sortDesc,onClick:()=>d!==r.sortBy?i("sortBy",d):i("sortDesc",!r.sortDesc)},d)):u==="display"?a.jsxs(a.Fragment,{children:[a.jsx(I,{children:t("global.grid_layout.title")}),a.jsxs(He,{onChange:d=>v("gridLayout",Number(d.target.value)),value:b,children:[a.jsx(z,{label:t("global.grid_layout.label.compact_grid"),value:M.Compact,checked:b==null||b===M.Compact}),a.jsx(z,{label:t("global.grid_layout.label.comfortable_grid"),value:M.Comfortable,checked:b===M.Comfortable}),a.jsx(z,{label:t("global.grid_layout.label.list"),value:M.List,checked:b===M.List})]}),a.jsx(I,{sx:{mt:2},children:t("library.option.display.badge.title")}),a.jsx(E,{label:t("library.option.display.badge.label.unread_badges"),checked:y,onChange:()=>v("showUnreadBadge",!y)}),a.jsx(E,{label:t("library.option.display.badge.label.download_badges"),checked:F,onChange:()=>v("showDownloadBadge",!F)}),a.jsx(I,{sx:{mt:2},children:t("library.option.display.tab.title")}),a.jsx(E,{label:t("library.option.display.tab.label.show_number_of_items"),checked:g,onChange:()=>h("showTabSize",!g)}),a.jsx(I,{sx:{mt:2},children:t("global.label.other")}),a.jsx(E,{label:t("library.option.display.other.label.show_continue_reading_button"),checked:x,onChange:()=>v("showContinueReadingButton",!x)})]}):null})},ot=({category:e})=>{const{t:s}=R(),[n,t]=m.useState(!1),{options:o}=ge(),l=o.hasDownloadedChapters!=null||o.hasUnreadChapters!=null||o.hasReadChapters!=null||o.hasBookmarkedChapters!=null||o.hasDuplicateChapters!=null||Object.values(o.hasStatus).some(r=>r!=null)||Object.values(o.hasTrackerBinding).some(r=>r!=null);return a.jsxs(a.Fragment,{children:[a.jsx(me,{title:s("settings.title"),children:a.jsx(Me,{onClick:()=>t(!n),color:l?"warning":"inherit",children:a.jsx(Ue,{})})}),a.jsx(rt,{category:e,open:n,onClose:()=>t(!1)})]})},lt=()=>{},de=({showFilteredOutMessage:e,message:s,messageExtra:n,...t})=>{const{t:o}=R(),{settings:{gridLayout:l}}=G();return m.useLayoutEffect(()=>(document.body.style.overflowY=l===M.List?"auto":"scroll",()=>{document.body.style.overflowY="auto"}),[]),a.jsx(Ve,{gridWrapperProps:{sx:{p:1}},...t,hasNextPage:!1,loadMore:lt,message:e?o("library.error.label.no_matches"):s,messageExtra:e?void 0:n,gridLayout:l})},nt=({isActive:e,areAllItemsSelected:s,areNoItemsSelected:n,onSelectAll:t,onModeChange:o})=>{const{t:l}=R();return a.jsxs(a.Fragment,{children:[e&&a.jsx(Ke,{areAllItemsSelected:s,areNoItemsSelected:n,onChange:t}),a.jsx(me,{title:l(e?"global.button.cancel":"global.button.select_all"),children:a.jsx($e,{checkedIcon:a.jsx(Je,{}),sx:{padding:"8px",color:"inherit","&.Mui-checked":{color:"inherit"}},checked:e,onChange:(r,i)=>o(i)})})]})},W=(e,s,n)=>{switch(e){case!0:return s();case!1:return n();default:return!0}},N=(e,s)=>W(e,()=>!!s&&s>=1,()=>s===0),Ce=(e,s)=>W(e,()=>!!s,()=>!s),T=(e,s)=>{const n=e==null?void 0:e.filter(r=>r!=null),t=s==null?void 0:s.filter(r=>r!=null);if(!(n!=null&&n.length))return!0;const o=n.map(K),l=t.map(K).join(", ");return o.every(r=>l.includes(r))},it=(e,{title:s,genre:n,description:t,artist:o,author:l,source:r,sourceId:i})=>T([e],[s])||T(e==null?void 0:e.split(","),n.map(g=>K(g)))||T([e],[t])||T([e],[o])||T([e],[l])||T([e],[r==null?void 0:r.displayName])||T([e],[i]),ct=(e,s)=>Object.entries(e).map(([n,t])=>{const o=s.trackRecords.nodes.some(l=>l.trackerId===Number(n));return W(t,()=>o,()=>!o)}).every(Boolean),dt=(e,s)=>Object.entries(e).map(([n,t])=>Ce(t,n===s.status)).every(Boolean),ht=(e,{hasDownloadedChapters:s,hasUnreadChapters:n,hasReadChapters:t,hasBookmarkedChapters:o,hasDuplicateChapters:l,hasTrackerBinding:r,hasStatus:i})=>N(s,e.downloadCount)&&N(n,e.unreadCount)&&N(t,e.chapters.totalCount-e.unreadCount)&&N(o,e.bookmarkCount)&&Ce(l,e.hasDuplicateChapters)&&ct(r,e)&&dt(i,e),pt=(e,s,n)=>{const t=n.ignoreFilters&&(s==null?void 0:s.length);return e.filter(o=>{const l=it(s,o),r=t||ht(o,n);return l&&r})},w=(e=0,s=0)=>Number(e)-Number(s),ut=(e,s)=>e.localeCompare(s),gt=(e,s,n)=>{const t=[...e];switch(s){case"alphabetically":t.sort((o,l)=>ut(o.title,l.title));break;case"dateAdded":t.sort((o,l)=>w(o.inLibraryAt,l.inLibraryAt));break;case"unreadChapters":t.sort((o,l)=>w(o.unreadCount,l.unreadCount));break;case"lastRead":t.sort((o,l)=>{var r,i;return w((r=o.lastReadChapter)==null?void 0:r.lastReadAt,(i=l.lastReadChapter)==null?void 0:i.lastReadAt)});break;case"latestUploadedChapter":t.sort((o,l)=>{var r,i;return w((r=o.latestUploadedChapter)==null?void 0:r.uploadDate,(i=l.latestUploadedChapter)==null?void 0:i.uploadDate)});break;case"latestFetchedChapter":t.sort((o,l)=>{var r,i;return w((r=o.latestFetchedChapter)==null?void 0:r.fetchedAt,(i=l.latestFetchedChapter)==null?void 0:i.fetchedAt)});break;case"totalChapters":t.sort((o,l)=>w(o.chapters.totalCount,l.chapters.totalCount));break}return n&&t.reverse(),t},mt={id:-1},bt=(e,s)=>{const[n]=be("query",ve),t=ue(s!=null?s:mt),{hasUnreadChapters:o,hasReadChapters:l,hasDownloadedChapters:r,hasBookmarkedChapters:i,hasTrackerBinding:g,hasDuplicateChapters:x,hasStatus:F}=t,{settings:y}=G(),b=m.useMemo(()=>pt(e,n,{...t,ignoreFilters:y.ignoreFilters}),[e,n,o,l,r,i,g,x,F,y.ignoreFilters]),h=m.useMemo(()=>gt(b,t.sortBy,t.sortDesc),[b,t.sortBy,t.sortDesc]),f=Object.values(t.hasTrackerBinding).some(u=>u!=null),p=(o!=null||l!=null||r!=null||i!=null||!!n||f)&&b.length===0&&e.length>0;return{visibleMangas:h,showFilteredOutMessage:p}},he=Oe("span")({display:"flex",alignItems:"center"}),pe=({sx:e,...s})=>a.jsx(tt,{...s,size:"small",sx:{...e,marginLeft:"5px"}});function ia(){var te,ae,se,re,oe,le;const{t:e}=R(),{settings:{showTabSize:s}}=G(),{data:n,error:t,loading:o,refetch:l}=D.useGetCategories(Fe,{notifyOnNetworkStatusChange:!0}),r=n==null?void 0:n.categories.nodes.filter(c=>c.id!==0||c.id===0&&c.mangas.totalCount),i=r!=null?r:[],g=D.useGetMangas(Ae,{}),x=(ae=(te=g.data)==null?void 0:te.mangas.totalCount)!=null?ae:0,[F,y]=be("tab",Ne),{setOptions:b}=ge(),h=(se=i.find(c=>c.id===F))!=null?se:i[0];m.useLayoutEffect(()=>{b(Le(h!=null?h:{id:-1}))},[h]);const{data:f,error:p,loading:u,refetch:d}=D.useGetCategoryMangas(h==null?void 0:h.id,{skip:!h,notifyOnNetworkStatusChange:!0}),S=(re=f==null?void 0:f.mangas.nodes)!=null?re:[],{visibleMangas:C,showFilteredOutMessage:Y}=bt(S,h),H=m.useCallback(()=>d().catch(P()),[d,h]),fe=m.useMemo(()=>C.map(c=>c.id),[C]),[j,O]=m.useState(!1),{areNoItemsForKeySelected:V,areAllItemsForKeySelected:Q,selectedItemIds:A,handleSelectAll:U,handleSelection:J,clearSelection:xe}=Ze(C.length,{itemIds:fe,currentKey:h==null?void 0:h.id.toString()}),X=m.useCallback((c,k,L)=>{O(!!(A.length+(k?1:-1))),J(c,k,L)},[O,J]),Z=m.useMemo(()=>A.map(c=>Ie.getFromCache(c,we,"MANGA_CHAPTER_STAT_FIELDS")).filter(c=>!!c),[A.length,C]),$=m.useMemo(()=>j?a.jsx(We,{selectedItemsCount:A.length,title:"manga.title",children:(c,k)=>a.jsx(Qe,{selectedMangas:Z,onClose:()=>{c(),O(!1),xe()},setHideMenu:k})}):null,[j,Z]),{setTitle:q,setAction:ee}=Be();m.useLayoutEffect(()=>{const c=e("library.title");return q(a.jsxs(he,{children:[c,s&&a.jsx(pe,{sx:{color:"inherit"},label:x})]}),c),ee(a.jsxs(a.Fragment,{children:[!j&&h&&a.jsxs(a.Fragment,{children:[a.jsx(Ee,{}),a.jsx(ot,{category:h}),a.jsx(Xe,{categoryId:h==null?void 0:h.id})]}),a.jsx(nt,{isActive:j,areAllItemsSelected:Q,areNoItemsSelected:V,onSelectAll:L=>U(L,[...new Set(C.map(B=>B.id))]),onModeChange:L=>{O(L),L?U(!0,[...new Set(C.map(B=>B.id))]):i.forEach(B=>U(!1,[],B.id.toString()))}})]})),()=>{q(""),ee(null)}},[e,x,o,j,V,Q,C.length,h,s]);const ye=c=>{y(c)};return t!=null||g.error?a.jsx(ce,{message:e("global.error.label.failed_to_load_data"),messageExtra:(le=t==null?void 0:t.message)!=null?le:(oe=g.error)==null?void 0:oe.message,retry:()=>{t&&l().catch(P()),g.error&&g.refetch().catch(P())}}):o||g.loading?a.jsx(Re,{}):i.length===0?a.jsx(ce,{message:e("library.error.label.empty")}):i.length===1?a.jsxs(a.Fragment,{children:[a.jsx(de,{mangas:C,message:e(p?"manga.error.label.request_failure":"library.error.label.empty"),messageExtra:p==null?void 0:p.message,isLoading:u,selectedMangaIds:A,isSelectModeActive:j,handleSelection:X,showFilteredOutMessage:!p&&Y,retry:p&&H}),$]}):a.jsxs(et,{children:[a.jsx(qe,{value:h.id,onChange:(c,k)=>ye(k),children:i.map(c=>a.jsx(De,{sx:{flexGrow:1,maxWidth:"unset"},label:a.jsxs(he,{children:[c.name,s?a.jsx(pe,{label:c.mangas.totalCount}):null]}),value:c.id},c.id))}),i.map(c=>a.jsx(Ge,{index:c.order,currentIndex:h.order,children:c===h&&a.jsx(de,{mangas:C,message:e(p?"manga.error.label.request_failure":"library.error.label.empty"),messageExtra:p==null?void 0:p.message,isLoading:u,selectedMangaIds:A,isSelectModeActive:j,handleSelection:X,showFilteredOutMessage:!p&&Y,retry:p&&H})},c.order)),$]})}export{ia as Library};
