import{r as z,i as T,j as e,u as q,a as n,c as m,N as V,f,I as p,g as B,E as P,h as S,B as g,L as N,S as F,T as y,m as R}from"./index-p7rUbK5Y.js";import{d as G}from"./Delete-C1A6sCmR.js";import{D as W,S as J,P as K,d as U}from"./StrictModeDroppable-DO-IUKYY.js";import{d as X}from"./PlayArrow-C7TWj8Mb.js";import{V as Y}from"./index-CqHLwm3Q.js";import{D as Z}from"./DownloadStateIndicator-HLFphUBa.js";import{C as ee}from"./Card-CPUXOJW4.js";import{C as re}from"./CardActionArea-C62UTgtC.js";import{C as te}from"./CardContent-BP6BrAzg.js";var j={},ae=T;Object.defineProperty(j,"__esModule",{value:!0});var $=j.default=void 0,oe=ae(z()),se=e;$=j.default=(0,oe.default)((0,se.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause");var v={},ne=T;Object.defineProperty(v,"__esModule",{value:!0});var O=v.default=void 0,le=ne(z()),ie=e;O=v.default=(0,le.default)((0,ie.jsx)("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3zM14 5h-3l-1-1H6L5 5H2v2h12z"}),"DeleteSweep");const de=({children:t,...s})=>e.jsx(g,{...s,style:{height:s["data-known-size"]||void 0},children:t}),I=({provided:t,item:s,handleDelete:h})=>{const{t:i}=q();return e.jsx(g,{...t.draggableProps,...t.dragHandleProps,ref:t.innerRef,sx:{p:1,pb:0},children:e.jsx(ee,{children:e.jsx(re,{component:N,to:"/manga/".concat(s.manga.id),children:e.jsxs(te,{sx:{display:"flex",alignItems:"center",p:1.5},children:[e.jsx(p,{sx:{pointerEvents:"none"},children:e.jsx(U,{})}),e.jsxs(F,{sx:{flex:1,ml:1},direction:"column",children:[e.jsx(y,{variant:"h6",component:"h3",children:s.manga.title}),e.jsx(y,{variant:"caption",sx:{display:"block"},children:s.chapter.name})]}),e.jsx(Z,{download:s}),e.jsx(f,{title:i("chapter.action.download.delete.label.action"),children:e.jsx(p,{onClick:c=>{c.preventDefault(),c.stopPropagation(),h(s.chapter)},size:"large",children:e.jsx(G,{})})})]})})})})},ve=()=>{var C,E;const{t}=q(),[s,{reset:h}]=n.useReorderChapterInDownloadQueue(),{data:i,loading:c,error:w,refetch:k}=n.useGetDownloadStatus({notifyOnNetworkStatusChange:!0}),l=i==null?void 0:i.downloadStatus,u=(C=l==null?void 0:l.queue)!=null?C:[],d=(E=l==null?void 0:l.state)!=null?E:"STARTED",x=!u.length,{setTitle:D,setAction:b}=m.useContext(V),H=async()=>{try{await n.clearDownloads().response}catch(r){R(t("download.queue.error.label.failed_delete_all"),"error")}},M=()=>{d==="STOPPED"?n.startDownloads():n.stopDownloads()};m.useEffect(()=>(D(t("download.queue.title")),b(e.jsxs(e.Fragment,{children:[e.jsx(f,{title:t("download.queue.label.delete_all"),children:e.jsx(p,{onClick:H,size:"large",color:"inherit",children:e.jsx(O,{})})}),e.jsx(f,{title:t(d==="STOPPED"?"global.button.start":"global.button.stop"),children:e.jsx(p,{onClick:M,size:"large",disabled:x,color:"inherit",children:d==="STOPPED"?e.jsx(X,{}):e.jsx($,{})})})]})),()=>{D(""),b(null)}),[t,d,x]),m.useEffect(()=>{const r=a=>{(a.message==="ResizeObserver loop completed with undelivered notifications."||a.message==="ResizeObserver loop limit exceeded")&&a.stopImmediatePropagation()};return window.addEventListener("error",r),()=>window.removeEventListener("error",r)},[]);const L=(r,a,o)=>{a!==o&&s({variables:{input:{chapterId:r[a].chapter.id,to:o}}}).catch(()=>{h()})},A=r=>{r.destination&&L(u,r.source.index,r.destination.index)},_=async r=>{const a=d==="STARTED";try{a&&await n.stopDownloads().response,await Promise.all([n.removeChapterFromDownloadQueue(r.id).response,n.deleteDownloadedChapter(r.id).response])}catch(o){R(t("download.queue.error.label.failed_to_remove"),"error")}a&&n.startDownloads().response.catch(S())};return c?e.jsx(B,{}):w?e.jsx(P,{message:t("global.error.label.failed_to_load_data"),messageExtra:w.message,retry:()=>k().catch(S())}):x?e.jsx(P,{message:t("download.queue.label.no_downloads")}):e.jsx(W,{onDragEnd:A,children:e.jsx(J,{droppableId:"droppable",mode:"virtual",renderClone:(r,a,o)=>e.jsx(I,{provided:r,item:u[o.source.index],handleDelete:_}),children:r=>e.jsx(g,{ref:r.innerRef,children:e.jsx(Y,{useWindowScroll:!0,overscan:window.innerHeight*.5,data:u,components:{Item:de},itemContent:(a,o)=>e.jsx(K,{draggableId:"".concat(o.manga.id,"-").concat(o.chapter.sourceOrder),index:a,children:Q=>e.jsx(I,{provided:Q,item:o,handleDelete:_})},"".concat(o.manga.id,"-").concat(o.chapter.sourceOrder))})})})})};export{ve as DownloadQueue};
