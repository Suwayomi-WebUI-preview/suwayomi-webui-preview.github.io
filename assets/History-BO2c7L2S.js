import{h as l,aa as p,u as I,j as e,C as _,a as A,A as j,L as C,b as G,B as b,S as M,a7 as D,bL as w,bN as L,bO as O,J as B,K as N,k as R,I as k,R as F,aj as U,r as g,o as v,m,f as V,E as S,n as K,T as q,l as z}from"./index-lurey2IN.js";import{V as u,S as Q,a as $,b as H}from"./Virtuoso.util-CkvPQUQU.js";import{A as J}from"./Avatar-cR29cwvm.js";const W=l.memo(({chapter:t})=>{const{manga:i}=t,a=p.useDownloadStatusFromCache(t.id),{t:r}=I(),c=async()=>{try{await g.addChapterToDownloadQueue(t.id).response}catch(o){v(r("download.queue.error.label.failed_to_retry"),"error",m(o))}},h=()=>{g.addChapterToDownloadQueue(t.id).response.catch(o=>v(r("global.error.label.failed_to_save_changes"),"error",m(o)))};return e.jsx(_,{children:e.jsx(A,{component:C,to:j.reader.path(t.manga.id,t.sourceOrder),state:p.getReaderOpenChapterLocationState(t),sx:{color:o=>o.palette.text[t.isRead?"disabled":"primary"]},children:e.jsxs(G,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5},children:[e.jsxs(b,{sx:{display:"flex",flexGrow:1},children:[e.jsx(C,{to:j.manga.path(t.manga.id),style:{textDecoration:"none"},children:e.jsx(J,{variant:"rounded",sx:{width:56,height:56,flex:"0 0 auto",marginRight:1,background:"transparent"},children:e.jsx(M,{imgStyle:{objectFit:"cover",width:"100%",height:"100%",imageRendering:"pixelated"},spinnerStyle:{small:!0},alt:i.title,src:D.getThumbnailUrl(i)})})}),e.jsxs(b,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",flexGrow:1,flexShrink:1,wordBreak:"break-word"},children:[e.jsx(w,{variant:"h6",component:"h3",children:i.title}),e.jsx(w,{variant:"caption",display:"block",lines:1,children:"".concat(t.name," â€” ").concat(L.format(O(Number(t.lastReadAt)).valueOf()))})]})]}),e.jsx(B,{chapterId:t.id}),(a==null?void 0:a.state)===N.Error&&e.jsx(R,{title:r("global.button.retry"),children:e.jsx(k,{onClick:o=>{o.preventDefault(),o.stopPropagation(),c()},size:"large",children:e.jsx(F,{})})}),a==null&&!t.isDownloaded&&e.jsx(R,{title:r("chapter.action.download.add.label.action"),children:e.jsx(k,{onClick:o=>{o.stopPropagation(),o.preventDefault(),h()},size:"large",children:e.jsx(U,{})})})]})})})}),ee=()=>{var y;const{t}=I(),{setTitle:i}=V(),{data:a,loading:r,error:c,fetchMore:h,refetch:o}=g.useGetRecentlyReadChapters(void 0,{fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),x=!!(a!=null&&a.chapters.pageInfo.hasNextPage),T=a==null?void 0:a.chapters.pageInfo.endCursor,n=(y=a==null?void 0:a.chapters.nodes)!=null?y:[],d=l.useMemo(()=>Object.entries(p.groupByDate(n,"lastReadAt")),[n]),f=l.useMemo(()=>d.map(s=>s[u.ITEMS].length),[d]),E=u.useCreateGroupedComputeItemKey(f,l.useCallback(s=>d[s][u.GROUP],[d]),l.useCallback(s=>n[s].id,[n]));l.useLayoutEffect(()=>(i(t("history.title")),()=>{i("")}),[t]);const P=l.useCallback(()=>{x&&h({variables:{offset:n.length}})},[x,T]);return c?e.jsx(S,{message:t("global.error.label.failed_to_load_data"),messageExtra:m(c),retry:()=>o().catch(K())}):!r&&n.length===0?e.jsx(S,{message:t("history.error.label.no_history_available")}):e.jsx(Q,{style:{height:"undefined"},components:{Footer:()=>r?e.jsx(z,{usePadding:!0}):null},overscan:window.innerHeight*.5,endReached:P,groupCounts:f,groupContent:s=>e.jsx(H,{isFirstItem:s===0,children:e.jsx(q,{variant:"h5",component:"h2",children:d[s][u.GROUP]})}),computeItemKey:E,itemContent:s=>e.jsx($,{children:e.jsx(W,{chapter:n[s]})})})};export{ee as History};
