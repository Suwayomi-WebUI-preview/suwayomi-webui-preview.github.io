import{dZ as J,f as R,M as Q,d_ as Z,b as M,N as K,c as _,j as r,u as B,r as X,a8 as Y,a as ee,a0 as u,dc as te,ad as ae,a7 as U,a4 as re,S as T,am as j,L as oe,d$ as se,C as H,I as ne,a2 as le,a6 as ce,w as z,T as de,B as ie}from"./index-DAymAOkx.js";import{c as ue,d as k,C as me,e as pe,f as he,D as xe,R as ke,V as be,g as ge,M as Ce}from"./useManageMangaLibraryState-CV5dUyaq.js";import{C as fe,D as Me}from"./ChapterCardMetadata-BvgMM9IU.js";import{D as Ie}from"./Delete-DXabme3H.js";import{D as je}from"./Download-Cac8Cj13.js";import{D as we}from"./DoneAll-E5IDUgTR.js";import{M as De}from"./MUI.util-CYBuX_Wz.js";import{L as Ae}from"./ListCardContent-DS0Tm_8x.js";import{C as Te}from"./Card-dwVnZO-h.js";import{C as _e}from"./CardActionArea-DkRZcjz3.js";import{C as ye}from"./Checkbox-v3o8CvOq.js";const ve={...Z},Se=e=>({...e,excludedScanlators:JSON.stringify(e.excludedScanlators)}),Ne=(e,t=ve,a)=>Q("manga",e,t,void 0,a),Re=(e,t,a)=>Ne({...e,meta:K(e.meta)},t,a),Be=(e,t)=>{const a=Re(e,t,M.useEffect);return M.useMemo(()=>a,[e,t])},Le=async(e,t,a)=>J(e,[[t,Se({[t]:a})[t]]]),Pe=(e,t=R())=>(a,s)=>Le(e,a,s).catch(t);function Oe(e,{isRead:t}){switch(e){case!0:return!t;case!1:return t;default:return!0}}function Fe(e,{isDownloaded:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function Ve(e,{isBookmarked:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function Ge(e,{scanlator:t}){return!t||!e.includes(t)}const Ee=(e,{sortBy:t,reverse:a})=>{const s=[...e];switch(t){case"source":s.sort((n,l)=>n.sourceOrder-l.sourceOrder);break;case"fetchedAt":s.sort((n,l)=>{var o,c;return Number((o=n.fetchedAt)!=null?o:0)-Number((c=l.fetchedAt)!=null?c:0)});break;case"chapterNumber":s.sort((n,l)=>n.chapterNumber-l.chapterNumber);break;case"uploadedAt":s.sort((n,l)=>{var o,c;return Number((o=n.uploadDate)!=null?o:0)-Number((c=l.uploadDate)!=null?c:0)});break}return a&&s.reverse(),s};function Ue(e,t){return e.filter(a=>Oe(t.unread,a)&&Fe(t.downloaded,a)&&Ve(t.bookmarked,a)&&Ge(t.excludedScanlators,a))}function dt(e,t){const a=Ue(e,t);return Ee(a,t)}const it=e=>{const{unread:t,downloaded:a,bookmarked:s,excludedScanlators:n}=e;return t!=null||a!=null||s!=null||!!n.length},ut=e=>{const{unread:t,downloaded:a,bookmarked:s,reverse:n,sortBy:l,showChapterNumber:o,excludedScanlators:c}=Be(e);return M.useMemo(()=>({unread:t,downloaded:a,bookmarked:s,reverse:n,sortBy:l,showChapterNumber:o,excludedScanlators:c}),[t,a,s,n,l,o,c])},mt=(e,t=R())=>Pe(e,t),He=_(r.jsx("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"})),ze=_(r.jsx("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"})),$e=_(r.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),qe=({chapter:e,handleSelection:t,canBeDownloaded:a=!1,selectedChapters:s=[],onClose:n,selectable:l=!0})=>{var L,P,O;const{t:o}=B(),c=!!e,{isDownloaded:I,isRead:m,isBookmarked:w}=e!=null?e:{},C=(O=(P=X.useGetMangaChapters(Y,(L=e==null?void 0:e.mangaId)!=null?L:-1,{skip:!e,fetchPolicy:"cache-only"}).data)==null?void 0:P.chapters.nodes)!=null?O:[],{settings:{deleteChaptersWithBookmark:D}}=ee(),p=pe(c,te),h=ue(c),g=he(c),{downloadableChapters:d,downloadedChapters:i,unbookmarkedChapters:x,bookmarkedChapters:y,unreadChapters:v,readChapters:S}=M.useMemo(()=>({downloadableChapters:u.getDownloadable(s),downloadedChapters:u.getDownloaded(s),unbookmarkedChapters:u.getNonBookmarked(s),bookmarkedChapters:u.getBookmarked(s),unreadChapters:u.getNonRead(s),readChapters:u.getRead(s)}),[s]),$=()=>{t==null||t(e.id,!0),n()},f=(F,q)=>{var E;const V=F==="mark_prev_as_read",G=V?"mark_as_read":F;if(G==="delete"&&e&&!u.isDeletable(e,D)){n();return}const A=(()=>{if(!e)return q;if(!V)return[e];const N=C.findIndex(({id:W})=>W===e.id);return N+1>C.length-1?[]:C.slice(N+1)})();if(!A.length){n();return}u.performAction(G,u.getIds(A),{chapters:A,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(E=A[0])==null?void 0:E.mangaId}).catch(R()),n()};return r.jsxs(r.Fragment,{children:[c&&l&&r.jsx(k,{onClick:$,Icon:me,title:o("chapter.action.label.select")}),c&&r.jsx(k,{Icon:$e,disabled:!e.realUrl,onClick:()=>{window.open(e.realUrl,"_blank","noopener,noreferrer"),n()},title:o("chapter.action.label.open_on_source")}),h(a)&&r.jsx(k,{Icon:je,disabled:g(!d.length),onClick:()=>f("download",d),title:p("download",d.length)}),h(I)&&r.jsx(k,{Icon:Ie,disabled:g(!i.length),onClick:()=>f("delete",u.getDeletable(i,D)),title:p("delete",i.length)}),h(!w)&&r.jsx(k,{Icon:ze,disabled:g(!x.length),onClick:()=>f("bookmark",x),title:p("bookmark",x.length)}),h(w)&&r.jsx(k,{Icon:He,disabled:g(!y.length),onClick:()=>f("unbookmark",y),title:p("unbookmark",y.length)}),h(!m)&&r.jsx(k,{Icon:xe,disabled:g(!v.length),onClick:()=>f("mark_as_read",v),title:p("mark_as_read",v.length)}),h(m)&&r.jsx(k,{Icon:ke,disabled:g(!S.length),onClick:()=>f("mark_as_unread",S),title:p("mark_as_unread",S.length)}),c&&r.jsx(k,{onClick:()=>f("mark_prev_as_read",[]),Icon:we,title:o("chapter.action.mark_as_read.add.label.action.previous")})]})},We=_(r.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"})),Je=M.memo(e=>{const{t}=B(),a=ae(),s=U.usePreventMobileContextMenu(),n=M.useRef(null),{mode:l="manga.page",chapter:o,showChapterNumber:c,onSelect:I,selected:m,selectable:w=!0,isActiveChapter:b=!1}=e,C=m!==null,{isDownloaded:D}=o,p=d=>{C&&(d.preventDefault(),d.stopPropagation(),I(o.id,!m,d.shiftKey))},h=(d,i)=>{d.stopPropagation(),d.preventDefault(),i==null||i(d)},g=be((d,{context:i})=>{if(!C&&n.current){h(d,()=>i==null?void 0:i(n.current));return}d.shiftKey=!0,p(d)});return r.jsx(re,{variant:"popover",popupId:"chapter-card-action-menu",children:d=>{var i;return r.jsxs(T,{sx:{pt:1,px:1},children:[r.jsx(Te,{sx:{...j(l==="reader"&&b,{backgroundColor:"primary.main"})},children:r.jsx(_e,{component:oe,to:u.getReaderUrl(o),onContextMenu:s,sx:U.preventMobileContextMenuSx(),style:{color:a.palette.text[o.isRead?"disabled":"primary"]},state:u.getReaderOpenChapterLocationState(o,!0),replace:l==="reader",onClick:x=>p(x),...g(d.open),children:r.jsxs(Ae,{children:[r.jsx(fe,{title:c?"".concat(t("chapter.title_one")," ").concat(o.chapterNumber):o.name,secondaryText:o.scanlator,ternaryText:"".concat(se(Number((i=o.uploadDate)!=null?i:0),!0)).concat(D?" â€¢ ".concat(t("chapter.status.label.downloaded")):""),infoIcons:o.isBookmarked&&r.jsx(We,{color:l==="reader"&&b?"secondary":"primary"}),slotProps:{title:{variant:"h6",component:"h3",sx:j(l==="reader"&&b,{color:a.palette.primary.contrastText})},secondaryText:{sx:j(l==="reader"&&b,{color:a.palette.primary.contrastText})},ternaryText:{sx:j(l==="reader"&&b,{color:a.palette.primary.contrastText})}}}),r.jsx(Me,{chapterId:o.id,color:l==="reader"&&b?a.palette.primary.contrastText:void 0}),r.jsx(T,{sx:{minHeight:"48px"},children:m===null?r.jsx(H,{title:t("global.button.options"),children:r.jsx(ne,{ref:n,...De.preventRippleProp(le(d),{onClick:x=>h(x)}),"aria-label":"more",sx:{color:"inherit",...j(l==="reader"&&b,{color:"primary.contrastText"})},children:r.jsx(ge,{})})}):r.jsx(H,{title:t(m?"global.button.deselect":"global.button.select"),children:r.jsx(ye,{checked:m})})})]})})}),!C&&d.isOpen&&r.jsx(Ce,{...ce(d),children:x=>r.jsx(qe,{onClose:x,chapter:o,handleSelection:()=>I(o.id,!0),canBeDownloaded:u.isDownloadable(o),selectable:w})})]})}})}),Qe=({missingChaptersGap:e})=>{const{t}=B();return r.jsxs(T,{sx:{width:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",p:2,pt:3.5,pb:2.5},children:[r.jsx(z,{sx:{flexGrow:1,border:"1px solid",borderColor:a=>a.palette.text.secondary}}),r.jsx(de,{sx:{px:2},variant:"body2",color:"textSecondary",children:t("chapter.missing",{count:e})}),r.jsx(z,{sx:{flexGrow:1,border:"1px solid",borderColor:a=>a.palette.text.secondary}})]})},pt=({index:e,isSortDesc:t,chapters:a,...s})=>{var m;const n=t?e+1:e-1,l=a[e],o=(m=a[n])!=null?m:{chapterNumber:0},c=u.getGap(l,o),I=c>0;return r.jsxs(T,{sx:j(!t,{flexDirection:"column-reverse"}),children:[r.jsx(Je,{...s,chapter:a[e]}),I&&r.jsx(Qe,{missingChaptersGap:c})]})},ht=M.forwardRef(({children:e,...t},a)=>r.jsx(ie,{ref:a,...t,sx:{minWidth:"unset",px:"10px",...t.sx},children:e}));export{We as B,pt as C,$e as L,mt as a,qe as b,ht as c,Ue as d,dt as f,it as i,ut as u};
