import{c as te,j as e,u as A,a as Me,S as b,A as P,L as F,r as w,b as q,T as C,l as Ce,B,C as M,I as U,d as Ue,m as N,g as O,e as ne,f as d,D as Re,h as Pe,i as se,k as G,t as H,n as he,o as Be,p as Ge,q as $e,s as De,v as Fe,w as ze,x as He,y as Ee,z as Te,E as Le,F as ve,G as Ve,H as xe,J as Ke,K as Xe,M as qe,N as We,O as ge,P as fe,Q as Qe,R as y}from"./index-D9MaEs9E.js";import{P as Je}from"./PushPin-2rM72GAC.js";import{P as Ze}from"./PushPinOutlined-H2AfcKxX.js";import{SourceContentType as Se}from"./SourceMangas-D-eDRQbH.js";import{M as ee}from"./MUI.util-CEodEA2f.js";import{L as re}from"./ListCardAvatar-CmHHq0H2.js";import{L as oe}from"./ListCardContent-VY20TdSy.js";import{C as ae}from"./Card-BkTqqInW.js";import{C as ie}from"./CardActionArea-DI4PBFTF.js";import{E as X}from"./EmptyViewAbsoluteCentered-DZ6ABKnL.js";import{i as Ye,t as W,g as V,I as et,a as tt,E as Ie,b as D,c as nt,u as st,d as rt,e as ot,f as at,h as it,j as ct,k as lt}from"./Extensions.utils-llNB6Kzt.js";import{u as we}from"./useAppAction-CyIRREiS.js";import{S as Ae,a as ye}from"./StyledGroupHeader-86g94ZAE.js";import{V as Ne}from"./Virtuoso.util-BOZwCiso.js";import{S as ce}from"./StyledGroupItemWrapper-t9PG95li.js";import{S as ut}from"./SourceLanguageSelect-DmwArmPp.js";import{f as dt}from"./file-selector-DlHkLoY8.js";import{A as pt}from"./Add-8vmo_q6k.js";import{A as mt}from"./AppbarSearch-DBaVx0ex.js";import{F as ht}from"./FilterList-DYAetFuN.js";import{q as xt}from"./index-DT9vT6J8.js";import{S as gt}from"./Switch-C_LLL2ut.js";import{u as je}from"./use-window-event-NrBAkPGc.js";import{T as Y,a as K}from"./Tabs-dHYxHhmy.js";import{T as ft}from"./TabsWrapper-DILhT4HB.js";import{T as St}from"./TabsMenu-DqvKxPYc.js";import{A as jt,a as _t}from"./SortRadioInput-CJOIN2bN.js";import{C as Ct}from"./Chip-CkZ8dTf0.js";import{u as Et}from"./useAppTitle-DsOircGX.js";import{G as Tt}from"./Virtuoso.constants-DKNufsdf.js";import"./IconWebView-BkR3UiGl.js";import"./GridLayouts-DoC6e5OA.js";import"./Checkbox-sW0kFAdU.js";import"./SwitchBase-nztycCAa.js";import"./ListPreference-DJ2Tl2lw.js";import"./FormGroup-CPm-PM5l.js";import"./Delete-DcAVwVLw.js";import"./CheckboxInput-CN8yRAfa.js";import"./ExpandMore-FmbI0No1.js";import"./useDebounce-C3vkijBe.js";import"./ThreeStateCheckboxInput-CGb6o9X6.js";import"./StyledFab-C4ciB2K2.js";import"./BaseMangaGrid-CelfXX5j.js";import"./MangaGrid-iLLTn8BK.js";import"./useManageMangaLibraryState-p1G5gb9m.js";import"./Chapters-D9IjxkKV.js";import"./DateHelper-2of1AIhG.js";import"./Asserts-xItX73wb.js";import"./Mangas-CH1hraOn.js";import"./Download-C4ncbRSM.js";import"./ContinueReadingTooltip-Cw8huIaI.js";import"./Trackers-BQ19KlF0.js";import"./AvatarSpinner-Bh-DHeyl.js";import"./SpinnerImage-DJqBBLY8.js";import"./Refresh-B_vyuVi3.js";import"./Image-W15CBo3Q.js";import"./CheckCircle-C2dMJ7Pd.js";import"./Metadata-DlJiNZc3.js";import"./Link-DtJpDXXM.js";import"./NumberSetting-F2HLVNYc.js";import"./Slider-H6t2W6On.js";import"./useMobilePicker-BS4xlOin.js";import"./SelectSetting-Bdx55aWk.js";import"./Select-BXJFXnfm.js";import"./Sync-7cX7FT1P.js";import"./use-merged-ref-B2M-mDG1.js";import"./PlayArrow-DgVVIGk4.js";import"./useAppTitleAndAction-JWtO6kvQ.js";import"./Strings-CAV0u705.js";import"./ListItemAvatar-CdZuhz0c.js";const Lt=te(e.jsx("path",{d:"M19.3 16.9c.4-.7.7-1.5.7-2.4 0-2.5-2-4.5-4.5-4.5S11 12 11 14.5s2 4.5 4.5 4.5c.9 0 1.7-.3 2.4-.7l3.2 3.2 1.4-1.4zm-3.8.1c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5M12 20v2C6.48 22 2 17.52 2 12S6.48 2 12 2c4.84 0 8.87 3.44 9.8 8h-2.07c-.64-2.46-2.4-4.47-4.73-5.41V5c0 1.1-.9 2-2 2h-2v2c0 .55-.45 1-1 1H8v2h2v3H9l-4.79-4.79C4.08 10.79 4 11.38 4 12c0 4.41 3.59 8 8 8"})),vt=l=>{const{i18n:t,_:p}=A(),{source:n,showSourceRepo:m,showLanguage:s}=l,{id:r,name:o,lang:a,iconUrl:x,supportsLatest:_,isNsfw:u,extension:{repo:g}}=n,{isPinned:c}=Me(n),f=b.isLocalSource(n)?t._({id:"LECJgZ"}):o,E=Ue(n,L=>N(t._({id:"cBoXe4"}),"error",O(L)));return e.jsx(ae,{children:e.jsx(ie,{component:F,to:P.sources.childRoutes.browse.path(r),state:{contentType:Se.POPULAR,clearCache:!0},children:e.jsxs(oe,{children:[e.jsx(re,{iconUrl:w.getValidImgUrlFor(x),alt:f,slots:{spinnerImageProps:{ignoreQueue:!0}}}),e.jsxs(q,{sx:{justifyContent:"center",flexGrow:1,flexShrink:1,wordBreak:"break-word"},children:[e.jsx(C,{variant:"h6",component:"h3",children:f}),e.jsxs(C,{variant:"caption",children:[s&&Ce(a),u&&e.jsx(C,{variant:"caption",color:"error",children:" 18+"})]}),m&&e.jsx(C,{variant:"caption",children:g})]}),_&&e.jsx(B,{...ee.preventRippleProp(),variant:"outlined",component:F,to:P.sources.childRoutes.browse.path(r),state:{contentType:Se.LATEST,clearCache:!0},children:t._({id:"wL3cK8"})}),e.jsx(M,{title:c?t._({id:"e6tI/P"}):t._({id:"KofAFL"}),children:e.jsx(U,{...ee.preventRippleProp(),onClick:L=>{L.preventDefault(),E("isPinned",!c)},color:c?"primary":"inherit",children:c?e.jsx(Je,{}):e.jsx(Ze,{})})})]})})})};function _e({tabsMenuHeight:l}){const{i18n:t,_:p}=A(),{languages:n,setLanguages:m}=b.useLanguages(),{settings:{showNsfw:s,lastUsedSourceId:r}}=ne(),{data:o,loading:a,error:x,refetch:_}=w.useGetSourceList({notifyOnNetworkStatusChange:!0}),u=o==null?void 0:o.sources.nodes,g=d.useMemo(()=>b.filter(u!=null?u:[],{showNsfw:s,languages:n,keepLocalSource:!0,enabled:!0}),[u,n]),c=d.useMemo(()=>{const h=b.getLastUsedSource(r,g),S=Object.entries(b.groupByLanguage(g,{withPinnedGroup:!0}));return h?[[Re.LAST_USED_SOURCE,[h]],...S]:S},[g]),f=d.useMemo(()=>b.getLanguages(u!=null?u:[]),[u]),E=d.useMemo(()=>b.areFromMultipleRepos(g),[g]),L=d.useMemo(()=>c.map(([,h])=>h).flat(1),[c]),I=d.useMemo(()=>c.map(h=>h[1].length),[c]),v=Ne.useCreateGroupedComputeItemKey(I,d.useCallback(h=>c[h][0],[c]),d.useCallback((h,S)=>"".concat(c[S][0],"_").concat(L[h].id),[L])),R=Pe();return we(e.jsxs(e.Fragment,{children:[e.jsx(M,{title:t._({id:"kddIOO"}),children:e.jsx(U,{onClick:()=>R(P.sources.childRoutes.searchAll.path()),color:"inherit",children:e.jsx(Lt,{})})}),e.jsx(ut,{selectedLanguages:n,setSelectedLanguages:m,languages:f,sources:u!=null?u:[]})]}),[p,n,f,u]),a?e.jsx(se,{}):x?e.jsx(X,{message:t._({id:"6m5aox"}),messageExtra:O(x),retry:()=>_().catch(G("Sources::refetch"))}):(u==null?void 0:u.length)===0?e.jsx(X,{message:t._({id:"W//hDl"})}):e.jsx(Ae,{persistKey:"sources",heightToSubtract:l,overscan:window.innerHeight*.5,groupCounts:I,computeItemKey:v,groupContent:h=>{const[S]=c[h];return e.jsx(ye,{isFirstItem:!h,children:e.jsx(C,{variant:"h5",component:"h2",children:W(S)})})},itemContent:(h,S)=>{const $=c[S][0],j=L[h];return e.jsx(ce,{children:e.jsx(vt,{source:j,showSourceRepo:E,showLanguage:Ye($)})})}})}function It({selectedLanguages:l,setSelectedLanguages:t,languages:p}){const{i18n:n,_:m}=A(),[s,r]=d.useState(H(l)),[o,a]=d.useState(!1),x=d.useMemo(()=>H([...s.toSorted(he),...p.toSorted(he)]),[p,s]),_=()=>{a(!1),r(H(l))},u=()=>{a(!1),t(H(s))},g=(c,f)=>{r(f?[...s,c]:s.toSpliced(s.indexOf(c),1))};return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:n._({id:"Tz0i8g"}),children:e.jsx(U,{onClick:()=>a(!0),"aria-label":"display more actions",edge:"end",color:"inherit",children:e.jsx(ht,{})})}),e.jsxs(Be,{fullWidth:!0,maxWidth:"xs",open:o,onClose:_,children:[e.jsx(Ge,{children:n._({id:"tEL3Xq"})}),e.jsx($e,{dividers:!0,sx:{padding:0},children:e.jsx(xt,{style:{height:x.length*54,minHeight:"25vh",maxHeight:"50vh"},data:x,increaseViewportBy:400,computeItemKey:c=>x[c],itemContent:(c,f)=>e.jsxs(De,{children:[e.jsx(Fe,{primary:W(f)}),e.jsx(gt,{checked:s.includes(f),onChange:E=>g(f,E.target.checked)})]})})}),e.jsxs(ze,{children:[e.jsx(B,{autoFocus:!0,onClick:_,color:"primary",children:n._({id:"dEgA5A"})}),e.jsx(B,{onClick:u,color:"primary",children:n._({id:"aP3N/0"})})]})]})]})}const wt=({disabled:l,children:t,...p})=>l?t:e.jsx(ie,{component:F,...p,children:t});function At(l){const{i18n:t,_:p}=A(),{extension:{name:n,lang:m,versionName:s,isInstalled:r,hasUpdate:o,isObsolete:a,pkgName:x,iconUrl:_,isNsfw:u,repo:g},handleUpdate:c,showSourceRepo:f,forcedState:E}=l,[L,I]=d.useState(V(r,a,o)),v=E!=null?E:L;d.useEffect(()=>{I(V(r,a,o))},[V(r,a,o)]);const R=async S=>{const $=rt[S],j=nt[S];try{I(j),await st(x,a,S),I($),c()}catch(Q){I(V(r,a,o))}};function h(){switch(v){case D.INSTALL:case D.UPDATE:case D.UNINSTALL:R(v).catch(G("ExtensionCard:handleButtonClick(".concat(v,")")));break;case Ie.OBSOLETE:R(D.UNINSTALL).catch(G("ExtensionCard:handleButtonClick(".concat(v,")")));break}}return e.jsx(ae,{children:e.jsx(wt,{disabled:!r,to:P.extension.childRoutes.info.path(x),children:e.jsxs(oe,{children:[e.jsx(re,{iconUrl:w.getValidImgUrlFor(_),alt:n,slots:{spinnerImageProps:{ignoreQueue:!0}}}),e.jsxs(q,{sx:{justifyContent:"center",flexGrow:1,flexShrink:1,wordBreak:"break-word"},children:[e.jsx(C,{variant:"h6",component:"h3",children:n}),e.jsxs(C,{variant:"caption",children:[r?"".concat(Ce(m)," "):"",s,u&&e.jsx(C,{variant:"caption",color:"error",children:" 18+"})]}),f&&e.jsx(C,{variant:"caption",children:g})]}),r&&e.jsx(M,{title:t._({id:"Tz0i8g"}),children:e.jsx(U,{color:"inherit",...ee.preventRippleProp(),children:e.jsx(He,{})})}),e.jsx(B,{variant:"outlined",sx:{color:v===tt.OBSOLETE?"red":"inherit",flexShrink:0},onClick:S=>{S.preventDefault(),h()},children:t._(et[v])})]})})})}const yt=0,Nt=1,Ot=({groupName:l,isFirstItem:t,groupExtensionIds:p,isUpdateGroup:n,updatingExtensionIds:m,setUpdatingExtensionIds:s,handleExtensionUpdate:r})=>{const{i18n:o,_:a}=A();return e.jsxs(ye,{isFirstItem:t,sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",pr:1},children:[e.jsx(C,{variant:"h5",component:"h2",children:W(l)}),n&&e.jsx(B,{disabled:!!m.length,variant:"contained",onClick:()=>{s(p),w.updateExtensions(p,{update:!0}).response.then(()=>r()).catch(x=>N(Ve.t({...lt[D.UPDATE],values:{count:p.length}}),"error",O(x))).finally(()=>s([]))},children:o._({id:"yRCx2T"})})]},l)};function kt({tabsMenuHeight:l}){var pe,me;const{i18n:t,_:p}=A(),{data:n,loading:m,error:s,refetch:r}=w.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[o,{data:a,loading:x,error:_}]=w.useExtensionListFetch(),{settings:{extensionLanguages:u,showNsfw:g}}=ne(),c=ve(i=>N(t._({id:"cBoXe4"}),"error",O(i))),[f]=Ee(Le.QUERY,Te),[E,L]=d.useState([]),[I,v]=d.useState({}),R=m||x,h=s!=null?s:_,S=!!(n!=null&&n.settings.extensionRepos.length),$=((pe=n==null?void 0:n.settings.extensionRepos.length)!=null?pe:0)>1,j=(me=a==null?void 0:a.fetchExtensions)==null?void 0:me.extensions,Q=d.useMemo(()=>ot(j!=null?j:[]),[j]),le=d.useMemo(()=>at(j!=null?j:[],{selectedLanguages:u,showNsfw:g,query:f}),[j,u,g,f]),k=d.useMemo(()=>it(le),[le]),ue=d.useMemo(()=>k.map(i=>i[Nt].length),[k]),J=d.useMemo(()=>k.map(([,i])=>i).flat(1),[k]),Oe=Ne.useCreateGroupedComputeItemKey(ue,d.useCallback(i=>k[i][yt],[k]),d.useCallback(i=>J[i].pkgName,[J])),Z=d.useCallback(()=>v({}),[]),de=i=>{if(!i.name.toLowerCase().endsWith("apk")){N(t._({id:"f7vOnJ"}),"error");return}N(t._({id:"K04htz"}),"info"),w.installExternalExtension(i).response.then(()=>{Z(),N(t._({id:"LGq1dg"}),"success")}).catch(T=>N(t._({id:"amOoxI"}),"error",O(T)))};return d.useEffect(()=>{o()},[I]),we(e.jsxs(e.Fragment,{children:[e.jsx(mt,{}),e.jsx(M,{title:t._({id:"lpVYKJ"}),children:e.jsx(U,{onClick:()=>{const i=document.createElement("input");i.style.display="none",i.type="file",i.onchange=()=>{var z;const T=(z=i.files)==null?void 0:z[0];T&&de(T)},document.documentElement.appendChild(i),i.click(),document.documentElement.removeChild(i)},color:"inherit",children:e.jsx(pt,{})})}),e.jsx(It,{selectedLanguages:u,setSelectedLanguages:i=>c("extensionLanguages",i),languages:Q})]}),[p,u,Q]),je("drop",async i=>{i.preventDefault();const T=await dt(i);de(T[0])}),je("dragover",i=>{i.preventDefault()}),R?e.jsx(se,{}):h?e.jsx(X,{message:t._({id:"6m5aox"}),messageExtra:O(h),retry:()=>{s&&r().catch(G("Extensions::refetchServerSettings")),_&&o().catch(G("Extensions::refetchExtensions"))}}):!(j!=null&&j.length)&&!S?e.jsxs(q,{sx:{alignItems:"center",justifyContent:"center",rowGap:"10px",paddingTop:"20px"},children:[e.jsx(C,{children:t._({id:"BMwO25"})}),e.jsx(B,{component:F,variant:"contained",to:P.settings.childRoutes.browse.path,children:t._({id:"Tz0i8g"})})]}):e.jsx(Ae,{persistKey:"extensions",heightToSubtract:l,overscan:window.innerHeight*.5,groupCounts:ue,groupContent:i=>{const[T,z]=k[i],ke=T===ct.UPDATE_PENDING;return e.jsx(Ot,{groupName:T,isFirstItem:i===0,groupExtensionIds:z.map(be=>be.pkgName),isUpdateGroup:ke,updatingExtensionIds:E,setUpdatingExtensionIds:L,handleExtensionUpdate:Z})},computeItemKey:Oe,itemContent:i=>{const T=J[i];return e.jsx(ce,{children:e.jsx(At,{extension:T,handleUpdate:Z,showSourceRepo:$,forcedState:E.includes(T.pkgName)?Ie.UPDATING:void 0})})}})}const bt=te(e.jsx("path",{d:"M14.94 4.66h-4.72l2.36-2.36zm-4.69 14.71h4.66l-2.33 2.33zM6.1 6.27 1.6 17.73h1.84l.92-2.45h5.11l.92 2.45h1.84L7.74 6.27zm-1.13 7.37 1.94-5.18 1.94 5.18zm10.76 2.5h6.12v1.59h-8.53v-1.29l5.92-8.56h-5.88v-1.6h8.3v1.26z"})),Mt=te(e.jsx("path",{d:"M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4zm-6 4h-4v-4h4z"})),Ut=({id:l,name:t,lang:p,iconUrl:n,mangaCount:m})=>{const{i18n:s,_:r}=A(),a=Number(l)===0?s._({id:"LECJgZ"}):t;return e.jsx(ae,{children:e.jsx(ie,{component:F,to:P.migrate.path(l),children:e.jsxs(oe,{sx:{justifyContent:"space-between"},children:[e.jsxs(xe,{sx:{display:"flex",gap:1},children:[e.jsx(re,{iconUrl:w.getValidImgUrlFor(n),alt:a,slots:{spinnerImageProps:{ignoreQueue:!0}}}),e.jsxs(xe,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(C,{variant:"h6",component:"h3",children:a}),e.jsx(C,{variant:"caption",sx:{display:"block"},children:W(p)})]})]}),e.jsx(Ct,{sx:{borderRadius:1},size:"small",label:m})]})})})},Rt=(l,{sortBy:t,sortOrder:p})=>{if(!l)return[];const n={};l.forEach(({sourceId:s,source:r})=>{var a;const o=(a=n[s])!=null?a:{id:s,name:s,lang:"unknown",iconUrl:null,mangaCount:0,...r};n[s]={...o,mangaCount:o.mangaCount+1}});const m=Object.values(n).toSorted((s,r)=>{switch(t){case ge.SOURCE_NAME:return s.name.localeCompare(r.name);case ge.MANGA_COUNT:return s.mangaCount-r.mangaCount;default:throw new Error('Unexpected "sortBy" "'.concat(t,'"'))}});switch(p){case fe.ASC:return m;case fe.DESC:return m.toReversed();default:throw new Error('Unexpected "sortOrder" "'.concat(p,'"'))}},Pt=({tabsMenuHeight:l})=>{const{i18n:t,_:p}=A(),{appBarHeight:n}=Ke(),{settings:{migrateSortSettings:m}}=ne(),s=ve(c=>N(t._({id:"cBoXe4"}),"error",O(c))),{sortBy:r,sortOrder:o}=m,{data:a,loading:x,error:_,refetch:u}=w.useGetMigratableSources({notifyOnNetworkStatusChange:!0}),g=d.useMemo(()=>Rt(a==null?void 0:a.mangas.nodes,m),[a==null?void 0:a.mangas.nodes,m]);return x?e.jsx(se,{}):_?e.jsx(X,{message:t._({id:"6m5aox"}),messageExtra:O(_),retry:()=>u().catch(G("Migration::refetch"))}):e.jsxs(e.Fragment,{children:[e.jsxs(q,{sx:{position:"sticky",top:"".concat(n+l,"px"),flexDirection:"row",justifyContent:"end",alignItems:"center",gap:1,p:1,backgroundColor:"background.default",zIndex:1},children:[e.jsx(M,{title:t._(Xe[r]),children:e.jsx(U,{color:"inherit",onClick:()=>s("migrateSortSettings",{sortBy:(r+1)%2,sortOrder:o}),children:r?e.jsx(Mt,{}):e.jsx(bt,{})})}),e.jsx(M,{title:t._(qe[o]),children:e.jsx(U,{color:"inherit",onClick:()=>s("migrateSortSettings",{sortBy:r,sortOrder:(o+1)%2}),children:o?e.jsx(jt,{}):e.jsx(_t,{})})})]}),e.jsx(We,{sx:{p:0},children:g.map(c=>e.jsx(ce,{children:e.jsx(Ut,{...c})},c.id))})]})};function ns(){const{i18n:l,_:t}=A();Et(l._({id:"O2UpM1"}));const p=d.useRef(null),[n,m]=d.useState(0);Qe(p,d.useCallback(()=>m(p.current.offsetHeight),[p.current]));const[s,r]=Ee(Le.TAB,Te,{}),o=s!=null?s:y.SOURCES;return s||r(o,"replaceIn"),e.jsxs(ft,{children:[e.jsxs(St,{ref:p,sx:{zIndex:Tt},variant:"fullWidth",value:o,onChange:(a,x)=>r(x,"replaceIn"),children:[e.jsx(Y,{value:y.SOURCES,sx:{textTransform:"none"},label:l._({id:"wdxz7K"})}),e.jsx(Y,{value:y.EXTENSIONS,sx:{textTransform:"none"},label:l._({id:"V3sher"})}),e.jsx(Y,{value:y.MIGRATE,sx:{textTransform:"none"},label:l._({id:"y5rS9U"})})]}),e.jsx(K,{index:y.SOURCE_DEPRECATED,currentIndex:o,children:e.jsx(_e,{tabsMenuHeight:n})}),e.jsx(K,{index:y.SOURCES,currentIndex:o,children:e.jsx(_e,{tabsMenuHeight:n})}),e.jsx(K,{index:y.EXTENSIONS,currentIndex:o,children:e.jsx(kt,{tabsMenuHeight:n})}),e.jsx(K,{index:y.MIGRATE,currentIndex:o,children:e.jsx(Pt,{tabsMenuHeight:n})})]})}export{ns as Browse};
