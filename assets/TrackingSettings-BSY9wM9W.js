import{$ as A,_ as w,s as M,a2 as I,c as u,a3 as P,a4 as F,bo as U,j as t,a5 as R,a6 as N,u as y,a as b,z as E,aB as $,A as D,V as L,bp as W,J as B,K as O,at as J,au as V,av as q,b as C,n as j,N as z,x as G,E as H,k,h as K,v as T,an as _,aJ as Q,b9 as X}from"./index-CgwpgmzX.js";import{P as Y}from"./PasswordTextField-CvS-Ae0o.js";import{A as Z}from"./Avatar-Gc3ZUICh.js";import{C as ee}from"./Chip-D_giEhEV.js";import{T as te}from"./TextField-2w_Aa973.js";import{S}from"./Switch-BhDopZ0o.js";import"./InputAdornment-COdo-9fV.js";import"./SwitchBase-BWPfpppt.js";function se(e){return A("MuiListItemAvatar",e)}w("MuiListItemAvatar",["root","alignItemsFlexStart"]);const ae=["className"],ne=e=>{const{alignItems:s,classes:n}=e;return N({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},se,n)},re=M("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:n}=e;return[s.root,n.alignItems==="flex-start"&&s.alignItemsFlexStart]}})(({ownerState:e})=>I({minWidth:56,flexShrink:0},e.alignItems==="flex-start"&&{marginTop:8})),ie=u.forwardRef(function(s,n){const i=P({props:s,name:"MuiListItemAvatar"}),{className:m}=i,r=F(i,ae),h=u.useContext(U),o=I({},i,{alignItems:h.alignItems}),l=ne(o);return t.jsx(re,I({className:R(l.root,m),ownerState:o,ref:n},r))}),oe=ie,le=({tracker:e})=>{const{t:s}=y(),[n,{loading:i}]=b.useLoginToTrackerCredentials(),[m]=b.useLogoutFromTracker(),[r,h]=u.useState(""),[o,l]=u.useState(""),g=!e.isLoggedIn&&!!e.authUrl,x=async()=>{try{await m({variables:{trackerId:e.id}})}catch(a){j(s("tracking.action.logout.label.failure",{name:e.name}),"error")}},p=async()=>{if(g){const a={redirectUrl:"".concat(window.location.origin,"/tracker/login/oauth"),clientName:"Suwayomi-WebUI",trackerId:e.id,trackerName:e.name};window.open("".concat(e.authUrl,"&state=").concat(JSON.stringify(a)),"_self");return}try{await n({variables:{input:{trackerId:e.id,username:r,password:o}}})}catch(a){j(s("tracking.action.login.label.failure",{name:e.name}),"error")}},f=a=>{if(!g){a();return}p()};return t.jsx(E,{variant:"popover",popupId:"tracker-dialog",children:a=>t.jsxs(t.Fragment,{children:[t.jsxs($,{...D(a),onClick:()=>f(a.open),onTouchStart:()=>f(a.open),children:[t.jsx(oe,{sx:{paddingRight:"20px"},children:t.jsx(Z,{alt:"".concat(e.name),src:b.getValidImgUrlFor(e.icon),variant:"rounded",sx:{width:64,height:64}})}),t.jsx(L,{primary:e.name}),e.isLoggedIn&&t.jsx(W,{children:t.jsx(ee,{label:s("global.label.logged_in"),color:"success"})})]}),t.jsxs(B,{...O(a),open:(e.isLoggedIn||!e.authUrl)&&a.isOpen,disableRestoreFocus:!0,children:[t.jsx(J,{children:s(e.isLoggedIn?"tracking.settings.dialog.title.log_out":"tracking.settings.dialog.title.log_in",{name:e.name})}),!g&&!e.isLoggedIn&&t.jsxs(V,{children:[t.jsx(te,{autoFocus:!0,margin:"dense",id:"username",name:"username",label:s("global.label.username"),type:"text",fullWidth:!0,variant:"standard",onChange:c=>h(c.target.value)}),t.jsx(Y,{margin:"dense",fullWidth:!0,variant:"standard",onChange:c=>l(c.target.value)})]}),t.jsxs(q,{children:[t.jsx(C,{onClick:a.close,children:s("global.button.cancel")}),t.jsx(C,{variant:"contained",disabled:!g&&!e.isLoggedIn&&(i||!r.length||!o.length),onClick:()=>e.isLoggedIn?x():p(),children:s(e.isLoggedIn?"global.button.log_out":"global.button.log_in")})]})]})]})})},fe=()=>{var v;const{t:e}=y(),{setTitle:s}=u.useContext(z);u.useEffect(()=>{s(e("tracking.settings.title.settings"))},[e]);const{settings:{updateProgressAfterReading:n,updateProgressManualMarkRead:i},loading:m,request:{error:r,refetch:h}}=G(),o=X(()=>j(e("global.error.label.failed_to_save_changes"),"error")),{data:l,loading:g,error:x,refetch:p}=b.useGetTrackerList({notifyOnNetworkStatusChange:!0}),f=(v=l==null?void 0:l.trackers.nodes)!=null?v:[],a=m||g,c=r!=null?r:x;return c?t.jsx(H,{message:e("global.error.label.failed_to_load_data"),messageExtra:c.message,retry:()=>{r&&h().catch(k()),x&&p().catch(k())}}):a?t.jsx(K,{}):t.jsxs(t.Fragment,{children:[t.jsxs(T,{children:[t.jsxs(_,{children:[t.jsx(L,{primary:e("tracking.settings.label.update_progress_reading")}),t.jsx(S,{edge:"end",checked:n,onChange:d=>o("updateProgressAfterReading",d.target.checked)})]}),t.jsxs(_,{children:[t.jsx(L,{primary:e("tracking.settings.label.update_progress_manual"),secondary:e("tracking.settings.label.update_progress_reading_description")}),t.jsx(S,{edge:"end",checked:i,onChange:d=>o("updateProgressManualMarkRead",d.target.checked)})]})]}),t.jsx(T,{subheader:t.jsx(Q,{component:"div",id:"tracking-trackers",children:e("tracking.settings.title.trackers")}),children:f.map(d=>t.jsx(le,{tracker:d},d.id))})]})};export{fe as TrackingSettings};
