import{c as A,j as e,f as j,u as E,aX as _,r as s,m as R,g as w,k as Q,H as k,A as $,L as F,I as C,C as S,ci as u,i as U}from"./index-ChwTeEsl.js";import{P as W}from"./PlayArrow-CYNznFls.js";import{D as G,a as N,b as X,c as J,S as Y,v as Z,d as ee,e as te}from"./DragHandle-CDoxx6PO.js";import{E as b}from"./EmptyViewAbsoluteCentered-4lF644jt.js";import{D as re}from"./Delete-C5iuW7Iy.js";import{C as oe}from"./ChapterDownloadRetryButton-Banvwp-E.js";import{C as se,D as ne}from"./ChapterCardMetadata-8Ule_n4A.js";import{M as P}from"./MUI.util-CEodEA2f.js";import{L as ae}from"./ListCardContent-GlBMZ9iP.js";import{C as ie}from"./Card-CECL5VZ1.js";import{C as de}from"./CardActionArea-PScuToxd.js";import{u as ce}from"./useAppTitle-xKXAeTff.js";import{u as le}from"./useAppAction-BfTie6Y0.js";import{V as pe}from"./VirtuosoPersisted-Dpy7ZtX6.js";import{u as ue}from"./use-window-event-CryiE2c1.js";import"./Refresh-Dbei6tGH.js";import"./Chapters-BwBqMYka.js";import"./DateHelper-DvpN-8Cc.js";import"./Asserts-xItX73wb.js";import"./index-CdVEoZjK.js";import"./Virtuoso.util-BDhKlK0O.js";import"./use-merged-ref-INOskFtG.js";const me=A(e.jsx("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"})),he=A(e.jsx("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3zM14 5h-3l-1-1H6L5 5H2v2h12z"})),z=j.memo(({item:r,status:D})=>{const{i18n:m,_:I}=E(),l=_.usePreventMobileContextMenu(),f=j.useCallback(async n=>{const h=D===u.Started;try{h&&await s.stopDownloads().response,await Promise.all([s.removeChapterFromDownloadQueue(n.id).response,s.deleteDownloadedChapter(n.id).response])}catch(a){R(m._({id:"z+YWqr"}),"error",w(a))}h&&s.startDownloads().response.catch(Q("DownloadQueue::startDownloads"))},[D]);return e.jsx(k,{sx:{p:1,pb:0},children:e.jsx(ie,{children:e.jsx(de,{component:F,to:$.manga.path(r.manga.id),onContextMenu:l,sx:_.preventMobileContextMenuSx(),children:e.jsxs(ae,{children:[e.jsx(C,{...P.preventRippleProp(),sx:{pointerEvents:"none"},children:e.jsx(G,{})}),e.jsx(se,{title:r.manga.title,secondaryText:r.chapter.name}),e.jsx(ne,{chapterId:r.chapter.id}),e.jsx(oe,{chapterId:r.chapter.id}),e.jsx(S,{title:m._({id:"cnGeoo"}),children:e.jsx(C,{...P.preventRippleProp(),onClick:n=>{n.preventDefault(),n.stopPropagation(),f(r.chapter)},children:e.jsx(re,{})})})]})})})})}),He=()=>{var y,M;const{i18n:r,_:D}=E();ce(r._({id:"hzCv/5"}));const[m,{reset:I}]=s.useReorderChapterInDownloadQueue(),{data:l,loading:f,error:n,refetch:h}=s.useGetDownloadStatus({notifyOnNetworkStatusChange:!0}),a=l==null?void 0:l.downloadStatus,o=(y=a==null?void 0:a.queue)!=null?y:[],c=(M=a==null?void 0:a.state)!=null?M:u.Started,x=!o.length,L=j.useMemo(()=>o.map(t=>t.chapter),[o]),H=N.useSensorsForDevice(),[p,g]=j.useState(null),q=async()=>{try{await s.clearDownloads().response}catch(t){R(r._({id:"ONqnwn"}),"error",w(t))}},V=()=>{c===u.Stopped?s.startDownloads():s.stopDownloads()},O=(t,i,d)=>{i!==d&&m({variables:{input:{chapterId:t[i].chapter.id,to:d}}}).catch(()=>{I()})},B=t=>{const{active:i,over:d}=t;if(g(null),!d||i.id===d.id)return;const K=o.findIndex(v=>v.chapter.id===i.id),T=o.findIndex(v=>v.chapter.id===d.id);O(o,K,T)};return le(e.jsxs(e.Fragment,{children:[e.jsx(S,{title:r._({id:"MzJlgs"}),children:e.jsx(C,{onClick:q,color:"inherit",children:e.jsx(he,{})})}),e.jsx(S,{title:c===u.Started?r._({id:"ygCKqB"}):r._({id:"tXkhj/"}),disabled:x,children:e.jsx(C,{onClick:V,disabled:x,color:"inherit",children:c===u.Stopped?e.jsx(W,{}):e.jsx(me,{})})})]}),[c,x]),ue("error",t=>{(t.message==="ResizeObserver loop completed with undelivered notifications."||t.message==="ResizeObserver loop limit exceeded")&&t.stopImmediatePropagation()}),f?e.jsx(U,{}):n?e.jsx(b,{message:r._({id:"6m5aox"}),messageExtra:w(n),retry:()=>h().catch(Q("DownloadQueue::refetch"))}):x?e.jsx(b,{message:r._({id:"276+P9"})}):e.jsx(k,{sx:{pb:1},children:e.jsxs(X,{sensors:H,collisionDetection:J,onDragStart:t=>{var i;return g((i=o.find(d=>d.chapter.id===t.active.id))!=null?i:null)},onDragEnd:B,onDragCancel:()=>g(null),onDragAbort:()=>g(null),children:[e.jsx(Y,{items:L,strategy:Z,children:e.jsx(pe,{persistKey:"download-queue",useWindowScroll:!0,overscan:window.innerHeight*.5,totalCount:o.length,computeItemKey:t=>o[t].chapter.id,itemContent:t=>e.jsx(ee,{id:o[t].chapter.id,isDragging:o[t].chapter.id===(p==null?void 0:p.chapter.id),children:e.jsx(z,{item:o[t],status:c})})})}),e.jsx(te,{isActive:!!p,children:e.jsx(z,{item:p,status:c})})]})})};export{He as DownloadQueue};
