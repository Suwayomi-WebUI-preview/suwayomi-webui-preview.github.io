import{cB as bs,b as d,cC as gt,cD as He,cw as A,j as s,i as Ht,am as m,n as Vt,cE as qs,cF as F,cG as et,x as $e,cH as wt,cI as we,cJ as ye,cK as Js,cL as at,cM as Wt,S as _,w as X,T as qe,aP as Qs,cN as er,aR as tr,c7 as yt,$ as ze,a9 as zt,cO as Re,C as z,cP as Es,cQ as ce,H as Xe,cR as V,bH as ie,cS as Te,cT as sr,a as rr,cl as nr,cU as or,cV as ar,cW as ir,cm as cr,ad as tt,cX as qt,aS as Je,cY as Jt,cZ as Ts,bL as ut,A as Xt,L as Ot,c as be,u as U,bU as js,c_ as Cs,ar as Rt,a1 as bt,a2 as Et,bW as lr,ai as dr,B as Qe,c$ as ur,d0 as Qt,d1 as ws,d2 as Ft,d3 as Os,d4 as gr,d5 as hr,d6 as es,d7 as Ls,d8 as ht,d9 as _e,da as ot,db as ke,s as As,I as ne,a0 as Ge,dc as Ut,dd as Ne,de as Ds,bV as fr,ay as xr,b9 as pr,e as Lt,aI as mr,df as Yt,a5 as vr,a6 as Sr,m as Is,dg as dt,dh as At,ac as ts,di as Dt,dj as Rr,dk as kt,dl as br,dm as Tt,dn as Er,dp as Bs,be as Tr,dq as je,a_ as Pe,dr as jr,ds as Ce,dt as Me,du as Cr,dv as Ps,dw as wr,dx as Or,r as Gt,dy as pt,dz as Lr,dA as Ar,f as vt,dB as Dr,dC as Ir,g as _s,dD as ys,dE as ks,dF as Br,dG as Pr,au as Ns,dH as ss,a7 as rs,dI as _r,dJ as yr,dK as lt,dL as Q,dM as ns,dN as os,bc as kr,dO as St,dP as Nr,dQ as Mr,dR as as,dS as Hr,dT as Vr,d as Wr,dU as Fr,dV as Ur,at as Gr,dW as $r,dX as zr,dY as Xr}from"./index-gafTBFZT.js";import{R as Yr,S as Kr,D as Zr,a as qr,b as Jr,c as Qr}from"./ReaderSettingsTabs-Eb8oR9t5.js";import{P as en}from"./PushPin-CLKWAvhH.js";import{P as tn}from"./PushPinOutlined-BpRMnF42.js";import{L as $t}from"./Link-yNLL2nza.js";import{S as Ms}from"./Select-BCWUHuGY.js";import{c as Hs,C as sn,B as rn,d as nn,u as on}from"./CustomButtonIcon-BZWgfIlS.js";import{a as Vs,I as Ws,T as an}from"./TextField-CPbEoHsy.js";import{K as cn}from"./index-M5sJqsaF.js";import{I as ln}from"./InputAdornment-D00pHji9.js";import{O as dn}from"./OpenInNew-BNpVaPig.js";import{D as un}from"./Download-DrhLK7kJ.js";import{D as gn}from"./Delete-BEKGxRjZ.js";import{D as hn}from"./ChapterCardMetadata-C8pnqaE2.js";import{F as fn}from"./Favorite-Pj42ICFV.js";import{a as xn,F as pn,g as mn}from"./useManageMangaLibraryState-BGSv7eDD.js";import{C as vn}from"./CheckboxInput-CD_WlyGm.js";import{E as jt}from"./EmptyViewAbsoluteCentered-CvE-R_GW.js";import{u as Sn}from"./use-window-event-DV95mhGk.js";import{u as Rn}from"./use-merged-ref-C3e8WZ4P.js";import{u as bn}from"./useAppTitle-J5NUdkCY.js";import"./TabsMenu-DmdOOK88.js";import"./Tabs-BCbsCp2O.js";import"./Trans-DRpkwHbC.js";import"./Slider-CAov3hG7.js";import"./ListSubheader-Bx1HiPGt.js";import"./Add-BcJk3PCu.js";import"./DoneAll-BicvRb2H.js";import"./MUI.util-CYBuX_Wz.js";import"./ListCardContent-DfHLt-IH.js";import"./Card-BbdyaTwM.js";import"./CardActionArea-5PDZIBDt.js";import"./Checkbox-D_4xbzUF.js";import"./formControlState-Dq1zat_P.js";import"./useFormControl-TtOG3-00.js";import"./SwitchBase-Br6YjH8f.js";import"./ThreeStateCheckboxInput-pkR6wMgV.js";import"./FormGroup-DRqNz0VH.js";const En=e=>{const{activeScopes:r,enableScope:n,disableScope:o}=bs(),t=d.useRef([]);d.useEffect(()=>e?(t.current=[...r],n(gt.NONE),t.current.forEach(o),()=>{o(gt.NONE),t.current.forEach(n)}):()=>{},[e])},Tn=({isOpen:e,close:r})=>{const{manga:n}=He(),o=A.useSettings();En(e);const[t,a]=d.useState(0),[l,c]=d.useState(!1);return!n||!e?null:s.jsx(Ht,{open:e,maxWidth:"md",fullWidth:!0,onClose:r,hideBackdrop:t===qs.FILTER,sx:{...m(l,{opacity:.75})},children:s.jsx(Vt,{sx:{p:0},children:s.jsx(Yr,{activeTab:t,setActiveTab:a,settings:o,updateSetting:(...i)=>A.updateSetting(n,...i),deleteSetting:(...i)=>A.deleteSetting(n,...i),setTransparent:c})})})},jn=({isDesktop:e,scrollbarXSize:r,readerNavBarWidth:n,isMaximized:o,currentPageIndex:t,pages:a,totalPages:l,progressBarType:c,shouldShowPageNumber:i,readingDirection:f})=>{const u=d.useMemo(()=>{const h=ye(t,a).name,g="/",p="".concat(h).concat(g).concat(l);return f===at.LTR?p:Js(p,g)},[t,a,l,f]);return!i||o||e&&c===Wt.STANDARD||o&&c===Wt.HIDDEN?null:s.jsx(_,{sx:{position:"fixed",left:n,right:0,bottom:h=>"max(calc(".concat(h.spacing(1)," + ").concat(r,"px), env(safe-area-inset-bottom))"),alignItems:"center",transition:h=>"left 0.".concat(h.transitions.duration.shortest,"s")},children:s.jsx(X,{sx:{p:.5,borderRadius:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:s.jsx(qe,{sx:{color:"white"},children:u})})})},Cn=F(jn,[A.useOverlayMode,et,$e,wt,we,A.useSettingsWithoutDefaultFlag],["isDesktop","scrollbarXSize","readerNavBarWidth","isMaximized","currentPageIndex","pages","totalPages","progressBarType","shouldShowPageNumber","readingDirection"]);function is(e){return e.substring(2).toLowerCase()}function wn(e,r){return r.documentElement.clientWidth<e.clientX||r.documentElement.clientHeight<e.clientY}function On(e){const{children:r,disableReactTree:n=!1,mouseEvent:o="onClick",onClickAway:t,touchEvent:a="onTouchEnd"}=e,l=d.useRef(!1),c=d.useRef(null),i=d.useRef(!1),f=d.useRef(!1);d.useEffect(()=>(setTimeout(()=>{i.current=!0},0),()=>{i.current=!1}),[]);const u=Qs(er(r),c),h=tr(x=>{const v=f.current;f.current=!1;const R=yt(c.current);if(!i.current||!c.current||"clientX"in x&&wn(x,R))return;if(l.current){l.current=!1;return}let C;x.composedPath?C=x.composedPath().includes(c.current):C=!R.documentElement.contains(x.target)||c.current.contains(x.target),!C&&(n||!v)&&t(x)}),g=x=>v=>{f.current=!0;const R=r.props[x];R&&R(v)},p={ref:u};return a!==!1&&(p[a]=g(a)),d.useEffect(()=>{if(a!==!1){const x=is(a),v=yt(c.current),R=()=>{l.current=!0};return v.addEventListener(x,h),v.addEventListener("touchmove",R),()=>{v.removeEventListener(x,h),v.removeEventListener("touchmove",R)}}},[h,a]),o!==!1&&(p[o]=g(o)),d.useEffect(()=>{if(o!==!1){const x=is(o),v=yt(c.current);return v.addEventListener(x,h),()=>{v.removeEventListener(x,h)}}},[h,o]),d.cloneElement(r,p)}const cs=ze(qe)({boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",textAlign:"center",userSelect:"none",cursor:"pointer"}),Ln=ze(_,{shouldForwardProp:zt(["progressBarPosition"])})(({theme:e,progressBarPosition:r})=>({position:"fixed",pointerEvents:"all",touchAction:"none",...m(Re(r).isHorizontal,{justifyContent:"flex-end",bottom:0,right:0}),...m(Re(r).isVertical,{top:0,bottom:0}),...m(Re(r).isLeft,{alignItems:e.direction==="ltr"?"flex-start":"flex-end"}),...m(Re(r).isRight,{alignItems:e.direction==="ltr"?"flex-end":"flex-start"})})),An=ze(_)(({theme:e})=>({flexDirection:"row",justifyContent:"center",alignItems:"center",gap:e.spacing(.5)})),Dn=ze(_)({flexDirection:"row",flexGrow:1,overflow:"hidden"}),In=ze(X,{shouldForwardProp:zt(["currentPagesIndex","pagesLength","progressBarPosition"])})(({currentPagesIndex:e,pagesLength:r,progressBarPosition:n})=>({position:"absolute",pointerEvents:"none",...m(Re(n).isHorizontal,{left:0,width:"".concat((e+1)/r*100,"%"),height:"100%"}),...m(Re(n).isVertical,{top:0,width:"100%",height:"".concat((e+1)/r*100,"%")})})),Bn=({pageName:e,currentPagesIndex:r,pagesLength:n,isDragging:o,boxProps:t,children:a,progressBarPosition:l})=>s.jsx(z,{title:e,slotProps:{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}},placement:Es[l],children:s.jsx(X,{...t,sx:{position:"absolute",cursor:o?"grabbing":"grab",...m(Re(l).isHorizontal,{left:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"calc(100% / ".concat(n-1,")"),height:"100%"}),...m(Re(l).isVertical,{top:"".concat(Math.max(0,r-1)/(n-1)*100,"%"),width:"100%",height:"calc(100% / ".concat(n-1,")")}),...t==null?void 0:t.sx},children:a})}),Pn=ze(_)({position:"relative",flexDirection:"row",flexGrow:1}),_n=d.memo(ze(X,{shouldForwardProp:zt(["isFirstPage","isLastPage"])})(({isFirstPage:e,isLastPage:r})=>({flexGrow:1,height:"100%",cursor:"pointer",borderLeftWidth:e?0:void 0,borderRightWidth:r?0:void 0}))),yn=d.memo(({page:e,pagesIndex:r,isCurrentPage:n,isLeadingPage:o,isTrailingPage:t,totalPages:a,showDraggingStyle:l,primaryPageLoadState:c,secondaryPageLoadState:i,createProgressBarSlot:f,...u})=>{const h=d.useMemo(()=>f(e,r,c,i,n,o,t,a,l),[f,e,r,c,i,n,o,t,a,l]);return s.jsx(_n,{...u,isFirstPage:r===0,isLastPage:r===a-1,children:h})}),kn=({totalPages:e,pages:r,pageLoadStates:n,currentPageIndex:o,slotProps:t,slots:a,createProgressBarSlot:l,progressBarPosition:c,readingMode:i,isDragging:f,setIsDragging:u,openPage:h,direction:g,fullSegmentClicks:p})=>{var L,B,P,G,q,k,N,W,y,xe,pe,me,M,K,$,Oe,te,ve,Le,le,de,ue,ge,Z,Ae,he,Ve,De,st,Ie,We,oe;const x=d.useRef(null),v=d.useRef(void 0),[R,C]=d.useState(0),S=d.useRef(null);Xe(S,d.useCallback(()=>{const I=S.current;if(!I)return;const{paddingLeft:Y,paddingRight:Ye}=getComputedStyle(I),Fe=6,J=I.clientWidth-parseFloat(Y)-parseFloat(Ye),Be=i===V.DOUBLE_PAGE?J*2+Fe:J;C(Be)},[i]));const b=d.useMemo(()=>ye(o,r).pagesIndex,[o,r]),w=Re(c).isHorizontal,T=d.useMemo(()=>ye(o,r),[o,r]),E=d.useCallback((...I)=>ie(I[0],I[1],g),[g]);ce.useHandleProgressDragging(h,x,f,T,r,c,E,p);const D=I=>{if(!x.current)return;const Y="touches"in I;h(Te(sr(Y?I.touches[0]:I,x.current,r,w,p,E)),void 0,!1),clearTimeout(v.current),v.current=setTimeout(()=>u(!0),250)},j=()=>{u(!1),clearTimeout(v.current)};return s.jsx(Ln,{...t==null?void 0:t.container,progressBarPosition:c,children:s.jsxs(An,{...t==null?void 0:t.progressBarRoot,children:[s.jsx(cs,{...(L=t==null?void 0:t.progressBarPageTexts)==null?void 0:L.base,...(B=t==null?void 0:t.progressBarPageTexts)==null?void 0:B.current,sx:[{width:"".concat(R,"px")},...Array.isArray((G=(P=t==null?void 0:t.progressBarPageTexts)==null?void 0:P.base)==null?void 0:G.sx)?(N=(k=(q=t==null?void 0:t.progressBarPageTexts)==null?void 0:q.base)==null?void 0:k.sx)!=null?N:[]:[(y=(W=t==null?void 0:t.progressBarPageTexts)==null?void 0:W.base)==null?void 0:y.sx],...Array.isArray((pe=(xe=t==null?void 0:t.progressBarPageTexts)==null?void 0:xe.current)==null?void 0:pe.sx)?(K=(M=(me=t==null?void 0:t.progressBarPageTexts)==null?void 0:me.current)==null?void 0:M.sx)!=null?K:[]:[(Oe=($=t==null?void 0:t.progressBarPageTexts)==null?void 0:$.current)==null?void 0:Oe.sx]],onClick:()=>h("previous","ltr",!1),children:T.name}),s.jsx(On,{onClickAway:()=>u(!1),children:s.jsxs(Pn,{...t==null?void 0:t.progressBarSlotsActionArea,onMouseDown:D,onMouseUp:j,onTouchStart:D,onTouchEnd:j,children:[s.jsxs(Dn,{ref:x,...t==null?void 0:t.progressBarSlotsContainer,children:[r.map((I,Y)=>d.createElement(yn,{...t==null?void 0:t.progressBarSlot,key:I.primary.index,page:I,pagesIndex:Y,isCurrentPage:Y===b,isLeadingPage:Y<b,isTrailingPage:Y>b,totalPages:r.length,primaryPageLoadState:n[I.primary.index].loaded,secondaryPageLoadState:I.secondary?n[I.secondary.index].loaded:void 0,createProgressBarSlot:l,showDraggingStyle:Y===b&&f})),s.jsx(In,{...t==null?void 0:t.progressBarReadPages,currentPagesIndex:T.pagesIndex,pagesLength:r.length,progressBarPosition:c})]}),s.jsx(Bn,{boxProps:t==null?void 0:t.progressBarCurrentPageSlot,pageName:T.name,currentPagesIndex:T.pagesIndex,pagesLength:r.length,isDragging:f,progressBarPosition:c,children:a==null?void 0:a.progressBarCurrentPage})]})}),s.jsx(cs,{ref:S,...(te=t==null?void 0:t.progressBarPageTexts)==null?void 0:te.base,...(ve=t==null?void 0:t.progressBarPageTexts)==null?void 0:ve.total,sx:[{minWidth:"unset"},...Array.isArray((le=(Le=t==null?void 0:t.progressBarPageTexts)==null?void 0:Le.base)==null?void 0:le.sx)?(ge=(ue=(de=t==null?void 0:t.progressBarPageTexts)==null?void 0:de.base)==null?void 0:ue.sx)!=null?ge:[]:[(Ae=(Z=t==null?void 0:t.progressBarPageTexts)==null?void 0:Z.base)==null?void 0:Ae.sx],...Array.isArray((Ve=(he=t==null?void 0:t.progressBarPageTexts)==null?void 0:he.total)==null?void 0:Ve.sx)?(Ie=(st=(De=t==null?void 0:t.progressBarPageTexts)==null?void 0:De.total)==null?void 0:st.sx)!=null?Ie:[]:[(oe=(We=t==null?void 0:t.progressBarPageTexts)==null?void 0:We.total)==null?void 0:oe.sx]],onClick:()=>h("next","ltr",!1),children:e})]})})},Fs=F(d.memo(kn),[wt,()=>({openPage:ce.useOpenPage()}),we,A.useSettingsWithoutDefaultFlag],["isDragging","setIsDragging","openPage","pages","pageLoadStates","totalPages","currentPageIndex","readingMode"]),Nn=d.forwardRef(({direction:e,...r},n)=>{const{settings:{customThemes:o,appTheme:t,themeMode:a,shouldUsePureBlackMode:l}}=rr(),c=d.useMemo(()=>nr(a,or(t,o),l,e),[a,t,o,l,e]);return s.jsx(ar,{value:ir[e],children:s.jsx(cr,{theme:c,children:s.jsx(X,{...r,ref:n,dir:e})})})}),Us=F(Nn,[()=>({direction:A.useGetThemeDirection()})],["direction"]),Gs=d.memo(({pageName:e,progressBarPosition:r,slotProps:n,children:o})=>{var t;return s.jsx(z,{...n==null?void 0:n.tooltip,title:e,placement:Es[r],children:s.jsx(X,{...n==null?void 0:n.box,sx:{width:"100%",height:"100%",...(t=n==null?void 0:n.box)==null?void 0:t.sx},children:o})})}),Mn=d.memo(({pageName:e,primaryPageLoadState:r,secondaryPageLoadState:n,progressBarPosition:o,isCurrentPage:t,isLeadingPage:a,showDraggingStyle:l})=>{const c=tt();return s.jsx(Gs,{pageName:e,progressBarPosition:o,slotProps:{box:{sx:{cursor:"pointer",backgroundColor:qt(c.palette.background.paper,.2),...c.applyStyles("dark",{backgroundColor:Jt(c.palette.background.paper,.1)}),...m(r&&(n==null||n),{backgroundColor:qt(c.palette.background.paper,.35),...c.applyStyles("dark",{backgroundColor:Jt(c.palette.background.paper,.25)})})}},tooltip:{slotProps:t?{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}}:void 0}},children:s.jsx(X,{sx:{width:"100%",height:"100%",...m(a,{backgroundColor:Je(c.palette.primary.main,.5)}),...m(t,{cursor:l?"grabbing":"grab",pointer:"grabbing",borderRadius:2,backgroundColor:"primary.dark",...c.applyStyles("dark",{backgroundColor:"primary.light"})})}})})}),Hn=({readerNavBarWidth:e,isMaximized:r,setIsMaximized:n,isDragging:o,progressBarType:t,progressBarSize:a,progressBarPosition:l,progressBarPositionAutoVertical:c,readerDirection:i,scrollbarXSize:f,scrollbarYSize:u,totalPages:h})=>{const g=tt(),[,p]=d.useState({});Xe(window.document.documentElement,d.useCallback(()=>p({}),[]));const x=Ts(l,c,u,e+f),{isBottom:v,isLeft:R,isRight:C,isVertical:S,isHorizontal:b}=Re(x),w=!!h,T=t===Wt.HIDDEN,E=!r&&!o;return s.jsx(Us,{children:s.jsx(Fs,{direction:b?i:"ltr",progressBarPosition:x,fullSegmentClicks:!0,createProgressBarSlot:d.useCallback((D,j,L,B,P,G,q,k,N)=>s.jsx(Mn,{pageName:D.name,primaryPageLoadState:L,secondaryPageLoadState:B,progressBarPosition:x,isCurrentPage:P,isLeadingPage:G,showDraggingStyle:N}),[x]),slotProps:{container:{sx:{overflow:"hidden",transition:"all 0.".concat(g.transitions.duration.shortest,"s"),...m(b,{minHeight:"100px",...m(g.direction==="ltr",{left:i==="ltr"?e:u,right:i==="rtl"?e:u}),...m(g.direction==="rtl",{left:i==="rtl"?e:u,right:i==="ltr"?e:u})}),...m(S,{minWidth:"100px",bottom:"".concat(f,"px")}),...m(v,{bottom:"".concat(f,"px")}),...m(R,{...m(g.direction==="ltr",{left:i==="ltr"?e:"unset",right:i==="rtl"?e:"unset"}),...m(g.direction==="rtl",{right:i==="rtl"?u:"unset",left:i==="ltr"?u:"unset"})}),...m(C,{...m(g.direction==="ltr",{right:i==="ltr"?u:"unset",left:i==="rtl"?u:"unset"}),...m(g.direction==="rtl",{left:i==="rtl"?e:"unset",right:i==="ltr"?e:"unset"})}),...m(E,{opacity:T?0:.85}),...m(!w,{pointerEvents:"none"})},onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},progressBarRoot:{sx:{gap:0,transition:"all 0.1s ease-in-out",backgroundColor:"background.paper",...m(S,{flexDirection:"column",height:"100%"}),...m(E,{backgroundColor:"unset",pointerEvents:"none",...m(b,{px:2}),...m(S,{py:2}),...m(v,{pb:.25}),...m(R,{...m(g.direction==="ltr",{pl:i==="ltr"?.25:0,pr:i==="rtl"?.25:0}),...m(g.direction==="rtl",{pr:i==="rtl"?.25:0,pl:i==="ltr"?.25:0})}),...m(C,{...m(g.direction==="ltr",{pr:i==="ltr"?.25:0,pl:i==="rtl"?.25:0}),...m(g.direction==="rtl",{pl:i==="rtl"?.25:0,pr:i==="ltr"?.25:0})})})}},progressBarSlotsContainer:{sx:{gap:.25,borderRadius:2,transition:"height 0.1s ease-in-out",...m(b,{height:"20px"}),...m(S,{flexDirection:"column",width:"20px"}),...m(E,{...m(b,{height:"".concat(a,"px")}),...m(S,{width:"".concat(a,"px")})})}},progressBarReadPages:{sx:{display:"none"}},progressBarCurrentPageSlot:{sx:{display:"none"}},progressBarPageTexts:{base:{sx:{px:1,py:1.5,transition:"all 0.1s ease-in-out",...m(E,{transform:"scale(0)",p:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})}}}}})})},Vn=F(d.memo(Hn),[$e,wt,A.useSettingsWithoutDefaultFlag,()=>({readerDirection:A.useGetThemeDirection()}),et,we],["readerNavBarWidth","isMaximized","setIsMaximized","isDragging","progressBarType","progressBarSize","progressBarPosition","progressBarPositionAutoVertical","readerDirection","scrollbarXSize","scrollbarYSize","totalPages"]),Wn=ze(_)({width:"400px",minWidth:"400px",maxWidth:"400px",height:"100vh",overflowY:"auto"}),Fn=d.memo(({mangaId:e,mangaTitle:r,chapterTitle:n,scanlator:o})=>s.jsxs(_,{children:[s.jsx(z,{title:r,placement:"right",children:s.jsx(ut,{lines:3,variant:"h6",component:"h1",sx:{textAlign:"center"},children:s.jsx($t,{component:Ot,to:Xt.manga.path(e),sx:{textDecoration:"none",color:"inherit"},children:r})})}),s.jsx(z,{title:n,placement:"right",children:s.jsx(ut,{lines:4,variant:"body1",component:"h2",sx:{textAlign:"center"},children:n})}),o&&s.jsx(z,{title:o,placement:"right",children:s.jsx(ut,{lines:4,variant:"body2",component:"h3",color:"textDisabled",sx:{textAlign:"center"},children:o})})]})),Un=be(s.jsx("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"})),Gn=be(s.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),Ct=({title:e,type:r,disabled:n,...o})=>s.jsx(z,{title:e,disabled:n,children:s.jsx(Hs,{sx:{flexBasis:"15%"},variant:"contained",disabled:n,...o,children:r==="previous"?s.jsx(Un,{}):s.jsx(Gn,{})})}),$n=({currentPageIndex:e,pages:r,readingDirection:n,openPage:o})=>{const{t}=U(),a=js(),l=d.useMemo(()=>ye(e,r),[e,r]),c=Cs[n];return s.jsxs(_,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(Ct,{type:"previous",title:t(a("reader.button.previous_page","reader.button.next_page",c)),disabled:a(!l.primary.index,Te(l)===Te(r.slice(-1)[0]),c),onClick:()=>o("previous",void 0,!1)}),s.jsxs(Vs,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(Ws,{id:"reader-nav-bar-desktop-page-select",children:t("reader.page_info.label.page")}),s.jsx(Ms,{labelId:"reader-nav-bar-desktop-page-select",label:t("reader.page_info.label.page"),value:Te(l),onChange:i=>o(i.target.value,void 0,!1),children:r.map(i=>s.jsx(Rt,{value:Te(i),children:i.name},Te(i)))})]}),s.jsx(Ct,{type:"next",title:t(a("reader.button.next_page","reader.button.previous_page",c)),disabled:a(Te(l)===Te(r.slice(-1)[0]),!l.primary.index,c),onClick:()=>o("next",void 0,!1)})]})},zn=F(d.memo($n),[we,()=>({openPage:ce.useOpenPage()}),A.useSettingsWithoutDefaultFlag],["currentPageIndex","pages","readingDirection","openPage"]),Xn=()=>{},$s=({currentChapter:e,chapters:r,style:n})=>{const o=d.useMemo(()=>e&&r.findIndex(t=>t.id===e.id),[e,r]);return s.jsx(cn,{style:{height:"calc(".concat(r.length," * 100px)"),...n},initialTopMostItemIndex:o!=null?o:0,totalCount:r.length,computeItemKey:t=>r[t].id,itemContent:t=>s.jsx(sn,{index:t,chapters:r,isSortDesc:!0,mode:"reader",showChapterNumber:!1,selected:null,onSelect:Xn,selectable:!1,isActiveChapter:t===o}),increaseViewportBy:400})},Yn=({currentChapter:e,previousChapter:r,nextChapter:n,chapters:o=[],readerThemeDirection:t,openChapter:a})=>{var i,f;const{t:l}=U(),c=bt({variant:"popover",popupId:"reader-nav-bar-desktop-chapter-list"});return d.useLayoutEffect(()=>{c.close()},[e==null?void 0:e.id]),s.jsxs(_,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[s.jsx(Ct,{type:"previous",title:l(ie("reader.button.previous_chapter","reader.button.next_chapter",t)),onClick:()=>{a(ie("previous","next",t))},disabled:ie(!r,!n,t)}),s.jsxs(Vs,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[s.jsx(Ws,{id:"reader-nav-bar-desktop-chapter-select",children:l("chapter.title_one")}),s.jsx(Ms,{...Et(c),open:c.isOpen,value:(i=e==null?void 0:e.id)!=null?i:0,MenuProps:{sx:{visibility:"hidden"}},label:l("chapter.title_one"),labelId:"reader-nav-bar-desktop-chapter-select",children:s.jsx(Rt,{value:(f=e==null?void 0:e.id)!=null?f:0,children:e?"#".concat(e.chapterNumber," ").concat(e.name):""},e==null?void 0:e.id)})]}),s.jsx(Ct,{component:Ot,type:"next",title:l(ie("reader.button.next_chapter","reader.button.previous_chapter",t)),onClick:()=>{a(ie("next","previous",t))},disabled:ie(!n,!r,t)}),s.jsx(lr,{...dr(c),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:s.jsx(X,{sx:{mb:1},children:s.jsx($s,{style:{width:"500px",maxWidth:"90vw",minHeight:"150px",maxHeight:"300px"},currentChapter:e,chapters:o})})})]})},Kn=F(d.memo(Yn),[()=>({readerThemeDirection:A.useGetThemeDirection()}),()=>({openChapter:ce.useOpenChapter()})],["readerThemeDirection","openChapter"]),Zn=be(s.jsx("path",{d:"M17 4h3c1.1 0 2 .9 2 2v2h-2V6h-3zM4 8V6h3V4H4c-1.1 0-2 .9-2 2v2zm16 8v2h-3v2h3c1.1 0 2-.9 2-2v-2zM7 18H4v-2H2v2c0 1.1.9 2 2 2h3zM18 8H6v8h12z"})),zs=(e,r,n)=>{const t=(e+1)%r.length===0;if(!(n&&t))return r[(e+1)%r.length]},Kt=({tooltip:e,value:r,defaultValue:n,values:o,setValue:t,valueToDisplayData:a,isDefaultable:l,onDefault:c,defaultIcon:i})=>{const{t:f}=U(),u=r===void 0,h=d.useMemo(()=>u?-1:o.indexOf(r),[r,o]);return s.jsx(z,{title:e,children:u?s.jsx(Qe,{onClick:()=>t(o[0]),sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:i,size:"large",children:n===void 0?f("global.label.default"):s.jsx(Kr,{i18nKey:"settings.default_value",value:a[n].isTitleString?a[n].title:f(a[n].title)})}):s.jsx(Qe,{onClick:()=>{const g=zs(h,o,l);if(g===void 0){c==null||c();return}t(g)},sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:a[r].icon,size:"large",children:a[r].isTitleString?a[r].title:f(a[r].title)})})},qn=({pageScaleMode:e,shouldStretchPage:r,updateSetting:n,...o})=>{const{t}=U();return s.jsxs(_,{sx:{flexDirection:"row",gap:1},children:[s.jsx(Kt,{...o,tooltip:t("reader.settings.page_scale.title"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:ws,setValue:a=>n("pageScaleMode",a),valueToDisplayData:Qt,defaultIcon:Qt[e.value].icon}),ur[e.value]&&s.jsx(z,{title:t("reader.settings.page_scale.stretch"),children:s.jsx(Hs,{onClick:()=>n("shouldStretchPage",!r.value),sx:{px:void 0},variant:"contained",color:r.value?"secondary":"primary",children:s.jsx(Zn,{})})})]})},Jn=({readingMode:e,setReadingMode:r,...n})=>{const{t:o}=U();return s.jsx(Kt,{...n,tooltip:o("reader.settings.label.reading_mode"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Os,setValue:r,valueToDisplayData:Ft,defaultIcon:Ft[e.value].icon})},Qn=()=>s.jsx(gr,{children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M2 4h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2m20 0h-6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6M2 12h20m-3-3 3 3-3 3M5 9l-3 3 3 3"})})}),eo=({readingMode:e,shouldOffsetDoubleSpreads:r,setShouldOffsetDoubleSpreads:n})=>{const{t:o}=U();return hr(e)?s.jsx(Qe,{sx:{justifyContent:"start",textTransform:"unset"},size:"large",onClick:()=>n(!r),color:r?"secondary":"primary",variant:"contained",startIcon:s.jsx(Qn,{}),children:o("reader.settings.label.offset_double_spread")}):null},to=({readingDirection:e,setReadingDirection:r,...n})=>{const{t:o}=U();return s.jsx(Kt,{...n,tooltip:o("reader.settings.label.reading_direction"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Ls,setValue:r,valueToDisplayData:es,defaultIcon:es[e.value].icon})},so=be(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 14H9V8h2zm4 0h-2V8h2z"})),ro=be(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 14.5v-9l6 4.5z"})),no=({autoScroll:e,setAutoScroll:r})=>{const{t:n}=U(),{isActive:o,toggleActive:t}=ht(),a=d.useRef(void 0);return s.jsxs(_,{sx:{flexDirection:"row",gap:1},children:[s.jsx(Qe,{sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},size:"large",onClick:t,color:o?"secondary":"primary",variant:"contained",startIcon:o?s.jsx(so,{}):s.jsx(ro,{}),children:n("reader.settings.auto_scroll.title")}),s.jsx(an,{value:e.value,type:"number",size:"small",onBlur:l=>{const c=ot(+l.target.value,_e.min,_e.max);c!==e.value&&(clearTimeout(a.current),r({...e,value:c},!0))},onChange:l=>{const c=ot(+l.target.value,_e.min,_e.max);r({...e,value:c},!1),clearTimeout(a.current),a.current=setTimeout(()=>r({...e,value:c},!0),1e3)},slotProps:{input:{inputProps:_e,endAdornment:s.jsx(ln,{position:"end",children:n("global.time.seconds.second",{count:e.value})})}}})]})},oo=({manga:e,readingMode:r,shouldOffsetDoubleSpreads:n,pageScaleMode:o,shouldStretchPage:t,readingDirection:a,autoScroll:l,openSettings:c})=>{const{t:i}=U(),f=A.useCreateUpdateSetting(e!=null?e:ke),u=A.useCreateDeleteSetting(e!=null?e:ke);return s.jsxs(_,{sx:{gap:1},children:[s.jsx(Jn,{readingMode:r,setReadingMode:h=>f("readingMode",h),isDefaultable:!0,onDefault:()=>u("readingMode")}),s.jsx(eo,{readingMode:r.value,shouldOffsetDoubleSpreads:n.value,setShouldOffsetDoubleSpreads:h=>f("shouldOffsetDoubleSpreads",h)}),s.jsx(qn,{pageScaleMode:o,shouldStretchPage:t,updateSetting:f,isDefaultable:!0,onDefault:()=>u("pageScaleMode")}),s.jsx(to,{readingDirection:a,setReadingDirection:h=>f("readingDirection",h),isDefaultable:!0,onDefault:()=>u("readingDirection")}),s.jsx(no,{autoScroll:l,setAutoScroll:(...h)=>f("autoScroll",...h)}),s.jsx(Qe,{onClick:()=>c(),size:"large",sx:{justifyContent:"start",textTransform:"none"},variant:"contained",startIcon:s.jsx(As,{}),children:i("settings.title")})]})},ao=F(oo,[He,A.useSettings],["manga","readingMode","shouldOffsetDoubleSpreads","pageScaleMode","shouldStretchPage","readingDirection","autoScroll"]),io=be(s.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"})),ls={...ke,title:"Fallback",inLibrary:!1},co=({manga:e})=>{const{inLibrary:r}=e!=null?e:ls,{t:n}=U(),{CategorySelectComponent:o,updateLibraryState:t}=xn(e!=null?e:ls,!0);return s.jsxs(s.Fragment,{children:[s.jsx(z,{title:n(r?"manga.action.library.remove.label.action":"manga.button.add_to_library"),children:s.jsx(ne,{onClick:t,color:"inherit",children:r?s.jsx(fn,{}):s.jsx(pn,{})})}),o]})},Xs=F(d.memo(co),[He],["manga"]),lo=be(s.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),uo=({id:e,isBookmarked:r})=>{const{t:n}=U(),o=r?"unbookmark":"bookmark";return s.jsx(z,{title:n(Ut[o].action.single),children:s.jsx(ne,{onClick:()=>Ge.performAction(o,[e],{}),color:"inherit",children:r?s.jsx(rn,{}):s.jsx(lo,{})})})},Ys=d.memo(uo),go=({currentChapter:e})=>{var o;const{t:r}=U(),n=Ge.useDownloadStatusFromCache((o=e==null?void 0:e.id)!=null?o:-1);return e&&Ge.isDownloaded(e)?s.jsx(z,{title:r(Ut.delete.action.single),children:s.jsx(ne,{onClick:()=>Ge.performAction("delete",[e.id],{}),color:"inherit",children:s.jsx(gn,{})})}):n?s.jsx(hn,{chapterId:n.chapter.id}):s.jsx(z,{title:r(Ut.download.action.single),disabled:!e,children:s.jsx(ne,{disabled:!e,onClick:()=>{var t;return Ge.performAction("download",[(t=e==null?void 0:e.id)!=null?t:-1],{})},color:"inherit",children:s.jsx(un,{})})})},ho=d.memo(({currentChapter:e,pageLoadStates:r,setPageLoadStates:n,setRetryFailedPagesKeyPrefix:o})=>{const{id:t,isBookmarked:a,realUrl:l}=e!=null?e:Ds,{t:c}=U(),i=d.useRef(0),f=d.useMemo(()=>r.some(u=>u.error),[r]);return s.jsxs(_,{sx:{flexDirection:"row",justifyContent:"center",gap:1},children:[s.jsx(Xs,{}),s.jsx(Ys,{id:t,isBookmarked:a}),s.jsx(z,{title:c("reader.button.retry_load_pages"),disabled:!f,children:s.jsx(ne,{onClick:()=>{n(u=>u.map(h=>({url:h.url,loaded:h.loaded}))),o("".concat(i.current)),i.current=(i.current+1)%1e3},disabled:!f,color:"inherit",children:s.jsx(io,{})})}),s.jsx(go,{currentChapter:e}),s.jsx(z,{title:c("chapter.action.label.open_on_source"),disabled:!l,children:s.jsx(ne,{disabled:!l,href:l!=null?l:"",rel:"noreferrer",target:"_blank",color:"inherit",children:s.jsx(dn,{})})})]})}),fo=F(ho,[Ne,we],["currentChapter","pageLoadStates","setPageLoadStates","setRetryFailedPagesKeyPrefix"]),xo=({exit:e})=>{const{t:r}=U(),n=js();return s.jsx(z,{title:r("reader.button.exit"),children:s.jsx(ne,{sx:{marginRight:2},onClick:e,color:"inherit",children:n(s.jsx(fr,{}),s.jsx(xr,{}))})})},Ks=F(d.memo(xo),[()=>({exit:A.useExit()})],["exit"]),po=(e,r)=>{const n=d.useRef(r),o=d.useRef(r);return o.current!==n.current&&!e&&(n.current=!1),o.current!==r&&(n.current=o.current,o.current=r),n.current},mo=({isVisible:e,openSettings:r,setReaderNavBarWidth:n,manga:o,chapters:t,currentChapter:a,previousChapter:l,nextChapter:c,isStaticNav:i})=>{const{t:f}=U(),u=A.useCreateUpdateSetting(o!=null?o:ke),[h,g]=d.useState();Xe(h,d.useCallback(()=>{i&&n(h.offsetWidth)},[h,i])),d.useLayoutEffect(()=>()=>n(0),[]);const v=po(e,i)&&e?0:void 0;return s.jsx(pr,{variant:i?"permanent":"persistent",open:e||i,transitionDuration:v,SlideProps:{unmountOnExit:!0},PaperProps:{ref:R=>g(R)},children:s.jsxs(Wn,{sx:{backgroundColor:"background.paper",pointerEvents:"all"},children:[s.jsxs(_,{sx:{p:2,gap:2,backgroundColor:"action.hover"},children:[s.jsxs(_,{sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(Ks,{}),s.jsx(z,{title:f("reader.settings.label.static_navigation"),children:s.jsx(ne,{onClick:()=>{n(0),u("isStaticNav",!i)},color:i?"primary":"inherit",children:i?s.jsx(en,{}):s.jsx(tn,{})})})]}),o&&a?s.jsxs(s.Fragment,{children:[s.jsx(Fn,{mangaId:o.id,mangaTitle:o.title,chapterTitle:a.name,scanlator:a.scanlator}),s.jsx(fo,{})]}):s.jsx(Lt,{})]}),s.jsxs(_,{sx:{p:2,gap:2},children:[s.jsxs(_,{sx:{gap:1},children:[s.jsx(zn,{}),s.jsx(Kn,{chapters:t,currentChapter:a,nextChapter:c,previousChapter:l})]}),s.jsx(mr,{}),s.jsx(ao,{openSettings:r})]})]})})},vo=F(d.memo(mo),[$e,He,Ne,we,A.useSettingsWithoutDefaultFlag],["setReaderNavBarWidth","manga","chapters","currentChapter","previousChapter","nextChapter","isStaticNav"]),So={...ke,title:""},Ro=d.forwardRef(({isVisible:e,manga:r,currentChapter:n,scrollbarYSize:o},t)=>{const{t:a}=U(),l=bt({popupId:"reader-overlay-more-menu",variant:"popover"}),{id:c,title:i}=r!=null?r:So,{id:f,name:u,realUrl:h,isBookmarked:g}=n!=null?n:Ds;return s.jsx(Yt,{direction:"down",in:e,ref:t,children:s.jsxs(_,{sx:{flexDirection:"row",alignItems:"center",position:"fixed",top:0,left:0,right:"".concat(o,"px"),p:2,pt:p=>"max(env(safe-area-inset-top), ".concat(p.spacing(2),")"),backgroundColor:p=>Je(p.palette.background.paper,.95),pointerEvents:"all",boxShadow:2},children:[s.jsx(Ks,{}),s.jsx(_,{sx:{flexGrow:1},children:r&&n?s.jsxs(s.Fragment,{children:[s.jsx(z,{title:i,children:s.jsx(ut,{lines:1,component:"h1",variant:"h5",children:s.jsx($t,{component:Ot,to:Xt.manga.path(c),sx:{textDecoration:"none",color:"inherit"},children:i})})}),s.jsx(z,{title:u,children:s.jsx(ut,{lines:1,children:u})})]}):s.jsx(Lt,{})}),s.jsx(Xs,{}),s.jsx(Ys,{id:f,isBookmarked:g}),s.jsx(ne,{...Et(l),color:"inherit",children:s.jsx(mn,{})}),s.jsxs(vr,{...Sr(l),children:[s.jsx(Rt,{component:$t,disabled:!h,href:h!=null?h:"",rel:"noreferrer",target:"_blank",children:a("chapter.action.label.open_on_source")}),s.jsx(Rt,{disabled:!h,onClick:async()=>{await navigator.clipboard.writeText(i),Is(a("global.label.copied_clipboard"),"info")},children:a("global.label.share")})]})]})})}),bo=F(d.memo(Ro),[He,Ne,et],["manga","currentChapter","scrollbarYSize"]),Eo=be(s.jsx("path",{d:"m21.81 12.74-.82-.63v-.22l.8-.63c.16-.12.2-.34.1-.51l-.85-1.48c-.07-.13-.21-.2-.35-.2q-.075 0-.15.03l-.95.38c-.08-.05-.11-.07-.19-.11l-.15-1.01c-.03-.21-.2-.36-.4-.36h-1.71c-.2 0-.37.15-.4.34l-.14 1.01c-.03.02-.07.03-.1.05l-.09.06-.95-.38q-.075-.03-.15-.03c-.14 0-.27.07-.35.2l-.85 1.48c-.1.17-.06.39.1.51l.8.63v.23l-.8.63c-.16.12-.2.34-.1.51l.85 1.48c.07.13.21.2.35.2q.075 0 .15-.03l.95-.37c.08.05.12.07.2.11l.15 1.01c.03.2.2.34.4.34h1.71c.2 0 .37-.15.4-.34l.15-1.01c.03-.02.07-.03.1-.05l.09-.06.95.38q.075.03.15.03c.14 0 .27-.07.35-.2l.85-1.48c.1-.17.06-.39-.1-.51M18 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M17 17h2v4c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v4h-2V6H7v12h10z"})),To=be(s.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5M7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"})),ds=be(s.jsx("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})),us=be(s.jsx("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"})),jo={display:"flex",alignItems:"center",justifyContent:"end",position:"relative",backgroundColor:"background.default"},gs="3px",Co=d.memo(({isTrailingPage:e,pagesIndex:r,totalPages:n,isVertical:o,isHorizontal:t})=>{const a="".concat(r/(n-1)*100,"%");return s.jsx(X,{sx:{position:"absolute",...m(o,{top:a,left:"50%"}),...m(t,{top:"50%",left:a}),transform:"translate(-50%, -50%)",width:gs,height:gs,borderRadius:100,backgroundColor:"background.paper",...m(e,{backgroundColor:"primary.main"}),zIndex:1}})}),wo=d.memo(({pageName:e,isTrailingPage:r,isCurrentPage:n,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:l})=>s.jsx(Gs,{pageName:e,progressBarPosition:dt.BOTTOM,slotProps:{box:{sx:jo}},children:!n&&s.jsx(Co,{isTrailingPage:r,pagesIndex:o,totalPages:t,isVertical:a,isHorizontal:l})})),Oo={[dt.BOTTOM]:"up",[dt.LEFT]:"right",[dt.RIGHT]:"left",[dt.AUTO]:"left"},Lo=({previousChapter:e,nextChapter:r,isVisible:n,setIsMaximized:o,isDragging:t,currentPageIndex:a,pages:l,direction:c,progressBarPosition:i,progressBarPositionAutoVertical:f,topOffset:u=0,bottomOffset:h=0,scrollbarXSize:g})=>{const p=ce.useOpenChapter(),[,x]=d.useState({});Xe(window.document.documentElement,d.useCallback(()=>x({}),[]));const v=Ts(i,f,u+h,g),{isLeft:R,isRight:C,isVertical:S,isHorizontal:b}=Re(v),w=b?c:"ltr",T=d.useMemo(()=>ye(a,l).pagesIndex,[a,l]),E=d.useMemo(()=>({container:{sx:{flexGrow:1,position:"relative",display:"flex",justifyItems:"center",alignItems:"stretch",backgroundColor:j=>Je(j.palette.background.paper,.85),borderRadius:100,boxShadow:2}},progressBarRoot:{sx:{flexGrow:1,gap:0,...m(S,{flexDirection:"column"}),...m(b,{alignItems:"stretch"})}},progressBarSlotsActionArea:{sx:{alignItems:"center",cursor:"pointer",...m(S,{width:"100%",flexDirection:"column",px:2}),...m(b,{height:"100%",py:2})}},progressBarSlotsContainer:{sx:{borderRadius:100,backgroundColor:"background.default",...m(S,{flexDirection:"column",py:1}),...m(b,{px:1})}},progressBarSlot:{sx:{...m(S,{width:"20px"}),...m(b,{height:"20px"})}},progressBarCurrentPageSlot:{sx:{display:"flex",zIndex:1,cursor:"inherit",...m(S,{justifyContent:"center"}),...m(b,{alignItems:"center"})}},progressBarPageTexts:{base:{sx:{...m(S,{py:1}),...m(b,{px:1})}}}}),[S,b]),D=d.useMemo(()=>({progressBarCurrentPage:s.jsx(X,{sx:{position:"absolute",...m(S,{top:"calc(100% - 6px)",...m(T===0,{top:"0"}),width:"75%",height:"6px"}),...m(b,{left:"calc(100% - 0px)",...m(T===0,{left:"0"}),width:"6px",height:"75%"}),backgroundColor:"primary.main",borderRadius:100,cursor:t?"grabbing":"grab"}})}),[T,l.length,t,S,b]);return d.useLayoutEffect(()=>(o(n),()=>o(!1)),[n]),s.jsx(Yt,{direction:Oo[v],in:n,children:s.jsx(Us,{sx:{position:"relative",display:"flex",alignItems:"end",height:"100%",pointerEvents:"none",...m(R,{justifyContent:c==="ltr"?"start":"end"}),...m(C,{justifyContent:c==="ltr"?"end":"start"})},children:s.jsxs(_,{sx:{p:2,gap:1,pointerEvents:"all",alignItems:"center",...m(S,{height:"100%",flexDirection:"column"}),...m(b,{width:"100%",flexDirection:"row"})},children:[s.jsx(ne,{onClick:()=>p("previous"),disabled:!e,sx:{backgroundColor:j=>Je(j.palette.background.paper,.85),boxShadow:2},children:ie(s.jsx(ds,{sx:{...m(S,{transform:"rotate(90deg)"})}}),s.jsx(us,{sx:{...m(S,{transform:"rotate(90deg)"})}}),w)}),s.jsx(Fs,{direction:w,progressBarPosition:v,fullSegmentClicks:!1,createProgressBarSlot:d.useCallback((j,L,B,P,G,q,k,N)=>s.jsx(wo,{pageName:j.name,isTrailingPage:k,isCurrentPage:G,pagesIndex:L,totalPages:N,isVertical:S,isHorizontal:b}),[S,b]),slotProps:{...E,progressBarReadPages:{sx:{backgroundColor:"primary.main",...m(S,{width:"20px",height:"".concat(Math.max(0,ye(a,l).pagesIndex)/(l.length-1)*100,"%"),borderRadius:"400px 400px 0 0"}),...m(b,{width:"".concat(Math.max(0,ye(a,l).pagesIndex)/(l.length-1)*100,"%"),height:"20px",borderRadius:"400px 0 0 400px"})}}},slots:D}),s.jsx(ne,{onClick:()=>p("next"),disabled:!r,sx:{backgroundColor:j=>Je(j.palette.background.paper,.85),boxShadow:2},children:ie(s.jsx(us,{sx:{...m(S,{transform:"rotate(90deg)"})}}),s.jsx(ds,{sx:{...m(S,{transform:"rotate(90deg)"})}}),w)})]})})})},Ao=F(d.memo(Lo),[Ne,At,wt,we,()=>({direction:A.useGetThemeDirection()}),A.useSettingsWithoutDefaultFlag,et],["previousChapter","nextChapter","isVisible","setIsMaximized","isDragging","currentPageIndex","pages","direction","progressBarPosition","progressBarPositionAutoVertical","scrollbarXSize"]),Do=({manga:e,readingMode:r,readingDirection:n,autoScroll:o,isActive:t,toggleActive:a})=>{const{t:l}=U(),c=A.useCreateDeleteSetting(e!=null?e:ke);return e?s.jsxs(_,{sx:{gap:2},children:[s.jsx(Zr,{}),s.jsx(qr,{readingMode:r,setReadingMode:i=>A.updateSetting(e,"readingMode",i),isDefaultable:!0,onDefault:()=>c("readingMode")}),s.jsx(Jr,{readingDirection:n,setReadingDirection:i=>A.updateSetting(e,"readingDirection",i),isDefaultable:!0,onDefault:()=>c("readingDirection")}),s.jsx(vn,{label:l("reader.settings.auto_scroll.title"),checked:t,onChange:()=>a()}),s.jsx(Qr,{autoScroll:o,setAutoScroll:(...i)=>A.updateSetting(e,"autoScroll",...i)})]}):null},Io=F(d.memo(Do),[He,A.useSettings,ht],["manga","readingMode","readingDirection","autoScroll","isActive","toggleActive"]),Bo=({openSettings:e,isVisible:r,currentChapter:n,chapters:o,scrollbarXSize:t,scrollbarYSize:a,topOffset:l=0})=>{const{t:c}=U(),i=bt({variant:"dialog",popupId:"reader-chapter-list-dialog"}),f=bt({variant:"dialog",popupId:"reader-quick-settings-dialog"}),[u,h]=d.useState(0),g=d.useRef(null);return Xe(g,d.useCallback(()=>{var p,x;return h((x=(p=g.current)==null?void 0:p.clientHeight)!=null?x:0)},[u])),d.useLayoutEffect(()=>{i.close()},[n==null?void 0:n.id]),s.jsxs(s.Fragment,{children:[s.jsxs(_,{sx:{position:"fixed",right:"".concat(a,"px"),bottom:0,left:0,height:"calc(100% - ".concat(l,"px)")},children:[s.jsx(Ao,{topOffset:l,bottomOffset:u}),s.jsx(Yt,{direction:"up",in:r,children:s.jsx(_,{ref:g,sx:{alignItems:"center",backgroundColor:p=>Je(p.palette.background.paper,.95),pb:"max(".concat(t,"px, env(safe-area-inset-bottom))"),boxShadow:2,pointerEvents:"all"},children:s.jsxs(_,{sx:{width:"50%",flexDirection:"row",p:2,gap:1,justifyContent:"space-evenly",alignItems:"center"},children:[s.jsx(z,{title:c("reader.button.chapter_list"),children:s.jsx(ne,{...Et(i),color:"inherit",children:s.jsx(To,{})})}),s.jsx(z,{title:c("reader.settings.title.quick_settings"),children:s.jsx(ne,{...Et(f),color:"inherit",children:s.jsx(Eo,{})})}),s.jsx(z,{title:c("settings.title"),children:s.jsx(ne,{onClick:e,color:"inherit",children:s.jsx(As,{})})})]})})})]}),i.isOpen&&s.jsx(Ht,{...ts(i),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Vt,{sx:{p:0,pb:1},children:s.jsx($s,{style:{minHeight:"15vh",maxHeight:"75vh"},currentChapter:n,chapters:o})})}),f.isOpen&&s.jsx(Ht,{...ts(f),fullWidth:!0,maxWidth:"md",scroll:"paper",children:s.jsx(Vt,{children:s.jsx(Io,{})})})]})},Po=F(d.memo(Bo),[Ne,et],["currentChapter","chapters","scrollbarXSize","scrollbarYSize"]),_o=({isVisible:e,isDesktop:r,isMobile:n})=>{const[o,t]=d.useState(!1),[a,l]=d.useState(0),c=d.useRef(null);return Xe(c,d.useCallback(()=>{var i,f;return l((f=(i=c.current)==null?void 0:i.clientHeight)!=null?f:0)},[n])),s.jsxs(X,{sx:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none",zIndex:1},children:[r&&s.jsxs(s.Fragment,{children:[s.jsx(Vn,{}),s.jsx(vo,{isVisible:e,openSettings:()=>t(!0)})]}),n&&s.jsxs(s.Fragment,{children:[s.jsx(bo,{ref:c,isVisible:e}),s.jsx(Po,{openSettings:()=>t(!0),isVisible:e,topOffset:a})]}),s.jsx(Tn,{isOpen:o,close:()=>t(!1)}),s.jsx(Cn,{})]})},yo=F(d.memo(_o),[A.useOverlayMode],["isDesktop","isMobile"]),hs="reader-tap-zone-layout-canvas",ko=({readerNavBarWidth:e,showPreview:r,tapZoneLayout:n,tapZoneInvertMode:o,readingDirection:t})=>{const a=tt(),[l,c]=d.useState(0),[i,f]=d.useState(0),[u,h]=d.useState(null);Xe(u,d.useCallback(()=>{var p,x;c((p=u==null?void 0:u.clientWidth)!=null?p:0),f((x=u==null?void 0:u.clientHeight)!=null?x:0)},[u]));const g=Rr.getOrCreateCanvas(n,l,i,a.typography.h3,{vertical:o.vertical,horizontal:o.horizontal,isRTL:t===at.RTL});return d.useLayoutEffect(()=>{const p=document.getElementById(hs);p==null||p.replaceChildren(g)},[g,r]),s.jsx(X,{ref:h,sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none"},children:r&&s.jsx("div",{id:hs})})},No=F(ko,[$e,Dt,A.useSettingsWithoutDefaultFlag],["readerNavBarWidth","showPreview","tapZoneLayout","tapZoneInvertMode","readingDirection"]),Mo=({readerNavBarWidth:e,customFilter:{rgba:{value:{red:r,green:n,blue:o,alpha:t,blendMode:a},enabled:l}}})=>l?s.jsx(X,{sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none",background:"rgba(".concat(r," ").concat(n," ").concat(o," / ").concat(t,"%)"),mixBlendMode:"".concat(a)}}):null,Ho=F(Mo,[$e,A.useSettingsWithoutDefaultFlag],["readerNavBarWidth","customFilter"]),fs=2,xs=1,Ze=0,se=0,re=1,Vo=(e,r=kt.XY)=>{const[n,o]=d.useState(!1),t=d.useRef(void 0),a=d.useRef([0,0,0]),l=d.useRef([0,0,0]),c=d.useRef([0,0,0]),i=d.useRef([0,0]),f=d.useRef(void 0);return d.useEffect(()=>{const u=e==null?void 0:e.current;if(!u)return()=>{};const h=()=>{t.current||(t.current=getComputedStyle(u));const E=t.current.direction==="rtl",D=t.current.flexDirection==="row-reverse";return E||!E&&D},g=()=>(t.current||(t.current=getComputedStyle(u)),t.current.flexDirection==="column-reverse"),p=r!==kt.Y,x=r!==kt.X,v=()=>clearInterval(f.current),R=()=>{const E=(M,K,$)=>(M[Ze]-M[fs])/(K[Ze]-K[fs])*1e3/$,D=[p?E(a.current,c.current,u.clientWidth):0,x?E(l.current,c.current,u.clientHeight):0],j=p&&x?Math.sqrt(D[se]**2+D[re]**2):Math.abs(x?D[re]:D[se]),L=[D[se]/j,D[re]/j],B=ot(1.2*j,-12,12),P=(Date.now()-c.current[Ze])/1e3,G=B-14.278*P+75.24*P**2/B-149.72*P**3/B/B;if(!(B!==0&&G>0&&!Number.isNaN(B))){v();return}const k=(M,K)=>M*K*(B*P-7.1397*P**2+25.08*P**3/B-37.43*P**4/B/B),N=[k(u.clientWidth,L[se]),k(u.clientHeight,L[re])],W=[u.scrollWidth-u.clientWidth,u.scrollHeight-u.clientHeight],y=[ot(i.current[se]-N[se],h()?-W[se]:0,W[se]),ot(i.current[re]-N[re],g()?-W[re]:0,W[re])],xe=y[se]!==0||y[se]!==W[se],pe=y[re]!==0||y[re]!==W[re];xe||pe||v(),p&&(u.scrollLeft=y[se]),x&&(u.scrollTop=y[re])};let C=!1;const S=E=>{if(C)return!0;const D=[u.clientHeight<u.scrollHeight,u.clientWidth<u.scrollWidth],j=[Math.abs(a.current[Ze]-E.pageX)>0,Math.abs(l.current[Ze]-E.pageY)>0];return D[se]&&j[se]||D[re]&&j[re]},b=E=>{S(E)&&(C=!0,o(!0),a.current=[...a.current.slice(1),E.pageX],l.current=[...l.current.slice(1),E.pageY],c.current=[...c.current.slice(1),Date.now()],p&&(u.scrollLeft+=a.current[Ze]-a.current[xs]),x&&(u.scrollTop+=l.current[Ze]-l.current[xs]))},w=()=>{u.removeEventListener("mousemove",b),u.removeEventListener("mouseup",w),setTimeout(()=>{C=!1,o(!1)},0),i.current=[u.scrollLeft,u.scrollTop],f.current=setInterval(R,16)},T=E=>{E.button===0&&(E.preventDefault(),a.current=[E.pageX,E.pageX,E.pageX],l.current=[E.pageY,E.pageY,E.pageY],c.current=[Date.now()-2,Date.now()-1,Date.now()],u.addEventListener("mousemove",b),u.addEventListener("mouseup",w),v())};return u.addEventListener("mousedown",T),u.addEventListener("wheel",v),()=>{u.removeEventListener("mousedown",T),u.removeEventListener("wheel",v),v()}},[e,r]),n},Wo=(e,r)=>{d.useEffect(()=>{if(e){r.pause();return}r.resume()},[e,r.isPaused])},Fo=(e,r,n,o,t)=>{d.useEffect(()=>{var l,c;const a=()=>{e&&r(!1),n&&o(!1)};return(l=t.current)==null||l.addEventListener("wheel",a),(c=t.current)==null||c.addEventListener("touchmove",a),()=>{var i,f;(i=t.current)==null||i.removeEventListener("wheel",a),(f=t.current)==null||f.removeEventListener("touchmove",a)}},[e,n])},Uo=(e,r,n)=>{d.useEffect(()=>{if(e!==V.CONTINUOUS_HORIZONTAL)return()=>{};if(!n.current)return()=>{};let o,t,a;const l=c=>{var h,g;if(a===!0)return;c.preventDefault();const i=!Math.abs(Math.abs(o!=null?o:c.deltaX)-Math.abs(c.deltaX)),f=!Math.abs(Math.abs(t!=null?t:c.deltaY)-Math.abs(c.deltaY));if(o=c.deltaX,t=c.deltaY,a||(a=!i||!f),a!==void 0){if(c.shiftKey){(h=n.current)==null||h.scrollBy({top:c.deltaY});return}(g=n.current)==null||g.scrollBy({left:r===at.LTR?c.deltaY:c.deltaY*-1})}};return n.current.addEventListener("wheel",l),()=>{var c;return(c=n.current)==null?void 0:c.removeEventListener("wheel",l)}},[e,r])},Go=e=>{const r=d.useRef(void 0);d.useEffect(()=>{const n=t=>{const a=e.current;a&&(a.style.cursor=t?"default":"none")},o=()=>{n(!0),clearTimeout(r.current),r.current=setTimeout(()=>{n(!1)},5e3)};return o(),window.addEventListener("mousemove",o),()=>{n(!0),window.removeEventListener("mousemove",o),clearTimeout(r.current)}},[])},$o=(e,r,n,o,t)=>{d.useLayoutEffect(()=>{var a;r||(a=t.current)==null||a.scrollTo(br(t.current,n,o),0)},[e])},zo=(e,r,n,o,t,a,l,c,i,f)=>{d.useLayoutEffect(()=>{if(e==null)return;const u=ye(e,n);if(l){const p=e>r?Tt.PREVIOUS:Tt.NEXT,x=c.current[u.pagesIndex];x==null||x.scrollIntoView({block:"start",inline:Er(p,i,f)})}const h=Te(u),g=h===o-1;t(null),a(h,!g,g)},[e])},Xo=(e,r,n,o,t,a,l)=>{const[c,i]=d.useState(l===V.DOUBLE_PAGE);d.useLayoutEffect(()=>{if(c&&l!==V.DOUBLE_PAGE){i(!1);const h=Bs(n);o(h),t(h.map(({primary:{url:g}})=>({url:g,isSpread:!1})));return}l===V.DOUBLE_PAGE&&(c||a(Te(ye(e,r))),o(r),i(l===V.DOUBLE_PAGE))},[r,l])},Nt=({title:e,name:r,scanlator:n,backgroundColor:o})=>{const t=tt(),a=t.palette.getContrastText(Cr(t.palette,Ps[o])),l=Je(a,.5);return r?s.jsxs(_,{children:[s.jsx(qe,{color:a,children:e}),s.jsx(qe,{color:a,variant:"h6",component:"h1",children:r}),n&&s.jsx(qe,{variant:"body2",color:l,children:n})]}):null},Yo=({type:e,transitionPageMode:r,readingMode:n,backgroundColor:o,shouldShowTransitionPage:t,manga:a,currentChapterName:l,currentChapterScanlator:c,previousChapterName:i,previousChapterScanlator:f,nextChapterName:u,nextChapterScanlator:h,scrollbarXSize:g,scrollbarYSize:p,readerNavBarWidth:x,handleBack:v})=>{var j;const{t:R}=U(),C=e===je.PREVIOUS,S=e===je.NEXT,b=!!l&&!i,w=!!l&&!u,T=b&&e===je.PREVIOUS,E=w&&e===je.NEXT;return!t&&!(T||E)||!jr(e,r,n)?null:s.jsx(_,{sx:{justifyContent:"center",alignItems:"center",...m(!Me(n),{width:"100%",height:"100%"}),...m(Me(n),{position:"sticky",...m(Ce(n),{left:0,maxWidth:"calc(100vw - ".concat(p,"px - ").concat(x,"px)"),minHeight:"calc(100vh - ".concat(g,"px)")}),...m(n===V.CONTINUOUS_HORIZONTAL,{top:0,minWidth:"calc(100vw - ".concat(p,"px - ").concat(x,"px)"),maxHeight:"calc(100vh - ".concat(g,"px)")})})},children:s.jsxs(_,{sx:{gap:2,maxWidth:L=>"calc(100vw - ".concat(p,"px - ").concat(x,"px - ").concat(L.spacing(2),")"),maxHeight:"calc(100vh - ".concat(g,"px)"),width:"max-content",p:1},children:[C&&b&&s.jsx(qe,{variant:"h6",children:R("reader.transition_page.first_chapter")}),s.jsxs(_,{sx:{gap:5},children:[C&&!b&&s.jsx(Nt,{title:R("reader.transition_page.previous"),name:i,scanlator:f,backgroundColor:o}),!!l&&s.jsx(Nt,{title:R(C?"reader.transition_page.current":"reader.transition_page.finished"),name:l,scanlator:c,backgroundColor:o}),S&&!w&&s.jsx(Nt,{title:R("reader.transition_page.next"),name:u,scanlator:h,backgroundColor:o})]}),S&&w&&s.jsx(qe,{variant:"h6",children:R("reader.transition_page.last_chapter")}),(C&&b||S&&w)&&s.jsxs(_,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:[s.jsx(Qe,{sx:{flexGrow:1},onClick:L=>{L.stopPropagation(),v()},variant:"contained",children:R("reader.transition_page.exit.previous_page")}),s.jsx(Qe,{sx:{flexGrow:1},component:Ot,onClick:L=>{L.stopPropagation()},variant:"contained",to:Xt.manga.path((j=a==null?void 0:a.id)!=null?j:-1),children:R("reader.transition_page.exit.manga_page")})]})]})})},ps=F(d.memo(Yo),[He,({chapterId:e})=>{const{chapters:r}=Ne(),n=d.useMemo(()=>r.findIndex(l=>l.id===e),[e,r]),o=r[n],t=d.useMemo(()=>r[n+1],[n,r]),a=d.useMemo(()=>r[n-1],[n,r]);return{currentChapterName:o==null?void 0:o.name,currentChapterScanlator:o==null?void 0:o.scanlator,previousChapterName:t==null?void 0:t.name,previousChapterScanlator:t==null?void 0:t.name,nextChapterName:a==null?void 0:a.name,nextChapterScanlator:a==null?void 0:a.scanlator}},et,$e,we,A.useSettingsWithoutDefaultFlag,({chapterId:e,type:r})=>{const n=Tr(),{chapters:o}=Ne(),t=d.useMemo(()=>o.findIndex(u=>u.id===e),[e,o]),a=t===0,l=t===o.length-1,c=r===je.PREVIOUS&&l,i=r===je.NEXT&&a;return{handleBack:c||i?n:Pe}}],["manga","currentChapterName","currentChapterScanlator","previousChapterName","previousChapterScanlator","nextChapterName","nextChapterScanlator","scrollbarXSize","scrollbarYSize","readerNavBarWidth","backgroundColor","transitionPageMode","readingMode","handleBack","shouldShowTransitionPage"]),Ko=(e,r,n,o,t,a,l,c,i,f,u,h,g,p,x,v,R,C)=>{var b,w;const S=d.useRef(void 0);d.useLayoutEffect(()=>{var B;const T=(B=r.data)==null?void 0:B.fetchChapterPages;if(!T)return;const{pages:E}=T,D=E.length?E:[""],j=wr(n,o!=null?o:0,D.length-1),L=S.current!==(T==null?void 0:T.pages);if(L){S.current=T.pages;const P=Bs(D);i(!0),h(P),g(D),p(P.map(({primary:{url:G}})=>({url:G,loaded:!1}))),x(P.map(({primary:{url:G}})=>({url:G,isSpread:!1})))}else h(t),p(a),x(l);u(T.pages.length),g(D),v(j),R(j),f(P=>({...P,isCurrentChapterReady:c||L})),C(je.NONE)},[(w=(b=r.data)==null?void 0:b.fetchChapterPages)==null?void 0:w.pages,e])},ms=0,mt="-10px",Zo=(e,r,n)=>{if(!Me(r))return;const o=Cs[n],t="0px ".concat(mt," 0px 0px"),a="0px 0px 0px ".concat(mt);return Ce(r)?e==="first"?"0px 0px ".concat(mt," 0px"):"".concat(mt," 0px 0px 0px"):e==="first"?ie(t,a,o):ie(a,t,o)},qo=(e,r,n,o)=>e===at.LTR?{start:n>=o,end:r<0}:{start:r<0,end:n>=o},Jo=(e,{top:r,right:n,bottom:o,left:t},a,l)=>{const c=window.innerWidth-l,i=window.innerHeight-a;return{[V.CONTINUOUS_VERTICAL]:{start:o>=i,end:r<0},[V.CONTINUOUS_HORIZONTAL]:qo(e,t,n,c)}},Qo=({[V.CONTINUOUS_VERTICAL]:e,[V.CONTINUOUS_HORIZONTAL]:r},n)=>Ce(n)?e.start||e.end:r.start||r.end,ea=({[V.CONTINUOUS_VERTICAL]:e,[V.CONTINUOUS_HORIZONTAL]:r},n)=>Ce(n)?e:r,vs=(e,r,n,o,t,a,l,c,i,f,u,h,g,p)=>{d.useEffect(()=>{const x=Me(a),v=Ce(a);if(p||!g||!x||!c||!o||t||n===void 0)return()=>{};const R=()=>{const C=g.scrollLeft===0,S=g.scrollLeft===g.scrollWidth-g.clientWidth,b=g.scrollTop===0,w=g.scrollTop===g.scrollHeight-g.clientHeight;(e==="first"&&(v?b:C)||e==="last"&&(v?w:S))&&i(n,void 0,!1)};return g.addEventListener("scroll",R),()=>g.removeEventListener("scroll",R)},[a,g,p,c,o,t,n,i]),Or(f,d.useCallback(x=>{if(!c||!Me(a)||n===void 0||!p&&!t)return;const v=x[x.length-1],R=Jo(l,v.target.getBoundingClientRect(),u,h),{start:C,end:S}=ea(R,a),b=v.intersectionRatio<=ms;if(!Qo(R,a))return;const w=e==="first"&&C&&!t,T=e==="last"&&!o&&S;if(w||e==="last"&&S&&b){i(n,!t,!1);return}T&&i(r,!1,!1)},[e,r,n,o,t,a,l,c,p,i,u,h]),d.useMemo(()=>({root:g,threshold:[ms],rootMargin:Zo(e,a,l),ignoreInitialObserve:!0}),[e,a,l]))},ta=({readingMode:e,readingDirection:r,shouldUseInfiniteScroll:n,chapterId:o,previousChapterId:t,nextChapterId:a,isPreviousChapterVisible:l,isCurrentChapter:c,isNextChapterVisible:i,imageWrapper:f,openChapter:u,scrollbarXSize:h,scrollbarYSize:g,scrollElement:p,shouldShowTransitionPage:x})=>(vs("first",o,t,c,l,e,r,n,u,f,h,g,p,x),vs("last",o,a,c,i,e,r,n,u,f,h,g,p,x),null),sa=F(d.memo(ta),[()=>({openChapter:ce.useOpenChapter()}),A.useSettingsWithoutDefaultFlag],["openChapter","shouldShowTransitionPage"]),ra=({currentPageIndex:e,setPages:r,setPageLoadStates:n,setTotalPages:o,setCurrentPageIndex:t,updateCurrentPageIndex:a,setPageToScrollToIndex:l,transitionPageMode:c,retryFailedPagesKeyPrefix:i,setTransitionPageMode:f,readingMode:u,readerWidth:h,pageScaleMode:g,shouldOffsetDoubleSpreads:p,readingDirection:x,shouldUseInfiniteScroll:v,imagePreLoadAmount:R,pageGap:C,chapterId:S,previousChapterId:b,nextChapterId:w,isPreviousChapterVisible:T,isNextChapterVisible:E,lastPageRead:D,isInitialChapter:j,isCurrentChapter:L,isPreviousChapter:B,isNextChapter:P,isLeadingChapter:G,isTrailingChapter:q,isPreloadMode:k,imageRefs:N,scrollIntoView:W,setReaderStateChapters:y,resumeMode:xe,customFilter:pe,shouldStretchPage:me,scrollbarXSize:M,scrollbarYSize:K,readerNavBarWidth:$,onSizeChange:Oe,minWidth:te,minHeight:ve,scrollElement:Le})=>{const{t:le}=U(),{direction:de}=tt(),[ue,ge]=Gt.useGetChapterPagesFetch(S!=null?S:-1),[Z,Ae]=d.useState(!1),[he,Ve]=d.useState(pt.totalPages),[De,st]=d.useState(pt.pageUrls),[Ie,We]=d.useState(pt.pages),[oe,I]=d.useState(pt.pageLoadStates),[Y,Ye]=d.useState(oe.map(({url:O})=>({url:O,isSpread:!1}))),Fe=d.useRef(null),J=d.useRef(L),Be=d.useRef(Ie.map(()=>null)),Se=d.useRef(null),H=d.useMemo(()=>!!!he||!(he===Y.length)?Ie:u===V.DOUBLE_PAGE?Lr(De,Y,p,x):Ie,[Y,u,p,x,he]),it=d.useMemo(()=>Ar(u),[u]),rt=x===at.LTR,Ue=Me(u),fe=!Ue&&!L||k,ft=!Ue&&L,It=!fe&&(ft||Ue&&(j||G)),ct=!fe&&(ft||Ue&&(j||q));J.current=L,L&&(N.current=Be.current);const Ke=d.useCallback(()=>{S&&(Ae(!1),ue({variables:{input:{chapterId:S}}}).catch(vt()))},[ue,S]),Bt=d.useMemo(()=>Dr(H,Y,Ye,oe,O=>{J.current&&n(O),I(O)},u),[H,u]),Pt=d.useMemo(()=>Ir(O=>{J.current&&n(O),I(O)}),[]);d.useEffect(()=>{Ke()},[S]),Xe(Fe,d.useCallback(O=>{const{clientWidth:Ee,clientHeight:nt}=O[0].target;Oe(Ee,nt,S)},[Oe,Fe.current,S]));const ae=(O,Ee,nt,xt=!1)=>{(xt||!Z)&&Ee(O),L&&nt(O)};return Ko(L,ge,xe,D,H,oe,Y,Z,Ae,O=>ae(O,Pe,y),O=>ae(O,Ve,o),O=>ae(O,We,r),O=>ae(O,st,Pe),O=>ae(O,I,n),O=>ae(O,Ye,Pe),O=>ae(O,Pe,t),O=>{(j&&!Z||W)&&(l(O),y(Ee=>({...Ee,visibleChapters:{...Ee.visibleChapters,scrollIntoView:!1,resumeMode:void 0}})))},O=>ae(O,Pe,f)),Xo(e,H,De,O=>ae(O,We,r,!0),O=>ae(O,Ye,Pe,!0),O=>ae(O,Pe,a),u),Ue||L||B||P?ge.error?fe?null:s.jsx(X,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center",position:"relative"},children:s.jsx(jt,{message:le("global.error.label.failed_to_load_data"),messageExtra:_s(ge.error),retry:()=>{Ke()}})}):ge.loading||!Z?fe?null:s.jsx(X,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center"},children:s.jsx(Lt,{})}):S!=null&&!he?fe?null:s.jsx(X,{sx:{minWidth:"100%",minHeight:"100%",position:"relative"},children:s.jsx(jt,{message:le("reader.error.label.no_pages_found"),retry:Ke})}):s.jsxs(_,{ref:Fe,sx:{width:"fit-content",height:"fit-content",margin:"auto",flexWrap:"nowrap",...m(u===V.CONTINUOUS_HORIZONTAL,{minHeight:ve}),...m(Ce(u),{minWidth:te}),...m(fe,{maxWidth:0,maxHeight:0,minWidth:"unset",minHeight:"unset",overflow:"hidden",margin:"unset"}),...m(Ce(u)&&ys(h,g),{alignItems:"center"}),...m(u===V.CONTINUOUS_HORIZONTAL,{...m(de==="ltr",{flexDirection:rt?"row":"row-reverse"}),...m(de==="rtl",{flexDirection:rt?"row-reverse":"row"})})},children:[!k&&s.jsx(sa,{readingMode:u,readingDirection:x,shouldUseInfiniteScroll:v,chapterId:S,previousChapterId:b,nextChapterId:w,isCurrentChapter:L,isPreviousChapterVisible:T,isNextChapterVisible:E,imageWrapper:Se.current,scrollbarXSize:M,scrollbarYSize:K,scrollElement:Le}),It&&s.jsx(ps,{chapterId:S,type:je.PREVIOUS}),s.jsx(it,{ref:Se,totalPages:he,currentPageIndex:e,pages:H,transitionPageMode:c,pageLoadStates:oe,retryFailedPagesKeyPrefix:i,imageRefs:Be,onLoad:Bt,onError:Pt,isCurrentChapter:L,isPreviousChapter:B,isNextChapter:P,readingMode:u,imagePreLoadAmount:R,readingDirection:x,pageScaleMode:g,pageGap:C,customFilter:pe,shouldStretchPage:me,readerWidth:h,scrollbarXSize:M,scrollbarYSize:K,readerNavBarWidth:$,isPreloadMode:k,resumeMode:xe,handleAsInitialRender:W}),ct&&s.jsx(ps,{chapterId:S,type:je.NEXT})]}):null},na=d.memo(ra),oa=(e,r,n,o)=>{const t=Br(r),a=Pr(r),l=n!==window.innerWidth,c=o!==window.innerHeight,i=t&&l,f=a&&c;return!Ce(e)&&l?!0:i||f},Ss=(e,r,n)=>{d.useLayoutEffect(()=>{n(r)},[e])},aa=(e,r,n,o)=>{const t=d.useRef({width:window.innerWidth,height:window.innerHeight}),a=d.useCallback(()=>{const{width:l,height:c}=t.current;t.current={width:window.innerWidth,height:window.innerHeight},oa(e,r,l,c)&&n(o)},[e,r,o]);Sn("resize",a)},Zs=e=>{const r=d.useRef({left:0,top:0,visibleElement:void 0,visibleElementLeft:0,visibleElementTop:0});return d.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=()=>{var a,l;const{visibleElement:t}=r.current;r.current={...r.current,left:n.scrollLeft,top:n.scrollTop,visibleElementLeft:(a=t==null?void 0:t.offsetLeft)!=null?a:0,visibleElementTop:(l=t==null?void 0:t.offsetTop)!=null?l:0}};return n.addEventListener("scroll",o),()=>n.removeEventListener("scroll",o)},[]),d.useEffect(()=>{const n=e.current;if(!n)return()=>{};const o=(l,c)=>Array.from(l).filter(i=>i instanceof HTMLElement).flatMap(i=>i instanceof HTMLImageElement?[i]:Array.from(i.querySelectorAll("img"))).forEach(c),t=new IntersectionObserver(l=>{const c=l.find(i=>i.isIntersecting);(c==null?void 0:c.target)instanceof HTMLElement&&(r.current={...r.current,visibleElement:c.target,visibleElementLeft:c.target.offsetLeft,visibleElementTop:c.target.offsetTop})}),a=new MutationObserver(l=>{for(const c of l)o(c.addedNodes,i=>t.observe(i)),o(c.removedNodes,i=>t.unobserve(i))});return a.observe(n,{childList:!0,subtree:!0}),()=>{a.disconnect(),t.disconnect()}},[]),r},ia=(e,r)=>{const n=Zs(e),o=Me(r),t=Ce(r);d.useEffect(()=>{const a=e.current;if(!a||!o)return()=>{};const l=u=>{const{left:h,top:g,visibleElement:p,visibleElementLeft:x,visibleElementTop:v}=n.current;if(!p||!!!u.filter(w=>!(w.target instanceof HTMLElement)||!w.target.clientWidth&&!w.target.clientHeight?!1:t?w.target.offsetTop<g:Math.abs(w.target.offsetLeft)<Math.abs(h)).length)return;const S=h-x+p.offsetLeft,b=g-v+p.offsetTop;a.scrollTo(S,b)},c=(u,h)=>Array.from(u).filter(g=>g instanceof HTMLElement).flatMap(g=>g instanceof HTMLImageElement?[g]:Array.from(g.querySelectorAll("img"))).forEach(h),i=new ResizeObserver(l),f=new MutationObserver(u=>{for(const h of u)c(h.addedNodes,g=>i.observe(g)),c(h.removedNodes,g=>i.unobserve(g))});return f.observe(a,{childList:!0,subtree:!0}),()=>{f.disconnect(),i.disconnect()}},[o,t])},ca=(e,r,n,o,t,a,l)=>{const c=Zs(e),i=()=>{const f=e.current,{left:u,top:h,visibleElementLeft:g,visibleElementTop:p,visibleElement:x}=c.current;if(!f||!l||!x)return!1;const v=ks(n,t,a),R=o===0;if(!(!v.previous&&R))return!1;const S=u-g+x.offsetLeft,b=h-p+x.offsetTop;return f.scrollTo(S,b),!0};d.useEffect(()=>{const f=e.current;if(!f||!l)return()=>{};let u=!1;const h=(x,v)=>{Array.from(x).filter(R=>R instanceof HTMLElement).flatMap(R=>R instanceof HTMLImageElement?[R]:Array.from(R.querySelectorAll("img"))).forEach(v)},g=new ResizeObserver(()=>{u||(u=i(),u&&g.disconnect())}),p=new MutationObserver(x=>{for(const v of x)h(v.addedNodes,R=>g.observe(R)),h(v.removedNodes,R=>g.unobserve(R))});return p.observe(f,{childList:!0,subtree:!0}),()=>{p.disconnect(),g.disconnect()}},[r]),d.useLayoutEffect(()=>{i()},[r])},la=(e,r,n,o,t,a,l,c,i,f)=>{ca(e,r,n,o,t,a,Me(l)),ia(e,l),aa(l,f,i,o),Ss(c,o,i),Ss(l,o,i)},da={[V.SINGLE_PAGE]:lt.X,[V.DOUBLE_PAGE]:lt.X,[V.CONTINUOUS_VERTICAL]:lt.Y,[V.CONTINUOUS_HORIZONTAL]:lt.X,[V.WEBTOON]:lt.Y},ua=d.forwardRef(({currentPageIndex:e,pageToScrollToIndex:r,setPageToScrollToIndex:n,pages:o,totalPages:t,setPages:a,setPageLoadStates:l,setTotalPages:c,setCurrentPageIndex:i,transitionPageMode:f,retryFailedPagesKeyPrefix:u,setTransitionPageMode:h,readingMode:g,readingDirection:p,shouldUseInfiniteScroll:x,readerWidth:v,pageScaleMode:R,shouldOffsetDoubleSpreads:C,imagePreLoadAmount:S,pageGap:b,customFilter:w,shouldStretchPage:T,readerNavBarWidth:E,setScrollbarXSize:D,setScrollbarYSize:j,isVisible:L,setIsVisible:B,updateCurrentPageIndex:P,showPreview:G,setShowPreview:q,initialChapter:k,currentChapter:N,chapters:W,visibleChapters:y,setReaderStateChapters:xe,isCurrentChapterReady:pe},me)=>{var Fe;const{direction:M}=tt(),{resumeMode:K=ss.START}=(Fe=Ns().state)!=null?Fe:{resumeMode:ss.START},$=d.useRef(null),Oe=Rn(me,$),te=Ce(g),ve=Me(g),Le=Vo($),le=ht();d.useEffect(()=>le.setScrollRef($),[]);const de=rs.useGetScrollbarSize("width",$.current),ue=rs.useGetScrollbarSize("height",$.current);d.useLayoutEffect(()=>{D(de),j(ue)},[de,ue]);const ge=ce.useHandleClick($.current),Z=d.useRef(o.map(()=>null)),[{minChapterViewWidth:Ae,minChapterViewHeight:he,minChapterSizeSourceChapterId:Ve},De]=d.useState({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),[,st]=d.useState({}),Ie=da[g],We=p===at.LTR,oe=d.useMemo(()=>W.findIndex(J=>J.id===(k==null?void 0:k.id)),[W,k==null?void 0:k.id]),I=d.useMemo(()=>W.slice(Math.max(0,oe-y.trailing),Math.min(W.length,oe+y.leading+1)),[W,oe,y.trailing,y.leading]),Y=d.useMemo(()=>I.findIndex(J=>J.id===(N==null?void 0:N.id)),[N,I]),Ye=d.useCallback((J,Be,Se)=>{if(!ve)return;const H=Se===Ve;if(te){if(!H&&Ae>=J)return;De({minChapterViewWidth:J,minChapterViewHeight:0,minChapterSizeSourceChapterId:Se});return}(H||he<Be)&&De({minChapterViewWidth:0,minChapterViewHeight:Be,minChapterSizeSourceChapterId:Se})},[ve,te,Ae,he,Ve]);if(zo(r,e,o,t,n,P,ve,Z,M,p),$o(e,ve,M,p,$),Go($),Uo(g,p,$),Fo(L,B,G,q,$),Wo(L,le),la($,N==null?void 0:N.id,Y,e,I,y,g,p,n,R),d.useLayoutEffect(()=>{De({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),st({})},[g]),!k||!N)throw new Error("ReaderViewer: illegal state - initialChapter and currentChapter should not be undefined");return s.jsx(_,{ref:Oe,sx:{width:"100%",height:"100%",overflow:"auto",flexWrap:"nowrap",...m(te&&ys(v,R),{alignItems:"center"}),...m(!te,{...m(M==="ltr",{flexDirection:We?"row":"row-reverse"}),...m(M==="rtl",{flexDirection:We?"row-reverse":"row"})})},onClick:J=>!Le&&ge(J),onScroll:()=>ce.updateCurrentPageOnScroll(Z,t-1,P,Ie,p),children:I.map((J,Be)=>{var Ee,nt,xt,Zt;const Se=Math.max(0,I.length-Be-1),H=I[Se],it=(Ee=I[Se+1])!=null?Ee:W[oe+y.leading+1],rt=(nt=I[Se-1])!=null?nt:W[oe-y.trailing-1],Ue=H.id===k.id,fe=H.id===N.id,ft=H.id===((xt=I[Y+1])==null?void 0:xt.id),It=H.id===((Zt=I[Y-1])==null?void 0:Zt.id),ct=k.sourceOrder>H.sourceOrder,Ke=k.sourceOrder<H.sourceOrder,Bt=y.lastLeadingChapterSourceOrder===H.sourceOrder,Pt=y.lastTrailingChapterSourceOrder===H.sourceOrder,ae=Bt&&y.isLeadingChapterPreloadMode||Pt&&y.isTrailingChapterPreloadMode,_t=ks(Se,I,y),O=H.id===Ve;return s.jsx(na,{chapterId:H.id,previousChapterId:it==null?void 0:it.id,nextChapterId:rt==null?void 0:rt.id,isPreviousChapterVisible:_t.previous,isNextChapterVisible:_t.next,lastPageRead:ot(H.lastPageRead,0,H.pageCount-1),currentPageIndex:yr(e,H,N,fe,pe,ct,Ke,y),isInitialChapter:Ue,isCurrentChapter:fe,isPreviousChapter:ft,isNextChapter:It,isLeadingChapter:ct,isTrailingChapter:Ke,isPreloadMode:ae,imageRefs:Z,setPages:a,setPageLoadStates:l,setTotalPages:c,setCurrentPageIndex:i,setPageToScrollToIndex:n,transitionPageMode:f,retryFailedPagesKeyPrefix:u,readingMode:g,readerWidth:v,pageScaleMode:R,shouldOffsetDoubleSpreads:C,readingDirection:p,shouldUseInfiniteScroll:x,updateCurrentPageIndex:fe?P:Pe,scrollIntoView:fe&&y.scrollIntoView,resumeMode:_r(fe,Ue,ct,Ke,y.resumeMode,K),setReaderStateChapters:xe,setTransitionPageMode:h,pageGap:b,imagePreLoadAmount:S,customFilter:w,shouldStretchPage:T,scrollbarXSize:de,scrollbarYSize:ue,readerNavBarWidth:E,onSizeChange:Ye,minWidth:O?0:Ae,minHeight:O?0:he,scrollElement:$.current},H.id)})})}),ga=F(d.memo(ua),[we,A.useSettingsWithoutDefaultFlag,et,At,()=>({updateCurrentPageIndex:ce.useUpdateCurrentPageIndex()}),Dt,Ne,$e],["currentPageIndex","pageToScrollToIndex","setPageToScrollToIndex","pages","totalPages","setPages","setPageLoadStates","setTotalPages","setCurrentPageIndex","retryFailedPagesKeyPrefix","setTransitionPageMode","readingMode","readingDirection","shouldUseInfiniteScroll","readerWidth","pageScaleMode","shouldOffsetDoubleSpreads","imagePreLoadAmount","pageGap","customFilter","shouldStretchPage","readerNavBarWidth","transitionPageMode","setScrollbarXSize","setScrollbarYSize","isVisible","setIsVisible","updateCurrentPageIndex","showPreview","setShowPreview","initialChapter","currentChapter","chapters","visibleChapters","setReaderStateChapters","isCurrentChapterReady"]),ha=Object.fromEntries(Object.values(gt).map(e=>[e,{scopes:e}])),ee=(...e)=>{const[r,n,o,t]=e;return kr(r,n,{...o,...ha.reader},t)},Mt=(e,r,n,o,t,a,l)=>{if(a){e(n,t[0]);return}const c=zs(t.indexOf(o),t,l);if(c===void 0){r(n);return}e(n,c)},fa=({scrollElementRef:e})=>{const{direction:r}=tt(),n=A.useGetThemeDirection(),{enableScope:o,disableScope:t}=bs(),{manga:a}=He(),{isVisible:l,setIsVisible:c}=At(),{hotkeys:i,pageScaleMode:f,shouldStretchPage:u,shouldOffsetDoubleSpreads:h,readingMode:g,readingDirection:p,autoScroll:x,scrollAmount:v}=A.useSettings(),R=ht(),{setShowPreview:C}=Dt(),S=A.useExit(),b=ce.useOpenChapter(),w=ce.useOpenPage(),T=A.useCreateUpdateSetting(a!=null?a:ke),E=A.useCreateDeleteSetting(a!=null?a:ke);return ee(i[Q.PREVIOUS_PAGE],()=>w("previous"),[w]),ee(i[Q.NEXT_PAGE],()=>w("next"),[w]),ee(i[Q.SCROLL_BACKWARD],()=>e.current&&ce.scroll(ns.BACKWARD,os[g.value],g.value,p.value,r,e.current,b,c,C,v),{preventDefault:!0},[g.value,p.value,r,b,v]),ee(i[Q.SCROLL_FORWARD],()=>e.current&&ce.scroll(ns.FORWARD,os[g.value],g.value,p.value,r,e.current,b,c,C,v),{preventDefault:!0},[g.value,p.value,r,b,v]),ee(i[Q.PREVIOUS_CHAPTER],()=>b(ie("previous","next",n)),[b,n]),ee(i[Q.NEXT_CHAPTER],()=>b(ie("next","previous",n)),[b,n]),ee(i[Q.TOGGLE_MENU],()=>c(!l),[l]),ee(i[Q.CYCLE_SCALE_TYPE],()=>{Mt(T,E,"pageScaleMode",f.value,ws,f.isDefault,!0)},[T,E,f.value,f.isDefault]),ee(i[Q.STRETCH_IMAGE],()=>T("shouldStretchPage",!u.value),[T,u.value]),ee(i[Q.OFFSET_SPREAD_PAGES],()=>T("shouldOffsetDoubleSpreads",!h.value),[T,h.value]),ee(i[Q.CYCLE_READING_MODE],()=>{Mt(T,E,"readingMode",g.value,Os,g.isDefault,!0)},[T,E,g.value,g.isDefault]),ee(i[Q.CYCLE_READING_DIRECTION],()=>{Mt(T,E,"readingDirection",p.value,Ls,p.isDefault,!0)},[T,E,p.value,p.isDefault]),ee(i[Q.TOGGLE_AUTO_SCROLL],R.toggleActive,{preventDefault:!0},[R.toggleActive]),ee(i[Q.AUTO_SCROLL_SPEED_DECREASE],()=>T("autoScroll",{...x,value:Math.min(_e.max,x.value+_e.step)}),[T,x.value]),ee(i[Q.AUTO_SCROLL_SPEED_INCREASE],()=>T("autoScroll",{...x,value:Math.max(_e.min,x.value-_e.step)}),[T,x.value]),ee(i[Q.EXIT_READER],S,[S]),d.useEffect(()=>(o(gt.READER),()=>t(gt.READER)),[]),null},xa=(e,r,n,o,t,a,l,c,i,f,u,h)=>{d.useEffect(()=>()=>{e(void 0),r(St),n(0),o(null),t(0),a([Nr("",0)]),l([]),c([{url:"",loaded:!1}]),i(je.NONE),f(!1),u(Mr),h()},[])},pa=(e,r,n,o,t,a)=>{var l;d.useEffect(()=>{var x;const c=(x=e.data)==null?void 0:x.manga;if(!c||r.loading||r.error)return;const i=as(c,n),f=Hr(c,i.shouldUseAutoWebtoonMode,i.readingMode),u={...n,readingMode:f?V.WEBTOON:n.readingMode},h=f?V.WEBTOON:i.readingMode.value,g=Vr("global",{meta:o},u,void 0,h),p=as(c,g);t(p),a(!0)},[(l=e.data)==null?void 0:l.manga,n])},Rs=5e3,ma=(e,r,n,o,t,a,l,c,i)=>{const{t:f}=U(),u=d.useRef(void 0),h=d.useRef(void 0),g=d.useRef(void 0),p=d.useRef(!0);d.useEffect(()=>{if(e||r||!n)return;const x=JSON.stringify(o)!==JSON.stringify(u.current);l&&x&&Is(f(Ft[o.value].title),{autoHideDuration:Rs}),u.current=o;const R=JSON.stringify(t)!==JSON.stringify(h.current)||JSON.stringify(a)!==JSON.stringify(g.current);c&&R&&(i(!0),p.current&&setTimeout(()=>i(!1),Rs)),h.current=t,g.current=a,p.current=!1},[e,r,n,o.value,o.isDefault,t.value,t.isDefault,a.value,a.isDefault])},va=(e,r,n,o,t,a,l,c,i)=>{var p;const f=Wr(),u=Ns().state,{updateInitialChapter:h}=u!=null?u:{},g=h?void 0:o;d.useEffect(()=>{var E,D;const x=(E=e.data)==null?void 0:E.chapters.nodes,v=x?(D=x[x.length-r])!=null?D:null:void 0,R=g!=null?g:v,C=t!=null?t:v,S=(()=>{if(!x||!C)return[];const j=c?nn(n!=null?n:x,i):x;return(l?Ge.removeDuplicates(C,j):j).map(B=>Fr(B.id))})(),b=v&&Ge.getNextChapter(v,S,{offset:Tt.NEXT}),w=v&&Ge.getNextChapter(v,S,{offset:Tt.PREVIOUS}),T=R!=null&&R.id!==(g==null?void 0:g.id);T&&f("",{replace:!0,state:{...u,updateInitialChapter:void 0}}),a(j=>{var B,P,G,q;const L=(v==null?void 0:v.id)!==((B=j.currentChapter)==null?void 0:B.id);return{...j,mangaChapters:(P=j.mangaChapters)!=null?P:x,chapters:S,initialChapter:R,chapterForDuplicatesHandling:C,currentChapter:v,nextChapter:b,previousChapter:w,isCurrentChapterReady:L?!1:j.isCurrentChapterReady,visibleChapters:T?{...St.visibleChapters,lastLeadingChapterSourceOrder:(G=R==null?void 0:R.sourceOrder)!=null?G:St.visibleChapters.lastLeadingChapterSourceOrder,lastTrailingChapterSourceOrder:(q=R==null?void 0:R.sourceOrder)!=null?q:St.visibleChapters.lastTrailingChapterSourceOrder,isLeadingChapterPreloadMode:!1,isTrailingChapterPreloadMode:!1,scrollIntoView:!!j.initialChapter}:j.visibleChapters}})},[(p=e.data)==null?void 0:p.chapters.nodes,r,l,c,g,i])},Sa=({setOverride:e,readerNavBarWidth:r,isVisible:n,setIsVisible:o,manga:t,setManga:a,shouldSkipDupChapters:l,shouldSkipFilteredChapters:c,backgroundColor:i,readingMode:f,tapZoneLayout:u,tapZoneInvertMode:h,shouldShowReadingModePreview:g,shouldShowTapZoneLayoutPreview:p,setSettings:x,mangaChapters:v,initialChapter:R,chapterForDuplicatesHandling:C,currentChapter:S,setReaderStateChapters:b,setTotalPages:w,setCurrentPageIndex:T,setPageToScrollToIndex:E,setPages:D,setPageUrls:j,setPageLoadStates:L,setTransitionPageMode:B,cancelAutoScroll:P,setShowPreview:G})=>{var de,ue,ge;const{t:q}=U(),k=d.useRef(null),[N,W]=d.useState(!1),{chapterSourceOrder:y,mangaId:xe}=Gr(),pe=Number(y),me=Number(xe),M=Gt.useGetManga($r,me),K=Gt.useGetMangaChapters(zr,me);bn(!t||!S?q("reader.title",{mangaId:me,chapterIndex:pe}):"".concat(t.title,": ").concat(S.name));const{metadata:$,settings:Oe,request:te}=Xr(),ve=on(t!=null?t:ke),Le=S===void 0||!N||M.loading||K.loading||te.loading,le=(ue=(de=M.error)!=null?de:K.error)!=null?ue:te.error;return d.useEffect(()=>{var Z;a((Z=M.data)==null?void 0:Z.manga)},[(ge=M.data)==null?void 0:ge.manga]),xa(a,b,T,E,w,D,j,L,B,o,x,P),pa(M,te,Oe,$,x,W),ma(Le,le,N,f,u,h,g,p,G),va(K,pe,v,R,C,b,l,c,ve),d.useLayoutEffect(()=>(e({status:!0,value:s.jsxs(X,{sx:{position:"absolute"},children:[s.jsx(fa,{scrollElementRef:k}),s.jsx(yo,{isVisible:n}),!k.current&&s.jsx(X,{onClick:()=>o(!n),sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"transparent"}})]})}),()=>e({status:!1,value:null})),[n,o,k.current]),le?s.jsx(jt,{message:q("global.error.label.failed_to_load_data"),messageExtra:_s(le),retry:()=>{M.error&&M.refetch().catch(vt()),te.error&&te.refetch().catch(vt()),K.error&&K.refetch().catch(vt())}}):Le?s.jsx(X,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:s.jsx(Lt,{})}):S===null?s.jsx(jt,{message:q("reader.error.label.chapter_not_found")}):!t||!S?null:s.jsxs(X,{sx:{position:"relative",display:"flex",flexDirection:"column",width:"calc(100vw - ".concat(r,"px)"),height:"100vh",marginLeft:"".concat(r,"px"),transition:Z=>"width 0.".concat(Z.transitions.duration.shortest,"s, margin-left 0.").concat(Z.transitions.duration.shortest,"s"),overflow:"auto",backgroundColor:Ps[i]},children:[s.jsx(ga,{ref:k}),s.jsx(No,{}),s.jsx(Ho,{})]})},ni=F(d.memo(Sa),[$e,At,He,Ne,Ur,()=>{const{shouldSkipDupChapters:e,shouldSkipFilteredChapters:r,backgroundColor:n,shouldShowReadingModePreview:o,shouldShowTapZoneLayoutPreview:t}=A.useSettingsWithoutDefaultFlag();return{shouldSkipDupChapters:e,shouldSkipFilteredChapters:r,backgroundColor:n,shouldShowReadingModePreview:o,shouldShowTapZoneLayoutPreview:t}},()=>{const{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}=A.useSettings();return{readingMode:e,tapZoneLayout:r,tapZoneInvertMode:n}},we,()=>({cancelAutoScroll:ht().cancel}),Dt],["setOverride","readerNavBarWidth","isVisible","setIsVisible","manga","setManga","shouldSkipDupChapters","shouldSkipFilteredChapters","backgroundColor","readingMode","tapZoneLayout","tapZoneInvertMode","shouldShowReadingModePreview","shouldShowTapZoneLayoutPreview","setSettings","mangaChapters","initialChapter","chapterForDuplicatesHandling","currentChapter","setReaderStateChapters","setTotalPages","setCurrentPageIndex","setPageToScrollToIndex","setPages","setPageUrls","setPageLoadStates","setTransitionPageMode","cancelAutoScroll","setShowPreview"]);export{ni as Reader};
