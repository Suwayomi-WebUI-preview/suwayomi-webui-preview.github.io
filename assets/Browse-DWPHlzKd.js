import{c as te,j as e,u as A,a as Me,S as N,A as B,L as z,r as w,b as W,T as C,l as Ce,B as G,C as M,I as U,d as Ue,m as O,g as b,e as se,f as c,D as Re,h as Pe,i as ne,k as $,t as V,n as he,o as Be,p as Ge,q as $e,s as De,v as Fe,w as ze,x as He,y as Ee,z as Le,E as Te,F as ve,G as Ve,H as xe,J as Ke,K as Xe,M as qe,N as We,O as ge,P as fe,Q as Qe,R as y}from"./index-Dg11ME2R.js";import{P as Je}from"./PushPin-nJR9aBlv.js";import{P as Ze}from"./PushPinOutlined-B3ufdmsK.js";import{SourceContentType as Se}from"./SourceMangas-CtlvSVpS.js";import{M as ee}from"./MUI.util-CEodEA2f.js";import{L as re}from"./ListCardAvatar-BYTl_QLo.js";import{L as oe}from"./ListCardContent-B10b9ECT.js";import{C as ae}from"./Card-wL-hmBzS.js";import{C as ie}from"./CardActionArea-CgHE5voS.js";import{E as q}from"./EmptyViewAbsoluteCentered-BpXH3EyT.js";import{i as Ye,t as Q,g as K,I as et,a as tt,E as Ie,b as F,c as st,u as nt,d as rt,e as ot,f as at,h as it,j as ct,k as lt}from"./Extensions.utils-CB4Ad4lL.js";import{u as we}from"./useAppAction-D-qUSktg.js";import{S as Ae,a as ye}from"./StyledGroupHeader-BgFFcM8O.js";import{V as Ne}from"./Virtuoso.util-D1RV4DYJ.js";import{S as ce}from"./StyledGroupItemWrapper-ygzvhxm9.js";import{S as ut}from"./SourceLanguageSelect-BlV-dx6O.js";import{f as dt}from"./file-selector-DlHkLoY8.js";import{A as pt}from"./Add-Bk1lvY0w.js";import{A as mt}from"./AppbarSearch-BnMTaaXP.js";import{F as ht}from"./FilterList-DO7pilnI.js";import{q as xt}from"./index-DGMz90gj.js";import{S as gt}from"./Switch-Di9Tr3tU.js";import{u as je}from"./use-window-event-DeEDCPrk.js";import{T as Y,a as X}from"./Tabs-C_xRFe6t.js";import{T as ft}from"./TabsWrapper-D3PxQwL7.js";import{T as St}from"./TabsMenu-CFVhMAYW.js";import{A as jt,a as _t}from"./SortRadioInput-CSMmQper.js";import{C as Ct}from"./Chip-B2WV1Iyz.js";import{u as Et}from"./useAppTitle-CkeQAyCc.js";import{G as Lt}from"./Virtuoso.constants-DKNufsdf.js";import"./IconWebView-BKD85kli.js";import"./GridLayouts-NeELREAj.js";import"./Checkbox-BR9wiiA8.js";import"./SwitchBase-Dy2wk2ln.js";import"./ListPreference-B6lXSlZa.js";import"./FormGroup-Zzx3kc2E.js";import"./Delete-UwEN77yq.js";import"./CheckboxInput-DLrwItSF.js";import"./ExpandMore-B4XSEbZP.js";import"./useDebounce-BsaH-mNu.js";import"./ThreeStateCheckboxInput-QJ2AwHAF.js";import"./StyledFab-Ddln6yV0.js";import"./BaseMangaGrid-D0xf_wEX.js";import"./MangaGrid-CJmYh-A5.js";import"./useManageMangaLibraryState-C_XeXGI8.js";import"./Chapters-B5l930U9.js";import"./DateHelper-CwhPxo-b.js";import"./Asserts-xItX73wb.js";import"./Mangas-DS370Z5E.js";import"./Download-CvDZirnH.js";import"./ContinueReadingTooltip-Cwxzf3pL.js";import"./Trackers-BQ19KlF0.js";import"./AvatarSpinner-Ltl6A7ef.js";import"./SpinnerImage-BeONRM1-.js";import"./Refresh-M7Isng9V.js";import"./Image-CSWZ2_qY.js";import"./CheckCircle-D4X2m11X.js";import"./Metadata-CHRxaprE.js";import"./Link-Bk7B9P7X.js";import"./NumberSetting-DmaF25zg.js";import"./Slider-Cm_K4TFZ.js";import"./useMobilePicker-Dh9obHxy.js";import"./SelectSetting-CedvK6rK.js";import"./Select-DOADqnMg.js";import"./Sync-2HdhXmjJ.js";import"./use-merged-ref-BjmutRWW.js";import"./PlayArrow--_Cs0sH4.js";import"./useAppTitleAndAction-CGbKL5yF.js";import"./Strings-CAV0u705.js";import"./ListItemAvatar-B9StF7NP.js";const Tt=te(e.jsx("path",{d:"M19.3 16.9c.4-.7.7-1.5.7-2.4 0-2.5-2-4.5-4.5-4.5S11 12 11 14.5s2 4.5 4.5 4.5c.9 0 1.7-.3 2.4-.7l3.2 3.2 1.4-1.4zm-3.8.1c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5M12 20v2C6.48 22 2 17.52 2 12S6.48 2 12 2c4.84 0 8.87 3.44 9.8 8h-2.07c-.64-2.46-2.4-4.47-4.73-5.41V5c0 1.1-.9 2-2 2h-2v2c0 .55-.45 1-1 1H8v2h2v3H9l-4.79-4.79C4.08 10.79 4 11.38 4 12c0 4.41 3.59 8 8 8"})),vt=l=>{const{i18n:t,_:u}=A(),{source:n,showSourceRepo:x,showLanguage:s}=l,{id:r,name:o,lang:a,iconUrl:g,supportsLatest:j,isNsfw:d,extension:{repo:f}}=n,{isPinned:p}=Me(n),m=N.isLocalSource(n)?t._({id:"LECJgZ"}):o,_=Ue(n,I=>O(t._({id:"cBoXe4"}),"error",b(I)));return e.jsx(ae,{children:e.jsx(ie,{component:z,to:B.sources.childRoutes.browse.path(r),state:{contentType:Se.POPULAR,clearCache:!0},children:e.jsxs(oe,{children:[e.jsx(re,{iconUrl:w.getValidImgUrlFor(g),alt:m,slots:{spinnerImageProps:{ignoreQueue:!0}}}),e.jsxs(W,{sx:{justifyContent:"center",flexGrow:1,flexShrink:1,wordBreak:"break-word"},children:[e.jsx(C,{variant:"h6",component:"h3",children:m}),e.jsxs(C,{variant:"caption",children:[s&&Ce(a),d&&e.jsx(C,{variant:"caption",color:"error",children:" 18+"})]}),x&&e.jsx(C,{variant:"caption",children:f})]}),j&&e.jsx(G,{...ee.preventRippleProp(),variant:"outlined",component:z,to:B.sources.childRoutes.browse.path(r),state:{contentType:Se.LATEST,clearCache:!0},children:t._({id:"wL3cK8"})}),e.jsx(M,{title:p?t._({id:"e6tI/P"}):t._({id:"KofAFL"}),children:e.jsx(U,{...ee.preventRippleProp(),onClick:I=>{I.preventDefault(),_("isPinned",!p)},color:p?"primary":"inherit",children:p?e.jsx(Je,{}):e.jsx(Ze,{})})})]})})})};function _e({tabsMenuHeight:l}){const{i18n:t,_:u}=A(),{languages:n,setLanguages:x}=N.useLanguages(),{settings:{showNsfw:s,lastUsedSourceId:r}}=se(),{data:o,loading:a,error:g,refetch:j}=w.useGetSourceList({notifyOnNetworkStatusChange:!0}),d=o==null?void 0:o.sources.nodes,f=c.useMemo(()=>N.filter(d!=null?d:[],{isNsfw:s?void 0:!0,languages:n,keepLocalSource:!0,enabled:!0}),[d,n]),p=c.useMemo(()=>N.filter(d!=null?d:[],{isNsfw:s?void 0:!0,removeLocalSource:!0}),[d]),m=c.useMemo(()=>{const h=N.getLastUsedSource(r,f),E=Object.entries(N.groupByLanguage(f,{withPinnedGroup:!0}));return h?[[Re.LAST_USED_SOURCE,[h]],...E]:E},[f]),_=c.useMemo(()=>N.getLanguages(p,{excludeLocalSource:!0}),[d]),I=c.useMemo(()=>N.areFromMultipleRepos(f),[f]),v=c.useMemo(()=>m.map(([,h])=>h).flat(1),[m]),T=c.useMemo(()=>m.map(h=>h[1].length),[m]),R=Ne.useCreateGroupedComputeItemKey(T,c.useCallback(h=>m[h][0],[m]),c.useCallback((h,E)=>"".concat(m[E][0],"_").concat(v[h].id),[v])),P=Pe();return we(e.jsxs(e.Fragment,{children:[e.jsx(M,{title:t._({id:"kddIOO"}),children:e.jsx(U,{onClick:()=>P(B.sources.childRoutes.searchAll.path()),color:"inherit",children:e.jsx(Tt,{})})}),e.jsx(ut,{selectedLanguages:n,setSelectedLanguages:x,languages:_,sources:p})]}),[u,n,_,p]),a?e.jsx(ne,{}):g?e.jsx(q,{message:t._({id:"6m5aox"}),messageExtra:b(g),retry:()=>j().catch($("Sources::refetch"))}):(d==null?void 0:d.length)===0?e.jsx(q,{message:t._({id:"W//hDl"})}):e.jsx(Ae,{persistKey:"sources",heightToSubtract:l,overscan:window.innerHeight*.5,groupCounts:T,computeItemKey:R,groupContent:h=>{const[E]=m[h];return e.jsx(ye,{isFirstItem:!h,children:e.jsx(C,{variant:"h5",component:"h2",children:Q(E)})})},itemContent:(h,E)=>{const S=m[E][0],D=v[h];return e.jsx(ce,{children:e.jsx(vt,{source:D,showSourceRepo:I,showLanguage:Ye(S)})})}})}function It({selectedLanguages:l,setSelectedLanguages:t,languages:u}){const{i18n:n,_:x}=A(),[s,r]=c.useState(V(l)),[o,a]=c.useState(!1),g=c.useMemo(()=>V([...s.filter(p=>u.includes(p)).toSorted(he),...u.toSorted(he)]),[u,s]),j=()=>{a(!1),r(V(l))},d=()=>{a(!1),t(V(s))},f=(p,m)=>{r(m?[...s,p]:s.toSpliced(s.indexOf(p),1))};return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:n._({id:"Tz0i8g"}),children:e.jsx(U,{onClick:()=>a(!0),"aria-label":"display more actions",edge:"end",color:"inherit",children:e.jsx(ht,{})})}),e.jsxs(Be,{fullWidth:!0,maxWidth:"xs",open:o,onClose:j,children:[e.jsx(Ge,{children:n._({id:"tEL3Xq"})}),e.jsx($e,{dividers:!0,sx:{padding:0},children:e.jsx(xt,{style:{height:g.length*54,minHeight:"25vh",maxHeight:"50vh"},data:g,increaseViewportBy:400,computeItemKey:p=>g[p],itemContent:(p,m)=>e.jsxs(De,{children:[e.jsx(Fe,{primary:Q(m)}),e.jsx(gt,{checked:s.includes(m),onChange:_=>f(m,_.target.checked)})]})})}),e.jsxs(ze,{children:[e.jsx(G,{autoFocus:!0,onClick:j,color:"primary",children:n._({id:"dEgA5A"})}),e.jsx(G,{onClick:d,color:"primary",children:n._({id:"aP3N/0"})})]})]})]})}const wt=({disabled:l,children:t,...u})=>l?t:e.jsx(ie,{component:z,...u,children:t});function At(l){const{i18n:t,_:u}=A(),{extension:{name:n,lang:x,versionName:s,isInstalled:r,hasUpdate:o,isObsolete:a,pkgName:g,iconUrl:j,isNsfw:d,repo:f},handleUpdate:p,showSourceRepo:m,forcedState:_}=l,[I,v]=c.useState(K(r,a,o)),T=_!=null?_:I;c.useEffect(()=>{v(K(r,a,o))},[K(r,a,o)]);const R=async h=>{const E=rt[h],S=st[h];try{v(S),await nt(g,a,h),v(E),p()}catch(D){v(K(r,a,o))}};function P(){switch(T){case F.INSTALL:case F.UPDATE:case F.UNINSTALL:R(T).catch($("ExtensionCard:handleButtonClick(".concat(T,")")));break;case Ie.OBSOLETE:R(F.UNINSTALL).catch($("ExtensionCard:handleButtonClick(".concat(T,")")));break}}return e.jsx(ae,{children:e.jsx(wt,{disabled:!r,to:B.extension.childRoutes.info.path(g),children:e.jsxs(oe,{children:[e.jsx(re,{iconUrl:w.getValidImgUrlFor(j),alt:n,slots:{spinnerImageProps:{ignoreQueue:!0}}}),e.jsxs(W,{sx:{justifyContent:"center",flexGrow:1,flexShrink:1,wordBreak:"break-word"},children:[e.jsx(C,{variant:"h6",component:"h3",children:n}),e.jsxs(C,{variant:"caption",children:[r?"".concat(Ce(x)," "):"",s,d&&e.jsx(C,{variant:"caption",color:"error",children:" 18+"})]}),m&&e.jsx(C,{variant:"caption",children:f})]}),r&&e.jsx(M,{title:t._({id:"Tz0i8g"}),children:e.jsx(U,{color:"inherit",...ee.preventRippleProp(),children:e.jsx(He,{})})}),e.jsx(G,{variant:"outlined",sx:{color:T===tt.OBSOLETE?"red":"inherit",flexShrink:0},onClick:h=>{h.preventDefault(),P()},children:t._(et[T])})]})})})}const yt=0,Nt=1,Ot=({groupName:l,isFirstItem:t,groupExtensionIds:u,isUpdateGroup:n,updatingExtensionIds:x,setUpdatingExtensionIds:s,handleExtensionUpdate:r})=>{const{i18n:o,_:a}=A();return e.jsxs(ye,{isFirstItem:t,sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",pr:1},children:[e.jsx(C,{variant:"h5",component:"h2",children:Q(l)}),n&&e.jsx(G,{disabled:!!x.length,variant:"contained",onClick:()=>{s(u),w.updateExtensions(u,{update:!0}).response.then(()=>r()).catch(g=>O(Ve.t({...lt[F.UPDATE],values:{count:u.length}}),"error",b(g))).finally(()=>s([]))},children:o._({id:"yRCx2T"})})]},l)};function bt({tabsMenuHeight:l}){var pe,me;const{i18n:t,_:u}=A(),{data:n,loading:x,error:s,refetch:r}=w.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[o,{data:a,loading:g,error:j}]=w.useExtensionListFetch(),{settings:{browseLanguages:d,showNsfw:f}}=se(),p=ve(i=>O(t._({id:"cBoXe4"}),"error",b(i))),[m]=Ee(Te.QUERY,Le),[_,I]=c.useState([]),[v,T]=c.useState({}),R=x||g,P=s!=null?s:j,h=!!(n!=null&&n.settings.extensionRepos.length),E=((pe=n==null?void 0:n.settings.extensionRepos.length)!=null?pe:0)>1,S=(me=a==null?void 0:a.fetchExtensions)==null?void 0:me.extensions,D=c.useMemo(()=>ot(S!=null?S:[]),[S]),le=c.useMemo(()=>at(S!=null?S:[],{selectedLanguages:d,showNsfw:f,query:m}),[S,d,f,m]),k=c.useMemo(()=>it(le),[le]),ue=c.useMemo(()=>k.map(i=>i[Nt].length),[k]),J=c.useMemo(()=>k.map(([,i])=>i).flat(1),[k]),Oe=Ne.useCreateGroupedComputeItemKey(ue,c.useCallback(i=>k[i][yt],[k]),c.useCallback(i=>J[i].pkgName,[J])),Z=c.useCallback(()=>T({}),[]),de=i=>{if(!i.name.toLowerCase().endsWith("apk")){O(t._({id:"f7vOnJ"}),"error");return}O(t._({id:"K04htz"}),"info"),w.installExternalExtension(i).response.then(()=>{Z(),O(t._({id:"LGq1dg"}),"success")}).catch(L=>O(t._({id:"amOoxI"}),"error",b(L)))};return c.useEffect(()=>{o()},[v]),we(e.jsxs(e.Fragment,{children:[e.jsx(mt,{}),e.jsx(M,{title:t._({id:"lpVYKJ"}),children:e.jsx(U,{onClick:()=>{const i=document.createElement("input");i.style.display="none",i.type="file",i.onchange=()=>{var H;const L=(H=i.files)==null?void 0:H[0];L&&de(L)},document.documentElement.appendChild(i),i.click(),document.documentElement.removeChild(i)},color:"inherit",children:e.jsx(pt,{})})}),e.jsx(It,{selectedLanguages:d,setSelectedLanguages:i=>p("browseLanguages",i),languages:D})]}),[u,d,D]),je("drop",async i=>{i.preventDefault();const L=await dt(i);de(L[0])}),je("dragover",i=>{i.preventDefault()}),R?e.jsx(ne,{}):P?e.jsx(q,{message:t._({id:"6m5aox"}),messageExtra:b(P),retry:()=>{s&&r().catch($("Extensions::refetchServerSettings")),j&&o().catch($("Extensions::refetchExtensions"))}}):!(S!=null&&S.length)&&!h?e.jsxs(W,{sx:{alignItems:"center",justifyContent:"center",rowGap:"10px",paddingTop:"20px"},children:[e.jsx(C,{children:t._({id:"BMwO25"})}),e.jsx(G,{component:z,variant:"contained",to:B.settings.childRoutes.browse.path,children:t._({id:"Tz0i8g"})})]}):e.jsx(Ae,{persistKey:"extensions",heightToSubtract:l,overscan:window.innerHeight*.5,groupCounts:ue,groupContent:i=>{const[L,H]=k[i],be=L===ct.UPDATE_PENDING;return e.jsx(Ot,{groupName:L,isFirstItem:i===0,groupExtensionIds:H.map(ke=>ke.pkgName),isUpdateGroup:be,updatingExtensionIds:_,setUpdatingExtensionIds:I,handleExtensionUpdate:Z})},computeItemKey:Oe,itemContent:i=>{const L=J[i];return e.jsx(ce,{children:e.jsx(At,{extension:L,handleUpdate:Z,showSourceRepo:E,forcedState:_.includes(L.pkgName)?Ie.UPDATING:void 0})})}})}const kt=te(e.jsx("path",{d:"M14.94 4.66h-4.72l2.36-2.36zm-4.69 14.71h4.66l-2.33 2.33zM6.1 6.27 1.6 17.73h1.84l.92-2.45h5.11l.92 2.45h1.84L7.74 6.27zm-1.13 7.37 1.94-5.18 1.94 5.18zm10.76 2.5h6.12v1.59h-8.53v-1.29l5.92-8.56h-5.88v-1.6h8.3v1.26z"})),Mt=te(e.jsx("path",{d:"M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4zm-6 4h-4v-4h4z"})),Ut=({id:l,name:t,lang:u,iconUrl:n,mangaCount:x})=>{const{i18n:s,_:r}=A(),a=Number(l)===0?s._({id:"LECJgZ"}):t;return e.jsx(ae,{children:e.jsx(ie,{component:z,to:B.migrate.path(l),children:e.jsxs(oe,{sx:{justifyContent:"space-between"},children:[e.jsxs(xe,{sx:{display:"flex",gap:1},children:[e.jsx(re,{iconUrl:w.getValidImgUrlFor(n),alt:a,slots:{spinnerImageProps:{ignoreQueue:!0}}}),e.jsxs(xe,{sx:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx(C,{variant:"h6",component:"h3",children:a}),e.jsx(C,{variant:"caption",sx:{display:"block"},children:Q(u)})]})]}),e.jsx(Ct,{sx:{borderRadius:1},size:"small",label:x})]})})})},Rt=(l,{sortBy:t,sortOrder:u})=>{if(!l)return[];const n={};l.forEach(({sourceId:s,source:r})=>{var a;const o=(a=n[s])!=null?a:{id:s,name:s,lang:"unknown",iconUrl:null,mangaCount:0,...r};n[s]={...o,mangaCount:o.mangaCount+1}});const x=Object.values(n).toSorted((s,r)=>{switch(t){case ge.SOURCE_NAME:return s.name.localeCompare(r.name);case ge.MANGA_COUNT:return s.mangaCount-r.mangaCount;default:throw new Error('Unexpected "sortBy" "'.concat(t,'"'))}});switch(u){case fe.ASC:return x;case fe.DESC:return x.toReversed();default:throw new Error('Unexpected "sortOrder" "'.concat(u,'"'))}},Pt=({tabsMenuHeight:l})=>{const{i18n:t,_:u}=A(),{appBarHeight:n}=Ke(),{settings:{migrateSortSettings:x}}=se(),s=ve(p=>O(t._({id:"cBoXe4"}),"error",b(p))),{sortBy:r,sortOrder:o}=x,{data:a,loading:g,error:j,refetch:d}=w.useGetMigratableSources({notifyOnNetworkStatusChange:!0}),f=c.useMemo(()=>Rt(a==null?void 0:a.mangas.nodes,x),[a==null?void 0:a.mangas.nodes,x]);return g?e.jsx(ne,{}):j?e.jsx(q,{message:t._({id:"6m5aox"}),messageExtra:b(j),retry:()=>d().catch($("Migration::refetch"))}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{sx:{position:"sticky",top:"".concat(n+l,"px"),flexDirection:"row",justifyContent:"end",alignItems:"center",gap:1,p:1,backgroundColor:"background.default",zIndex:1},children:[e.jsx(M,{title:t._(Xe[r]),children:e.jsx(U,{color:"inherit",onClick:()=>s("migrateSortSettings",{sortBy:(r+1)%2,sortOrder:o}),children:r?e.jsx(Mt,{}):e.jsx(kt,{})})}),e.jsx(M,{title:t._(qe[o]),children:e.jsx(U,{color:"inherit",onClick:()=>s("migrateSortSettings",{sortBy:r,sortOrder:(o+1)%2}),children:o?e.jsx(jt,{}):e.jsx(_t,{})})})]}),e.jsx(We,{sx:{p:0},children:f.map(p=>e.jsx(ce,{children:e.jsx(Ut,{...p})},p.id))})]})};function tn(){const{i18n:l,_:t}=A();Et(l._({id:"O2UpM1"}));const u=c.useRef(null),[n,x]=c.useState(0);Qe(u,c.useCallback(()=>x(u.current.offsetHeight),[u.current]));const[s,r]=Ee(Te.TAB,Le,{}),o=s!=null?s:y.SOURCES;return s||r(o,"replaceIn"),e.jsxs(ft,{children:[e.jsxs(St,{ref:u,sx:{zIndex:Lt},variant:"fullWidth",value:o,onChange:(a,g)=>r(g,"replaceIn"),children:[e.jsx(Y,{value:y.SOURCES,sx:{textTransform:"none"},label:l._({id:"wdxz7K"})}),e.jsx(Y,{value:y.EXTENSIONS,sx:{textTransform:"none"},label:l._({id:"V3sher"})}),e.jsx(Y,{value:y.MIGRATE,sx:{textTransform:"none"},label:l._({id:"y5rS9U"})})]}),e.jsx(X,{index:y.SOURCE_DEPRECATED,currentIndex:o,children:e.jsx(_e,{tabsMenuHeight:n})}),e.jsx(X,{index:y.SOURCES,currentIndex:o,children:e.jsx(_e,{tabsMenuHeight:n})}),e.jsx(X,{index:y.EXTENSIONS,currentIndex:o,children:e.jsx(bt,{tabsMenuHeight:n})}),e.jsx(X,{index:y.MIGRATE,currentIndex:o,children:e.jsx(Pt,{tabsMenuHeight:n})})]})}export{tn as Browse};
