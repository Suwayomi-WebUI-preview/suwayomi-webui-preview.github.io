import{u as v,d as b,y as f,c as a,N as B,j as t,P as E,I as S,K as A,bh as _,V as D,O as F,a2 as P,a as N,bB as V,g as w,h as K,B as U}from"./index-7xHMGivc.js";import{G as W}from"./GridLayouts-DP5ewABF.js";import{C as H}from"./CheckboxInput-h91fZq8b.js";import{E as O}from"./EmptyViewAbsoluteCentered-DPYCGu66.js";import{b as R}from"./MangaGrid-DDiNfUxm.js";import{V as $,S as q,a as C,b as z}from"./Virtuoso.util-DNHmRn3g.js";import{B as J}from"./BaseMangaGrid-BbIBttdM.js";import"./Checkbox-BXDXLTKP.js";import"./TextField-CWIR6ey_.js";import"./SwitchBase-CKPVGabz.js";import"./ListPreference-Ccg44E-L.js";import"./index-C4v_tww9.js";import"./useManageMangaLibraryState-DzRC4Bnq.js";import"./Trackers-D4pSmk7a.js";import"./Card-Bc_2G7UR.js";import"./CardContent-X_sNHadm.js";import"./Avatar-DFf7CCaU.js";import"./Info-CbB6Qo_S.js";import"./InputAdornment-dUOSQzmr.js";import"./CheckCircle-DzWMe7yq.js";import"./SpinnerImage-CSv9wdGW.js";import"./Refresh-B__8Oy0k.js";import"./TypographyMaxLines-CTSnwq0g.js";import"./Mangas-xogFsVME.js";import"./Chapters-DnTEEDAi.js";import"./CardActionArea-CKhuyHIi.js";import"./Collapse-BHRxp0ym.js";import"./Link-BBQyfFjD.js";import"./NumberSetting-eoA35H2B.js";import"./useMobilePicker-CQ1DZrxD.js";import"./Chip-DCQzhumi.js";import"./SelectSetting-CuYuThdV.js";import"./Select-C19eXnbJ.js";import"./ThreeStateCheckboxInput-DeoMbdxS.js";import"./Delete-_kcpO3ew.js";import"./Download-B8ejdiPo.js";import"./Sync-DehOnmaI.js";import"./PlayArrow-DtkbzT5p.js";import"./StyledFab-BBiB1Piz.js";const Fe=()=>{const{t:l}=v(),[n,j]=b("libraryDuplicatesGridLayout",f.List),[m,L]=b("libraryDuplicatesCheckAlternativeTitles",!1),{setTitle:c,setAction:d}=a.useContext(B);a.useLayoutEffect(()=>(c(l("library.settings.advanced.duplicates.label.title")),d(t.jsxs(t.Fragment,{children:[t.jsx(W,{gridLayout:n,onChange:j}),t.jsx(E,{variant:"popover",popupId:"library-dupliactes-settings",children:e=>t.jsxs(t.Fragment,{children:[t.jsx(S,{...A(e),color:"inherit",children:t.jsx(_,{})}),t.jsx(D,{...F(e),children:t.jsx(P,{children:t.jsx(H,{label:l("library.settings.advanced.duplicates.settings.label.check_description"),checked:m,onChange:(r,p)=>L(p)})})})]})})]})),()=>{c(""),d(null)}),[l,n,m]);const{data:i,loading:M,error:g,refetch:k}=N.useGetMangas(V,{condition:{inLibrary:!0}}),[G,h]=a.useState(!0),[o,y]=a.useState({});a.useEffect(()=>{var p;h(!0);const e=(p=i==null?void 0:i.mangas.nodes)!=null?p:[];if(!e.length)return y({}),()=>{};const r=new Worker(new URL("/assets/LibraryDuplicatesWorker-CoLlk4gN.js",import.meta.url),{type:"module"});return r.onmessage=T=>{y(T.data),h(!1)},r.postMessage({mangas:e,checkAlternativeTitles:m}),()=>r.terminate()},[i==null?void 0:i.mangas.nodes,m]);const s=a.useMemo(()=>Object.keys(o).toSorted((e,r)=>e.localeCompare(r)),[o]),u=a.useMemo(()=>s.map(e=>o[e]).flat(),[o]),x=a.useMemo(()=>s.map(e=>o[e]).map(e=>e.length),[o]),I=$.useCreateGroupedComputeItemKey(x,a.useCallback(e=>s[e],[s]),a.useCallback((e,r)=>"".concat(s[r],"-").concat(u[e].id,"}"),[s,u]));return M||G?t.jsx(w,{}):g?t.jsx(O,{message:l("global.error.label.failed_to_load_data"),messageExtra:g.message,retry:()=>k().catch(K())}):n===f.List?t.jsx(q,{groupCounts:x,groupContent:e=>t.jsx(C,{variant:"h5",isFirstItem:e===0,children:s[e]}),computeItemKey:I,itemContent:e=>t.jsx(z,{children:t.jsx(R,{manga:u[e],gridLayout:n,selected:null,mode:"duplicate"})})}):s.map((e,r)=>t.jsxs(U,{children:[t.jsx(C,{sx:{pt:r===0?void 0:0,pb:0},variant:"h5",isFirstItem:!1,children:e}),t.jsx(J,{mangas:o[e],hasNextPage:!1,loadMore:()=>{},isLoading:!1,gridLayout:n,inLibraryIndicator:!1,horizontal:!0,mode:"duplicate"})]},e))};export{Fe as LibraryDuplicates};
