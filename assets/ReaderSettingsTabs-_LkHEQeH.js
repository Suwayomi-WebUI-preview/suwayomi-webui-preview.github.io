var br=Object.defineProperty;var Sr=(e,t,r)=>t in e?br(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var We=(e,t,r)=>Sr(e,typeof t!="symbol"?t+"":t,r);import{r as K,b as S,R as ct,dF as P,Q as Er,dG as me,dH as Rr,dx as yr,dI as Yt,dJ as Tr,dK as Ar,bK as Pr,j as o,z as J,at as E,d3 as xe,dr as $,dl as Te,dn as H,am as dt,cS as W,dL as M,d5 as I,av as he,d6 as Or,aZ as ue,O as Ue,ds as we,d4 as te,bX as ie,d2 as Zt,dM as Cr,dN as ft,dO as Ir,a as jr,dP as _t,dQ as Dr,dR as pt,ce as wr,m as mt,g as xt,as as vt,dS as V,be as Lr,d as Mr,A as Nr,dT as ve,f as kr,u as x,S as v,T as A,B as re,C as Ve,df as Kt,dg as Xt,dU as Ur,dV as Vr,cZ as oe,dd as Br,de as Fr,dc as Gr,c as de,I as Jt,dW as Ye,aP as Hr,dh as Qt,cT as be,dk as je,dX as zr,dY as fe,dZ as w,d_ as $r,d$ as Wr,e0 as Yr,c$ as _e,e1 as Ze,a1 as Zr,e2 as Kr,i as Xr,k as Jr,n as Qr,q as qr,a3 as en,a4 as tn,dt as D,e3 as rn,e4 as bt,cR as ge}from"./index-B8EETnhg.js";import{T as nn}from"./TabsMenu-zAfW8d4c.js";import{C as F}from"./Chapters-DunbWxQW.js";import{a as sn,G as St,F as Et}from"./Mangas-8A-A-vZS.js";import{S as an}from"./SpinnerImage-CNE0Dhxm.js";import{r as on}from"./Strings-CAV0u705.js";import{T as ln,a as ae}from"./Tabs-G0s0fMPo.js";import{T as qt}from"./Trans-bpbd4ECI.js";import{S as cn}from"./Slider-DbNWd54G.js";import{C}from"./CheckboxInput-Cd9gL0jY.js";import{L as dn}from"./ListSubheader-Bbje3LXS.js";import{A as un}from"./Add-BTYN6_pF.js";const er=(e,t,r)=>{var l;const n=Ar(),s=n===Pr,a=Object.keys((l=r.meta)!=null?l:{}).filter(c=>{var g;return s?((g=c.match(/_/g))==null?void 0:g.length)===1:c.startsWith("".concat(Tr,"_").concat(n,"_"))}).map(c=>Yt(c));return Object.fromEntries(Object.entries(t).map(([c,g])=>{if(me.includes(c))return[c,g];const d=e==="manga"&&!a.includes(c);return[c,{value:g,isDefault:d}]}))},qe=e=>({...e,tapZoneInvertMode:JSON.stringify(e.tapZoneInvertMode),customFilter:JSON.stringify(e.customFilter),readerWidth:JSON.stringify(e.readerWidth),hotkeys:JSON.stringify(e.hotkeys),autoScroll:JSON.stringify(e.autoScroll)}),Rt=er("global",P,{meta:qe(P)}),tr=(e,t,r=P,n,s)=>Er(e,t,r,s!==void 0?[s.toString()]:void 0,n);function rr(e,t,r=P,n,s){const a=tr(e,t,r,n,s);return er(e,a,t)}const gn=(e,t,r,n)=>rr("manga",{...e,meta:ct(e.meta,s=>!me.includes(Yt(s)))},t,r,n),Qa=(e,t)=>gn(e,t),qa=e=>{const t=K.useGetGlobalMeta({notifyOnNetworkStatusChange:!0}),{data:r,loading:n}=t,s=S.useMemo(()=>ct(r==null?void 0:r.metas.nodes),[r==null?void 0:r.metas.nodes]),a=S.useMemo(()=>({meta:s}),[s]),i=tr("global",a,void 0,S.useEffect,e),l=S.useMemo(()=>i,[a,e]);return S.useMemo(()=>({metadata:s,settings:l,loading:n,request:t}),[s,l,n,t])},hn=e=>{const t=K.useGetGlobalMeta({notifyOnNetworkStatusChange:!0}),{data:r,loading:n}=t,s=S.useMemo(()=>ct(r==null?void 0:r.metas.nodes),[r==null?void 0:r.metas.nodes]),a=S.useMemo(()=>({meta:s}),[s]),i=rr("global",a,void 0,S.useEffect,e),l=S.useMemo(()=>i,[a,e]);return S.useMemo(()=>({metadata:s,settings:l,loading:n,request:t}),[s,l,n,t])},fn=async(e,t,r,n=!1,s)=>n||me.includes(t)?Rr([[t,qe({[t]:r})[t]]],s!==void 0?[s==null?void 0:s.toString()]:void 0):yr(e,[[t,qe({[t]:r})[t]]],s!==void 0?[s==null?void 0:s.toString()]:void 0),yt=e=>e===$.END?Number.MAX_SAFE_INTEGER:-1,_n=({currentPageIndex:e,pages:t,transitionPageMode:r,imageRefs:n,createPage:s,slots:a,readingMode:i,imagePreLoadAmount:l,isCurrentChapter:c,isPreviousChapter:g,isNextChapter:u,customFilter:d,pageScaleMode:f,shouldStretchPage:h,readerWidth:b,readerNavBarWidth:p,resumeMode:m,handleAsInitialRender:_,ref:y})=>{var L,j,B,Y;const R=S.useRef(yt(m));_&&(R.current=yt(m));const T=S.useMemo(()=>Es(e,t,R.current,l,i,c,g,u),[e,t,l,i,c,g,u]);S.useEffect(()=>{c&&(R.current=e)},[T,c]);const O=S.useCallback(($e,Pe)=>{n.current[$e]=Pe},[n]);return o.jsx(J,{ref:y,...a==null?void 0:a.boxProps,sx:[{width:"fit-content",height:"fit-content"},...Array.isArray((L=a==null?void 0:a.boxProps)==null?void 0:L.sx)?(B=(j=a==null?void 0:a.boxProps)==null?void 0:j.sx)!=null?B:[]:[(Y=a==null?void 0:a.boxProps)==null?void 0:Y.sx],E(!Q(i)&&Rs(r,i),{visibility:"hidden",width:0,height:0,m:0,p:0})],children:t.map(($e,Pe)=>s($e,Pe,T.includes(Pe),[xe.NONE,xe.BOTH].includes(r),O,i,d,f,h,b,p))})},Be=S.memo(_n),pn=({onLoad:e,onError:t,pageLoadStates:r,retryFailedPagesKeyPrefix:n,isPreloadMode:s,...a})=>{const{currentPageIndex:i,totalPages:l}=a;return o.jsx(Be,{...a,createPage:(c,g,u,d,f,...h)=>ye(c,g,!0,r[c.primary.index].loaded,s,e,t,u,d&&u&&i===c.primary.index,i,l,...h,r[c.primary.index].error?n:void 0),slots:{boxProps:{sx:{margin:"auto"}}}})},mn=S.memo(pn),nr=(e,t)=>{const r=t.findIndex(({primary:s,secondary:a})=>[s.index,a==null?void 0:a.index].includes(e));return{...t[Te(r,0,t.length-1)],pagesIndex:r}},et=e=>{var t,r;return(r=(t=e.secondary)==null?void 0:t.index)!=null?r:e.primary.index},eo=(e,t,r)=>{switch(e){case"previous":return et(r[Math.max(0,t-1)]);case"next":return et(r[Math.min(r.length-1,t+1)]);default:throw new Error('Unexpected offset "'.concat(e,'"'))}},to=(e,t,r,n,s,a)=>{const i=n?e.clientX:e.clientY,{paddingTop:l,paddingBottom:c,paddingLeft:g,paddingRight:u}=getComputedStyle(t),d=t.getBoundingClientRect(),f=n?parseFloat(g)+parseFloat(u):parseFloat(l)+parseFloat(c),h=n?d.left:d.top,p=(n?d.width:d.height)-f,m=i-h-f/2,_=r.length-+!s,y=p/_,R=Math.floor(m/y),T=(R+(s?1:.5))*y,O=m<=T?R:R+1,L=Math.max(0,O),j=Math.min(L,r.length-1),B=a(j,r.length-1-j);return r[B]},ro=e=>{const t=e===H.BOTTOM,r=e===H.LEFT,n=e===H.RIGHT;return{isBottom:t,isLeft:r,isRight:n,isHorizontal:t,isVertical:r||n}},Tt=(e,t,r)=>{const n=r===W.LTR;return e==="first"?t==="ltr"?n?"right":"left":n?"left":"right":t==="ltr"?n?"left":"right":n?"right":"left"},xn=({onLoad:e,onError:t,pageLoadStates:r,retryFailedPagesKeyPrefix:n,isPreloadMode:s,...a})=>{const{currentPageIndex:i,pages:l,totalPages:c,readingDirection:g,pageScaleMode:u}=a,{direction:d}=dt(),f=S.useMemo(()=>nr(i,l),[i,l]),h=g===W.LTR;return o.jsx(Be,{...a,createPage:(b,p,m,_,y,...R)=>{const{primary:T,secondary:O}=b,L=et(f),j=!!O,B=f.primary.index===T.index,Y=!!O&&L===O.index;return o.jsxs(S.Fragment,{children:[ye(b,p,!0,r[T.index].loaded,s,e,t,m,_&&B&&m,f.primary.index,c,...R,r[T.index].error?n:void 0,j?Tt("first",d,g):void 0,j),j&&ye({...b,primary:{...b.secondary}},p,!1,r[O.index].loaded,s,e,t,m,_&&Y&&m,L,c,...R,r[O.index].error?n:void 0,Tt("second",d,g),!0)]},"".concat(T.url,"_").concat(O==null?void 0:O.url))},slots:{boxProps:{sx:{...E(u===M.ORIGINAL,{margin:"auto"}),width:"100%",minWidth:"fit-content",height:"100%",minHeight:"fit-content",display:"flex",flexDirection:"row",flexWrap:"nowrap",...E(d==="ltr",{flexDirection:h?"row":"row-reverse"}),...E(d==="rtl",{flexDirection:h?"row-reverse":"row"})}}}})},vn=S.memo(xn),bn=({onLoad:e,onError:t,pageLoadStates:r,retryFailedPagesKeyPrefix:n,isPreloadMode:s,...a})=>{const{currentPageIndex:i,totalPages:l,readingMode:c,pageGap:g}=a,d=c===I.WEBTOON?0:g;return o.jsx(Be,{...a,createPage:(f,h,b,p,m,..._)=>ye(f,h,!0,r[f.primary.index].loaded,s,e,t,b,!s,i,l,..._,r[f.primary.index].error?n:void 0,void 0,void 0,f.primary.index!==0?d:0,m),slots:{boxProps:{sx:{margin:"auto"}}}})},Sn=S.memo(bn),En=({onLoad:e,onError:t,pageLoadStates:r,retryFailedPagesKeyPrefix:n,isPreloadMode:s,...a})=>{const{currentPageIndex:i,totalPages:l,pageGap:c,readingDirection:g}=a,{direction:u}=dt(),d=g===W.LTR;return o.jsx(Be,{...a,createPage:(f,h,b,p,m,..._)=>ye(f,h,!0,r[f.primary.index].loaded,s,e,t,b,!s,i,l,..._,r[f.primary.index].error?n:void 0,void 0,void 0,void 0,m),slots:{boxProps:{sx:{my:"auto",display:"flex",flexWrap:"nowrap",alignItems:"center",gap:"".concat(c,"px"),...E(u==="ltr",{flexDirection:d?"row":"row-reverse",justifyContent:d?"flex-start":"flex-end"}),...E(u==="rtl",{flexDirection:d?"row-reverse":"row",justifyContent:d?"flex-end":"flex-start"})}}}})},Rn=S.memo(En),yn=e=>e===I.DOUBLE_PAGE,ut=e=>[M.WIDTH,M.SCREEN].includes(e),no=e=>ut(e),so=e=>[M.HEIGHT,M.SCREEN].includes(e),sr=(e,t)=>!!(e!=null&&e.enabled)&&ut(t),Tn=(e,t)=>{if(sr(e,t))return e==null?void 0:e.value},Q=e=>[I.CONTINUOUS_VERTICAL,I.CONTINUOUS_HORIZONTAL,I.WEBTOON].includes(e),De=e=>[I.CONTINUOUS_VERTICAL,I.WEBTOON].includes(e),ao=(e,t,r)=>t&&r.isDefault&&sn.isLongStripType(e),oo=e=>{switch(e){case I.SINGLE_PAGE:return mn;case I.DOUBLE_PAGE:return vn;case I.CONTINUOUS_VERTICAL:case I.WEBTOON:return Sn;case I.CONTINUOUS_HORIZONTAL:return Rn;default:throw new Error('Unexpected "ReadingMode" ('.concat(e,")"))}},io=(e,t,r=0,n=0)=>e!==H.AUTO?e:window.innerHeight-r>window.innerWidth-n?t:H.BOTTOM,At=e=>{let t;const r=new Set,n=(g,u)=>{const d=typeof g=="function"?g(t):g;if(!Object.is(d,t)){const f=t;t=(u!=null?u:typeof d!="object"||d===null)?d:Object.assign({},t,d),r.forEach(h=>h(t,f))}},s=()=>t,l={setState:n,getState:s,getInitialState:()=>c,subscribe:g=>(r.add(g),()=>r.delete(g))},c=t=e(n,s,l);return l},An=e=>e?At(e):At,Pn=e=>e;function On(e,t=Pn){const r=he.useSyncExternalStore(e.subscribe,he.useCallback(()=>t(e.getState()),[e,t]),he.useCallback(()=>t(e.getInitialState()),[e,t]));return he.useDebugValue(r),r}const Pt=e=>{const t=An(e),r=n=>On(t,n);return Object.assign(r,t),r},Cn=e=>e?Pt(e):Pt,Ot={BASE_URL:"./",DEV:!1,LEGACY:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SERVER_URL_DEFAULT:"http://localhost:4567"},Se=new Map,Oe=e=>{const t=Se.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([r,n])=>[r,n.getState()])):{}},In=(e,t,r)=>{if(e===void 0)return{type:"untracked",connection:t.connect(r)};const n=Se.get(r.name);if(n)return{type:"tracked",store:e,...n};const s={connection:t.connect(r),stores:{}};return Se.set(r.name,s),{type:"tracked",store:e,...s}},jn=(e,t)=>{if(t===void 0)return;const r=Se.get(e);r&&(delete r.stores[t],Object.keys(r.stores).length===0&&Se.delete(e))},Dn=e=>{var t,r;if(!e)return;const n=e.split("\n"),s=n.findIndex(i=>i.includes("api.setState"));if(s<0)return;const a=((t=n[s+1])==null?void 0:t.trim())||"";return(r=/.+ (.+) .+/.exec(a))==null?void 0:r[1]},wn=(e,t={})=>(r,n,s)=>{const{enabled:a,anonymousActionType:i,store:l,...c}=t;let g;try{g=(a!=null?a:(Ot?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(p){}if(!g)return e(r,n,s);const{connection:u,...d}=In(l,g,c);let f=!0;s.setState=(p,m,_)=>{const y=r(p,m);if(!f)return y;const R=_===void 0?{type:i||Dn(new Error().stack)||"anonymous"}:typeof _=="string"?{type:_}:_;return l===void 0?(u==null||u.send(R,n()),y):(u==null||u.send({...R,type:"".concat(l,"/").concat(R.type)},{...Oe(c.name),[l]:s.getState()}),y)},s.devtools={cleanup:()=>{u&&typeof u.unsubscribe=="function"&&u.unsubscribe(),jn(c.name,l)}};const h=(...p)=>{const m=f;f=!1,r(...p),f=m},b=e(s.setState,n,s);if(d.type==="untracked"?u==null||u.init(b):(d.stores[d.store]=s,u==null||u.init(Object.fromEntries(Object.entries(d.stores).map(([p,m])=>[p,p===d.store?b:m.getState()])))),s.dispatchFromDevtools&&typeof s.dispatch=="function"){let p=!1;const m=s.dispatch;s.dispatch=(..._)=>{(Ot?"production":void 0)!=="production"&&_[0].type==="__setState"&&!p&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),p=!0),m(..._)}}return u.subscribe(p=>{var m;switch(p.type){case"ACTION":if(typeof p.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return Ke(p.payload,_=>{if(_.type==="__setState"){if(l===void 0){h(_.state);return}Object.keys(_.state).length!==1&&console.error('\n                    [zustand devtools middleware] Unsupported __setState action format.\n                    When using \'store\' option in devtools(), the \'state\' should have only one key, which is a value of \'store\' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }\n                    ');const y=_.state[l];if(y==null)return;JSON.stringify(s.getState())!==JSON.stringify(y)&&h(y);return}s.dispatchFromDevtools&&typeof s.dispatch=="function"&&s.dispatch(_)});case"DISPATCH":switch(p.payload.type){case"RESET":return h(b),l===void 0?u==null?void 0:u.init(s.getState()):u==null?void 0:u.init(Oe(c.name));case"COMMIT":if(l===void 0){u==null||u.init(s.getState());return}return u==null?void 0:u.init(Oe(c.name));case"ROLLBACK":return Ke(p.state,_=>{if(l===void 0){h(_),u==null||u.init(s.getState());return}h(_[l]),u==null||u.init(Oe(c.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Ke(p.state,_=>{if(l===void 0){h(_);return}JSON.stringify(s.getState())!==JSON.stringify(_[l])&&h(_[l])});case"IMPORT_STATE":{const{nextLiftedState:_}=p.payload,y=(m=_.computedStates.slice(-1)[0])==null?void 0:m.state;if(!y)return;h(l===void 0?y:y[l]),u==null||u.send(null,_);return}case"PAUSE_RECORDING":return f=!f}return}}),b},Ln=wn,Ke=(e,t)=>{let r;try{r=JSON.parse(e)}catch(n){console.error("[zustand devtools middleware] Could not parse the received json",n)}r!==void 0&&t(r)};var ar=Symbol.for("immer-nothing"),Ct=Symbol.for("immer-draftable"),N=Symbol.for("immer-state");function G(e,...t){throw new Error("[Immer] minified error nr: ".concat(e,". Full error at: https://bit.ly/3cXEKWf"))}var le=Object.getPrototypeOf;function ce(e){return!!e&&!!e[N]}function ne(e){var t;return e?or(e)||Array.isArray(e)||!!e[Ct]||!!((t=e.constructor)!=null&&t[Ct])||Ge(e)||He(e):!1}var Mn=Object.prototype.constructor.toString();function or(e){if(!e||typeof e!="object")return!1;const t=le(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Mn}function Le(e,t){Fe(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,n)=>t(n,r,e))}function Fe(e){const t=e[N];return t?t.type_:Array.isArray(e)?1:Ge(e)?2:He(e)?3:0}function tt(e,t){return Fe(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function ir(e,t,r){const n=Fe(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function Nn(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function Ge(e){return e instanceof Map}function He(e){return e instanceof Set}function ee(e){return e.copy_||e.base_}function rt(e,t){if(Ge(e))return new Map(e);if(He(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=or(e);if(t===!0||t==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(e);delete n[N];let s=Reflect.ownKeys(n);for(let a=0;a<s.length;a++){const i=s[a],l=n[i];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(n[i]={configurable:!0,writable:!0,enumerable:l.enumerable,value:e[i]})}return Object.create(le(e),n)}else{const n=le(e);if(n!==null&&r)return{...e};const s=Object.create(n);return Object.assign(s,e)}}function gt(e,t=!1){return ze(e)||ce(e)||!ne(e)||(Fe(e)>1&&(e.set=e.add=e.clear=e.delete=kn),Object.freeze(e),t&&Object.entries(e).forEach(([r,n])=>gt(n,!0))),e}function kn(){G(2)}function ze(e){return Object.isFrozen(e)}var Un={};function se(e){const t=Un[e];return t||G(0,e),t}var Ee;function lr(){return Ee}function Vn(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function It(e,t){t&&(se("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function nt(e){st(e),e.drafts_.forEach(Bn),e.drafts_=null}function st(e){e===Ee&&(Ee=e.parent_)}function jt(e){return Ee=Vn(Ee,e)}function Bn(e){const t=e[N];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Dt(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[N].modified_&&(nt(t),G(4)),ne(e)&&(e=Me(t,e),t.parent_||Ne(t,e)),t.patches_&&se("Patches").generateReplacementPatches_(r[N].base_,e,t.patches_,t.inversePatches_)):e=Me(t,r,[]),nt(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==ar?e:void 0}function Me(e,t,r){if(ze(t))return t;const n=t[N];if(!n)return Le(t,(s,a)=>wt(e,n,t,s,a,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return Ne(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const s=n.copy_;let a=s,i=!1;n.type_===3&&(a=new Set(s),s.clear(),i=!0),Le(a,(l,c)=>wt(e,n,s,l,c,r,i)),Ne(e,s,!1),r&&e.patches_&&se("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function wt(e,t,r,n,s,a,i){if(ce(s)){const l=a&&t&&t.type_!==3&&!tt(t.assigned_,n)?a.concat(n):void 0,c=Me(e,s,l);if(ir(r,n,c),ce(c))e.canAutoFreeze_=!1;else return}else i&&r.add(s);if(ne(s)&&!ze(s)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Me(e,s),(!t||!t.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&Ne(e,s)}}function Ne(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&gt(t,r)}function Fn(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:lr(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=n,a=ht;r&&(s=[n],a=Re);const{revoke:i,proxy:l}=Proxy.revocable(s,a);return n.draft_=l,n.revoke_=i,l}var ht={get(e,t){if(t===N)return e;const r=ee(e);if(!tt(r,t))return Gn(e,r,t);const n=r[t];return e.finalized_||!ne(n)?n:n===Xe(e.base_,t)?(Je(e),e.copy_[t]=ot(n,e)):n},has(e,t){return t in ee(e)},ownKeys(e){return Reflect.ownKeys(ee(e))},set(e,t,r){const n=cr(ee(e),t);if(n!=null&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const s=Xe(ee(e),t),a=s==null?void 0:s[N];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(Nn(r,s)&&(r!==void 0||tt(e.base_,t)))return!0;Je(e),at(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return Xe(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,Je(e),at(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=ee(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){G(11)},getPrototypeOf(e){return le(e.base_)},setPrototypeOf(){G(12)}},Re={};Le(ht,(e,t)=>{Re[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Re.deleteProperty=function(e,t){return Re.set.call(this,e,t,void 0)};Re.set=function(e,t,r){return ht.set.call(this,e[0],t,r,e[0])};function Xe(e,t){const r=e[N];return(r?ee(r):e)[t]}function Gn(e,t,r){var s;const n=cr(t,r);return n?"value"in n?n.value:(s=n.get)==null?void 0:s.call(e.draft_):void 0}function cr(e,t){if(!(t in e))return;let r=le(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=le(r)}}function at(e){e.modified_||(e.modified_=!0,e.parent_&&at(e.parent_))}function Je(e){e.copy_||(e.copy_=rt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Hn=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){const a=r;r=t;const i=this;return function(c=a,...g){return i.produce(c,u=>r.call(this,u,...g))}}typeof r!="function"&&G(6),n!==void 0&&typeof n!="function"&&G(7);let s;if(ne(t)){const a=jt(this),i=ot(t,void 0);let l=!0;try{s=r(i),l=!1}finally{l?nt(a):st(a)}return It(a,n),Dt(s,a)}else if(!t||typeof t!="object"){if(s=r(t),s===void 0&&(s=t),s===ar&&(s=void 0),this.autoFreeze_&&gt(s,!0),n){const a=[],i=[];se("Patches").generateReplacementPatches_(t,s,a,i),n(a,i)}return s}else G(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(i,...l)=>this.produceWithPatches(i,c=>t(c,...l));let n,s;return[this.produce(t,r,(i,l)=>{n=i,s=l}),n,s]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){ne(e)||G(8),ce(e)&&(e=zn(e));const t=jt(this),r=ot(e,void 0);return r[N].isManual_=!0,st(t),r}finishDraft(e,t){const r=e&&e[N];(!r||!r.isManual_)&&G(9);const{scope_:n}=r;return It(n,t),Dt(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const s=t[r];if(s.path.length===0&&s.op==="replace"){e=s.value;break}}r>-1&&(t=t.slice(r+1));const n=se("Patches").applyPatches_;return ce(e)?n(e,t):this.produce(e,s=>n(s,t))}};function ot(e,t){const r=Ge(e)?se("MapSet").proxyMap_(e,t):He(e)?se("MapSet").proxySet_(e,t):Fn(e,t);return(t?t.scope_:lr()).drafts_.push(r),r}function zn(e){return ce(e)||G(10,e),dr(e)}function dr(e){if(!ne(e)||ze(e))return e;const t=e[N];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=rt(e,t.scope_.immer_.useStrictShallowCopy_)}else r=rt(e,!0);return Le(r,(n,s)=>{ir(r,n,dr(s))}),t&&(t.finalized_=!1),r}var k=new Hn,$n=k.produce;k.produceWithPatches.bind(k);k.setAutoFreeze.bind(k);k.setUseStrictShallowCopy.bind(k);k.applyPatches.bind(k);k.createDraft.bind(k);k.finishDraft.bind(k);const Wn=e=>(t,r,n)=>(n.setState=(s,a,...i)=>{const l=typeof s=="function"?$n(s):s;return t(l,a,...i)},e(n.setState,r,n)),Yn=Wn,Lt=e=>Symbol.iterator in e,Mt=e=>"entries"in e,Nt=(e,t)=>{const r=e instanceof Map?e:new Map(e.entries()),n=t instanceof Map?t:new Map(t.entries());if(r.size!==n.size)return!1;for(const[s,a]of r)if(!n.has(s)||!Object.is(a,n.get(s)))return!1;return!0},Zn=(e,t)=>{const r=e[Symbol.iterator](),n=t[Symbol.iterator]();let s=r.next(),a=n.next();for(;!s.done&&!a.done;){if(!Object.is(s.value,a.value))return!1;s=r.next(),a=n.next()}return!!s.done&&!!a.done};function Kn(e,t){return Object.is(e,t)?!0:typeof e!="object"||e===null||typeof t!="object"||t===null||Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?!1:Lt(e)&&Lt(t)?Mt(e)&&Mt(t)?Nt(e,t):Zn(e,t):Nt({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})}function Xn(e){const t=he.useRef(void 0);return r=>{const n=e(r);return Kn(t.current,n)?t.current:t.current=n}}const kt={isVisible:!1},Jn=(...[e,t,r])=>({overlay:{isVisible:kt.isVisible,setIsVisible:n=>t(s=>{s.overlay.isVisible=n},void 0,e("setIsVisible")),reset:()=>({overlay:{...r().overlay,...kt}})}}),Ut={isActive:!1,isPaused:!1,start:ue,cancel:ue,toggleActive:ue,pause:ue,resume:ue,invert:!1,direction:Or.FORWARD,scrollRef:void 0},Qn=(...[e,t,r])=>({autoScroll:{...Ut,reset:()=>({autoScroll:{...r().autoScroll,...Ut}}),setIsActive:n=>t(s=>{s.autoScroll.isActive=n},void 0,e("setIsActive")),setIsPaused:n=>t(s=>{s.autoScroll.isPaused=n},void 0,e("setIsPaused")),setStart:n=>t(s=>{s.autoScroll.start=n},void 0,e("setStart")),setCancel:n=>t(s=>{s.autoScroll.cancel=n},void 0,e("setCancel")),setToggleActive:n=>t(s=>{s.autoScroll.toggleActive=n},void 0,e("setToggleActive")),setPause:n=>t(s=>{s.autoScroll.pause=n},void 0,e("setPause")),setResume:n=>t(s=>{s.autoScroll.resume=n},void 0,e("setResume")),setInvert:n=>t(s=>{s.autoScroll.invert=n},void 0,e("setInvert")),setDirection:n=>t(s=>{s.autoScroll.direction=n},void 0,e("setDirection")),setScrollRef:n=>t(s=>{if(!n){s.autoScroll.scrollRef=void 0;return}const a=S.createRef();a.current=n,s.autoScroll.scrollRef=a},void 0,e("setScrollRef"))}}),Vt={isMaximized:!1,isDragging:!1},qn=(...[e,t,r])=>({progressBar:{...Vt,setIsMaximized:n=>t(s=>{s.progressBar.isMaximized=n},void 0,e("setIsMaximized")),setIsDragging:n=>t(s=>{s.progressBar.isDragging=n},void 0,e("setIsDragging")),reset:()=>({progressBar:{...r().progressBar,...Vt}})}}),Bt={showPreview:!1},es=(...[e,t,r])=>({tapZone:{...Bt,setShowPreview:n=>t(s=>{s.tapZone.showPreview=n},void 0,e("setShowPreview")),reset:()=>({tapZone:{...r().tapZone,...Bt}})}}),Ft={totalPages:0,currentPageIndex:0,pageToScrollToIndex:null,pageUrls:[],pageLoadStates:[{url:"",loaded:!1}],pages:[{name:"1",primary:{index:0,alt:"Page #1",url:"".concat(K.getBaseUrl())}}],transitionPageMode:xe.NONE,retryFailedPagesKeyPrefix:""},ts=(...[e,t,r])=>({pages:{...Ft,reset:()=>({pages:{...r().pages,...Ft}}),setCurrentPageIndex:n=>t(s=>{s.pages.currentPageIndex=n},void 0,e("setCurrentPageIndex")),setPageToScrollToIndex:n=>t(s=>{s.pages.pageToScrollToIndex=n},void 0,e("setPageToScrollToIndex")),setTotalPages:n=>t(s=>{s.pages.totalPages=n},void 0,e("setTotalPages")),setPageUrls:n=>t(s=>{s.pages.pageUrls=n},void 0,e("setPageUrls")),setPageLoadStates:n=>t(s=>{if(typeof n=="function"){s.pages.pageLoadStates=n(r().pages.pageLoadStates);return}s.pages.pageLoadStates=n},void 0,e("setPageLoadStates")),setPages:n=>t(s=>{s.pages.pages=n},void 0,e("setPages")),setTransitionPageMode:n=>t(s=>{s.pages.transitionPageMode=n},void 0,e("setTransitionPageMode")),setRetryFailedPagesKeyPrefix:n=>t(s=>{s.pages.retryFailedPagesKeyPrefix=n},void 0,e("setRetryFailedPagesKeyPrefix"))}}),Gt={chapters:{mangaChapters:void 0,chapters:[],chapterForDuplicatesHandling:void 0,initialChapter:void 0,currentChapter:void 0,nextChapter:void 0,previousChapter:void 0,isCurrentChapterReady:!1,visibleChapters:{leading:0,trailing:0,lastLeadingChapterSourceOrder:99999,lastTrailingChapterSourceOrder:-1,isLeadingChapterPreloadMode:!0,isTrailingChapterPreloadMode:!0,scrollIntoView:!1,resumeMode:void 0}}},rs=(...[e,t,r])=>({chapters:{...Gt.chapters,reset:()=>({chapters:{...r().chapters,...Gt.chapters}}),setReaderStateChapters:n=>t(s=>{if(typeof n=="function"){s.chapters={...r().chapters,...n(r().chapters)};return}s.chapters={...r().chapters,...n}},void 0,e("setReaderStateChapters"))}});class ke{static createActionName(...t){const r=t.slice(0,-1),n=t.slice(-1)[0];return"".concat(r.join(":"),"/").concat(n)}static createActionNameCreator(t,r=ke.createActionName){return(...n)=>r(t,...n)}}const ns=["scrollRef"],Ce={manga:void 0,scrollbar:{xSize:0,ySize:0}},X=Cn()(Ln(Yn((e,t,r)=>{const n=ke.createActionNameCreator("reader"),s=a=>ke.createActionNameCreator(a,n);return{...Ce,reset:()=>e(()=>({...t(),...Ce,scrollbar:{...t().scrollbar,...Ce.scrollbar},settings:{...t().settings,...Rt},...t().overlay.reset(),...t().autoScroll.reset(),...t().pages.reset(),...t().chapters.reset(),...t().progressBar.reset(),...t().tapZone.reset()}),void 0,n("reset")),setManga:a=>e(i=>{i.manga=a},void 0,n("setManga")),scrollbar:{...Ce.scrollbar,setXSize:a=>e(i=>{i.scrollbar.xSize=a},void 0,n("scrollbar","setXSize")),setYSize:a=>e(i=>{i.scrollbar.ySize=a},void 0,n("scrollbar","setYSize"))},settings:{...Rt,setSettings:a=>e(i=>{i.settings={...t().settings,...a}},void 0,n("settings","setSettings"))},...Jn(s("overlay"),e,t,r),...Qn(s("autoScroll"),e,t,r),...ts(s("pages"),e,t,r),...rs(s("chapters"),e,t,r),...qn(s("progressBar"),e,t,r),...es(s("tapZone"),e,t,r)}}),{name:"ReaderStore",anonymousActionType:"reader/action",serialize:{replacer:(e,t)=>ns.includes(e)?null:t}})),q=e=>X(Xn(e)),Ie=()=>X.getState(),ss=q,lo=()=>X.getState().scrollbar,Qe=q,as=()=>X.getState().settings,co=q,uo=()=>X.getState().overlay,go=q,ho=()=>X.getState().autoScroll,fo=q,_o=()=>X.getState().pages,po=q,os=()=>X.getState().chapters,mo=q,is=q,xo=()=>X.getState().tapZone,ls=e=>Object.keys(e).map(t=>{const r=t,n=e[r];switch(r){case"brightness":case"contrast":case"saturate":return n.enabled?"".concat(r,"(").concat(n.value/100,")"):"";case"hue":return n.enabled?"hue-rotate(".concat(n.value,"deg)"):"";case"rgba":return"";case"sepia":case"grayscale":case"invert":return n?"".concat(r,"(").concat(Number(n),")"):"";default:throw new Error('Unexpected "CustomFilter" ('.concat(r,")"))}}).join(" "),cs=({pageIndex:e,pagesIndex:t,isPrimaryPage:r,display:n,doublePage:s=!1,position:a,marginTop:i,shouldLoad:l,readingMode:c,customFilter:g,pageScaleMode:u,shouldStretchPage:d,readerWidth:f,onLoad:h,onError:b,setRef:p,readerNavBarWidth:m,isLoaded:_,...y})=>{const{src:R}=y,T=Ue.useIsTabletWidth(),O=ss(Y=>Y.scrollbar),L=S.useCallback(()=>h==null?void 0:h(t,R,r),[h,t,R,r]),j=S.useCallback(()=>b==null?void 0:b(e,R),[b,e,R]),B=S.useCallback(Y=>p==null?void 0:p(t,Y),[t,p]);return!n&&!l?null:o.jsx(an,{...y,onLoad:L,onError:j,shouldLoad:l,shouldDecode:!0,ref:B,spinnerStyle:{backgroundColor:"background.paper",...gs(c,d,u,f,m+O.ySize,O.xSize,s,T),...E(!n,{display:"none"}),...Ht(s,a)},imgStyle:{...fs(c,d,u,s,f,m+O.ySize,O.xSize),filter:ls(g),objectFit:"contain",objectPosition:a,userSelect:"none",...Ht(s,a),...E(i!==void 0,{mt:"".concat(i,"px")}),display:"block",...E(!n,{display:"none"}),...E(!_,{margin:"unset"})},hideImgStyle:{visibility:"hidden",minWidth:0,minHeight:0,width:0,height:0}})},ds=S.memo(cs),us=(e,t,r,n)=>{if(sr(r,e)){const s=r.value;return t?s/100/2:s/100}return t?.5:1},gs=(e,t,r,n,s,a,i,l)=>{const g=R=>"calc(".concat(R," - ").concat(s,"px)"),u=(R,T)=>g("".concat(Te(T!=null?T:R,Math.min(R,T!=null?T:9e3),R),"vw")),d=Tn(n,r),f=g("".concat(Math.min(100,d!=null?d:9e3),"vw")),h="calc(100vh - ".concat(a,"px)"),b=l?f:u(40,d),p=l?h:"85vh",_={...{[I.SINGLE_PAGE]:{minWidth:b,minHeight:p},[I.DOUBLE_PAGE]:{minWidth:l?"50vw":u(35,d?d/2:void 0),minHeight:p},[I.CONTINUOUS_VERTICAL]:{minWidth:b,minHeight:"100vh"},[I.CONTINUOUS_HORIZONTAL]:{minWidth:b,minHeight:p},[I.WEBTOON]:{minWidth:b,minHeight:"100vh"}}[e],height:"unset"},y=i?"calc(".concat(g("".concat(d!=null?d:100,"vw"))," / 2)"):f;switch(r){case M.WIDTH:return{..._,...E(t,{minWidth:y})};case M.HEIGHT:return{..._,...E(t,{minHeight:h,...E(De(e),{minHeight:"100vh"})})};case M.SCREEN:return{..._,...E(t,{minWidth:y,minHeight:h,...E(De(e),{minHeight:"100vh"})})};case M.ORIGINAL:return{..._,...E(De(e),{height:void 0})};default:throw new Error('Unexpected "PageScaleMode" ('.concat(r,")"))}},hs=(e,t,r,n,s,a)=>{const i="calc((100vw - ".concat(s,"px) * ").concat(e,")"),l="calc(100vh - ".concat(a,"px)");switch(n){case M.WIDTH:return{minWidth:0,...E(Q(t),{minWidth:"unset"}),...E(r,{minWidth:i}),maxWidth:i};case M.HEIGHT:return{minHeight:0,...E(Q(t),{minHeight:"unset"}),...E(r,{minHeight:l}),maxHeight:l};case M.SCREEN:return{minWidth:0,minHeight:0,...E(Q(t),{minWidth:"unset",minHeight:"unset"}),...E(r,{minWidth:i,minHeight:l,...E(t===I.CONTINUOUS_HORIZONTAL,{minWidth:"unset",minHeight:l}),...E(De(t),{minWidth:i,minHeight:"unset"})}),maxWidth:i,maxHeight:l};case M.ORIGINAL:return{};default:throw new Error('Unexpected "PageScaleMode" ('.concat(n,")"))}},fs=(e,t,r,n,s,a,i)=>{const l=us(r,n,s);return hs(l,e,t,r,a,i)},Ht=(e,t)=>({m:"auto",...E(e,{...E(t==="right",{mr:"unset "}),...E(t==="left",{ml:"unset "})})}),it=(e,t)=>({index:t,alt:"Page #".concat(t+1),url:"".concat(K.getBaseUrl()).concat(e)}),_s=(e,t)=>({name:"".concat(t+1),primary:it(e,t)}),vo=e=>e.map(_s),ps=(e,t,r,n,s)=>{if(!n||s)return Number.MAX_SAFE_INTEGER;const a=Math.abs(t-e),i=r-a;return t<e?i-1:i},ye=({primary:{index:e,alt:t,url:r}},n,s,a,i,l,c,g,u,d,f,h,b,p,m,_,y,R,T,O,L,j)=>o.jsx(ds,{setRef:j,pageIndex:e,pagesIndex:n,isPrimaryPage:s,src:r,alt:t,display:u,priority:ps(d,e,f,g,i),position:T,onLoad:l,onError:c,doublePage:O,shouldLoad:g,retryKeyPrefix:R,marginTop:L,isLoaded:a,readingMode:h,customFilter:b,pageScaleMode:p,shouldStretchPage:m,readerWidth:_,readerNavBarWidth:y},r),ur=(e,t)=>{const{top:r,bottom:n,left:s,right:a}=e.getBoundingClientRect(),i={top:0,bottom:0,left:0,right:0,...t},l=s>=i.left&&s<=window.innerWidth,c=a>=i.right&&a<=window.innerWidth,g=s<=0&&a>=window.innerWidth,u=r>=i.top&&r<=window.innerHeight,d=n>=i.bottom&&n<=window.innerHeight,f=r<=0&&n>=window.innerHeight;return{isLeftInViewport:l,isRightInViewport:c,isFillingWidthViewportCompletely:g,isTopInViewport:u,isBottomInViewport:d,isFillingHeightViewportCompletely:f}},bo=(e,t,r)=>{const{isLeftInViewport:n,isRightInViewport:s,isFillingWidthViewportCompletely:a,isTopInViewport:i,isBottomInViewport:l,isFillingHeightViewportCompletely:c}=ur(e,r),g=n||s||a,u=i||l||c;switch(t){case we.X:return g;case we.Y:return u;default:throw new Error('unexpected "type" ('.concat(t,")"))}},So=(e,t,r)=>{const{isLeftInViewport:n,isRightInViewport:s,isBottomInViewport:a}=ur(e);switch(t){case we.X:return r===W.LTR?s:n;case we.Y:return a;default:throw new Error('unexpected "type" ('.concat(t,")"))}},Eo=(e,t,r,n)=>{const s=[],a=t.map((i,l)=>l+t.slice(0,l).filter(({isSpread:c})=>c).length);return e.forEach((i,l)=>{var j;const g=!(a[l]%2),u=(g?1:-1)*(r?-1:1),d=l+u,f=l<d,h=l===0,b=l===e.length-1,p=f&&!b,m=t[l].isSpread,_=!!((j=t[d])!=null&&j.isSpread),T=!(m||_)&&!(h&&r);if(!f&&T){const B=s[s.length-1];s[s.length-1]={...B,secondary:it(i,l)};return}const O="-",L="".concat(l+1).concat(p&&T?"".concat(O).concat(d+1):"");s.push({name:n===W.LTR?L:on(L,O),primary:it(i,l)})}),s},ms=e=>e.height/e.width<1,xs=0,vs=1,bs=(e,t,r,n)=>e?n:t||r?Te(vs,xs,n):0,Ss=2,Es=(e,t,r,n,s,a,i,l)=>{if(!a&&!i&&!l)return[];const c=nr(e,t).pagesIndex,g=bs(a,i,l,n),u=r<=e&&!i?1:-1,d=Math.max(0,c-Math.min(Ss,g)*u),f=Q(s)?e:d,h=c+g*u,b=Math.max(1,Math.abs(h-f)+Number(a));return Array(b).fill(1).map((p,m)=>f+m*u)},Ro=(e,t,r)=>[xe.BOTH,e].includes(t)||Q(r),Rs=(e,t)=>e!==xe.NONE||Q(t),yo=(e,t,r)=>{const n=Zt[r];return t==="ltr"?e===te.PREVIOUS?ie("start","end",n):ie("start","end",n):e===te.PREVIOUS?ie("end","start",n):ie("end","start",n)},To=(e,t,r)=>{const n=Zt[r];return t==="ltr"?ie(0,e.scrollWidth,n):ie(-e.scrollWidth,0,n)},gr=(e,t)=>t===void 0||t.url!==e,ys=(e,t,r)=>e===$.START?0:e===$.END?r:Te(t,0,r),pe=e=>F.getFromCache(e,Cr,"CHAPTER_READER_FIELDS"),Ts=(e,t,r,n,s,a,i)=>{if(!(!!n.isRead&&!!s))return[];const c=[e,...r][s-1];if(!c)return[];const u=(i?F.addDuplicates([c],t):[c]).map(({id:d})=>pe(d)).filter(d=>d!==null).filter(d=>F.isDeletable(d,a));return u.length?F.getIds(u):[]},hr=(e,t,r=te.NEXT)=>{const n=(e+1)/t;return r===te.PREVIOUS?n<.75:n>.25},As=(e,t,r,n,s)=>{const a=pe(e.id);if(!a||!t)return[];if(!(!!s&&a.isDownloaded&&hr(n,a.pageCount)))return[];const c=pe(t.id);return c!=null&&c.isDownloaded?F.getNonRead(r).map(u=>pe(u.id)).filter(u=>!!u).slice(-s).filter(u=>!u.isDownloaded).map(u=>u.id).filter(u=>!F.isDownloading(u)):[]},Ao=(e,t,r,n)=>(s,a,i=!0)=>{if(s>e.length-1)return;const l=e[s],{index:c}=i?l.primary:l.secondary;if(n===I.DOUBLE_PAGE){const g=new Image;g.onload=()=>{const u=ms(g);u&&t(d=>{const f=d[c];return f===void 0||f.url!==a||f.isSpread===u?d:d.toSpliced(c,1,{url:a,isSpread:u})})},g.crossOrigin="anonymous",g.src=a}r(g=>{const u=g[c];return gr(a,u)||u.loaded?g:g.toSpliced(c,1,{url:u.url,loaded:!0})})},Po=(e,t)=>{if(e)return t?$.END:$.START},Oo=e=>(t,r)=>{e(n=>{const s=n[t];return gr(r,s)?n:n.toSpliced(t,1,{...s,loaded:!1,error:!0})})},Ps=(e,t,r,n,s,a)=>{const{leading:i,trailing:l,lastLeadingChapterSourceOrder:c,lastTrailingChapterSourceOrder:g}=t.visibleChapters,u=e&&r<c,d=!e&&r>g;return{...t,visibleChapters:{...t.visibleChapters,leading:i+Number(u),trailing:l+Number(d),lastLeadingChapterSourceOrder:u?r:c,lastTrailingChapterSourceOrder:d?r:g,isLeadingChapterPreloadMode:s!==void 0?s:t.visibleChapters.isLeadingChapterPreloadMode,isTrailingChapterPreloadMode:a!==void 0?a:t.visibleChapters.isTrailingChapterPreloadMode,scrollIntoView:n,resumeMode:e?$.END:$.START}}},Co=(e,t,r,n,s,a,i,l)=>{if(n){if(s)return Te(e,0,t.pageCount-1);if(l.scrollIntoView&&l.resumeMode!==void 0)return ys(l.resumeMode,0,t.pageCount-1);if(a)return Math.max(0,t.pageCount-1);if(i)return 0}return t.sourceOrder<r.sourceOrder?Math.max(t.pageCount-1,0):0},Io=(e,t,r,n,s,a)=>e&&s!==void 0?s:t?a:r?$.END:n?$.START:$.START,jo=(e,t,r)=>{const n=!!t[e+1],a=e+1>=t.length-1&&r.isLeadingChapterPreloadMode,i=n&&!a,l=!!t[e-1],g=e-1<=0&&r.isTrailingChapterPreloadMode;return{previous:i,next:l&&!g}},Os={ltr:"rtl",rtl:"ltr"},Cs={ltr:W.LTR,rtl:W.RTL},Z=class Z{static getOrCreateChapterUpdateQueue(t){return Z.chapterUpdateQueues.has(t)||Z.chapterUpdateQueues.set(t,new ft(1)),Z.chapterUpdateQueues.get(t)}static navigateToChapter(t,r){Ir.navigate(F.getReaderUrl(t),{replace:!0,state:r})}static downloadAhead(t,r,n,s,a){const i="".concat(t.id,"_").concat(r==null?void 0:r.id,"_").concat(s,"_").concat(a);Z.downloadAheadQueue.enqueue(i,async()=>{const l=As(t,r,n,s,a);if(l.length)try{await F.download(l)}catch(c){}})}static preloadChapter(t,r,n,s,a,i,l){if(!n)return;const c=l===te.PREVIOUS,g=l===te.NEXT;!(c&&s<=n.sourceOrder||g&&a>=n.sourceOrder)&&hr(t,r,l)&&i(f=>Ps(c,f,n.sourceOrder,!1,c?!0:void 0,g?!0:void 0))}static useUpdateChapter(){const{settings:{deleteChaptersWhileReading:t,deleteChaptersWithBookmark:r,updateProgressAfterReading:n}}=jr();return S.useCallback(s=>{const{manga:a}=Ie(),{currentChapter:i,mangaChapters:l,chapters:c}=os(),{shouldSkipDupChapters:g}=as();if(!a||!i||!l)return;const u=F.getNextChapters(i,c,{offset:te.PREVIOUS}),d=async()=>{const f=F.getIds(g?F.addDuplicates([i],l):[i]),h=Ts(i,l,u,s,t,r,g);(h.length||f.some(p=>{const m=pe(p);return m?s.isRead!==void 0&&s.isRead!==m.isRead||s.lastPageRead!==void 0&&s.lastPageRead!==m.lastPageRead||s.isBookmarked!==void 0&&s.isBookmarked!==m.isBookmarked:!1}))&&await K.updateChapters(f,{...s,chapterIdsToDelete:h,trackProgressMangaId:n&&s.isRead&&a.trackRecords.totalCount?a.id:void 0},{errorPolicy:"all"}).response.catch(kr())};Z.getOrCreateChapterUpdateQueue(i.id).enqueue("".concat(i.id),d)},[t,r,n])}static useGetThemeDirection(){const{direction:t}=dt(),r=Qe(n=>n.settings.readingDirection.value);return Cs[t]===r?t:Os[t]}static updateSetting(t,r,n=!0,s=!1,a){const{manga:i}=Ie(),l=i!=null?i:s?St:i;if(!l||l.id===Et.id)return;const c=_t(t,a!==void 0?[a==null?void 0:a.toString()]:void 0),{cache:g}=K.graphQLClient.client;if(s||me.includes(t)){const d=g.writeFragment({fragment:Dr,data:{__typename:"GlobalMetaType",key:c,value:JSON.stringify(r)}});g.modify({fields:{metas(f,{readField:h}){return{...f,nodes:pt(c,f==null?void 0:f.nodes,h,()=>d)}}}})}else{const d=g.writeFragment({fragment:wr,data:{__typename:"MangaMetaType",mangaId:l.id,key:c,value:JSON.stringify(r)}});g.modify({id:g.identify({__typename:"MangaType",id:l.id}),fields:{meta(f,{readField:h}){return pt(c,f,h,()=>d)}}})}n&&fn(l,t,r,s,a).catch(d=>mt(vt("reader.settings.error.label.failed_to_save_settings"),"error",xt(d)))}static deleteSetting(t,r=!1,n){const{manga:s}=Ie(),a=s!=null?s:r?St:s;if(!a||a.id===Et.id)return;const i=_t(t,n!==void 0?[n]:void 0),{cache:l}=K.graphQLClient.client,c=r||me.includes(t);c?l.evict({id:l.identify({__typename:"GlobalMetaType",key:i})}):l.evict({id:l.identify({__typename:"MangaMetaType",mangaId:a.id,key:i})}),(c?()=>K.deleteGlobalMeta(i).response:()=>K.deleteMangaMeta(a.id,i).response)().catch(u=>mt(vt("reader.settings.error.label.failed_to_save_settings"),"error",xt(u)))}static useOverlayMode(){const t=Ue.useIsTouchDevice(),r=Qe(c=>c.settings.overlayMode),n=r===V.AUTO,s=r===V.DESKTOP,a=r===V.MOBILE,i=s||n&&!t,l=a||n&&t;return{mode:i?V.DESKTOP:V.MOBILE,isDesktop:i,isMobile:l}}static useExit(){const t=Qe(a=>a.settings.exitMode),r=Lr(),n=Mr(),s=S.useCallback(()=>{const{manga:a}=Ie();return a?n(Nr.manga.path(a.id)):()=>{}},[]);switch(t){case ve.PREVIOUS:return r;case ve.MANGA:return s;default:throw new Error('Unexpected "exitMode" ('.concat(t,")"))}}};We(Z,"downloadAheadQueue",new ft(1)),We(Z,"chapterUpdateQueues",new Map);let lt=Z;const Is=({i18nKey:e,value:t})=>{const{t:r}=x();return o.jsx(v,{sx:{flexDirection:"row",gap:.25},children:o.jsx(qt,{t:r,i18nKey:e,values:{value:t},components:[o.jsx(A,{variant:"caption",sx:{fontSize:"x-small",opacity:.75}})]})})},js=({value:e,values:t,defaultValue:r,setValue:n,valueToDisplayData:s,isDefaultable:a,onDefault:i})=>{const{t:l}=x();return o.jsxs(v,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:[a&&o.jsx(re,{onClick:i,variant:e===void 0?"contained":"outlined",children:l("global.label.default")},"default"),t.map(c=>{const g=e===void 0&&c===r,u=s[c].isTitleString?s[c].title:l(s[c].title);return o.jsx(Ve,{title:g?l("reader.settings.active_setting"):"",children:o.jsx(re,{onClick:()=>n(c),variant:c===e?"contained":"outlined",startIcon:s[c].icon,children:g?o.jsx(Is,{i18nKey:"global.label.footnote",value:u}):u})},c)})]})},U=({label:e,description:t,...r})=>o.jsxs(v,{children:[o.jsx(A,{children:e}),t&&o.jsx(A,{variant:"body2",color:"textDisabled",children:t}),o.jsx(js,{...r})]}),fr=({readingMode:e,setReadingMode:t,...r})=>{const{t:n}=x();return o.jsx(U,{...r,label:n("reader.settings.label.reading_mode"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Xt,setValue:t,valueToDisplayData:Kt})},Ds={[W.LTR]:{title:"reader.settings.reading_direction.ltr",icon:o.jsx(Vr,{})},[W.RTL]:{title:"reader.settings.reading_direction.rtl",icon:o.jsx(Ur,{})}},ws=Object.values(W).filter(e=>typeof e=="number"),Ls=({readingDirection:e,setReadingDirection:t,...r})=>{const{t:n}=x();return o.jsx(U,{...r,label:n("reader.settings.label.reading_direction"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:ws,setValue:t,valueToDisplayData:Ds})},Ms={[oe.EDGE]:{title:"reader.settings.tap_zones.edge",icon:null},[oe.KINDLE]:{title:"reader.settings.tap_zones.kindle",icon:null},[oe.L_SHAPE]:{title:"reader.settings.tap_zones.l_shape",icon:null},[oe.RIGHT_LEFT]:{title:"reader.settings.tap_zones.right_left",icon:null},[oe.DISABLED]:{title:"global.label.disabled",icon:null}},Ns=Object.values(oe).filter(e=>typeof e=="number"),ks=({tapZoneLayout:e,setTapZoneLayout:t,...r})=>{const{t:n}=x();return o.jsx(U,{...r,label:n("reader.settings.tap_zones.title"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Ns,setValue:t,valueToDisplayData:Ms})};var _r=(e=>(e[e.NONE=0]="NONE",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.BOTH=3]="BOTH",e))(_r||{});const Us={0:{title:"global.label.none",icon:null},1:{title:"global.label.horizontal",icon:null},2:{title:"global.label.vertical",icon:null},3:{title:"global.label.both",icon:null}},Vs=Object.values(_r).filter(e=>typeof e=="number"),Bs={0:{vertical:!1,horizontal:!1},1:{vertical:!1,horizontal:!0},2:{vertical:!0,horizontal:!1},3:{vertical:!0,horizontal:!0}},Fs=({vertical:e,horizontal:t})=>e&&t?3:e?2:t?1:0,Gs=({tapZoneInvertMode:e,setTapZoneInvertMode:t,...r})=>{const{t:n}=x(),s=Fs(e.value);return o.jsx(U,{...r,label:n("reader.settings.tap_zones.invert"),value:e.isDefault?void 0:s,defaultValue:e.isDefault?s:void 0,values:Vs,setValue:a=>t(Bs[a]),valueToDisplayData:Us})},Hs=({pageScaleMode:e,setPageScaleMode:t,...r})=>{const{t:n}=x();return o.jsx(U,{...r,label:n("reader.settings.page_scale.title"),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Fr,setValue:t,valueToDisplayData:Br})},zs=({pageScaleMode:e,shouldStretchPage:t,setShouldStretchPage:r})=>{const{t:n}=x();return Gr[e]?o.jsx(J,{children:o.jsx(re,{onClick:()=>r(!t),variant:t?"contained":"outlined",children:n("reader.settings.page_scale.stretch")})}):null},zt=de(o.jsx("path",{d:"M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8m-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34C4.9 8.79 4 10.79 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91"})),Ae=({asIconButton:e,...t})=>{const{t:r}=x();return e?o.jsx(Ve,{title:r("global.button.reset"),children:o.jsx(Jt,{color:"inherit",...t,children:o.jsx(zt,{})})}):o.jsx(re,{startIcon:o.jsx(zt,{}),...t,children:r("global.button.reset")})},z=({label:e,value:t,onDefault:r,slotProps:n})=>{var s,a,i;return o.jsxs(v,{sx:{flexDirection:"row",gap:2,alignItems:"center"},children:[o.jsxs(v,{sx:{flexBasis:"25%"},children:[o.jsx(A,{...n==null?void 0:n.label,sx:{...(s=n==null?void 0:n.label)==null?void 0:s.sx},children:e}),o.jsx(A,{...n==null?void 0:n.value,sx:{...(a=n==null?void 0:n.value)==null?void 0:a.sx},children:t})]}),o.jsx(cn,{...n==null?void 0:n.slider,sx:{flexBasis:"75%",...(i=n==null?void 0:n.slider)==null?void 0:i.sx}}),r&&o.jsx(Ae,{asIconButton:!0,onClick:r})]})},$s=({pageGap:e,readingMode:t,isDefaultable:r,onDefault:n,updateSetting:s})=>{const{t:a}=x();return t.value!==I.WEBTOON&&Q(t.value)?o.jsx(z,{label:a("reader.settings.label.page_gap"),value:a("global.value",{value:e.value,unit:a("global.unit.px")}),onDefault:r?n:void 0,slotProps:{slider:{defaultValue:P.pageGap,value:e.value,step:Ye.step,min:Ye.min,max:Ye.max,onChange:(l,c)=>{s(c,!1)},onChangeCommitted:(l,c)=>{s(c,!0)}}}}):null},Ws=({readerWidth:e,pageScaleMode:t,isDefaultable:r,onDefault:n,updateSetting:s,setTransparent:a})=>{const{t:i}=x();return ut(t)?o.jsxs(v,{children:[o.jsxs(v,{sx:{flexDirection:"row",justifyContent:"space-between"},children:[o.jsx(C,{label:i("reader.settings.label.limit_reader_width"),checked:e.enabled,onChange:(l,c)=>s("readerWidth",{...e,enabled:c},!0)}),r&&o.jsx(Ae,{onClick:n,variant:"outlined"})]}),e.enabled&&o.jsx(z,{label:i("reader.settings.label.reader_width"),value:i("global.value",{value:e.value,unit:"%"}),slotProps:{slider:{defaultValue:P.readerWidth.value,value:e.value,step:1,min:10,max:100,onChange:(l,c)=>{a==null||a(!0),s("readerWidth",{...e,value:c},!1)},onChangeCommitted:(l,c)=>{a==null||a(!1),s("readerWidth",{...e,value:c},!0)}}}})]}):null},Ys=({areDefaultSettings:e})=>{const{t}=x();return!Ue.useIsTouchDevice()||e?null:o.jsx(v,{sx:{alignItems:"end"},children:o.jsx(A,{variant:"caption",children:t("reader.settings.default_setting_footnote")})})},Zs=({profile:e,title:t,updateSetting:r,isSeriesMode:n,...s})=>{const{settings:a}=hn(e),i=S.useMemo(()=>({...a,readingMode:{value:e,isDefault:!0}}),[a,e]);return o.jsxs(v,{sx:{gap:2},children:[n?o.jsx(A,{children:t}):o.jsx(dn,{component:"div",id:"".concat(e,"-settings"),children:t}),o.jsx(v,{sx:{px:+!n*2},children:o.jsx(mr,{...s,setShowPreview:()=>{},settings:i,updateSetting:(l,c,g)=>r(l,c,g,!0,e)})})]})},pr=({profiles:e=Xt,readingMode:t,...r})=>{const{updateSetting:n,isSeriesMode:s}=r,{t:a}=x();return o.jsxs(v,{sx:{gap:2,pb:+!s*2},children:[t!==void 0&&o.jsx(v,{sx:{pt:2,px:2},children:o.jsx(fr,{readingMode:t,setReadingMode:i=>n("readingMode",i)})}),e.map(i=>o.jsx(Zs,{profile:i,title:a(Kt[i].title),...r},i))]})},mr=({setShowPreview:e,settings:t,updateSetting:r,isDefaultable:n,onDefault:s,isSeriesMode:a,setTransparent:i})=>{const{t:l}=x();return o.jsxs(v,{sx:{gap:2},children:[o.jsx(Ys,{areDefaultSettings:!n}),a&&o.jsxs(o.Fragment,{children:[o.jsx(A,{children:l("reader.settings.source_series")}),o.jsx(fr,{readingMode:t.readingMode,setReadingMode:c=>r("readingMode",c),isDefaultable:n,onDefault:()=>s==null?void 0:s("readingMode")})]}),o.jsx($s,{pageGap:t.pageGap,readingMode:t.readingMode,isDefaultable:n,onDefault:()=>s==null?void 0:s("pageGap"),updateSetting:(...c)=>r("pageGap",...c)}),o.jsx(Ls,{readingDirection:t.readingDirection,setReadingDirection:c=>r("readingDirection",c),isDefaultable:n,onDefault:()=>s==null?void 0:s("readingDirection")}),o.jsx(ks,{tapZoneLayout:t.tapZoneLayout,setTapZoneLayout:c=>{e(!0),r("tapZoneLayout",c)},isDefaultable:n,onDefault:()=>{e(!0),s==null||s("tapZoneLayout")}}),o.jsx(Gs,{tapZoneInvertMode:t.tapZoneInvertMode,setTapZoneInvertMode:c=>{e(!0),r("tapZoneInvertMode",c)},isDefaultable:n,onDefault:()=>{e(!0),s==null||s("tapZoneInvertMode")}}),o.jsx(Hs,{pageScaleMode:t.pageScaleMode,setPageScaleMode:c=>r("pageScaleMode",c),isDefaultable:n,onDefault:()=>s==null?void 0:s("pageScaleMode")}),o.jsx(zs,{pageScaleMode:t.pageScaleMode.value,shouldStretchPage:t.shouldStretchPage.value,setShouldStretchPage:c=>r("shouldStretchPage",c)}),o.jsx(Ws,{readerWidth:t.readerWidth.value,pageScaleMode:t.pageScaleMode.value,isDefaultable:n,onDefault:()=>s==null?void 0:s("readerWidth"),updateSetting:(...c)=>r(...c),setTransparent:i}),a&&o.jsxs(o.Fragment,{children:[o.jsx(Hr,{}),o.jsx(pr,{profiles:[t.readingMode.value],updateSetting:r,isSeriesMode:a,setTransparent:i})]})]})},Ks=()=>o.jsx(Qt,{children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:o.jsx("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 15h16"})})}),Xs=()=>o.jsx(Qt,{children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:o.jsx("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 15h16M7 15v-5m10 5v-5M4 9h16"})})}),Js={[be.HIDDEN]:{title:"global.label.hidden",icon:o.jsx(Ks,{})},[be.STANDARD]:{title:"global.label.standard",icon:o.jsx(Xs,{})}},Qs=Object.values(be).filter(e=>typeof e=="number"),qs=({overlayMode:e,progressBarType:t,setProgressBarType:r})=>{const{t:n}=x();return e!==V.DESKTOP?null:o.jsx(U,{label:n("reader.settings.progress_bar.style"),value:t,values:Qs,setValue:r,valueToDisplayData:Js})},ea=({overlayMode:e,progressBarType:t,progressBarSize:r,setProgressBarSize:n,onDefault:s})=>{const{t:a}=x();return e===V.DESKTOP&&t===be.STANDARD?o.jsx(z,{label:a("reader.settings.progress_bar.size"),value:a("global.value",{value:r,unit:a("global.unit.px")}),onDefault:s,slotProps:{slider:{defaultValue:P.progressBarSize,value:r,step:je.step,min:je.min,max:je.max,onChange:(l,c)=>{n(c,!1)},onChangeCommitted:(l,c)=>{n(c,!0)}}}}):null},ta=de(o.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"})),$t=de(o.jsx("path",{d:"M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"})),xr=de([o.jsx("path",{d:"M19.03 3.56c-1.67-1.39-3.74-2.3-6.03-2.51v2.01c1.73.19 3.31.88 4.61 1.92zM11 3.06V1.05c-2.29.2-4.36 1.12-6.03 2.51l1.42 1.42C7.69 3.94 9.27 3.25 11 3.06M4.98 6.39 3.56 4.97C2.17 6.64 1.26 8.71 1.05 11h2.01c.19-1.73.88-3.31 1.92-4.61M20.94 11h2.01c-.21-2.29-1.12-4.36-2.51-6.03l-1.42 1.42c1.04 1.3 1.73 2.88 1.92 4.61M7 12l3.44 1.56L12 17l1.56-3.44L17 12l-3.44-1.56L12 7l-1.56 3.44z"},"0"),o.jsx("path",{d:"M12 21c-3.11 0-5.85-1.59-7.46-4H7v-2H1v6h2v-2.7c1.99 2.84 5.27 4.7 9 4.7 4.87 0 9-3.17 10.44-7.56l-1.96-.45C19.25 18.48 15.92 21 12 21"},"1")]),Wt={[H.AUTO]:{title:"global.label.auto",icon:o.jsx(xr,{})},[H.BOTTOM]:{title:"global.label.bottom",icon:o.jsx($t,{sx:{transform:"rotate(90deg)"}})},[H.LEFT]:{title:"global.label.left",icon:o.jsx(ta,{})},[H.RIGHT]:{title:"global.label.right",icon:o.jsx($t,{})}},ra=Object.values(H).filter(e=>typeof e=="number"),na=Object.values(zr),sa=({progressBarPosition:e,progressBarPositionAutoVertical:t,updateSetting:r})=>{const{t:n}=x(),s=e===H.AUTO;return o.jsxs(o.Fragment,{children:[o.jsx(U,{label:n("reader.settings.progress_bar.position"),value:e,values:ra,setValue:a=>r("progressBarPosition",a),valueToDisplayData:Wt}),s&&o.jsx(U,{label:n("reader.settings.progress_bar.auto_vertical_position.title"),value:t,values:na,setValue:a=>r("progressBarPositionAutoVertical",a),valueToDisplayData:Wt})]})},aa=de(o.jsx("path",{d:"M15.5 1h-8C6.12 1 5 2.12 5 3.5v17C5 21.88 6.12 23 7.5 23h8c1.38 0 2.5-1.12 2.5-2.5v-17C18 2.12 16.88 1 15.5 1m-4 21c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m4.5-4H7V4h9z"})),oa=de(o.jsx("path",{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2zM4 6h16v10H4z"})),ia={[V.AUTO]:{title:"global.label.auto",icon:o.jsx(xr,{})},[V.DESKTOP]:{title:"global.label.desktop",icon:o.jsx(oa,{})},[V.MOBILE]:{title:"global.label.mobile",icon:o.jsx(aa,{})}},la=Object.values(V).filter(e=>typeof e=="number"),ca=({overlayMode:e,setOverlayMode:t})=>{const{t:r}=x();return o.jsx(U,{label:r("reader.settings.overlay_mode"),value:e,values:la,setValue:t,valueToDisplayData:ia})},da={[fe.THEME]:{title:"settings.appearance.theme.title",icon:null},[fe.BLACK]:{title:"global.colors.black",icon:null},[fe.GRAY]:{title:"global.colors.gray",icon:null},[fe.WHITE]:{title:"global.colors.white",icon:null}},ua=Object.values(fe).filter(e=>typeof e=="number"),ga=({backgroundColor:e,updateSetting:t})=>{const{t:r}=x();return o.jsx(U,{label:r("reader.settings.background_color"),value:e,values:ua,setValue:t,valueToDisplayData:da})},ha=({overlayMode:e,settings:t,updateSetting:r,onDefault:n})=>{const{t:s}=x();return o.jsxs(v,{sx:{gap:2},children:[o.jsx(ca,{overlayMode:t.overlayMode,setOverlayMode:a=>r("overlayMode",a)}),o.jsx(ga,{backgroundColor:t.backgroundColor,updateSetting:a=>r("backgroundColor",a)}),o.jsx(qs,{overlayMode:e,progressBarType:t.progressBarType,setProgressBarType:a=>r("progressBarType",a)}),o.jsx(ea,{overlayMode:e,progressBarType:t.progressBarType,progressBarSize:t.progressBarSize,setProgressBarSize:(...a)=>r("progressBarSize",...a),onDefault:()=>n==null?void 0:n("progressBarSize")}),o.jsx(sa,{progressBarPosition:t.progressBarPosition,progressBarPositionAutoVertical:t.progressBarPositionAutoVertical,updateSetting:r}),(t.progressBarType===be.HIDDEN||e===V.MOBILE)&&o.jsx(C,{label:s("reader.settings.label.show_page_number"),checked:t.shouldShowPageNumber,onChange:(a,i)=>r("shouldShowPageNumber",i)})]})},fa=({brightness:e,updateSetting:t})=>{const{t:r}=x();return o.jsxs(v,{children:[o.jsx(C,{label:r("reader.settings.custom_filter.brightness"),checked:e.enabled,onChange:(n,s)=>t("brightness",{...e,enabled:s},!0)}),e.enabled&&o.jsx(z,{label:r("reader.settings.custom_filter.brightness"),value:e.value,onDefault:()=>t("brightness",{...e,value:P.customFilter.brightness.value},!0),slotProps:{slider:{defaultValue:P.customFilter.brightness.value,value:e.value,step:w.brightness.step,min:w.brightness.min,max:w.brightness.max,onChange:(n,s)=>{t("brightness",{...e,value:s},!1)},onChangeCommitted:(n,s)=>{t("brightness",{...e,value:s},!0)}}}})]})},_a=({contrast:e,updateSetting:t})=>{const{t:r}=x();return o.jsxs(v,{children:[o.jsx(C,{label:r("reader.settings.custom_filter.contrast"),checked:e.enabled,onChange:(n,s)=>t("contrast",{...e,enabled:s},!0)}),e.enabled&&o.jsx(z,{label:r("reader.settings.custom_filter.contrast"),value:e.value,onDefault:()=>t("contrast",{...e,value:P.customFilter.contrast.value},!0),slotProps:{slider:{defaultValue:P.customFilter.contrast.value,value:e.value,step:w.contrast.step,min:w.contrast.min,max:w.contrast.max,onChange:(n,s)=>{t("contrast",{...e,value:s},!1)},onChangeCommitted:(n,s)=>{t("contrast",{...e,value:s},!0)}}}})]})},pa=({saturate:e,updateSetting:t})=>{const{t:r}=x();return o.jsxs(v,{children:[o.jsx(C,{label:r("reader.settings.custom_filter.saturate"),checked:e.enabled,onChange:(n,s)=>t("saturate",{...e,enabled:s},!0)}),e.enabled&&o.jsx(z,{label:r("reader.settings.custom_filter.saturate"),value:e.value,onDefault:()=>t("saturate",{...e,value:P.customFilter.saturate.value},!0),slotProps:{slider:{defaultValue:P.customFilter.saturate.value,value:e.value,step:w.saturate.step,min:w.saturate.min,max:w.saturate.max,onChange:(n,s)=>{t("saturate",{...e,value:s},!1)},onChangeCommitted:(n,s)=>{t("saturate",{...e,value:s},!0)}}}})]})},ma=({hue:e,updateSetting:t})=>{const{t:r}=x();return o.jsxs(v,{children:[o.jsx(C,{label:r("reader.settings.custom_filter.hue"),checked:e.enabled,onChange:(n,s)=>t("hue",{...e,enabled:s},!0)}),e.enabled&&o.jsx(z,{label:r("reader.settings.custom_filter.hue"),value:e.value,onDefault:()=>t("hue",{...e,value:P.customFilter.hue.value},!0),slotProps:{slider:{defaultValue:P.customFilter.hue.value,value:e.value,step:w.hue.step,min:w.hue.min,max:w.hue.max,onChange:(n,s)=>{t("hue",{...e,value:s},!1)},onChangeCommitted:(n,s)=>{t("hue",{...e,value:s},!0)}}}})]})},xa={red:"reader.settings.custom_filter.rgba.red",green:"reader.settings.custom_filter.rgba.green",blue:"reader.settings.custom_filter.rgba.blue",alpha:"reader.settings.custom_filter.rgba.alpha"},va=({rgba:e,updateSetting:t})=>{const{t:r}=x();return o.jsxs(v,{children:[o.jsx(C,{label:r("reader.settings.custom_filter.rgba.title"),checked:e.enabled,onChange:(n,s)=>t("rgba",{...e,enabled:s},!0)}),e.enabled&&o.jsxs(v,{sx:{gap:1},children:[Object.entries(e.value).map(([n,s])=>n==="blendMode"?null:o.jsx(z,{label:r(xa[n]),value:s,onDefault:()=>t("rgba",{...e,value:{...e.value,[n]:P.customFilter.rgba.value[n]}},!0),slotProps:{slider:{value:s,defaultValue:P.customFilter.rgba.value[n],step:w.rgba[n].step,min:w.rgba[n].min,max:w.rgba[n].max,onChange:(a,i)=>{t("rgba",{...e,value:{...e.value,[n]:i}},!1)},onChangeCommitted:(a,i)=>{t("rgba",{...e,value:{...e.value,[n]:i}},!0)}}}},n)),o.jsx(U,{label:r("reader.settings.custom_filter.rgba.blend_mode.title"),value:e.value.blendMode,values:Wr,setValue:n=>t("rgba",{...e,value:{...e.value,blendMode:n}},!0),valueToDisplayData:$r})]})]})},ba=({sepia:e,updateSetting:t})=>{const{t:r}=x();return o.jsx(v,{children:o.jsx(C,{label:r("reader.settings.custom_filter.sepia"),checked:e,onChange:(n,s)=>t(s)})})},Sa=({grayscale:e,updateSetting:t})=>{const{t:r}=x();return o.jsx(v,{children:o.jsx(C,{label:r("reader.settings.custom_filter.grayscale"),checked:e,onChange:(n,s)=>t(s)})})},Ea=({invert:e,updateSetting:t})=>{const{t:r}=x();return o.jsx(v,{children:o.jsx(C,{label:r("reader.settings.custom_filter.invert"),checked:e,onChange:(n,s)=>t(s)})})},Ra=({settings:{customFilter:e},updateSetting:t,onDefault:r,setTransparent:n})=>{const s=(a,i)=>{t("customFilter",a,i),n==null||n(i===void 0?!1:!i)};return o.jsxs(v,{sx:{gap:2},children:[o.jsx(fa,{brightness:e.brightness,updateSetting:(a,i,l)=>s({...e,[a]:i},l)}),o.jsx(_a,{contrast:e.contrast,updateSetting:(a,i,l)=>s({...e,[a]:i},l)}),o.jsx(pa,{saturate:e.saturate,updateSetting:(a,i,l)=>s({...e,[a]:i},l)}),o.jsx(ma,{hue:e.hue,updateSetting:(a,i,l)=>s({...e,[a]:i},l)}),o.jsx(va,{rgba:e.rgba,updateSetting:(a,i,l)=>s({...e,[a]:i},l)}),o.jsx(ba,{sepia:e.sepia,updateSetting:a=>s({...e,sepia:a})}),o.jsx(Sa,{grayscale:e.grayscale,updateSetting:a=>s({...e,grayscale:a})}),o.jsx(Ea,{invert:e.invert,updateSetting:a=>s({...e,invert:a})}),o.jsx(v,{sx:{alignItems:"end"},children:o.jsx(Ae,{onClick:()=>r==null?void 0:r("customFilter"),variant:"outlined"})})]})},ya={[ve.PREVIOUS]:{title:"global.label.previous",icon:null},[ve.MANGA]:{title:"manga.title_one",icon:null}},Ta=Object.values(ve).filter(e=>typeof e=="number"),Aa=({exitMode:e,setExitMode:t})=>{const{t:r}=x();return o.jsx(U,{label:r("reader.settings.exit_mode"),value:e,values:Ta,setValue:t,valueToDisplayData:ya})},Pa=({autoScroll:e,setAutoScroll:t})=>{const{t:r}=x();return o.jsxs(o.Fragment,{children:[o.jsx(C,{label:r("reader.settings.auto_scroll.smooth"),checked:e.smooth,onChange:(n,s)=>t({...e,smooth:s},!0)}),o.jsx(z,{label:r("reader.settings.auto_scroll.speed"),value:r("global.time.seconds.value",{count:e.value}),onDefault:()=>t({...e,value:P.autoScroll.value},!0),slotProps:{slider:{defaultValue:P.customFilter.saturate.value,value:e.value,...je,onChange:(n,s)=>{t({...e,value:s},!1)},onChangeCommitted:(n,s)=>{t({...e,value:s},!0)}}}})]})},Oa={[_e.TINY]:{title:"global.label.tiny",icon:null},[_e.SMALL]:{title:"global.label.small",icon:null},[_e.MEDIUM]:{title:"global.label.medium",icon:null},[_e.LARGE]:{title:"global.label.large",icon:null}},Ca=Object.values(_e).filter(e=>typeof e=="number"),Ia=({scrollAmount:e,setScrollAmount:t})=>{const{t:r}=x();return o.jsxs(o.Fragment,{children:[o.jsx(U,{label:r("reader.settings.scroll_amount"),value:e,values:Ca,setValue:n=>t(n,!0),valueToDisplayData:Oa}),o.jsx(z,{label:r("reader.settings.label.custom_scroll_amount"),value:r("global.value",{value:e,unit:"%"}),onDefault:()=>t(P.scrollAmount,!0),slotProps:{slider:{defaultValue:P.scrollAmount,value:e,...Yr,onChange:(n,s)=>{t(s,!1)},onChangeCommitted:(n,s)=>{t(s,!0)}}}})]})},ja=({settings:e,updateSetting:t,onDefault:r,isDefaultable:n})=>{const{t:s}=x();return o.jsxs(v,{sx:{gap:2},children:[o.jsx(Aa,{exitMode:e.exitMode,setExitMode:a=>t("exitMode",a)}),o.jsx(Ia,{scrollAmount:e.scrollAmount,setScrollAmount:(a,i)=>t("scrollAmount",a,i)}),o.jsx(C,{label:s("reader.settings.label.skip_dup_chapters"),checked:e.shouldSkipDupChapters,onChange:(a,i)=>t("shouldSkipDupChapters",i)}),o.jsx(C,{label:o.jsxs(J,{children:[o.jsx(A,{children:s("reader.settings.label.skip_filtered_chapters")}),n&&o.jsx(A,{variant:"body2",color:"textDisabled",children:s("reader.settings.label.unchangeable_in_reader")})]}),checked:e.shouldSkipFilteredChapters,onChange:(a,i)=>t("shouldSkipFilteredChapters",i),disabled:n}),yn(e.readingMode.value)&&o.jsx(C,{label:s("reader.settings.label.offset_double_spread"),checked:e.shouldOffsetDoubleSpreads.value,onChange:(a,i)=>t("shouldOffsetDoubleSpreads",i)}),o.jsx(C,{label:o.jsxs(J,{children:[o.jsx(A,{children:s("reader.settings.infinite_scroll.title")}),o.jsx(A,{variant:"body2",color:"textDisabled",children:s("reader.settings.infinite_scroll.description")})]}),checked:e.shouldUseInfiniteScroll,onChange:(a,i)=>t("shouldUseInfiniteScroll",i)}),o.jsx(C,{label:o.jsxs(J,{children:[o.jsx(A,{children:s("reader.settings.preview.reading_mode.title")}),o.jsx(A,{variant:"body2",color:"textDisabled",children:s("reader.settings.preview.reading_mode.description")})]}),checked:e.shouldShowReadingModePreview,onChange:(a,i)=>t("shouldShowReadingModePreview",i)}),o.jsx(C,{label:o.jsxs(J,{children:[o.jsx(A,{children:s("reader.settings.preview.tap_zones.title")}),o.jsx(A,{variant:"body2",color:"textDisabled",children:s("reader.settings.preview.tap_zones.description")})]}),checked:e.shouldShowTapZoneLayoutPreview,onChange:(a,i)=>t("shouldShowTapZoneLayoutPreview",i)}),o.jsx(C,{label:o.jsxs(J,{children:[o.jsx(A,{children:s("reader.settings.auto_webtoon_mode.title")}),o.jsx(A,{variant:"body2",color:"textDisabled",children:s("reader.settings.auto_webtoon_mode.description")})]}),checked:e.shouldUseAutoWebtoonMode,onChange:(a,i)=>t("shouldUseAutoWebtoonMode",i)}),o.jsx(C,{label:s("reader.settings.show_transition_page"),checked:e.shouldShowTransitionPage,onChange:(a,i)=>t("shouldShowTransitionPage",i)}),o.jsx(C,{label:s("reader.settings.chapter_transition.warning.missing_chapter"),checked:e.shouldInformAboutMissingChapter,onChange:(a,i)=>t("shouldInformAboutMissingChapter",i)}),o.jsx(C,{label:s("reader.settings.chapter_transition.warning.scanlator_change"),checked:e.shouldInformAboutScanlatorChange,onChange:(a,i)=>t("shouldInformAboutScanlatorChange",i)}),o.jsx(Pa,{autoScroll:e.autoScroll,setAutoScroll:(...a)=>t("autoScroll",...a)}),o.jsx(z,{label:s("reader.settings.image_preload_amount"),value:e.imagePreLoadAmount,onDefault:()=>r==null?void 0:r("imagePreLoadAmount"),slotProps:{slider:{defaultValue:P.imagePreLoadAmount,value:e.imagePreLoadAmount,step:Ze.step,min:Ze.min,max:Ze.max,onChange:(a,i)=>{t("imagePreLoadAmount",i,!1)},onChangeCommitted:(a,i)=>{t("imagePreLoadAmount",i,!0)}}}})]})},Da=Zr(A)(({theme:e})=>({display:"inline-block",padding:"0.2em 0.4em",fontSize:"0.85em",lineHeight:"1.4",color:e.palette.text.primary,backgroundColor:e.palette.background.paper,border:"1px solid ".concat(e.palette.divider),borderRadius:"3px",boxShadow:"inset 0 -1px 0 ".concat(e.palette.divider),fontFamily:"monospace, monospace"})),vr=({keys:e,removeKey:t})=>{const{t:r}=x();return o.jsx(v,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:e.map((n,s)=>o.jsxs(S.Fragment,{children:[o.jsx(Ve,{title:r("global.button.delete"),hidden:!t,children:o.jsx(v,{sx:{flexDirection:"row",flexWrap:"wrap",gap:.5,cursor:t?"pointer":void 0},onClick:()=>t==null?void 0:t(n),children:n.split("+").map((a,i,l)=>o.jsxs(S.Fragment,{children:[o.jsx(Da,{children:a}),i===l.length-1?"":"+"]},a))})}),s===e.length-1?"":","]},n))})},wa=({onClose:e,onCreate:t,existingKeys:r})=>{const{t:n}=x(),[s,{start:a,stop:i,resetKeys:l}]=Kr(),c=[[...s].join("+")],g=c.some(u=>r.map(d=>d.toLowerCase()).includes(u.toLowerCase()));return S.useEffect(()=>(a(),()=>{i()}),[]),o.jsxs(Xr,{open:!0,onClose:e,fullWidth:!0,children:[o.jsx(Jr,{children:n("hotkeys.create.dialog.title")}),o.jsxs(Qr,{children:[o.jsx(v,{sx:{flexDirection:"row",gap:1},children:o.jsx(qt,{i18nKey:"hotkeys.create.dialog.label",components:{Keys:s.size?o.jsx(vr,{keys:c}):o.jsx(A,{children:n("hotkeys.create.dialog.placeholder")})},children:"Recorded keys:"})}),g&&o.jsx(A,{color:"error",children:n("hotkeys.create.error.exists")})]}),o.jsx(qr,{children:o.jsxs(v,{direction:"row",sx:{justifyContent:"space-between",width:"100%"},children:[o.jsx(re,{onClick:l,children:n("global.button.reset")}),o.jsxs(v,{direction:"row",children:[o.jsx(re,{onClick:e,children:n("global.button.cancel")}),o.jsx(re,{disabled:g,onClick:()=>{e(),t(c)},children:n("global.button.create")})]})]})})]})},La={[D.PREVIOUS_PAGE]:"reader.settings.hotkey.previous_page",[D.NEXT_PAGE]:"reader.settings.hotkey.next_page",[D.SCROLL_BACKWARD]:"reader.settings.hotkey.scroll_backward",[D.SCROLL_FORWARD]:"reader.settings.hotkey.scroll_forward",[D.PREVIOUS_CHAPTER]:"reader.settings.hotkey.previous_chapter",[D.NEXT_CHAPTER]:"reader.settings.hotkey.next_chapter",[D.TOGGLE_MENU]:"reader.settings.hotkey.menu",[D.CYCLE_SCALE_TYPE]:"reader.settings.hotkey.scale_type",[D.STRETCH_IMAGE]:"reader.settings.hotkey.stretch_image",[D.OFFSET_SPREAD_PAGES]:"reader.settings.hotkey.offset_spread_pages",[D.CYCLE_READING_MODE]:"reader.settings.hotkey.reading_mode",[D.CYCLE_READING_DIRECTION]:"reader.settings.hotkey.reading_direction",[D.TOGGLE_AUTO_SCROLL]:"reader.settings.hotkey.auto_scroll",[D.AUTO_SCROLL_SPEED_INCREASE]:"reader.settings.hotkey.auto_scroll_speed_increase",[D.AUTO_SCROLL_SPEED_DECREASE]:"reader.settings.hotkey.auto_scroll_speed_decrease",[D.EXIT_READER]:"reader.button.exit"},Ma=({hotkey:e,keys:t,existingKeys:r,updateSetting:n})=>{const{t:s}=x(),a=en({popupId:"reader-setting-record-hotkey",variant:"dialog"});return o.jsxs(o.Fragment,{children:[o.jsxs(v,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[o.jsx(A,{sx:{flexGrow:1},children:s(La[e])}),o.jsx(vr,{keys:t,removeKey:i=>n(t.filter(l=>l!==i))}),o.jsx(Ve,{title:s("global.button.add"),children:o.jsx(Jt,{...tn(a),color:"inherit",children:o.jsx(un,{})})}),o.jsx(Ae,{asIconButton:!0,onClick:()=>n(P.hotkeys[e])})]}),a.isOpen&&o.jsx(wa,{onClose:a.close,onCreate:i=>n([...t,...i]),existingKeys:r})]})},Na=({settings:e,updateSetting:t,onDefault:r})=>{const{t:n}=x();return o.jsxs(v,{sx:{gap:2},children:[o.jsx(v,{sx:{alignItems:"end"},children:o.jsx(A,{variant:"caption",children:n("hotkeys.info.delete")})}),rn.map(s=>o.jsx(Ma,{hotkey:s,keys:e.hotkeys[s],existingKeys:Object.values(e.hotkeys).flat(),updateSetting:a=>t("hotkeys",{...e.hotkeys,[s]:a})},s)),o.jsx(v,{sx:{alignItems:"end"},children:o.jsx(Ae,{onClick:()=>r==null?void 0:r("hotkeys"),variant:"outlined"})})]})},ka=(e,t,r)=>S.memo(({ref:n,...s})=>{const a=t.reduce((c,g)=>({...c,...g(s)}),{}),i=Object.fromEntries(Object.entries(a).filter(([c])=>r.includes(c))),l={...s,...i};return o.jsx(e,{...l,ref:n})}),Ua=({activeTab:e,setActiveTab:t,areDefaultSettings:r,settings:n,updateSetting:s,deleteSetting:a,mode:i,setTransparent:l})=>{const{t:c}=x(),g=Ue.useIsTouchDevice(),u=is(d=>d.tapZone.setShowPreview);return o.jsxs(o.Fragment,{children:[o.jsx(nn,{value:e,onChange:(d,f)=>t(f),sx:{...E(!!r,{zIndex:2}),...E(!r,{backgroundColor:"background.paper",backgroundImage:"var(--Paper-overlay)"})},children:Object.values(bt).map(({id:d,label:f,supportsTouchDevices:h})=>!h&&g?null:o.jsx(ln,{value:d,label:c(f),sx:{flexGrow:1,maxWidth:"unset",textTransform:"none"}},d))}),o.jsx(J,{sx:{p:r?void 0:2,overflowX:"hidden"},children:Object.values(bt).map(({id:d,supportsTouchDevices:f})=>{if(!f&&g)return null;switch(d){case ge.LAYOUT:return r?o.jsx(ae,{index:d,currentIndex:e,children:o.jsx(pr,{readingMode:n.readingMode,updateSetting:(...h)=>s(...h)})},d):o.jsx(ae,{index:d,currentIndex:e,children:o.jsx(mr,{settings:n,updateSetting:(...h)=>s(...h),setShowPreview:u,isDefaultable:!r,onDefault:(...h)=>a==null?void 0:a(...h),isSeriesMode:!0,setTransparent:l})},d);case ge.GENERAL:return o.jsx(ae,{index:d,currentIndex:e,sx:{p:r?2:void 0},children:o.jsx(ha,{overlayMode:i,settings:n,updateSetting:(...h)=>s(...h),isDefaultable:!r,onDefault:(...h)=>a==null?void 0:a(...h)})},d);case ge.FILTER:return o.jsx(ae,{index:d,currentIndex:e,sx:{p:r?2:void 0},children:o.jsx(Ra,{settings:n,updateSetting:(...h)=>s(...h),isDefaultable:!0,onDefault:(...h)=>a==null?void 0:a(...h),setTransparent:l})},d);case ge.BEHAVIOUR:return o.jsx(ae,{index:d,currentIndex:e,sx:{p:r?2:void 0},children:o.jsx(ja,{settings:n,updateSetting:(...h)=>s(...h),isDefaultable:!r,onDefault:(...h)=>a==null?void 0:a(...h)})},d);case ge.HOTKEYS:return o.jsx(ae,{index:d,currentIndex:e,sx:{p:r?2:void 0},children:o.jsx(Na,{settings:n,updateSetting:(...h)=>s(...h),isDefaultable:!0,onDefault:(...h)=>a==null?void 0:a(...h)})},d);default:throw new Error('Unexpected "ReaderSettingTab" ('.concat(d,")"))}})})]})},Do=ka(Ua,[lt.useOverlayMode],["mode"]);export{Ie as $,go as A,q as B,po as C,co as D,Ys as E,fr as F,Ls as G,Pa as H,is as I,To as J,yo as K,vo as L,Ro as M,De as N,ys as O,lo as P,Ft as Q,Do as R,Is as S,Eo as T,oo as U,Ao as V,Oo as W,sr as X,jo as Y,no as Z,so as _,lt as a,Io as a0,Co as a1,ho as a2,Qa as a3,ao as a4,tr as a5,Gt as a6,qa as a7,Qe as b,ss as c,fo as d,mo as e,ro as f,nr as g,uo as h,Q as i,os as j,as as k,_o as l,eo as m,et as n,Rs as o,xo as p,bo as q,So as r,Ps as s,Po as t,hn as u,pe as v,ka as w,to as x,io as y,yn as z};
