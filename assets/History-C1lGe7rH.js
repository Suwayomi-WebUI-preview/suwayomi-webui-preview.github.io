import{b as s,j as e,a1 as h,A as y,L as b,w,bk as I,aH as R,u as E,r as L,g as S,f as T,T as A,e as G}from"./index-D0Dc2eKf.js";import{E as c}from"./EmptyViewAbsoluteCentered-BwFEOLlC.js";import{S as M,a as P}from"./StyledGroupHeader-DTBeeJNb.js";import{S as k}from"./StyledGroupItemWrapper-Bmare5dV.js";import{V as d}from"./Virtuoso.util-Brel39sG.js";import{C as O,D as U}from"./ChapterCardMetadata-KON_0LLL.js";import{C as v,a as F}from"./ChapterDownloadButton-Bbi_dHx5.js";import{C as _}from"./ChapterDownloadRetryButton-C3ZSJgAE.js";import{L as B}from"./ListCardContent-CIHcEJ2q.js";import{C as N}from"./Card-BrQECkDg.js";import{C as V}from"./CardActionArea-ZTlqHET4.js";import{u as D}from"./useAppTitle-Z9HBFjvk.js";import"./index-hH70X0Mb.js";import"./use-merged-ref-C6S4kXN3.js";import"./ListCardAvatar-B9JrixZI.js";import"./Avatar-B_Dzv6Eb.js";import"./Download-B_2nQzrw.js";import"./MUI.util-CYBuX_Wz.js";const K=s.memo(({chapter:t})=>{const{manga:r}=t;return e.jsx(N,{children:e.jsx(V,{component:b,to:y.reader.path(t.manga.id,t.sourceOrder),state:h.getReaderOpenChapterLocationState(t),sx:{color:i=>i.palette.text[t.isRead?"disabled":"primary"]},children:e.jsxs(B,{sx:{justifyContent:"space-between"},children:[e.jsxs(w,{sx:{display:"flex",flexGrow:1,gap:1},children:[e.jsx(v,{mangaId:r.id,mangaTitle:r.title,thumbnailUrl:r.thumbnailUrl,thumbnailUrlLastFetched:r.thumbnailUrlLastFetched}),e.jsx(O,{title:r.title,secondaryText:"".concat(t.name," â€” ").concat(I.format(R(Number(t.lastReadAt)).valueOf()))})]}),e.jsx(U,{chapterId:t.id}),e.jsx(_,{chapterId:t.id}),e.jsx(F,{chapterId:t.id,isDownloaded:t.isDownloaded})]})})})}),de=()=>{var u;const{t}=E();D(t("history.title"));const{data:r,loading:i,error:l,fetchMore:C,refetch:g}=L.useGetRecentlyReadChapters(void 0,{fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),m=!!(r!=null&&r.chapters.pageInfo.hasNextPage),f=r==null?void 0:r.chapters.pageInfo.endCursor,o=(u=r==null?void 0:r.chapters.nodes)!=null?u:[],n=s.useMemo(()=>Object.entries(h.groupByDate(o,"lastReadAt")),[o]),p=s.useMemo(()=>n.map(a=>a[d.ITEMS].length),[n]),x=d.useCreateGroupedComputeItemKey(p,s.useCallback(a=>n[a][d.GROUP],[n]),s.useCallback(a=>o[a].id,[o])),j=s.useCallback(()=>{m&&C({variables:{offset:o.length}})},[m,f]);return l?e.jsx(c,{message:t("global.error.label.failed_to_load_data"),messageExtra:S(l),retry:()=>g().catch(T())}):!i&&o.length===0?e.jsx(c,{message:t("history.error.label.no_history_available")}):e.jsx(M,{persistKey:"history",components:{Footer:()=>i?e.jsx(G,{usePadding:!0}):null},overscan:window.innerHeight*.5,endReached:j,groupCounts:p,groupContent:a=>e.jsx(P,{isFirstItem:a===0,children:e.jsx(A,{variant:"h5",component:"h2",children:n[a][d.GROUP]})}),computeItemKey:x,itemContent:a=>e.jsx(k,{children:e.jsx(K,{chapter:o[a]})})})};export{de as History};
