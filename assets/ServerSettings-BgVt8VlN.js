import{u as $,j as e,N as h,at as ee,v as o,d6 as X,d7 as se,d8 as V,bF as ae,m as M,g as P,r as T,e as te,f as re,d9 as ie,s as l,F as de,i as ne,k as F,da as z,cO as n,db as oe,dc as w,dd as I,cF as C,de as B,cC as le,bo as W,df as H,G as J,dg as Z}from"./index-BCKoIEqI.js";import{N as _}from"./NumberSetting-1WSZHhbH.js";import{S as v}from"./SelectSetting-DyOppkhW.js";import{E as ce}from"./EmptyViewAbsoluteCentered--5TDFcVk.js";import{u as ge}from"./useAppTitle-DuVJbe8a.js";import{C as he}from"./LoginDialog-CSGZTjdu.js";import{a as ue}from"./Asserts-xItX73wb.js";import{L as x}from"./ListSubheader-B6-geCbf.js";import{S as c}from"./Switch-DOLtNWw8.js";import{L as xe}from"./Link-Bi0uxaKs.js";import"./Slider-WMHOBwFi.js";import"./Select--jAdXHpZ.js";import"./SwitchBase-Do41N3BN.js";const me=({settings:{koreaderSyncPercentageTolerance:a,koreaderSyncStrategyBackward:G,koreaderSyncStrategyForward:L,koreaderSyncChecksumMethod:U},serverAddress:b,username:u,isLoggedIn:S,updateSetting:p})=>{const{i18n:d,_:K}=$(),N=async()=>{const{data:i}=await T.koSyncLogout().response;if(i!=null&&i.logoutKoSyncAccount.status.isLoggedIn)throw new Error(d._({id:"lOSiAU"}))},A=async(i,r,y)=>{var m;const{data:g}=await T.koSyncLogin(i,r,y).response;if(!(g!=null&&g.connectKoSyncAccount.status.isLoggedIn))throw new Error((m=g==null?void 0:g.connectKoSyncAccount.message)!=null?m:d._({id:"Ef7StM"}))},R=async(i="https://sync.koreader.rocks/",r,y)=>{const g=he.showControlled({title:S?d._({id:"Xhiyqx"}):d._({id:"Y7Xyov"}),description:S?d._({id:"wHIs4p",values:{initialUsername:r,initialServerAddress:i}}):void 0,isLoading:!1,isLoggedIn:S,withServerAddress:!0,username:r,password:y,serverAddress:i,loginLogout:async(m,t,j)=>{if(g.update({isLoading:!0,loginLogout:ae}),S){try{await N(),g.submit()}catch(E){M(d._({id:"GMbSBT"}),"error",P(E))}return}try{ue(j),await A(j,m,t),g.submit()}catch(E){M(d._({id:"afv3MM"}),"error",P(E));const k="__retry__";await Promise.race([g.promise,Promise.resolve(k)])===k&&R(j,m,t)}}},{id:"koreader-sync-login-logout"})};return e.jsxs(h,{subheader:e.jsx(x,{component:"div",id:"koreader-sync-settings",children:d._({id:"OWRDvt"})}),children:[e.jsx(ee,{onClick:()=>R(b!=null?b:void 0,u!=null?u:void 0),children:e.jsx(o,{primary:d._({id:"bRUdLR"}),secondary:S?d._({id:"b399gU",values:{currentUsername:u,currentServerAddress:b}}):d._({id:"ZYnwzF"})})}),e.jsx(v,{settingName:d._({id:"+RWMg+"}),value:L,values:X,handleChange:i=>p("koreaderSyncStrategyForward",i)}),e.jsx(v,{settingName:d._({id:"/XdHDm"}),value:G,values:X,handleChange:i=>p("koreaderSyncStrategyBackward",i)}),e.jsx(v,{settingName:d._({id:"Qys1LM"}),value:U,values:se,handleChange:i=>p("koreaderSyncChecksumMethod",i)}),e.jsx(_,{settingTitle:d._({id:"rImcuw"}),dialogDescription:d._({id:"dTsOHI"}),settingValue:a.toString(),value:a,defaultValue:V.default,minValue:V.min,maxValue:V.max,stepSize:V.step,valueUnit:"",handleUpdate:i=>p("koreaderSyncPercentageTolerance",i)})]})},_e=a=>a===0?J._({id:"qqeAJM"}):J._({id:"yzAXZK",values:{ttl:a}}),Le=()=>{var O,Y,q;const{i18n:a,_:G}=$();ge(a._({id:"sGH11W"}));const{settings:{serverInformAvailableUpdate:L,serverInformVersionUpdated:U},loading:b,request:{error:u,refetch:S}}=te(),p=de(s=>M(a._({id:"cBoXe4"}),"error",P(s))),{data:d,loading:K,error:N,refetch:A}=T.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[R]=T.useUpdateServerSettings(),i=T.useKoSyncStatus(),r=async(s,D,f)=>{try{await R({variables:{input:{settings:{[s]:D}}}}),f==null||f(!0)}catch(Q){M(a._({id:"cBoXe4"}),"error",P(Q)),f==null||f(!1)}},y=re.useMemo(()=>e.jsxs(h,{subheader:e.jsx(x,{component:"div",id:"server-settings-client",children:a._({id:"+6NyRG"})}),children:[e.jsx(ie,{}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"CuP1AG"}),secondary:a._({id:"0Ub5X/"})}),e.jsx(c,{edge:"end",checked:U,onChange:s=>p("serverInformVersionUpdated",s.target.checked)})]}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"IV9G4u"}),secondary:a._({id:"3tqdsS"})}),e.jsx(c,{edge:"end",checked:L,onChange:s=>p("serverInformAvailableUpdate",s.target.checked)})]})]}),[U,L]);if(b||K||i.loading)return e.jsxs(e.Fragment,{children:[y,e.jsx(ne,{})]});const m=(O=u!=null?u:N)!=null?O:i.error;if(m)return e.jsxs(e.Fragment,{children:[y,e.jsx(ce,{message:a._({id:"6m5aox"}),messageExtra:P(m),retry:()=>{u&&S().catch(F("ServerSettings::refetchServerMetadataSettings")),N&&A().catch(F("ServerSettings::refetchServerSettings")),i.error&&i.refetch().catch(F("ServerSettings::koSyncStatus.refetch"))}})]});const t=d.settings,j=i.data.koSyncStatus,E=!((Y=t.authUsername)!=null&&Y.trim())||!((q=t.authPassword)!=null&&q.trim()),k=t.databaseType===z.H2;return e.jsxs(h,{sx:{pt:0},children:[y,e.jsxs(h,{subheader:e.jsx(x,{component:"div",id:"server-settings-server-address",children:a._({id:"iJnGhA"})}),children:[e.jsx(n,{settingName:a._({id:"XDWu5B"}),handleChange:s=>r("ip",s),value:t.ip,placeholder:"0.0.0.0"}),e.jsx(_,{settingTitle:a._({id:"hZ6znB"}),settingValue:t.port.toString(),handleUpdate:s=>r("port",s),value:t.port,defaultValue:4567,valueUnit:a._({id:"hZ6znB"})})]}),e.jsxs(h,{subheader:e.jsx(x,{component:"div",id:"server-settings-socks-proxy",children:a._({id:"IdzG48"})}),children:[e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"HwFBFo"})}),e.jsx(c,{edge:"end",checked:t.socksProxyEnabled,onChange:s=>r("socksProxyEnabled",s.target.checked)})]}),e.jsx(v,{settingName:a._({id:"2g+1ub"}),value:t.socksProxyVersion,values:[[4,{text:"4"}],[5,{text:"5"}]],handleChange:s=>r("socksProxyVersion",s)}),e.jsx(n,{settingName:a._({id:"ZTBYmB"}),value:t.socksProxyHost,handleChange:s=>r("socksProxyHost",s)}),e.jsx(n,{settingName:a._({id:"PV+Q4R"}),value:t.socksProxyPort,handleChange:s=>r("socksProxyPort",s)}),e.jsx(n,{settingName:a._({id:"5HymAx"}),value:t.socksProxyUsername,handleChange:s=>r("socksProxyUsername",s)}),e.jsx(n,{settingName:a._({id:"+vIDaq"}),value:t.socksProxyPassword,handleChange:s=>r("socksProxyPassword",s),isPassword:!0})]}),e.jsxs(h,{subheader:e.jsx(x,{component:"div",id:"server-settings-auth",children:a._({id:"P8fBlG"})}),children:[e.jsx(v,{settingName:a._({id:"nCdrw7"}),value:t.authMode,values:oe,handleChange:s=>{r("authMode",s,D=>{D&&(s!==w.UiLogin&&Z.removeTokens(),Z.setAuthRequired(s===w.UiLogin))})},disabled:E}),e.jsx(n,{settingName:a._({id:"7sNhEz"}),value:t.authUsername,validate:s=>t.authMode===w.None||!!s.trim(),handleChange:s=>r("authUsername",s)}),e.jsx(n,{settingName:a._({id:"8ZsakT"}),value:t.authPassword,isPassword:!0,validate:s=>t.authMode===w.None||!!s.trim(),handleChange:s=>r("authPassword",s)}),t.authMode===w.UiLogin&&e.jsxs(e.Fragment,{children:[e.jsx(n,{settingName:a._({id:"4cDbUL"}),value:t.jwtAudience,handleChange:s=>r("jwtAudience",s)}),e.jsx(_,{settingTitle:a._({id:"iy6/4L"}),settingValue:C(t.jwtTokenExpiry).minutes.humanize(),value:C(t.jwtTokenExpiry).minutes.inWholeMinutes,valueUnit:a._({id:"6UYTy8"}),defaultValue:I.default,minValue:I.min,maxValue:I.max,handleUpdate:s=>r("jwtTokenExpiry",C(s).minutes.toISOString()),showSlider:!0}),e.jsx(_,{settingTitle:a._({id:"edd3iD"}),settingValue:C(t.jwtRefreshExpiry).days.humanize(),value:C(t.jwtRefreshExpiry).days.inWholeDays,valueUnit:a._({id:"H7OUPr"}),defaultValue:B.default,minValue:B.min,maxValue:B.max,handleUpdate:s=>r("jwtRefreshExpiry",C(s).days.toISOString()),showSlider:!0})]})]}),e.jsxs(h,{subheader:e.jsx(x,{component:"div",id:"server-settings-clouadflare-bypass",children:a._({id:"suR1M1"})}),children:[e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"AqggDz"}),secondary:e.jsx(le,{id:"+XFSWG",components:{0:e.jsx(xe,{href:"https://github.com/FlareSolverr/FlareSolverr?tab=readme-ov-file#installation",target:"_blank",rel:"noreferrer"})}})}),e.jsx(c,{edge:"end",checked:t.flareSolverrEnabled,onChange:s=>r("flareSolverrEnabled",s.target.checked)})]}),e.jsx(n,{settingName:a._({id:"PodnxK"}),dialogDescription:a._({id:"4lrq7s"}),value:t.flareSolverrUrl,handleChange:s=>r("flareSolverrUrl",s)}),e.jsx(_,{settingTitle:a._({id:"yzsb1/"}),settingValue:a._({id:"RRgNMe",values:{0:t.flareSolverrTimeout}}),dialogDescription:a._({id:"xvwlRN"}),value:t.flareSolverrTimeout,defaultValue:60,minValue:20,maxValue:60*5,stepSize:1,showSlider:!0,valueUnit:a._({id:"ku//5b"}),handleUpdate:s=>r("flareSolverrTimeout",s)}),e.jsx(n,{settingName:a._({id:"Xbcbrg"}),value:t.flareSolverrSessionName,handleChange:s=>r("flareSolverrSessionName",s)}),e.jsx(_,{settingTitle:a._({id:"/GGbha"}),settingValue:a._({id:"PlVus2",values:{0:t.flareSolverrSessionTtl}}),dialogDescription:a._({id:"RL110l"}),value:t.flareSolverrSessionTtl,defaultValue:15,minValue:1,maxValue:60,stepSize:1,showSlider:!0,valueUnit:a._({id:"6UYTy8"}),handleUpdate:s=>r("flareSolverrSessionTtl",s)}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"WRRVr6"}),secondary:a._({id:"6RZNqg"})}),e.jsx(c,{edge:"end",checked:t.flareSolverrAsResponseFallback,onChange:s=>r("flareSolverrAsResponseFallback",s.target.checked)})]})]}),e.jsxs(h,{subheader:e.jsx(x,{component:"div",id:"server-settings-opds",children:a._({id:"1CgbvA"})}),children:[e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"PvaA4n"}),secondary:a._({id:"OpJaQ1"})}),e.jsx(c,{edge:"end",checked:t.opdsUseBinaryFileSizes,onChange:s=>r("opdsUseBinaryFileSizes",s.target.checked)})]}),e.jsx(_,{settingTitle:a._({id:"rYHzDr"}),settingValue:t.opdsItemsPerPage.toString(),dialogDescription:a._({id:"6bbe+O"}),value:t.opdsItemsPerPage,defaultValue:50,minValue:10,maxValue:5e3,stepSize:10,showSlider:!0,valueUnit:a._({id:"/uUlFU"}),handleUpdate:s=>r("opdsItemsPerPage",s)}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"t/Uh/y"}),secondary:a._({id:"Ksbu3S"})}),e.jsx(c,{edge:"end",checked:t.opdsEnablePageReadProgress,onChange:s=>r("opdsEnablePageReadProgress",s.target.checked)})]}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"21fX0f"}),secondary:a._({id:"gAg0jz"})}),e.jsx(c,{edge:"end",checked:t.opdsMarkAsReadOnDownload,onChange:s=>r("opdsMarkAsReadOnDownload",s.target.checked)})]}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"OGJIxn"}),secondary:a._({id:"lBguvO"})}),e.jsx(c,{edge:"end",checked:t.opdsShowOnlyUnreadChapters,onChange:s=>r("opdsShowOnlyUnreadChapters",s.target.checked)})]}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"MKIIWQ"}),secondary:a._({id:"rnLFHn"})}),e.jsx(c,{edge:"end",checked:t.opdsShowOnlyDownloadedChapters,onChange:s=>r("opdsShowOnlyDownloadedChapters",s.target.checked)})]}),e.jsx(v,{settingName:a._({id:"O+jeEW"}),dialogDescription:a._({id:"KJBWIH"}),value:t.opdsChapterSortOrder,values:[[W.Asc,{text:a._({id:"nYD/Cq"})}],[W.Desc,{text:a._({id:"Cko536"})}]],handleChange:s=>r("opdsChapterSortOrder",s)}),e.jsx(v,{settingName:a._({id:"X82C+j"}),dialogDescription:a._({id:"vRvxLg"}),value:t.opdsCbzMimetype,values:[[H.Legacy,{text:a._({id:"Sn1jT8"})}],[H.Modern,{text:a._({id:"IU7sBy"})}],[H.Compatible,{text:a._({id:"33v1rN"})}]],handleChange:s=>r("opdsCbzMimetype",s)})]}),e.jsx(me,{settings:t,serverAddress:j.serverAddress,username:j.username,isLoggedIn:j.isLoggedIn,updateSetting:r}),e.jsxs(h,{subheader:e.jsx(x,{component:"div",id:"server-settings-database",children:a._({id:"JY5Oyv"})}),children:[e.jsx(v,{settingName:a._({id:"+zy2Nq"}),value:t.databaseType,values:[[z.H2,{text:a._({id:"Vk0+bV"})}],[z.Postgresql,{text:a._({id:"YJ8OX/"})}]],handleChange:s=>r("databaseType",s)}),e.jsx(n,{settingName:a._({id:"2i9vSp"}),handleChange:s=>r("databaseUrl",s),value:t.databaseUrl,placeholder:"postgresql://localhost:5432/suwayomi",disabled:k}),e.jsx(n,{settingName:a._({id:"7sNhEz"}),value:t.databaseUsername,handleChange:s=>r("databaseUsername",s),disabled:k}),e.jsx(n,{settingName:a._({id:"8ZsakT"}),value:t.databasePassword,handleChange:s=>r("databasePassword",s),disabled:k,isPassword:!0}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"Fq7Eez"}),secondary:a._({id:"x/ksEp"})}),e.jsx(c,{edge:"end",checked:t.useHikariConnectionPool,onChange:s=>r("useHikariConnectionPool",s.target.checked)})]})]}),e.jsxs(h,{subheader:e.jsx(x,{component:"div",id:"server-settings-misc",children:a._({id:"7gjU/0"})}),children:[e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"/CEXTz"})}),e.jsx(c,{edge:"end",checked:t.debugLogsEnabled,onChange:s=>r("debugLogsEnabled",s.target.checked)})]}),e.jsxs(l,{children:[e.jsx(o,{primary:a._({id:"jdKrxF"}),secondary:a._({id:"agLJTe"})}),e.jsx(c,{edge:"end",checked:t.systemTrayEnabled,onChange:s=>r("systemTrayEnabled",s.target.checked)})]}),e.jsx(_,{settingTitle:a._({id:"gy0Zlr"}),settingValue:_e(t.maxLogFiles),value:t.maxLogFiles,valueUnit:a._({id:"H7OUPr"}),handleUpdate:s=>r("maxLogFiles",s)}),e.jsx(n,{settingName:a._({id:"sEmi/d"}),value:t.maxLogFileSize,dialogDescription:a._({id:"RGlpP+"}),validate:s=>!!s.match(/^[0-9]+(|kb|KB|mb|MB|gb|GB)$/g),handleChange:s=>r("maxLogFileSize",s)}),e.jsx(n,{settingName:a._({id:"P73ZCN"}),value:t.maxLogFolderSize,dialogDescription:a._({id:"RGlpP+"}),validate:s=>!!s.match(/^[0-9]+(|kb|KB|mb|MB|gb|GB)$/g),handleChange:s=>r("maxLogFolderSize",s)})]})]})};export{Le as ServerSettings};
