import{r as D,i as L,j as e,D as Je,u as S,l as Le,c as p,h as Ae,H as le,P as ie,S as k,L as Q,T as V,J as Ye,f as I,I as w,K as J,O as Fe,Q as Xe,R as G,C as A,k as Ze,M as we,v as Be,a as E,U as et,g as Oe,V as Ne,B as Ee,W as tt,e as rt,G as at,X as st,Y as ot,m as ne,Z as nt,_ as lt,$ as it,d as dt,a0 as ct,a1 as ut,a2 as te,a3 as re,a4 as ae,N as ht,a5 as pt,a6 as ft,a7 as mt,a8 as gt}from"./index-7xHMGivc.js";import{V as xt}from"./index-C4v_tww9.js";import{d as Pe}from"./Download-B8ejdiPo.js";import{M as T,d as bt,a as jt,b as kt,c as vt,e as _t,f as Ct,J as yt,g as wt,h as It,u as St,C as Mt,T as Rt,i as $t,j as Tt,k as Dt,l as Lt,m as Ie,n as Se}from"./useManageMangaLibraryState-DzRC4Bnq.js";import{D as At}from"./DownloadStateIndicator-BJWuXsBI.js";import{d as Ft}from"./Delete-_kcpO3ew.js";import{C as _,a as Bt}from"./Chapters-DnTEEDAi.js";import{T as Ot,s as de}from"./TypographyMaxLines-CTSnwq0g.js";import{C as Nt}from"./Card-Bc_2G7UR.js";import{C as Et}from"./CardActionArea-CKhuyHIi.js";import{C as Pt}from"./CardContent-X_sNHadm.js";import{C as zt}from"./Checkbox-BXDXLTKP.js";import{d as Ht}from"./PlayArrow-DtkbzT5p.js";import{S as Vt,D as Gt}from"./StyledFab-BBiB1Piz.js";import{E as K}from"./EmptyViewAbsoluteCentered-DPYCGu66.js";import{d as qt}from"./FilterList-BpkO1uWA.js";import{S as Wt,R as Me}from"./SortRadioInput-M5E64136.js";import{T as se}from"./ThreeStateCheckboxInput-DeoMbdxS.js";import{O as Ut,a as Kt,S as Qt,b as Jt,d as Yt}from"./SelectionFAB-CotFNPwk.js";import{R as Xt}from"./ListPreference-Ccg44E-L.js";import{M as q,s as Zt,a as er}from"./Mangas-xogFsVME.js";import{d as tr,a as rr,b as ar}from"./ExpandMore-BPtaaLpb.js";import{S as Re}from"./SpinnerImage-CSv9wdGW.js";import{C as ce}from"./CustomIconButton-DnGvIVIw.js";import{d as sr}from"./Sync-DehOnmaI.js";import{T as oe}from"./Trackers-D4pSmk7a.js";import{L as or}from"./Link-BBQyfFjD.js";import{C as nr}from"./Collapse-BHRxp0ym.js";import{C as lr}from"./Chip-DCQzhumi.js";import{d as $e}from"./Refresh-B__8Oy0k.js";import"./Avatar-DFf7CCaU.js";import"./Info-CbB6Qo_S.js";import"./TextField-CWIR6ey_.js";import"./InputAdornment-dUOSQzmr.js";import"./CheckCircle-DzWMe7yq.js";import"./NumberSetting-eoA35H2B.js";import"./useMobilePicker-CQ1DZrxD.js";import"./SelectSetting-CuYuThdV.js";import"./Select-C19eXnbJ.js";import"./CheckboxInput-h91fZq8b.js";import"./SwitchBase-CKPVGabz.js";import"./Tabs-DNPXX1y3.js";var ue={},ir=L;Object.defineProperty(ue,"__esModule",{value:!0});var ze=ue.default=void 0,dr=ir(D()),cr=e;ze=ue.default=(0,dr.default)((0,cr.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");var he={},ur=L;Object.defineProperty(he,"__esModule",{value:!0});var pe=he.default=void 0,hr=ur(D()),pr=e;pe=he.default=(0,hr.default)((0,pr.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll");var fe={},fr=L;Object.defineProperty(fe,"__esModule",{value:!0});var He=fe.default=void 0,mr=fr(D()),gr=e;He=fe.default=(0,mr.default)((0,gr.jsx)("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"}),"Bookmark");var me={},xr=L;Object.defineProperty(me,"__esModule",{value:!0});var Ve=me.default=void 0,br=xr(D()),jr=e;Ve=me.default=(0,br.default)((0,jr.jsx)("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"}),"BookmarkRemove");var ge={},kr=L;Object.defineProperty(ge,"__esModule",{value:!0});var Ge=ge.default=void 0,vr=kr(D()),_r=e;Ge=ge.default=(0,vr.default)((0,_r.jsx)("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"}),"BookmarkAdd");var xe={},Cr=L;Object.defineProperty(xe,"__esModule",{value:!0});var be=xe.default=void 0,yr=Cr(D()),wr=e;be=xe.default=(0,yr.default)((0,wr.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"Launch");class C{static getChapters(r){return r.map(({chapter:a})=>a)}static getIds(r){return _.getIds(C.getChapters(r))}static getDownloaded(r){return r.filter(({chapter:a})=>_.isDownloaded(a))}static getDeletable(r,a){return r.filter(({chapter:o})=>_.isDeletable(o,a))}static getNonDownloaded(r){return r.filter(({chapter:a})=>!_.isDownloaded(a))}static isDownloadable({chapter:r,downloadChapter:a}){return!_.isDownloaded(r)&&(!a||(a==null?void 0:a.state)===Je.Error)}static getDownloadable(r){return r.filter(this.isDownloadable)}static getBookmarked(r){return r.filter(({chapter:a})=>_.isBookmarked(a))}static getNonBookmarked(r){return r.filter(({chapter:a})=>!_.isBookmarked(a))}static getRead(r){return r.filter(({chapter:a})=>_.isRead(a))}static getNonRead(r){return r.filter(({chapter:a})=>!_.isRead(a))}}const qe=({chapter:t,allChapters:r,handleSelection:a,canBeDownloaded:o=!1,selectedChapters:s=[],onClose:l})=>{const{t:n}=S(),d=!!t,{isDownloaded:b,isRead:m,isBookmarked:h}=t!=null?t:{},{settings:{deleteChaptersWithBookmark:i}}=Le(),g=vt(d,Bt),x=_t(d),j=Ct(d),{downloadableChapters:c,downloadedChapters:f,unbookmarkedChapters:v,bookmarkedChapters:y,unreadChapters:P,readChapters:F}=p.useMemo(()=>({downloadableChapters:C.getDownloadable(s),downloadedChapters:C.getDownloaded(s),unbookmarkedChapters:C.getNonBookmarked(s),bookmarkedChapters:C.getBookmarked(s),unreadChapters:C.getNonRead(s),readChapters:C.getRead(s)}),[s]),Y=()=>{a==null||a(t.id,!0),l()},M=(W,X)=>{var O;const R=W==="mark_prev_as_read",z=R?"mark_as_read":W;if(z==="delete"&&t&&!_.isDeletable(t,i)){l();return}const B=(()=>{if(!t)return C.getChapters(X);if(!R)return[t];const H=r.findIndex(({id:Z})=>Z===t.id);return H+1>r.length-1?[]:r.slice(H+1)})();if(!B.length){l();return}_.performAction(z,_.getIds(B),{chapters:B,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(O=B[0])==null?void 0:O.mangaId}).catch(Ae()),l()};return e.jsxs(e.Fragment,{children:[d&&e.jsx(T,{onClick:Y,Icon:bt,title:n("chapter.action.label.select")}),d&&e.jsx(T,{Icon:be,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),l()},title:n("chapter.action.label.open_on_source")}),x(o)&&e.jsx(T,{Icon:Pe,disabled:j(!c.length),onClick:()=>M("download",c),title:g("download",c.length)}),x(b)&&e.jsx(T,{Icon:Ft,disabled:j(!f.length),onClick:()=>M("delete",C.getDeletable(f,i)),title:g("delete",f.length)}),x(!h)&&e.jsx(T,{Icon:Ge,disabled:j(!v.length),onClick:()=>M("bookmark",v),title:g("bookmark",v.length)}),x(h)&&e.jsx(T,{Icon:Ve,disabled:j(!y.length),onClick:()=>M("unbookmark",y),title:g("unbookmark",y.length)}),x(!m)&&e.jsx(T,{Icon:jt,disabled:j(!P.length),onClick:()=>M("mark_as_read",P),title:g("mark_as_read",P.length)}),x(m)&&e.jsx(T,{Icon:kt,disabled:j(!F.length),onClick:()=>M("mark_as_unread",F),title:g("mark_as_unread",F.length)}),d&&e.jsx(T,{onClick:()=>M("mark_prev_as_read",[]),Icon:pe,title:n("chapter.action.mark_as_read.add.label.action.previous")})]})},Ir=t=>{const{t:r}=S(),a=le(),o=p.useRef(null),{chapter:s,allChapters:l,downloadChapter:n,showChapterNumber:d,onSelect:b,selected:m}=t,h=m!==null,{isDownloaded:i}=s,g=c=>{h&&(c.preventDefault(),c.stopPropagation(),b(!m,c.shiftKey))},x=(c,f)=>{c.stopPropagation(),c.preventDefault(),f(c)},j=yt((c,{context:f})=>{if(!h&&o.current){x(c,()=>f==null?void 0:f(o.current));return}c.shiftKey=!0,g(c)});return e.jsx("li",{children:e.jsx(ie,{variant:"popover",popupId:"chapter-card-action-menu",children:c=>{var f;return e.jsxs(k,{sx:{pt:1,px:1},children:[e.jsx(Nt,{sx:{touchCallout:"none"},children:e.jsx(Et,{component:Q,to:"/manga/".concat(s.mangaId,"/chapter/").concat(s.sourceOrder),style:{color:a.palette.text[s.isRead?"disabled":"primary"]},onClick:v=>g(v),...j(c.open),children:e.jsxs(Pt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5,"&:last-child":{pb:1.5}},children:[e.jsxs(k,{direction:"column",sx:{flex:1},children:[e.jsxs(k,{sx:{flexDirection:"row",gap:.5,alignItems:"center"},children:[s.isBookmarked&&e.jsx(He,{color:"primary"}),e.jsx(Ot,{variant:"h6",component:"h4",children:d?"".concat(r("chapter.title_one")," ").concat(s.chapterNumber):s.name})]}),e.jsx(V,{variant:"caption",children:s.scanlator}),e.jsxs(V,{variant:"caption",children:[Ye(Number((f=s.uploadDate)!=null?f:0),!0),i&&" â€¢ ".concat(r("chapter.status.label.downloaded"))]})]}),n&&e.jsx(At,{download:n}),e.jsx(k,{sx:{minHeight:"48px"},children:m===null?e.jsx(I,{title:r("global.button.options"),children:e.jsx(w,{ref:o,...J(c),onClick:v=>x(v,c.open),onTouchStart:v=>x(v,c.open),"aria-label":"more",size:"large",children:e.jsx(wt,{})})}):e.jsx(I,{title:r(m?"global.button.deselect":"global.button.select"),children:e.jsx(zt,{checked:m})})})]})})}),!h&&c.isOpen&&e.jsx(It,{...Fe(c),children:v=>e.jsx(qe,{onClose:v,chapter:s,allChapters:l,handleSelection:()=>b(!0),canBeDownloaded:C.isDownloadable({chapter:s,downloadChapter:n})})})]})}})})};function Sr(t){const{t:r}=S(),{chapterIndex:a,mangaId:o}=t;return e.jsxs(Vt,{component:Q,variant:"extended",color:"primary",to:"/manga/".concat(o,"/chapter/").concat(a),children:[e.jsx(Ht,{}),r(a===1?"global.button.start":"global.button.resume")]})}function Mr(t,{isRead:r}){switch(t){case!0:return!r;case!1:return r;default:return!0}}function Rr(t,{isDownloaded:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}function $r(t,{isBookmarked:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}const Tr=(t,{sortBy:r,reverse:a})=>{const o=[...t];switch(r){case"source":o.sort((s,l)=>s.sourceOrder-l.sourceOrder);break;case"fetchedAt":o.sort((s,l)=>{var n,d;return Number((n=s.fetchedAt)!=null?n:0)-Number((d=l.fetchedAt)!=null?d:0)});break;case"chapterNumber":o.sort((s,l)=>s.chapterNumber-l.chapterNumber);break;case"uploadedAt":o.sort((s,l)=>{var n,d;return Number((n=s.uploadDate)!=null?n:0)-Number((d=l.uploadDate)!=null?d:0)});break}return a&&o.reverse(),o};function Dr(t,r){const a=r.active?t.filter(o=>Mr(r.unread,o)&&Rr(r.downloaded,o)&&$r(r.bookmarked,o)):[...t];return Tr(a,r)}const Lr=t=>{const{unread:r,downloaded:a,bookmarked:o}=t;return r!=null||a!=null||o!=null},Ar={active:!1,unread:void 0,downloaded:void 0,bookmarked:void 0,reverse:!0,sortBy:"source",showChapterNumber:!1},Fr={source:"global.sort.label.by_source",chapterNumber:"global.sort.label.by_chapter_number",uploadedAt:"global.sort.label.by_upload_date",fetchedAt:"global.sort.label.by_fetch_date"},Br={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},Or=({open:t,onClose:r,options:a,optionsDispatch:o})=>{const{t:s}=S();return e.jsx(Ut,{open:t,onClose:r,minHeight:150,tabs:["filter","sort","display"],tabTitle:l=>s(Br[l]),tabContent:l=>l==="filter"?e.jsxs(e.Fragment,{children:[e.jsx(se,{label:s("global.filter.label.unread"),checked:a.unread,onChange:n=>o({type:"filter",filterType:"unread",filterValue:n})}),e.jsx(se,{label:s("global.filter.label.downloaded"),checked:a.downloaded,onChange:n=>o({type:"filter",filterType:"downloaded",filterValue:n})}),e.jsx(se,{label:s("global.filter.label.bookmarked"),checked:a.bookmarked,onChange:n=>o({type:"filter",filterType:"bookmarked",filterValue:n})})]}):l==="sort"?Object.entries(Fr).map(([n,d])=>e.jsx(Wt,{label:s(d),checked:a.sortBy===n,sortDescending:a.reverse,onClick:()=>n!==a.sortBy?o({type:"sortBy",sortBy:n}):o({type:"sortReverse"})},n)):l==="display"?e.jsxs(Xt,{onChange:()=>o({type:"showChapterNumber"}),value:a.showChapterNumber,children:[e.jsx(Me,{label:s("chapter.option.display.label.source_title"),value:!1}),e.jsx(Me,{label:s("chapter.option.display.label.chapter_number"),value:!0})]}):null})},Nr=({options:t,optionsDispatch:r})=>{const{t:a}=S(),[o,s]=p.useState(!1),l=Lr(t);return e.jsxs(e.Fragment,{children:[e.jsx(I,{title:a("settings.title"),children:e.jsx(w,{onClick:()=>s(!0),children:e.jsx(qt,{color:l?"warning":void 0})})}),e.jsx(Or,{open:o,onClose:()=>s(!1),options:t,optionsDispatch:r})]})};function Er(t,r){switch(r.type){case"filter":return{...t,active:t.unread!==!1&&t.downloaded!==!1&&t.bookmarked!==!1,[r.filterType]:r.filterValue};case"sortBy":return{...t,sortBy:r.sortBy};case"sortReverse":return{...t,reverse:!t.reverse};case"showChapterNumber":return{...t,showChapterNumber:!t.showChapterNumber};default:throw Error(G("global.error.label.invalid_action"))}}const Pr=t=>Xe(Er,"".concat(t,"filterOptions"),Ar),zr=A(k,{shouldForwardProp:de(["scrollbarWidth"])})(({theme:t,scrollbarWidth:r})=>({padding:t.spacing(1),paddingRight:"calc(".concat(r,"px + ").concat(t.spacing(1),")"),paddingBottom:0,[t.breakpoints.down("md")]:{paddingRight:t.spacing(1)}})),Hr=A(xt,{shouldForwardProp:de(["topOffset"])})(({theme:t,topOffset:r})=>({listStyle:"none",padding:0,[t.breakpoints.up("md")]:{height:"calc(100vh - ".concat(r,"px)"),margin:0}})),Vr=({manga:t,isRefreshing:r})=>{var Ce,ye;const{t:a}=S(),{appBarHeight:o}=Ze(),s=we.useIsBelowWidth("md"),[l,n]=p.useState(50),[d,b]=p.useState(null);Be(d,p.useCallback(()=>{var u;return n((u=d==null?void 0:d.offsetHeight)!=null?u:0)},[d]));const m=we.useGetScrollbarSize("width"),{data:h}=E.useGetDownloadStatus(),i=(Ce=h==null?void 0:h.downloadStatus.queue)!=null?Ce:[],[g,x]=Pr(t.id),{data:j,loading:c,error:f,refetch:v}=E.useGetMangaChapters(et,t.id,{notifyOnNetworkStatusChange:!0}),y=p.useMemo(()=>{var u;return(u=j==null?void 0:j.chapters.nodes)!=null?u:[]},[j==null?void 0:j.chapters.nodes]),P=p.useMemo(()=>y.map(u=>u.id),[y]),{areNoItemsSelected:F,areAllItemsSelected:Y,selectedItemIds:M,handleSelectAll:W,handleSelection:X}=St(y.length,{itemIds:P,currentKey:"default"}),R=p.useMemo(()=>Dr(y,g),[y,g]),z=(ye=t.firstUnreadChapter)==null?void 0:ye.sourceOrder,_e=q.isFullyRead(t),B=q.isFullyDownloaded(t),O=y.length===0,H=!O&&R.length===0,N=p.useMemo(()=>R.map(u=>{const $=i==null?void 0:i.find(Qe=>Qe.chapter.id===u.id),ee=F?null:M.includes(u.id);return{chapter:u,downloadChapter:$,selected:ee}}),[i,M,R]),Z=p.useMemo(()=>{const u=N.filter($=>$.selected);return u.length?e.jsx(Kt,{selectedItemsCount:u.length,title:"chapter.title_one",children:$=>e.jsx(qe,{selectedChapters:u,onClose:$})}):z!==void 0?e.jsx(Sr,{chapterIndex:z,mangaId:t.id}):null},[N]);return c||O&&r?e.jsx(k,{sx:{justifyContent:"center",alignItems:"center",position:"relative",flexGrow:1},children:e.jsx(Oe,{})}):f?e.jsx(k,{sx:{justifyContent:"center",position:"relative",flexGrow:1},children:e.jsx(K,{message:a("global.error.label.failed_to_load_data"),messageExtra:f.message,retry:()=>v().catch(Ae())})}):e.jsxs(e.Fragment,{children:[e.jsxs(k,{direction:"column",sx:{position:"relative",flexBasis:"60%"},children:[e.jsxs(zr,{ref:b,direction:"row",alignItems:"center",justifyContent:"space-between",scrollbarWidth:m,children:[e.jsx(V,{variant:"h5",component:"h3",children:"".concat(R.length," ").concat(a("chapter.title_one",{count:R.length}))}),e.jsxs(k,{direction:"row",children:[e.jsx(I,{title:a("chapter.action.mark_as_read.add.label.action.current"),children:e.jsx(w,{disabled:_e,onClick:()=>_.markAsRead(C.getChapters(C.getNonRead(N)),!0,t.id),children:e.jsx(pe,{})})}),e.jsx(ie,{variant:"popover",popupId:"chapterlist-download-button",children:u=>e.jsxs(e.Fragment,{children:[e.jsx(I,{title:a("chapter.action.download.add.label.action"),children:e.jsx(w,{disabled:B,...J(u),children:e.jsx(Pe,{})})}),u.isOpen&&e.jsx(Ne,{...Fe(u),children:e.jsx(Mt,{mangaIds:[t.id],closeMenu:u.close})})]})}),e.jsx(Nr,{options:g,optionsDispatch:x}),e.jsx(Qt,{areAllItemsSelected:Y,areNoItemsSelected:F,onChange:u=>W(u,u?y.map($=>$.id):[])})]})]}),O&&e.jsx(K,{message:a("chapter.error.label.no_chapter_found")}),H&&e.jsx(K,{message:a("chapter.error.label.no_matches")}),e.jsx(Hr,{topOffset:o+l,style:{height:"undefined"},components:{Footer:()=>e.jsx(Ee,{sx:{paddingBottom:Gt}})},totalCount:R.length,computeItemKey:u=>R[u].id,itemContent:u=>e.jsx(Ir,{...N[u],allChapters:y,showChapterNumber:g.showChapterNumber,onSelect:($,ee)=>X(N[u].chapter.id,$,{selectRange:ee})}),useWindowScroll:s,overscan:window.innerHeight*.5})]}),Z]})},Gr=t=>{const[r,a]=p.useState(!1),[o,s]=p.useState(null);return[p.useCallback(async()=>{a(!0),s(null),await Promise.all([E.getMangaFetch(t,{awaitRefetchQueries:!0}).response,E.getMangaChaptersFetch(t,{awaitRefetchQueries:!0}).response]).catch(n=>{n instanceof tt&&Jt(n.message)==="no chapters found"||s(n)}).finally(()=>a(!1))},[t]),{loading:r,error:o}]};var je={},qr=L;Object.defineProperty(je,"__esModule",{value:!0});var We=je.default=void 0,Wr=qr(D()),Ur=e;We=je.default=(0,Wr.default)((0,Ur.jsx)("path",{d:"M21 11V3h-8l3.29 3.29-10 10L3 13v8h8l-3.29-3.29 10-10z"}),"OpenInFull");var ke={},Kr=L;Object.defineProperty(ke,"__esModule",{value:!0});var Ue=ke.default=void 0,Qr=Kr(D()),Jr=e;Ue=ke.default=(0,Qr.default)((0,Jr.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");var ve={},Yr=L;Object.defineProperty(ve,"__esModule",{value:!0});var Ke=ve.default=void 0,Xr=Yr(D()),Zr=e;Ke=ve.default=(0,Xr.default)((0,Zr.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");const ea=({manga:t})=>{var m,h;const{t:r}=S(),a=rt(),o=E.useGetTrackerList(at),s=(h=(m=o.data)==null?void 0:m.trackers.nodes)!=null?h:[],l=t.trackRecords.nodes,n=oe.getLoggedIn(s),d=oe.getLoggedIn(oe.getTrackers(l,s)),b=i=>{if(o.error){ne(r("tracking.error.label.could_not_load_track_info"),"error");return}if(!n.length){a("/settings/trackingSettings");return}i()};return e.jsx(ie,{variant:"dialog",popupId:"manga-track-modal",children:i=>e.jsxs(e.Fragment,{children:[e.jsxs(ce,{...J(i),size:"medium",disabled:o.loading||!!o.error,onClick:()=>b(i.open),onTouchStart:()=>b(i.open),variant:d.length?"contained":"outlined",children:[d.length?e.jsx(Ke,{}):e.jsx(sr,{}),d.length?r("manga.button.track.active",{count:d.length}):r("manga.button.track.start")]}),e.jsx(st,{...ot(i),maxWidth:"md",fullWidth:!0,scroll:"paper",children:e.jsx(Rt,{manga:t})})]})})},ta=A("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(2),padding:t.spacing(1),[t.breakpoints.up("md")]:{flexBasis:"40%",height:"calc(100vh - 64px)",overflowY:"auto"}})),ra=A("div",{shouldForwardProp:de(["url","mangaThumbnailBackdrop"])})(({theme:t,url:r,mangaThumbnailBackdrop:a})=>({position:"relative",backgroundImage:a?"url(".concat(r,")"):void 0,backgroundRepeat:a?"no-repeat":void 0,backgroundSize:a?"cover":void 0,borderRadius:a?t.shape.borderRadius:void 0,"&::before":a&&{position:"absolute",display:"inline-block",content:'""',top:0,left:0,width:"100%",height:"100%",background:"linear-gradient(to top, ".concat(t.palette.background.default,", transparent 100%, transparent 1px),linear-gradient(to right, ").concat(t.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to bottom, ").concat(t.palette.background.default,", transparent 50%, transparent 1px),linear-gradient(to left, ").concat(t.palette.background.default,", transparent 50%, transparent 1px)"),backdropFilter:"blur(4.5px) brightness(0.75)"}})),aa=A("div")(({theme:t})=>({display:"flex",paddingBottom:t.spacing(1)})),sa=A("div")(({theme:t})=>({zIndex:1,marginLeft:t.spacing(1)})),U=t=>e.jsx(Dt,{...t}),oa=A("div")(({theme:t})=>({display:"flex",gap:t.spacing(1)})),na=({url:t})=>{const{t:r}=S();return e.jsx(I,{title:r("global.button.open_site"),children:e.jsx(ce,{size:"medium",disabled:!t,component:or,href:t!=null?t:void 0,target:"_blank",rel:"noreferrer",variant:"outlined",children:e.jsx(be,{})})})};function la(t){var a;return t?Number(t.id)===0?G("source.local_source.title"):(a=t.displayName)!=null?a:t.id:G("global.label.unknown")}function Te(t){return t!=null?t:G("global.label.unknown")}const ia=({manga:t})=>{const r=le(),a=nt({variant:"popover",popupId:"manga-thumbnail-fullscreen"}),[o,s]=p.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(k,{sx:{position:"relative",borderRadius:1,overflow:"hidden",backgroundColor:"background.paper",width:"150px",maxHeight:"fit-content",aspectRatio:er,flexShrink:0,flexGrow:0,[r.breakpoints.up("lg")]:{width:"200px"},[r.breakpoints.up("xl")]:{width:"300px"}},children:[e.jsx(Re,{src:q.getThumbnailUrl(t),alt:"Manga Thumbnail",onImageLoad:()=>s(!0),imgStyle:{width:"100%",height:"100%",objectFit:"cover"}}),o&&e.jsx(k,{...J(a),sx:{position:"absolute",top:0,bottom:0,width:"100%",justifyContent:"center",alignItems:"center",opacity:0,"&:hover":{background:"rgba(0, 0, 0, 0.4)",cursor:"pointer",opacity:1}},children:e.jsx(We,{fontSize:"large",color:"primary"})})]}),e.jsx(lt,{...it(a),sx:{outline:0},children:e.jsx(k,{onClick:()=>a.close(),sx:{height:"100vh",p:2,outline:0,justifyContent:"center",alignItems:"center"},children:e.jsx(Re,{src:q.getThumbnailUrl(t),alt:"Manga Thumbnail",imgStyle:{height:"100%",width:"100%",objectFit:"contain"}})})})]})},De=75,da=({manga:{description:t,genre:r}})=>{const[a,o]=p.useState(null),[s,l]=p.useState();Be(a,p.useCallback(()=>l(a==null?void 0:a.clientHeight),[a]));const[n,d]=dt("isDescriptionGenreCollapsed",!0),b=t?Math.min(De,s!=null?s:De):0,m=p.useMemo(()=>r.filter(Boolean),[r]);return e.jsxs(e.Fragment,{children:[t&&e.jsxs(k,{sx:{position:"relative"},children:[e.jsx(nr,{collapsedSize:b,in:!n,children:e.jsx(V,{ref:o,style:{whiteSpace:"pre-line",textAlign:"justify",textJustify:"inter-word"},children:t})}),e.jsx(k,{onClick:()=>d(!n),sx:{pt:1,alignItems:"center",cursor:"pointer",position:n?"absolute":null,width:"100%",bottom:0,background:h=>"linear-gradient(transparent 1px, ".concat(h.palette.background.default,")")},children:e.jsx(w,{sx:{color:h=>h.palette.mode==="light"?"black":"text"},children:n?e.jsx(rr,{}):e.jsx(ar,{})})})]}),e.jsx(k,{sx:{flexDirection:"row",flexWrap:n?"no-wrap":"wrap",gap:1,overflowX:n?"auto":null},children:m.map(h=>e.jsx(lr,{label:h,variant:"outlined"},h))})]})},ca=({manga:t})=>{const{t:r}=S(),{settings:{mangaThumbnailBackdrop:a}}=Le();p.useEffect(()=>{t.source||ne(G("source.error.label.source_not_found"),"error")},[t.source]);const{CategorySelectComponent:o,updateLibraryState:s}=$t(t),l=async()=>{try{await navigator.clipboard.writeText(t.title),ne(r("global.label.copied"),"info")}catch(n){}};return e.jsxs(e.Fragment,{children:[e.jsxs(ta,{children:[e.jsxs(ra,{url:q.getThumbnailUrl(t),mangaThumbnailBackdrop:a,children:[e.jsxs(aa,{children:[e.jsx(ia,{manga:t}),e.jsxs(sa,{children:[e.jsxs(k,{sx:{flexDirection:"row",gap:1,alignItems:"flex-start",mb:1},children:[e.jsx(V,{variant:"h5",component:"h2",sx:{wordBreak:"break-word"},children:t.title}),e.jsx(I,{title:r("global.button.copy"),children:e.jsx(w,{onClick:l,color:"inherit",children:e.jsx(Ue,{fontSize:"small"})})})]}),e.jsx(U,{title:r("manga.label.author"),value:Te(t.author)}),e.jsx(U,{title:r("manga.label.artist"),value:Te(t.artist)}),e.jsx(U,{title:r("manga.label.status"),value:r(Zt[t.status])}),e.jsx(U,{title:r("source.title_one"),value:la(t.source)})]})]}),e.jsxs(oa,{children:[e.jsxs(ce,{size:"medium",onClick:s,variant:t.inLibrary?"contained":"outlined",children:[t.inLibrary?e.jsx(tr,{}):e.jsx(Tt,{}),t.inLibrary?r("manga.button.in_library"):r("manga.button.add_to_library")]}),e.jsx(ea,{manga:t}),e.jsx(na,{url:t.realUrl})]})]}),e.jsx(da,{manga:t})]}),o]})},ua=({manga:t,onRefresh:r,refreshing:a})=>{const{t:o}=S(),s=le(),l=ct(s.breakpoints.up("sm")),[n,d]=ut.useState(null),b=!!n,m=()=>{d(null)},{openCategorySelect:h,CategorySelectComponent:i}=Lt({mangaId:t.id});return e.jsxs(e.Fragment,{children:[l&&e.jsxs(e.Fragment,{children:[e.jsx(I,{title:o("manga.label.reload_from_source"),children:e.jsx(w,{onClick:()=>{r()},disabled:a,color:"inherit",children:e.jsx($e,{})})}),t.inLibrary&&e.jsxs(e.Fragment,{children:[e.jsx(I,{title:o("global.button.migrate"),children:e.jsx(Q,{to:"/migrate/source/".concat(t.sourceId,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:e.jsx(w,{color:"inherit",children:e.jsx(Ie,{})})})}),e.jsx(I,{title:o("manga.label.edit_categories"),children:e.jsx(w,{onClick:()=>{h(!0)},color:"inherit",children:e.jsx(Se,{})})})]})]}),!l&&e.jsxs(e.Fragment,{children:[e.jsx(w,{id:"chaptersMenuButton","aria-controls":b?"chaptersMenu":void 0,"aria-haspopup":"true","aria-expanded":b?"true":void 0,onClick:g=>d(g.currentTarget),color:"inherit",children:e.jsx(Yt,{})}),e.jsxs(Ne,{id:"chaptersMenu",anchorEl:n,open:b,onClose:m,MenuListProps:{"aria-labelledby":"chaptersMenuButton"},children:[e.jsxs(te,{onClick:()=>{r(),m()},disabled:a,children:[e.jsx(re,{children:e.jsx($e,{fontSize:"small"})}),e.jsx(ae,{children:o("manga.label.reload_from_source")})]}),t.inLibrary&&[e.jsxs(te,{component:Q,to:"/migrate/source/".concat(t.sourceId,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:[e.jsx(re,{children:e.jsx(Ie,{fontSize:"small"})}),e.jsx(ae,{children:o("migrate.title")})]},"migrate"),e.jsxs(te,{onClick:()=>{h(!0),m()},children:[e.jsx(re,{children:e.jsx(Se,{fontSize:"small"})}),e.jsx(ae,{children:o("manga.label.edit_categories")})]},"categories")]]})]}),i]})},es=()=>{const{t}=S(),{setTitle:r,setAction:a}=p.useContext(ht),{id:o}=pt(),s=p.useRef(!1),{data:l,error:n,loading:d,networkStatus:b,refetch:m}=E.useGetManga(ft,o),h=gt(b),i=l==null?void 0:l.manga,[g,{loading:x,error:j}]=Gr(o),c=n!=null?n:j;return p.useEffect(()=>{if(i==null)return;!s.current&&!i.initialized&&(s.current=!0,g())},[i]),p.useLayoutEffect(()=>{var f;return r((f=i==null?void 0:i.title)!=null?f:t("manga.title_one")),a(null),()=>{r(""),a(null)}},[t,i==null?void 0:i.title]),p.useLayoutEffect(()=>{var f;return a(e.jsxs(k,{direction:"row",sx:{alignItems:"center"},children:[c&&!h&&!x&&e.jsx(I,{title:e.jsxs(e.Fragment,{children:[t("manga.error.label.request_failure"),e.jsx("br",{}),(f=c.message)!=null?f:c]}),children:e.jsx(w,{onClick:()=>m(),children:e.jsx(ze,{color:"error"})})}),i&&(x||h)&&e.jsx(w,{disabled:!0,children:e.jsx(mt,{size:16})}),i&&e.jsx(ua,{manga:i,onRefresh:g,refreshing:x})]})),()=>{a(null)}},[t,c,h,x,i,g]),c&&!i?e.jsx(K,{message:t("manga.error.label.request_failure"),messageExtra:c.message}):e.jsxs(Ee,{sx:{display:{md:"flex"},overflow:"hidden"},children:[d&&e.jsx(Oe,{}),i&&e.jsx(ca,{manga:i}),i&&e.jsx(Vr,{manga:i,isRefreshing:x})]})};export{es as Manga};
