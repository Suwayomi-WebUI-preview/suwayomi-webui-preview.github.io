var J=Object.freeze,ce=Object.defineProperty;var Q=(e,t)=>J(ce(e,"raw",{value:J(t||e.slice())}));import{f as n,c as G,j as u,aA as ie,aB as le,v as ue,av as de,B,a9 as ge,dT as fe,k as _,V as he,W as me,u as te,r as P,dU as ae,o as be,p as pe,q as ve,w as Ce,b as q,A as oe,L as ye,dV as xe,$ as Me,m as F,g as R,bi as $,cF as Se,dW as Te,aC as we}from"./index-DTQcHRNq.js";import{D as Le}from"./Chapters-NZHwVf0F.js";import{a as U}from"./Mangas-CMkGJwB6.js";import{T as ke}from"./ThreeStateCheckboxInput-CTUW5Zlv.js";import{C as Ie}from"./CheckboxInput-BZKNpBRd.js";import{F as Ee}from"./FormGroup-tKJXr1mD.js";var O=(e=>(e.Mouse="mouse",e.Touch="touch",e.Pointer="pointer",e))(O||{}),N=(e=>(e.CancelledByMovement="cancelled-by-movement",e.CancelledByRelease="cancelled-by-release",e.CancelledOutsideElement="cancelled-outside-element",e))(N||{});const Ae=["mousedown","mousemove","mouseup","mouseleave","mouseout"],_e=["touchstart","touchmove","touchend","touchcancel"],De=["pointerdown","pointermove","pointerup","pointerleave","pointerout"];function je(e){return typeof e=="object"&&e!==null&&"pageX"in e&&typeof e.pageX=="number"&&"pageY"in e&&typeof e.pageY=="number"}function Fe(e){var t;return Ae.includes((t=e==null?void 0:e.nativeEvent)==null?void 0:t.type)}function re(e){var t;return _e.includes((t=e==null?void 0:e.nativeEvent)==null?void 0:t.type)||"touches"in e}function Re(e){const{nativeEvent:t}=e;return t?De.includes(t==null?void 0:t.type)||"pointerId"in t:!1}function z(e){return Fe(e)||re(e)||Re(e)}function Z(e){var t;const a=re(e)?(t=e==null?void 0:e.touches)==null?void 0:t[0]:e;return je(a)?{x:a.pageX,y:a.pageY}:null}function Oe(e){return{target:e.target,currentTarget:e.currentTarget,nativeEvent:e,persist:()=>{}}}function ct(e,{threshold:t=400,captureEvent:a=!1,detect:r=O.Pointer,cancelOnMovement:c=!1,cancelOutsideElement:l=!0,filterEvents:i,onStart:g,onMove:C,onFinish:S,onCancel:T}={}){const y=n.useRef(!1),x=n.useRef(!1),M=n.useRef(),m=n.useRef(),w=n.useRef(e),p=n.useRef(null),L=n.useCallback(o=>s=>{x.current||z(s)&&(i!==void 0&&!i(s)||(a&&s.persist(),g==null||g(s,{context:o}),p.current=Z(s),x.current=!0,M.current=s.currentTarget,m.current=setTimeout(()=>{w.current&&(w.current(s,{context:o}),y.current=!0)},t)))},[a,i,g,t]),f=n.useCallback(o=>(s,d)=>{z(s)&&x.current&&(p.current=null,a&&s.persist(),y.current?S==null||S(s,{context:o}):x.current&&(T==null||T(s,{context:o,reason:d!=null?d:N.CancelledByRelease})),y.current=!1,x.current=!1,m.current!==void 0&&clearTimeout(m.current))},[a,S,T]),b=n.useCallback(o=>s=>{if(z(s)&&(C==null||C(s,{context:o}),c!==!1&&p.current)){const d=Z(s);if(d){const v=c===!0?25:c,h={x:Math.abs(d.x-p.current.x),y:Math.abs(d.y-p.current.y)};(h.x>v||h.y>v)&&f(o)(s,N.CancelledByMovement)}}},[f,c,C]),E=n.useCallback(o=>{if(e===null)return{};switch(r){case O.Mouse:{const s={onMouseDown:L(o),onMouseMove:b(o),onMouseUp:f(o)};return l&&(s.onMouseLeave=d=>{f(o)(d,N.CancelledOutsideElement)}),s}case O.Touch:return{onTouchStart:L(o),onTouchMove:b(o),onTouchEnd:f(o)};case O.Pointer:{const s={onPointerDown:L(o),onPointerMove:b(o),onPointerUp:f(o)};return l&&(s.onPointerLeave=d=>f(o)(d,N.CancelledOutsideElement)),s}}},[e,f,l,r,b,L]);return n.useEffect(()=>{function o(s){const d=Oe(s);f()(d)}return window.addEventListener("mouseup",o),window.addEventListener("touchend",o),window.addEventListener("pointerup",o),()=>{window.removeEventListener("mouseup",o),window.removeEventListener("touchend",o),window.removeEventListener("pointerup",o)}},[f]),n.useEffect(()=>()=>{m.current!==void 0&&clearTimeout(m.current)},[]),n.useEffect(()=>{w.current=e},[e]),E}const it=G(u.jsx("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"})),lt=G(u.jsx("path",{d:"m1.79 12 5.58 5.59L5.96 19 .37 13.41zm.45-7.78L12.9 14.89l-1.28 1.28L7.44 12l-1.41 1.41L11.62 19l2.69-2.69 4.89 4.89 1.41-1.41L3.65 2.81zm14.9 9.27L23.62 7 22.2 5.59l-6.48 6.48zM17.96 7l-1.41-1.41-3.65 3.66 1.41 1.41z"})),ut=G(u.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"})),dt=G(u.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"})),gt=({title:e,Icon:t,...a})=>u.jsxs(ie,{...a,children:[u.jsx(le,{children:u.jsx(t,{fontSize:"small"})}),u.jsx(ue,{children:e})]}),ft=(e,t)=>(a,r)=>{const c=r>0?" (".concat(r,")"):"";return"".concat(de(t[a].action[e?"single":"selected"])).concat(c)},ht=e=>(t=!1)=>e?t:!0,mt=e=>t=>e?!1:t,bt=({children:e,...t})=>u.jsx(B,{...t,sx:{minWidth:"unset",px:"10px",...t.sx},children:e}),pt=G(u.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),vt=({children:e,onClose:t,...a})=>{const[r,c]=n.useState(!1);return u.jsx(ge,{...a,open:a.open,onClose:t,sx:{visibility:!a.open||r?"hidden":"visible"},children:e(()=>{t({},"backdropClick"),c(!1)},c)})},Ne={...Le},Ge=e=>({...e,excludedScanlators:JSON.stringify(e.excludedScanlators)}),Be=(e,t=Ne,a)=>he("manga",e,t,void 0,a),ne=(e,t,a)=>Be({...e,meta:me(e.meta)},t,a),Ct=(e,t)=>ne(e,t),Ue=(e,t)=>{const a=ne(e,t,n.useEffect);return n.useMemo(()=>a,[e,t])},Pe=async(e,t,a)=>fe(e,[[t,Ge({[t]:a})[t]]]),qe=(e,t=_())=>(a,r)=>Pe(e,a,r).catch(t);function $e(e,{isRead:t}){switch(e){case!0:return!t;case!1:return t;default:return!0}}function ze(e,{isDownloaded:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function Ve(e,{isBookmarked:t}){switch(e){case!0:return t;case!1:return!t;default:return!0}}function He(e,{scanlator:t}){return!t||!e.includes(t)}const We=(e,{sortBy:t,reverse:a})=>{const r=[...e];switch(t){case"source":r.sort((c,l)=>c.sourceOrder-l.sourceOrder);break;case"fetchedAt":r.sort((c,l)=>{var i,g;return Number((i=c.fetchedAt)!=null?i:0)-Number((g=l.fetchedAt)!=null?g:0)});break;case"chapterNumber":r.sort((c,l)=>c.chapterNumber-l.chapterNumber);break;case"uploadedAt":r.sort((c,l)=>{var i,g;return Number((i=c.uploadDate)!=null?i:0)-Number((g=l.uploadDate)!=null?g:0)});break}return a&&r.reverse(),r};function Ye(e,t){return e.filter(a=>$e(t.unread,a)&&ze(t.downloaded,a)&&Ve(t.bookmarked,a)&&He(t.excludedScanlators,a))}function yt(e,t){const a=Ye(e,t);return We(a,t)}const xt=e=>{const{unread:t,downloaded:a,bookmarked:r,excludedScanlators:c}=e;return t!=null||a!=null||r!=null||!!c.length},Mt=e=>{const{unread:t,downloaded:a,bookmarked:r,reverse:c,sortBy:l,showChapterNumber:i,excludedScanlators:g}=Ue(e);return n.useMemo(()=>({unread:t,downloaded:a,bookmarked:r,reverse:c,sortBy:l,showChapterNumber:i,excludedScanlators:g}),[t,a,r,c,l,i,g])},St=(e,t=_())=>qe(e,t),Ke=(e,{itemIds:t=[],keyCount:a=e,currentKey:r,initialState:c={}})=>{var E;const[l,i]=n.useState(c),g=n.useRef(void 0),C=[...new Set(Object.values(l).flat())],S=C.length===e,T=!C.length,y=(E=l[r])!=null?E:[],x=y.length===a,M=y.length===0;M&&(g.current=void 0);const m=n.useCallback((o,s,{selectRange:d=!1,key:v=r}={})=>{var K;const h=!s,{id:k,key:V}=(K=g.current)!=null?K:{};g.current={id:o,key:v};const I=d&&v===V&&k!==void 0,H=I?t.indexOf(k):-1,W=I?t.indexOf(o):-1,Y=I?t.slice(Math.min(H,W),Math.max(H,W)+1):[o];if(h){i(D=>{var j,X;return{...D,[v]:(X=(j=D[v])==null?void 0:j.filter(se=>!Y.includes(se)))!=null?X:[]}});return}i(D=>{var j;return{...D,[v]:[...new Set([...(j=D[v])!=null?j:[],...Y])]}})},[r,t]),w=n.useCallback((o,s,d=r)=>{switch(o){case!0:i(v=>({...v,[d]:[...s]}));break;case!1:i(v=>({...v,[d]:[]}));break}},[r]),p=n.useCallback((o,s)=>{i(d=>({...d,[o]:[...s]}))},[]),L=n.useCallback(o=>l[o],[l]),f=n.useCallback(()=>{i({})},[]),b=n.useCallback(()=>{f(),i(c)},[f,c]);return{selectedItemIds:C,keySelectedItemIds:y,handleSelection:m,handleSelectAll:w,areAllItemsSelected:S,areNoItemsSelected:T,areAllItemsForKeySelected:x,areNoItemsForKeySelected:M,setSelectionForKey:p,getSelectionForKey:L,clearSelection:f,reset:b}},Xe=0;class A{static getIds(t){return t.map(a=>a.id)}static getUserCreated(t){return t.filter(a=>a.id!==Xe)}static getDefaults(t){return t.filter(a=>a.default)}}const Je=e=>{const{data:t}=P.useGetManga(xe,e!=null?e:-1,{skip:e===void 0});return n.useMemo(()=>e===void 0||!t?[]:A.getIds(t.manga.categories.nodes),[t==null?void 0:t.manga.categories.nodes,e])},Qe=(e,t,a,r)=>{if(t.includes(e))return!0;if(!r&&a.includes(e))return!1};function Ze(e){const{t}=te(),{onDismiss:a,onSubmit:r,isVisible:c,onExitComplete:l,mangaId:i,mangaIds:g,addToLibrary:C=!1}=e,S=i!==void 0,T=g!=null?g:[i],[y,x]=n.useState(!1),M=Je(i),{data:m}=P.useGetCategories(ae),w=m==null?void 0:m.categories.nodes,p=n.useMemo(()=>A.getUserCreated(w!=null?w:[]),[w]),L=n.useMemo(()=>C?A.getIds(A.getDefaults(p)):[],[p]),{handleSelection:f,setSelectionForKey:b,getSelectionForKey:E}=Ke(p.length,{currentKey:"categoriesToAdd",initialState:{categoriesToAdd:[...M,...L],categoriesToRemove:[]}});n.useEffect(()=>{b("categoriesToAdd",[...M,...L]),b("categoriesToRemove",[])},[M]);const o=E("categoriesToAdd"),s=E("categoriesToRemove"),d=()=>{b("categoriesToAdd",M),b("categoriesToRemove",[]),a()},v=()=>{const h=S?o.filter(I=>!M.includes(I)):o,k=S?M.filter(I=>!o.includes(I)):s;r({addToCategories:h,removeFromCategories:k}),y&&Me("showAddToLibraryCategorySelectDialog",!1).catch(I=>F(t("search.error.label.failed_to_save_settings"),"error",R(I))),(h.length||k.length)&&(C||U.performAction("change_categories",T,{changeCategoriesPatch:{addToCategories:h,removeFromCategories:k}}).catch(_()))};return u.jsxs(be,{sx:{".MuiDialog-paper":{maxHeight:435,width:"80%"}},maxWidth:"xs",open:c,onTransitionExited:l,onClose:d,children:[u.jsx(pe,{children:t("category.title.set_categories")}),u.jsx(ve,{dividers:!0,children:u.jsxs(Ee,{children:[p.length===0&&u.jsx("span",{children:t("category.error.no_categories_found.label.info")}),p.map(h=>u.jsx(ke,{checked:Qe(h.id,o,s,S),onChange:k=>{f(h.id,!1,{key:"categoriesToAdd"}),f(h.id,!1,{key:"categoriesToRemove"}),k&&f(h.id,!0,{key:"categoriesToAdd"}),k===!1&&f(h.id,!0,{key:"categoriesToRemove"})},label:h.name},h.id))]})}),u.jsx(Ce,{children:u.jsxs(q,{sx:{width:"100%"},children:[C&&u.jsx(Ie,{sx:{margin:0},size:"small",label:t("global.button.dont_show_dialog_again"),onChange:h=>x(h.target.checked)}),u.jsxs(q,{direction:"row",sx:{justifyContent:"space-between",alignItems:"end",width:"100%"},children:[u.jsx(B,{component:ye,to:oe.settings.childRoutes.categories.path,onClick:a,children:t(p.length?"global.button.edit":"global.button.create")}),u.jsxs(q,{direction:"row",children:[u.jsx(B,{autoFocus:!0,onClick:d,color:"primary",children:t("global.button.cancel")}),!!p.length&&u.jsx(B,{onClick:v,color:"primary",children:t("global.button.ok")})]})]})]})})]})}var ee;const Tt=(e,t=!1)=>{var C,S;const{t:a}=te(),[r,c]=n.useState(!!e.inLibrary);n.useEffect(()=>{c(!!e.inLibrary)},[e.id]);const l=n.useCallback((T=[],y=[])=>{P.updateManga(e.id,{updateManga:{inLibrary:!0},updateMangaCategories:{addToCategories:T,removeFromCategories:y}}).response.then(()=>F(a("library.info.label.added_to_library"),"success")).then(()=>c(!0)).catch(x=>{F(a("library.error.label.add_to_library"),"error",R(x))})},[e.id]),i=n.useCallback(async()=>{t&&await $.show({title:a("global.label.are_you_sure"),message:a("manga.action.library.remove.dialog.label.message",{title:e.title}),actions:{confirm:{title:a("global.button.remove")}}},{id:"manga-library-state-remove-".concat(e.id)}),await U.removeFromLibrary([e.id],!0),c(!1)},[e.id,t]);return{updateLibraryState:n.useCallback(()=>{const T=async()=>{if(r){i().catch(_());return}let y;try{y=(await Te()).showAddToLibraryCategorySelectDialog}catch(b){F(a("global.error.label.failed_to_load_data"),"error",R(b));return}let x;try{x=await P.getCategories(ae).response}catch(b){F(a("category.error.label.request_failure"),"error",R(b));return}const M=A.getUserCreated(x.data.categories.nodes);let m;try{m=await U.getDuplicateLibraryMangas(e.title).response}catch(b){await $.show({title:a("global.error.label.failed_to_load_data"),message:a("manga.action.library.add.dialog.duplicate.label.failure",{error:R(b)}),actions:{extra:{show:!0,title:a("global.button.retry"),contain:!0},confirm:{title:a("global.button.add")}},onExtra:()=>T().catch(_())},{id:"manga-library-state-add-".concat(e.id)})}if((m==null?void 0:m.data.mangas.totalCount)&&await $.show({title:a("global.label.are_you_sure"),message:a("manga.action.library.add.dialog.duplicate.label.info"),actions:{extra:{show:!0,title:a("migrate.dialog.action.button.show_entry"),contain:!0,link:oe.manga.path(m.data.mangas.nodes[0].id)},confirm:{title:a("global.button.add")}},onExtra:()=>{}},{id:"manga-library-state-add-duplicated-".concat(e.id)}),!(y&&!!M.length)){l(A.getIds(A.getDefaults(M)));return}const{addToCategories:L,removeFromCategories:f}=await we.show(Ze,{mangaId:e.id,addToLibrary:!0},{id:"manga-library-state-add-categories-".concat(e.id)});l(L,f)};T().catch(_())},[r,i,l]),isInLibrary:(S=(C=U.getFromCache(e.id,Se(ee||(ee=Q(["\n                    fragment MangaInLibraryState on MangaType {\n                        inLibrary\n                    }\n                "]))),"MangaInLibraryState"))==null?void 0:C.inLibrary)!=null?S:r}};export{bt as C,ut as D,dt as F,vt as M,lt as R,ct as V,Mt as a,St as b,Tt as c,Ze as d,ht as e,yt as f,gt as g,it as h,xt as i,ft as j,mt as k,pt as l,Ct as m,Ye as n,Ke as u};
