import{u as N,c as u,f,n as S,j as t,v as j,aK as I,az as U,bI as c,bJ as g,bK as x,N as k,q as F,l as P,E as y,m as A,y as R}from"./index-87a7KjSO.js";import{N as W}from"./NumberSetting-BlBLgW6q.js";import{u as M,g as B}from"./usePersistedValue-BCOd2Pgt.js";import{S as _}from"./Switch-jbyts0bH.js";import{T as K}from"./TextSetting-C-lx0v2F.js";import{S as m}from"./SelectSetting-CKSp5oJR.js";import"./Info-CQBc4xDk.js";import"./TextField-CkSZVjz-.js";import"./InputAdornment-CHtj6jqj.js";import"./PasswordTextField-CTOTXZN2.js";const L=23,D=1,H=23,q=({disabled:e=!1,updateCheckInterval:r})=>{const{t:l}=N(),b=!!r,[p]=u.useUpdateServerSettings(),[i,h]=M("lastUpdateCheckInterval",L,r,B),d=f.useCallback(s=>{h(s===0?i:s),p({variables:{input:{settings:{webUIUpdateCheckInterval:s}}}}).catch(()=>S(l("global.error.label.failed_to_save_changes"),"error"))},[i]),v=s=>{d(s?i:0)};return t.jsxs(j,{children:[t.jsxs(I,{children:[t.jsx(U,{primary:l("settings.webui.auto_update.label.title")}),t.jsx(_,{disabled:e,edge:"end",checked:b,onChange:s=>v(s.target.checked)})]}),t.jsx(W,{settingTitle:l("settings.webui.auto_update.label.interval"),settingValue:l("library.settings.global_update.auto_update.interval.label.value",{hours:i}),value:i,minValue:D,maxValue:H,defaultValue:L,showSlider:!0,valueUnit:l("global.time.hour_short"),handleUpdate:d,disabled:e||!b})]})},Y=Object.values(c),z={[c.Webui]:{text:"settings.webui.title.webui",description:"settings.webui.flavor.option.webui.label.description",disclaimer:"settings.webui.flavor.label.info"},[c.Vui]:{text:"settings.webui.flavor.option.vui.label.title",description:"settings.webui.flavor.option.vui.label.description",disclaimer:"settings.webui.flavor.label.info"},[c.Custom]:{text:"settings.webui.flavor.option.custom.label.title",description:"settings.webui.flavor.option.custom.label.description"}},G=Y.map(e=>[e,z[e]]),J=Object.values(g),Q={[g.Bundled]:{text:"settings.webui.channel.option.bundled.label.title",description:"settings.webui.channel.option.bundled.label.description",disclaimer:"settings.webui.flavor.label.info"},[g.Stable]:{text:"settings.webui.channel.option.stable.label.title",description:"settings.webui.channel.option.stable.label.description",disclaimer:"settings.webui.flavor.label.info"},[g.Preview]:{text:"settings.webui.channel.option.preview.label.title",description:"settings.webui.channel.option.preview.label.description",disclaimer:"settings.webui.channel.option.preview.label.disclaimer"}},X=J.map(e=>[e,Q[e]]),Z=Object.values(x),$={[x.Browser]:{text:"settings.webui.interface.option.label.browser",description:"settings.webui.interface.label.description"},[x.Electron]:{text:"settings.webui.interface.option.label.electron",description:"settings.webui.interface.label.description"}},ee=Z.map(e=>[e,$[e]]),te=e=>({webUIFlavor:e.webUIFlavor,initialOpenInBrowserEnabled:e.initialOpenInBrowserEnabled,webUIInterface:e.webUIInterface,electronPath:e.electronPath,webUIChannel:e.webUIChannel,webUIUpdateCheckInterval:e.webUIUpdateCheckInterval}),ge=()=>{const{t:e}=N(),{setTitle:r,setAction:l}=f.useContext(k);f.useLayoutEffect(()=>(r(e("settings.webui.title.settings")),l(null),()=>{r(""),l(null)}),[e]);const{settings:{webUIInformAvailableUpdate:b},loading:p,request:{error:i,refetch:h}}=F(),d=R(()=>S(e("global.error.label.failed_to_save_changes"),"error")),{data:v,loading:s,error:w,refetch:T}=u.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[O]=u.useUpdateServerSettings(),o=(a,V)=>{a==="webUIChannel"&&u.graphQLClient.client.cache.evict({fieldName:"checkForWebUIUpdate"}),O({variables:{input:{settings:{[a]:V}}}}).catch(()=>S(e("global.error.label.failed_to_save_changes"),"error"))};if(p||s)return t.jsx(P,{});const E=i!=null?i:w;if(E)return t.jsx(y,{message:e("global.error.label.failed_to_load_data"),messageExtra:E.message,retry:()=>{i&&h().catch(A()),w&&T().catch(A())}});const n=te(v.settings),C=n.webUIFlavor===c.Custom;return t.jsxs(j,{sx:{pt:0},children:[t.jsx(m,{settingName:e("settings.webui.flavor.label.title"),value:n.webUIFlavor,values:G,handleChange:a=>o("webUIFlavor",a)}),t.jsxs(I,{children:[t.jsx(U,{primary:e("settings.webui.label.initial_open_browser")}),t.jsx(_,{edge:"end",checked:n.initialOpenInBrowserEnabled,onChange:a=>o("initialOpenInBrowserEnabled",a.target.checked)})]}),t.jsx(m,{settingName:e("settings.webui.interface.label.title"),value:n.webUIInterface,values:ee,handleChange:a=>o("webUIInterface",a)}),t.jsx(K,{settingName:e("settings.webui.electron_path.label.title"),dialogDescription:e("settings.webui.electron_path.label.description"),value:n.electronPath,settingDescription:n.electronPath.length?n.electronPath:e("global.label.default"),handleChange:a=>o("electronPath",a)}),t.jsx(m,{settingName:e("settings.webui.channel.label.title"),value:n.webUIChannel,values:X,handleChange:a=>o("webUIChannel",a),disabled:C}),t.jsx(q,{disabled:C,updateCheckInterval:n.webUIUpdateCheckInterval}),!n.webUIUpdateCheckInterval&&t.jsxs(I,{children:[t.jsx(U,{primary:e("global.update.settings.inform.label.title"),secondary:e("global.update.settings.inform.label.description")}),t.jsx(_,{edge:"end",checked:b,onChange:a=>d("webUIInformAvailableUpdate",a.target.checked)})]})]})};export{ge as WebUISettings};
