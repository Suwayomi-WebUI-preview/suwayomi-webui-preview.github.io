import{bE as Ge,bF as Pe,b as m,bG as _e,j as t,aO as Ee,bH as Oe,bI as Ae,aP as Le,aM as Be,bJ as Ne,a0 as Q,bB as $e,ag as Fe,au as We,av as xe,p as ze,bK as ie,bL as Ue,bM as He,aa as V,w as F,a8 as Ve,u as K,_ as R,L as Z,A as J,i as we,f as Me,bN as Ke,d as Ye,aw as Xe,a as re,k as qe,n as Je,v as Qe,q as Ze,S as U,B as N,m as et,a5 as tt,C as $,I as nt,ai as ot,aj as rt,W as A,bO as ae,a1 as st,T as ve,a7 as it,a9 as at,x as ct,H as be,e as ke,ar as lt}from"./index-uuLFyWjH.js";import{E as dt}from"./EmptyViewAbsoluteCentered-DhyXdnvR.js";import{b as ut,c as ft,d as O,C as pt,e as mt,f as ht,D as gt,R as xt,F as bt,g as ye,a as yt,V as Ct,M as jt}from"./useManageMangaLibraryState-BsZvXNpP.js";import{D as wt}from"./Delete-CT9ozx7M.js";import{D as Mt}from"./Download-BoRIdzjV.js";import{C as vt,S as kt,L as It,T as Rt}from"./ChaptersDownloadActionMenuItems-CjNYfUkw.js";import{S as St}from"./Sync-CQTulibV.js";import{u as ce}from"./use-merged-ref-C0Hj7ark.js";import{C as ne}from"./CheckboxInput-CNhfe4XO.js";import{F as Dt}from"./FormGroup-BVSRhZNm.js";import{M as q}from"./MUI.util-CYBuX_Wz.js";import{C as Tt}from"./Checkbox-rBalqFKJ.js";import{L as Gt}from"./Link-C2kDprXF.js";import{C as Ie}from"./Card-BMGU0hB5.js";import{C as Re}from"./CardActionArea-BVD5k2pE.js";import{L as Pt}from"./ListCardAvatar-u06x7-od.js";import{L as _t}from"./ListCardContent-DmDL0s6p.js";import{P as Et}from"./PlayArrow-Dp0rL8Ks.js";import{D as Ot}from"./StyledFab-DLsISrb6.js";import{Y as At}from"./index-CPmTO8DF.js";import{V as Lt}from"./Virtuoso.util-BLADxBo0.js";const Bt=(e,n)=>e.filter(o=>n.includes(o)),Y=(e,n,o)=>{const i=e.keys[0];Array.isArray(n)?n.forEach((s,r)=>{o((a,u)=>{r<=e.keys.length-1&&(r===0?Object.assign(a,u):a[e.up(e.keys[r])]=u)},s)}):n&&typeof n=="object"?(Object.keys(n).length>e.keys.length?e.keys:Bt(e.keys,Object.keys(n))).forEach(r=>{if(e.keys.includes(r)){const a=n[r];a!==void 0&&o((u,f)=>{i===r?Object.assign(u,f):u[e.up(r)]=f},a)}}):(typeof n=="number"||typeof n=="string")&&o((s,r)=>{Object.assign(s,r)},n)};function oe(e){return"--Grid-".concat(e,"Spacing")}function se(e){return"--Grid-parent-".concat(e,"Spacing")}const Ce="--Grid-columns",H="--Grid-parent-columns",Nt=({theme:e,ownerState:n})=>{const o={};return Y(e.breakpoints,n.size,(i,s)=>{let r={};s==="grow"&&(r={flexBasis:0,flexGrow:1,maxWidth:"100%"}),s==="auto"&&(r={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof s=="number"&&(r={flexGrow:0,flexBasis:"auto",width:"calc(100% * ".concat(s," / var(").concat(H,") - (var(").concat(H,") - ").concat(s,") * (var(").concat(se("column"),") / var(").concat(H,")))")}),i(o,r)}),o},$t=({theme:e,ownerState:n})=>{const o={};return Y(e.breakpoints,n.offset,(i,s)=>{let r={};s==="auto"&&(r={marginLeft:"auto"}),typeof s=="number"&&(r={marginLeft:s===0?"0px":"calc(100% * ".concat(s," / var(").concat(H,") + var(").concat(se("column"),") * ").concat(s," / var(").concat(H,"))")}),i(o,r)}),o},Ft=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={[Ce]:12};return Y(e.breakpoints,n.columns,(i,s)=>{const r=s!=null?s:12;i(o,{[Ce]:r,"> *":{[H]:r}})}),o},Wt=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return Y(e.breakpoints,n.rowSpacing,(i,s)=>{var a;const r=typeof s=="string"?s:(a=e.spacing)==null?void 0:a.call(e,s);i(o,{[oe("row")]:r,"> *":{[se("row")]:r}})}),o},zt=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return Y(e.breakpoints,n.columnSpacing,(i,s)=>{var a;const r=typeof s=="string"?s:(a=e.spacing)==null?void 0:a.call(e,s);i(o,{[oe("column")]:r,"> *":{[se("column")]:r}})}),o},Ut=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return Y(e.breakpoints,n.direction,(i,s)=>{i(o,{flexDirection:s})}),o},Ht=({ownerState:e})=>({minWidth:0,boxSizing:"border-box",...e.container&&{display:"flex",flexWrap:"wrap",...e.wrap&&e.wrap!=="wrap"&&{flexWrap:e.wrap},gap:"var(".concat(oe("row"),") var(").concat(oe("column"),")")}}),Vt=e=>{const n=[];return Object.entries(e).forEach(([o,i])=>{i!==!1&&i!==void 0&&n.push("grid-".concat(o,"-").concat(String(i)))}),n},Kt=(e,n="xs")=>{function o(i){return i===void 0?!1:typeof i=="string"&&!Number.isNaN(Number(i))||typeof i=="number"&&i>0}if(o(e))return["spacing-".concat(n,"-").concat(String(e))];if(typeof e=="object"&&!Array.isArray(e)){const i=[];return Object.entries(e).forEach(([s,r])=>{o(r)&&i.push("spacing-".concat(s,"-").concat(String(r)))}),i}return[]},Yt=e=>e===void 0?[]:typeof e=="object"?Object.entries(e).map(([n,o])=>"direction-".concat(n,"-").concat(o)):["direction-xs-".concat(String(e))];function Xt(e,n){e.item!==void 0&&delete e.item,e.zeroMinWidth!==void 0&&delete e.zeroMinWidth,n.keys.forEach(o=>{e[o]!==void 0&&delete e[o]})}const qt=Ne(),Jt=Ge("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,n)=>n.root});function Qt(e){return Ae({props:e,name:"MuiGrid",defaultTheme:qt})}function Zt(e={}){const{createStyledComponent:n=Jt,useThemeProps:o=Qt,useTheme:i=Pe,componentName:s="MuiGrid"}=e,r=(l,c)=>{const{container:h,direction:d,spacing:x,wrap:g,size:p}=l,M={root:["root",h&&"container",g!=="wrap"&&"wrap-xs-".concat(String(g)),...Yt(d),...Vt(p),...h?Kt(x,c.breakpoints.keys[0]):[]]};return Le(M,b=>Be(s,b),{})};function a(l,c,h=()=>!0){const d={};return l===null||(Array.isArray(l)?l.forEach((x,g)=>{x!==null&&h(x)&&c.keys[g]&&(d[c.keys[g]]=x)}):typeof l=="object"?Object.keys(l).forEach(x=>{const g=l[x];g!=null&&h(g)&&(d[x]=g)}):d[c.keys[0]]=l),d}const u=n(Ft,zt,Wt,Nt,Ut,Ht,$t),f=m.forwardRef(function(c,h){var z,de,ue,fe,pe,me;const d=i(),x=o(c),g=_e(x);Xt(g,d.breakpoints);const{className:p,children:M,columns:b=12,container:v=!1,component:G="div",direction:k="row",wrap:C="wrap",size:j={},offset:w={},spacing:D=0,rowSpacing:P=D,columnSpacing:T=D,unstable_level:I=0,...S}=g,_=a(j,d.breakpoints,E=>E!==!1),X=a(w,d.breakpoints),ee=(z=c.columns)!=null?z:I?void 0:b,y=(de=c.spacing)!=null?de:I?void 0:D,W=(fe=(ue=c.rowSpacing)!=null?ue:c.spacing)!=null?fe:I?void 0:P,L=(me=(pe=c.columnSpacing)!=null?pe:c.spacing)!=null?me:I?void 0:T,B={...g,level:I,columns:ee,container:v,direction:k,wrap:C,spacing:y,rowSpacing:W,columnSpacing:L,size:_,offset:X},te=r(B,d);return t.jsx(u,{ref:h,as:G,ownerState:B,className:Ee(te.root,p),...S,children:m.Children.map(M,E=>{var he,ge;return m.isValidElement(E)&&Oe(E,["Grid"])&&v&&E.props.container?m.cloneElement(E,{unstable_level:(ge=(he=E.props)==null?void 0:he.unstable_level)!=null?ge:I+1}):E})})});return f.muiName="Grid",f}const le=Zt({createStyledComponent:Q("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:o}=e;return[n.root,o.container&&n.container]}}),componentName:"MuiGrid",useThemeProps:e=>$e({props:e,name:"MuiGrid"}),useTheme:Fe}),en=m.forwardRef(({MenuItemProps:e,className:n,label:o,LeftIcon:i,renderLabel:s,RightIcon:r,...a},u)=>t.jsxs(We,{...e,ref:u,className:n,...a,children:[i&&t.jsx(xe,{children:t.jsx(i,{fontSize:"small"})}),t.jsx(ze,{children:o}),r&&t.jsx(xe,{style:{minWidth:0},children:t.jsx(r,{fontSize:"small"})})]})),Se=m.forwardRef((e,n)=>{const{parentMenuOpen:o,label:i,renderLabel:s,RightIcon:r=ie(He,Ue),LeftIcon:a,children:u,className:f,tabIndex:l,ContainerProps:c={},MenuProps:h,...d}=e,x=V.useIsTouchDevice(),{ref:g,...p}=c,M=m.useRef(null),b=ce(n,M),v=m.useRef(null),G=ce(g,v),k=m.useRef(null),[C,j]=m.useState(!1),w=y=>{if(C!==y){if(e.disabled){j(!1);return}j(y)}},D=y=>{x||(w(!0),p.onMouseEnter&&p.onMouseEnter(y))},P=y=>{w(!1),p.onMouseLeave&&p.onMouseLeave(y)},T=()=>{var W,L;const y=(L=(W=v.current)==null?void 0:W.ownerDocument.activeElement)!=null?L:null;if(k.current==null)return!1;for(const B of k.current.children)if(B===y)return!0;return!1},I=y=>{x||(y.target===v.current&&w(!0),p.onFocus&&p.onFocus(y))},S=y=>{w(!C),p.onClick&&p.onClick(y)},_=y=>{var L,B,te;if(y.key==="Escape")return;T()&&y.stopPropagation();const W=(L=v.current)==null?void 0:L.ownerDocument.activeElement;if(y.key==="ArrowLeft"&&T()&&((B=v.current)==null||B.focus()),y.key==="ArrowRight"&&y.target===v.current&&y.target===W){const z=(te=k.current)==null?void 0:te.children[0];z==null||z.focus()}},X=C&&o;let ee;return e.disabled||(ee=l!==void 0?l:-1),t.jsxs(F,{...p,ref:G,onFocus:I,onClick:S,tabIndex:ee,onMouseEnter:D,onMouseLeave:P,onKeyDown:_,children:[t.jsx(en,{MenuItemProps:d,className:f,ref:b,LeftIcon:a,RightIcon:r,label:i,renderLabel:s}),t.jsx(Ve,{style:{pointerEvents:"none"},anchorEl:M.current,anchorOrigin:{horizontal:ie("right","left"),vertical:"top"},transformOrigin:{horizontal:ie("left","right"),vertical:"top"},open:X,autoFocus:!1,disableAutoFocus:!0,disableEnforceFocus:!0,onClose:()=>{w(!1)},...h,children:t.jsx(F,{ref:k,style:{pointerEvents:"auto"},children:u})})]})});Se.displayName="NestedMenuItem";const tn=["remove_from_library"],nn=({manga:e,handleSelection:n,selectedMangas:o,onClose:i,setHideMenu:s})=>{var P,T;const{t:r}=K(),[a,u]=m.useState(!1),f=!!e,l=o!=null?o:[],c=mt(f,Ke),h=ft(f),d=ht(f),x=!!e&&e.downloadCount===e.chapters.totalCount,g=!!(e!=null&&e.downloadCount),p=!!(e!=null&&e.unreadCount),M=!!e&&e.unreadCount!==e.chapters.totalCount,{openCategorySelect:b,CategorySelectComponent:v}=ut({mangaId:e==null?void 0:e.id,mangaIds:o?R.getIds(l):void 0,onClose:()=>i(!0),addToLibrary:!1}),G=()=>{n==null||n(e.id,!0),i(!0)},k=(I,S)=>{R.performAction(I,e?[e.id]:R.getIds(S),{wasManuallyMarkedAsRead:!0}).catch(Me()),i(!tn.includes(I))},{downloadableMangas:C,downloadedMangas:j,unreadMangas:w,readMangas:D}=m.useMemo(()=>({downloadableMangas:[...R.getNotDownloaded(l),...R.getPartiallyDownloaded(l)],downloadedMangas:[...R.getPartiallyDownloaded(l),...R.getFullyDownloaded(l)],unreadMangas:[...R.getUnread(l),...R.getPartiallyRead(l)],readMangas:[...R.getPartiallyRead(l),...R.getFullyRead(l)]}),[l]);return t.jsxs(t.Fragment,{children:[!!n&&f&&t.jsx(O,{onClick:G,Icon:pt,title:r("chapter.action.label.select")}),h(!x)&&t.jsx(Se,{disabled:d(!C.length),LeftIcon:Mt,label:c("download",C.length),parentMenuOpen:!0,children:t.jsx(vt,{mangaIds:f?[e.id]:R.getIds(l),closeMenu:()=>i(!0)})}),h(g)&&t.jsx(O,{Icon:wt,disabled:d(!j.length),onClick:()=>k("delete",j),title:c("delete",j.length)}),h(p)&&t.jsx(O,{Icon:gt,disabled:d(!w.length),onClick:()=>k("mark_as_read",w),title:c("mark_as_read",w.length)}),h(M)&&t.jsx(O,{Icon:xt,disabled:d(!D.length),onClick:()=>k("mark_as_unread",D),title:c("mark_as_unread",D.length)}),f&&t.jsx(Z,{to:J.migrate.childRoutes.search.path((P=e==null?void 0:e.sourceId)!=null?P:-1,(T=e==null?void 0:e.id)!=null?T:-1,e==null?void 0:e.title),state:{mangaTitle:e==null?void 0:e.title},style:{textDecoration:"none",color:"inherit"},children:t.jsx(O,{Icon:kt,title:c("migrate",l.length)})}),f&&t.jsx(O,{onClick:()=>{u(!0),s(!0)},Icon:St,title:c("track",l.length)}),t.jsx(O,{onClick:()=>{b(!0),s(!0)},Icon:It,title:c("change_categories",l.length)}),t.jsx(O,{onClick:()=>k("remove_from_library",l),Icon:bt,title:c("remove_from_library",l.length)}),v,a&&t.jsx(we,{open:!0,maxWidth:"md",fullWidth:!0,scroll:"paper",onClose:()=>{u(!1),i(!0)},children:t.jsx(Rt,{manga:e})})]})},on=({mangaIdToMigrateTo:e,onClose:n})=>{const{t:o}=K(),i=Ye(),{mangaId:s}=Xe(),r=Number(s),{settings:{migrateChapters:a,migrateCategories:u,migrateTracking:f,deleteChapters:l}}=re(),[c,h]=m.useState(!1),d=Qe(Me()),x=async g=>{if(r==null)throw new Error('MigrateDialog::migrate: unexpected mangaId "'.concat(r,'"'));et(o("migrate.label.info"),"info"),h(!0);try{await R.migrate(r,e,{mode:g,migrateChapters:a,migrateCategories:u,migrateTracking:f,deleteChapters:l}),i(J.manga.path(e),{replace:!0})}catch(p){h(!1)}};return t.jsxs(we,{open:!0,fullWidth:!0,onClose:n,children:[t.jsx(qe,{children:o("migrate.dialog.title")}),t.jsx(Je,{dividers:!0,children:t.jsxs(Dt,{children:[t.jsx(ne,{disabled:c,label:o("chapter.title_one"),checked:a,onChange:(g,p)=>d("migrateChapters",p)}),t.jsx(ne,{disabled:c,label:o("category.title.category_one"),checked:u,onChange:(g,p)=>d("migrateCategories",p)}),t.jsx(ne,{disabled:c,label:o("tracking.title"),checked:f,onChange:(g,p)=>d("migrateTracking",p)}),t.jsx(ne,{disabled:c,label:o("migrate.dialog.label.delete_downloaded"),checked:l,onChange:(g,p)=>d("deleteChapters",p)})]})}),t.jsx(Ze,{children:t.jsxs(U,{direction:"row",sx:{justifyContent:"space-between",width:"100%"},children:[t.jsx(N,{disabled:c,component:Z,to:J.manga.path(e),children:o("migrate.dialog.action.button.show_entry")}),t.jsxs(U,{direction:"row",children:[t.jsx(N,{disabled:c,onClick:n,children:o("global.button.cancel")}),t.jsx(N,{disabled:c,onClick:()=>x("copy"),children:o("global.button.copy")}),t.jsx(N,{disabled:c,onClick:()=>x("migrate"),children:o("global.button.migrate")})]})]})})]})},De=m.forwardRef(({id:e,selected:n,handleSelection:o,asCheckbox:i=!1,popupState:s},r)=>{const{t:a}=K(),u=m.useMemo(()=>tt(s),[s]),f=h=>{h.stopPropagation(),h.preventDefault()},l=(h,d)=>{f(h),o==null||o(e,d)};return o?n!==null?i?t.jsx($,{title:a(n?"global.button.deselect":"global.button.select"),children:t.jsx(Tt,{...q.preventRippleProp(),checked:n,onChange:l})}):null:i?t.jsx($,{title:a("global.button.options"),children:t.jsx(nt,{ref:r,...q.preventRippleProp(u,{onClick:f}),"aria-label":"more",children:t.jsx(ye,{})})}):t.jsx($,{title:a("global.button.options"),children:t.jsx(N,{ref:r,...q.preventRippleProp(u,{onClick:f}),className:"manga-option-button",size:"small",variant:"contained",sx:{minWidth:"unset",paddingX:"0",paddingY:"2.5px",visibility:s.isOpen?"visible":"hidden",pointerEvents:"none","@media not (pointer: fine)":{visibility:"hidden",width:0,height:0,p:0,m:0}},children:t.jsx(ye,{})})}):null}),rn=Q("div")({position:"absolute",bottom:0,width:"100%",height:"30%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),sn=Q("div")({position:"absolute",bottom:0,width:"100%",height:"20%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),an=m.memo(({manga:e,longPressBind:n,popupState:o,handleClick:i,mangaLinkTo:s,selected:r,inLibraryIndicator:a,isInLibrary:u,gridLayout:f,handleSelection:l,continueReadingButton:c,mangaBadges:h,mode:d})=>{const x=V.usePreventMobileContextMenu(),g=m.useRef(null),{id:p,title:M}=e;return t.jsx(Gt,{component:Z,...n(()=>o.open(g.current)),onClick:i,to:s,state:R.createLocationState(e,d),onContextMenu:x,sx:{...V.preventMobileContextMenuSx(),textDecoration:"none"},children:t.jsxs(F,{sx:{display:"flex",flexDirection:"column",m:.25,outline:r?"4px solid":void 0,borderRadius:r?"1px":void 0,outlineColor:b=>b.palette.primary.main,backgroundColor:b=>r?b.palette.primary.main:void 0,"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:d==="source"?"none":"flex"}}},children:[t.jsx(Ie,{sx:{aspectRatio:ot,display:"flex"},children:t.jsxs(Re,{sx:{position:"relative",height:"100%"},children:[t.jsx(rt,{alt:M,src:R.getThumbnailUrl(e),imgStyle:a&&u?{height:"100%",width:"100%",objectFit:"cover",filter:"brightness(0.4)"}:{height:"100%",width:"100%",objectFit:"cover"},spinnerStyle:{display:"grid",placeItems:"center"}}),t.jsxs(U,{direction:"row",sx:{alignItems:"start",justifyContent:"space-between",position:"absolute",top:b=>b.spacing(1),left:b=>b.spacing(1),right:b=>b.spacing(1)},children:[h,t.jsx(De,{ref:g,popupState:o,id:p,selected:r,handleSelection:l})]}),t.jsxs(t.Fragment,{children:[f!==A.Comfortable&&t.jsxs(t.Fragment,{children:[t.jsx(rn,{}),t.jsx(sn,{})]}),t.jsxs(U,{direction:"row",sx:{justifyContent:f!==A.Comfortable?"space-between":"end",alignItems:"end",position:"absolute",bottom:0,width:"100%",p:1,gap:1},children:[f!==A.Comfortable&&t.jsx($,{title:M,placement:"top",children:t.jsx(ae,{component:"h3",sx:{color:"white",textShadow:"0px 0px 3px #000000"},children:M})}),c]})]})]})}),f===A.Comfortable&&t.jsx(U,{sx:{pb:1},children:t.jsx($,{title:M,placement:"top",children:t.jsx(ae,{component:"h3",sx:{color:b=>r?b.palette.primary.contrastText:"text.primary",height:"3rem",pt:.5},children:M})})})]})})}),cn=m.memo(({manga:e,longPressBind:n,popupState:o,handleClick:i,mangaLinkTo:s,selected:r,inLibraryIndicator:a,isInLibrary:u,handleSelection:f,continueReadingButton:l,mangaBadges:c,mode:h})=>{const d=V.usePreventMobileContextMenu(),x=m.useRef(null),{id:g,title:p}=e;return t.jsx(Ie,{children:t.jsx(Re,{component:Z,to:s,state:R.createLocationState(e,h),onClick:i,...n(()=>o.open(x.current)),onContextMenu:d,sx:{...V.preventMobileContextMenuSx(),"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:h==="source"?"none":"inline-flex"}}},children:t.jsxs(_t,{sx:{justifyContent:"space-between",position:"relative"},children:[t.jsx(Pt,{iconUrl:R.getThumbnailUrl(e),alt:e.title,slots:{spinnerImageProps:{imgStyle:{imageRendering:"pixelated",filter:a&&u?"brightness(0.4)":void 0}}}}),t.jsx(F,{sx:{display:"flex",flexDirection:"row",flexGrow:1,width:"min-content"},children:t.jsx($,{title:p,placement:"top",children:t.jsx(ae,{variant:"h6",component:"h3",children:p})})}),t.jsxs(U,{direction:"row",sx:{alignItems:"center",gap:.5},children:[c,l,t.jsx(De,{ref:x,popupState:o,id:g,selected:r,handleSelection:f,asCheckbox:!0})]})]})})})}),ln=({showContinueReadingButton:e,chapter:n,mangaLinkTo:o})=>{const{t:i}=K();if(!e||!n)return null;const{sourceOrder:s}=n,r=s===1;return t.jsx($,{title:i(r?"global.button.start":"global.button.resume"),children:t.jsx(N,{...q.preventRippleProp(),variant:"contained",size:"small",sx:{minWidth:"unset",py:.5,px:.75},component:Z,to:"".concat(o,"/chapter/").concat(n.sourceOrder),state:st.getReaderOpenChapterLocationState(n),onClick:a=>a.stopPropagation(),children:t.jsx(Et,{})})})},dn=Q("div")(({theme:e})=>({display:"flex",height:"fit-content",borderRadius:e.shape.borderRadius,overflow:"hidden"})),je=Q(ve)(({theme:e})=>({color:e.palette.primary.contrastText,paddingInline:e.spacing(.3)})),un=({inLibraryIndicator:e,updateLibraryState:n,isInLibrary:o,unread:i,downloadCount:s,mode:r})=>{const{t:a}=K(),u=V.useIsTouchDevice(),{settings:{showUnreadBadge:f,showDownloadBadge:l}}=re();return t.jsxs(dn,{children:[!u&&e&&r==="source"&&t.jsx(N,{className:"source-manga-library-state-button",component:"div",variant:"contained",size:"small",...q.preventRippleProp(),onClick:c=>{c.preventDefault(),c.stopPropagation(),n()},sx:{display:"none"},color:o?"error":"primary",children:a(o?"manga.action.library.remove.label.action":"manga.button.add_to_library")}),e&&o&&t.jsx(ve,{className:"source-manga-library-state-indicator",sx:{backgroundColor:"primary.dark",color:"primary.contrastText",p:.3},children:a("manga.button.in_library")}),(f&&r==="default"||r==="duplicate")&&(i!=null?i:0)>0&&t.jsx(je,{sx:{backgroundColor:"primary.main",color:"primary.contrastText"},children:i}),(l&&r==="default"||r==="duplicate")&&(s!=null?s:0)>0&&t.jsx(je,{sx:{backgroundColor:"secondary.main",color:"secondary.contrastText"},children:s})]})},fn=(e,n,o,i)=>{switch(e){case"default":case"source":case"duplicate":return J.manga.path(n);case"migrate.search":return J.migrate.childRoutes.search.path(o!=null?o:"-1",n,i);case"migrate.select":return"";default:throw new Error('getMangaLinkTo: unexpected MangaCardMode "'.concat(e,'"'))}},pn=m.memo(e=>{const{manga:n,gridLayout:o,inLibraryIndicator:i,selected:s,handleSelection:r,mode:a="default"}=e,{id:u,firstUnreadChapter:f,downloadCount:l,unreadCount:c}=n,{settings:{showContinueReadingButton:h}}=re(),{CategorySelectComponent:d,updateLibraryState:x,isInLibrary:g}=yt(n,a==="source"),p=fn(a,n.id,n.sourceId,n.title),[M,b]=m.useState(!1),v=m.useCallback((C,j)=>{const w=a==="default",D=a==="source",P=a==="migrate.select",T=s!==null;if(P||T||(w||D)&&j){if(C.preventDefault(),D){x();return}if(T){r==null||r(u,!s,{selectRange:C.shiftKey});return}if(w){j==null||j();return}P&&b(!0)}},[a,s,x,r]),G=Ct(m.useCallback((C,{context:j})=>{C.shiftKey=!0,v(C,j)},[v])),k=m.useMemo(()=>o===A.List?cn:an,[o]);return t.jsxs(t.Fragment,{children:[M&&t.jsx(on,{mangaIdToMigrateTo:n.id,onClose:()=>b(!1)}),t.jsx(it,{variant:"popover",popupId:"manga-card-action-menu",children:C=>t.jsxs(t.Fragment,{children:[t.jsx(k,{...e,longPressBind:G,popupState:C,handleClick:v,mangaLinkTo:p,isInLibrary:g,inLibraryIndicator:i,continueReadingButton:t.jsx(ln,{showContinueReadingButton:h&&a==="default",chapter:f,mangaLinkTo:p}),mangaBadges:t.jsx(un,{inLibraryIndicator:i,isInLibrary:g,unread:c,downloadCount:l,updateLibraryState:x,mode:a})}),!!r&&C.isOpen&&t.jsx(jt,{...at(C),children:(j,w)=>t.jsx(nn,{manga:n,handleSelection:r,onClose:j,setHideMenu:w})}),d]})})]})}),mn=({ref:e,persistKey:n,...o})=>{const{state:i,persistState:s}=Lt.usePersistState(n),r=m.useRef(void 0),a=ce(r,e);return t.jsx(At,{...o,ref:a,stateChanged:s,restoreStateFrom:i})},hn=lt.forwardRef(({children:e,...n},o)=>t.jsx(le,{...n,ref:o,container:!0,spacing:1,children:e})),gn=(e,n,o,i=12)=>{const s=Math.ceil(e/n),r=o===A.List?i:i/s;return({children:a,...u})=>t.jsx(le,{...u,size:r,children:a})},Te=(e,n,o,i=!1,s,r,a)=>t.jsx(pn,{manga:e,gridLayout:n,inLibraryIndicator:o,selected:i?s==null?void 0:s.includes(e.id):null,handleSelection:r,mode:a}),xn=m.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:i,gridLayout:s,isSelectModeActive:r,selectedMangaIds:a,handleSelection:u,mode:f},l)=>t.jsx(le,{ref:l,container:!0,spacing:1,sx:{width:"100%",overflowX:"auto",display:"-webkit-inline-box",flexWrap:"nowrap"},children:e?t.jsx(ke,{}):n.map(c=>t.jsx(i,{children:Te(c,s,o,r,a,u,f)},c.id))})),bn="MangaGrid-snapshot-location",yn=m.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:i,gridLayout:s,hasNextPage:r,loadMore:a,isSelectModeActive:u,selectedMangaIds:f,handleSelection:l,mode:c},h)=>t.jsxs(t.Fragment,{children:[t.jsx(F,{ref:h,children:t.jsx(mn,{persistKey:bn,useWindowScroll:!0,increaseViewportBy:window.innerHeight*.5,totalCount:n.length,components:{List:hn,Item:i},endReached:()=>a(),computeItemKey:d=>n[d].id,itemContent:d=>Te(n[d],s,o,u,f,l,c)})}),u&&s===A.List?t.jsx(F,{sx:{paddingBottom:Ot}}):e?t.jsx(ke,{}):r?t.jsx("div",{style:{height:"75px"}}):null]})),Fn=({mangas:e,isLoading:n,message:o,messageExtra:i,hasNextPage:s,loadMore:r,gridLayout:a,horizontal:u,noFaces:f,inLibraryIndicator:l,isSelectModeActive:c,selectedMangaIds:h,handleSelection:d,mode:x,retry:g,gridWrapperProps:p})=>{var P,T;const{t:M}=K(),{navBarWidth:b}=ct(),{settings:{mangaGridItemWidth:v}}=re(),G=m.useRef(null),k=m.useRef(null),[C,j]=m.useState((T=(P=k.current)==null?void 0:P.offsetWidth)!=null?T:Math.max(0,document.documentElement.offsetWidth-b)),w=m.useMemo(()=>gn(C,v,a),[C,v,a]);return m.useLayoutEffect(()=>{if(u)return()=>{};let I;const S=_=>{I=setTimeout(()=>{if(document.body.style.overflow.includes("hidden")){S(250);return}document.body.style.overflowY=a===A.List?"auto":"scroll"},_)};return S(0),()=>{clearTimeout(I)}},[a]),m.useLayoutEffect(()=>()=>{u||(document.body.style.overflowY="auto")},[]),be(k,m.useCallback(()=>{j((()=>{var _;const S=(_=k.current)==null?void 0:_.offsetWidth;return S||document.documentElement.offsetWidth-b})())},[b])),be(G,m.useCallback((I,S)=>{const _=I[0].target.clientHeight,X=_>document.documentElement.clientHeight;if(!n&&_){if(X){S.disconnect();return}r(),S.disconnect()}},[G,r,n])),!n&&e.length===0?t.jsx(dt,{noFaces:f,message:o!=null?o:M("manga.error.label.no_mangas_found"),messageExtra:i,retry:g}):t.jsx(F,{...p,ref:k,sx:{...p==null?void 0:p.sx,overflow:"hidden"},children:u?t.jsx(xn,{ref:G,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:w,gridLayout:a,isSelectModeActive:c,selectedMangaIds:h,handleSelection:d,mode:x}):t.jsx(yn,{ref:G,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:w,hasNextPage:s,loadMore:r,gridLayout:a,isSelectModeActive:c,selectedMangaIds:h,handleSelection:d,mode:x})})};export{Fn as M,nn as a,bn as b,pn as c};
