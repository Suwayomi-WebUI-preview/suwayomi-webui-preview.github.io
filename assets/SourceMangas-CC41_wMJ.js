import{p as it,j as t,R as C,T as Lt,r as lt,i as ct,B as $,an as ut,y as pt,S as U,c as h,aD as F,ac as Ft,u as H,b as B,s as z,N as Tt,z as It,e as Et,a7 as ot,A as $t,aE as O,aF as kt,a as E,f as Mt,I as _t,aG as Pt,aH as Ot,aI as wt}from"./index-Zl59rTnr.js";import{d as At,u as Rt,A as Dt,S as Gt}from"./AppbarSearch-CsotfqTa.js";import{d as qt}from"./Favorite-DEb7sT-J.js";import{d as dt}from"./FilterList-Cm7vK8WS.js";import{G as Nt}from"./GridLayouts-DL3UBwkf.js";import{S as Bt,O as Ut}from"./SortRadioInput-CQ7MdAfj.js";import{C as Ht}from"./CheckboxInput-DqA77Hjg.js";import{M as zt}from"./MenuItem-DWrnvo_k.js";import{a as mt,I as gt,c as Kt,d as Vt}from"./TextField-lew-bJf8.js";import{C as ft}from"./Collapse-NT65VyrV.js";import{u as Yt}from"./useDebounce-jELv4YlT.js";import{I as Qt}from"./InputAdornment-C6brfzM8.js";import{T as Wt}from"./ThreeStateCheckboxInput-wO9QFGNa.js";import{S as Jt}from"./StyledFab--ltFOeG8.js";import{M as Xt,g as Zt}from"./MangaGrid-sXgrtb3t.js";import{u as te}from"./metadataServerSettings-Bu9SBxLq.js";import{L as ee}from"./Link-DNDUF647.js";import"./useManageMangaLibraryState-CawoFeDt.js";import"./index-DQrhUqKj.js";import"./CardContent-RtU3w6b_.js";import"./Avatar-922Wk_ln.js";import"./SpinnerImage-DiQGN4Ou.js";import"./index-D03_UwGI.js";import"./Chip-DIc23AWH.js";import"./ListPreference-B4Yqea6O.js";import"./Checkbox-STjbDH5e.js";import"./SwitchBase-B5dQFXOZ.js";import"./NumberSetting-D95Za2Yx.js";import"./Info-CBdRtVcr.js";import"./dayjs.min-ByUHsGI2.js";import"./language-CcP_OM1B.js";import"./useMobilePicker-BrirqG1O.js";import"./SelectSetting-DVozOvvZ.js";import"./Select-BndaAxxl.js";import"./Mangas-D6kqk8_N.js";import"./Chapters-BDtuZBKt.js";import"./ViewModule-BKQF3aZo.js";import"./Delete-BgE5pKr0.js";import"./Sync-B5XFkS26.js";import"./PlayArrow-CEADbSL0.js";import"./metadata-3dsaWhfv.js";function se(){const{options:{SourcegridLayout:e},setOptions:r}=it();function o(n){r(s=>({...s,SourcegridLayout:n}))}return t.jsx(Nt,{gridLayout:e,onChange:o})}const ae=e=>{const{state:r,name:o,position:n,group:s,updateFilterValue:i,update:a}=e,[l,p]=C.useState(r),c=d=>{p(d.target.checked);const m=a.filter(j=>!(n===j.position&&s===j.group));i([...m,{type:"checkBoxState",position:n,state:d.target.checked,group:s}])};return r!==void 0?t.jsx(Ht,{label:o,checked:l,onChange:c}):null},ne=({name:e})=>t.jsx(Lt,{sx:{mt:2},variant:"subtitle2",children:e},e);function re(e,r,o,n,s,i,a){const[l,p]=C.useState(o);if(e){const c=m=>{const j=e.indexOf("".concat(m.target.value));p(j);const g=i.filter(u=>!(n===u.position&&a===u.group));s([...g,{type:"selectState",position:n,state:j,group:a}])},d=e.map(m=>t.jsx(zt,{value:m,children:m},"".concat(r," ").concat(m)));return t.jsxs(mt,{sx:{my:1},variant:"standard",children:[t.jsx(gt,{children:r}),t.jsx(Kt,{name:r,value:e[l],label:r,onChange:c,children:d})]})}return null}const oe=({values:e,name:r,state:o,position:n,updateFilterValue:s,update:i,group:a})=>re(e,r,o,n,s,i,a);var K={},ie=ct;Object.defineProperty(K,"__esModule",{value:!0});var V=K.default=void 0,le=ie(lt()),ce=t;V=K.default=(0,le.default)((0,ce.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var Y={},ue=ct;Object.defineProperty(Y,"__esModule",{value:!0});var Q=Y.default=void 0,pe=ue(lt()),de=t;Q=Y.default=(0,pe.default)((0,de.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");const me=e=>{const{values:r,name:o,state:n,position:s,group:i,updateFilterValue:a,update:l}=e,[p,c]=C.useState(n),[d,m]=C.useState(!1),j=()=>{m(!d)};if(r){const g=u=>{const f=p;f.index===u?f.ascending=!f.ascending:f.ascending=!0,f.index=u,c(f);const b=l.filter(y=>!(s===y.position&&i===y.group));a([...b,{type:"sortState",position:s,state:f,group:i}])};return t.jsxs($,{sx:{mx:-2},children:[t.jsxs(ut,{onClick:j,children:[t.jsx(pt,{primary:o}),d?t.jsx(V,{}):t.jsx(Q,{})]}),t.jsx(ft,{in:d,children:t.jsx(U,{sx:{mx:4},children:r.map((u,f)=>t.jsx(Bt,{label:u,checked:p.index===f,sortDescending:!p.ascending,onClick:()=>g(f)},"".concat(o," ").concat(u)))})})]})}return null},ge=e=>{const{state:r,name:o,position:n,group:s,updateFilterValue:i,update:a}=e,[l,p]=C.useState(r||""),c=Yt(l,500);return h.useEffect(()=>{const d=a.filter(m=>!(n===m.position&&s===m.group));i([...d,{type:"textState",position:n,state:c,group:s}])},[c]),r!==void 0?t.jsxs(mt,{sx:{my:1},variant:"standard",children:[t.jsx(gt,{children:o}),t.jsx(Vt,{name:o,value:l,onChange:({target:{value:d}})=>p(d),endAdornment:t.jsx(Qt,{position:"end",children:t.jsx(At,{})})})]}):null},fe=e=>{switch(e){case F.Ignore:return 0;case F.Include:return 1;case F.Exclude:return 2;default:throw new Error("Unexpected TriState ".concat(e))}},xe=e=>{switch(e){case 0:return F.Ignore;case 1:return F.Include;case 2:return F.Exclude;default:throw new Error("Unexpected state number ".concat(e))}},he=e=>{const{state:r,name:o,position:n,group:s,updateFilterValue:i,update:a}=e,[l,p]=C.useState(fe(r)),c=d=>{const m=d===void 0?0:d?1:2;p(m);const j=a.filter(g=>!(n===g.position&&s===g.group));i([...j,{type:"triState",position:n,state:xe(m),group:s}])};return r!==void 0?t.jsx(Wt,{label:o,checked:[void 0,!0,!1][l],onChange:d=>c(d)}):null},Se=e=>{const{state:r,name:o,position:n,updateFilterValue:s,update:i}=e,[a,l]=C.useState(!1);return t.jsxs($,{sx:{mx:-2},children:[t.jsxs(ut,{onClick:()=>l(!a),children:[t.jsx(pt,{primary:o}),a?t.jsx(V,{}):t.jsx(Q,{})]}),t.jsx(ft,{in:a,children:t.jsx(U,{sx:{mx:4},children:t.jsx(xt,{sourceFilter:r,group:n,updateFilterValue:s,update:i})})})]})},je=({name:e})=>t.jsx(Ft,{sx:{my:1},textAlign:"center",children:e},e);function xt({sourceFilter:e,group:r,updateFilterValue:o,update:n}){return t.jsx(U,{children:e.map((s,i)=>{var l,p;let a=n.find(c=>c.group===r&&c.position===i);switch(a=a&&a.state,s.type){case"CheckBoxFilter":return t.jsx(ae,{name:s.name,state:a!=null?a:s.CheckBoxFilterDefault,position:i,group:r,updateFilterValue:o,update:n},"filters ".concat(s.name));case"GroupFilter":return t.jsx(Se,{name:s.name,state:s.filters,position:i,updateFilterValue:o,update:n},"filters ".concat(s.name));case"HeaderFilter":return t.jsx(ne,{name:s.name},"filters ".concat(s.name));case"SelectFilter":return t.jsx(oe,{name:s.name,values:s.values,state:a!=null?parseInt(a,10):s.SelectFilterDefault,position:i,group:r,updateFilterValue:o,update:n},"filters ".concat(s.name));case"SeparatorFilter":return t.jsx(je,{name:s.name},"filters ".concat(s.name));case"SortFilter":return t.jsx(me,{name:s.name,values:s.values,state:a!=null?a:{ascending:(l=s.SortFilterDefault)==null?void 0:l.ascending,index:(p=s.SortFilterDefault)==null?void 0:p.index},position:i,group:r,updateFilterValue:o,update:n},"filters ".concat(s.name));case"TextFilter":return t.jsx(ge,{name:s.name,state:a!=null?a:s.TextFilterDefault,position:i,group:r,updateFilterValue:o,update:n},"filters ".concat(s.name));case"TriStateFilter":return t.jsx(he,{name:s.name,state:a!=null?a:s.TriStateFilterDefault,position:i,group:r,updateFilterValue:o,update:n},"filters ".concat(s.name));default:throw new Error('Unknown source filter "'.concat(s,'"'))}})},"filters ".concat(r))}function ve({sourceFilter:e,updateFilterValue:r,resetFilterValue:o,setTriggerUpdate:n,update:s}){const{t:i}=H(),[a,l]=h.useState(!1);function p(){o(0),l(!1)}function c(){n(0),l(!1)}return t.jsxs(t.Fragment,{children:[t.jsxs(Jt,{onClick:()=>l(!a),variant:"extended",color:"primary",children:[t.jsx(dt,{}),i("global.button.filter")]}),t.jsxs(Ut,{open:a,onClose:()=>l(!1),children:[t.jsxs($,{sx:{display:"flex",p:2,pb:0},children:[t.jsx(B,{onClick:p,children:i("global.button.reset")}),t.jsx(B,{sx:{marginLeft:"auto"},variant:"contained",onClick:c,children:i("global.button.submit")})]}),t.jsx($,{sx:{pb:2,mx:2},children:t.jsx(xt,{sourceFilter:e,updateFilterValue:r,group:void 0,update:s})})]})]})}function be(e){const{t:r}=H(),{mangas:o,isLoading:n,hasNextPage:s,loadMore:i,message:a,messageExtra:l,gridLayout:p}=e,c=o,d=c.length===0&&o.length>0;return t.jsx(Xt,{mangas:c,isLoading:n,hasNextPage:s,loadMore:i,message:d?r("manga.error.label.no_matches"):a,messageExtra:l,gridLayout:p,inLibraryIndicator:!0,mode:"source"})}const ye=z("div")(({theme:e})=>({display:"flex",position:"fixed",top:"64px",width:"100%",zIndex:1,backgroundColor:e.palette.background.default,[e.breakpoints.down("sm")]:{top:"56px"}})),N=z(B)(()=>({marginTop:"13px",marginBottom:"13px",marginLeft:"13px"})),Ce=z($,{shouldForwardProp:e=>e!=="hasContent"})(({theme:e,hasContent:r})=>({marginTop:"calc(62.5px ".concat(r?"- 8px":"",")"),minHeight:"calc(100vh - 64px - 62.5px)",position:"relative",[e.breakpoints.down("sm")]:{marginTop:"calc(62.5px - 8px ".concat(r?"- 8px":"",")"),minHeight:"calc(100vh - 64px - 64px - 62.5px)"}}));var Le=(e=>(e[e.POPULAR=0]="POPULAR",e[e.LATEST=1]="LATEST",e[e.SEARCH=2]="SEARCH",e))(Le||{});const Fe={0:"manga.error.label.no_mangas_found",1:"manga.error.label.no_mangas_found",2:"manga.error.label.no_matches"},Te=e=>{const r=[];return e.forEach(o=>{r.some(s=>s.id===o.id)||r.push(o)}),r},Ie=(e,r,o,n,s,i)=>{let a;switch(r){case 0:a=E.useGetSourcePopularMangas(e,s);break;case 1:a=E.useGetSourceLatestMangas(e,s);break;case 2:a=E.useSourceSearch(e,o!=null?o:"",n.map(g=>{const{position:u,state:f,group:b}=g;return b!==void 0?{position:b,groupChange:{position:u,[g.type]:f}}:{position:u,[g.type]:f}}),s);break;default:throw new Error('Unknown ContentType "'.concat(r,'"'))}const l=a[1],p=l.findLastIndex(g=>{var u;return!!((u=g.data)!=null&&u.fetchSourceManga)}),c=l[p],d=l.slice(-1)[0].isLoading;let m=!d;const j=h.useMemo(()=>{let g=[];return l.forEach((u,f)=>{var k,I;const b=(I=(k=u.data)==null?void 0:k.fetchSourceManga.mangas)!=null?I:[],y=Te([...g,...b]),T=b.filter(S=>!!y.find(A=>A.id===S.id)).filter(S=>!i||!S.inLibrary);m=!d&&l.length===f+1&&!T.length&&!!b.length,g=[...g,...T]}),g},[l,i]);return p===-1?[a[0],{...a[1][a[1].length-1],filteredOutAllItemsOfFetchedPage:m}]:[a[0],{...l[l.length-1],data:{...c.data,fetchSourceManga:{...c.data.fetchSourceManga,hasNextPage:l.length>p+1?!1:c.data.fetchSourceManga.hasNextPage,mangas:j}},filteredOutAllItemsOfFetchedPage:m}]};function hs(){var st,at,nt,rt;const{t:e}=H(),{setTitle:r,setAction:o}=h.useContext(Tt),{sourceId:n}=It(),s=Et(),i=ot(),{key:a,state:l}=i,{contentType:p=0,clearCache:c=!1}=(st=ot().state)!=null?st:{};$t("browse");const[d,m]=h.useState(!0);h.useEffect(()=>{m(!1)},[]);const{settings:{hideLibraryEntries:j}}=te(),{options:g}=it(),[u]=Rt("query",Gt),[f,b]=O("source-mangas-".concat(n,"-filters"),[]),[y,W]=O("source-mangas-location-".concat(a,"-").concat(n,"-filters"),f!=null?f:[]),[T,w]=h.useState(y),[k,I]=O("source-mangas-".concat(n,"-content-type"),p),[S,A]=O("source-mangas-location-".concat(a,"-").concat(n,"-content-type"),u?2:k);h.useEffect(()=>()=>{b(void 0),I(void 0)},[n]);const M=h.useCallback(()=>{kt.session.setItem(Zt(i),void 0,!1),window.scrollTo(0,0)},[a]),J=v=>{b(v),W(v),M()},X=v=>{I(v),A(v)},[Z,{data:L,isLoading:R,size:D,abortRequest:ht,filteredOutAllItemsOfFetchedPage:G}]=Ie(n,S,u,y,1,j),tt=R||G,et=(at=L==null?void 0:L.fetchSourceManga.mangas)!=null?at:[],_=(nt=L==null?void 0:L.fetchSourceManga.hasNextPage)!=null?nt:!1,{data:q}=E.useGetSource(n),x=q==null?void 0:q.source,St=(rt=x==null?void 0:x.filters)!=null?rt:[],jt=tt?void 0:e(Fe[S]),vt=n==="0"?t.jsxs(t.Fragment,{children:[t.jsxs("span",{children:[e("source.local_source.label.checkout")," "]}),t.jsx(ee,{href:"https://github.com/Suwayomi/Suwayomi-Server/wiki/Local-Source",children:e("source.local_source.label.guide")})]}):void 0,P=h.useCallback((v,Ct)=>{X(v),M(),u&&!Ct&&s({pathname:""},{state:{...l,contentType:v}})},[X,u,M]);!!u&&S!==2&&P(2,u);const bt=h.useCallback(()=>{_&&Z(D+1)},[D,_,S]),yt=h.useCallback(()=>{w([]),J([])},[n,S]);return h.useEffect(()=>{G&&_&&!R&&Z(D+1)},[G,R]),h.useEffect(()=>{!c||!wt.REVALIDATION.includes(n)||E.clearBrowseCacheFor(n)},[c]),h.useEffect(()=>()=>{S!==2||d||(ht(new Error("SourceMangas(".concat(n,"): search string changed"))),M())},[u]),h.useEffect(()=>{var v;return r((v=x==null?void 0:x.displayName)!=null?v:e("source.title")),o(t.jsxs(t.Fragment,{children:[t.jsx(Dt,{}),t.jsx(se,{}),(x==null?void 0:x.isConfigurable)&&t.jsx(Mt,{title:e("settings.title"),children:t.jsx(_t,{onClick:()=>s("/sources/".concat(n,"/configure/")),"aria-label":"display more actions",edge:"end",color:"inherit",size:"large",children:t.jsx(Pt,{})})})]})),()=>{r(""),o(null)}},[e,x]),t.jsxs(Ce,{hasContent:!!et.length,children:[t.jsxs(ye,{children:[t.jsx(N,{variant:S===0?"contained":"outlined",startIcon:t.jsx(qt,{}),onClick:()=>P(0),children:e("global.button.popular")}),(x==null?void 0:x.supportsLatest)===void 0||x.supportsLatest?t.jsx(N,{disabled:!(x!=null&&x.supportsLatest),variant:S===1?"contained":"outlined",startIcon:t.jsx(Ot,{}),onClick:()=>P(1),children:e("global.button.latest")}):null,t.jsx(N,{variant:S===2?"contained":"outlined",startIcon:t.jsx(dt,{}),onClick:()=>P(2,u),children:e("global.button.filter")})]}),t.jsx(be,{mangas:et,hasNextPage:_,loadMore:bt,message:jt,messageExtra:vt,isLoading:tt,gridLayout:g.SourcegridLayout},S),S===2&&t.jsx(ve,{sourceFilter:St,updateFilterValue:w,setTriggerUpdate:()=>{J(T)},resetFilterValue:yt,update:T})]})}export{Le as SourceContentType,hs as SourceMangas};
