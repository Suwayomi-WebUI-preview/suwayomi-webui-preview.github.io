import{u as j,c as g,f,n as S,o as U,j as t,w as T,aL as I,aA as x,bJ as b,bK as p,bL as _,N as P,s as R,l as y,E as M,m as L,z as W}from"./index-C-NRbn2J.js";import{N as B}from"./NumberSetting-CWXMAhoj.js";import{u as D,g as H}from"./usePersistedValue-YxGPUEUZ.js";import{S as E}from"./Switch-Cx6nj76p.js";import{T as K}from"./TextSetting-CPPsVnu9.js";import{S as m}from"./SelectSetting-2MSXG0Ui.js";import"./Info-s1022MQE.js";import"./TextField-DbGGHPPy.js";import"./InputAdornment-Ba1B_yfN.js";import"./PasswordTextField-cFOjPskF.js";const N=23,Y=1,q=23,z=({disabled:e=!1,updateCheckInterval:r})=>{const{t:l}=j(),d=!!r,[h]=g.useUpdateServerSettings(),[i,w]=D("lastUpdateCheckInterval",N,r,H),u=f.useCallback(n=>{w(n===0?i:n),h({variables:{input:{settings:{webUIUpdateCheckInterval:n}}}}).catch(o=>S(l("global.error.label.failed_to_save_changes"),"error",U(o)))},[i]),v=n=>{u(n?i:0)};return t.jsxs(T,{children:[t.jsxs(I,{children:[t.jsx(x,{primary:l("settings.webui.auto_update.label.title")}),t.jsx(E,{disabled:e,edge:"end",checked:d,onChange:n=>v(n.target.checked)})]}),t.jsx(B,{settingTitle:l("settings.webui.auto_update.label.interval"),settingValue:l("library.settings.global_update.auto_update.interval.label.value",{hours:i}),value:i,minValue:Y,maxValue:q,defaultValue:N,showSlider:!0,valueUnit:l("global.time.hour_short"),handleUpdate:u,disabled:e||!d})]})},G=Object.values(b),J={[b.Webui]:{text:"settings.webui.title.webui",description:"settings.webui.flavor.option.webui.label.description",disclaimer:"settings.webui.flavor.label.info"},[b.Vui]:{text:"settings.webui.flavor.option.vui.label.title",description:"settings.webui.flavor.option.vui.label.description",disclaimer:"settings.webui.flavor.label.info"},[b.Custom]:{text:"settings.webui.flavor.option.custom.label.title",description:"settings.webui.flavor.option.custom.label.description"}},Q=G.map(e=>[e,J[e]]),X=Object.values(p),Z={[p.Bundled]:{text:"settings.webui.channel.option.bundled.label.title",description:"settings.webui.channel.option.bundled.label.description",disclaimer:"settings.webui.flavor.label.info"},[p.Stable]:{text:"settings.webui.channel.option.stable.label.title",description:"settings.webui.channel.option.stable.label.description",disclaimer:"settings.webui.flavor.label.info"},[p.Preview]:{text:"settings.webui.channel.option.preview.label.title",description:"settings.webui.channel.option.preview.label.description",disclaimer:"settings.webui.channel.option.preview.label.disclaimer"}},$=X.map(e=>[e,Z[e]]),ee=Object.values(_),te={[_.Browser]:{text:"settings.webui.interface.option.label.browser",description:"settings.webui.interface.label.description"},[_.Electron]:{text:"settings.webui.interface.option.label.electron",description:"settings.webui.interface.label.description"}},ae=ee.map(e=>[e,te[e]]),ie=e=>({webUIFlavor:e.webUIFlavor,initialOpenInBrowserEnabled:e.initialOpenInBrowserEnabled,webUIInterface:e.webUIInterface,electronPath:e.electronPath,webUIChannel:e.webUIChannel,webUIUpdateCheckInterval:e.webUIUpdateCheckInterval}),he=()=>{const{t:e}=j(),{setTitle:r,setAction:l}=f.useContext(P);f.useLayoutEffect(()=>(r(e("settings.webui.title.settings")),l(null),()=>{r(""),l(null)}),[e]);const{settings:{webUIInformAvailableUpdate:d},loading:h,request:{error:i,refetch:w}}=R(),u=W(a=>S(e("global.error.label.failed_to_save_changes"),"error",U(a))),{data:v,loading:n,error:o,refetch:O}=g.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[V]=g.useUpdateServerSettings(),c=(a,k)=>{a==="webUIChannel"&&g.graphQLClient.client.cache.evict({fieldName:"checkForWebUIUpdate"}),V({variables:{input:{settings:{[a]:k}}}}).catch(F=>S(e("global.error.label.failed_to_save_changes"),"error",U(F)))};if(h||n)return t.jsx(y,{});const C=i!=null?i:o;if(C)return t.jsx(M,{message:e("global.error.label.failed_to_load_data"),messageExtra:C.message,retry:()=>{i&&w().catch(L()),o&&O().catch(L())}});const s=ie(v.settings),A=s.webUIFlavor===b.Custom;return t.jsxs(T,{sx:{pt:0},children:[t.jsx(m,{settingName:e("settings.webui.flavor.label.title"),value:s.webUIFlavor,values:Q,handleChange:a=>c("webUIFlavor",a)}),t.jsxs(I,{children:[t.jsx(x,{primary:e("settings.webui.label.initial_open_browser")}),t.jsx(E,{edge:"end",checked:s.initialOpenInBrowserEnabled,onChange:a=>c("initialOpenInBrowserEnabled",a.target.checked)})]}),t.jsx(m,{settingName:e("settings.webui.interface.label.title"),value:s.webUIInterface,values:ae,handleChange:a=>c("webUIInterface",a)}),t.jsx(K,{settingName:e("settings.webui.electron_path.label.title"),dialogDescription:e("settings.webui.electron_path.label.description"),value:s.electronPath,settingDescription:s.electronPath.length?s.electronPath:e("global.label.default"),handleChange:a=>c("electronPath",a)}),t.jsx(m,{settingName:e("settings.webui.channel.label.title"),value:s.webUIChannel,values:$,handleChange:a=>c("webUIChannel",a),disabled:A}),t.jsx(z,{disabled:A,updateCheckInterval:s.webUIUpdateCheckInterval}),!s.webUIUpdateCheckInterval&&t.jsxs(I,{children:[t.jsx(x,{primary:e("global.update.settings.inform.label.title"),secondary:e("global.update.settings.inform.label.description")}),t.jsx(E,{edge:"end",checked:d,onChange:a=>u("webUIInformAvailableUpdate",a.target.checked)})]})]})};export{he as WebUISettings};
