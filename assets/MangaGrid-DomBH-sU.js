import{br as De,bs as Te,f as x,bt as Ge,j as t,Z as Pe,bu as $e,bv as Ae,a0 as Ee,X as Le,bw as Be,_ as J,Y as Oe,a8 as Ne,ar as Fe,bx as xe,v as We,by as ie,bz as ze,bA as Ue,U as Y,H as F,bB as Ve,u as q,L as ee,A as Z,bC as He,o as Me,k as we,h as Ke,aG as Ye,e as re,p as Qe,q as Xe,F as Ze,w as Je,b as V,B as N,m as qe,aC as et,C as H,I as tt,aq as L,aZ as ae,T as ve,aB as nt,bj as st,J as rt,Q as be,i as ke}from"./index-BQabjUKA.js";import{E as ot}from"./EmptyViewAbsoluteCentered-DmoqT0nI.js";import{c as it,b as E,d as at,e as ct,h as lt,D as dt,R as ut,i as ft,F as pt,M as ye,u as mt,V as ht,a as gt}from"./useManageMangaLibraryState-C6B5EzRb.js";import{D as xt}from"./Delete-CvxM3FjJ.js";import{D as bt}from"./Download-Q8O9hhex.js";import{C as yt,a as Ct,L as jt,T as Mt,b as wt}from"./ContinueReadingTooltip-DNuWU5uG.js";import{S as vt}from"./Sync-DX9Xk5bj.js";import{a as v,b as kt,M as _t}from"./Mangas-REOBnP29.js";import{u as ce}from"./use-merged-ref-DrcQx5Vg.js";import{C as ne}from"./CheckboxInput-DoO9P99l.js";import{F as It}from"./FormGroup-GBNwYA2O.js";import{S as Rt}from"./SpinnerImage-H500jU_b.js";import{M as X}from"./MUI.util-CEodEA2f.js";import{C as St}from"./Checkbox-D-q8QTIa.js";import{L as Dt}from"./Link-MWbW9vO-.js";import{C as _e}from"./Card-CVrk-Cv2.js";import{C as Ie}from"./CardActionArea-CSSi00C_.js";import{L as Tt}from"./ListCardAvatar-HJw4zMeZ.js";import{L as Gt}from"./ListCardContent-ouZJ5rBi.js";import{P as Pt}from"./PlayArrow-B0FCtCa7.js";import{a as $t}from"./Chapters-DeNG7J4T.js";import{D as At}from"./StyledFab-2bVRJbJF.js";import{J as Et}from"./index-C3ZnnLMW.js";import{V as Lt}from"./Virtuoso.util-yOuHC2f3.js";const Bt=(e,n)=>e.filter(s=>n.includes(s)),Q=(e,n,s)=>{const i=e.keys[0];Array.isArray(n)?n.forEach((o,r)=>{s((a,p)=>{r<=e.keys.length-1&&(r===0?Object.assign(a,p):a[e.up(e.keys[r])]=p)},o)}):n&&typeof n=="object"?(Object.keys(n).length>e.keys.length?e.keys:Bt(e.keys,Object.keys(n))).forEach(r=>{if(e.keys.includes(r)){const a=n[r];a!==void 0&&s((p,m)=>{i===r?Object.assign(p,m):p[e.up(r)]=m},a)}}):(typeof n=="number"||typeof n=="string")&&s((o,r)=>{Object.assign(o,r)},n)};function se(e){return"--Grid-".concat(e,"Spacing")}function oe(e){return"--Grid-parent-".concat(e,"Spacing")}const Ce="--Grid-columns",K="--Grid-parent-columns",Ot=({theme:e,ownerState:n})=>{const s={};return Q(e.breakpoints,n.size,(i,o)=>{let r={};o==="grow"&&(r={flexBasis:0,flexGrow:1,maxWidth:"100%"}),o==="auto"&&(r={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof o=="number"&&(r={flexGrow:0,flexBasis:"auto",width:"calc(100% * ".concat(o," / var(").concat(K,") - (var(").concat(K,") - ").concat(o,") * (var(").concat(oe("column"),") / var(").concat(K,")))")}),i(s,r)}),s},Nt=({theme:e,ownerState:n})=>{const s={};return Q(e.breakpoints,n.offset,(i,o)=>{let r={};o==="auto"&&(r={marginLeft:"auto"}),typeof o=="number"&&(r={marginLeft:o===0?"0px":"calc(100% * ".concat(o," / var(").concat(K,") + var(").concat(oe("column"),") * ").concat(o," / var(").concat(K,"))")}),i(s,r)}),s},Ft=({theme:e,ownerState:n})=>{if(!n.container)return{};const s={[Ce]:12};return Q(e.breakpoints,n.columns,(i,o)=>{const r=o!=null?o:12;i(s,{[Ce]:r,"> *":{[K]:r}})}),s},Wt=({theme:e,ownerState:n})=>{if(!n.container)return{};const s={};return Q(e.breakpoints,n.rowSpacing,(i,o)=>{var a;const r=typeof o=="string"?o:(a=e.spacing)==null?void 0:a.call(e,o);i(s,{[se("row")]:r,"> *":{[oe("row")]:r}})}),s},zt=({theme:e,ownerState:n})=>{if(!n.container)return{};const s={};return Q(e.breakpoints,n.columnSpacing,(i,o)=>{var a;const r=typeof o=="string"?o:(a=e.spacing)==null?void 0:a.call(e,o);i(s,{[se("column")]:r,"> *":{[oe("column")]:r}})}),s},Ut=({theme:e,ownerState:n})=>{if(!n.container)return{};const s={};return Q(e.breakpoints,n.direction,(i,o)=>{i(s,{flexDirection:o})}),s},Vt=({ownerState:e})=>({minWidth:0,boxSizing:"border-box",...e.container&&{display:"flex",flexWrap:"wrap",...e.wrap&&e.wrap!=="wrap"&&{flexWrap:e.wrap},gap:"var(".concat(se("row"),") var(").concat(se("column"),")")}}),Ht=e=>{const n=[];return Object.entries(e).forEach(([s,i])=>{i!==!1&&i!==void 0&&n.push("grid-".concat(s,"-").concat(String(i)))}),n},Kt=(e,n="xs")=>{function s(i){return i===void 0?!1:typeof i=="string"&&!Number.isNaN(Number(i))||typeof i=="number"&&i>0}if(s(e))return["spacing-".concat(n,"-").concat(String(e))];if(typeof e=="object"&&!Array.isArray(e)){const i=[];return Object.entries(e).forEach(([o,r])=>{s(r)&&i.push("spacing-".concat(o,"-").concat(String(r)))}),i}return[]},Yt=e=>e===void 0?[]:typeof e=="object"?Object.entries(e).map(([n,s])=>"direction-".concat(n,"-").concat(s)):["direction-xs-".concat(String(e))];function Qt(e,n){e.item!==void 0&&delete e.item,e.zeroMinWidth!==void 0&&delete e.zeroMinWidth,n.keys.forEach(s=>{e[s]!==void 0&&delete e[s]})}const Xt=Be(),Zt=De("div",{name:"MuiGrid",slot:"Root"});function Jt(e){return Ae({props:e,name:"MuiGrid",defaultTheme:Xt})}function qt(e={}){const{createStyledComponent:n=Zt,useThemeProps:s=Jt,useTheme:i=Te,componentName:o="MuiGrid"}=e,r=(l,c)=>{const{container:d,direction:u,spacing:f,wrap:g,size:h}=l,b={root:["root",d&&"container",g!=="wrap"&&"wrap-xs-".concat(String(g)),...Yt(u),...Ht(h),...d?Kt(f,c.breakpoints.keys[0]):[]]};return Ee(b,y=>Le(o,y),{})};function a(l,c,d=()=>!0){const u={};return l===null||(Array.isArray(l)?l.forEach((f,g)=>{f!==null&&d(f)&&c.keys[g]&&(u[c.keys[g]]=f)}):typeof l=="object"?Object.keys(l).forEach(f=>{const g=l[f];g!=null&&d(g)&&(u[f]=g)}):u[c.keys[0]]=l),u}const p=n(Ft,zt,Wt,Ot,Ut,Vt,Nt),m=x.forwardRef(function(c,d){var U,de,ue,fe,pe,me;const u=i(),f=s(c),g=Ge(f);Qt(g,u.breakpoints);const{className:h,children:b,columns:y=12,container:w=!1,component:S="div",direction:C="row",wrap:j="wrap",size:k={},offset:_={},spacing:I=0,rowSpacing:P=I,columnSpacing:T=I,unstable_level:R=0,...$}=g,D=a(k,u.breakpoints,A=>A!==!1),G=a(_,u.breakpoints),W=(U=c.columns)!=null?U:R?void 0:y,M=(de=c.spacing)!=null?de:R?void 0:I,z=(fe=(ue=c.rowSpacing)!=null?ue:c.spacing)!=null?fe:R?void 0:P,B=(me=(pe=c.columnSpacing)!=null?pe:c.spacing)!=null?me:R?void 0:T,O={...g,level:R,columns:W,container:w,direction:C,wrap:j,spacing:M,rowSpacing:z,columnSpacing:B,size:D,offset:G},te=r(O,u);return t.jsx(p,{ref:d,as:S,ownerState:O,className:Pe(te.root,h),...$,children:x.Children.map(b,A=>{var he,ge;return x.isValidElement(A)&&$e(A,["Grid"])&&w&&A.props.container?x.cloneElement(A,{unstable_level:(ge=(he=A.props)==null?void 0:he.unstable_level)!=null?ge:R+1}):A})})});return m.muiName="Grid",m}const le=qt({createStyledComponent:J("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:s}=e;return[n.root,s.container&&n.container]}}),componentName:"MuiGrid",useThemeProps:e=>Oe({props:e,name:"MuiGrid"}),useTheme:Ne}),en=({MenuItemProps:e,className:n,label:s,LeftIcon:i,renderLabel:o,RightIcon:r,...a})=>t.jsxs(Fe,{...e,className:n,...a,children:[i&&t.jsx(xe,{children:t.jsx(i,{fontSize:"small"})}),t.jsx(We,{children:s}),r&&t.jsx(xe,{style:{minWidth:0},children:t.jsx(r,{fontSize:"small"})})]}),tn=({ref:e,...n})=>{const{parentMenuOpen:s,label:i,renderLabel:o,RightIcon:r=ie(Ue,ze),LeftIcon:a,children:p,className:m,tabIndex:l,ContainerProps:c={},MenuProps:d,...u}=n,f=Y.useIsTouchDevice(),{ref:g,...h}=c,b=x.useRef(null),y=ce(e,b),w=x.useRef(null),S=ce(g,w),C=x.useRef(null),[j,k]=x.useState(!1),_=M=>{if(j!==M){if(n.disabled){k(!1);return}k(M)}},I=M=>{f||(_(!0),h.onMouseEnter&&h.onMouseEnter(M))},P=M=>{_(!1),h.onMouseLeave&&h.onMouseLeave(M)},T=()=>{var z,B;const M=(B=(z=w.current)==null?void 0:z.ownerDocument.activeElement)!=null?B:null;if(C.current==null)return!1;for(const O of C.current.children)if(O===M)return!0;return!1},R=M=>{f||(M.target===w.current&&_(!0),h.onFocus&&h.onFocus(M))},$=M=>{_(!j),h.onClick&&h.onClick(M)},D=M=>{var B,O,te;if(M.key==="Escape")return;T()&&M.stopPropagation();const z=(B=w.current)==null?void 0:B.ownerDocument.activeElement;if(M.key==="ArrowLeft"&&T()&&((O=w.current)==null||O.focus()),M.key==="ArrowRight"&&M.target===w.current&&M.target===z){const U=(te=C.current)==null?void 0:te.children[0];U==null||U.focus()}},G=j&&s;let W;return n.disabled||(W=l!==void 0?l:-1),t.jsxs(F,{...h,ref:S,onFocus:R,onClick:$,tabIndex:W,onMouseEnter:I,onMouseLeave:P,onKeyDown:D,children:[t.jsx(en,{MenuItemProps:u,className:m,ref:y,LeftIcon:a,RightIcon:r,label:i,renderLabel:o}),t.jsx(Ve,{style:{pointerEvents:"none"},anchorEl:b.current,anchorOrigin:{horizontal:ie("right","left"),vertical:"top"},transformOrigin:{horizontal:ie("left","right"),vertical:"top"},open:G,autoFocus:!1,disableAutoFocus:!0,disableEnforceFocus:!0,onClose:()=>{_(!1)},...d,children:t.jsx(F,{ref:C,style:{pointerEvents:"auto"},children:p})})]})},nn=({manga:e,handleSelection:n,selectedMangas:s,onClose:i,setHideMenu:o})=>{var I,P;const{i18n:r,_:a}=q(),[p,m]=x.useState(!1),l=!!e,c=s!=null?s:[],d=ct(l,kt),u=it(l),f=lt(l),g=!!e&&e.downloadCount===e.chapters.totalCount,h=!!(e!=null&&e.downloadCount),b=!!(e!=null&&e.unreadCount),y=!!e&&e.unreadCount!==e.chapters.totalCount,w=()=>{n==null||n(e.id,!0),i()},S=(T,R)=>{v.performAction(T,e?[e.id]:v.getIds(R),{wasManuallyMarkedAsRead:!0}).catch(we("MangaActionMenuItems:performAction(".concat(T,")"))),i()},{downloadableMangas:C,downloadedMangas:j,unreadMangas:k,readMangas:_}=x.useMemo(()=>({downloadableMangas:[...v.getNotDownloaded(c),...v.getPartiallyDownloaded(c)],downloadedMangas:[...v.getPartiallyDownloaded(c),...v.getFullyDownloaded(c)],unreadMangas:[...v.getUnread(c),...v.getPartiallyRead(c)],readMangas:[...v.getPartiallyRead(c),...v.getFullyRead(c)]}),[c]);return t.jsxs(t.Fragment,{children:[!!n&&l&&t.jsx(E,{onClick:w,Icon:at,title:r._({id:"rG3WVm"})}),u(!g)&&t.jsx(tn,{disabled:f(!C.length),LeftIcon:bt,label:d("download",C.length),parentMenuOpen:!0,children:t.jsx(yt,{mangaIds:l?[e.id]:v.getIds(c),closeMenu:i})}),u(h)&&t.jsx(E,{Icon:xt,disabled:f(!j.length),onClick:()=>S("delete",j),title:d("delete",j.length)}),u(b)&&t.jsx(E,{Icon:dt,disabled:f(!k.length),onClick:()=>S("mark_as_read",k),title:d("mark_as_read",k.length)}),u(y)&&t.jsx(E,{Icon:ut,disabled:f(!_.length),onClick:()=>S("mark_as_unread",_),title:d("mark_as_unread",_.length)}),l&&t.jsx(ee,{to:Z.migrate.childRoutes.search.path((I=e==null?void 0:e.sourceId)!=null?I:-1,(P=e==null?void 0:e.id)!=null?P:-1,e==null?void 0:e.title),state:{mangaTitle:e==null?void 0:e.title},style:{textDecoration:"none",color:"inherit"},children:t.jsx(E,{Icon:Ct,title:d("migrate",c.length)})}),l&&t.jsx(E,{onClick:()=>{m(!0),o(!0)},Icon:vt,title:d("track",c.length)}),t.jsx(E,{onClick:()=>{He.show(ft,{mangaId:e==null?void 0:e.id,mangaIds:s?v.getIds(c):void 0,addToLibrary:!1}),o(!0),i()},Icon:jt,title:d("change_categories",c.length)}),t.jsx(E,{onClick:()=>S("remove_from_library",c),Icon:pt,title:d("remove_from_library",c.length)}),p&&t.jsx(Me,{open:!0,maxWidth:"md",fullWidth:!0,scroll:"paper",onClose:()=>{m(!1),i()},children:t.jsx(Mt,{manga:e})})]})},sn=({mangaIdToMigrateTo:e,onClose:n})=>{const{i18n:s,_:i}=q(),o=Ke(),{mangaId:r}=Ye(),a=Number(r),{settings:{migrateChapters:p,migrateCategories:m,migrateTracking:l,deleteChapters:c}}=re(),[d,u]=x.useState(!1),f=Ze(we("MigrateDialog::updateSetting")),g=async h=>{if(a==null)throw new Error('MigrateDialog::migrate: unexpected mangaId "'.concat(a,'"'));qe(s._({id:"pf0CQ9"}),"info"),u(!0);try{await v.migrate(a,e,{mode:h,migrateChapters:p,migrateCategories:m,migrateTracking:l,deleteChapters:c}),o(Z.manga.path(e),{replace:!0})}catch(b){u(!1)}};return t.jsxs(Me,{open:!0,fullWidth:!0,onClose:n,children:[t.jsx(Qe,{children:s._({id:"cVCLaF"})}),t.jsx(Xe,{dividers:!0,children:t.jsxs(It,{children:[t.jsx(ne,{disabled:d,label:s._({id:"QIei5D"}),checked:p,onChange:(h,b)=>f("migrateChapters",b)}),t.jsx(ne,{disabled:d,label:s._({id:"K7tIrx"}),checked:m,onChange:(h,b)=>f("migrateCategories",b)}),t.jsx(ne,{disabled:d,label:s._({id:"U0HZma"}),checked:l,onChange:(h,b)=>f("migrateTracking",b)}),t.jsx(ne,{disabled:d,label:s._({id:"D/WCwa"}),checked:c,onChange:(h,b)=>f("deleteChapters",b)})]})}),t.jsx(Je,{children:t.jsxs(V,{direction:"row",sx:{justifyContent:"space-between",width:"100%"},children:[t.jsx(N,{disabled:d,component:ee,to:Z.manga.path(e),children:s._({id:"BbYYZ3"})}),t.jsxs(V,{direction:"row",children:[t.jsx(N,{disabled:d,onClick:n,children:s._({id:"dEgA5A"})}),t.jsx(N,{disabled:d,onClick:()=>g("copy"),children:s._({id:"he3ygx"})}),t.jsx(N,{disabled:d,onClick:()=>g("migrate"),children:s._({id:"y5rS9U"})})]})]})})]})},Re=({id:e,selected:n,handleSelection:s,asCheckbox:i=!1,popupState:o,ref:r})=>{const{i18n:a,_:p}=q(),m=x.useMemo(()=>et(o),[o]),l=u=>{u.stopPropagation(),u.preventDefault()},c=(u,f)=>{l(u),s==null||s(e,f)};return s?n!==null?i?t.jsx(H,{title:n?a._({id:"HlKgQk"}):a._({id:"rG3WVm"}),children:t.jsx(St,{...X.preventRippleProp(),checked:n,onChange:c})}):null:i?t.jsx(H,{title:a._({id:"0zpgxV"}),children:t.jsx(tt,{ref:r,...X.preventRippleProp(m,{onClick:l}),"aria-label":"more",children:t.jsx(ye,{})})}):t.jsx(H,{title:a._({id:"0zpgxV"}),children:t.jsx(N,{ref:r,...X.preventRippleProp(m,{onClick:l}),className:"manga-option-button",size:"small",variant:"contained",sx:{minWidth:"unset",paddingX:"0",paddingY:"2.5px",visibility:o.isOpen?"visible":"hidden",pointerEvents:"none","@media not (pointer: fine)":{visibility:"hidden",width:0,height:0,p:0,m:0}},children:t.jsx(ye,{})})}):null},rn=J("div")({position:"absolute",bottom:0,width:"100%",height:"30%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),on=J("div")({position:"absolute",bottom:0,width:"100%",height:"20%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),an=x.memo(({manga:e,longPressBind:n,popupState:s,handleClick:i,mangaLinkTo:o,selected:r,inLibraryIndicator:a,isInLibrary:p,gridLayout:m,handleSelection:l,continueReadingButton:c,mangaBadges:d,mode:u})=>{const f=Y.usePreventMobileContextMenu(),g=x.useRef(null),{id:h,title:b}=e;return t.jsx(Dt,{component:ee,...n(()=>s.open(g.current)),onClick:i,to:o,state:v.createLocationState(e,u),onContextMenu:f,sx:{...Y.preventMobileContextMenuSx(),textDecoration:"none"},children:t.jsxs(F,{sx:{display:"flex",flexDirection:"column",m:.25,outline:r?"4px solid":void 0,borderRadius:r?"1px":void 0,outlineColor:y=>y.palette.primary.main,backgroundColor:y=>r?y.palette.primary.main:void 0,"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:u==="source"?"none":"flex"}}},children:[t.jsx(_e,{sx:{aspectRatio:_t,display:"flex"},children:t.jsxs(Ie,{sx:{position:"relative",height:"100%"},children:[t.jsx(Rt,{alt:b,src:v.getThumbnailUrl(e),imgStyle:a&&p?{height:"100%",width:"100%",objectFit:"cover",filter:"brightness(0.4)"}:{height:"100%",width:"100%",objectFit:"cover"},spinnerStyle:{display:"grid",placeItems:"center"}}),t.jsxs(V,{direction:"row",sx:{alignItems:"start",justifyContent:"space-between",position:"absolute",top:y=>y.spacing(1),left:y=>y.spacing(1),right:y=>y.spacing(1)},children:[d,t.jsx(Re,{ref:g,popupState:s,id:h,selected:r,handleSelection:l})]}),t.jsxs(t.Fragment,{children:[m!==L.Comfortable&&t.jsxs(t.Fragment,{children:[t.jsx(rn,{}),t.jsx(on,{})]}),t.jsxs(V,{direction:"row",sx:{justifyContent:m!==L.Comfortable?"space-between":"end",alignItems:"end",position:"absolute",bottom:0,width:"100%",p:1,gap:1},children:[m!==L.Comfortable&&t.jsx(H,{title:b,placement:"top",children:t.jsx(ae,{component:"h3",sx:{color:"white",textShadow:"0px 0px 3px #000000"},children:b})}),c]})]})]})}),m===L.Comfortable&&t.jsx(V,{sx:{pb:1},children:t.jsx(H,{title:b,placement:"top",children:t.jsx(ae,{component:"h3",sx:{color:y=>r?y.palette.primary.contrastText:"text.primary",height:"3rem",pt:.5},children:b})})})]})})}),cn=x.memo(({manga:e,longPressBind:n,popupState:s,handleClick:i,mangaLinkTo:o,selected:r,inLibraryIndicator:a,isInLibrary:p,handleSelection:m,continueReadingButton:l,mangaBadges:c,mode:d})=>{const u=Y.usePreventMobileContextMenu(),f=x.useRef(null),{id:g,title:h}=e;return t.jsx(_e,{children:t.jsx(Ie,{component:ee,to:o,state:v.createLocationState(e,d),onClick:i,...n(()=>s.open(f.current)),onContextMenu:u,sx:{...Y.preventMobileContextMenuSx(),"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:d==="source"?"none":"inline-flex"}}},children:t.jsxs(Gt,{sx:{justifyContent:"space-between",position:"relative"},children:[t.jsx(Tt,{iconUrl:v.getThumbnailUrl(e),alt:e.title,slots:{spinnerImageProps:{imgStyle:{imageRendering:"pixelated",filter:a&&p?"brightness(0.4)":void 0}}}}),t.jsx(F,{sx:{display:"flex",flexDirection:"row",flexGrow:1,width:"min-content"},children:t.jsx(H,{title:h,placement:"top",children:t.jsx(ae,{variant:"h6",component:"h3",children:h})})}),t.jsxs(V,{direction:"row",sx:{alignItems:"center",gap:.5},children:[c,l,t.jsx(Re,{ref:f,popupState:s,id:g,selected:r,handleSelection:m,asCheckbox:!0})]})]})})})}),ln=({showContinueReadingButton:e,chapter:n,mangaLinkTo:s})=>{if(!e||!n)return null;const{sourceOrder:i,chapterNumber:o,name:r,scanlator:a}=n;return t.jsx(wt,{chapterNumber:o,name:r,sourceOrder:i,scanlator:a,children:t.jsx(N,{...X.preventRippleProp(),variant:"contained",size:"small",sx:{minWidth:"unset",py:.5,px:.75},component:ee,to:"".concat(s,"/chapter/").concat(i),state:$t.getReaderOpenChapterLocationState(n),onClick:p=>p.stopPropagation(),children:t.jsx(Pt,{})})})},dn=J("div")(({theme:e})=>({display:"flex",height:"fit-content",borderRadius:e.shape.borderRadius,overflow:"hidden"})),je=J(ve)(({theme:e})=>({color:e.palette.primary.contrastText,paddingInline:e.spacing(.3)})),un=({inLibraryIndicator:e,updateLibraryState:n,isInLibrary:s,unread:i,downloadCount:o,mode:r})=>{const{i18n:a,_:p}=q(),m=Y.useIsTouchDevice(),{settings:{showUnreadBadge:l,showDownloadBadge:c}}=re();return t.jsxs(dn,{children:[!m&&e&&r==="source"&&t.jsx(N,{className:"source-manga-library-state-button",component:"div",variant:"contained",size:"small",...X.preventRippleProp(),onClick:d=>{d.preventDefault(),d.stopPropagation(),n()},sx:{display:"none"},color:s?"error":"primary",children:s?a._({id:"mfwy3x"}):a._({id:"RsaYWP"})}),e&&s&&t.jsx(ve,{className:"source-manga-library-state-indicator",sx:{backgroundColor:"primary.dark",color:"primary.contrastText",p:.3},children:a._({id:"GcCthe"})}),(l&&r==="default"||r==="duplicate")&&(i!=null?i:0)>0&&t.jsx(je,{sx:{backgroundColor:"primary.main",color:"primary.contrastText"},children:i}),(c&&r==="default"||r==="duplicate")&&(o!=null?o:0)>0&&t.jsx(je,{sx:{backgroundColor:"secondary.main",color:"secondary.contrastText"},children:o})]})},fn=(e,n,s,i)=>{switch(e){case"default":case"source":case"duplicate":return Z.manga.path(n);case"migrate.search":return Z.migrate.childRoutes.search.path(s!=null?s:"-1",n,i);case"migrate.select":return"";default:throw new Error('getMangaLinkTo: unexpected MangaCardMode "'.concat(e,'"'))}},pn=x.memo(e=>{const{manga:n,gridLayout:s,inLibraryIndicator:i,selected:o,handleSelection:r,mode:a="default"}=e,{id:p,firstUnreadChapter:m,downloadCount:l,unreadCount:c}=n,{settings:{showContinueReadingButton:d}}=re(),{updateLibraryState:u,isInLibrary:f}=mt(n,a==="source"),g=fn(a,n.id,n.sourceId,n.title),[h,b]=x.useState(!1),y=x.useCallback((C,j)=>{const k=a==="default",_=a==="source",I=a==="migrate.select",P=o!==null;if(I||P||(k||_)&&j){if(C.preventDefault(),_){u();return}if(P){r==null||r(p,!o,{selectRange:C.shiftKey});return}if(k){j==null||j();return}I&&b(!0)}},[a,o,u,r]),w=ht(x.useCallback((C,{context:j})=>{C.shiftKey=!0,y(C,j)},[y])),S=x.useMemo(()=>s===L.List?cn:an,[s]);return t.jsxs(t.Fragment,{children:[h&&t.jsx(sn,{mangaIdToMigrateTo:n.id,onClose:()=>b(!1)}),t.jsx(nt,{variant:"popover",popupId:"manga-card-action-menu",children:C=>t.jsxs(t.Fragment,{children:[t.jsx(S,{...e,longPressBind:w,popupState:C,handleClick:y,mangaLinkTo:g,isInLibrary:f,inLibraryIndicator:i,continueReadingButton:t.jsx(ln,{showContinueReadingButton:d&&a==="default",chapter:m,mangaLinkTo:g}),mangaBadges:t.jsx(un,{inLibraryIndicator:i,isInLibrary:f,unread:c,downloadCount:l,updateLibraryState:u,mode:a})}),!!r&&C.isOpen&&t.jsx(gt,{...st(C),children:(j,k)=>t.jsx(nn,{manga:n,handleSelection:r,onClose:j,setHideMenu:k})})]})})]})}),mn=({ref:e,persistKey:n,...s})=>{const{state:i,persistState:o}=Lt.usePersistState(n),r=x.useRef(void 0),a=ce(r,e);return t.jsx(Et,{...s,ref:a,stateChanged:o,restoreStateFrom:i})},hn=({children:e,ref:n,...s})=>t.jsx(le,{...s,ref:n,container:!0,spacing:1,children:e}),gn=(e,n,s,i=12)=>{const o=Math.ceil(e/n),r=s===L.List?i:i/o;return({children:a,...p})=>t.jsx(le,{...p,size:r,children:a})},Se=(e,n,s,i=!1,o,r,a)=>t.jsx(pn,{manga:e,gridLayout:n,inLibraryIndicator:s,selected:i?o==null?void 0:o.includes(e.id):null,handleSelection:r,mode:a}),xn=({isLoading:e,mangas:n,inLibraryIndicator:s,GridItemContainer:i,gridLayout:o,isSelectModeActive:r,selectedMangaIds:a,handleSelection:p,mode:m,ref:l})=>t.jsx(le,{ref:l,container:!0,spacing:1,sx:{width:"100%",overflowX:"auto",display:"-webkit-inline-box",flexWrap:"nowrap"},children:e?t.jsx(ke,{}):n.map(c=>t.jsx(i,{children:Se(c,o,s,r,a,p,m)},c.id))}),bn="MangaGrid-snapshot-location",yn=({isLoading:e,mangas:n,inLibraryIndicator:s,GridItemContainer:i,gridLayout:o,hasNextPage:r,loadMore:a,isSelectModeActive:p,selectedMangaIds:m,handleSelection:l,mode:c,ref:d})=>t.jsxs(t.Fragment,{children:[t.jsx(F,{ref:d,children:t.jsx(mn,{persistKey:bn,useWindowScroll:!0,increaseViewportBy:window.innerHeight*.5,totalCount:n.length,components:{List:hn,Item:i},endReached:()=>a(),computeItemKey:u=>n[u].id,itemContent:u=>Se(n[u],o,s,p,m,l,c)})}),p&&o===L.List?t.jsx(F,{sx:{paddingBottom:At}}):e?t.jsx(ke,{}):r?t.jsx("div",{style:{height:"75px"}}):null]}),Un=({mangas:e,isLoading:n,message:s,messageExtra:i,hasNextPage:o,loadMore:r,gridLayout:a,horizontal:p,noFaces:m,inLibraryIndicator:l,isSelectModeActive:c,selectedMangaIds:d,handleSelection:u,mode:f,retry:g,gridWrapperProps:h})=>{var T,R;const{i18n:b,_:y}=q(),{navBarWidth:w}=rt(),{settings:{mangaGridItemWidth:S}}=re(),C=x.useRef(null),j=x.useRef(null),[k,_]=x.useState((R=(T=j.current)==null?void 0:T.offsetWidth)!=null?R:Math.max(0,document.documentElement.offsetWidth-w)),I=x.useMemo(()=>gn(k,S,a),[k,S,a]);return x.useLayoutEffect(()=>{if(p)return()=>{};let $;const D=G=>{$=setTimeout(()=>{if(document.body.style.overflow.includes("hidden")){D(250);return}document.body.style.overflowY=a===L.List?"auto":"scroll"},G)};return D(0),()=>{clearTimeout($)}},[a]),x.useLayoutEffect(()=>()=>{p||(document.body.style.overflowY="auto")},[]),be(j,x.useCallback(()=>{_((()=>{var G;const D=(G=j.current)==null?void 0:G.offsetWidth;return D||document.documentElement.offsetWidth-w})())},[w])),be(C,x.useCallback(($,D)=>{const G=$[0].target.clientHeight,W=G>document.documentElement.clientHeight;if(!n&&G){if(W){D.disconnect();return}r(),D.disconnect()}},[C,r,n])),!n&&e.length===0?t.jsx(ot,{noFaces:m,message:s!=null?s:b._({id:"RbPhRX"}),messageExtra:i,retry:g}):t.jsx(F,{...h,ref:j,sx:{...h==null?void 0:h.sx,overflow:"hidden"},children:p?t.jsx(xn,{ref:C,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:I,gridLayout:a,isSelectModeActive:c,selectedMangaIds:d,handleSelection:u,mode:f}):t.jsx(yn,{ref:C,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:I,hasNextPage:o,loadMore:r,gridLayout:a,isSelectModeActive:c,selectedMangaIds:d,handleSelection:u,mode:f})})};export{bn as M,Un as a,nn as b,pn as c};
