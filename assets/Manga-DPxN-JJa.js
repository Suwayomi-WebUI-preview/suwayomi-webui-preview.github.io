import{r as D,i as B,j as e,u as I,p as qe,c as m,w as Re,h as Te,x as ie,P as de,S as j,L as U,T as G,y as We,f as S,I as w,z as Q,A as De,C as Ue,D as J,s as L,v as Ke,M as ye,l as Qe,a as E,F as Je,g as Be,E as W,H as Le,B as Fe,J as Xe,e as Ye,G as Ze,K as et,O as tt,m as le,Q as rt,R as at,U as st,d as nt,V as ot,W as lt,X as we,Y as te,Z as re,_ as ae,N as it,$ as dt,a0 as ct,a1 as ut,a2 as ht}from"./index-DrMaLApM.js";import{V as pt}from"./index-BePNABZb.js";import{M as T,d as ft,a as mt,b as gt,c as xt,e as bt,f as jt,J as Ae,g as kt,h as vt,u as Ct,C as _t,T as yt,i as wt,j as It,k as Mt,l as St,m as Ie,n as Me}from"./useManageMangaLibraryState-Drg7IjS3.js";import{D as $t}from"./DownloadStateIndicator-C-6YP-sd.js";import{d as Rt}from"./Delete-ChLidWWe.js";import{C,a as Tt}from"./Chapters-zQI3XOpW.js";import{T as Dt}from"./TypographyMaxLines-CLXIUzbB.js";import{C as Bt}from"./Card-7woGM9TE.js";import{C as Lt}from"./CardActionArea-fvZ2Eb_P.js";import{C as Ft}from"./CardContent-BdJiGkZ7.js";import{C as At}from"./Checkbox-EWU1jBqu.js";import{d as Nt}from"./PlayArrow-BbFLK04Z.js";import{S as Ot,D as Et}from"./StyledFab-CoMuShYA.js";import{d as Pt}from"./FilterList-ChpzFF7M.js";import{S as zt,R as Se}from"./SortRadioInput-CfTF-eQA.js";import{T as se}from"./ThreeStateCheckboxInput-BukVnseN.js";import{O as Vt,a as Gt,S as Ht,d as qt}from"./SelectionFAB-Cwbg0ouB.js";import{R as Wt}from"./ListPreference-DOf-BlGP.js";import{M as K}from"./Mangas-DrH5ig5G.js";import{b as Ut}from"./Strings-CWt9sr6N.js";import{d as Kt,a as Qt,b as Jt}from"./ExpandMore-DWQYoU9o.js";import{S as $e}from"./SpinnerImage-BGVImmaP.js";import{C as ce}from"./CustomIconButton-Dj6FouJV.js";import{d as Xt}from"./Sync-CTLPmO34.js";import{T as ne}from"./Trackers-D4pSmk7a.js";import{L as Yt}from"./Link-BzZzh5QK.js";import{C as Zt}from"./Collapse-DZyVCVdY.js";import{C as er}from"./Chip-Q-qxfKpG.js";import"./Avatar-CkuqTDLV.js";import"./Info-BytbeKyX.js";import"./TextField-aIlb05nB.js";import"./InputAdornment-B2WSPuJe.js";import"./CheckCircle-bCfQw2NS.js";import"./NumberSetting-CMsxWZno.js";import"./useMobilePicker-B8NeLnvK.js";import"./SelectSetting-CnAuj9Yv.js";import"./Select-BPexeUAg.js";import"./CheckboxInput-B_SfADIl.js";import"./SwitchBase-NTpreOjo.js";import"./Tabs-CGh6Bm1r.js";var ue={},tr=B;Object.defineProperty(ue,"__esModule",{value:!0});var Ne=ue.default=void 0,rr=tr(D()),ar=e;Ne=ue.default=(0,rr.default)((0,ar.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");var he={},sr=B;Object.defineProperty(he,"__esModule",{value:!0});var pe=he.default=void 0,nr=sr(D()),or=e;pe=he.default=(0,nr.default)((0,or.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"}),"DoneAll");var fe={},lr=B;Object.defineProperty(fe,"__esModule",{value:!0});var Oe=fe.default=void 0,ir=lr(D()),dr=e;Oe=fe.default=(0,ir.default)((0,dr.jsx)("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"}),"Bookmark");var me={},cr=B;Object.defineProperty(me,"__esModule",{value:!0});var Ee=me.default=void 0,ur=cr(D()),hr=e;Ee=me.default=(0,ur.default)((0,hr.jsx)("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"}),"BookmarkRemove");var ge={},pr=B;Object.defineProperty(ge,"__esModule",{value:!0});var Pe=ge.default=void 0,fr=pr(D()),mr=e;Pe=ge.default=(0,fr.default)((0,mr.jsx)("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"}),"BookmarkAdd");var xe={},gr=B;Object.defineProperty(xe,"__esModule",{value:!0});var be=xe.default=void 0,xr=gr(D()),br=e;be=xe.default=(0,xr.default)((0,br.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"Launch");class y{static getChapters(r){return r.map(({chapter:a})=>a)}static getIds(r){return C.getIds(y.getChapters(r))}static getDownloaded(r){return r.filter(({chapter:a})=>C.isDownloaded(a))}static getDeletable(r,a){return r.filter(({chapter:n})=>C.isDeletable(n,a))}static getNonDownloaded(r){return r.filter(({chapter:a})=>!C.isDownloaded(a))}static getDownloadable(r){return r.filter(({chapter:a,downloadChapter:n})=>!C.isDownloaded(a)&&!n)}static getBookmarked(r){return r.filter(({chapter:a})=>C.isBookmarked(a))}static getNonBookmarked(r){return r.filter(({chapter:a})=>!C.isBookmarked(a))}static getRead(r){return r.filter(({chapter:a})=>C.isRead(a))}static getNonRead(r){return r.filter(({chapter:a})=>!C.isRead(a))}}const ze=({chapter:t,allChapters:r,handleSelection:a,canBeDownloaded:n=!1,selectedChapters:s=[],onClose:i})=>{const{t:o}=I(),d=!!t,{isDownloaded:k,isRead:g,isBookmarked:p}=t!=null?t:{},{settings:{deleteChaptersWithBookmark:l}}=qe(),f=xt(d,Tt),x=bt(d),b=jt(d),{downloadableChapters:c,downloadedChapters:h,unbookmarkedChapters:v,bookmarkedChapters:_,unreadChapters:P,readChapters:F}=m.useMemo(()=>({downloadableChapters:y.getDownloadable(s),downloadedChapters:y.getDownloaded(s),unbookmarkedChapters:y.getNonBookmarked(s),bookmarkedChapters:y.getBookmarked(s),unreadChapters:y.getNonRead(s),readChapters:y.getRead(s)}),[s]),X=()=>{a==null||a(t.id,!0),i()},M=(H,Y)=>{var N;const $=H==="mark_prev_as_read",z=$?"mark_as_read":H;if(z==="delete"&&t&&!C.isDeletable(t,l)){i();return}const A=(()=>{if(!t)return y.getChapters(Y);if(!$)return[t];const V=r.findIndex(({id:Z})=>Z===t.id);return V+1>r.length-1?[]:r.slice(V+1)})();if(!A.length){i();return}C.performAction(z,C.getIds(A),{chapters:A,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(N=A[0])==null?void 0:N.mangaId}).catch(Te()),i()};return e.jsxs(e.Fragment,{children:[d&&e.jsx(T,{onClick:X,Icon:ft,title:o("chapter.action.label.select")}),d&&e.jsx(T,{Icon:be,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),i()},title:o("chapter.action.label.open_on_source")}),x(n)&&e.jsx(T,{Icon:Re,disabled:b(!c.length),onClick:()=>M("download",c),title:f("download",c.length)}),x(k)&&e.jsx(T,{Icon:Rt,disabled:b(!h.length),onClick:()=>M("delete",y.getDeletable(h,l)),title:f("delete",h.length)}),x(!p)&&e.jsx(T,{Icon:Pe,disabled:b(!v.length),onClick:()=>M("bookmark",v),title:f("bookmark",v.length)}),x(p)&&e.jsx(T,{Icon:Ee,disabled:b(!_.length),onClick:()=>M("unbookmark",_),title:f("unbookmark",_.length)}),x(!g)&&e.jsx(T,{Icon:mt,disabled:b(!P.length),onClick:()=>M("mark_as_read",P),title:f("mark_as_read",P.length)}),x(g)&&e.jsx(T,{Icon:gt,disabled:b(!F.length),onClick:()=>M("mark_as_unread",F),title:f("mark_as_unread",F.length)}),d&&e.jsx(T,{onClick:()=>M("mark_prev_as_read",[]),Icon:pe,title:o("chapter.action.mark_as_read.add.label.action.previous")})]})},jr=t=>{const{t:r}=I(),a=ie(),n=m.useRef(null),{chapter:s,allChapters:i,downloadChapter:o,showChapterNumber:d,onSelect:k,selected:g}=t,p=g!==null,{isDownloaded:l}=s,f=c=>{p&&(c.preventDefault(),c.stopPropagation(),k(!g,c.shiftKey))},x=(c,h)=>{c.stopPropagation(),c.preventDefault(),h(c)},b=Ae((c,{context:h})=>{if(!p&&n.current){x(c,()=>h==null?void 0:h(n.current));return}c.shiftKey=!0,f(c)});return e.jsx("li",{children:e.jsx(de,{variant:"popover",popupId:"chapter-card-action-menu",children:c=>{var h;return e.jsxs(j,{sx:{pt:1,px:1},children:[e.jsx(Bt,{sx:{touchCallout:"none"},children:e.jsx(Lt,{component:U,to:"/manga/".concat(s.mangaId,"/chapter/").concat(s.sourceOrder),style:{color:a.palette.text[s.isRead?"disabled":"primary"]},onClick:v=>f(v),...b(c.open),children:e.jsxs(Ft,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5,"&:last-child":{pb:1.5}},children:[e.jsxs(j,{direction:"column",sx:{flex:1},children:[e.jsxs(j,{sx:{flexDirection:"row",gap:.5,alignItems:"center"},children:[s.isBookmarked&&e.jsx(Oe,{color:"primary"}),e.jsx(Dt,{variant:"h6",component:"h4",children:d?"".concat(r("chapter.title_one")," ").concat(s.chapterNumber):s.name})]}),e.jsx(G,{variant:"caption",children:s.scanlator}),e.jsxs(G,{variant:"caption",children:[We(Number((h=s.uploadDate)!=null?h:0),!0),l&&" â€¢ ".concat(r("chapter.status.label.downloaded"))]})]}),o&&e.jsx($t,{download:o}),e.jsx(j,{sx:{minHeight:"48px"},children:g===null?e.jsx(S,{title:r("global.button.options"),children:e.jsx(w,{ref:n,...Q(c),onClick:v=>x(v,c.open),onTouchStart:v=>x(v,c.open),"aria-label":"more",size:"large",children:e.jsx(kt,{})})}):e.jsx(S,{title:r(g?"global.button.deselect":"global.button.select"),children:e.jsx(At,{checked:g})})})]})})}),!p&&c.isOpen&&e.jsx(vt,{...De(c),children:v=>e.jsx(ze,{onClose:v,chapter:s,allChapters:i,handleSelection:()=>k(!0),canBeDownloaded:!s.isDownloaded&&!o})})]})}})})};function kr(t){const{t:r}=I(),{chapterIndex:a,mangaId:n}=t;return e.jsxs(Ot,{component:U,variant:"extended",color:"primary",to:"/manga/".concat(n,"/chapter/").concat(a),children:[e.jsx(Nt,{}),r(a===1?"global.button.start":"global.button.resume")]})}const vr={active:!1,unread:void 0,downloaded:void 0,bookmarked:void 0,reverse:!0,sortBy:"source",showChapterNumber:!1};function Cr(t,r){switch(r.type){case"filter":return{...t,active:t.unread!==!1&&t.downloaded!==!1&&t.bookmarked!==!1,[r.filterType]:r.filterValue};case"sortBy":return{...t,sortBy:r.sortBy};case"sortReverse":return{...t,reverse:!t.reverse};case"showChapterNumber":return{...t,showChapterNumber:!t.showChapterNumber};default:throw Error(J("global.error.label.invalid_action"))}}function _r(t,{isRead:r}){switch(t){case!0:return!r;case!1:return r;default:return!0}}function yr(t,{isDownloaded:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}function wr(t,{isBookmarked:r}){switch(t){case!0:return r;case!1:return!r;default:return!0}}const Ir=(t,{sortBy:r,reverse:a})=>{const n=[...t];switch(r){case"source":n.sort((s,i)=>s.sourceOrder-i.sourceOrder);break;case"fetchedAt":n.sort((s,i)=>{var o,d;return Number((o=s.fetchedAt)!=null?o:0)-Number((d=i.fetchedAt)!=null?d:0)});break;case"chapterNumber":n.sort((s,i)=>s.chapterNumber-i.chapterNumber);break;case"uploadedAt":n.sort((s,i)=>{var o,d;return Number((o=s.uploadDate)!=null?o:0)-Number((d=i.uploadDate)!=null?d:0)});break}return a&&n.reverse(),n};function Mr(t,r){const a=r.active?t.filter(n=>_r(r.unread,n)&&yr(r.downloaded,n)&&wr(r.bookmarked,n)):[...t];return Ir(a,r)}const Sr=t=>Ue(Cr,"".concat(t,"filterOptions"),vr),$r={source:"global.sort.label.by_source",chapterNumber:"global.sort.label.by_chapter_number",uploadedAt:"global.sort.label.by_upload_date",fetchedAt:"global.sort.label.by_fetch_date"},Rr=t=>{const{unread:r,downloaded:a,bookmarked:n}=t;return r!=null||a!=null||n!=null},Tr={filter:"global.label.filter",sort:"global.label.sort",display:"global.label.display"},Dr=({open:t,onClose:r,options:a,optionsDispatch:n})=>{const{t:s}=I();return e.jsx(Vt,{open:t,onClose:r,minHeight:150,tabs:["filter","sort","display"],tabTitle:i=>s(Tr[i]),tabContent:i=>i==="filter"?e.jsxs(e.Fragment,{children:[e.jsx(se,{label:s("global.filter.label.unread"),checked:a.unread,onChange:o=>n({type:"filter",filterType:"unread",filterValue:o})}),e.jsx(se,{label:s("global.filter.label.downloaded"),checked:a.downloaded,onChange:o=>n({type:"filter",filterType:"downloaded",filterValue:o})}),e.jsx(se,{label:s("global.filter.label.bookmarked"),checked:a.bookmarked,onChange:o=>n({type:"filter",filterType:"bookmarked",filterValue:o})})]}):i==="sort"?Object.entries($r).map(([o,d])=>e.jsx(zt,{label:s(d),checked:a.sortBy===o,sortDescending:a.reverse,onClick:()=>o!==a.sortBy?n({type:"sortBy",sortBy:o}):n({type:"sortReverse"})},o)):i==="display"?e.jsxs(Wt,{onChange:()=>n({type:"showChapterNumber"}),value:a.showChapterNumber,children:[e.jsx(Se,{label:s("chapter.option.display.label.source_title"),value:!1}),e.jsx(Se,{label:s("chapter.option.display.label.chapter_number"),value:!0})]}):null})},Br=({options:t,optionsDispatch:r})=>{const{t:a}=I(),[n,s]=m.useState(!1),i=Rr(t);return e.jsxs(e.Fragment,{children:[e.jsx(S,{title:a("settings.title"),children:e.jsx(w,{onClick:()=>s(!0),children:e.jsx(Pt,{color:i?"warning":void 0})})}),e.jsx(Dr,{open:n,onClose:()=>s(!1),options:t,optionsDispatch:r})]})},Lr=L(j,{shouldForwardProp:t=>t!=="scrollbarWidth"})(({theme:t,scrollbarWidth:r})=>({padding:t.spacing(1),paddingRight:"calc(".concat(r,"px + ").concat(t.spacing(1),")"),paddingBottom:0,[t.breakpoints.down("md")]:{paddingRight:t.spacing(1)}})),Fr=L(pt,{shouldForwardProp:t=>t!=="topOffset"})(({theme:t,topOffset:r})=>({listStyle:"none",padding:0,[t.breakpoints.up("md")]:{height:"calc(100vh - ".concat(r,"px)"),margin:0}})),Ar=({manga:t,isRefreshing:r})=>{var Ce,_e;const{t:a}=I(),{appBarHeight:n}=Ke(),s=ye.useIsBelowWidth("md"),[i,o]=m.useState(50),[d,k]=m.useState(null);Qe(d,m.useCallback(()=>{var u;return o((u=d==null?void 0:d.offsetHeight)!=null?u:0)},[d]));const g=ye.useGetScrollbarSize("width"),{data:p}=E.useGetDownloadStatus(),l=(Ce=p==null?void 0:p.downloadStatus.queue)!=null?Ce:[],[f,x]=Sr(t.id),{data:b,loading:c,error:h,refetch:v}=E.useGetMangaChapters(Je,t.id,{notifyOnNetworkStatusChange:!0}),_=m.useMemo(()=>{var u;return(u=b==null?void 0:b.chapters.nodes)!=null?u:[]},[b==null?void 0:b.chapters.nodes]),P=m.useMemo(()=>_.map(u=>u.id),[_]),{areNoItemsSelected:F,areAllItemsSelected:X,selectedItemIds:M,handleSelectAll:H,handleSelection:Y}=Ct(_.length,{itemIds:P,currentKey:"default"}),$=m.useMemo(()=>Mr(_,f),[_,f]),z=(_e=t.firstUnreadChapter)==null?void 0:_e.sourceOrder,ve=K.isFullyRead(t),A=K.isFullyDownloaded(t),N=_.length===0,V=!N&&$.length===0,O=m.useMemo(()=>$.map(u=>{const R=l==null?void 0:l.find(He=>He.chapter.id===u.id),ee=F?null:M.includes(u.id);return{chapter:u,downloadChapter:R,selected:ee}}),[l,M,$]),Z=m.useMemo(()=>{const u=O.filter(R=>R.selected);return u.length?e.jsx(Gt,{selectedItemsCount:u.length,title:"chapter.title_one",children:R=>e.jsx(ze,{selectedChapters:u,onClose:R})}):z!==void 0?e.jsx(kr,{chapterIndex:z,mangaId:t.id}):null},[O]);return c||N&&r?e.jsx(j,{sx:{justifyContent:"center",alignItems:"center",position:"relative",flexGrow:1},children:e.jsx(Be,{})}):h?e.jsx(j,{sx:{justifyContent:"center",position:"relative",flexGrow:1},children:e.jsx(W,{message:a("global.error.label.failed_to_load_data"),messageExtra:h.message,retry:()=>v().catch(Te())})}):e.jsxs(e.Fragment,{children:[e.jsxs(j,{direction:"column",sx:{position:"relative",flexBasis:"60%"},children:[e.jsxs(Lr,{ref:k,direction:"row",alignItems:"center",justifyContent:"space-between",scrollbarWidth:g,children:[e.jsx(G,{variant:"h5",component:"h3",children:"".concat($.length," ").concat(a("chapter.title_one",{count:$.length}))}),e.jsxs(j,{direction:"row",children:[e.jsx(S,{title:a("chapter.action.mark_as_read.add.label.action.current"),children:e.jsx(w,{disabled:ve,onClick:()=>C.markAsRead(y.getChapters(y.getNonRead(O)),!0,t.id),children:e.jsx(pe,{})})}),e.jsx(de,{variant:"popover",popupId:"chapterlist-download-button",children:u=>e.jsxs(e.Fragment,{children:[e.jsx(S,{title:a("chapter.action.download.add.label.action"),children:e.jsx(w,{disabled:A,...Q(u),children:e.jsx(Re,{})})}),u.isOpen&&e.jsx(Le,{...De(u),children:e.jsx(_t,{mangaIds:[t.id],closeMenu:u.close})})]})}),e.jsx(Br,{options:f,optionsDispatch:x}),e.jsx(Ht,{areAllItemsSelected:X,areNoItemsSelected:F,onChange:u=>H(u,u?_.map(R=>R.id):[])})]})]}),N&&e.jsx(W,{message:a("chapter.error.label.no_chapter_found")}),V&&e.jsx(W,{message:a("chapter.error.label.no_matches")}),e.jsx(Fr,{topOffset:n+i,style:{height:"undefined"},components:{Footer:()=>e.jsx(Fe,{sx:{paddingBottom:Et}})},totalCount:$.length,itemContent:u=>e.jsx(jr,{...O[u],allChapters:_,showChapterNumber:f.showChapterNumber,onSelect:(R,ee)=>Y(O[u].chapter.id,R,{selectRange:ee})}),useWindowScroll:s,overscan:window.innerHeight*.5})]}),Z]})},Nr=t=>{const[r,a]=m.useState(!1),[n,s]=m.useState(null);return[m.useCallback(async()=>{a(!0),s(null),await Promise.all([E.getMangaFetch(t,{awaitRefetchQueries:!0}).response,E.getMangaChaptersFetch(t,{awaitRefetchQueries:!0}).response]).catch(o=>{o instanceof Xe&&Ut(o.message)==="no chapters found"||s(o)}).finally(()=>a(!1))},[t]),{loading:r,error:n}]};var je={},Or=B;Object.defineProperty(je,"__esModule",{value:!0});var Ve=je.default=void 0,Er=Or(D()),Pr=e;Ve=je.default=(0,Er.default)((0,Pr.jsx)("path",{d:"M21 11V3h-8l3.29 3.29-10 10L3 13v8h8l-3.29-3.29 10-10z"}),"OpenInFull");var ke={},zr=B;Object.defineProperty(ke,"__esModule",{value:!0});var Ge=ke.default=void 0,Vr=zr(D()),Gr=e;Ge=ke.default=(0,Vr.default)((0,Gr.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");const Hr=({manga:t})=>{var g,p;const{t:r}=I(),a=Ye(),n=E.useGetTrackerList(Ze),s=(p=(g=n.data)==null?void 0:g.trackers.nodes)!=null?p:[],i=t.trackRecords.nodes,o=ne.getLoggedIn(s),d=ne.getLoggedIn(ne.getTrackers(i,s)),k=l=>{if(n.error){le(r("tracking.error.label.could_not_load_track_info"),"error");return}if(!o.length){a("/settings/trackingSettings");return}l()};return e.jsx(de,{variant:"dialog",popupId:"manga-track-modal",children:l=>e.jsxs(e.Fragment,{children:[e.jsxs(ce,{...Q(l),size:"medium",disabled:n.loading||!!n.error,onClick:()=>k(l.open),onTouchStart:()=>k(l.open),variant:d.length?"contained":"outlined",children:[d.length?e.jsx(Ge,{}):e.jsx(Xt,{}),d.length?r("manga.button.track.active",{count:d.length}):r("manga.button.track.start")]}),e.jsx(et,{...tt(l),maxWidth:"md",fullWidth:!0,scroll:"paper",children:e.jsx(yt,{manga:t})})]})})},qr=L("div")(({theme:t})=>({display:"flex",flexDirection:"column",gap:t.spacing(2),padding:t.spacing(1),[t.breakpoints.up("md")]:{flexBasis:"40%",height:"calc(100vh - 64px)",overflowY:"auto"}})),Wr=L("div")(()=>({})),Ur=L("div")(({theme:t})=>({display:"flex",paddingBottom:t.spacing(1)})),Kr=L("div")(({theme:t})=>({marginLeft:t.spacing(1)})),q=t=>e.jsx(Mt,{...t}),Qr=L("div")(({theme:t})=>({display:"flex",gap:t.spacing(1)})),Jr=({url:t})=>{const{t:r}=I();return e.jsx(S,{title:r("global.button.open_site"),children:e.jsx(ce,{size:"medium",disabled:!t,component:Yt,href:t!=null?t:void 0,target:"_blank",rel:"noreferrer",variant:"outlined",children:e.jsx(be,{})})})};function Xr(t){var r;return t?(r=t.displayName)!=null?r:t.id:J("global.label.unknown")}function oe(t){return t!=null?t:J("global.label.unknown")}const Yr=({manga:t})=>{const r=ie(),a=rt({variant:"popover",popupId:"manga-thumbnail-fullscreen"});return e.jsxs(e.Fragment,{children:[e.jsxs(j,{sx:{position:"relative","& img":{borderRadius:.5,width:"150px",height:"auto",[r.breakpoints.up("lg")]:{width:"200px"},[r.breakpoints.up("xl")]:{width:"300px"}}},children:[e.jsx($e,{src:K.getThumbnailUrl(t),alt:"Manga Thumbnail",spinnerStyle:{borderRadius:.5,width:"150px",height:"225px",[r.breakpoints.up("lg")]:{width:"200px",height:"300px"},[r.breakpoints.up("xl")]:{width:"300px",height:"450px"}}}),e.jsx(j,{...Q(a),sx:{position:"absolute",top:0,bottom:0,width:"100%",justifyContent:"center",alignItems:"center",opacity:0,"&:hover":{background:"rgba(0, 0, 0, 0.4)",cursor:"pointer",opacity:1}},children:e.jsx(Ve,{fontSize:"large",color:"primary"})})]}),e.jsx(at,{...st(a),sx:{outline:0},children:e.jsx(j,{onClick:()=>a.close(),sx:{height:"100vh",py:2,outline:0,justifyContent:"center",alignItems:"center"},children:e.jsx($e,{src:K.getThumbnailUrl(t),alt:"Manga Thumbnail",imgStyle:{height:"100%",width:"100%",objectFit:"contain"}})})})]})},Zr=75,ea=({manga:{description:t,genre:r}})=>{const[a,n]=nt("isDescriptionGenreCollapsed",!0);return e.jsxs(e.Fragment,{children:[e.jsxs(j,{sx:{position:"relative"},children:[e.jsx(Zt,{collapsedSize:Zr,in:!a,children:e.jsx(G,{style:{whiteSpace:"pre-line",textAlign:"justify",textJustify:"inter-word"},children:t})}),e.jsx(j,{onClick:()=>n(!a),sx:{pt:1,alignItems:"center",cursor:"pointer",position:a?"absolute":null,width:"100%",bottom:0,background:s=>"linear-gradient(transparent 1px, ".concat(s.palette.background.default,")")},children:e.jsx(w,{sx:{color:s=>s.palette.mode==="light"?"black":"text"},children:a?e.jsx(Qt,{}):e.jsx(Jt,{})})})]}),e.jsx(j,{sx:{flexDirection:"row",flexWrap:a?"no-wrap":"wrap",gap:1,overflowX:a?"auto":null},children:r.map(s=>e.jsx(er,{label:s,variant:"outlined"},s))})]})},ta=({manga:t})=>{const{t:r}=I();m.useEffect(()=>{t.source||le(J("source.error.label.source_not_found"),"error")},[t.source]);const{CategorySelectComponent:a,updateLibraryState:n}=wt(t),s=Ae(async()=>{try{await navigator.clipboard.writeText(t.title),le(r("global.label.copied"),"info")}catch(i){}});return e.jsxs(e.Fragment,{children:[e.jsxs(qr,{children:[e.jsxs(Wr,{children:[e.jsxs(Ur,{children:[e.jsx(Yr,{manga:t}),e.jsxs(Kr,{children:[e.jsx(G,{variant:"h5",component:"h2",sx:{mb:1,"@media not (pointer: fine)":{userSelect:"none"}},...s(),children:t.title}),e.jsx(q,{title:r("manga.label.author"),value:oe(t.author)}),e.jsx(q,{title:r("manga.label.artist"),value:oe(t.artist)}),e.jsx(q,{title:r("manga.label.status"),value:oe(t.status)}),e.jsx(q,{title:r("source.title_one"),value:Xr(t.source)})]})]}),e.jsxs(Qr,{children:[e.jsxs(ce,{size:"medium",onClick:n,variant:t.inLibrary?"contained":"outlined",children:[t.inLibrary?e.jsx(Kt,{}):e.jsx(It,{}),t.inLibrary?r("manga.button.in_library"):r("manga.button.add_to_library")]}),e.jsx(Hr,{manga:t}),e.jsx(Jr,{url:t.realUrl})]})]}),e.jsx(ea,{manga:t})]}),a]})},ra=({manga:t,onRefresh:r,refreshing:a})=>{const{t:n}=I(),s=ie(),i=ot(s.breakpoints.up("sm")),[o,d]=lt.useState(null),k=!!o,g=()=>{d(null)},{openCategorySelect:p,CategorySelectComponent:l}=St({mangaId:t.id});return e.jsxs(e.Fragment,{children:[i&&e.jsxs(e.Fragment,{children:[e.jsx(S,{title:n("manga.label.reload_from_source"),children:e.jsx(w,{onClick:()=>{r()},disabled:a,children:e.jsx(we,{})})}),t.inLibrary&&e.jsxs(e.Fragment,{children:[e.jsx(S,{title:n("global.button.migrate"),children:e.jsx(U,{to:"/migrate/source/".concat(t.sourceId,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:e.jsx(w,{children:e.jsx(Ie,{})})})}),e.jsx(S,{title:n("manga.label.edit_categories"),children:e.jsx(w,{onClick:()=>{p(!0)},children:e.jsx(Me,{})})})]})]}),!i&&e.jsxs(e.Fragment,{children:[e.jsx(w,{id:"chaptersMenuButton","aria-controls":k?"chaptersMenu":void 0,"aria-haspopup":"true","aria-expanded":k?"true":void 0,onClick:f=>d(f.currentTarget),children:e.jsx(qt,{})}),e.jsxs(Le,{id:"chaptersMenu",anchorEl:o,open:k,onClose:g,MenuListProps:{"aria-labelledby":"chaptersMenuButton"},children:[e.jsxs(te,{onClick:()=>{r(),g()},disabled:a,children:[e.jsx(re,{children:e.jsx(we,{fontSize:"small"})}),e.jsx(ae,{children:n("manga.label.reload_from_source")})]}),t.inLibrary&&[e.jsxs(te,{component:U,to:"/migrate/source/".concat(t.sourceId,"/manga/").concat(t.id,"/search?query=").concat(t.title),state:{mangaTitle:t.title},style:{textDecoration:"none",color:"inherit"},children:[e.jsx(re,{children:e.jsx(Ie,{fontSize:"small"})}),e.jsx(ae,{children:n("migrate.title")})]},"migrate"),e.jsxs(te,{onClick:()=>{p(!0),g()},children:[e.jsx(re,{children:e.jsx(Me,{fontSize:"small"})}),e.jsx(ae,{children:n("manga.label.edit_categories")})]},"categories")]]})]}),l]})},Ga=()=>{const{t}=I(),{setTitle:r,setAction:a}=m.useContext(it),{id:n}=dt(),s=m.useRef(!1),{data:i,error:o,loading:d,networkStatus:k,refetch:g}=E.useGetManga(ct,n),p=ht(k),l=i==null?void 0:i.manga,[f,{loading:x,error:b}]=Nr(n),c=o!=null?o:b;return m.useEffect(()=>{if(l==null)return;!s.current&&!l.initialized&&(s.current=!0,f())},[l]),m.useEffect(()=>{var h;return r((h=l==null?void 0:l.title)!=null?h:t("manga.title_one")),a(null),()=>{r(""),a(null)}},[t,l==null?void 0:l.title]),m.useEffect(()=>{var h;return a(e.jsxs(j,{direction:"row",sx:{alignItems:"center"},children:[c&&!p&&!x&&e.jsx(S,{title:e.jsxs(e.Fragment,{children:[t("manga.error.label.request_failure"),e.jsx("br",{}),(h=c.message)!=null?h:c]}),children:e.jsx(w,{onClick:()=>g(),children:e.jsx(Ne,{color:"error"})})}),l&&(x||p)&&e.jsx(w,{disabled:!0,children:e.jsx(ut,{size:16})}),l&&e.jsx(ra,{manga:l,onRefresh:f,refreshing:x})]})),()=>{a(null)}},[t,c,p,x,l,f]),c&&!l?e.jsx(W,{message:t("manga.error.label.request_failure"),messageExtra:c.message}):e.jsxs(Fe,{sx:{display:{md:"flex"},overflow:"hidden"},children:[d&&e.jsx(Be,{}),l&&e.jsx(ta,{manga:l}),l&&e.jsx(Ar,{manga:l,isRefreshing:x})]})};export{Ga as Manga};
