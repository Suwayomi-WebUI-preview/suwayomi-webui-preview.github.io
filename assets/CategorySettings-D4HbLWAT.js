var I=Object.freeze,M=Object.defineProperty;var k=(o,l)=>I(M(o,"raw",{value:I(l||o.slice())}));import{u as T,j as e,x as C,T as q,S as U,C as A,I as F,r as p,b as g,i as P,k as W,n as K,q as V,B as O,b4 as Y,m as L,g as y,b5 as z,e as J,f as Q,b6 as X}from"./index-KJngWC4P.js";import{A as Z}from"./Add-0-kj9G_e.js";import{D as $,a as ee,b as te,c as oe,S as re,v as ae,d as se,e as ne}from"./DragHandle-DuVG2y-H.js";import{D as ie,F as le}from"./StyledFab-DcOYkPDD.js";import{E as de}from"./EmptyViewAbsoluteCentered-DVFS0qF1.js";import{E as ce}from"./Edit-Dztqzo45.js";import{D as ge}from"./Delete-CJkQiPPL.js";import{L as me}from"./ListCardContent-Ct4im15q.js";import{C as ue}from"./Card-BMli_BAZ.js";import{u as xe}from"./useAppTitle-DrK6vEjZ.js";import{T as pe}from"./TextField-BtGPrD9J.js";import{F as he,C as fe}from"./Checkbox-CgvaHY7S.js";import"./useFormControl-Ct92ZYaj.js";import"./formControlState-Dq1zat_P.js";import"./SwitchBase-Xv_ULLWe.js";const w=({category:o,onEdit:l})=>{const{t:s}=T(),r=()=>{p.deleteCategory(o.id)};return e.jsx(C,{sx:{p:1,pb:0},children:e.jsx(ue,{children:e.jsxs(me,{sx:{gap:2},children:[e.jsx($,{}),e.jsx(q,{sx:{flexGrow:1},variant:"h6",component:"h2",children:o.name}),e.jsxs(U,{sx:{flexDirection:"row"},children:[e.jsx(A,{title:s("global.button.edit"),children:e.jsx(F,{component:C,onClick:l,children:e.jsx(ce,{})})}),e.jsx(A,{title:s("chapter.action.download.delete.label.action"),children:e.jsx(F,{component:C,onClick:r,children:e.jsx(ge,{})})})]})]})})})},_=-1;var G;const Ce=({category:o,onClose:l})=>{const s=!!o,{t:r}=T(),[n,b]=g.useState(o==null?void 0:o.name),[m,j]=g.useState(!!(o!=null&&o.default)),u=n!==void 0&&!n.trim().length,h=n!==void 0&&!u,D=()=>{if(Y(n),l(),s){p.updateCategory(o.id,{name:n,default:m}).response.catch(i=>L(r("global.error.label.failed_to_save_changes"),"error",y(i)));return}p.createCategory({name:n,default:m}).response.catch(i=>L(r("category.error.label.create_failure"),"error",y(i)))};return e.jsxs(P,{open:!0,onClose:l,children:[e.jsx(W,{id:"form-dialog-title",children:r(s?"category.dialog.title.edit_category_one":"category.dialog.title.new_category")}),e.jsxs(K,{children:[e.jsx(pe,{autoFocus:!0,margin:"dense",id:"name",label:r("category.label.category_name"),type:"text",fullWidth:!0,value:n,onChange:i=>b(i.target.value.trim()),error:u,helperText:u?r(G||(G=k(["global.error.label.invalid_input"]))):void 0}),e.jsx(he,{control:e.jsx(fe,{checked:m,onChange:i=>j(i.target.checked)}),label:r("category.label.use_as_default_category")})]}),e.jsxs(V,{children:[e.jsx(O,{onClick:l,color:"primary",children:r("global.button.cancel")}),e.jsx(O,{onClick:D,color:"primary",disabled:!h,children:r("global.button.submit")})]})]})};function Ge(){const{t:o}=T(),l=ee.useSensorsForDevice();xe(o("category.dialog.title.edit_category_other"));const{data:s,loading:r,error:n,refetch:b}=p.useGetCategories(z,{notifyOnNetworkStatusChange:!0}),[m,{reset:j}]=p.useReorderCategory(),[u,h]=g.useState(_),[D,i]=g.useState(!1),[x,f]=g.useState(null),d=g.useMemo(()=>{var a;const t=[...(a=s==null?void 0:s.categories.nodes)!=null?a:[]];return t.length>0&&t[0].name==="Default"&&t.shift(),t},[s]),R=(t,a,c)=>{const E=t[a];m({variables:{input:{id:E.id,position:c+1}}}).catch(()=>j())},B=t=>{const{active:a,over:c}=t;if(f(null),!c||a.id===c.id)return;const E=d.findIndex(S=>S.id===a.id),H=d.findIndex(S=>S.id===c.id);R(d,E,H)},v=t=>{h(t!=null?t:_),i(!0)},N=()=>{h(_),i(!1)};return r?e.jsx(J,{}):n?e.jsx(de,{message:o("category.error.label.request_failure"),messageExtra:y(n),retry:()=>b().catch(Q())}):e.jsxs(e.Fragment,{children:[e.jsx(te,{sensors:l,collisionDetection:oe,onDragStart:t=>{var a;return f((a=d.find(c=>c.id===t.active.id))!=null?a:null)},onDragEnd:B,onDragCancel:()=>f(null),onDragAbort:()=>f(null),children:e.jsxs(C,{sx:{paddingBottom:ie},children:[e.jsx(re,{items:d,strategy:ae,children:d.map((t,a)=>e.jsx(se,{id:t.id,isDragging:t.id===(x==null?void 0:x.id),children:e.jsx(w,{category:t,onEdit:()=>v(a)})},t.id))}),e.jsx(ne,{isActive:!!x,children:e.jsx(w,{category:x,onEdit:X})})]})}),e.jsx(le,{color:"primary","aria-label":"add",sx:{position:"fixed",bottom:t=>t.spacing(2),right:t=>t.spacing(2)},onClick:()=>v(),children:e.jsx(Z,{})}),D&&e.jsx(Ce,{category:d[u],onClose:N})]})}export{Ge as CategorySettings};
