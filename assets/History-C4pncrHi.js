import{d as s,j as e,_ as h,A as b,L as y,o as w,bm as I,aN as R,u as E,r as L,h as T,i as A,T as G,f as M}from"./index-D2_dCMBF.js";import{E as c}from"./EmptyViewAbsoluteCentered-rO8MR0G-.js";import{V as d,a as P,S,b as O}from"./Virtuoso.util-CnT-c7gx.js";import{C as U,D as k}from"./ChapterCardMetadata-BTA0qdR2.js";import{C as v,a as _}from"./ChapterDownloadButton-Bju-JwKp.js";import{C as F}from"./ChapterDownloadRetryButton-CAQRz5-X.js";import{L as N}from"./ListCardContent-CUni8eKh.js";import{C as B}from"./Card-CKffCtS2.js";import{C as V}from"./CardActionArea-4qMvHVwC.js";import{u as D}from"./useAppTitle-_3PqlVnx.js";import"./MUI.util-DDPpK_AC.js";import"./ListCardAvatar-BTl3PnGb.js";import"./Avatar-ZcbM6Q4Z.js";import"./Download-Bd4eVTbT.js";const K=s.memo(({chapter:t})=>{const{manga:a}=t;return e.jsx(B,{children:e.jsx(V,{component:y,to:b.reader.path(t.manga.id,t.sourceOrder),state:h.getReaderOpenChapterLocationState(t),sx:{color:i=>i.palette.text[t.isRead?"disabled":"primary"]},children:e.jsxs(N,{sx:{justifyContent:"space-between"},children:[e.jsxs(w,{sx:{display:"flex",flexGrow:1,gap:1},children:[e.jsx(v,{mangaId:a.id,mangaTitle:a.title,thumbnailUrl:a.thumbnailUrl,thumbnailUrlLastFetched:a.thumbnailUrlLastFetched}),e.jsx(U,{title:a.title,secondaryText:"".concat(t.name," â€” ").concat(I.format(R(Number(t.lastReadAt)).valueOf()))})]}),e.jsx(k,{chapterId:t.id}),e.jsx(F,{chapterId:t.id}),e.jsx(_,{chapterId:t.id,isDownloaded:t.isDownloaded})]})})})}),oe=()=>{var p;const{t}=E();D(t("history.title"));const{data:a,loading:i,error:l,fetchMore:C,refetch:g}=L.useGetRecentlyReadChapters(void 0,{fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),m=!!(a!=null&&a.chapters.pageInfo.hasNextPage),x=a==null?void 0:a.chapters.pageInfo.endCursor,o=(p=a==null?void 0:a.chapters.nodes)!=null?p:[],n=s.useMemo(()=>Object.entries(h.groupByDate(o,"lastReadAt")),[o]),u=s.useMemo(()=>n.map(r=>r[d.ITEMS].length),[n]),f=d.useCreateGroupedComputeItemKey(u,s.useCallback(r=>n[r][d.GROUP],[n]),s.useCallback(r=>o[r].id,[o])),j=s.useCallback(()=>{m&&C({variables:{offset:o.length}})},[m,x]);return l?e.jsx(c,{message:t("global.error.label.failed_to_load_data"),messageExtra:T(l),retry:()=>g().catch(A())}):!i&&o.length===0?e.jsx(c,{message:t("history.error.label.no_history_available")}):e.jsx(P,{components:{Footer:()=>i?e.jsx(M,{usePadding:!0}):null},overscan:window.innerHeight*.5,endReached:j,groupCounts:u,groupContent:r=>e.jsx(O,{isFirstItem:r===0,children:e.jsx(G,{variant:"h5",component:"h2",children:n[r][d.GROUP]})}),computeItemKey:f,itemContent:r=>e.jsx(S,{children:e.jsx(K,{chapter:o[r]})})})};export{oe as History};
