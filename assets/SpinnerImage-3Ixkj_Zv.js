import{c as M,j as e,b as t,u as K,r as $,S as E,z as U,at as A,aD as _,B as G}from"./index-BODSeEcu.js";import{R as H}from"./Refresh-D5fsx4KL.js";const J=M(e.jsx("path",{d:"M21 5v6.59l-3-3.01-4 4.01-4-4-4 4-3-3.01V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2m-3 6.42 3 3.01V19c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2v-6.58l3 2.99 4-4 4 4z"})),N=M(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"})),Q=(n,l,{ignoreInitialObserve:m=!1,root:f,rootMargin:d,threshold:g}={})=>{const[a,j]=t.useState(()=>{});return t.useLayoutEffect(()=>{const o=n instanceof HTMLElement?n:n==null?void 0:n.current;if(!o)return()=>{};let i=!0;const c=new IntersectionObserver((...I)=>{if(m&&i){i=!1;return}l(...I)},{root:f,rootMargin:d,threshold:g});return c.observe(o),j(()=>()=>c.disconnect()),()=>c.disconnect()},[n,l,m,f,d,g]),a},Z=t.forwardRef((n,l)=>{const{shouldLoad:m=!0,shouldDecode:f,useFetchApi:d,disableCors:g,src:a,alt:j,onLoad:o,onError:i,spinnerStyle:{small:c,...I}={},imgStyle:h,hideImgStyle:R,priority:P,retryKeyPrefix:k}=n,{t:T}=K(),L=t.useRef(null),S=!a.length,[p,V]=t.useState(),[z,q]=t.useState(0),[x,B]=t.useState(),[y,D]=t.useState(!1),[O,F]=t.useState(!1),b=(s,r=!1,C=!1)=>{B(s),D(r),r&&!s&&!C&&(i==null||i()),!s&&!r&&!C&&(o==null||o())};return Q(L,t.useCallback(s=>F(s[0].isIntersecting),[])),t.useEffect(()=>{if(S||!m)return()=>{};const s=$.requestImage(a,{priority:P,shouldDecode:f,useFetchApi:d,disableCors:g});let r;return(async()=>{try{const u=async()=>{const v=await s.response;b(!1),V(v)};if(!!await Promise.race([s.response,new Promise(v=>{r=setTimeout(v,50)})])){await u();return}b(!0),await u()}catch(u){const w=u instanceof Error&&(u.name==="AbortError"||u.message==="Component was unmounted");b(!1,!w,w)}})().catch(()=>{}),()=>{s.cleanup(),clearTimeout(r),s.abortRequest(new Error("Component was unmounted"))}},[a,z,k,S,m]),e.jsxs(e.Fragment,{children:[S?e.jsx(E,{ref:l,sx:{height:"100%",alignItems:"center",justifyContent:"center",background:s=>s.palette.background.default,...I},children:e.jsx(N,{fontSize:"large"})}):e.jsx(U,{component:"img",sx:[...Array.isArray(h)?h!=null?h:[]:[h],A(!p||x||y,{...R,...A(!R,{display:"none"})})],ref:l,crossOrigin:g?void 0:"anonymous",src:p,alt:j,draggable:!1},"".concat(a,"_").concat(z,"_").concat(k)),(x||a&&!p||y)&&e.jsx(E,{ref:L,sx:{height:"100%",justifyContent:"center",alignItems:"center",...I},children:e.jsxs(E,{sx:{height:"100%",alignItems:"center",justifyContent:"center"},children:[O&&(x||a&&!p&&!y)&&e.jsx(_,{thickness:5}),y&&x===!1&&e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsx(G,{startIcon:!c&&e.jsx(H,{}),onClick:s=>{s.stopPropagation(),s.preventDefault(),q(r=>(r+1)%100)},size:c?"small":"large",children:c?e.jsx(H,{}):T("global.button.retry")})]})]})})]})});export{Z as S,Q as u};
