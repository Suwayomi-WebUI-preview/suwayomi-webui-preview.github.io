var gn=Object.defineProperty;var hn=(e,t,r)=>t in e?gn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Ce=(e,t,r)=>hn(e,typeof t!="symbol"?t+"":t,r);import{eu as Mr,f as l,ev as Pt,j as o,o as Yt,b3 as S,q as qt,eq as pn,J as Xe,dP as ut,eb as Kt,b as k,H as Y,T as et,b8 as fn,ew as xn,a7 as mn,a9 as $t,Y as Ye,ae as er,C as $,ex as Dr,e5 as ht,ey as V,G as Je,ek as jr,ez as vn,eA as Oe,k as ct,aD as Sn,dU as Ct,bx as K,dM as de,e as Lr,c1 as at,cF as Nt,dR as W,dS as ue,Q as ze,dv as Cn,cB as Rn,eB as bn,eC as Pn,dw as Tn,a6 as st,eD as ir,b9 as tt,eE as ar,aY as Rt,A as tr,L as Bt,c as Me,u as F,aZ as yr,aq as Nr,ar as Br,ap as bt,cs as Dt,aA as jt,b1 as En,b2 as wn,B as nt,e8 as _n,e6 as cr,e7 as kr,e1 as Zt,e2 as Hr,ea as An,eF as lr,eG as Vr,aC as In,ei as Ne,aw as On,dN as lt,x as zr,I as se,r as Tt,a_ as Mn,a$ as Dn,am as jn,i as kt,ay as Ln,eH as rr,bA as yn,bi as Nn,m as Wr,dO as vt,aB as dr,eI as Bn,cR as kn,bF as Ze,eJ as Hn,eK as Ur,bP as Vn,g as $r,dT as pt,af as Fr,c2 as ur,aX as gr,en as ee,al as zn,eL as Jt,h as Wn,aE as Un,eM as $n,eN as Fn}from"./index-ChwTeEsl.js";import{b as J,R as Gn,a as j,w as he,c as gt,d as qe,e as Ht,g as Le,f as be,i as ge,h as Be,j as dt,k as Qe,l as q,m as H,n as hr,o as le,p as Xn,q as Et,r as Yn,s as qn,t as Kn,v as Zn,x as Gr,y as Xr,z as rt,A as Yr,S as Jn,B as Qn,C as Vt,D as Ge,E as wt,F as He,G as nr,H as es,I as ts,J as rs,K as ns,L as qr,M as ss,N as os,O as Kr,P as is,Q as Ve,T as as,U as pr,V as ft,W as cs,X as ls,Y as ds,Z as us,_ as Zr,$ as Jr,a0 as gs,a1 as hs,a2 as ps,a3 as fs,a4 as fr,a5 as xs,a6 as ms,a7 as Ft,a8 as vs}from"./ReaderSettingsTabs-DntodN6J.js";import{r as Ss}from"./Strings-CAV0u705.js";import{a as ke,C as Qt,F as St}from"./Chapters-BwBqMYka.js";import{P as Cs}from"./PushPin-DyyShaLh.js";import{P as Rs}from"./PushPinOutlined-Cxv09dy2.js";import{L as Mt}from"./Link-DtbzDdqv.js";import{S as Qr}from"./Select-BiRIFvBo.js";import{C as en,u as bs,F as Ps,M as Ts,f as Es,l as ws}from"./useManageMangaLibraryState-zzAYYcTZ.js";import{q as _s}from"./index-CdVEoZjK.js";import{C as As,B as Is,I as Os}from"./ChapterListCard-CB8nOu2M.js";import{D as Ms}from"./Download-C0R_0IrW.js";import{D as Ds}from"./Delete-C5iuW7Iy.js";import{D as js}from"./ChapterCardMetadata-8Ule_n4A.js";import{F as Ls,I as ys}from"./IconWebView-DNfg_3fR.js";import{F as sr}from"./Mangas-BAjrFXCq.js";import{C as Ns}from"./CheckboxInput-C_VIPzi0.js";import{E as Lt}from"./EmptyViewAbsoluteCentered-4lF644jt.js";import{u as Bs}from"./SpinnerImage-CwT1u4HC.js";import{u as ks}from"./use-window-event-CryiE2c1.js";import{u as Hs}from"./use-merged-ref-INOskFtG.js";import{u as Vs}from"./useAppTitle-xKXAeTff.js";import"./TabsMenu-Cb-vMwYR.js";import"./Tabs-BIJQ7TcH.js";import"./Slider-BM2C_8xC.js";import"./ListSubheader-CE7T6ljJ.js";import"./Add-BKLBqsiu.js";import"./DateHelper-DvpN-8Cc.js";import"./Asserts-xItX73wb.js";import"./ThreeStateCheckboxInput-CWRS5pCy.js";import"./Checkbox-17FoHUyn.js";import"./SwitchBase-Mtty64yA.js";import"./FormGroup-D9_edYBz.js";import"./DoneAll-C5KH_ntu.js";import"./MUI.util-CEodEA2f.js";import"./ListCardContent-GlBMZ9iP.js";import"./Card-CECL5VZ1.js";import"./CardActionArea-PScuToxd.js";import"./Refresh-Dbei6tGH.js";import"./Image-fpz9takm.js";const zs=e=>{const{activeScopes:t,enableScope:r,disableScope:n}=Mr(),s=l.useRef([]);l.useEffect(()=>e?(s.current=[...t],r(Pt.NONE),s.current.forEach(n),()=>{n(Pt.NONE),s.current.forEach(r)}):()=>{},[e])},Ws=({isOpen:e,close:t})=>{const r=J(c=>c);zs(e);const[n,s]=l.useState(0),[i,a]=l.useState(!1);return e?o.jsx(Yt,{open:e,maxWidth:"md",fullWidth:!0,onClose:t,hideBackdrop:n===pn.FILTER,sx:{...S(i,{opacity:.75})},children:o.jsx(qt,{sx:{p:0},children:o.jsx(Gn,{activeTab:n,setActiveTab:s,settings:r,updateSetting:(...c)=>j.updateSetting(...c),deleteSetting:(...c)=>j.deleteSetting(...c),setTransparent:a})})}):null},Us=({isDesktop:e,readerNavBarWidth:t})=>{const r=gt(d=>d),{currentPageIndex:n,pages:s,totalPages:i}=qe(d=>({currentPageIndex:d.currentPageIndex,pages:d.pages,totalPages:d.totalPages})),{readingDirection:a,shouldShowPageNumber:c,progressBarType:g}=J(d=>({readingDirection:d.readingDirection.value,shouldShowPageNumber:d.shouldShowPageNumber,progressBarType:d.progressBarType})),h=Ht(d=>d.isMaximized),x=l.useMemo(()=>{const d=Le(n,s).name,u="/",p="".concat(d).concat(u).concat(i);return a===ut.LTR?p:Ss(p,u)},[n,s,i,a]);return!c||h||e&&g===Kt.STANDARD||h&&g===Kt.HIDDEN?null:o.jsx(k,{sx:{position:"fixed",left:t,right:0,bottom:d=>"max(calc(".concat(d.spacing(1)," + ").concat(r.xSize,"px), env(safe-area-inset-bottom))"),alignItems:"center",transition:d=>"left 0.".concat(d.transitions.duration.shortest,"s")},children:o.jsx(Y,{sx:{p:.5,borderRadius:1,backgroundColor:"rgba(0, 0, 0, 0.3)"},children:o.jsx(et,{sx:{color:"white"},children:x})})})},$s=he(Us,[j.useOverlayMode,Xe],["isDesktop","readerNavBarWidth"]);function xr(e){return e.substring(2).toLowerCase()}function Fs(e,t){return t.documentElement.clientWidth<e.clientX||t.documentElement.clientHeight<e.clientY}function Gs(e){const{children:t,disableReactTree:r=!1,mouseEvent:n="onClick",onClickAway:s,touchEvent:i="onTouchEnd"}=e,a=l.useRef(!1),c=l.useRef(null),g=l.useRef(!1),h=l.useRef(!1);l.useEffect(()=>(setTimeout(()=>{g.current=!0},0),()=>{g.current=!1}),[]);const x=fn(xn(t),c),d=mn(f=>{const C=h.current;h.current=!1;const m=$t(c.current);if(!g.current||!c.current||"clientX"in f&&Fs(f,m))return;if(a.current){a.current=!1;return}let v;f.composedPath?v=f.composedPath().includes(c.current):v=!m.documentElement.contains(f.target)||c.current.contains(f.target),!v&&(r||!C)&&s(f)}),u=f=>C=>{h.current=!0;const m=t.props[f];m&&m(C)},p={ref:x};return i!==!1&&(p[i]=u(i)),l.useEffect(()=>{if(i!==!1){const f=xr(i),C=$t(c.current),m=()=>{a.current=!0};return C.addEventListener(f,d),C.addEventListener("touchmove",m),()=>{C.removeEventListener(f,d),C.removeEventListener("touchmove",m)}}},[d,i]),n!==!1&&(p[n]=u(n)),l.useEffect(()=>{if(n!==!1){const f=xr(n),C=$t(c.current);return C.addEventListener(f,d),()=>{C.removeEventListener(f,d)}}},[d,n]),l.cloneElement(t,p)}const mr=Ye(et)({boxSizing:"content-box",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",textAlign:"center",userSelect:"none",cursor:"pointer",WebkitTapHighlightColor:"transparent"}),Xs=Ye(k,{shouldForwardProp:er(["progressBarPosition"])})(({theme:e,progressBarPosition:t})=>({position:"fixed",pointerEvents:"all",touchAction:"none",...S(be(t).isHorizontal,{justifyContent:"flex-end",bottom:0,right:0}),...S(be(t).isVertical,{top:0,bottom:0}),...S(be(t).isLeft,{alignItems:e.direction==="ltr"?"flex-start":"flex-end"}),...S(be(t).isRight,{alignItems:e.direction==="ltr"?"flex-end":"flex-start"}),WebkitTapHighlightColor:"transparent"})),Ys=Ye(k)(({theme:e})=>({flexDirection:"row",justifyContent:"center",alignItems:"center",gap:e.spacing(.5)})),qs=Ye(k)({flexDirection:"row",flexGrow:1,overflow:"hidden"}),Ks=Ye(Y,{shouldForwardProp:er(["currentPagesIndex","pagesLength","progressBarPosition"])})(({currentPagesIndex:e,pagesLength:t,progressBarPosition:r})=>({position:"absolute",pointerEvents:"none",...S(be(r).isHorizontal,{left:0,width:"".concat((e+1)/t*100,"%"),height:"100%"}),...S(be(r).isVertical,{top:0,width:"100%",height:"".concat((e+1)/t*100,"%")})})),Zs=({pageName:e,currentPagesIndex:t,pagesLength:r,isDragging:n,boxProps:s,children:i,progressBarPosition:a})=>o.jsx($,{title:e,slotProps:{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}},placement:Dr[a],disableTouchListener:!0,children:o.jsx(Y,{...s,sx:{position:"absolute",cursor:n?"grabbing":"grab",...S(be(a).isHorizontal,{left:"".concat(Math.max(0,t-1)/(r-1)*100,"%"),width:"calc(100% / ".concat(r-1,")"),height:"100%"}),...S(be(a).isVertical,{top:"".concat(Math.max(0,t-1)/(r-1)*100,"%"),width:"100%",height:"calc(100% / ".concat(r-1,")")}),...s==null?void 0:s.sx},children:i})}),Js=Ye(k)({position:"relative",flexDirection:"row",flexGrow:1}),Qs={[ht.EDGE]:[{rect:[0,0,100,33.33],type:V.NEXT},{rect:[0,33.33,33.33,66.66],type:V.NEXT},{rect:[66.66,33.33,33.33,66.66],type:V.NEXT},{rect:[33.33,33.33,33.33,33.33],type:V.MENU},{rect:[33.33,66.66,33.33,33.33],type:V.PREVIOUS}],[ht.KINDLE]:[{rect:[0,0,100,33.33],type:V.MENU},{rect:[0,33.33,33.33,66.66],type:V.PREVIOUS},{rect:[33.33,33.33,66.66,66.66],type:V.NEXT}],[ht.L_SHAPE]:[{rect:[0,0,100,33.33],type:V.PREVIOUS},{rect:[0,33.33,33.33,33.33],type:V.PREVIOUS},{rect:[33.33,33.33,33.33,33.33],type:V.MENU},{rect:[66.66,33.33,33.33,33.33],type:V.NEXT},{rect:[0,66.66,100,33.33],type:V.NEXT}],[ht.RIGHT_LEFT]:[{rect:[0,0,33.33,100],type:V.PREVIOUS},{rect:[33.33,0,33.33,100],type:V.MENU},{rect:[66.66,0,33.33,100],type:V.NEXT}],[ht.DISABLED]:[{rect:[0,0,100,100],type:V.MENU}]},eo={[V.PREVIOUS]:{text:{id:"DHhJ7s"},color:"rgba(255, 114, 118, .5)"},[V.NEXT]:{text:{id:"hXzOVo"},color:"rgba(144, 238, 144, .5)"},[V.MENU]:{text:{id:"zucql+"},color:"rgba(0, 0, 0, .5)"}};class Re{static invertRect(t,{vertical:r,horizontal:n,isRTL:s}){const i=r?this.invertVertical(t):t,a=n?this.invertHorizontal(i):i;return s?this.invertHorizontal(a):a}static getRegions(t,r){return Qs[t].map(({type:s,rect:i})=>({type:s,rect:this.invertRect(i,r)}))}static isCanvasReusable(t,r,n,s,i){var p;const a=this.layout===t,c=this.width===r,g=this.height===n,h=!!this.canvas,x=this.language===Je.locale,d=((p=this.invertMode)==null?void 0:p.vertical)===i.vertical&&this.invertMode.horizontal===i.horizontal&&this.invertMode.isRTL===i.isRTL,u=this.fontStyle===s;return h&&c&&g&&a&&x&&d&&u}static drawCanvas(t,r,n,s,i){i.forEach(({type:a,rect:[c,g,h,x]})=>{const{text:d,color:u}=eo[a],p=Je._(d),f=(R,A)=>R/100*A,C=f(c,r),m=f(g,n),v=f(h,r),E=f(x,n),b=(R,A)=>(R+A)*.5+R*.5,w=b(C,v),T=b(m,E);t.beginPath(),t.rect(C,m,v,E),t.fillStyle=u,t.strokeStyle=u,t.lineWidth=.1,t.stroke(),t.fill(),t.strokeStyle="black",t.textAlign="center",t.textBaseline="middle",t.font="".concat(s.fontSize," ").concat(s.fontFamily),t.strokeStyle="black",t.lineWidth=3,t.strokeText(p,w,T),t.lineWidth=1,t.fillStyle="white",t.fillText(p,w,T)})}static getOrCreateCanvas(t,r,n,s,i){if(this.isCanvasReusable(t,r,n,s,i))return this.canvas;const a=document.createElement("canvas"),c=a.getContext("2d");c.canvas.width=r,c.canvas.height=n;const g=this.getRegions(t,i);return this.drawCanvas(c,r,n,s,g),this.layout=t,this.canvas=a,this.width=r,this.height=n,this.language=Je.locale,this.invertMode=i,this.regions=g,this.fontStyle=s,a}static doesRegionContainPos(t,r,n){const[s,i,a,c]=t.rect;return r>=s&&r<=s+a&&n>=i&&n<=i+c}static getAction(t,r){var a;const n=t/this.width*100,s=r/this.height*100,i=(a=this.regions)==null?void 0:a.find(c=>this.doesRegionContainPos(c,n,s));return i?i.type:V.MENU}}Ce(Re,"layout",null),Ce(Re,"canvas",null),Ce(Re,"width",null),Ce(Re,"height",null),Ce(Re,"language",null),Ce(Re,"invertMode",null),Ce(Re,"regions",null),Ce(Re,"fontStyle",null),Ce(Re,"invertVertical",([t,r,n,s])=>[t,100-(r+s),n,s]),Ce(Re,"invertHorizontal",([t,r,n,s])=>[100-(t+n),r,n,s]);const to=(e,t,r)=>{if(e===Oe.X){if(t===ue.BACKWARD)return r==="ltr"?-1:1;if(t===ue.FORWARD)return r==="ltr"?1:-1}return t===ue.BACKWARD?-1:1},xe=class xe{static scroll(t,r,n,s,i,a=jr.LARGE){if(!i)return;const c=Ct[s],g=vn().direction===c,h=ge(n),x=Math.abs(i.scrollTop)<=1,d=Math.floor(i.scrollTop)===i.scrollHeight-i.clientHeight||Math.ceil(i.scrollTop)===i.scrollHeight-i.clientHeight,u=Math.abs(i.scrollLeft)<=1,p=i.scrollWidth-i.clientWidth-Math.floor(Math.abs(i.scrollLeft))<=1||i.scrollWidth-i.clientWidth-Math.ceil(Math.abs(i.scrollLeft))<=1,f=g?u:p,C=g?p:u,m=a/100,v=to(r,t,c),E=(w,T)=>w+T*m*v;Be().setIsVisible(!1),dt().setShowPreview(!1);const b=(w,T,R)=>{if(w&&t===ue.BACKWARD&&h){xe.openChapter("previous");return}if(T&&t===ue.FORWARD&&h){xe.openChapter("next");return}i.scroll({...R,behavior:"smooth"})};switch(r){case Oe.X:b(f,C,{left:E(i.scrollLeft,i.clientWidth)});break;case Oe.Y:b(x,d,{top:E(i.scrollTop,i.clientHeight)});break;default:throw new Error('Unexpected "ScrollDirection" ('.concat(r,")"))}}static openChapter(t,r=!0,n=!0){const{currentChapter:s,previousChapter:i,nextChapter:a,chapters:c,visibleChapters:{lastLeadingChapterSourceOrder:g,lastTrailingChapterSourceOrder:h},setReaderStateChapters:x}=Qe(),{shouldInformAboutMissingChapter:d,shouldInformAboutScanlatorChange:u,shouldUseInfiniteScroll:p}=q();if(!s)return;const f=typeof t=="number",C=t==="previous";if(!(f||C&&!!i||!C&&!!a))return;(async()=>{const w=f?c.find(R=>R.id===t):C?i:a;if(!w)return;const T=w.sourceOrder<s.sourceOrder;try{r&&await xe.checkNextChapterConsistency(T?"previous":"next",s,w,d,u);const R=g<=w.sourceOrder&&h>=w.sourceOrder,A=p&&(!n||R);A&&x(P=>Kn(T,P,w.sourceOrder,n,T?!1:void 0,T?void 0:!1)),j.navigateToChapter(w,{resumeMode:Zn(f||!A,T),updateInitialChapter:!A})}catch(R){ct("ReaderControls#useOpenChapter#doOpenChapter:")(R)}})().catch(ct("ReaderControls#useOpenChapter"))}static async checkNextChapterConsistency(t,r,n,s,i){if(!r||!n)return;const a=ke.getGap(r,n),c=!i||r.scanlator===n.scanlator,g=!s||!a;if(!(!c||!g))return;const x={previous:{scanlator:{id:"dDQ7od"},chapter_number:{id:"P0p2jp"}},next:{scanlator:{id:"AwNAqo"},chapter_number:{id:"jN+b67"}}},d=c?"":Je.t({...x[t].scanlator,values:{nextScanlator:n.scanlator,currentScanlator:r.scanlator}}),u=g?"":Je.t({...x[t].chapter_number,values:{count:a,nextChapter:"#".concat(n.chapterNumber," ").concat(n.name),currentChapter:"#".concat(r.chapterNumber," ").concat(r.name)}}),p=!c&&!g?"\n\n":"",f="".concat(d).concat(p).concat(u);await Sn.show({title:Je._({id:"Mx1mqC"}),message:f,actions:{confirm:{title:Je._({id:"1TNIig"})}}})}static openPage(t,r,n=!0){const{currentPageIndex:s,setPageToScrollToIndex:i,pages:a,transitionPageMode:c,setTransitionPageMode:g}=H(),{readingDirection:h,readingMode:x,shouldShowTransitionPage:d}=q(),u=Ct[h.value],p=K(t,t==="previous"?"next":"previous",r!=null?r:u),f=Le(s,a),C=hr("previous",f.pagesIndex,a),m=hr("next",f.pagesIndex,a),v=le(a[0]),E=le(a[a.length-1]),b=f.primary.index===0,w=s===E,T=Xn(c,x.value),R=ge(x.value);n&&(Be().setIsVisible(!1),dt().setShowPreview(!1));const A=()=>g(de.NONE);if(typeof t=="number"){i(t),A();return}const P=R&&T,_=!R&&c===de.PREVIOUS||P,B=!R&&c===de.NEXT||P;if(b&&(!d||_)&&p==="previous"&&!!Qe().previousChapter){xe.openChapter("previous");return}if(w&&(!d||B)&&p==="next"&&!!Qe().nextChapter){xe.openChapter("next");return}const O=p==="previous",G=p==="next";if(T&&!R&&(_&&G||B&&O)){A(),i(_?v:E);return}if((b&&O||w&&G)&&!R){g(O?de.PREVIOUS:de.NEXT);return}i(O?C:m)}static useUpdateCurrentPageIndex(){const t=j.useUpdateChapter(),{settings:{downloadAheadLimit:r}}=Lr();return l.useCallback((n,s=!0,i=!1)=>{const{currentPageIndex:a,setCurrentPageIndex:c}=H(),{currentChapter:g,chapters:h,previousChapter:x,nextChapter:d,visibleChapters:u}=Qe();if(n===a&&!i||(c(n),!g))return;const p=ke.getNextChapters(g,h,{offset:at.NEXT}),f=a>n?at.PREVIOUS:at.NEXT;j.downloadAhead(g,d,p,n,r),j.preloadChapter(n,g.pageCount,f===at.NEXT?d:x,u.lastLeadingChapterSourceOrder,u.lastTrailingChapterSourceOrder,f);const C=()=>{const m=Gr(g.id);if(!m)return;const v=i?m.pageCount-1:n,E=v===m.pageCount-1;t({lastPageRead:v,isRead:E?!0:void 0})};if(clearTimeout(xe.updateCurrentPageTimeout),s){xe.updateCurrentPageTimeout=setTimeout(C,Nt(1).seconds.inWholeMilliseconds);return}C()},[r])}static updateCurrentPageOnScroll(t,r,n,s,i){var u,p,f,C;const a=Ct[i],c=(f=(p=(u=Et().autoScroll.scrollRef)==null?void 0:u.current)==null?void 0:p.getBoundingClientRect().x)!=null?f:0,g=K(c+1,window.innerWidth+1,a),h=t.current.findIndex(m=>m&&Yn(m,s,{truncateValues:!0,thresholds:{bottom:1,left:K(0,g,a),right:K(g,0,a)}})),x=(C=t.current)==null?void 0:C[t.current.length-1],d=x&&qn(x,s,i);if(h!==-1){if(d){n(h,!1,!0);return}n(h,h!==r)}}static handleClick(t,r){if(!t)return;const{readingMode:n,readingDirection:s,isStaticNav:i,scrollAmount:a}=q(),c=r.currentTarget.getBoundingClientRect(),g=r.clientX-c.left,h=r.clientY-c.top,x=Re.getAction(g,h);dt().setShowPreview(!1);const d=ge(n.value),u=n.value===W.CONTINUOUS_HORIZONTAL?Oe.X:Oe.Y;switch(x){case V.MENU:Be().setIsVisible(i||!Be().isVisible);break;case V.PREVIOUS:case V.NEXT:d?xe.scroll(x===V.PREVIOUS?ue.BACKWARD:ue.FORWARD,u,n.value,s.value,t,a):xe.openPage(x===V.PREVIOUS?"previous":"next","ltr");break;default:throw new Error('Unexpected "TapZoneRegionType" ('.concat(x,")"))}}static useHandleProgressDragging(t,r,n,s,i,a,c){l.useEffect(()=>{if(!r)return()=>{};const{isHorizontal:g}=be(i),h=u=>{if(!t.current)return;const p=le(Xr(u,t.current,s,g,c,a));le(n)!==p&&xe.openPage(p,void 0,!1)},x=u=>{h(u)},d=u=>{u.touches.length>0&&h(u.touches[0])};return document.addEventListener("mousemove",x,{passive:!0}),document.addEventListener("touchmove",d,{passive:!0}),()=>{document.removeEventListener("mousemove",x),document.removeEventListener("touchmove",d)}},[r,n,s,i])}};Ce(xe,"updateCurrentPageTimeout");let z=xe;const ro=l.memo(Ye(Y,{shouldForwardProp:er(["isFirstPage","isLastPage"])})(({isFirstPage:e,isLastPage:t})=>({flexGrow:1,height:"100%",cursor:"pointer",borderLeftWidth:e?0:void 0,borderRightWidth:t?0:void 0}))),no=l.memo(({page:e,pagesIndex:t,isCurrentPage:r,isLeadingPage:n,isTrailingPage:s,totalPages:i,showDraggingStyle:a,primaryPageLoadState:c,secondaryPageLoadState:g,createProgressBarSlot:h,...x})=>{const d=l.useMemo(()=>h(e,t,c,g,r,n,s,i,a),[h,e,t,c,g,r,n,s,i,a]);return o.jsx(ro,{...x,isFirstPage:t===0,isLastPage:t===i-1,children:d})}),so=({slotProps:e,slots:t,createProgressBarSlot:r,progressBarPosition:n,direction:s,fullSegmentClicks:i})=>{var A,P,_,B,y,M,O,G,me,oe,ie,X,L,Pe,Te,ve,ae,Se,pe,De,Z,We,ye,Ue,I,Ee,Q,U,je,we,$e,_e;const{pages:a,pageLoadStates:c,totalPages:g,currentPageIndex:h}=qe(N=>({pages:N.pages,pageLoadStates:N.pageLoadStates,totalPages:N.totalPages,currentPageIndex:N.currentPageIndex})),x=J(N=>N.readingMode.value),d=Ht(N=>N.isDragging),u=l.useRef(null),p=l.useRef(void 0),[f,C]=l.useState(0),m=l.useRef(null);ze(m,l.useCallback(()=>{const N=m.current;if(!N)return;const{paddingLeft:fe,paddingRight:Fe}=getComputedStyle(N),Ae=6,Ie=N.clientWidth-parseFloat(fe)-parseFloat(Fe),ot=x===W.DOUBLE_PAGE?Ie*2+Ae:Ie;C(ot)},[x]));const v=l.useMemo(()=>Le(h,a).pagesIndex,[h,a]),E=be(n).isHorizontal,b=l.useMemo(()=>Le(h,a),[h,a]),w=l.useCallback((...N)=>K(N[0],N[1],s),[s]);z.useHandleProgressDragging(u,d,b,a,n,w,i);const T=N=>{if(!u.current)return;const fe="touches"in N;z.openPage(le(Xr(fe?N.touches[0]:N,u.current,a,E,i,w)),void 0,!1),clearTimeout(p.current),p.current=setTimeout(()=>rt().setIsDragging(!0),250)},R=()=>{rt().setIsDragging(!1),clearTimeout(p.current)};return o.jsx(Xs,{...e==null?void 0:e.container,progressBarPosition:n,children:o.jsxs(Ys,{...e==null?void 0:e.progressBarRoot,children:[o.jsx(mr,{...(A=e==null?void 0:e.progressBarPageTexts)==null?void 0:A.base,...(P=e==null?void 0:e.progressBarPageTexts)==null?void 0:P.current,sx:[{width:"".concat(f,"px")},...Array.isArray((B=(_=e==null?void 0:e.progressBarPageTexts)==null?void 0:_.base)==null?void 0:B.sx)?(O=(M=(y=e==null?void 0:e.progressBarPageTexts)==null?void 0:y.base)==null?void 0:M.sx)!=null?O:[]:[(me=(G=e==null?void 0:e.progressBarPageTexts)==null?void 0:G.base)==null?void 0:me.sx],...Array.isArray((ie=(oe=e==null?void 0:e.progressBarPageTexts)==null?void 0:oe.current)==null?void 0:ie.sx)?(Pe=(L=(X=e==null?void 0:e.progressBarPageTexts)==null?void 0:X.current)==null?void 0:L.sx)!=null?Pe:[]:[(ve=(Te=e==null?void 0:e.progressBarPageTexts)==null?void 0:Te.current)==null?void 0:ve.sx]],onClick:()=>z.openPage("previous","ltr",!1),children:b.name}),o.jsx(Gs,{onClickAway:()=>rt().setIsDragging(!1),children:o.jsxs(Js,{...e==null?void 0:e.progressBarSlotsActionArea,onMouseDown:T,onMouseUp:R,onTouchStart:T,onTouchEnd:R,children:[o.jsxs(qs,{ref:u,...e==null?void 0:e.progressBarSlotsContainer,children:[a.map((N,fe)=>l.createElement(no,{...e==null?void 0:e.progressBarSlot,key:N.primary.index,page:N,pagesIndex:fe,isCurrentPage:fe===v,isLeadingPage:fe<v,isTrailingPage:fe>v,totalPages:a.length,primaryPageLoadState:c[N.primary.index].loaded,secondaryPageLoadState:N.secondary?c[N.secondary.index].loaded:void 0,createProgressBarSlot:r,showDraggingStyle:fe===v&&d})),o.jsx(Ks,{...e==null?void 0:e.progressBarReadPages,currentPagesIndex:b.pagesIndex,pagesLength:a.length,progressBarPosition:n})]}),o.jsx(Zs,{boxProps:e==null?void 0:e.progressBarCurrentPageSlot,pageName:b.name,currentPagesIndex:b.pagesIndex,pagesLength:a.length,isDragging:d,progressBarPosition:n,children:t==null?void 0:t.progressBarCurrentPage})]})}),o.jsx(mr,{ref:m,...(ae=e==null?void 0:e.progressBarPageTexts)==null?void 0:ae.base,...(Se=e==null?void 0:e.progressBarPageTexts)==null?void 0:Se.total,sx:[{minWidth:"unset"},...Array.isArray((De=(pe=e==null?void 0:e.progressBarPageTexts)==null?void 0:pe.base)==null?void 0:De.sx)?(ye=(We=(Z=e==null?void 0:e.progressBarPageTexts)==null?void 0:Z.base)==null?void 0:We.sx)!=null?ye:[]:[(I=(Ue=e==null?void 0:e.progressBarPageTexts)==null?void 0:Ue.base)==null?void 0:I.sx],...Array.isArray((Q=(Ee=e==null?void 0:e.progressBarPageTexts)==null?void 0:Ee.total)==null?void 0:Q.sx)?(we=(je=(U=e==null?void 0:e.progressBarPageTexts)==null?void 0:U.total)==null?void 0:je.sx)!=null?we:[]:[(_e=($e=e==null?void 0:e.progressBarPageTexts)==null?void 0:$e.total)==null?void 0:_e.sx]],onClick:()=>z.openPage("next","ltr",!1),children:g})]})})},tn=l.memo(so),oo=({direction:e,...t})=>{const{settings:{customThemes:r,appTheme:n,themeMode:s,shouldUsePureBlackMode:i}}=Lr(),a=l.useMemo(()=>Cn(s,Rn(n,r),i,e),[s,n,r,i,e]);return o.jsx(bn,{value:Pn[e],children:o.jsx(Tn,{theme:a,children:o.jsx(Y,{...t,dir:e})})})},rn=he(oo,[()=>({direction:j.useGetThemeDirection()})],["direction"]),nn=l.memo(({pageName:e,progressBarPosition:t,slotProps:r,children:n})=>{var s;return o.jsx($,{...r==null?void 0:r.tooltip,title:e,placement:Dr[t],disableTouchListener:!0,children:o.jsx(Y,{...r==null?void 0:r.box,sx:{width:"100%",height:"100%",...(s=r==null?void 0:r.box)==null?void 0:s.sx},children:n})})}),io=l.memo(({pageName:e,primaryPageLoadState:t,secondaryPageLoadState:r,progressBarPosition:n,isCurrentPage:s,isLeadingPage:i,showDraggingStyle:a})=>{const c=st();return o.jsx(nn,{pageName:e,progressBarPosition:n,slotProps:{box:{sx:{cursor:"pointer",backgroundColor:ir(c.palette.background.paper,.2),...c.applyStyles("dark",{backgroundColor:ar(c.palette.background.paper,.1)}),...S(t&&(r==null||r),{backgroundColor:ir(c.palette.background.paper,.35),...c.applyStyles("dark",{backgroundColor:ar(c.palette.background.paper,.25)})})}},tooltip:{slotProps:s?{tooltip:{sx:{backgroundColor:"primary.main",color:"primary.contrastText"}}}:void 0}},children:o.jsx(Y,{sx:{width:"100%",height:"100%",...S(i,{backgroundColor:tt(c.palette.primary.main,.5)}),...S(s,{cursor:a?"grabbing":"grab",pointer:"grabbing",borderRadius:2,backgroundColor:"primary.dark",...c.applyStyles("dark",{backgroundColor:"primary.light"})})}})})}),ao=({readerNavBarWidth:e,readerDirection:t})=>{const r=st(),n=gt(T=>T),s=qe(T=>T.totalPages),{progressBarType:i,progressBarSize:a,progressBarPosition:c,progressBarPositionAutoVertical:g}=J(T=>({progressBarType:T.progressBarType,progressBarSize:T.progressBarSize,progressBarPosition:T.progressBarPosition,progressBarPositionAutoVertical:T.progressBarPositionAutoVertical})),{isMaximized:h,isDragging:x}=Ht(T=>({isMaximized:T.isMaximized,isDragging:T.isDragging})),[,d]=l.useState({});ze(window.document.documentElement,l.useCallback(()=>d({}),[]));const u=Yr(c,g,n.ySize,e+n.xSize),{isBottom:p,isLeft:f,isRight:C,isVertical:m,isHorizontal:v}=be(u),E=!!s,b=i===Kt.HIDDEN,w=!h&&!x;return o.jsx(rn,{children:o.jsx(tn,{direction:v?t:"ltr",progressBarPosition:u,fullSegmentClicks:!0,createProgressBarSlot:l.useCallback((T,R,A,P,_,B,y,M,O)=>o.jsx(io,{pageName:T.name,primaryPageLoadState:A,secondaryPageLoadState:P,progressBarPosition:u,isCurrentPage:_,isLeadingPage:B,showDraggingStyle:O}),[u]),slotProps:{container:{sx:{overflow:"hidden",transition:"all 0.".concat(r.transitions.duration.shortest,"s"),...S(v,{minHeight:"100px",...S(r.direction==="ltr",{left:t==="ltr"?e:n.ySize,right:t==="rtl"?e:n.ySize}),...S(r.direction==="rtl",{left:t==="rtl"?e:n.ySize,right:t==="ltr"?e:n.ySize})}),...S(m,{minWidth:"100px",bottom:"".concat(n.xSize,"px")}),...S(p,{bottom:"".concat(n.xSize,"px")}),...S(f,{...S(r.direction==="ltr",{left:t==="ltr"?e:"unset",right:t==="rtl"?e:"unset"}),...S(r.direction==="rtl",{right:t==="rtl"?n.ySize:"unset",left:t==="ltr"?n.ySize:"unset"})}),...S(C,{...S(r.direction==="ltr",{right:t==="ltr"?n.ySize:"unset",left:t==="rtl"?n.ySize:"unset"}),...S(r.direction==="rtl",{left:t==="rtl"?e:"unset",right:t==="ltr"?e:"unset"})}),...S(w,{opacity:b?0:.85}),...S(!E,{pointerEvents:"none"})},onMouseEnter:()=>rt().setIsMaximized(!0),onMouseLeave:()=>rt().setIsMaximized(!1)},progressBarRoot:{sx:{gap:0,transition:"all 0.1s ease-in-out",backgroundColor:"background.paper",...S(m,{flexDirection:"column",height:"100%"}),...S(w,{backgroundColor:"unset",pointerEvents:"none",...S(v,{px:2}),...S(m,{py:2}),...S(p,{pb:.25}),...S(f,{...S(r.direction==="ltr",{pl:t==="ltr"?.25:0,pr:t==="rtl"?.25:0}),...S(r.direction==="rtl",{pr:t==="rtl"?.25:0,pl:t==="ltr"?.25:0})}),...S(C,{...S(r.direction==="ltr",{pr:t==="ltr"?.25:0,pl:t==="rtl"?.25:0}),...S(r.direction==="rtl",{pl:t==="rtl"?.25:0,pr:t==="ltr"?.25:0})})})}},progressBarSlotsContainer:{sx:{gap:.25,borderRadius:2,transition:"height 0.1s ease-in-out",...S(v,{height:"20px"}),...S(m,{flexDirection:"column",width:"20px"}),...S(w,{...S(v,{height:"".concat(a,"px")}),...S(m,{width:"".concat(a,"px")})})}},progressBarReadPages:{sx:{display:"none"}},progressBarCurrentPageSlot:{sx:{display:"none"}},progressBarPageTexts:{base:{sx:{px:1,py:1.5,transition:"all 0.1s ease-in-out",...S(w,{transform:"scale(0)",p:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0})}}}}})})},co=he(l.memo(ao),[Xe,()=>({readerDirection:j.useGetThemeDirection()})],["readerNavBarWidth","readerDirection"]),lo=Ye(k)({width:"400px",minWidth:"400px",maxWidth:"400px",height:"100vh",overflowY:"auto"}),uo=l.memo(({mangaId:e,mangaTitle:t,chapterTitle:r,scanlator:n})=>o.jsxs(k,{children:[o.jsx($,{title:t,placement:"right",children:o.jsx(Rt,{lines:3,variant:"h6",component:"h1",sx:{textAlign:"center"},children:o.jsx(Mt,{component:Bt,to:tr.manga.path(e),sx:{textDecoration:"none",color:"inherit"},children:t})})}),o.jsx($,{title:r,placement:"right",children:o.jsx(Rt,{lines:4,variant:"body1",component:"h2",sx:{textAlign:"center"},children:r})}),n&&o.jsx($,{title:n,placement:"right",children:o.jsx(Rt,{lines:4,variant:"body2",component:"h3",color:"textDisabled",sx:{textAlign:"center"},children:n})})]})),go=Me(o.jsx("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6z"})),ho=Me(o.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"})),yt=({title:e,type:t,disabled:r,...n})=>o.jsx($,{title:e,disabled:r,children:o.jsx(en,{sx:{flexBasis:"15%"},variant:"contained",disabled:r,...n,children:t==="previous"?o.jsx(go,{}):o.jsx(ho,{})})}),po=()=>{const{i18n:e,_:t}=F(),r=yr(),{currentPageIndex:n,pages:s}=qe(g=>({currentPageIndex:g.currentPageIndex,pages:g.pages})),i=J(g=>g.readingDirection.value),a=l.useMemo(()=>Le(n,s),[n,s]),c=Ct[i];return o.jsxs(k,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[o.jsx(yt,{type:"previous",title:r(e._({id:"aHKcKc"}),e._({id:"/dqduX"}),c),disabled:r(!a.primary.index,le(a)===le(s.slice(-1)[0]),c),onClick:()=>z.openPage("previous",void 0,!1)}),o.jsxs(Nr,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[o.jsx(Br,{id:"reader-nav-bar-desktop-page-select",children:e._({id:"6WdDG7"})}),o.jsx(Qr,{labelId:"reader-nav-bar-desktop-page-select",label:e._({id:"6WdDG7"}),value:le(a),onChange:g=>z.openPage(g.target.value,void 0,!1),children:s.map(g=>o.jsx(bt,{value:le(g),children:g.name},le(g)))})]}),o.jsx(yt,{type:"next",title:r(e._({id:"/dqduX"}),e._({id:"aHKcKc"}),c),disabled:r(le(a)===le(s.slice(-1)[0]),!a.primary.index,c),onClick:()=>z.openPage("next",void 0,!1)})]})},fo=l.memo(po),xo=()=>{},sn=({currentChapterId:e,chapters:t,style:r})=>{const n=l.useMemo(()=>e===void 0?0:t.findIndex(s=>s.id===e),[e,t]);return o.jsx(_s,{style:{height:"calc(".concat(t.length," * 100px)"),...r},initialTopMostItemIndex:n,totalCount:t.length,computeItemKey:s=>t[s].id,itemContent:s=>o.jsx(As,{index:s,chapters:t,isSortDesc:!0,mode:"reader",showChapterNumber:!1,selected:null,onSelect:xo,selectable:!1,isActiveChapter:s===n}),increaseViewportBy:400})},mo=({currentChapterId:e,currentChapterName:t,currentChapterNumber:r,previousChapter:n,nextChapter:s,chapters:i=[],readerThemeDirection:a})=>{const{i18n:c,_:g}=F(),h=Dt({variant:"popover",popupId:"reader-nav-bar-desktop-chapter-list"});return l.useLayoutEffect(()=>{h.close()},[e]),o.jsxs(k,{sx:{flexDirection:"row",gap:1},dir:"ltr",children:[o.jsx(yt,{type:"previous",title:K(c._({id:"S9gT2s"}),c._({id:"05zAhA"}),a),onClick:()=>{z.openChapter(K("previous","next",a))},disabled:K(!n,!s,a)}),o.jsxs(Nr,{sx:{flexBasis:"70%",flexGrow:0,flexShrink:0},children:[o.jsx(Br,{id:"reader-nav-bar-desktop-chapter-select",children:c._({id:"QIei5D"})}),o.jsx(Qr,{...jt(h),open:h.isOpen,value:e!=null?e:0,MenuProps:{sx:{visibility:"hidden"}},label:c._({id:"QIei5D"}),labelId:"reader-nav-bar-desktop-chapter-select",children:o.jsx(bt,{value:e!=null?e:0,children:r!==void 0?"#".concat(r," ").concat(t):""},e)})]}),o.jsx(yt,{component:Bt,type:"next",title:K(c._({id:"05zAhA"}),c._({id:"S9gT2s"}),a),onClick:()=>{z.openChapter(K("next","previous",a))},disabled:K(!s,!n,a)}),o.jsx(En,{...wn(h),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:o.jsx(Y,{sx:{mb:1},children:o.jsx(sn,{style:{width:"500px",maxWidth:"90vw",minHeight:"150px",maxHeight:"300px"},currentChapterId:e,chapters:i})})})]})},vo=he(l.memo(mo),[()=>({readerThemeDirection:j.useGetThemeDirection()})],["readerThemeDirection"]),So=Me(o.jsx("path",{d:"M17 4h3c1.1 0 2 .9 2 2v2h-2V6h-3zM4 8V6h3V4H4c-1.1 0-2 .9-2 2v2zm16 8v2h-3v2h3c1.1 0 2-.9 2-2v-2zM7 18H4v-2H2v2c0 1.1.9 2 2 2h3zM18 8H6v8h12z"})),on=(e,t,r)=>{const s=(e+1)%t.length===0;if(!(r&&s))return t[(e+1)%t.length]},or=({tooltip:e,value:t,defaultValue:r,values:n,setValue:s,valueToDisplayData:i,isDefaultable:a,onDefault:c,defaultIcon:g})=>{const{i18n:h,_:x}=F(),d=t===void 0,u=l.useMemo(()=>d?-1:n.indexOf(t),[t,n]);return o.jsx($,{title:e,children:d?o.jsx(nt,{onClick:()=>s(n[0]),sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:g,size:"large",children:r===void 0?h._({id:"ovBPCi"}):o.jsx(Jn,{superscript:"(".concat(h._({id:"ovBPCi"}),")"),text:i[r].isTitleString?i[r].title:h._(i[r].title)})}):o.jsx(nt,{onClick:()=>{const p=on(u,n,a);if(p===void 0){c==null||c();return}s(p)},sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},variant:"contained",startIcon:i[t].icon,size:"large",children:i[t].isTitleString?i[t].title:h._(i[t].title)})})},Co=({pageScaleMode:e,shouldStretchPage:t,updateSetting:r,...n})=>{const{i18n:s,_:i}=F();return o.jsxs(k,{sx:{flexDirection:"row",gap:1},children:[o.jsx(or,{...n,tooltip:s._({id:"h1Kv7C"}),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:kr,setValue:a=>r("pageScaleMode",a),valueToDisplayData:cr,defaultIcon:cr[e.value].icon}),_n[e.value]&&o.jsx($,{title:s._({id:"RrbZW2"}),children:o.jsx(en,{onClick:()=>r("shouldStretchPage",!t.value),sx:{px:void 0},variant:"contained",color:t.value?"secondary":"primary",children:o.jsx(So,{})})})]})},Ro=({readingMode:e,setReadingMode:t,...r})=>{const{i18n:n,_:s}=F();return o.jsx(or,{...r,tooltip:n._({id:"n1QGhW"}),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Hr,setValue:t,valueToDisplayData:Zt,defaultIcon:Zt[e.value].icon})},bo=()=>o.jsx(An,{children:o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:o.jsx("path",{d:"M2 4h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2m20 0h-6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h6M2 12h20m-3-3 3 3-3 3M5 9l-3 3 3 3"})})}),Po=({readingMode:e,shouldOffsetDoubleSpreads:t,setShouldOffsetDoubleSpreads:r})=>{const{i18n:n,_:s}=F();return Qn(e)?o.jsx(nt,{sx:{justifyContent:"start",textTransform:"unset"},size:"large",onClick:()=>r(!t),color:t?"secondary":"primary",variant:"contained",startIcon:o.jsx(bo,{}),children:n._({id:"GSVtIx"})}):null},To=({readingDirection:e,setReadingDirection:t,...r})=>{const{i18n:n,_:s}=F();return o.jsx(or,{...r,tooltip:n._({id:"Ap8Ipr"}),value:e.isDefault?void 0:e.value,defaultValue:e.isDefault?e.value:void 0,values:Vr,setValue:t,valueToDisplayData:lr,defaultIcon:lr[e.value].icon})},Eo=Me(o.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 14H9V8h2zm4 0h-2V8h2z"})),wo=Me(o.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 14.5v-9l6 4.5z"})),_o=({autoScroll:e,setAutoScroll:t})=>{const{i18n:r,_:n}=F(),s=Vt(a=>a.isActive),i=l.useRef(void 0);return o.jsxs(k,{sx:{flexDirection:"row",gap:1},children:[o.jsx(nt,{sx:{justifyContent:"start",textTransform:"unset",flexGrow:1},size:"large",onClick:()=>Ge().toggleActive(),color:s?"secondary":"primary",variant:"contained",startIcon:s?o.jsx(Eo,{}):o.jsx(wo,{}),children:r._({id:"IFC5U2"})}),o.jsx(In,{value:e.value,type:"number",size:"small",onBlur:a=>{const c=lt(+a.target.value,Ne.min,Ne.max);c!==e.value&&(clearTimeout(i.current),t({...e,value:c},!0))},onChange:a=>{const c=lt(+a.target.value,Ne.min,Ne.max);t({...e,value:c},!1),clearTimeout(i.current),i.current=setTimeout(()=>t({...e,value:c},!0),Nt(1).seconds.inWholeMilliseconds)},slotProps:{input:{inputProps:Ne,endAdornment:o.jsx(On,{position:"end",children:r._({id:"QyVTg4",values:{0:e.value}})})}}})]})},Ao=({openSettings:e})=>{const{i18n:t,_:r}=F(),{readingMode:n,shouldOffsetDoubleSpreads:s,pageScaleMode:i,shouldStretchPage:a,readingDirection:c,autoScroll:g}=J(h=>({readingMode:h.readingMode,shouldOffsetDoubleSpreads:h.shouldOffsetDoubleSpreads,pageScaleMode:h.pageScaleMode,shouldStretchPage:h.shouldStretchPage,readingDirection:h.readingDirection,autoScroll:h.autoScroll}));return o.jsxs(k,{sx:{gap:1},children:[o.jsx(Ro,{readingMode:n,setReadingMode:h=>j.updateSetting("readingMode",h),isDefaultable:!0,onDefault:()=>j.deleteSetting("readingMode")}),o.jsx(Po,{readingMode:n.value,shouldOffsetDoubleSpreads:s.value,setShouldOffsetDoubleSpreads:h=>j.setOffsetDoubleSpreads(h)}),o.jsx(Co,{pageScaleMode:i,shouldStretchPage:a,updateSetting:j.updateSetting,isDefaultable:!0,onDefault:()=>j.deleteSetting("pageScaleMode")}),o.jsx(To,{readingDirection:c,setReadingDirection:h=>j.updateSetting("readingDirection",h),isDefaultable:!0,onDefault:()=>j.deleteSetting("readingDirection")}),o.jsx(_o,{autoScroll:g,setAutoScroll:(...h)=>j.updateSetting("autoScroll",...h)}),o.jsx(nt,{onClick:()=>e(),size:"large",sx:{justifyContent:"start",textTransform:"none"},variant:"contained",startIcon:o.jsx(zr,{}),children:t._({id:"Tz0i8g"})})]})},Io=l.memo(Ao),Oo=Me(o.jsx("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"})),vr={...sr,title:"Fallback",inLibrary:!1},an=l.memo(()=>{const e=wt(i=>i.manga),{inLibrary:t}=e!=null?e:vr,{i18n:r,_:n}=F(),{updateLibraryState:s}=bs(e!=null?e:vr,!0);return o.jsx($,{title:t?r._({id:"mfwy3x"}):r._({id:"RsaYWP"}),children:o.jsx(se,{onClick:s,color:"inherit",children:t?o.jsx(Ls,{}):o.jsx(Ps,{})})})}),Mo=Me(o.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2m0 15-5-2.18L7 18V5h10z"})),Do=({id:e,isBookmarked:t})=>{const{i18n:r,_:n}=F(),s=t?"unbookmark":"bookmark";return o.jsx($,{title:r._(Qt[s].action.single),children:o.jsx(se,{onClick:()=>ke.performAction(s,[e],{}),color:"inherit",children:t?o.jsx(Is,{}):o.jsx(Mo,{})})})},cn=l.memo(Do),jo=({id:e=-1,isDownloaded:t})=>{const{i18n:r,_:n}=F(),s=ke.useDownloadStatusFromCache(e),i=e===void 0;return e!==void 0&&t?o.jsx($,{title:r._(Qt.delete.action.single),children:o.jsx(se,{onClick:()=>ke.performAction("delete",[e],{}),color:"inherit",children:o.jsx(Ds,{})})}):s?o.jsx(js,{chapterId:s.chapter.id}):o.jsx($,{title:r._(Qt.download.action.single),disabled:i,children:o.jsx(se,{disabled:i,onClick:()=>ke.performAction("download",[e],{}),color:"inherit",children:o.jsx(Ms,{})})})},Lo=l.memo(()=>{const{id:e,isDownloaded:t,isBookmarked:r,realUrl:n}=He(h=>{var x,d,u,p,f,C,m,v;return{id:(d=(x=h.currentChapter)==null?void 0:x.id)!=null?d:St.id,isDownloaded:(p=(u=h.currentChapter)==null?void 0:u.isDownloaded)!=null?p:St.isDownloaded,isBookmarked:(C=(f=h.currentChapter)==null?void 0:f.isBookmarked)!=null?C:St.isBookmarked,realUrl:(v=(m=h.currentChapter)==null?void 0:m.realUrl)!=null?v:St.realUrl}}),{i18n:s,_:i}=F(),a=qe(h=>h.pageLoadStates),c=l.useRef(0),g=l.useMemo(()=>a.some(h=>h.error),[a]);return o.jsxs(k,{sx:{flexDirection:"row",justifyContent:"center",gap:1},children:[o.jsx(an,{}),o.jsx(cn,{id:e,isBookmarked:r}),o.jsx($,{title:s._({id:"KJJKF7"}),disabled:!g,children:o.jsx(se,{onClick:()=>{H().setPageLoadStates(h=>h.map(x=>({url:x.url,loaded:x.loaded}))),H().setRetryFailedPagesKeyPrefix("".concat(c.current)),c.current=(c.current+1)%1e3},disabled:!g,color:"inherit",children:o.jsx(Oo,{})})}),o.jsx(jo,{id:e,isDownloaded:t}),o.jsx($,{title:s._({id:"ZdWg0V"}),disabled:!n,children:o.jsx(se,{disabled:!n,href:n!=null?n:"",rel:"noreferrer",target:"_blank",color:"inherit",children:o.jsx(Os,{})})}),o.jsx($,{title:s._({id:"Xrk3+q"}),disabled:!n,children:o.jsx(se,{disabled:!n,href:n?Tt.getWebviewUrl(n):"",rel:"noreferrer",target:"_blank",color:"inherit",children:o.jsx(ys,{})})})]})}),yo=({exit:e})=>{const{i18n:t,_:r}=F(),n=yr();return o.jsx($,{title:t._({id:"2mxCGH"}),children:o.jsx(se,{sx:{marginRight:2},onClick:e,color:"inherit",children:n(o.jsx(Mn,{}),o.jsx(Dn,{}))})})},ln=he(l.memo(yo),[()=>({exit:j.useExit()})],["exit"]),No=(e,t)=>{const r=l.useRef(t),n=l.useRef(t);return n.current!==r.current&&!e&&(r.current=!1),n.current!==t&&(r.current=n.current,n.current=t),r.current},Bo=({isVisible:e,openSettings:t,setReaderNavBarWidth:r})=>{const{i18n:n,_:s}=F(),i=wt(b=>b.manga),{chapters:a,currentChapterId:c,currentChapterName:g,currentChapterNumber:h,currentChapterScanlator:x,previousChapter:d,nextChapter:u}=He(b=>{var w,T,R,A;return{chapters:b.chapters,currentChapterId:(w=b.currentChapter)==null?void 0:w.id,currentChapterName:(T=b.currentChapter)==null?void 0:T.name,currentChapterNumber:(R=b.currentChapter)==null?void 0:R.chapterNumber,currentChapterScanlator:(A=b.currentChapter)==null?void 0:A.scanlator,previousChapter:b.previousChapter,nextChapter:b.nextChapter}}),p=J(b=>b.isStaticNav),[f,C]=l.useState();ze(f,l.useCallback(()=>{p&&r(f.offsetWidth)},[f,p])),l.useLayoutEffect(()=>()=>r(0),[]);const E=No(e,p)&&e?0:void 0;return o.jsx(jn,{variant:p?"permanent":"persistent",open:e||p,transitionDuration:E,SlideProps:{unmountOnExit:!0},PaperProps:{ref:b=>C(b)},children:o.jsxs(lo,{sx:{backgroundColor:"background.paper",pointerEvents:"all"},children:[o.jsxs(k,{sx:{p:2,gap:2,backgroundColor:"action.hover"},children:[o.jsxs(k,{sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[o.jsx(ln,{}),o.jsx($,{title:n._({id:"JqpUAG"}),children:o.jsx(se,{onClick:()=>{r(0),j.updateSetting("isStaticNav",!p)},color:p?"primary":"inherit",children:p?o.jsx(Cs,{}):o.jsx(Rs,{})})})]}),i&&c!==void 0?o.jsxs(o.Fragment,{children:[o.jsx(uo,{mangaId:i.id,mangaTitle:i.title,chapterTitle:g!=null?g:"",scanlator:x}),o.jsx(Lo,{})]}):o.jsx(kt,{})]}),o.jsxs(k,{sx:{p:2,gap:2},children:[o.jsxs(k,{sx:{gap:1},children:[o.jsx(fo,{}),o.jsx(vo,{chapters:a,currentChapterId:c,currentChapterName:g,currentChapterNumber:h,nextChapter:u,previousChapter:d})]}),o.jsx(Ln,{}),o.jsx(Io,{openSettings:t})]})]})})},ko=he(l.memo(Bo),[Xe],["setReaderNavBarWidth"]),Ho={...sr,title:""},Vo=({isVisible:e,ref:t})=>{const{i18n:r,_:n}=F(),s=Dt({popupId:"reader-overlay-more-menu",variant:"popover"}),i=He(f=>f.currentChapter),a=wt(f=>f.manga),c=gt(f=>f),{id:g,title:h}=a!=null?a:Ho,{id:x,name:d,realUrl:u,isBookmarked:p}=i!=null?i:St;return o.jsx(rr,{direction:"down",in:e,ref:t,children:o.jsxs(k,{sx:{flexDirection:"row",alignItems:"center",position:"fixed",top:0,left:0,right:"".concat(c.ySize,"px"),p:2,pt:f=>"max(env(safe-area-inset-top), ".concat(f.spacing(2),")"),backgroundColor:f=>tt(f.palette.background.paper,.95),pointerEvents:"all",boxShadow:2},children:[o.jsx(ln,{}),o.jsx(k,{sx:{flexGrow:1},children:a&&i?o.jsxs(o.Fragment,{children:[o.jsx($,{title:h,children:o.jsx(Rt,{lines:1,component:"h1",variant:"h5",children:o.jsx(Mt,{component:Bt,to:tr.manga.path(g),sx:{textDecoration:"none",color:"inherit"},children:h})})}),o.jsx($,{title:d,children:o.jsx(Rt,{lines:1,children:d})})]}):o.jsx(kt,{})}),o.jsx(an,{}),o.jsx(cn,{id:x,isBookmarked:p}),o.jsx(se,{...jt(s),color:"inherit",children:o.jsx(Ts,{})}),o.jsxs(yn,{...Nn(s),children:[o.jsx(bt,{component:Mt,disabled:!u,href:u!=null?u:"",rel:"noreferrer",target:"_blank",children:r._({id:"ZdWg0V"})}),o.jsx(bt,{component:Mt,disabled:!u,href:u?Tt.getWebviewUrl(u):"",rel:"noreferrer",target:"_blank",children:r._({id:"Xrk3+q"})}),o.jsx(bt,{disabled:!u,onClick:async()=>{await navigator.clipboard.writeText(h),Wr(r._({id:"FxVG/l"}),"info")},children:r._({id:"Z8lGw6"})})]})]})})},zo=l.memo(Vo),Wo=Me(o.jsx("path",{d:"m21.81 12.74-.82-.63v-.22l.8-.63c.16-.12.2-.34.1-.51l-.85-1.48c-.07-.13-.21-.2-.35-.2q-.075 0-.15.03l-.95.38c-.08-.05-.11-.07-.19-.11l-.15-1.01c-.03-.21-.2-.36-.4-.36h-1.71c-.2 0-.37.15-.4.34l-.14 1.01c-.03.02-.07.03-.1.05l-.09.06-.95-.38q-.075-.03-.15-.03c-.14 0-.27.07-.35.2l-.85 1.48c-.1.17-.06.39.1.51l.8.63v.23l-.8.63c-.16.12-.2.34-.1.51l.85 1.48c.07.13.21.2.35.2q.075 0 .15-.03l.95-.37c.08.05.12.07.2.11l.15 1.01c.03.2.2.34.4.34h1.71c.2 0 .37-.15.4-.34l.15-1.01c.03-.02.07-.03.1-.05l.09-.06.95.38q.075.03.15.03c.14 0 .27-.07.35-.2l.85-1.48c.1-.17.06-.39-.1-.51M18 13.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5M17 17h2v4c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V3c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v4h-2V6H7v12h10z"})),Uo=Me(o.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5M7 19h14v-2H7zm0-6h14v-2H7zm0-8v2h14V5z"})),Sr=Me(o.jsx("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})),Cr=Me(o.jsx("path",{d:"m6 18 8.5-6L6 6zM16 6v12h2V6z"})),$o={display:"flex",alignItems:"center",justifyContent:"end",position:"relative",backgroundColor:"background.default"},Rr="3px",Fo=l.memo(({isTrailingPage:e,pagesIndex:t,totalPages:r,isVertical:n,isHorizontal:s})=>{const i="".concat(t/(r-1)*100,"%");return o.jsx(Y,{sx:{position:"absolute",...S(n,{top:i,left:"50%"}),...S(s,{top:"50%",left:i}),transform:"translate(-50%, -50%)",width:Rr,height:Rr,borderRadius:100,backgroundColor:"background.paper",...S(e,{backgroundColor:"primary.main"}),zIndex:1}})}),Go=l.memo(({pageName:e,isTrailingPage:t,isCurrentPage:r,pagesIndex:n,totalPages:s,isVertical:i,isHorizontal:a})=>o.jsx(nn,{pageName:e,progressBarPosition:vt.BOTTOM,slotProps:{box:{sx:$o}},children:!r&&o.jsx(Fo,{isTrailingPage:t,pagesIndex:n,totalPages:s,isVertical:i,isHorizontal:a})})),Xo={[vt.BOTTOM]:"up",[vt.LEFT]:"right",[vt.RIGHT]:"left",[vt.AUTO]:"left"},Yo=({direction:e,topOffset:t=0,bottomOffset:r=0})=>{const n=gt(R=>R),s=nr(R=>R.isVisible),{currentPageIndex:i,pages:a}=qe(R=>({currentPageIndex:R.currentPageIndex,pages:R.pages})),{previousChapter:c,nextChapter:g}=He(R=>({previousChapter:R.previousChapter,nextChapter:R.nextChapter})),{progressBarPosition:h,progressBarPositionAutoVertical:x}=J(R=>({progressBarPosition:R.progressBarPosition,progressBarPositionAutoVertical:R.progressBarPositionAutoVertical})),d=Ht(R=>R.isDragging),[,u]=l.useState({});ze(window.document.documentElement,l.useCallback(()=>u({}),[]));const p=Yr(h,x,t+r,n.xSize),{isLeft:f,isRight:C,isVertical:m,isHorizontal:v}=be(p),E=v?e:"ltr",b=l.useMemo(()=>Le(i,a).pagesIndex,[i,a]),w=l.useMemo(()=>({container:{sx:{flexGrow:1,position:"relative",display:"flex",justifyItems:"center",alignItems:"stretch",backgroundColor:R=>tt(R.palette.background.paper,.85),borderRadius:100,boxShadow:2}},progressBarRoot:{sx:{flexGrow:1,gap:0,...S(m,{flexDirection:"column"}),...S(v,{alignItems:"stretch"})}},progressBarSlotsActionArea:{sx:{alignItems:"center",cursor:"pointer",...S(m,{width:"100%",flexDirection:"column",px:2}),...S(v,{height:"100%",py:2})}},progressBarSlotsContainer:{sx:{borderRadius:100,backgroundColor:"background.default",...S(m,{flexDirection:"column",py:1}),...S(v,{px:1})}},progressBarSlot:{sx:{...S(m,{width:"20px"}),...S(v,{height:"20px"})}},progressBarCurrentPageSlot:{sx:{display:"flex",zIndex:1,cursor:"inherit",...S(m,{justifyContent:"center"}),...S(v,{alignItems:"center"})}},progressBarPageTexts:{base:{sx:{...S(m,{py:1}),...S(v,{px:1})}}}}),[m,v]),T=l.useMemo(()=>({progressBarCurrentPage:o.jsx(Y,{sx:{position:"absolute",...S(m,{top:"calc(100% - 6px)",...S(b===0,{top:"0"}),width:"75%",height:"6px"}),...S(v,{left:"calc(100% - 0px)",...S(b===0,{left:"0"}),width:"6px",height:"75%"}),backgroundColor:"primary.main",borderRadius:100,cursor:d?"grabbing":"grab"}})}),[b,a.length,d,m,v]);return l.useLayoutEffect(()=>(rt().setIsMaximized(s),()=>rt().setIsMaximized(!1)),[s]),o.jsx(rr,{direction:Xo[p],in:s,children:o.jsx(rn,{sx:{position:"relative",display:"flex",alignItems:"end",height:"100%",pointerEvents:"none",...S(f,{justifyContent:e==="ltr"?"start":"end"}),...S(C,{justifyContent:e==="ltr"?"end":"start"})},children:o.jsxs(k,{sx:{p:2,gap:1,pointerEvents:"all",alignItems:"center",...S(m,{height:"100%",flexDirection:"column"}),...S(v,{width:"100%",flexDirection:"row"})},children:[o.jsx(se,{onClick:()=>z.openChapter("previous"),disabled:!c,sx:{backgroundColor:R=>tt(R.palette.background.paper,.85),boxShadow:2},children:K(o.jsx(Sr,{sx:{...S(m,{transform:"rotate(90deg)"})}}),o.jsx(Cr,{sx:{...S(m,{transform:"rotate(90deg)"})}}),E)}),o.jsx(tn,{direction:E,progressBarPosition:p,fullSegmentClicks:!1,createProgressBarSlot:l.useCallback((R,A,P,_,B,y,M,O)=>o.jsx(Go,{pageName:R.name,isTrailingPage:M,isCurrentPage:B,pagesIndex:A,totalPages:O,isVertical:m,isHorizontal:v}),[m,v]),slotProps:{...w,progressBarReadPages:{sx:{backgroundColor:"primary.main",...S(m,{width:"20px",height:"".concat(Math.max(0,Le(i,a).pagesIndex)/(a.length-1)*100,"%"),borderRadius:"400px 400px 0 0"}),...S(v,{width:"".concat(Math.max(0,Le(i,a).pagesIndex)/(a.length-1)*100,"%"),height:"20px",borderRadius:"400px 0 0 400px"})}}},slots:T}),o.jsx(se,{onClick:()=>z.openChapter("next"),disabled:!g,sx:{backgroundColor:R=>tt(R.palette.background.paper,.85),boxShadow:2},children:K(o.jsx(Cr,{sx:{...S(m,{transform:"rotate(90deg)"})}}),o.jsx(Sr,{sx:{...S(m,{transform:"rotate(90deg)"})}}),E)})]})})})},qo=he(l.memo(Yo),[()=>({direction:j.useGetThemeDirection()})],["direction"]),Ko=()=>{const{i18n:e,_:t}=F(),r=Vt(a=>a.isActive),{readingMode:n,readingDirection:s,autoScroll:i}=J(a=>({readingMode:a.readingMode,readingDirection:a.readingDirection,autoScroll:a.autoScroll}));return o.jsxs(k,{sx:{gap:2},children:[o.jsx(es,{}),o.jsx(ts,{readingMode:n,setReadingMode:a=>j.updateSetting("readingMode",a),isDefaultable:!0,onDefault:()=>j.deleteSetting("readingMode")}),o.jsx(rs,{readingDirection:s,setReadingDirection:a=>j.updateSetting("readingDirection",a),isDefaultable:!0,onDefault:()=>j.deleteSetting("readingDirection")}),o.jsx(Ns,{label:e._({id:"IFC5U2"}),checked:r,onChange:()=>Ge().toggleActive()}),o.jsx(ns,{autoScroll:i,setAutoScroll:(...a)=>j.updateSetting("autoScroll",...a)})]})},Zo=l.memo(Ko),Jo=({openSettings:e,isVisible:t,topOffset:r=0})=>{const{i18n:n,_:s}=F(),{currentChapterId:i,chapters:a}=He(p=>{var f;return{currentChapterId:(f=p.currentChapter)==null?void 0:f.id,chapters:p.chapters}}),c=Dt({variant:"dialog",popupId:"reader-chapter-list-dialog"}),g=Dt({variant:"dialog",popupId:"reader-quick-settings-dialog"}),h=gt(p=>p),[x,d]=l.useState(0),u=l.useRef(null);return ze(u,l.useCallback(()=>{var p,f;return d((f=(p=u.current)==null?void 0:p.clientHeight)!=null?f:0)},[x])),l.useLayoutEffect(()=>{c.close()},[i]),o.jsxs(o.Fragment,{children:[o.jsxs(k,{sx:{position:"fixed",right:"".concat(h.ySize,"px"),bottom:0,left:0,height:"calc(100% - ".concat(r,"px)")},children:[o.jsx(qo,{topOffset:r,bottomOffset:x}),o.jsx(rr,{direction:"up",in:t,children:o.jsx(k,{ref:u,sx:{alignItems:"center",backgroundColor:p=>tt(p.palette.background.paper,.95),pb:"max(".concat(h.xSize,"px, env(safe-area-inset-bottom))"),boxShadow:2,pointerEvents:"all"},children:o.jsxs(k,{sx:{width:"50%",flexDirection:"row",p:2,gap:1,justifyContent:"space-evenly",alignItems:"center"},children:[o.jsx($,{title:n._({id:"S0FwRL"}),children:o.jsx(se,{...jt(c),color:"inherit",children:o.jsx(Uo,{})})}),o.jsx($,{title:n._({id:"iJSg+d"}),children:o.jsx(se,{...jt(g),color:"inherit",children:o.jsx(Wo,{})})}),o.jsx($,{title:n._({id:"Tz0i8g"}),children:o.jsx(se,{onClick:e,color:"inherit",children:o.jsx(zr,{})})})]})})})]}),c.isOpen&&o.jsx(Yt,{...dr(c),fullWidth:!0,maxWidth:"md",scroll:"paper",children:o.jsx(qt,{sx:{p:0,pb:1},children:o.jsx(sn,{style:{minHeight:"15vh",maxHeight:"75vh"},currentChapterId:i,chapters:a})})}),g.isOpen&&o.jsx(Yt,{...dr(g),fullWidth:!0,maxWidth:"md",scroll:"paper",children:o.jsx(qt,{children:o.jsx(Zo,{})})})]})},Qo=l.memo(Jo),ei=({isDesktop:e,isMobile:t})=>{const r=nr(g=>g.isVisible),[n,s]=l.useState(!1),[i,a]=l.useState(0),c=l.useRef(null);return ze(c,l.useCallback(()=>{var g,h;return a((h=(g=c.current)==null?void 0:g.clientHeight)!=null?h:0)},[t])),o.jsxs(Y,{sx:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none",zIndex:1},children:[e&&o.jsxs(o.Fragment,{children:[o.jsx(co,{}),o.jsx(ko,{isVisible:r,openSettings:()=>s(!0)})]}),t&&o.jsxs(o.Fragment,{children:[o.jsx(zo,{ref:c,isVisible:r}),o.jsx(Qo,{openSettings:()=>s(!0),isVisible:r,topOffset:i})]}),o.jsx(Ws,{isOpen:n,close:()=>s(!1)}),o.jsx($s,{})]})},ti=he(l.memo(ei),[j.useOverlayMode],["isDesktop","isMobile"]),br="reader-tap-zone-layout-canvas",ri=({readerNavBarWidth:e})=>{const t=st(),{tapZoneLayout:r,tapZoneInvertMode:n,readingDirection:s}=J(p=>({tapZoneLayout:p.tapZoneLayout.value,tapZoneInvertMode:p.tapZoneInvertMode.value,readingDirection:p.readingDirection.value})),i=qr(p=>p.showPreview),[a,c]=l.useState(0),[g,h]=l.useState(0),[x,d]=l.useState(null);ze(x,l.useCallback(()=>{var p,f;c((p=x==null?void 0:x.clientWidth)!=null?p:0),h((f=x==null?void 0:x.clientHeight)!=null?f:0)},[x]));const u=Re.getOrCreateCanvas(r,a,g,t.typography.h3,{vertical:n.vertical,horizontal:n.horizontal,isRTL:s===ut.RTL});return l.useLayoutEffect(()=>{const p=document.getElementById(br);p==null||p.replaceChildren(u)},[u,i]),o.jsx(Y,{ref:d,sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none"},children:i&&o.jsx("div",{id:br})})},ni=he(ri,[Xe],["readerNavBarWidth"]),si=({readerNavBarWidth:e})=>{const{value:{red:t,green:r,blue:n,alpha:s,blendMode:i},enabled:a}=J(c=>c.customFilter.rgba);return a?o.jsx(Y,{sx:{position:"fixed",top:0,left:e,right:0,bottom:0,pointerEvents:"none",background:"rgba(".concat(t," ").concat(r," ").concat(n," / ").concat(s,"%)"),mixBlendMode:"".concat(i)}}):null},oi=he(si,[Xe],["readerNavBarWidth"]),Pr=2,xt=0,te=0,re=1,ii=(e,t=Oe.XY)=>{const[r,n]=l.useState(!1),s=l.useRef(void 0),i=l.useRef([0,0,0]),a=l.useRef([0,0,0]),c=l.useRef([0,0,0]),g=l.useRef([0,0]),h=l.useRef(void 0),x=l.useRef([0,0]),d=l.useRef([0,0]);return l.useEffect(()=>{const u=e==null?void 0:e.current;if(!u)return()=>{};const p=()=>{s.current||(s.current=getComputedStyle(u));const P=s.current.direction==="rtl",_=s.current.flexDirection==="row-reverse";return P||!P&&_},f=()=>(s.current||(s.current=getComputedStyle(u)),s.current.flexDirection==="column-reverse"),C=t!==Oe.Y,m=t!==Oe.X,v=()=>{h.current!==void 0&&(cancelAnimationFrame(h.current),h.current=void 0)},E=()=>{const P=(ae,Se,pe)=>(ae[xt]-ae[Pr])/(Se[xt]-Se[Pr])*1e3/pe,_=[C?P(i.current,c.current,u.clientWidth):0,m?P(a.current,c.current,u.clientHeight):0],B=C&&m?Math.sqrt(_[te]**2+_[re]**2):Math.abs(m?_[re]:_[te]),y=[_[te]/B,_[re]/B],M=lt(1.2*B,-12,12),O=(Date.now()-c.current[xt])/1e3,G=M-14.278*O+75.24*O**2/M-149.72*O**3/M/M;if(!(M!==0&&G>0&&!Number.isNaN(M))){v();return}const oe=(ae,Se)=>ae*Se*(M*O-7.1397*O**2+25.08*O**3/M-37.43*O**4/M/M),ie=[oe(u.clientWidth,y[te]),oe(u.clientHeight,y[re])],X=[u.scrollWidth-u.clientWidth,u.scrollHeight-u.clientHeight],L=[lt(g.current[te]-ie[te],p()?-X[te]:0,X[te]),lt(g.current[re]-ie[re],f()?-X[re]:0,X[re])],Pe=L[te]!==0||L[te]!==X[te],Te=L[re]!==0||L[re]!==X[re];Pe||Te||v(),C&&(u.scrollLeft=L[te]),m&&(u.scrollTop=L[re])};let b=!1;const w=P=>{if(b)return!0;const _=[u.clientHeight<u.scrollHeight,u.clientWidth<u.scrollWidth],B=[Math.abs(i.current[xt]-P.pageX)>0,Math.abs(a.current[xt]-P.pageY)>0];return _[te]&&B[te]||_[re]&&B[re]},T=P=>{w(P)&&(b=!0,n(!0),i.current=[...i.current.slice(1),P.pageX],a.current=[...a.current.slice(1),P.pageY],c.current=[...c.current.slice(1),Date.now()],C&&(u.scrollLeft=d.current[te]-(P.pageX-x.current[te])),m&&(u.scrollTop=d.current[re]-(P.pageY-x.current[re])))},R=()=>{u.removeEventListener("mousemove",T),u.removeEventListener("mouseup",R),setTimeout(()=>{b=!1,n(!1)},0),g.current=[u.scrollLeft,u.scrollTop];const P=()=>{E(),h.current=requestAnimationFrame(P)};h.current=requestAnimationFrame(P)},A=P=>{P.button===0&&(P.preventDefault(),x.current=[P.pageX,P.pageY],d.current=[u.scrollLeft,u.scrollTop],i.current=[P.pageX,P.pageX,P.pageX],a.current=[P.pageY,P.pageY,P.pageY],c.current=[Date.now()-2,Date.now()-1,Date.now()],u.addEventListener("mousemove",T,{passive:!0}),u.addEventListener("mouseup",R),v())};return u.addEventListener("mousedown",A),u.addEventListener("wheel",v,{passive:!0}),()=>{u.removeEventListener("mousedown",A),u.removeEventListener("wheel",v),v()}},[e,t]),r},ai=(e,t)=>{const{isPaused:r}=Vt(n=>({isPaused:n.isPaused}));l.useEffect(()=>{const{pause:n,resume:s}=Ge();if(e&&!t){n();return}s()},[e,r,t])},ci=(e,t)=>{const{showPreview:r}=qr(n=>({showPreview:n.showPreview}));l.useEffect(()=>{var s,i;const n=()=>{e&&Be().setIsVisible(!1),r&&dt().setShowPreview(!1)};return(s=t.current)==null||s.addEventListener("wheel",n,{passive:!0}),(i=t.current)==null||i.addEventListener("touchmove",n,{passive:!0}),()=>{var a,c;(a=t.current)==null||a.removeEventListener("wheel",n),(c=t.current)==null||c.removeEventListener("touchmove",n)}},[e,r])},li=(e,t,r)=>{l.useEffect(()=>{const n=r.current;if(e!==W.CONTINUOUS_HORIZONTAL)return()=>{};if(!n)return()=>{};const s=i=>{if(!(Math.abs(i.deltaX)>Math.abs(i.deltaY)||Bn.isTrackPadLike())){if(i.preventDefault(),i.shiftKey){n.scrollBy({top:i.deltaY});return}n.scrollBy({left:t===ut.LTR?i.deltaY:i.deltaY*-1})}};return n.addEventListener("wheel",s),()=>n.removeEventListener("wheel",s)},[e,t])},di=e=>{const t=l.useRef(void 0);l.useEffect(()=>{const r=s=>{const i=e.current;i&&(i.style.cursor=s?"default":"none")},n=()=>{r(!0),clearTimeout(t.current),t.current=setTimeout(()=>{r(!1)},Nt(5).seconds.inWholeMilliseconds)};return n(),window.addEventListener("mousemove",n,{passive:!0}),()=>{r(!0),window.removeEventListener("mousemove",n),clearTimeout(t.current)}},[])},ui=(e,t,r,n,s)=>{l.useLayoutEffect(()=>{var i;t||(i=s.current)==null||i.scrollTo(ss(s.current,r,n),0)},[e])},gi=(e,t,r,n,s,i,a,c)=>{l.useLayoutEffect(()=>{if(e==null)return;const g=Le(e,t);if(s){const d=i.current[g.pagesIndex];d==null||d.scrollIntoView({block:"start",inline:os(a,c)})}const h=le(g),x=h===r-1;H().setPageToScrollToIndex(null),n(h,!x,x)},[e])},hi=(e,t,r,n,s,i,a)=>{const[c,g]=l.useState(a===W.DOUBLE_PAGE);l.useLayoutEffect(()=>{if(c&&a!==W.DOUBLE_PAGE){g(!1);const d=Kr(r);n(d),s(d.map(({primary:{url:u}})=>({url:u,isSpread:!1})));return}a===W.DOUBLE_PAGE&&(c||i(le(Le(e,t))),n(t),g(a===W.DOUBLE_PAGE))},[t,a])},Gt=({title:e,name:t,scanlator:r,backgroundColor:n})=>{const s=st(),i=s.palette.getContrastText(Hn(s.palette,Ur[n])),a=tt(i,.5);return t?o.jsxs(k,{children:[o.jsx(et,{color:i,children:e}),o.jsx(et,{color:i,variant:"h6",component:"h1",children:t}),r&&o.jsx(et,{variant:"body2",color:a,children:r})]}):null},pi=({type:e,currentChapterName:t,currentChapterScanlator:r,previousChapterName:n,previousChapterScanlator:s,nextChapterName:i,nextChapterScanlator:a,readerNavBarWidth:c,handleBack:g})=>{var P;const{i18n:h,_:x}=F(),d=wt(_=>_.manga),u=gt(_=>_),p=qe(_=>_.transitionPageMode),{readingMode:f,backgroundColor:C,shouldShowTransitionPage:m}=J(_=>({readingMode:_.readingMode.value,backgroundColor:_.backgroundColor,shouldShowTransitionPage:_.shouldShowTransitionPage})),v=e===de.PREVIOUS,E=e===de.NEXT,b=!!t&&!n,w=!!t&&!i,T=b&&e===de.PREVIOUS,R=w&&e===de.NEXT;return!m&&!(T||R)||!is(e,p,f)?null:o.jsx(k,{sx:{justifyContent:"center",alignItems:"center",...S(!ge(f),{width:"100%",height:"100%"}),...S(ge(f),{position:"sticky",...S(Ve(f),{left:0,maxWidth:"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px)"),minHeight:"calc(100vh - ".concat(u.xSize,"px)")}),...S(f===W.CONTINUOUS_HORIZONTAL,{top:0,minWidth:"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px)"),maxHeight:"calc(100vh - ".concat(u.xSize,"px)")})})},children:o.jsxs(k,{sx:{gap:2,maxWidth:_=>"calc(100vw - ".concat(u.ySize,"px - ").concat(c,"px - ").concat(_.spacing(2),")"),maxHeight:"calc(100vh - ".concat(u.xSize,"px)"),width:"max-content",p:1},children:[v&&b&&o.jsx(et,{variant:"h6",children:h._({id:"eijoLF"})}),o.jsxs(k,{sx:{gap:5},children:[v&&!b&&o.jsx(Gt,{title:h._({id:"VHnO5x"}),name:n,scanlator:s,backgroundColor:C}),!!t&&o.jsx(Gt,{title:v?h._({id:"q/XX3T"}):h._({id:"A9r9ns"}),name:t,scanlator:r,backgroundColor:C}),E&&!w&&o.jsx(Gt,{title:h._({id:"3J7a7o"}),name:i,scanlator:a,backgroundColor:C})]}),E&&w&&o.jsx(et,{variant:"h6",children:h._({id:"STQqww"})}),(v&&b||E&&w)&&o.jsxs(k,{sx:{flexDirection:"row",flexWrap:"wrap",gap:1},children:[o.jsx(nt,{sx:{flexGrow:1},onClick:_=>{_.stopPropagation(),g()},variant:"contained",children:h._({id:"+4RFej"})}),o.jsx(nt,{sx:{flexGrow:1},component:Bt,onClick:_=>{_.stopPropagation()},variant:"contained",to:tr.manga.path((P=d==null?void 0:d.id)!=null?P:-1),children:h._({id:"+YP7mg"})})]})]})})},Tr=he(l.memo(pi),[({chapterId:e})=>{const t=He(a=>a.chapters),r=l.useMemo(()=>t.findIndex(a=>a.id===e),[e,t]),n=t[r],s=l.useMemo(()=>t[r+1],[r,t]),i=l.useMemo(()=>t[r-1],[r,t]);return{currentChapterName:n==null?void 0:n.name,currentChapterScanlator:n==null?void 0:n.scanlator,previousChapterName:s==null?void 0:s.name,previousChapterScanlator:s==null?void 0:s.name,nextChapterName:i==null?void 0:i.name,nextChapterScanlator:i==null?void 0:i.scanlator}},Xe,({chapterId:e,type:t})=>{const r=kn(),n=He(x=>x.chapters),s=l.useMemo(()=>n.findIndex(x=>x.id===e),[e,n]),i=s===0,a=s===n.length-1,c=t===de.PREVIOUS&&a,g=t===de.NEXT&&i;return{handleBack:c||g?r:Ze}}],["currentChapterName","currentChapterScanlator","previousChapterName","previousChapterScanlator","nextChapterName","nextChapterScanlator","readerNavBarWidth","handleBack"]),fi=(e,t,r,n,s,i,a,c,g,h,x,d,u,p,f,C,m,v)=>{var b,w;const E=l.useRef(void 0);l.useLayoutEffect(()=>{var y;const T=(y=t.data)==null?void 0:y.fetchChapterPages;if(!T)return;const{pages:R}=T,P=(R.length?R:[""]).map(M=>{var O;return Vn.addParams(M,{sourceId:(O=Et().manga)==null?void 0:O.sourceId})}),_=as(r,n!=null?n:0,P.length-1),B=E.current!==(T==null?void 0:T.pages);if(B){E.current=T.pages;const M=Kr(P);g(!0),d(M),u(P),p(M.map(({primary:{url:O}})=>({url:O,loaded:!1}))),f(M.map(({primary:{url:O}})=>({url:O,isSpread:!1})))}else d(s),p(i),f(a);x(T.pages.length),u(P),C(_),m(_),h(M=>({...M,isCurrentChapterReady:c||B})),v(de.NONE)},[(w=(b=t.data)==null?void 0:b.fetchChapterPages)==null?void 0:w.pages,e])},Er=0,Ot="-10px",xi=(e,t,r)=>{if(!ge(t))return;const n=Ct[r],s="0px ".concat(Ot," 0px 0px"),i="0px 0px 0px ".concat(Ot);return Ve(t)?e==="first"?"0px 0px ".concat(Ot," 0px"):"".concat(Ot," 0px 0px 0px"):e==="first"?K(s,i,n):K(i,s,n)},mi=(e,t,r,n)=>e===ut.LTR?{start:r>=n,end:t<0}:{start:t<0,end:r>=n},vi=(e,{top:t,right:r,bottom:n,left:s},i,a)=>{const c=window.innerWidth-a,g=window.innerHeight-i;return{[W.CONTINUOUS_VERTICAL]:{start:n>=g,end:t<0},[W.CONTINUOUS_HORIZONTAL]:mi(e,s,r,c)}},Si=({[W.CONTINUOUS_VERTICAL]:e,[W.CONTINUOUS_HORIZONTAL]:t},r)=>Ve(r)?e.start||e.end:t.start||t.end,Ci=({[W.CONTINUOUS_VERTICAL]:e,[W.CONTINUOUS_HORIZONTAL]:t},r)=>Ve(r)?e:t,wr=(e,t,r,n,s,i,a)=>{const{readingMode:c,readingDirection:g,shouldUseInfiniteScroll:h,shouldShowTransitionPage:x}=J(d=>({readingMode:d.readingMode.value,readingDirection:d.readingDirection.value,shouldUseInfiniteScroll:d.shouldUseInfiniteScroll,shouldShowTransitionPage:d.shouldShowTransitionPage}));l.useEffect(()=>{const d=ge(c),u=Ve(c);if(x||!a||!d||!h||!n||s||r===void 0)return()=>{};const p=()=>{const f=a.scrollLeft===0,C=a.scrollLeft===a.scrollWidth-a.clientWidth,m=a.scrollTop===0,v=a.scrollTop===a.scrollHeight-a.clientHeight;(e==="first"&&(u?m:f)||e==="last"&&(u?v:C))&&z.openChapter(r,void 0,!1)};return a.addEventListener("scroll",p,{passive:!0}),()=>a.removeEventListener("scroll",p)},[c,a,x,h,n,s,r]),Bs(i,l.useCallback(d=>{if(!h||!ge(c)||r===void 0||!x&&!s)return;const u=d[d.length-1],p=vi(g,u.target.getBoundingClientRect(),pr().xSize,pr().ySize),{start:f,end:C}=Ci(p,c),m=u.intersectionRatio<=Er;if(!Si(p,c))return;const v=e==="first"&&f&&!s,E=e==="last"&&!n&&C;if(v||e==="last"&&C&&m){z.openChapter(r,!s,!1);return}E&&z.openChapter(t,!1,!1)},[e,t,r,n,s,c,g,h,x]),l.useMemo(()=>({root:a,threshold:[Er],rootMargin:xi(e,c,g),ignoreInitialObserve:!0}),[e,c,g]))},Ri=({chapterId:e,previousChapterId:t,nextChapterId:r,isPreviousChapterVisible:n,isCurrentChapter:s,isNextChapterVisible:i,imageWrapper:a,scrollElement:c})=>(wr("first",e,t,s,n,a,c),wr("last",e,r,s,i,a,c),null),bi=l.memo(Ri),Pi=({currentPageIndex:e,updateCurrentPageIndex:t,transitionPageMode:r,retryFailedPagesKeyPrefix:n,readingMode:s,readerWidth:i,pageScaleMode:a,shouldOffsetDoubleSpreads:c,readingDirection:g,imagePreLoadAmount:h,pageGap:x,chapterId:d,previousChapterId:u,nextChapterId:p,isPreviousChapterVisible:f,isNextChapterVisible:C,lastPageRead:m,isInitialChapter:v,isCurrentChapter:E,isPreviousChapter:b,isNextChapter:w,isLeadingChapter:T,isTrailingChapter:R,isPreloadMode:A,imageRefs:P,scrollIntoView:_,resumeMode:B,customFilter:y,shouldStretchPage:M,readerNavBarWidth:O,onSizeChange:G,minWidth:me,minHeight:oe,scrollElement:ie})=>{const{i18n:X,_:L}=F(),{direction:Pe}=st(),[Te,ve]=Tt.useGetChapterPagesFetch(d!=null?d:-1),[ae,Se]=l.useState(!1),[pe,De]=l.useState(ft.totalPages),[Z,We]=l.useState(ft.pageUrls),[ye,Ue]=l.useState(ft.pages),[I,Ee]=l.useState(ft.pageLoadStates),[Q,U]=l.useState(ft.pageSpreadStates),je=l.useRef(null),we=l.useRef(E),$e=l.useRef(ye.map(()=>null)),_e=l.useRef(null),N=l.useMemo(()=>!!!pe||!(pe===Q.length)?ye:s===W.DOUBLE_PAGE?cs(Z,Q,c,g):ye,[Q,s,c,g,pe]),fe=l.useMemo(()=>ls(s),[s]),Fe=g===ut.LTR,Ae=ge(s),Ie=!Ae&&!E||A,ot=!Ae&&E,zt=!Ie&&(ot||Ae&&(v||T)),_t=!Ie&&(ot||Ae&&(v||R));we.current=E,E&&(P.current=$e.current);const it=l.useCallback(()=>{d&&(Se(!1),Te({variables:{input:{chapterId:d}}}).catch(ct("ReaderChapterViewer(".concat(d,")::fetchPages"))))},[Te,d]),At=l.useMemo(()=>ds(N,D=>{we.current&&H().setPageSpreadStates(D),U(D)},D=>{we.current&&H().setPageLoadStates(D),Ee(D)},s),[N,s]),It=l.useMemo(()=>us(D=>{we.current&&H().setPageLoadStates(D),Ee(D)}),[]);l.useEffect(()=>{it()},[d]),ze(je,l.useCallback(D=>{const{clientWidth:Ke,clientHeight:Ut}=D[0].target;G(Ke,Ut,d)},[G,je.current,d]));const ce=(D,Ke,Ut,un=!1)=>{(un||!ae)&&Ke(D),E&&Ut(D)};return fi(E,ve,B,m,N,I,Q,ae,Se,D=>ce(D,Ze,Qe().setReaderStateChapters),D=>ce(D,De,H().setTotalPages.bind(H())),D=>ce(D,Ue,H().setPages.bind(H())),D=>ce(D,We,H().setPageUrls.bind(H())),D=>ce(D,Ee,H().setPageLoadStates.bind(H())),D=>ce(D,U,H().setPageSpreadStates.bind(H())),D=>ce(D,Ze,H().setCurrentPageIndex.bind(H())),D=>{(v&&!ae||_)&&(H().setPageToScrollToIndex(D),Qe().setReaderStateChapters(Ke=>({...Ke,visibleChapters:{...Ke.visibleChapters,scrollIntoView:!1,resumeMode:void 0}})))},D=>ce(D,Ze,H().setTransitionPageMode.bind(H()))),hi(e,N,Z,D=>ce(D,Ue,H().setPages.bind(H()),!0),D=>ce(D,U,Ze,!0),D=>ce(D,Ze,t),s),Ae||E||b||w?ve.error?Ie?null:o.jsx(Y,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center",position:"relative"},children:o.jsx(Lt,{message:X._({id:"6m5aox"}),messageExtra:$r(ve.error),retry:()=>{it()}})}):ve.loading||!ae?Ie?null:o.jsx(Y,{sx:{minHeight:"100%",minWidth:"100%",display:"grid",placeItems:"center"},children:o.jsx(kt,{})}):d!=null&&!pe?Ie?null:o.jsx(Y,{sx:{minWidth:"100%",minHeight:"100%",position:"relative"},children:o.jsx(Lt,{message:X._({id:"Oo/WWc"}),retry:it})}):o.jsxs(k,{ref:je,sx:{width:"fit-content",height:"fit-content",margin:"auto",flexWrap:"nowrap",...S(s===W.CONTINUOUS_HORIZONTAL,{minHeight:oe}),...S(Ve(s),{minWidth:me}),...S(Ie,{maxWidth:0,maxHeight:0,minWidth:"unset",minHeight:"unset",overflow:"hidden",margin:"unset"}),...S(Ve(s)&&Zr(i,a),{alignItems:"center"}),...S(s===W.CONTINUOUS_HORIZONTAL,{...S(Pe==="ltr",{flexDirection:Fe?"row":"row-reverse"}),...S(Pe==="rtl",{flexDirection:Fe?"row-reverse":"row"})})},children:[!A&&o.jsx(bi,{chapterId:d,previousChapterId:u,nextChapterId:p,isCurrentChapter:E,isPreviousChapterVisible:f,isNextChapterVisible:C,imageWrapper:_e.current,scrollElement:ie}),zt&&o.jsx(Tr,{chapterId:d,type:de.PREVIOUS}),o.jsx(fe,{ref:_e,totalPages:pe,currentPageIndex:e,pages:N,transitionPageMode:r,pageLoadStates:I,retryFailedPagesKeyPrefix:n,imageRefs:$e,onLoad:At,onError:It,isCurrentChapter:E,isPreviousChapter:b,isNextChapter:w,readingMode:s,imagePreLoadAmount:h,readingDirection:g,pageScaleMode:a,pageGap:x,customFilter:y,shouldStretchPage:M,readerWidth:i,readerNavBarWidth:O,isPreloadMode:A,resumeMode:B,handleAsInitialRender:_}),_t&&o.jsx(Tr,{chapterId:d,type:de.NEXT})]}):null},Ti=l.memo(Pi),Ei=(e,t,r,n)=>{if(!ge(e))return!1;const s=gs(t),i=hs(t),a=r!==window.innerWidth,c=n!==window.innerHeight;return s&&a||i&&c},mt=(e,t)=>{l.useLayoutEffect(()=>{H().setPageToScrollToIndex(t)},[e])},wi=(e,t,r)=>{const n=l.useRef({width:window.innerWidth,height:window.innerHeight}),s=l.useRef(!1),i=l.useRef(void 0),a=l.useRef(null),c=l.useCallback(()=>{const{width:g,height:h}=n.current;n.current={width:window.innerWidth,height:window.innerHeight},s.current||(s.current=!0,a.current=r),Ei(e,t,g,h)&&(H().setPageToScrollToIndex(a.current),clearTimeout(i.current),i.current=setTimeout(()=>{s.current=!1,a.current=null},50))},[e,t,r]);ks("resize",c)},dn=e=>{const t=l.useRef({left:0,top:0,visibleElement:void 0,visibleElementLeft:0,visibleElementTop:0});return l.useEffect(()=>{const r=e.current;if(!r)return()=>{};const n=()=>{var i,a;const{visibleElement:s}=t.current;t.current={...t.current,left:r.scrollLeft,top:r.scrollTop,visibleElementLeft:(i=s==null?void 0:s.offsetLeft)!=null?i:0,visibleElementTop:(a=s==null?void 0:s.offsetTop)!=null?a:0}};return r.addEventListener("scroll",n,{passive:!0}),()=>r.removeEventListener("scroll",n)},[]),l.useEffect(()=>{const r=e.current;if(!r)return()=>{};const n=(a,c)=>Array.from(a).filter(g=>g instanceof HTMLElement).flatMap(g=>g instanceof HTMLImageElement?[g]:Array.from(g.querySelectorAll("img"))).forEach(c),s=new IntersectionObserver(a=>{const c=a.find(g=>g.isIntersecting);(c==null?void 0:c.target)instanceof HTMLElement&&(t.current={...t.current,visibleElement:c.target,visibleElementLeft:c.target.offsetLeft,visibleElementTop:c.target.offsetTop})}),i=new MutationObserver(a=>{for(const c of a)n(c.addedNodes,g=>s.observe(g)),n(c.removedNodes,g=>s.unobserve(g))});return i.observe(r,{childList:!0,subtree:!0}),()=>{i.disconnect(),s.disconnect()}},[]),t},_i=(e,t)=>{const r=dn(e),n=ge(t),s=Ve(t);l.useEffect(()=>{const i=e.current;if(!i||!n)return()=>{};const a=x=>{const{left:d,top:u,visibleElement:p,visibleElementLeft:f,visibleElementTop:C}=r.current;if(!p||!!!x.filter(w=>!(w.target instanceof HTMLElement)||!w.target.clientWidth&&!w.target.clientHeight?!1:s?w.target.offsetTop<u:Math.abs(w.target.offsetLeft)<Math.abs(d)).length)return;const E=d-f+p.offsetLeft,b=u-C+p.offsetTop;i.scrollTo(E,b)},c=(x,d)=>Array.from(x).filter(u=>u instanceof HTMLElement).flatMap(u=>u instanceof HTMLImageElement?[u]:Array.from(u.querySelectorAll("img"))).forEach(d),g=new ResizeObserver(a),h=new MutationObserver(x=>{for(const d of x)c(d.addedNodes,u=>g.observe(u)),c(d.removedNodes,u=>g.unobserve(u))});return h.observe(i,{childList:!0,subtree:!0}),()=>{h.disconnect(),g.disconnect()}},[n,s])},Ai=(e,t,r,n,s,i,a)=>{const c=dn(e),g=()=>{const h=e.current,{left:x,top:d,visibleElementLeft:u,visibleElementTop:p,visibleElement:f}=c.current;if(!h||!a||!f)return!1;const C=Jr(r,s,i),m=n===0;if(!(!C.previous&&m))return!1;const E=x-u+f.offsetLeft,b=d-p+f.offsetTop;return h.scrollTo(E,b),!0};l.useEffect(()=>{const h=e.current;if(!h||!a)return()=>{};let x=!1;const d=(f,C)=>{Array.from(f).filter(m=>m instanceof HTMLElement).flatMap(m=>m instanceof HTMLImageElement?[m]:Array.from(m.querySelectorAll("img"))).forEach(C)},u=new ResizeObserver(()=>{x||(x=g(),x&&u.disconnect())}),p=new MutationObserver(f=>{for(const C of f)d(C.addedNodes,m=>u.observe(m)),d(C.removedNodes,m=>u.unobserve(m))});return p.observe(h,{childList:!0,subtree:!0}),()=>{p.disconnect(),u.disconnect()}},[t]),l.useLayoutEffect(()=>{g()},[t])},Ii=(e,t,r,n,s,i,a,c,g,h,x)=>{Ai(e,t,r,n,s,i,ge(a)),_i(e,a),wi(a,g,n),mt(c,n),mt(a,n),mt(g,n),mt(h,n),mt("".concat(x.value,"_").concat(x.enabled),n)},Oi={[W.SINGLE_PAGE]:pt.X,[W.DOUBLE_PAGE]:pt.X,[W.CONTINUOUS_VERTICAL]:pt.Y,[W.CONTINUOUS_HORIZONTAL]:pt.X,[W.WEBTOON]:pt.Y},Mi=({readerNavBarWidth:e,updateCurrentPageIndex:t,ref:r})=>{var Ue;const{direction:n}=st(),s=nr(I=>I.isVisible),{currentPageIndex:i,pageToScrollToIndex:a,pages:c,totalPages:g,transitionPageMode:h,retryFailedPagesKeyPrefix:x}=qe(I=>({currentPageIndex:I.currentPageIndex,pageToScrollToIndex:I.pageToScrollToIndex,pages:I.pages,totalPages:I.totalPages,transitionPageMode:I.transitionPageMode,retryFailedPagesKeyPrefix:I.retryFailedPagesKeyPrefix})),{initialChapter:d,currentChapter:u,chapters:p,visibleChapters:f,isCurrentChapterReady:C}=He(I=>({initialChapter:I.initialChapter,currentChapter:I.currentChapter,chapters:I.chapters,visibleChapters:I.visibleChapters,isCurrentChapterReady:I.isCurrentChapterReady})),{readingMode:m,readingDirection:v,readerWidth:E,pageScaleMode:b,shouldOffsetDoubleSpreads:w,imagePreLoadAmount:T,pageGap:R,customFilter:A,shouldStretchPage:P,isStaticNav:_}=J(I=>({readingMode:I.readingMode.value,readingDirection:I.readingDirection.value,readerWidth:I.readerWidth.value,pageScaleMode:I.pageScaleMode.value,shouldOffsetDoubleSpreads:I.shouldOffsetDoubleSpreads.value,imagePreLoadAmount:I.imagePreLoadAmount,pageGap:I.pageGap.value,customFilter:I.customFilter,shouldStretchPage:I.shouldStretchPage.value,isStaticNav:I.isStaticNav})),{resumeMode:B=ur.START}=(Ue=Fr().state)!=null?Ue:{resumeMode:ur.START},y=l.useRef(null),M=Hs(r,y),O=Ve(m),G=ge(m),me=ii(y);l.useEffect(()=>Ge().setScrollRef(y.current),[]);const oe=gr.useGetScrollbarSize("width",y.current),ie=gr.useGetScrollbarSize("height",y.current);l.useLayoutEffect(()=>{const{scrollbar:I}=Et();I.setXSize(oe),I.setYSize(ie)},[oe,ie]);const X=l.useRef(c.map(()=>null)),[{minChapterViewWidth:L,minChapterViewHeight:Pe,minChapterSizeSourceChapterId:Te},ve]=l.useState({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),[,ae]=l.useState({}),Se=Oi[m],pe=v===ut.LTR,De=l.useMemo(()=>p.findIndex(I=>I.id===(d==null?void 0:d.id)),[p,d==null?void 0:d.id]),Z=l.useMemo(()=>p.slice(Math.max(0,De-f.trailing),Math.min(p.length,De+f.leading+1)),[p,De,f.trailing,f.leading]),We=l.useMemo(()=>Z.findIndex(I=>I.id===(u==null?void 0:u.id)),[u,Z]),ye=l.useCallback((I,Ee,Q)=>{if(!G)return;const U=Q===Te;if(O){if(!U&&L>=I)return;ve({minChapterViewWidth:I,minChapterViewHeight:0,minChapterSizeSourceChapterId:Q});return}(U||Pe<Ee)&&ve({minChapterViewWidth:0,minChapterViewHeight:Ee,minChapterSizeSourceChapterId:Q})},[G,O,L,Pe,Te]);if(gi(a,c,g,t,G,X,n,v),ui(i,G,n,v,y),di(y),li(m,v,y),ci(s,y),ai(s,_),Ii(y,u==null?void 0:u.id,We,i,Z,f,m,v,b,P,E),l.useLayoutEffect(()=>{ve({minChapterViewWidth:0,minChapterViewHeight:0,minChapterSizeSourceChapterId:-1}),ae({})},[m]),!d||!u)throw new Error("ReaderViewer: illegal state - initialChapter and currentChapter should not be undefined");return o.jsx(k,{ref:M,sx:{width:"100%",height:"100%",overflow:"auto",flexWrap:"nowrap",...S(O&&Zr(E,b),{alignItems:"center"}),...S(!O,{...S(n==="ltr",{flexDirection:pe?"row":"row-reverse"}),...S(n==="rtl",{flexDirection:pe?"row-reverse":"row"})})},onClick:I=>!me&&z.handleClick(y.current,I),onScroll:()=>z.updateCurrentPageOnScroll(X,g-1,t,Se,v),children:Z.map((I,Ee)=>{var At,It,ce,Wt;const Q=Math.max(0,Z.length-Ee-1),U=Z[Q],je=(At=Z[Q+1])!=null?At:p[De+f.leading+1],we=(It=Z[Q-1])!=null?It:p[De-f.trailing-1],$e=U.id===d.id,_e=U.id===u.id,N=U.id===((ce=Z[We+1])==null?void 0:ce.id),fe=U.id===((Wt=Z[We-1])==null?void 0:Wt.id),Fe=d.sourceOrder>U.sourceOrder,Ae=d.sourceOrder<U.sourceOrder,Ie=f.lastLeadingChapterSourceOrder===U.sourceOrder,ot=f.lastTrailingChapterSourceOrder===U.sourceOrder,zt=Ie&&f.isLeadingChapterPreloadMode||ot&&f.isTrailingChapterPreloadMode,_t=Jr(Q,Z,f),it=U.id===Te;return o.jsx(Ti,{chapterId:U.id,previousChapterId:je==null?void 0:je.id,nextChapterId:we==null?void 0:we.id,isPreviousChapterVisible:_t.previous,isNextChapterVisible:_t.next,lastPageRead:lt(U.lastPageRead,0,U.pageCount-1),currentPageIndex:fs(i,U,u,_e,C,Fe,Ae,f),isInitialChapter:$e,isCurrentChapter:_e,isPreviousChapter:N,isNextChapter:fe,isLeadingChapter:Fe,isTrailingChapter:Ae,isPreloadMode:zt,imageRefs:X,transitionPageMode:h,retryFailedPagesKeyPrefix:x,readingMode:m,readerWidth:E,pageScaleMode:b,shouldOffsetDoubleSpreads:w,readingDirection:v,updateCurrentPageIndex:_e?t:Ze,scrollIntoView:_e&&f.scrollIntoView,resumeMode:ps(_e,$e,Fe,Ae,f.resumeMode,B),pageGap:R,imagePreLoadAmount:T,customFilter:A,shouldStretchPage:P,readerNavBarWidth:e,onSizeChange:ye,minWidth:it?0:L,minHeight:it?0:Pe,scrollElement:y.current},U.id)})})},Di=he(l.memo(Mi),[()=>({updateCurrentPageIndex:z.useUpdateCurrentPageIndex()}),Xe],["readerNavBarWidth","updateCurrentPageIndex"]),ji=Object.fromEntries(Object.values(Pt).map(e=>[e,{scopes:e}])),ne=(...e)=>{const[t,r,n,s]=e;return zn(t,r,{preventDefault:!0,...n,...ji.reader},s)},Xt=(e,t,r,n,s)=>{if(n){j.updateSetting(e,r[0]);return}const i=on(r.indexOf(t),r,s);if(i===void 0){j.deleteSetting(e);return}j.updateSetting(e,i)},Li=({scrollElementRef:e})=>{const t=j.useGetThemeDirection(),{enableScope:r,disableScope:n}=Mr(),{hotkeys:s}=J(a=>({hotkeys:a.hotkeys})),i=j.useExit();return ne(s[ee.PREVIOUS_PAGE],()=>z.openPage("previous")),ne(s[ee.NEXT_PAGE],()=>z.openPage("next")),ne(s[ee.SCROLL_BACKWARD],()=>{const a=Ge(),{readingMode:c,readingDirection:g,scrollAmount:h}=q();if(a.isActive){a.setDirection(ue.BACKWARD);return}e.current&&z.scroll(ue.BACKWARD,Jt[c.value],c.value,g.value,e.current,h)}),ne(s[ee.SCROLL_FORWARD],()=>{const a=Ge(),{readingMode:c,readingDirection:g,scrollAmount:h}=q();if(a.isActive){a.setDirection(ue.FORWARD);return}e.current&&z.scroll(ue.FORWARD,Jt[c.value],c.value,g.value,e.current,h)}),ne(s[ee.PREVIOUS_CHAPTER],()=>z.openChapter(K("previous","next",t)),[t]),ne(s[ee.NEXT_CHAPTER],()=>z.openChapter(K("next","previous",t)),[t]),ne(s[ee.TOGGLE_MENU],()=>Be().setIsVisible(!Be().isVisible)),ne(s[ee.CYCLE_SCALE_TYPE],()=>{Xt("pageScaleMode",q().pageScaleMode.value,kr,q().pageScaleMode.isDefault,!0)},[]),ne(s[ee.STRETCH_IMAGE],()=>j.updateSetting("shouldStretchPage",!q().shouldStretchPage.value)),ne(s[ee.OFFSET_SPREAD_PAGES],()=>j.setOffsetDoubleSpreads(!q().shouldOffsetDoubleSpreads.value)),ne(s[ee.CYCLE_READING_MODE],()=>{Xt("readingMode",q().readingMode.value,Hr,q().readingMode.isDefault,!0)}),ne(s[ee.CYCLE_READING_DIRECTION],()=>{Xt("readingDirection",q().readingDirection.value,Vr,q().readingDirection.isDefault,!0)}),ne(s[ee.TOGGLE_AUTO_SCROLL],()=>Ge().toggleActive(),{}),ne(s[ee.AUTO_SCROLL_SPEED_DECREASE],()=>j.updateSetting("autoScroll",{...q().autoScroll,value:Math.min(Ne.max,q().autoScroll.value+Ne.step)})),ne(s[ee.AUTO_SCROLL_SPEED_INCREASE],()=>j.updateSetting("autoScroll",{...q().autoScroll,value:Math.max(Ne.min,q().autoScroll.value-Ne.step)})),ne(s[ee.EXIT_READER],i,[i]),l.useEffect(()=>(r(Pt.READER),()=>n(Pt.READER)),[]),null},yi=()=>{l.useEffect(()=>()=>{Et().reset()},[])},Ni=(e,t,r,n,s)=>{var i;l.useEffect(()=>{var p;const a=(p=e.data)==null?void 0:p.manga;if(!a||t.loading||t.error)return;const c=fr(a,r),g=xs(a,c.shouldUseAutoWebtoonMode,c.readingMode),h={...r,readingMode:g?W.WEBTOON:r.readingMode},x=g?W.WEBTOON:c.readingMode.value,d=ms("global",{meta:n},h,void 0,x),u=fr(a,d);q().setSettings(u),s(!0)},[(i=e.data)==null?void 0:i.manga,r])},_r=Nt(5).seconds.inWholeMilliseconds,Bi=(e,t,r,n,s,i,a,c)=>{const{i18n:g,_:h}=F(),x=l.useRef(void 0),d=l.useRef(void 0),u=l.useRef(void 0),p=l.useRef(!0);l.useEffect(()=>{if(e||t||!r)return;const f=JSON.stringify(n)!==JSON.stringify(x.current);a&&f&&Wr(g._(Zt[n.value].title),{autoHideDuration:_r}),x.current=n;const m=JSON.stringify(s)!==JSON.stringify(d.current)||JSON.stringify(i)!==JSON.stringify(u.current);c&&m&&(dt().setShowPreview(!0),p.current&&setTimeout(()=>dt().setShowPreview(!1),_r)),d.current=s,u.current=i,p.current=!1},[e,t,r,n.value,n.isDefault,s.value,s.isDefault,i.value,i.isDefault])},ki=(e,t,r,n,s,i,a,c)=>{var u;const g=Wn(),h=Fr().state,{updateInitialChapter:x}=h!=null?h:{},d=x?void 0:n;l.useEffect(()=>{var T,R;const p=(T=e.data)==null?void 0:T.chapters.nodes,f=p?(R=p[p.length-t])!=null?R:null:void 0,C=d!=null?d:f,m=s!=null?s:f,v=(()=>{if(!p||!m)return[];const A=a?Es(r!=null?r:p,c):p;return(i?ke.removeDuplicates(m,A):A).map(_=>Gr(_.id))})(),E=f&&ke.getNextChapter(f,v,{offset:at.NEXT}),b=f&&ke.getNextChapter(f,v,{offset:at.PREVIOUS}),w=C!=null&&C.id!==(d==null?void 0:d.id);w&&g("",{replace:!0,state:{...h,updateInitialChapter:void 0}}),Qe().setReaderStateChapters(A=>{var _,B,y,M;const P=(f==null?void 0:f.id)!==((_=A.currentChapter)==null?void 0:_.id);return{...A,mangaChapters:(B=A.mangaChapters)!=null?B:p,chapters:v,initialChapter:C,chapterForDuplicatesHandling:m,currentChapter:f,nextChapter:E,previousChapter:b,isCurrentChapterReady:P?!1:A.isCurrentChapterReady,visibleChapters:w?{...Ft.chapters.visibleChapters,lastLeadingChapterSourceOrder:(y=C==null?void 0:C.sourceOrder)!=null?y:Ft.chapters.visibleChapters.lastLeadingChapterSourceOrder,lastTrailingChapterSourceOrder:(M=C==null?void 0:C.sourceOrder)!=null?M:Ft.chapters.visibleChapters.lastTrailingChapterSourceOrder,isLeadingChapterPreloadMode:!1,isTrailingChapterPreloadMode:!1,scrollIntoView:!!A.initialChapter}:A.visibleChapters}})},[(u=e.data)==null?void 0:u.chapters.nodes,t,i,a,d,c])},Hi=1,Ar=(e,t,r=!1,n=!1)=>{const s=Math.max(e*t,Hi),i=r?-s:s;return n?i*-1:i},Ir=(e,t,r)=>e*(t/100)/r;function Or(e,t,r,n,s){if(s(),!e){r(setInterval(()=>{n(t)},t),"interval");return}let i;const a=c=>{const g=c-(i!=null?i:c);i=c,n(g),r(requestAnimationFrame(a),"animationFrame")};r(requestAnimationFrame(a),"animationFrame")}const Vi=(e,t,r=Oe.Y,n=100,s=!1,i=!1)=>{const a=typeof e=="function",c=l.useRef(void 0),g=l.useRef(void 0),h=l.useRef(-1),[x,d]=l.useState(!1),[u,p]=l.useState(!1),[f,C]=l.useState({width:window.innerWidth,height:window.innerHeight});ze(document.documentElement,l.useCallback(()=>{const R=window.innerWidth,A=window.innerHeight;(f.width!==R||f.height!==A)&&C({width:R,height:A})},[]));const m=l.useCallback(()=>{clearTimeout(g.current),cancelAnimationFrame(h.current)},[]),v=l.useCallback(()=>{d(!0)},[]),E=l.useCallback(()=>{d(!1),p(!1),m()},[]),b=l.useCallback(()=>{if(x){E();return}v()},[x]),w=l.useCallback(()=>{p(!0)},[]),T=l.useCallback(()=>{p(!1)},[]);return l.useEffect(()=>{if(!e||!x)return()=>{};if(u)return m(),()=>{};const R=t*1e3;if(a)return Or(!1,R,O=>{g.current=O},e,m),()=>m();const A=e.current;if(!A)return()=>{};c.current||(c.current=getComputedStyle(A));const P=c.current.direction==="rtl",_=r!==Oe.Y,B=r!==Oe.X,y=Ir(window.innerWidth,n,R),M=Ir(window.innerHeight,n,R);return Or(i,R,(O,G)=>{switch(G){case"interval":g.current=O;break;case"animationFrame":h.current=O;break;default:throw new Error('Unexpected "type" ('.concat(G,")"))}},O=>{A.scrollBy({top:Number(B)*Ar(M,O,!1,s),left:Number(_)*Ar(y,O,P,s),behavior:i?void 0:"smooth"})},m),()=>m()},[e,t,n,f,x,u,s,i]),l.useMemo(()=>({isActive:x,isPaused:u,start:v,cancel:E,toggleActive:b,pause:w,resume:T}),[x,u,v,E,b,w,T])},zi=({themeDirection:e,combinedDirection:t})=>{const{scrollRef:r,direction:n}=Vt(d=>({scrollRef:d.scrollRef,direction:d.direction})),{readingMode:s,autoScroll:i}=J(d=>({readingMode:d.readingMode.value,autoScroll:d.autoScroll})),c=s===W.CONTINUOUS_HORIZONTAL&&e!==t?K(n===ue.BACKWARD,n===ue.FORWARD,t):n===ue.BACKWARD,g=ge(s),h=l.useCallback(()=>{z.openPage("next","ltr")},[]),x=Vi(g?r:h,i.value,Jt[s],jr.MEDIUM,c,i.smooth);return l.useEffect(()=>{const d=Ge();d.setIsActive(x.isActive),d.setIsPaused(x.isPaused),d.setStart(x.start),d.setCancel(x.cancel),d.setToggleActive(x.toggleActive),d.setPause(x.pause),d.setResume(x.resume)},[x]),null},Wi=he(l.memo(zi),[()=>({themeDirection:st().direction}),()=>({combinedDirection:j.useGetThemeDirection()})],["themeDirection","combinedDirection"]),Ui=({setOverride:e,readerNavBarWidth:t})=>{var oe,ie,X;const{i18n:r,_:n}=F(),s=wt(L=>L.manga),{mangaChapters:i,initialChapter:a,chapterForDuplicatesHandling:c,currentChapter:g}=He(L=>({mangaChapters:L.mangaChapters,initialChapter:L.initialChapter,chapterForDuplicatesHandling:L.chapterForDuplicatesHandling,currentChapter:L.currentChapter})),{shouldSkipDupChapters:h,shouldSkipFilteredChapters:x,backgroundColor:d,readingMode:u,tapZoneLayout:p,tapZoneInvertMode:f,shouldShowReadingModePreview:C,shouldShowTapZoneLayoutPreview:m}=J(L=>({shouldSkipDupChapters:L.shouldSkipDupChapters,shouldSkipFilteredChapters:L.shouldSkipFilteredChapters,backgroundColor:L.backgroundColor,readingMode:L.readingMode,tapZoneLayout:L.tapZoneLayout,tapZoneInvertMode:L.tapZoneInvertMode,shouldShowReadingModePreview:L.shouldShowReadingModePreview,shouldShowTapZoneLayoutPreview:L.shouldShowTapZoneLayoutPreview})),v=l.useRef(null),[E,b]=l.useState(!1),{chapterSourceOrder:w,mangaId:T}=Un(),R=Number(w),A=Number(T),P=Tt.useGetManga($n,A),_=Tt.useGetMangaChapters(Fn,A);Vs(!s||!g?r._({id:"H7O2dc",values:{mangaId:A,chapterSourceOrder:R}}):"".concat(s.title,": ").concat(g.name));const{metadata:B,settings:y,request:M}=vs(),O=ws(s!=null?s:sr),G=g===void 0||!E||P.loading||_.loading||M.loading,me=(ie=(oe=P.error)!=null?oe:_.error)!=null?ie:M.error;return l.useEffect(()=>{var L;Et().setManga((L=P.data)==null?void 0:L.manga)},[(X=P.data)==null?void 0:X.manga]),yi(),Ni(P,M,y,B,b),Bi(G,me,E,u,p,f,C,m),ki(_,R,i,a,c,h,x,O),l.useLayoutEffect(()=>(e({status:!0,value:o.jsxs(Y,{sx:{position:"absolute"},children:[o.jsx(Li,{scrollElementRef:v}),o.jsx(ti,{}),!v.current&&o.jsx(Y,{onClick:()=>Be().setIsVisible(!Be().isVisible),sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"transparent"}})]})}),()=>e({status:!1,value:null})),[v.current]),me?o.jsx(Lt,{message:r._({id:"6m5aox"}),messageExtra:$r(me),retry:()=>{P.error&&P.refetch().catch(ct("Reader::refetchManga")),M.error&&M.refetch().catch(ct("Reader::refetchDefaultSettings")),_.error&&_.refetch().catch(ct("Reader::refetchChapters"))}}):G?o.jsx(Y,{sx:{height:"100vh",width:"100vw",display:"grid",placeItems:"center"},children:o.jsx(kt,{})}):g===null?o.jsx(Lt,{message:r._({id:"aU8Fbq"})}):!s||!g?null:o.jsxs(Y,{sx:{position:"relative",display:"flex",flexDirection:"column",minWidth:"calc(100vw - ".concat(t,"px)"),maxWidth:"calc(100vw - ".concat(t,"px)"),width:"calc(100vw - ".concat(t,"px)"),height:"100vh",marginLeft:"".concat(t,"px"),transition:L=>"width 0.".concat(L.transitions.duration.shortest,"s, margin-left 0.").concat(L.transitions.duration.shortest,"s"),overflow:"auto",backgroundColor:Ur[d]},children:[o.jsx(Di,{ref:v}),o.jsx(ni,{}),o.jsx(oi,{}),o.jsx(Wi,{})]})},Ma=he(l.memo(Ui),[Xe],["setOverride","readerNavBarWidth"]);export{Ma as Reader};
