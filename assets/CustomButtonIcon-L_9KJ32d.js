import{c as T,j as e,u as E,r as F,a3 as K,d as W,e as M,_ as n,db as q,i as Y,af as J,a4 as Q,S as O,ae as f,L as X,dY as Z,C as z,I as ee,a5 as te,a7 as ae,B as oe}from"./index-Cfd-5nyg.js";import{c as re,d as u,C as se,e as ne,f as le,D as ie,R as de,V as ce,g as me,M as he}from"./useManageMangaLibraryState-BpdbUfZ1.js";import{C as pe,D as ue}from"./ChapterCardMetadata-CyJ7-Snj.js";import{D as ke}from"./Delete-BwouD7Nu.js";import{D as xe}from"./Download-COVBx23C.js";import{D as ge}from"./DoneAll-CXM9Q252.js";import{M as Ce}from"./MUI.util-wQL_FHN6.js";import{L as be}from"./ListCardContent-DRcDFweV.js";import{C as Ie}from"./Card-DurreyfO.js";import{C as fe}from"./CardActionArea-B_IdJQPR.js";import{C as je}from"./Checkbox-DCwwhdBB.js";const _e=T(e.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"})),De=T(e.jsx("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"})),Me=T(e.jsx("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"})),Te=T(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),we=({chapter:a,handleSelection:l,canBeDownloaded:c=!1,selectedChapters:i=[],onClose:r,selectable:o=!0})=>{var v,S,P;const{t:C}=E(),m=!!a,{isDownloaded:x,isRead:j,isBookmarked:d}=a!=null?a:{},b=(P=(S=F.useGetMangaChapters(K,(v=a==null?void 0:a.mangaId)!=null?v:-1,{skip:!a,fetchPolicy:"cache-only"}).data)==null?void 0:S.chapters.nodes)!=null?P:[],{settings:{deleteChaptersWithBookmark:I}}=W(),h=ne(m,q),k=re(m),t=le(m),{downloadableChapters:s,downloadedChapters:p,unbookmarkedChapters:w,bookmarkedChapters:y,unreadChapters:R,readChapters:A}=M.useMemo(()=>({downloadableChapters:n.getDownloadable(i),downloadedChapters:n.getDownloaded(i),unbookmarkedChapters:n.getNonBookmarked(i),bookmarkedChapters:n.getBookmarked(i),unreadChapters:n.getNonRead(i),readChapters:n.getRead(i)}),[i]),U=()=>{l==null||l(a.id,!0),r()},g=(V,$)=>{var H;const L=V==="mark_prev_as_read",N=L?"mark_as_read":V;if(N==="delete"&&a&&!n.isDeletable(a,I)){r();return}const D=(()=>{if(!a)return $;if(!L)return[a];const B=b.findIndex(({id:G})=>G===a.id);return B+1>b.length-1?[]:b.slice(B+1)})();if(!D.length){r();return}n.performAction(N,n.getIds(D),{chapters:D,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(H=D[0])==null?void 0:H.mangaId}).catch(Y()),r()};return e.jsxs(e.Fragment,{children:[m&&o&&e.jsx(u,{onClick:U,Icon:se,title:C("chapter.action.label.select")}),m&&e.jsx(u,{Icon:Te,disabled:!a.realUrl,onClick:()=>{window.open(a.realUrl,"_blank","noopener,noreferrer"),r()},title:C("chapter.action.label.open_on_source")}),k(c)&&e.jsx(u,{Icon:xe,disabled:t(!s.length),onClick:()=>g("download",s),title:h("download",s.length)}),k(x)&&e.jsx(u,{Icon:ke,disabled:t(!p.length),onClick:()=>g("delete",n.getDeletable(p,I)),title:h("delete",p.length)}),k(!d)&&e.jsx(u,{Icon:Me,disabled:t(!w.length),onClick:()=>g("bookmark",w),title:h("bookmark",w.length)}),k(d)&&e.jsx(u,{Icon:De,disabled:t(!y.length),onClick:()=>g("unbookmark",y),title:h("unbookmark",y.length)}),k(!j)&&e.jsx(u,{Icon:ie,disabled:t(!R.length),onClick:()=>g("mark_as_read",R),title:h("mark_as_read",R.length)}),k(j)&&e.jsx(u,{Icon:de,disabled:t(!A.length),onClick:()=>g("mark_as_unread",A),title:h("mark_as_unread",A.length)}),m&&e.jsx(u,{onClick:()=>g("mark_prev_as_read",[]),Icon:ge,title:C("chapter.action.mark_as_read.add.label.action.previous")})]})},Ee=M.memo(a=>{const{t:l}=E(),c=J(),i=M.useRef(null),{mode:r="manga.page",chapter:o,showChapterNumber:C,onSelect:m,selected:x,selectable:j=!0,isActiveChapter:d=!1}=a,_=x!==null,{isDownloaded:b}=o,I=t=>{_&&(t.preventDefault(),t.stopPropagation(),m(o.id,!x,t.shiftKey))},h=(t,s)=>{t.stopPropagation(),t.preventDefault(),s==null||s(t)},k=ce((t,{context:s})=>{if(!_&&i.current){h(t,()=>s==null?void 0:s(i.current));return}t.shiftKey=!0,I(t)});return e.jsx(Q,{variant:"popover",popupId:"chapter-card-action-menu",children:t=>{var s;return e.jsxs(O,{sx:{pt:1,px:1},children:[e.jsx(Ie,{sx:{touchCallout:"none",...f(r==="reader"&&d,{backgroundColor:"primary.main"})},children:e.jsx(fe,{component:X,to:n.getReaderUrl(o),style:{color:c.palette.text[o.isRead?"disabled":"primary"]},state:n.getReaderOpenChapterLocationState(o,!0),replace:r==="reader",onClick:p=>I(p),...k(t.open),children:e.jsxs(be,{children:[e.jsx(pe,{title:C?"".concat(l("chapter.title_one")," ").concat(o.chapterNumber):o.name,secondaryText:o.scanlator,ternaryText:"".concat(Z(Number((s=o.uploadDate)!=null?s:0),!0)).concat(b?" â€¢ ".concat(l("chapter.status.label.downloaded")):""),infoIcons:o.isBookmarked&&e.jsx(_e,{color:r==="reader"&&d?"secondary":"primary"}),slotProps:{title:{variant:"h6",component:"h3",sx:f(r==="reader"&&d,{color:c.palette.primary.contrastText})},secondaryText:{sx:f(r==="reader"&&d,{color:c.palette.primary.contrastText})},ternaryText:{sx:f(r==="reader"&&d,{color:c.palette.primary.contrastText})}}}),e.jsx(ue,{chapterId:o.id,color:r==="reader"&&d?c.palette.primary.contrastText:void 0}),e.jsx(O,{sx:{minHeight:"48px"},children:x===null?e.jsx(z,{title:l("global.button.options"),children:e.jsx(ee,{ref:i,...Ce.preventRippleProp(te(t),{onClick:p=>h(p)}),"aria-label":"more",sx:{color:"inherit",...f(r==="reader"&&d,{color:"primary.contrastText"})},children:e.jsx(me,{})})}):e.jsx(z,{title:l(x?"global.button.deselect":"global.button.select"),children:e.jsx(je,{checked:x})})})]})})}),!_&&t.isOpen&&e.jsx(he,{...ae(t),children:p=>e.jsx(we,{onClose:p,chapter:o,handleSelection:()=>m(o.id,!0),canBeDownloaded:n.isDownloadable(o),selectable:j})})]})}})}),Ue=M.forwardRef(({children:a,...l},c)=>e.jsx(oe,{ref:c,...l,sx:{minWidth:"unset",px:"10px",...l.sx},children:a}));export{_e as B,Ee as C,Te as L,we as a,Ue as b};
