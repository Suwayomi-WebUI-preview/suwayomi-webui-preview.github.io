import{w as it,j as t,R as y,T as Lt,O as Tt,r as lt,i as ct,B as $,az as ut,U as pt,S as U,c as h,aS as T,an as Ft,u as z,b as B,s as H,N as It,V as Et,e as $t,aj as ot,W as kt,aT as P,aU as Mt,a as E,g as _t,I as Ot,aV as Pt,aW as wt,aX as At}from"./index-B5aGC8by.js";import{d as Rt,u as Dt,A as Gt,S as qt}from"./AppbarSearch-CnPfJ2mw.js";import{d as Nt}from"./Favorite-e2jHZFmI.js";import{d as dt}from"./FilterList-DdS9Sf0R.js";import{G as Bt}from"./GridLayouts-DSsloLP9.js";import{S as Ut,O as zt}from"./SortRadioInput-91ELAj3V.js";import{C as Ht}from"./CheckboxInput-C4QZoErh.js";import{a as mt,I as gt,M as Vt,b as Kt}from"./TextField-DydWwQbC.js";import{C as ft}from"./Collapse-BQIUub-F.js";import{u as Wt}from"./useDebounce-BhLQSDhX.js";import{I as Yt}from"./InputAdornment-zC2HI-g-.js";import{T as Qt}from"./ThreeStateCheckboxInput-jPXIZXel.js";import{S as Xt}from"./StyledFab-BQ5uB9n_.js";import{M as Jt,g as Zt}from"./MangaGrid-DP-XdEU5.js";import{u as te}from"./metadataServerSettings-nxgrz9XV.js";import{L as ee}from"./Link-CincsVx3.js";import"./useManageMangaLibraryState-ETB_Z_jq.js";import"./index-Chhl_QrM.js";import"./CardContent-yoxmt5xa.js";import"./Avatar-inmYLceb.js";import"./SpinnerImage-DY7PfT9m.js";import"./ListPreference-Cls_zV2z.js";import"./Checkbox-_9CrxReW.js";import"./SwitchBase-SMFwHQ07.js";import"./NumberSetting-CUaeV-og.js";import"./Info-D2pNk222.js";import"./useMobilePicker-D3Af0UjT.js";import"./Chip-XYuVsKGf.js";import"./SelectSetting-CzaVLHQs.js";import"./Select-BmQhRII8.js";import"./Mangas-D61wmQuB.js";import"./Chapters-CR-FHP0x.js";import"./ViewModule-RjgFzSUe.js";import"./Delete-CSXImgHK.js";import"./Sync-CH7_VNAq.js";import"./PlayArrow-Ba6jhIqm.js";import"./metadata-Bm3ZnyOZ.js";function se(){const{options:{SourcegridLayout:e},setOptions:r}=it();function o(n){r(s=>({...s,SourcegridLayout:n}))}return t.jsx(Bt,{gridLayout:e,onChange:o})}const ae=e=>{const{state:r,name:o,position:n,group:s,updateFilterValue:i,update:a}=e,[l,p]=y.useState(r),c=d=>{p(d.target.checked);const m=a.filter(j=>!(n===j.position&&s===j.group));i([...m,{type:"checkBoxState",position:n,state:d.target.checked,group:s}])};return r!==void 0?t.jsx(Ht,{label:o,checked:l,onChange:c}):null},ne=({name:e})=>t.jsx(Lt,{sx:{mt:2},variant:"subtitle2",children:e},e);function re(e,r,o,n,s,i,a){const[l,p]=y.useState(o);if(e){const c=m=>{const j=e.indexOf("".concat(m.target.value));p(j);const g=i.filter(u=>!(n===u.position&&a===u.group));s([...g,{type:"selectState",position:n,state:j,group:a}])},d=e.map(m=>t.jsx(Tt,{value:m,children:m},"".concat(r," ").concat(m)));return t.jsxs(mt,{sx:{my:1},variant:"standard",children:[t.jsx(gt,{children:r}),t.jsx(Vt,{name:r,value:e[l],label:r,onChange:c,children:d})]})}return null}const oe=({values:e,name:r,state:o,position:n,updateFilterValue:s,update:i,group:a})=>re(e,r,o,n,s,i,a);var V={},ie=ct;Object.defineProperty(V,"__esModule",{value:!0});var K=V.default=void 0,le=ie(lt()),ce=t;K=V.default=(0,le.default)((0,ce.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var W={},ue=ct;Object.defineProperty(W,"__esModule",{value:!0});var Y=W.default=void 0,pe=ue(lt()),de=t;Y=W.default=(0,pe.default)((0,de.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");const me=e=>{const{values:r,name:o,state:n,position:s,group:i,updateFilterValue:a,update:l}=e,[p,c]=y.useState(n),[d,m]=y.useState(!1),j=()=>{m(!d)};if(r){const g=u=>{const f=p;f.index===u?f.ascending=!f.ascending:f.ascending=!0,f.index=u,c(f);const v=l.filter(C=>!(s===C.position&&i===C.group));a([...v,{type:"sortState",position:s,state:f,group:i}])};return t.jsxs($,{sx:{mx:-2},children:[t.jsxs(ut,{onClick:j,children:[t.jsx(pt,{primary:o}),d?t.jsx(K,{}):t.jsx(Y,{})]}),t.jsx(ft,{in:d,children:t.jsx(U,{sx:{mx:4},children:r.map((u,f)=>t.jsx(Ut,{label:u,checked:p.index===f,sortDescending:!p.ascending,onClick:()=>g(f)},"".concat(o," ").concat(u)))})})]})}return null},ge=e=>{const{state:r,name:o,position:n,group:s,updateFilterValue:i,update:a}=e,[l,p]=y.useState(r||""),c=Wt(l,500);return h.useEffect(()=>{const d=a.filter(m=>!(n===m.position&&s===m.group));i([...d,{type:"textState",position:n,state:c,group:s}])},[c]),r!==void 0?t.jsxs(mt,{sx:{my:1},variant:"standard",children:[t.jsx(gt,{children:o}),t.jsx(Kt,{name:o,value:l,onChange:({target:{value:d}})=>p(d),endAdornment:t.jsx(Yt,{position:"end",children:t.jsx(Rt,{})})})]}):null},fe=e=>{switch(e){case T.Ignore:return 0;case T.Include:return 1;case T.Exclude:return 2;default:throw new Error("Unexpected TriState ".concat(e))}},xe=e=>{switch(e){case 0:return T.Ignore;case 1:return T.Include;case 2:return T.Exclude;default:throw new Error("Unexpected state number ".concat(e))}},he=e=>{const{state:r,name:o,position:n,group:s,updateFilterValue:i,update:a}=e,[l,p]=y.useState(fe(r)),c=d=>{const m=d===void 0?0:d?1:2;p(m);const j=a.filter(g=>!(n===g.position&&s===g.group));i([...j,{type:"triState",position:n,state:xe(m),group:s}])};return r!==void 0?t.jsx(Qt,{label:o,checked:[void 0,!0,!1][l],onChange:d=>c(d)}):null},Se=e=>{const{state:r,name:o,position:n,updateFilterValue:s,update:i}=e,[a,l]=y.useState(!1);return t.jsxs($,{sx:{mx:-2},children:[t.jsxs(ut,{onClick:()=>l(!a),children:[t.jsx(pt,{primary:o}),a?t.jsx(K,{}):t.jsx(Y,{})]}),t.jsx(ft,{in:a,children:t.jsx(U,{sx:{mx:4},children:t.jsx(xt,{sourceFilter:r,group:n,updateFilterValue:s,update:i})})})]})},je=({name:e})=>t.jsx(Ft,{sx:{my:1},textAlign:"center",children:e},e);function xt({sourceFilter:e,group:r,updateFilterValue:o,update:n}){return t.jsx(U,{children:e.map((s,i)=>{var l,p;let a=n.find(c=>c.group===r&&c.position===i);switch(a=a&&a.state,s.type){case"CheckBoxFilter":return t.jsx(ae,{name:s.name,state:a!=null?a:s.CheckBoxFilterDefault,position:i,group:r,updateFilterValue:o,update:n},"filters ".concat(s.name));case"GroupFilter":return t.jsx(Se,{name:s.name,state:s.filters,position:i,updateFilterValue:o,update:n},"filters ".concat(s.name));case"HeaderFilter":return t.jsx(ne,{name:s.name},"filters ".concat(s.name));case"SelectFilter":return t.jsx(oe,{name:s.name,values:s.values,state:a!=null?parseInt(a,10):s.SelectFilterDefault,position:i,group:r,updateFilterValue:o,update:n},"filters ".concat(s.name));case"SeparatorFilter":return t.jsx(je,{name:s.name},"filters ".concat(s.name));case"SortFilter":return t.jsx(me,{name:s.name,values:s.values,state:a!=null?a:{ascending:(l=s.SortFilterDefault)==null?void 0:l.ascending,index:(p=s.SortFilterDefault)==null?void 0:p.index},position:i,group:r,updateFilterValue:o,update:n},"filters ".concat(s.name));case"TextFilter":return t.jsx(ge,{name:s.name,state:a!=null?a:s.TextFilterDefault,position:i,group:r,updateFilterValue:o,update:n},"filters ".concat(s.name));case"TriStateFilter":return t.jsx(he,{name:s.name,state:a!=null?a:s.TriStateFilterDefault,position:i,group:r,updateFilterValue:o,update:n},"filters ".concat(s.name));default:throw new Error('Unknown source filter "'.concat(s,'"'))}})},"filters ".concat(r))}function be({sourceFilter:e,updateFilterValue:r,resetFilterValue:o,setTriggerUpdate:n,update:s}){const{t:i}=z(),[a,l]=h.useState(!1);function p(){o(0),l(!1)}function c(){n(0),l(!1)}return t.jsxs(t.Fragment,{children:[t.jsxs(Xt,{onClick:()=>l(!a),variant:"extended",color:"primary",children:[t.jsx(dt,{}),i("global.button.filter")]}),t.jsxs(zt,{open:a,onClose:()=>l(!1),children:[t.jsxs($,{sx:{display:"flex",p:2,pb:0},children:[t.jsx(B,{onClick:p,children:i("global.button.reset")}),t.jsx(B,{sx:{marginLeft:"auto"},variant:"contained",onClick:c,children:i("global.button.submit")})]}),t.jsx($,{sx:{pb:2,mx:2},children:t.jsx(xt,{sourceFilter:e,updateFilterValue:r,group:void 0,update:s})})]})]})}function ve(e){const{t:r}=z(),{mangas:o,isLoading:n,hasNextPage:s,loadMore:i,message:a,messageExtra:l,gridLayout:p}=e,c=o,d=c.length===0&&o.length>0;return t.jsx(Jt,{mangas:c,isLoading:n,hasNextPage:s,loadMore:i,message:d?r("manga.error.label.no_matches"):a,messageExtra:l,gridLayout:p,inLibraryIndicator:!0,mode:"source"})}const Ce=H("div")(({theme:e})=>({display:"flex",position:"fixed",top:"64px",width:"100%",zIndex:1,backgroundColor:e.palette.background.default,[e.breakpoints.down("sm")]:{top:"56px"}})),N=H(B)(()=>({marginTop:"13px",marginBottom:"13px",marginLeft:"13px"})),ye=H($,{shouldForwardProp:e=>e!=="hasContent"})(({theme:e,hasContent:r})=>({marginTop:"calc(62.5px ".concat(r?"- 8px":"",")"),minHeight:"calc(100vh - 64px - 62.5px)",position:"relative",[e.breakpoints.down("sm")]:{marginTop:"calc(62.5px - 8px ".concat(r?"- 8px":"",")"),minHeight:"calc(100vh - 64px - 64px - 62.5px)"}}));var Le=(e=>(e[e.POPULAR=0]="POPULAR",e[e.LATEST=1]="LATEST",e[e.SEARCH=2]="SEARCH",e))(Le||{});const Te={0:"manga.error.label.no_mangas_found",1:"manga.error.label.no_mangas_found",2:"manga.error.label.no_matches"},Fe=e=>{const r=[];return e.forEach(o=>{r.some(s=>s.id===o.id)||r.push(o)}),r},Ie=(e,r,o,n,s,i)=>{let a;switch(r){case 0:a=E.useGetSourcePopularMangas(e,s);break;case 1:a=E.useGetSourceLatestMangas(e,s);break;case 2:a=E.useSourceSearch(e,o!=null?o:"",n.map(g=>{const{position:u,state:f,group:v}=g;return v!==void 0?{position:v,groupChange:{position:u,[g.type]:f}}:{position:u,[g.type]:f}}),s);break;default:throw new Error('Unknown ContentType "'.concat(r,'"'))}const l=a[1],p=l.findLastIndex(g=>{var u;return!!((u=g.data)!=null&&u.fetchSourceManga)}),c=l[p],d=l.slice(-1)[0].isLoading;let m=!d;const j=h.useMemo(()=>{let g=[];return l.forEach((u,f)=>{var k,I;const v=(I=(k=u.data)==null?void 0:k.fetchSourceManga.mangas)!=null?I:[],C=Fe([...g,...v]),F=v.filter(S=>!!C.find(A=>A.id===S.id)).filter(S=>!i||!S.inLibrary);m=!d&&l.length===f+1&&!F.length&&!!v.length,g=[...g,...F]}),g},[l,i]);return p===-1?[a[0],{...a[1][a[1].length-1],filteredOutAllItemsOfFetchedPage:m}]:[a[0],{...l[l.length-1],data:{...c.data,fetchSourceManga:{...c.data.fetchSourceManga,hasNextPage:l.length>p+1?!1:c.data.fetchSourceManga.hasNextPage,mangas:j}},filteredOutAllItemsOfFetchedPage:m}]};function ms(){var st,at,nt,rt;const{t:e}=z(),{setTitle:r,setAction:o}=h.useContext(It),{sourceId:n}=Et(),s=$t(),i=ot(),{key:a,state:l}=i,{contentType:p=0,clearCache:c=!1}=(st=ot().state)!=null?st:{};kt("browse");const[d,m]=h.useState(!0);h.useEffect(()=>{m(!1)},[]);const{settings:{hideLibraryEntries:j}}=te(),{options:g}=it(),[u]=Dt("query",qt),[f,v]=P("source-mangas-".concat(n,"-filters"),[]),[C,Q]=P("source-mangas-location-".concat(a,"-").concat(n,"-filters"),f!=null?f:[]),[F,w]=h.useState(C),[k,I]=P("source-mangas-".concat(n,"-content-type"),p),[S,A]=P("source-mangas-location-".concat(a,"-").concat(n,"-content-type"),u?2:k);h.useEffect(()=>()=>{v(void 0),I(void 0)},[n]);const M=h.useCallback(()=>{Mt.session.setItem(Zt(i),void 0,!1),window.scrollTo(0,0)},[a]),X=b=>{v(b),Q(b),M()},J=b=>{I(b),A(b)},[Z,{data:L,isLoading:R,size:D,abortRequest:ht,filteredOutAllItemsOfFetchedPage:G}]=Ie(n,S,u,C,1,j),tt=R||G,et=(at=L==null?void 0:L.fetchSourceManga.mangas)!=null?at:[],_=(nt=L==null?void 0:L.fetchSourceManga.hasNextPage)!=null?nt:!1,{data:q}=E.useGetSource(n),x=q==null?void 0:q.source,St=(rt=x==null?void 0:x.filters)!=null?rt:[],jt=tt?void 0:e(Te[S]),bt=n==="0"?t.jsxs(t.Fragment,{children:[t.jsxs("span",{children:[e("source.local_source.label.checkout")," "]}),t.jsx(ee,{href:"https://github.com/Suwayomi/Suwayomi-Server/wiki/Local-Source",children:e("source.local_source.label.guide")})]}):void 0,O=h.useCallback((b,yt)=>{J(b),M(),u&&!yt&&s({pathname:""},{state:{...l,contentType:b}})},[J,u,M]);!!u&&S!==2&&O(2,u);const vt=h.useCallback(()=>{_&&Z(D+1)},[D,_,S]),Ct=h.useCallback(()=>{w([]),X([])},[n,S]);return h.useEffect(()=>{G&&_&&!R&&Z(D+1)},[G,R]),h.useEffect(()=>{!c||!At.REVALIDATION.includes(n)||E.clearBrowseCacheFor(n)},[c]),h.useEffect(()=>()=>{S!==2||d||(ht(new Error("SourceMangas(".concat(n,"): search string changed"))),M())},[u]),h.useEffect(()=>{var b;return r((b=x==null?void 0:x.displayName)!=null?b:e("source.title")),o(t.jsxs(t.Fragment,{children:[t.jsx(Gt,{}),t.jsx(se,{}),(x==null?void 0:x.isConfigurable)&&t.jsx(_t,{title:e("settings.title"),children:t.jsx(Ot,{onClick:()=>s("/sources/".concat(n,"/configure/")),"aria-label":"display more actions",edge:"end",color:"inherit",size:"large",children:t.jsx(Pt,{})})})]})),()=>{r(""),o(null)}},[e,x]),t.jsxs(ye,{hasContent:!!et.length,children:[t.jsxs(Ce,{children:[t.jsx(N,{variant:S===0?"contained":"outlined",startIcon:t.jsx(Nt,{}),onClick:()=>O(0),children:e("global.button.popular")}),(x==null?void 0:x.supportsLatest)===void 0||x.supportsLatest?t.jsx(N,{disabled:!(x!=null&&x.supportsLatest),variant:S===1?"contained":"outlined",startIcon:t.jsx(wt,{}),onClick:()=>O(1),children:e("global.button.latest")}):null,t.jsx(N,{variant:S===2?"contained":"outlined",startIcon:t.jsx(dt,{}),onClick:()=>O(2,u),children:e("global.button.filter")})]}),t.jsx(ve,{mangas:et,hasNextPage:_,loadMore:vt,message:jt,messageExtra:bt,isLoading:tt,gridLayout:g.SourcegridLayout},S),S===2&&t.jsx(be,{sourceFilter:St,updateFilterValue:w,setTriggerUpdate:()=>{X(F)},resetFilterValue:Ct,update:F})]})}export{Le as SourceContentType,ms as SourceMangas};
