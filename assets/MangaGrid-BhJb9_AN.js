import{ce as Te,cf as Ge,f as g,cg as Pe,j as t,ah as Ee,ch as _e,ci as Ae,al as Le,af as Be,cj as $e,a4 as q,ag as Oe,ap as Ne,aA as Fe,aB as xe,v as We,ck as ie,cl as ze,cm as Ue,R as V,G as N,a9 as He,u as Q,L as Z,A as X,aC as Ve,o as Me,k as we,h as Ke,aD as Ye,e as se,p as Je,q as Xe,F as qe,w as Qe,b as z,B as O,m as Ze,a7 as et,C as U,I as tt,a0 as L,bL as ae,T as ke,a8 as nt,aa as ot,H as st,P as be,i as ve}from"./index-C3vZ8EsQ.js";import{E as rt}from"./EmptyViewAbsoluteCentered-CNYntR8-.js";import{e as it,g as A,h as at,j as ct,k as lt,D as dt,R as ut,d as ft,F as pt,l as ye,c as mt,V as ht,M as gt}from"./useManageMangaLibraryState-CZlyuCEe.js";import{D as xt}from"./Delete-DBcx6u7Y.js";import{D as bt}from"./Download-CyhuMnS1.js";import{a as yt,S as jt,L as Ct,T as Mt,C as wt}from"./ContinueReadingTooltip-DAJJyrwc.js";import{S as kt}from"./Sync-DJdfLFzs.js";import{a as k,c as vt,b as It}from"./Mangas-CjMffGX2.js";import{u as ce}from"./use-merged-ref-DX8VLHOB.js";import{C as ne}from"./CheckboxInput-BzggbRel.js";import{F as Rt}from"./FormGroup-CdrUsW2j.js";import{S as St}from"./SpinnerImage-BkoXIlhe.js";import{M as J}from"./MUI.util-CEodEA2f.js";import{C as Dt}from"./Checkbox-D62wF9MZ.js";import{L as Tt}from"./Link-CmYuEZu8.js";import{C as Ie}from"./Card-BgfMKOaf.js";import{C as Re}from"./CardActionArea-DnPkin7d.js";import{L as Gt}from"./ListCardAvatar-C30eo_lS.js";import{L as Pt}from"./ListCardContent-D89CdLvL.js";import{P as Et}from"./PlayArrow-D9vL68_f.js";import{C as _t}from"./Chapters-CYL-Ii87.js";import{D as At}from"./StyledFab-BIcED-S_.js";import{J as Lt}from"./index-BjmOYfU3.js";import{V as Bt}from"./Virtuoso.util-D0nXdgho.js";const $t=(e,n)=>e.filter(o=>n.includes(o)),K=(e,n,o)=>{const i=e.keys[0];Array.isArray(n)?n.forEach((r,s)=>{o((a,u)=>{s<=e.keys.length-1&&(s===0?Object.assign(a,u):a[e.up(e.keys[s])]=u)},r)}):n&&typeof n=="object"?(Object.keys(n).length>e.keys.length?e.keys:$t(e.keys,Object.keys(n))).forEach(s=>{if(e.keys.includes(s)){const a=n[s];a!==void 0&&o((u,f)=>{i===s?Object.assign(u,f):u[e.up(s)]=f},a)}}):(typeof n=="number"||typeof n=="string")&&o((r,s)=>{Object.assign(r,s)},n)};function oe(e){return"--Grid-".concat(e,"Spacing")}function re(e){return"--Grid-parent-".concat(e,"Spacing")}const je="--Grid-columns",H="--Grid-parent-columns",Ot=({theme:e,ownerState:n})=>{const o={};return K(e.breakpoints,n.size,(i,r)=>{let s={};r==="grow"&&(s={flexBasis:0,flexGrow:1,maxWidth:"100%"}),r==="auto"&&(s={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof r=="number"&&(s={flexGrow:0,flexBasis:"auto",width:"calc(100% * ".concat(r," / var(").concat(H,") - (var(").concat(H,") - ").concat(r,") * (var(").concat(re("column"),") / var(").concat(H,")))")}),i(o,s)}),o},Nt=({theme:e,ownerState:n})=>{const o={};return K(e.breakpoints,n.offset,(i,r)=>{let s={};r==="auto"&&(s={marginLeft:"auto"}),typeof r=="number"&&(s={marginLeft:r===0?"0px":"calc(100% * ".concat(r," / var(").concat(H,") + var(").concat(re("column"),") * ").concat(r," / var(").concat(H,"))")}),i(o,s)}),o},Ft=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={[je]:12};return K(e.breakpoints,n.columns,(i,r)=>{const s=r!=null?r:12;i(o,{[je]:s,"> *":{[H]:s}})}),o},Wt=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return K(e.breakpoints,n.rowSpacing,(i,r)=>{var a;const s=typeof r=="string"?r:(a=e.spacing)==null?void 0:a.call(e,r);i(o,{[oe("row")]:s,"> *":{[re("row")]:s}})}),o},zt=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return K(e.breakpoints,n.columnSpacing,(i,r)=>{var a;const s=typeof r=="string"?r:(a=e.spacing)==null?void 0:a.call(e,r);i(o,{[oe("column")]:s,"> *":{[re("column")]:s}})}),o},Ut=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return K(e.breakpoints,n.direction,(i,r)=>{i(o,{flexDirection:r})}),o},Ht=({ownerState:e})=>({minWidth:0,boxSizing:"border-box",...e.container&&{display:"flex",flexWrap:"wrap",...e.wrap&&e.wrap!=="wrap"&&{flexWrap:e.wrap},gap:"var(".concat(oe("row"),") var(").concat(oe("column"),")")}}),Vt=e=>{const n=[];return Object.entries(e).forEach(([o,i])=>{i!==!1&&i!==void 0&&n.push("grid-".concat(o,"-").concat(String(i)))}),n},Kt=(e,n="xs")=>{function o(i){return i===void 0?!1:typeof i=="string"&&!Number.isNaN(Number(i))||typeof i=="number"&&i>0}if(o(e))return["spacing-".concat(n,"-").concat(String(e))];if(typeof e=="object"&&!Array.isArray(e)){const i=[];return Object.entries(e).forEach(([r,s])=>{o(s)&&i.push("spacing-".concat(r,"-").concat(String(s)))}),i}return[]},Yt=e=>e===void 0?[]:typeof e=="object"?Object.entries(e).map(([n,o])=>"direction-".concat(n,"-").concat(o)):["direction-xs-".concat(String(e))];function Jt(e,n){e.item!==void 0&&delete e.item,e.zeroMinWidth!==void 0&&delete e.zeroMinWidth,n.keys.forEach(o=>{e[o]!==void 0&&delete e[o]})}const Xt=$e(),qt=Te("div",{name:"MuiGrid",slot:"Root"});function Qt(e){return Ae({props:e,name:"MuiGrid",defaultTheme:Xt})}function Zt(e={}){const{createStyledComponent:n=qt,useThemeProps:o=Qt,useTheme:i=Ge,componentName:r="MuiGrid"}=e,s=(l,c)=>{const{container:m,direction:d,spacing:x,wrap:h,size:p}=l,M={root:["root",m&&"container",h!=="wrap"&&"wrap-xs-".concat(String(h)),...Yt(d),...Vt(p),...m?Kt(x,c.breakpoints.keys[0]):[]]};return Le(M,b=>Be(r,b),{})};function a(l,c,m=()=>!0){const d={};return l===null||(Array.isArray(l)?l.forEach((x,h)=>{x!==null&&m(x)&&c.keys[h]&&(d[c.keys[h]]=x)}):typeof l=="object"?Object.keys(l).forEach(x=>{const h=l[x];h!=null&&m(h)&&(d[x]=h)}):d[c.keys[0]]=l),d}const u=n(Ft,zt,Wt,Ot,Ut,Ht,Nt),f=g.forwardRef(function(c,m){var W,de,ue,fe,pe,me;const d=i(),x=o(c),h=Pe(x);Jt(h,d.breakpoints);const{className:p,children:M,columns:b=12,container:w=!1,component:S="div",direction:y="row",wrap:C="wrap",size:I={},offset:v={},spacing:D=0,rowSpacing:G=D,columnSpacing:E=D,unstable_level:R=0,...T}=h,P=a(I,d.breakpoints,_=>_!==!1),Y=a(v,d.breakpoints),ee=(W=c.columns)!=null?W:R?void 0:b,j=(de=c.spacing)!=null?de:R?void 0:D,F=(fe=(ue=c.rowSpacing)!=null?ue:c.spacing)!=null?fe:R?void 0:G,B=(me=(pe=c.columnSpacing)!=null?pe:c.spacing)!=null?me:R?void 0:E,$={...h,level:R,columns:ee,container:w,direction:y,wrap:C,spacing:j,rowSpacing:F,columnSpacing:B,size:P,offset:Y},te=s($,d);return t.jsx(u,{ref:m,as:S,ownerState:$,className:Ee(te.root,p),...T,children:g.Children.map(M,_=>{var he,ge;return g.isValidElement(_)&&_e(_,["Grid"])&&w&&_.props.container?g.cloneElement(_,{unstable_level:(ge=(he=_.props)==null?void 0:he.unstable_level)!=null?ge:R+1}):_})})});return f.muiName="Grid",f}const le=Zt({createStyledComponent:q("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:o}=e;return[n.root,o.container&&n.container]}}),componentName:"MuiGrid",useThemeProps:e=>Oe({props:e,name:"MuiGrid"}),useTheme:Ne}),en=({MenuItemProps:e,className:n,label:o,LeftIcon:i,renderLabel:r,RightIcon:s,...a})=>t.jsxs(Fe,{...e,className:n,...a,children:[i&&t.jsx(xe,{children:t.jsx(i,{fontSize:"small"})}),t.jsx(We,{children:o}),s&&t.jsx(xe,{style:{minWidth:0},children:t.jsx(s,{fontSize:"small"})})]}),tn=({ref:e,...n})=>{const{parentMenuOpen:o,label:i,renderLabel:r,RightIcon:s=ie(Ue,ze),LeftIcon:a,children:u,className:f,tabIndex:l,ContainerProps:c={},MenuProps:m,...d}=n,x=V.useIsTouchDevice(),{ref:h,...p}=c,M=g.useRef(null),b=ce(e,M),w=g.useRef(null),S=ce(h,w),y=g.useRef(null),[C,I]=g.useState(!1),v=j=>{if(C!==j){if(n.disabled){I(!1);return}I(j)}},D=j=>{x||(v(!0),p.onMouseEnter&&p.onMouseEnter(j))},G=j=>{v(!1),p.onMouseLeave&&p.onMouseLeave(j)},E=()=>{var F,B;const j=(B=(F=w.current)==null?void 0:F.ownerDocument.activeElement)!=null?B:null;if(y.current==null)return!1;for(const $ of y.current.children)if($===j)return!0;return!1},R=j=>{x||(j.target===w.current&&v(!0),p.onFocus&&p.onFocus(j))},T=j=>{v(!C),p.onClick&&p.onClick(j)},P=j=>{var B,$,te;if(j.key==="Escape")return;E()&&j.stopPropagation();const F=(B=w.current)==null?void 0:B.ownerDocument.activeElement;if(j.key==="ArrowLeft"&&E()&&(($=w.current)==null||$.focus()),j.key==="ArrowRight"&&j.target===w.current&&j.target===F){const W=(te=y.current)==null?void 0:te.children[0];W==null||W.focus()}},Y=C&&o;let ee;return n.disabled||(ee=l!==void 0?l:-1),t.jsxs(N,{...p,ref:S,onFocus:R,onClick:T,tabIndex:ee,onMouseEnter:D,onMouseLeave:G,onKeyDown:P,children:[t.jsx(en,{MenuItemProps:d,className:f,ref:b,LeftIcon:a,RightIcon:s,label:i,renderLabel:r}),t.jsx(He,{style:{pointerEvents:"none"},anchorEl:M.current,anchorOrigin:{horizontal:ie("right","left"),vertical:"top"},transformOrigin:{horizontal:ie("left","right"),vertical:"top"},open:Y,autoFocus:!1,disableAutoFocus:!0,disableEnforceFocus:!0,onClose:()=>{v(!1)},...m,children:t.jsx(N,{ref:y,style:{pointerEvents:"auto"},children:u})})]})},nn=({manga:e,handleSelection:n,selectedMangas:o,onClose:i,setHideMenu:r})=>{var v,D;const{t:s}=Q(),[a,u]=g.useState(!1),f=!!e,l=o!=null?o:[],c=ct(f,vt),m=it(f),d=lt(f),x=!!e&&e.downloadCount===e.chapters.totalCount,h=!!(e!=null&&e.downloadCount),p=!!(e!=null&&e.unreadCount),M=!!e&&e.unreadCount!==e.chapters.totalCount,b=()=>{n==null||n(e.id,!0),i()},w=(G,E)=>{k.performAction(G,e?[e.id]:k.getIds(E),{wasManuallyMarkedAsRead:!0}).catch(we()),i()},{downloadableMangas:S,downloadedMangas:y,unreadMangas:C,readMangas:I}=g.useMemo(()=>({downloadableMangas:[...k.getNotDownloaded(l),...k.getPartiallyDownloaded(l)],downloadedMangas:[...k.getPartiallyDownloaded(l),...k.getFullyDownloaded(l)],unreadMangas:[...k.getUnread(l),...k.getPartiallyRead(l)],readMangas:[...k.getPartiallyRead(l),...k.getFullyRead(l)]}),[l]);return t.jsxs(t.Fragment,{children:[!!n&&f&&t.jsx(A,{onClick:b,Icon:at,title:s("chapter.action.label.select")}),m(!x)&&t.jsx(tn,{disabled:d(!S.length),LeftIcon:bt,label:c("download",S.length),parentMenuOpen:!0,children:t.jsx(yt,{mangaIds:f?[e.id]:k.getIds(l),closeMenu:i})}),m(h)&&t.jsx(A,{Icon:xt,disabled:d(!y.length),onClick:()=>w("delete",y),title:c("delete",y.length)}),m(p)&&t.jsx(A,{Icon:dt,disabled:d(!C.length),onClick:()=>w("mark_as_read",C),title:c("mark_as_read",C.length)}),m(M)&&t.jsx(A,{Icon:ut,disabled:d(!I.length),onClick:()=>w("mark_as_unread",I),title:c("mark_as_unread",I.length)}),f&&t.jsx(Z,{to:X.migrate.childRoutes.search.path((v=e==null?void 0:e.sourceId)!=null?v:-1,(D=e==null?void 0:e.id)!=null?D:-1,e==null?void 0:e.title),state:{mangaTitle:e==null?void 0:e.title},style:{textDecoration:"none",color:"inherit"},children:t.jsx(A,{Icon:jt,title:c("migrate",l.length)})}),f&&t.jsx(A,{onClick:()=>{u(!0),r(!0)},Icon:kt,title:c("track",l.length)}),t.jsx(A,{onClick:()=>{Ve.show(ft,{mangaId:e==null?void 0:e.id,mangaIds:o?k.getIds(l):void 0,addToLibrary:!1}),r(!0),i()},Icon:Ct,title:c("change_categories",l.length)}),t.jsx(A,{onClick:()=>w("remove_from_library",l),Icon:pt,title:c("remove_from_library",l.length)}),a&&t.jsx(Me,{open:!0,maxWidth:"md",fullWidth:!0,scroll:"paper",onClose:()=>{u(!1),i()},children:t.jsx(Mt,{manga:e})})]})},on=({mangaIdToMigrateTo:e,onClose:n})=>{const{t:o}=Q(),i=Ke(),{mangaId:r}=Ye(),s=Number(r),{settings:{migrateChapters:a,migrateCategories:u,migrateTracking:f,deleteChapters:l}}=se(),[c,m]=g.useState(!1),d=qe(we()),x=async h=>{if(s==null)throw new Error('MigrateDialog::migrate: unexpected mangaId "'.concat(s,'"'));Ze(o("migrate.label.info"),"info"),m(!0);try{await k.migrate(s,e,{mode:h,migrateChapters:a,migrateCategories:u,migrateTracking:f,deleteChapters:l}),i(X.manga.path(e),{replace:!0})}catch(p){m(!1)}};return t.jsxs(Me,{open:!0,fullWidth:!0,onClose:n,children:[t.jsx(Je,{children:o("migrate.dialog.title")}),t.jsx(Xe,{dividers:!0,children:t.jsxs(Rt,{children:[t.jsx(ne,{disabled:c,label:o("chapter.title_one"),checked:a,onChange:(h,p)=>d("migrateChapters",p)}),t.jsx(ne,{disabled:c,label:o("category.title.category_one"),checked:u,onChange:(h,p)=>d("migrateCategories",p)}),t.jsx(ne,{disabled:c,label:o("tracking.title"),checked:f,onChange:(h,p)=>d("migrateTracking",p)}),t.jsx(ne,{disabled:c,label:o("migrate.dialog.label.delete_downloaded"),checked:l,onChange:(h,p)=>d("deleteChapters",p)})]})}),t.jsx(Qe,{children:t.jsxs(z,{direction:"row",sx:{justifyContent:"space-between",width:"100%"},children:[t.jsx(O,{disabled:c,component:Z,to:X.manga.path(e),children:o("migrate.dialog.action.button.show_entry")}),t.jsxs(z,{direction:"row",children:[t.jsx(O,{disabled:c,onClick:n,children:o("global.button.cancel")}),t.jsx(O,{disabled:c,onClick:()=>x("copy"),children:o("global.button.copy")}),t.jsx(O,{disabled:c,onClick:()=>x("migrate"),children:o("global.button.migrate")})]})]})})]})},Se=({id:e,selected:n,handleSelection:o,asCheckbox:i=!1,popupState:r,ref:s})=>{const{t:a}=Q(),u=g.useMemo(()=>et(r),[r]),f=m=>{m.stopPropagation(),m.preventDefault()},l=(m,d)=>{f(m),o==null||o(e,d)};return o?n!==null?i?t.jsx(U,{title:a(n?"global.button.deselect":"global.button.select"),children:t.jsx(Dt,{...J.preventRippleProp(),checked:n,onChange:l})}):null:i?t.jsx(U,{title:a("global.button.options"),children:t.jsx(tt,{ref:s,...J.preventRippleProp(u,{onClick:f}),"aria-label":"more",children:t.jsx(ye,{})})}):t.jsx(U,{title:a("global.button.options"),children:t.jsx(O,{ref:s,...J.preventRippleProp(u,{onClick:f}),className:"manga-option-button",size:"small",variant:"contained",sx:{minWidth:"unset",paddingX:"0",paddingY:"2.5px",visibility:r.isOpen?"visible":"hidden",pointerEvents:"none","@media not (pointer: fine)":{visibility:"hidden",width:0,height:0,p:0,m:0}},children:t.jsx(ye,{})})}):null},sn=q("div")({position:"absolute",bottom:0,width:"100%",height:"30%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),rn=q("div")({position:"absolute",bottom:0,width:"100%",height:"20%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),an=g.memo(({manga:e,longPressBind:n,popupState:o,handleClick:i,mangaLinkTo:r,selected:s,inLibraryIndicator:a,isInLibrary:u,gridLayout:f,handleSelection:l,continueReadingButton:c,mangaBadges:m,mode:d})=>{const x=V.usePreventMobileContextMenu(),h=g.useRef(null),{id:p,title:M}=e;return t.jsx(Tt,{component:Z,...n(()=>o.open(h.current)),onClick:i,to:r,state:k.createLocationState(e,d),onContextMenu:x,sx:{...V.preventMobileContextMenuSx(),textDecoration:"none"},children:t.jsxs(N,{sx:{display:"flex",flexDirection:"column",m:.25,outline:s?"4px solid":void 0,borderRadius:s?"1px":void 0,outlineColor:b=>b.palette.primary.main,backgroundColor:b=>s?b.palette.primary.main:void 0,"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:d==="source"?"none":"flex"}}},children:[t.jsx(Ie,{sx:{aspectRatio:It,display:"flex"},children:t.jsxs(Re,{sx:{position:"relative",height:"100%"},children:[t.jsx(St,{alt:M,src:k.getThumbnailUrl(e),imgStyle:a&&u?{height:"100%",width:"100%",objectFit:"cover",filter:"brightness(0.4)"}:{height:"100%",width:"100%",objectFit:"cover"},spinnerStyle:{display:"grid",placeItems:"center"}}),t.jsxs(z,{direction:"row",sx:{alignItems:"start",justifyContent:"space-between",position:"absolute",top:b=>b.spacing(1),left:b=>b.spacing(1),right:b=>b.spacing(1)},children:[m,t.jsx(Se,{ref:h,popupState:o,id:p,selected:s,handleSelection:l})]}),t.jsxs(t.Fragment,{children:[f!==L.Comfortable&&t.jsxs(t.Fragment,{children:[t.jsx(sn,{}),t.jsx(rn,{})]}),t.jsxs(z,{direction:"row",sx:{justifyContent:f!==L.Comfortable?"space-between":"end",alignItems:"end",position:"absolute",bottom:0,width:"100%",p:1,gap:1},children:[f!==L.Comfortable&&t.jsx(U,{title:M,placement:"top",children:t.jsx(ae,{component:"h3",sx:{color:"white",textShadow:"0px 0px 3px #000000"},children:M})}),c]})]})]})}),f===L.Comfortable&&t.jsx(z,{sx:{pb:1},children:t.jsx(U,{title:M,placement:"top",children:t.jsx(ae,{component:"h3",sx:{color:b=>s?b.palette.primary.contrastText:"text.primary",height:"3rem",pt:.5},children:M})})})]})})}),cn=g.memo(({manga:e,longPressBind:n,popupState:o,handleClick:i,mangaLinkTo:r,selected:s,inLibraryIndicator:a,isInLibrary:u,handleSelection:f,continueReadingButton:l,mangaBadges:c,mode:m})=>{const d=V.usePreventMobileContextMenu(),x=g.useRef(null),{id:h,title:p}=e;return t.jsx(Ie,{children:t.jsx(Re,{component:Z,to:r,state:k.createLocationState(e,m),onClick:i,...n(()=>o.open(x.current)),onContextMenu:d,sx:{...V.preventMobileContextMenuSx(),"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:m==="source"?"none":"inline-flex"}}},children:t.jsxs(Pt,{sx:{justifyContent:"space-between",position:"relative"},children:[t.jsx(Gt,{iconUrl:k.getThumbnailUrl(e),alt:e.title,slots:{spinnerImageProps:{imgStyle:{imageRendering:"pixelated",filter:a&&u?"brightness(0.4)":void 0}}}}),t.jsx(N,{sx:{display:"flex",flexDirection:"row",flexGrow:1,width:"min-content"},children:t.jsx(U,{title:p,placement:"top",children:t.jsx(ae,{variant:"h6",component:"h3",children:p})})}),t.jsxs(z,{direction:"row",sx:{alignItems:"center",gap:.5},children:[c,l,t.jsx(Se,{ref:x,popupState:o,id:h,selected:s,handleSelection:f,asCheckbox:!0})]})]})})})}),ln=({showContinueReadingButton:e,chapter:n,mangaLinkTo:o})=>{if(!e||!n)return null;const{sourceOrder:i,chapterNumber:r,name:s,scanlator:a}=n;return t.jsx(wt,{chapterNumber:r,name:s,sourceOrder:i,scanlator:a,children:t.jsx(O,{...J.preventRippleProp(),variant:"contained",size:"small",sx:{minWidth:"unset",py:.5,px:.75},component:Z,to:"".concat(o,"/chapter/").concat(i),state:_t.getReaderOpenChapterLocationState(n),onClick:u=>u.stopPropagation(),children:t.jsx(Et,{})})})},dn=q("div")(({theme:e})=>({display:"flex",height:"fit-content",borderRadius:e.shape.borderRadius,overflow:"hidden"})),Ce=q(ke)(({theme:e})=>({color:e.palette.primary.contrastText,paddingInline:e.spacing(.3)})),un=({inLibraryIndicator:e,updateLibraryState:n,isInLibrary:o,unread:i,downloadCount:r,mode:s})=>{const{t:a}=Q(),u=V.useIsTouchDevice(),{settings:{showUnreadBadge:f,showDownloadBadge:l}}=se();return t.jsxs(dn,{children:[!u&&e&&s==="source"&&t.jsx(O,{className:"source-manga-library-state-button",component:"div",variant:"contained",size:"small",...J.preventRippleProp(),onClick:c=>{c.preventDefault(),c.stopPropagation(),n()},sx:{display:"none"},color:o?"error":"primary",children:a(o?"manga.action.library.remove.label.action":"manga.button.add_to_library")}),e&&o&&t.jsx(ke,{className:"source-manga-library-state-indicator",sx:{backgroundColor:"primary.dark",color:"primary.contrastText",p:.3},children:a("manga.button.in_library")}),(f&&s==="default"||s==="duplicate")&&(i!=null?i:0)>0&&t.jsx(Ce,{sx:{backgroundColor:"primary.main",color:"primary.contrastText"},children:i}),(l&&s==="default"||s==="duplicate")&&(r!=null?r:0)>0&&t.jsx(Ce,{sx:{backgroundColor:"secondary.main",color:"secondary.contrastText"},children:r})]})},fn=(e,n,o,i)=>{switch(e){case"default":case"source":case"duplicate":return X.manga.path(n);case"migrate.search":return X.migrate.childRoutes.search.path(o!=null?o:"-1",n,i);case"migrate.select":return"";default:throw new Error('getMangaLinkTo: unexpected MangaCardMode "'.concat(e,'"'))}},pn=g.memo(e=>{const{manga:n,gridLayout:o,inLibraryIndicator:i,selected:r,handleSelection:s,mode:a="default"}=e,{id:u,firstUnreadChapter:f,downloadCount:l,unreadCount:c}=n,{settings:{showContinueReadingButton:m}}=se(),{updateLibraryState:d,isInLibrary:x}=mt(n,a==="source"),h=fn(a,n.id,n.sourceId,n.title),[p,M]=g.useState(!1),b=g.useCallback((y,C)=>{const I=a==="default",v=a==="source",D=a==="migrate.select",G=r!==null;if(D||G||(I||v)&&C){if(y.preventDefault(),v){d();return}if(G){s==null||s(u,!r,{selectRange:y.shiftKey});return}if(I){C==null||C();return}D&&M(!0)}},[a,r,d,s]),w=ht(g.useCallback((y,{context:C})=>{y.shiftKey=!0,b(y,C)},[b])),S=g.useMemo(()=>o===L.List?cn:an,[o]);return t.jsxs(t.Fragment,{children:[p&&t.jsx(on,{mangaIdToMigrateTo:n.id,onClose:()=>M(!1)}),t.jsx(nt,{variant:"popover",popupId:"manga-card-action-menu",children:y=>t.jsxs(t.Fragment,{children:[t.jsx(S,{...e,longPressBind:w,popupState:y,handleClick:b,mangaLinkTo:h,isInLibrary:x,inLibraryIndicator:i,continueReadingButton:t.jsx(ln,{showContinueReadingButton:m&&a==="default",chapter:f,mangaLinkTo:h}),mangaBadges:t.jsx(un,{inLibraryIndicator:i,isInLibrary:x,unread:c,downloadCount:l,updateLibraryState:d,mode:a})}),!!s&&y.isOpen&&t.jsx(gt,{...ot(y),children:(C,I)=>t.jsx(nn,{manga:n,handleSelection:s,onClose:C,setHideMenu:I})})]})})]})}),mn=({ref:e,persistKey:n,...o})=>{const{state:i,persistState:r}=Bt.usePersistState(n),s=g.useRef(void 0),a=ce(s,e);return t.jsx(Lt,{...o,ref:a,stateChanged:r,restoreStateFrom:i})},hn=({children:e,ref:n,...o})=>t.jsx(le,{...o,ref:n,container:!0,spacing:1,children:e}),gn=(e,n,o,i=12)=>{const r=Math.ceil(e/n),s=o===L.List?i:i/r;return({children:a,...u})=>t.jsx(le,{...u,size:s,children:a})},De=(e,n,o,i=!1,r,s,a)=>t.jsx(pn,{manga:e,gridLayout:n,inLibraryIndicator:o,selected:i?r==null?void 0:r.includes(e.id):null,handleSelection:s,mode:a}),xn=({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:i,gridLayout:r,isSelectModeActive:s,selectedMangaIds:a,handleSelection:u,mode:f,ref:l})=>t.jsx(le,{ref:l,container:!0,spacing:1,sx:{width:"100%",overflowX:"auto",display:"-webkit-inline-box",flexWrap:"nowrap"},children:e?t.jsx(ve,{}):n.map(c=>t.jsx(i,{children:De(c,r,o,s,a,u,f)},c.id))}),bn="MangaGrid-snapshot-location",yn=({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:i,gridLayout:r,hasNextPage:s,loadMore:a,isSelectModeActive:u,selectedMangaIds:f,handleSelection:l,mode:c,ref:m})=>t.jsxs(t.Fragment,{children:[t.jsx(N,{ref:m,children:t.jsx(mn,{persistKey:bn,useWindowScroll:!0,increaseViewportBy:window.innerHeight*.5,totalCount:n.length,components:{List:hn,Item:i},endReached:()=>a(),computeItemKey:d=>n[d].id,itemContent:d=>De(n[d],r,o,u,f,l,c)})}),u&&r===L.List?t.jsx(N,{sx:{paddingBottom:At}}):e?t.jsx(ve,{}):s?t.jsx("div",{style:{height:"75px"}}):null]}),Un=({mangas:e,isLoading:n,message:o,messageExtra:i,hasNextPage:r,loadMore:s,gridLayout:a,horizontal:u,noFaces:f,inLibraryIndicator:l,isSelectModeActive:c,selectedMangaIds:m,handleSelection:d,mode:x,retry:h,gridWrapperProps:p})=>{var G,E;const{t:M}=Q(),{navBarWidth:b}=st(),{settings:{mangaGridItemWidth:w}}=se(),S=g.useRef(null),y=g.useRef(null),[C,I]=g.useState((E=(G=y.current)==null?void 0:G.offsetWidth)!=null?E:Math.max(0,document.documentElement.offsetWidth-b)),v=g.useMemo(()=>gn(C,w,a),[C,w,a]);return g.useLayoutEffect(()=>{if(u)return()=>{};let R;const T=P=>{R=setTimeout(()=>{if(document.body.style.overflow.includes("hidden")){T(250);return}document.body.style.overflowY=a===L.List?"auto":"scroll"},P)};return T(0),()=>{clearTimeout(R)}},[a]),g.useLayoutEffect(()=>()=>{u||(document.body.style.overflowY="auto")},[]),be(y,g.useCallback(()=>{I((()=>{var P;const T=(P=y.current)==null?void 0:P.offsetWidth;return T||document.documentElement.offsetWidth-b})())},[b])),be(S,g.useCallback((R,T)=>{const P=R[0].target.clientHeight,Y=P>document.documentElement.clientHeight;if(!n&&P){if(Y){T.disconnect();return}s(),T.disconnect()}},[S,s,n])),!n&&e.length===0?t.jsx(rt,{noFaces:f,message:o!=null?o:M("manga.error.label.no_mangas_found"),messageExtra:i,retry:h}):t.jsx(N,{...p,ref:y,sx:{...p==null?void 0:p.sx,overflow:"hidden"},children:u?t.jsx(xn,{ref:S,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:v,gridLayout:a,isSelectModeActive:c,selectedMangaIds:m,handleSelection:d,mode:x}):t.jsx(yn,{ref:S,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:v,hasNextPage:r,loadMore:s,gridLayout:a,isSelectModeActive:c,selectedMangaIds:m,handleSelection:d,mode:x})})};export{Un as M,nn as a,bn as b,pn as c};
