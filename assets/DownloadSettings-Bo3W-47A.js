import{u as E,j as a,E as u,o as r,p as i,bp as p,U as y,m as D,g as _,r as C,a$ as U,a as R,e as M,f as j,v as I}from"./index-C31zer8j.js";import{T as P}from"./TextSetting-3WuyNYl8.js";import{N as k}from"./NumberSetting-BJZZHNrZ.js";import{u as V,g as W}from"./usePersistedValue-CktpJu-K.js";import{S as h}from"./Switch-CrCy3RQm.js";import{S as O}from"./SelectSetting-Y2NgFCfp.js";import{a as z}from"./CategoriesInclusionSetting-jPCAObkm.js";import{E as G}from"./EmptyViewAbsoluteCentered-GJB1YAkB.js";import{u as H}from"./useAppTitle-C_unTVVZ.js";import{L as f}from"./ListSubheader-BQSo7yQS.js";import"./PasswordTextField-C-E1U-R2.js";import"./TextField-BI-vG49K.js";import"./useFormControl-SfVaomJZ.js";import"./formControlState-Dq1zat_P.js";import"./InputAdornment-4AKwMGih.js";import"./Slider-B_e-r2sj.js";import"./SwitchBase-DOAKgWJr.js";import"./Select-vDjyzd5F.js";import"./ThreeStateCheckboxInput-lukj5NF8.js";import"./Checkbox-R2Aewz3n.js";const q=({downloadAheadLimit:e})=>{const{t:d}=E(),l=!!e,[s,c]=V("lastDownloadAheadLimit",p.default,e,W),w=n=>{c(n===0?s:n),y("downloadAheadLimit",n).catch(b=>D(d("global.error.label.failed_to_save_changes"),"error",_(b)))},m=n=>{w(n?s:0)};return a.jsxs(u,{children:[a.jsxs(r,{children:[a.jsx(i,{primary:d("download.settings.download_ahead.label.while_reading")}),a.jsx(h,{edge:"end",checked:l,onChange:n=>m(n.target.checked)})]}),a.jsx(k,{settingTitle:d("download.settings.download_ahead.label.unread_chapters_to_download"),settingValue:d("download.settings.download_ahead.label.value",{chapters:s,count:s}),value:s,minValue:p.min,maxValue:p.max,defaultValue:p.default,stepSize:p.step,showSlider:!0,dialogDescription:d("download.settings.download_ahead.label.description"),dialogDisclaimer:d("download.settings.download_ahead.label.disclaimer"),valueUnit:d("chapter.title_one"),handleUpdate:w,disabled:!l})]})},B=[0,1,2,3,4,5],F={0:{text:"global.label.disabled"},1:{text:"download.settings.delete_chapters.while_reading.option.label.first"},2:{text:"download.settings.delete_chapters.while_reading.option.label.second"},3:{text:"download.settings.delete_chapters.while_reading.option.label.third"},4:{text:"download.settings.delete_chapters.while_reading.option.label.fourth"},5:{text:"download.settings.delete_chapters.while_reading.option.label.fifth"}},K=B.map(e=>[e,F[e]]),Y=e=>typeof e=="boolean"?Number(e):e,$=({chapterToDelete:e,handleChange:d})=>{const{t:l}=E(),s=Y(e);return a.jsx(O,{settingName:l("download.settings.delete_chapters.while_reading.label.title"),value:s,values:K,handleChange:d})},J=e=>({downloadAsCbz:e.downloadAsCbz,downloadsPath:e.downloadsPath,autoDownloadNewChapters:e.autoDownloadNewChapters,autoDownloadNewChaptersLimit:e.autoDownloadNewChaptersLimit,excludeEntryWithUnreadChapters:e.excludeEntryWithUnreadChapters,autoDownloadIgnoreReUploads:e.autoDownloadIgnoreReUploads}),_e=()=>{var v,L,T;const{t:e}=E();H(e("download.title.download"));const d=C.useGetCategories(U),l=C.useGetServerSettings({notifyOnNetworkStatusChange:!0}),[s]=C.useUpdateServerSettings(),{settings:c,loading:w,request:{error:m,refetch:n}}=R();if(l.loading||w||d.loading)return a.jsx(M,{});const S=(L=(v=l.error)!=null?v:m)!=null?L:d.error;if(S)return a.jsx(G,{message:e("global.error.label.failed_to_load_data"),messageExtra:_(S),retry:()=>{l.error&&l.refetch().catch(j()),m&&n().catch(j()),d.error&&d.refetch().catch(j())}});const t=J(l.data.settings),g=(o,N)=>{s({variables:{input:{settings:{[o]:N}}}}).catch(A=>D(e("global.error.label.failed_to_save_changes"),"error",_(A)))},x=I(o=>D(e("global.error.label.failed_to_save_changes"),"error",_(o)));return a.jsxs(u,{sx:{pt:0},children:[a.jsx(P,{settingName:e("download.settings.download_path.label.title"),dialogDescription:e("download.settings.download_path.label.description"),value:t==null?void 0:t.downloadsPath,settingDescription:t!=null&&t.downloadsPath.length?t.downloadsPath:e("global.label.default"),handleChange:o=>g("downloadsPath",o)}),a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.file_type.label.cbz")}),a.jsx(h,{edge:"end",checked:!!(t!=null&&t.downloadAsCbz),onChange:o=>g("downloadAsCbz",o.target.checked)})]}),a.jsxs(u,{subheader:a.jsx(f,{component:"div",id:"download-settings-auto-delete-downloads",children:e("download.settings.delete_chapters.title")}),children:[a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.delete_chapters.label.manually_marked_as_read")}),a.jsx(h,{edge:"end",checked:c.deleteChaptersManuallyMarkedRead,onChange:o=>x("deleteChaptersManuallyMarkedRead",o.target.checked)})]}),a.jsx($,{chapterToDelete:c.deleteChaptersWhileReading,handleChange:o=>x("deleteChaptersWhileReading",o)}),a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.delete_chapters.label.allow_deletion_of_bookmarked")}),a.jsx(h,{edge:"end",checked:c.deleteChaptersWithBookmark,onChange:o=>x("deleteChaptersWithBookmark",o.target.checked)})]})]}),a.jsxs(u,{subheader:a.jsx(f,{component:"div",id:"download-settings-auto-download",children:e("download.settings.auto_download.title")}),children:[a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.auto_download.label.new_chapters")}),a.jsx(h,{edge:"end",checked:!!(t!=null&&t.autoDownloadNewChapters),onChange:o=>g("autoDownloadNewChapters",o.target.checked)})]}),a.jsx(k,{disabled:!(t!=null&&t.autoDownloadNewChapters),settingTitle:e("download.settings.auto_download.download_limit.label.title"),dialogDescription:e("download.settings.auto_download.download_limit.label.description"),value:(T=t==null?void 0:t.autoDownloadNewChaptersLimit)!=null?T:0,settingValue:t.autoDownloadNewChaptersLimit?e("download.settings.download_ahead.label.value",{chapters:t.autoDownloadNewChaptersLimit,count:t.autoDownloadNewChaptersLimit}):e("global.label.none"),defaultValue:0,minValue:0,maxValue:20,showSlider:!0,valueUnit:e("chapter.title_one"),handleUpdate:o=>g("autoDownloadNewChaptersLimit",o)}),a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.auto_download.label.ignore_with_unread_chapters")}),a.jsx(h,{edge:"end",checked:!!(t!=null&&t.excludeEntryWithUnreadChapters),onChange:o=>g("excludeEntryWithUnreadChapters",o.target.checked),disabled:!(t!=null&&t.autoDownloadNewChapters)})]}),a.jsxs(r,{children:[a.jsx(i,{primary:e("download.settings.auto_download.label.ignore_re_uploads")}),a.jsx(h,{edge:"end",checked:!!(t!=null&&t.autoDownloadIgnoreReUploads),onChange:o=>g("autoDownloadIgnoreReUploads",o.target.checked),disabled:!(t!=null&&t.autoDownloadNewChapters)})]}),a.jsx(z,{categories:d.data.categories.nodes,includeField:"includeInDownload",dialogText:e("download.settings.auto_download.categories.label.include_in_download")})]}),a.jsx(u,{subheader:a.jsx(f,{component:"div",id:"download-settings-download-ahead",children:e("download.settings.download_ahead.title")}),children:a.jsx(q,{downloadAheadLimit:c.downloadAheadLimit})})]})};export{_e as DownloadSettings};
