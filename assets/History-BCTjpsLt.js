import{f as i,j as e,A as b,L as I,H as w,u as R,r as L,g as E,k as M,T as S,i as A}from"./index-DbvROaWl.js";import{E as h}from"./EmptyViewAbsoluteCentered-o9JmMMl8.js";import{S as G,a as P}from"./StyledGroupHeader-moF4zece.js";import{S as T}from"./StyledGroupItemWrapper-CyEvmKHZ.js";import{V as d}from"./Virtuoso.util-CuralPvf.js";import{C as _,D as k}from"./ChapterCardMetadata-ByvbskCY.js";import{a as f}from"./Chapters-CpzpqsUQ.js";import{t as O,e as U}from"./DateHelper-BomEzw-W.js";import{C as v,a as F}from"./ChapterDownloadButton-Bwi7bijz.js";import{C as B}from"./ChapterDownloadRetryButton-BkRA6sq6.js";import{L as D}from"./ListCardContent-D6nwuJbr.js";import{C as K}from"./Card-IbYRj253.js";import{C as N}from"./CardActionArea-CQ8kSiQd.js";import{u as V}from"./useAppTitle-CHvxb-QA.js";import"./index-C3eHdW2h.js";import"./use-merged-ref-BPtS2GJY.js";import"./Asserts-xItX73wb.js";import"./Mangas-4Pk8vPRT.js";import"./ListCardAvatar-CV00KDHL.js";import"./AvatarSpinner-Cp-eUhll.js";import"./SpinnerImage-Y1XfCt_3.js";import"./Refresh-sLgC7wNn.js";import"./Image-CaByzQe2.js";import"./Download-DS5ytG2j.js";import"./MUI.util-CEodEA2f.js";const $=i.memo(({chapter:t})=>{const{manga:s}=t;return e.jsx(K,{children:e.jsx(N,{component:I,to:b.reader.path(t.manga.id,t.sourceOrder),state:f.getReaderOpenChapterLocationState(t),sx:{color:r=>r.palette.text[t.isRead?"disabled":"primary"]},children:e.jsxs(D,{sx:{justifyContent:"space-between"},children:[e.jsxs(w,{sx:{display:"flex",flexGrow:1,gap:1},children:[e.jsx(v,{mangaId:s.id,sourceId:s.sourceId,mangaTitle:s.title,thumbnailUrl:s.thumbnailUrl,thumbnailUrlLastFetched:s.thumbnailUrlLastFetched}),e.jsx(_,{title:s.title,secondaryText:"".concat(t.name," â€” ").concat(O.format(U(Number(t.lastReadAt)).valueOf()))})]}),e.jsx(k,{chapterId:t.id}),e.jsx(B,{chapterId:t.id}),e.jsx(F,{chapterId:t.id,isDownloaded:t.isDownloaded})]})})})}),Ce=()=>{var c;const{i18n:t,_:s}=R();V(t._({id:"0caMy7"}));const{data:r,loading:m,error:p,fetchMore:C,refetch:g}=L.useGetRecentlyReadChapters(void 0,{fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),l=!!(r!=null&&r.chapters.pageInfo.hasNextPage),x=r==null?void 0:r.chapters.pageInfo.endCursor,a=(c=r==null?void 0:r.chapters.nodes)!=null?c:[],n=i.useMemo(()=>Object.entries(f.groupByDate(a,"lastReadAt")),[a]),u=i.useMemo(()=>n.map(o=>o[d.ITEMS].length),[n]),j=d.useCreateGroupedComputeItemKey(u,i.useCallback(o=>n[o][d.GROUP],[n]),i.useCallback(o=>a[o].id,[a])),y=i.useCallback(()=>{l&&C({variables:{offset:a.length}})},[l,x]);return p?e.jsx(h,{message:t._({id:"6m5aox"}),messageExtra:E(p),retry:()=>g().catch(M("History::refetch"))}):!m&&a.length===0?e.jsx(h,{message:t._({id:"6vpD7K"})}):e.jsx(G,{persistKey:"history",components:{Footer:()=>m?e.jsx(A,{usePadding:!0}):null},overscan:window.innerHeight*.5,endReached:y,groupCounts:u,groupContent:o=>e.jsx(P,{isFirstItem:o===0,children:e.jsx(S,{variant:"h5",component:"h2",children:n[o][d.GROUP]})}),computeItemKey:j,itemContent:o=>e.jsx(T,{children:e.jsx($,{chapter:a[o]})})})};export{Ce as History};
