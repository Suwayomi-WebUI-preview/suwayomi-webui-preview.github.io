import{c as g,a6 as we,a5 as ye,s as H,a9 as V,aa as ke,y as Me,bK as Ie,ab as $e,j as t,ac as Se,bL as Q,bM as te,ad as De,_ as _e,$ as se,a0 as Te,M as ne,B as F,K as Re,am as J,bN as Ee,bO as Pe,u as O,x as Be,L as Y,Q as ue,h as de,e as Ge,a1 as Le,q as We,aC as Ne,aD as Fe,aE as Oe,S as W,b as G,bm as ze,m as Ae,A as Ke,f as L,I as Ve,p as P,T as pe,o as fe,P as Ue,C as He,Y as Ye,g as he,ar as qe,ba as Ze,bb as Qe,w as Xe,d as Je,n as ie,E as et}from"./index-aRdpybDP.js";import{C as ge,a as tt}from"./index-DsS6TrSK.js";import{l as nt,M as E,d as ot,C as rt,a as st,b as it,m as at,n as ct,j as lt,T as ut,c as dt,e as pt,f as ft,g as ae,i as ht,J as gt,h as mt}from"./useManageMangaLibraryState-BW2WFnvP.js";import{d as xt}from"./Delete-O6q18e_o.js";import{d as bt}from"./Sync-1e-a-E2E.js";import{M as I,a as jt}from"./Mangas-BOW8RIyZ.js";import{C as Z}from"./CheckboxInput-DHYzS8d7.js";import{F as Ct}from"./ListPreference-AzBShjVc.js";import{S as me}from"./SpinnerImage-c3XjFys8.js";import{C as vt}from"./Checkbox-DITc9wrS.js";import{T as ee}from"./TypographyMaxLines-BDCzE731.js";import{L as wt}from"./Link-Cs1KyJcr.js";import{C as xe,a as yt}from"./CardContent-D1Dp0n3h.js";import{A as kt}from"./Avatar-CJ9wqF4h.js";import{d as Mt}from"./PlayArrow-DMfA4sks.js";import{D as It}from"./StyledFab-Bj1Ar6Ir.js";const $t=g.createContext(),ce=$t;function St(e){return we("MuiGrid",e)}const Dt=[0,1,2,3,4,5,6,7,8,9,10],_t=["column-reverse","column","row-reverse","row"],Tt=["nowrap","wrap-reverse","wrap"],K=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],U=ye("MuiGrid",["root","container","item","zeroMinWidth",...Dt.map(e=>"spacing-xs-".concat(e)),..._t.map(e=>"direction-xs-".concat(e)),...Tt.map(e=>"wrap-xs-".concat(e)),...K.map(e=>"grid-xs-".concat(e)),...K.map(e=>"grid-sm-".concat(e)),...K.map(e=>"grid-md-".concat(e)),...K.map(e=>"grid-lg-".concat(e)),...K.map(e=>"grid-xl-".concat(e))]),Rt=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function N(e){const n=parseFloat(e);return"".concat(n).concat(String(e).replace(String(n),"")||"px")}function Et({theme:e,ownerState:n}){let o;return e.breakpoints.keys.reduce((s,i)=>{let r={};if(n[i]&&(o=n[i]),!o)return s;if(o===!0)r={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(o==="auto")r={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const l=Q({values:n.columns,breakpoints:e.breakpoints.values}),d=typeof l=="object"?l[i]:l;if(d==null)return s;const u="".concat(Math.round(o/d*1e8)/1e6,"%");let c={};if(n.container&&n.item&&n.columnSpacing!==0){const a=e.spacing(n.columnSpacing);if(a!=="0px"){const h="calc(".concat(u," + ").concat(N(a),")");c={flexBasis:h,maxWidth:h}}}r=V({flexBasis:u,flexGrow:0,maxWidth:u},c)}return e.breakpoints.values[i]===0?Object.assign(s,r):s[e.breakpoints.up(i)]=r,s},{})}function Pt({theme:e,ownerState:n}){const o=Q({values:n.direction,breakpoints:e.breakpoints.values});return te({theme:e},o,s=>{const i={flexDirection:s};return s.indexOf("column")===0&&(i["& > .".concat(U.item)]={maxWidth:"none"}),i})}function be({breakpoints:e,values:n}){let o="";Object.keys(n).forEach(i=>{o===""&&n[i]!==0&&(o=i)});const s=Object.keys(e).sort((i,r)=>e[i]-e[r]);return s.slice(0,s.indexOf(o))}function Bt({theme:e,ownerState:n}){const{container:o,rowSpacing:s}=n;let i={};if(o&&s!==0){const r=Q({values:s,breakpoints:e.breakpoints.values});let l;typeof r=="object"&&(l=be({breakpoints:e.breakpoints.values,values:r})),i=te({theme:e},r,(d,u)=>{var c;const a=e.spacing(d);return a!=="0px"?{marginTop:"-".concat(N(a)),["& > .".concat(U.item)]:{paddingTop:N(a)}}:(c=l)!=null&&c.includes(u)?{}:{marginTop:0,["& > .".concat(U.item)]:{paddingTop:0}}})}return i}function Gt({theme:e,ownerState:n}){const{container:o,columnSpacing:s}=n;let i={};if(o&&s!==0){const r=Q({values:s,breakpoints:e.breakpoints.values});let l;typeof r=="object"&&(l=be({breakpoints:e.breakpoints.values,values:r})),i=te({theme:e},r,(d,u)=>{var c;const a=e.spacing(d);return a!=="0px"?{width:"calc(100% + ".concat(N(a),")"),marginLeft:"-".concat(N(a)),["& > .".concat(U.item)]:{paddingLeft:N(a)}}:(c=l)!=null&&c.includes(u)?{}:{width:"100%",marginLeft:0,["& > .".concat(U.item)]:{paddingLeft:0}}})}return i}function Lt(e,n,o={}){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[o["spacing-xs-".concat(String(e))]];const s=[];return n.forEach(i=>{const r=e[i];Number(r)>0&&s.push(o["spacing-".concat(i,"-").concat(String(r))])}),s}const Wt=H("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:o}=e,{container:s,direction:i,item:r,spacing:l,wrap:d,zeroMinWidth:u,breakpoints:c}=o;let a=[];s&&(a=Lt(l,c,n));const h=[];return c.forEach(m=>{const p=o[m];p&&h.push(n["grid-".concat(m,"-").concat(String(p))])}),[n.root,s&&n.container,r&&n.item,u&&n.zeroMinWidth,...a,i!=="row"&&n["direction-xs-".concat(String(i))],d!=="wrap"&&n["wrap-xs-".concat(String(d))],...h]}})(({ownerState:e})=>V({boxSizing:"border-box"},e.container&&{display:"flex",flexWrap:"wrap",width:"100%"},e.item&&{margin:0},e.zeroMinWidth&&{minWidth:0},e.wrap!=="wrap"&&{flexWrap:e.wrap}),Pt,Bt,Gt,Et);function Nt(e,n){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return["spacing-xs-".concat(String(e))];const o=[];return n.forEach(s=>{const i=e[s];if(Number(i)>0){const r="spacing-".concat(s,"-").concat(String(i));o.push(r)}}),o}const Ft=e=>{const{classes:n,container:o,direction:s,item:i,spacing:r,wrap:l,zeroMinWidth:d,breakpoints:u}=e;let c=[];o&&(c=Nt(r,u));const a=[];u.forEach(m=>{const p=e[m];p&&a.push("grid-".concat(m,"-").concat(String(p)))});const h={root:["root",o&&"container",i&&"item",d&&"zeroMinWidth",...c,s!=="row"&&"direction-xs-".concat(String(s)),l!=="wrap"&&"wrap-xs-".concat(String(l)),...a]};return De(h,St,n)},Ot=g.forwardRef(function(n,o){const s=ke({props:n,name:"MuiGrid"}),{breakpoints:i}=Me(),r=Ie(s),{className:l,columns:d,columnSpacing:u,component:c="div",container:a=!1,direction:h="row",item:m=!1,rowSpacing:p,spacing:x=0,wrap:f="wrap",zeroMinWidth:b=!1}=r,j=$e(r,Rt),y=p||x,$=u||x,S=g.useContext(ce),M=a?d||12:S,D={},R=V({},j);i.keys.forEach(w=>{j[w]!=null&&(D[w]=j[w],delete R[w])});const C=V({},r,{columns:M,container:a,direction:h,item:m,rowSpacing:y,columnSpacing:$,wrap:f,zeroMinWidth:b,spacing:x},D,{breakpoints:i.keys}),k=Ft(C);return t.jsx(ce.Provider,{value:M,children:t.jsx(Wt,V({ownerState:C,className:Se(k.root,l),as:c,ref:o},R))})}),oe=Ot,zt=g.forwardRef(({MenuItemProps:e,className:n,label:o,LeftIcon:s,renderLabel:i,RightIcon:r,...l},d)=>t.jsxs(_e,{...e,ref:d,className:n,...l,children:[s&&t.jsx(se,{children:t.jsx(s,{fontSize:"small"})}),t.jsx(Te,{children:o}),r&&t.jsx(se,{style:{minWidth:0},children:t.jsx(r,{fontSize:"small"})})]})),je=g.forwardRef((e,n)=>{const{parentMenuOpen:o,label:s,renderLabel:i,RightIcon:r=J(Ee,Pe),LeftIcon:l,children:d,className:u,tabIndex:c,ContainerProps:a={},MenuProps:h,...m}=e,p=ne.useIsTouchDevice(),{ref:x,...f}=a,b=g.useRef(null);g.useImperativeHandle(n,()=>b.current);const j=g.useRef(null);g.useImperativeHandle(x,()=>j.current);const y=g.useRef(null),[$,S]=g.useState(!1),M=v=>{if($!==v){if(e.disabled){S(!1);return}S(v)}},D=v=>{p||(M(!0),f.onMouseEnter&&f.onMouseEnter(v))},R=v=>{M(!1),f.onMouseLeave&&f.onMouseLeave(v)},C=()=>{var z,A;const v=(A=(z=j.current)==null?void 0:z.ownerDocument.activeElement)!=null?A:null;if(y.current==null)return!1;for(const q of y.current.children)if(q===v)return!0;return!1},k=v=>{p||(v.target===j.current&&M(!0),f.onFocus&&f.onFocus(v))},w=v=>{M(!$),f.onClick&&f.onClick(v)},_=v=>{var A,q,re;if(v.key==="Escape")return;C()&&v.stopPropagation();const z=(A=j.current)==null?void 0:A.ownerDocument.activeElement;if(v.key==="ArrowLeft"&&C()&&((q=j.current)==null||q.focus()),v.key==="ArrowRight"&&v.target===j.current&&v.target===z){const X=(re=y.current)==null?void 0:re.children[0];X==null||X.focus()}},T=$&&o;let B;return e.disabled||(B=c!==void 0?c:-1),t.jsxs(F,{...f,ref:j,onFocus:k,onClick:w,tabIndex:B,onMouseEnter:D,onMouseLeave:R,onKeyDown:_,children:[t.jsx(zt,{MenuItemProps:m,className:u,ref:b,LeftIcon:l,RightIcon:r,label:s,renderLabel:i}),t.jsx(Re,{style:{pointerEvents:"none"},anchorEl:b.current,anchorOrigin:{horizontal:J("right","left"),vertical:"top"},transformOrigin:{horizontal:J("left","right"),vertical:"top"},open:T,autoFocus:!1,disableAutoFocus:!0,disableEnforceFocus:!0,onClose:()=>{M(!1)},...h,children:t.jsx(F,{ref:y,style:{pointerEvents:"auto"},children:d})})]})});je.displayName="NestedMenuItem";const At=["remove_from_library"],Kt=({manga:e,handleSelection:n,selectedMangas:o,onClose:s,setHideMenu:i})=>{const{t:r}=O(),[l,d]=g.useState(!1),u=!!e,c=o!=null?o:[],a=dt(u,jt),h=pt(u),m=ft(u),p=!!e&&e.downloadCount===e.chapters.totalCount,x=!!(e!=null&&e.downloadCount),f=!!(e!=null&&e.unreadCount),b=!!e&&e.unreadCount!==e.chapters.totalCount,{openCategorySelect:j,CategorySelectComponent:y}=nt({mangaId:e==null?void 0:e.id,mangaIds:o?I.getIds(c):void 0,onClose:()=>s(!0),addToLibrary:!1}),$=()=>{n==null||n(e.id,!0),s(!0)},S=(k,w)=>{I.performAction(k,e?[e.id]:I.getIds(w),{wasManuallyMarkedAsRead:!0}).catch(de()),s(!At.includes(k))},{downloadableMangas:M,downloadedMangas:D,unreadMangas:R,readMangas:C}=g.useMemo(()=>({downloadableMangas:[...I.getNotDownloaded(c),...I.getPartiallyDownloaded(c)],downloadedMangas:[...I.getPartiallyDownloaded(c),...I.getFullyDownloaded(c)],unreadMangas:[...I.getUnread(c),...I.getPartiallyRead(c)],readMangas:[...I.getPartiallyRead(c),...I.getFullyRead(c)]}),[c]);return t.jsxs(t.Fragment,{children:[!!n&&u&&t.jsx(E,{onClick:$,Icon:ot,title:r("chapter.action.label.select")}),h(!p)&&t.jsx(je,{disabled:m(!M.length),LeftIcon:Be,label:a("download",M.length),parentMenuOpen:!0,children:t.jsx(rt,{mangaIds:u?[e.id]:I.getIds(c),closeMenu:()=>s(!0)})}),h(x)&&t.jsx(E,{Icon:xt,disabled:m(!D.length),onClick:()=>S("delete",D),title:a("delete",D.length)}),h(f)&&t.jsx(E,{Icon:st,disabled:m(!R.length),onClick:()=>S("mark_as_read",R),title:a("mark_as_read",R.length)}),h(b)&&t.jsx(E,{Icon:it,disabled:m(!C.length),onClick:()=>S("mark_as_unread",C),title:a("mark_as_unread",C.length)}),u&&t.jsx(Y,{to:"/migrate/source/".concat(e==null?void 0:e.sourceId,"/manga/").concat(e==null?void 0:e.id,"/search?query=").concat(e==null?void 0:e.title),state:{mangaTitle:e==null?void 0:e.title},style:{textDecoration:"none",color:"inherit"},children:t.jsx(E,{Icon:at,title:a("migrate",c.length)})}),u&&t.jsx(E,{onClick:()=>{d(!0),i(!0)},Icon:bt,title:a("track",c.length)}),t.jsx(E,{onClick:()=>{j(!0),i(!0)},Icon:ct,title:a("change_categories",c.length)}),t.jsx(E,{onClick:()=>S("remove_from_library",c),Icon:lt,title:a("remove_from_library",c.length)}),y,l&&t.jsx(ue,{open:!0,maxWidth:"md",fullWidth:!0,scroll:"paper",onClose:()=>{d(!1),s(!0)},children:t.jsx(ut,{manga:e})})]})},Vt=({mangaIdToMigrateTo:e,onClose:n})=>{const{t:o}=O(),s=Ge(),{mangaId:i}=Le(),r=Number(i),{settings:{migrateChapters:l,migrateCategories:d,migrateTracking:u,deleteChapters:c}}=We(),[a,h]=g.useState(!1),m=ze(de()),p=async x=>{if(r==null)throw new Error('MigrateDialog::migrate: unexpected mangaId "'.concat(r,'"'));Ae(o("migrate.label.info"),"info"),h(!0);try{await I.migrate(r,e,{mode:x,migrateChapters:l,migrateCategories:d,migrateTracking:u,deleteChapters:c}),s("/manga/".concat(e),{replace:!0})}catch(f){h(!1)}};return t.jsxs(ue,{open:!0,fullWidth:!0,onClose:n,children:[t.jsx(Ne,{children:o("migrate.dialog.title")}),t.jsx(Fe,{dividers:!0,children:t.jsxs(Ct,{children:[t.jsx(Z,{disabled:a,label:o("chapter.title_one"),checked:l,onChange:(x,f)=>m("migrateChapters",f)}),t.jsx(Z,{disabled:a,label:o("category.title.category_one"),checked:d,onChange:(x,f)=>m("migrateCategories",f)}),t.jsx(Z,{disabled:a,label:o("tracking.title"),checked:u,onChange:(x,f)=>m("migrateTracking",f)}),t.jsx(Z,{disabled:a,label:o("migrate.dialog.label.delete_downloaded"),checked:c,onChange:(x,f)=>m("deleteChapters",f)})]})}),t.jsx(Oe,{children:t.jsxs(W,{sx:{width:"100%"},direction:"row",justifyContent:"space-between",children:[t.jsx(G,{disabled:a,component:Y,to:"/manga/".concat(e),children:o("migrate.dialog.action.button.show_entry")}),t.jsxs(W,{direction:"row",children:[t.jsx(G,{disabled:a,onClick:n,children:o("global.button.cancel")}),t.jsx(G,{disabled:a,onClick:()=>p("copy"),children:o("global.button.copy")}),t.jsx(G,{disabled:a,onClick:()=>p("migrate"),children:o("global.button.migrate")})]})]})})]})},Ce=g.forwardRef(({id:e,selected:n,handleSelection:o,asCheckbox:s=!1,popupState:i},r)=>{const{t:l}=O(),d=ne.useIsTouchDevice(),u=g.useMemo(()=>Ke(i),[i]),c=p=>{p.stopPropagation(),p.preventDefault()},a=(p,x)=>{c(p),o==null||o(e,x)},h=p=>{d||(c(p),i.open(p),u.onClick(p))};return o?n!==null?s?t.jsx(L,{title:l(n?"global.button.deselect":"global.button.select"),children:t.jsx(vt,{checked:n,onMouseDown:c,onChange:a})}):null:s?t.jsx(L,{title:l("global.button.options"),children:t.jsx(Ve,{ref:r,...u,onClick:h,onTouchStart:h,"aria-label":"more",size:"large",onMouseDown:c,children:t.jsx(ae,{})})}):t.jsx(L,{title:l("global.button.options"),children:t.jsx(G,{ref:r,...u,onClick:h,onTouchStart:h,className:"manga-option-button",size:"small",variant:"contained",sx:{minWidth:"unset",paddingX:"0",paddingY:"2.5px",visibility:i.isOpen?"visible":"hidden",pointerEvents:"none","@media not (pointer: fine)":{visibility:"hidden",pointerEvents:void 0}},onMouseDown:p=>p.stopPropagation(),children:t.jsx(ae,{})})}):null}),Ut=H("div")({position:"absolute",bottom:0,width:"100%",height:"30%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),Ht=H("div")({position:"absolute",bottom:0,width:"100%",height:"20%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),Yt=({manga:e,longPressBind:n,popupState:o,handleClick:s,mangaLinkTo:i,selected:r,inLibraryIndicator:l,isInLibrary:d,gridLayout:u,handleSelection:c,continueReadingButton:a,mangaBadges:h,mode:m})=>{const p=g.useRef(null),{id:x,title:f}=e;return t.jsx(wt,{component:Y,...n(()=>o.open(p.current)),onClick:s,to:i,state:{mangaTitle:f},sx:{textDecoration:"none",touchCallout:"none"},children:t.jsxs(F,{sx:{display:"flex",flexDirection:"column",m:.25,outline:r?"4px solid":void 0,borderRadius:r?"1px":void 0,outlineColor:b=>b.palette.primary.main,backgroundColor:b=>r?b.palette.primary.main:void 0,"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:m==="source"?"none":"flex"}}},children:[t.jsx(xe,{sx:{aspectRatio:"225/350",display:"flex"},children:t.jsxs(ge,{sx:{position:"relative",height:"100%"},children:[t.jsx(me,{alt:f,src:I.getThumbnailUrl(e),imgStyle:l&&d?{height:"100%",width:"100%",objectFit:"cover",filter:"brightness(0.4)"}:{height:"100%",width:"100%",objectFit:"cover"},spinnerStyle:{display:"grid",placeItems:"center"}}),t.jsxs(W,{alignItems:"start",justifyContent:"space-between",direction:"row",sx:{position:"absolute",top:b=>b.spacing(1),left:b=>b.spacing(1),right:b=>b.spacing(1)},children:[h,t.jsx(Ce,{ref:p,popupState:o,id:x,selected:r,handleSelection:c})]}),t.jsxs(t.Fragment,{children:[u!==P.Comfortable&&t.jsxs(t.Fragment,{children:[t.jsx(Ut,{}),t.jsx(Ht,{})]}),t.jsxs(W,{direction:"row",justifyContent:u!==P.Comfortable?"space-between":"end",alignItems:"end",sx:{position:"absolute",bottom:0,width:"100%",p:1,gap:1},children:[u!==P.Comfortable&&t.jsx(L,{title:f,placement:"top",children:t.jsx(ee,{component:"h3",sx:{color:"white",textShadow:"0px 0px 3px #000000"},children:f})}),a]})]})]})}),u===P.Comfortable&&t.jsx(W,{sx:{pb:1},children:t.jsx(L,{title:f,placement:"top",children:t.jsx(ee,{component:"h3",sx:{color:"text.primary",height:"3rem",pt:.5},children:f})})})]})})},qt=({manga:e,longPressBind:n,popupState:o,handleClick:s,mangaLinkTo:i,selected:r,inLibraryIndicator:l,isInLibrary:d,handleSelection:u,continueReadingButton:c,mangaBadges:a,mode:h})=>{const m=g.useRef(null),{id:p,title:x}=e;return t.jsx(xe,{children:t.jsx(ge,{component:Y,to:i,state:{mangaTitle:x},onClick:s,...n(()=>o.open(m.current)),sx:{touchCallout:"none","@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:h==="source"?"none":"inline-flex"}}},children:t.jsxs(yt,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5,position:"relative"},children:[t.jsx(kt,{variant:"rounded",sx:{width:56,height:56,flex:"0 0 auto",marginRight:1},children:t.jsx(me,{spinnerStyle:{small:!0},imgStyle:{objectFit:"cover",width:"100%",height:"100%",imageRendering:"pixelated",filter:l&&d?"brightness(0.4)":void 0},alt:e.title,src:I.getThumbnailUrl(e)})}),t.jsx(F,{sx:{display:"flex",flexDirection:"row",flexGrow:1,width:"min-content"},children:t.jsx(L,{title:x,placement:"top",children:t.jsx(ee,{variant:"h6",component:"h3",children:x})})}),t.jsxs(W,{direction:"row",alignItems:"center",gap:.5,children:[a,c,t.jsx(Ce,{ref:m,popupState:o,id:p,selected:r,handleSelection:u,asCheckbox:!0})]})]})})})},Zt=({showContinueReadingButton:e,nextChapterIndexToRead:n,mangaLinkTo:o})=>{const{t:s}=O(),i=n===1;return!e||n===void 0?null:t.jsx(L,{title:s(i?"global.button.start":"global.button.resume"),children:t.jsx(G,{variant:"contained",size:"small",sx:{minWidth:"unset",py:.5,px:.75},component:Y,to:"".concat(o,"chapter/").concat(n),onClick:r=>r.stopPropagation(),onMouseDown:r=>r.stopPropagation(),children:t.jsx(Mt,{})})})},Qt=H("div")(({theme:e})=>({display:"flex",height:"fit-content",borderRadius:e.shape.borderRadius,overflow:"hidden"})),le=H(pe)(({theme:e})=>({color:e.palette.primary.contrastText,paddingInline:e.spacing(.3)})),Xt=({inLibraryIndicator:e,updateLibraryState:n,isInLibrary:o,unread:s,downloadCount:i,mode:r})=>{const{t:l}=O(),d=ne.useIsTouchDevice(),{options:{showUnreadBadge:u,showDownloadBadge:c}}=fe();return t.jsxs(Qt,{children:[!d&&e&&r==="source"&&t.jsx(G,{className:"source-manga-library-state-button",component:"div",variant:"contained",size:"small",onMouseDown:a=>a.stopPropagation(),onClick:a=>{a.preventDefault(),a.stopPropagation(),n()},sx:{display:"none"},color:o?"error":"primary",children:l(o?"manga.action.library.remove.label.action":"manga.button.add_to_library")}),e&&o&&t.jsx(pe,{className:"source-manga-library-state-indicator",sx:{backgroundColor:"primary.dark"},children:l("manga.button.in_library")}),(u&&r==="default"||r==="duplicate")&&(s!=null?s:0)>0&&t.jsx(le,{sx:{backgroundColor:"primary.dark"},children:s}),(c&&r==="default"||r==="duplicate")&&(i!=null?i:0)>0&&t.jsx(le,{sx:{backgroundColor:"primary.light"},children:i})]})},Jt=(e,n,o,s)=>{switch(e){case"default":case"source":case"duplicate":return"/manga/".concat(n,"/");case"migrate.search":return"/migrate/source/".concat(o,"/manga/").concat(n,"/search?query=").concat(s);case"migrate.select":return"";default:throw new Error('getMangaLinkTo: unexpected MangaCardMode "'.concat(e,'"'))}},en=e=>{const{manga:n,gridLayout:o,inLibraryIndicator:s,selected:i,handleSelection:r,mode:l="default"}=e,{id:d,firstUnreadChapter:u,downloadCount:c,unreadCount:a}=n,{options:{showContinueReadingButton:h}}=fe(),{CategorySelectComponent:m,updateLibraryState:p,isInLibrary:x}=ht(n,l==="source"),f=Jt(l,n.id,n.sourceId,n.title),b=u==null?void 0:u.sourceOrder,[j,y]=g.useState(!1),$=(C,k)=>{const w=l==="default",_=l==="source",T=l==="migrate.select",B=i!==null;if(T||B||(w||_)&&k){if(C.preventDefault(),_){p();return}if(B){r==null||r(d,!i,{selectRange:C.shiftKey});return}if(w){k==null||k();return}T&&y(!0)}},S=gt((C,{context:k})=>{C.shiftKey=!0,$(C,k)}),M=g.useMemo(()=>o===P.List?qt:Yt,[o]),D=g.useMemo(()=>t.jsx(Zt,{showContinueReadingButton:h&&l==="default",nextChapterIndexToRead:b,mangaLinkTo:f}),[h,b,f]),R=g.useMemo(()=>t.jsx(Xt,{inLibraryIndicator:s,isInLibrary:x,unread:a,downloadCount:c,updateLibraryState:p,mode:l}),[s,x,a,c,p]);return t.jsxs(t.Fragment,{children:[j&&t.jsx(Vt,{mangaIdToMigrateTo:n.id,onClose:()=>y(!1)}),t.jsx(Ue,{variant:"popover",popupId:"manga-card-action-menu",children:C=>t.jsxs(t.Fragment,{children:[t.jsx(M,{...e,longPressBind:S,popupState:C,handleClick:$,mangaLinkTo:f,isInLibrary:x,inLibraryIndicator:s,continueReadingButton:D,mangaBadges:R}),!!r&&C.isOpen&&t.jsx(mt,{...He(C),children:(k,w)=>t.jsx(Kt,{manga:n,handleSelection:r,onClose:k,setHideMenu:w})}),m]})})]})},tn=Ye.forwardRef(({children:e,...n},o)=>t.jsx(oe,{...n,ref:o,container:!0,sx:{paddingLeft:"5px",paddingRight:"13px"},children:e})),nn=(e,n,o,s=12)=>{const i=Math.ceil(e/n),r=o===P.List?s:s/i;return({children:l,...d})=>t.jsx(oe,{...d,item:!0,xs:r,sx:{width:"100%",paddingTop:"8px",paddingLeft:"8px"},children:l})},ve=(e,n,o,s=!1,i,r,l)=>t.jsx(en,{manga:e,gridLayout:n,inLibraryIndicator:o,selected:s?i==null?void 0:i.includes(e.id):null,handleSelection:r,mode:l},e.id),on=g.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:s,gridLayout:i,isSelectModeActive:r,selectedMangaIds:l,handleSelection:d,mode:u},c)=>t.jsx(oe,{ref:c,container:!0,spacing:1,style:{margin:0,width:"100%",padding:"5px",overflowX:"auto",display:"-webkit-inline-box",flexWrap:"nowrap"},children:e?t.jsx(he,{}):n.map(a=>t.jsx(s,{children:ve(a,i,o,r,l,d,u)},a.id))})),rn=e=>"MangaGrid-snapshot-location-".concat(e.key),sn=g.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:s,gridLayout:i,hasNextPage:r,loadMore:l,isSelectModeActive:d,selectedMangaIds:u,handleSelection:c,mode:a},h)=>{const m=qe(),p=rn(m),[x]=Ze(p,void 0),f=g.useRef(),b=j=>{const y=window.location.href;clearTimeout(f.current),f.current=setTimeout(()=>{y===window.location.href&&Qe.session.setItem(p,j,!1)},250)};return g.useEffect(()=>clearTimeout(f.current),[m.key,f.current]),t.jsxs(t.Fragment,{children:[t.jsx(F,{ref:h,children:t.jsx(tt,{useWindowScroll:!0,overscan:window.innerHeight*.25,totalCount:n.length,components:{List:tn,Item:s},restoreStateFrom:x,stateChanged:b,endReached:()=>l(),itemContent:j=>ve(n[j],i,o,d,u,c,a)})}),d&&i===P.List?t.jsx(F,{sx:{paddingBottom:It}}):e?t.jsx(he,{}):r?t.jsx("div",{style:{height:"75px"}}):null]})}),yn=({mangas:e,isLoading:n,message:o,messageExtra:s,hasNextPage:i,loadMore:r,gridLayout:l,horizontal:d,noFaces:u,inLibraryIndicator:c,isSelectModeActive:a,selectedMangaIds:h,handleSelection:m,mode:p,retry:x})=>{var C,k;const{t:f}=O(),{navBarWidth:b}=Xe(),j=g.useRef(null),y=g.useRef(null),[$,S]=g.useState((k=(C=y.current)==null?void 0:C.offsetWidth)!=null?k:Math.max(0,document.documentElement.offsetWidth-b)),[M]=Je("ItemWidth",300),D=g.useMemo(()=>nn($,M,l),[$,M,l]);return g.useLayoutEffect(()=>{let w;const _=T=>{w=setTimeout(()=>{if(document.body.style.overflow.includes("hidden")){_(250);return}document.body.style.overflowY=l===P.List?"auto":"scroll"},T)};return _(0),()=>{clearTimeout(w)}},[l]),g.useLayoutEffect(()=>()=>{document.body.style.overflowY="auto"},[]),ie(y,g.useCallback(()=>{S((()=>{var T;const _=(T=y.current)==null?void 0:T.offsetWidth;return _||document.documentElement.offsetWidth-b})())},[b])),ie(j,g.useCallback((w,_)=>{const T=w[0].target.clientHeight,B=T>document.documentElement.clientHeight;if(!n&&T){if(B){_.disconnect();return}r(),_.disconnect()}},[j,r,n])),!n&&e.length===0?t.jsx(et,{noFaces:u,message:o!=null?o:f("manga.error.label.no_mangas_found"),messageExtra:s,retry:x}):t.jsx("div",{ref:y,style:{overflow:"hidden",paddingBottom:"13px"},children:d?t.jsx(on,{ref:j,isLoading:n,mangas:e,inLibraryIndicator:c,GridItemContainer:D,gridLayout:l,isSelectModeActive:a,selectedMangaIds:h,handleSelection:m,mode:p}):t.jsx(sn,{ref:j,isLoading:n,mangas:e,inLibraryIndicator:c,GridItemContainer:D,hasNextPage:i,loadMore:r,gridLayout:l,isSelectModeActive:a,selectedMangaIds:h,handleSelection:m,mode:p})})};export{yn as M,Kt as a,en as b,rn as g};
