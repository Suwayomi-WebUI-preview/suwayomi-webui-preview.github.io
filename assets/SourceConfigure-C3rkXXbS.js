import{j as e,b as g,o as _,p as k,u as V,aP as D,i as L,k as O,n as B,b7 as A,q as F,B as j,aA as b,aF as G,r as E,b8 as N,e as R,g as w,f as q,F as H,m as J}from"./index-DBfGTIZV.js";import{S as U}from"./Switch-__d_HYA7.js";import{C as M,F as W}from"./Checkbox-DPF2Xe2W.js";import{L as $}from"./ListPreference-BnXJQMU5.js";import{T as z}from"./TextField-BKPRISVG.js";import{F as K}from"./FormGroup-DtvM34RA.js";import{E as Q}from"./EmptyViewAbsoluteCentered-rOGaD3Mh.js";import{u as X}from"./useAppTitle-DJFXX9Js.js";import"./SwitchBase-COUmJuqQ.js";import"./useFormControl-x0-kuXF8.js";import"./formControlState-Dq1zat_P.js";function y(t){return JSON.parse(JSON.stringify(t))}function Y(t){return t==="Switch"?U:M}const Z=t=>t.type==="CheckBoxPreference"?{title:t.CheckBoxTitle,defaultValue:t.CheckBoxDefault,currentValue:t.CheckBoxCheckBoxCurrentValue}:{title:t.SwitchPreferenceTitle,defaultValue:t.SwitchPreferenceDefault,currentValue:t.SwitchPreferenceCurrentValue};function I(t){const{title:o,defaultValue:l,currentValue:r,summary:f,updateValue:h,twoStateType:s}={...t,...Z(t)},[a,i]=g.useState(r!=null?r:l);g.useEffect(()=>{i(r!=null?r:l)},[r]);const c=g.useMemo(()=>Y(s),[s]);return e.jsxs(_,{children:[e.jsx(k,{primary:o,secondary:f}),e.jsx(c,{edge:"end",checked:a,onChange:()=>{h(s==="Switch"?"switchState":"checkBoxState",!r),i(!r)}})]})}function v(t){return e.jsx(I,{...t,twoStateType:"Checkbox"})}function ee(t){return e.jsx(I,{...t,twoStateType:"Switch"})}function te(t){const{t:o}=V(),{EditTextPreferenceTitle:l,summary:r,dialogTitle:f,dialogMessage:h,EditTextPreferenceCurrentValue:s,updateValue:a}=t,[i,c]=g.useState(s!=null?s:""),[m,d]=g.useState(!1),u=()=>{d(!1),c(s!=null?s:"")},x=()=>{d(!1),a("editTextState",i)};return e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:()=>d(!0),children:e.jsx(k,{primary:l,secondary:r})}),e.jsxs(L,{open:m,onClose:u,children:[e.jsx(O,{children:f}),e.jsxs(B,{children:[e.jsx(A,{children:h}),e.jsx(z,{autoFocus:!0,margin:"dense",id:"name",type:"text",fullWidth:!0,value:i,onChange:C=>c(C.target.value)})]}),e.jsxs(F,{children:[e.jsx(j,{onClick:u,color:"primary",children:o("global.button.cancel")}),e.jsx(j,{onClick:x,color:"primary",children:o("global.button.ok")})]})]})]})}function re(t){const{t:o}=V(),{selectedValues:l,open:r,onClose:f,values:h,title:s}=t,[a,i]=b.useState(l);b.useEffect(()=>{r||i(l)},[l,r]);const c=()=>{f(null)},m=()=>{f(a)},d=(u,x)=>{const{checked:C}=u.target,S=a.some(n=>x===n);if(C){if(!S){const n=y(a);n.push(x),i(n)}}else if(S){const n=y(a),p=n.indexOf(x);n.splice(p,1),i(n)}};return e.jsxs(L,{sx:{"& .MuiDialog-paper":{width:"80%",maxHeight:435}},maxWidth:"xs",open:r,onClose:c,children:[e.jsx(O,{children:s}),e.jsx(B,{dividers:!0,children:e.jsx(K,{children:h.map(u=>e.jsx(W,{control:e.jsx(M,{checked:a.some(x=>u===x),onChange:x=>d(x,u)}),label:u},u))})}),e.jsxs(F,{children:[e.jsx(j,{autoFocus:!0,onClick:c,children:o("global.button.cancel")}),e.jsx(j,{onClick:m,children:o("global.button.ok")})]})]})}function ne(t){const{MultiSelectListPreferenceTitle:o,summary:l,MultiSelectListPreferenceCurrentValue:r,MultiSelectListPreferenceDefault:f,updateValue:h,entryValues:s,entries:a}=t,[i,c]=g.useState(r!=null?r:f),[m,d]=g.useState(!1);g.useEffect(()=>{c(r)},[r]);const u=n=>{var p;return(p=n==null?void 0:n.map(T=>{const P=s.indexOf(T);return a[P]}))!=null?p:[]},x=n=>{var p;return(p=n==null?void 0:n.map(T=>{const P=a.indexOf(T);return s[P]}))!=null?p:[]},C=()=>l,S=n=>{n!==null&&(h("multiSelectState",x(n)),c(n)),d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:()=>d(!0),children:e.jsx(k,{primary:o,secondary:C()})}),e.jsx(re,{title:o!=null?o:"",open:m,onClose:S,selectedValues:u(i),values:a})]})}function se(t){switch(t){case"CheckBoxPreference":return v;case"SwitchPreference":return ee;case"ListPreference":return $;case"EditTextPreference":return te;case"MultiSelectListPreference":return ne;default:throw new Error('Unexpected preference type "'.concat(t,'"'))}}function ge(){var i;const{t}=V();X(t("source.configuration.title"));const{sourceId:o}=G(),{data:l,loading:r,error:f,refetch:h}=E.useGetSource(N,o,{notifyOnNetworkStatusChange:!0}),s=(i=l==null?void 0:l.source.preferences)!=null?i:[],a=c=>(m,d)=>{E.setSourcePreferences(o,{position:c,[m]:d}).response.catch(u=>J(t("global.error.label.failed_to_save_changes"),"error",w(u)))};return r?e.jsx(R,{}):f?e.jsx(Q,{message:t("global.error.label.failed_to_load_data"),messageExtra:w(f),retry:()=>h().catch(q())}):e.jsx(H,{sx:{padding:0},children:s.map((c,m)=>{const d=y(c);return g.createElement(se(c.type),{...d,updateValue:a(m)})})})}export{ge as SourceConfigure};
