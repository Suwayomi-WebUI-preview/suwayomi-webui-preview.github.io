import{u as F,j as e,B as u,C as P,b as M,T as q,d as z,k as T,I as S,N as U,r as i,f as W,h as n,bi as V,ax as X,l as J,E as K,m as y,n as Q,p as Y,ar as Z,aW as $,aX as ee,bb as te,bj as ae,a1 as oe,a_ as re,e as k,o as I}from"./index-CdIRtPGW.js";import{a as se,D as ne,S as le,P as ie}from"./StrictModeDroppable-CJvJv5h_.js";import{D as ce,F as de}from"./StyledFab-0uIK9mZC.js";import{E as ge}from"./Edit-Biz3Ht3v.js";const ue=({category:a,provided:s,onEdit:c})=>{const{t:r}=F(),h=()=>{i.deleteCategory(a.id)};return e.jsx(u,{sx:{p:1,pb:0},...s.draggableProps,...s.dragHandleProps,ref:s.innerRef,children:e.jsx(P,{children:e.jsxs(M,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:1.5,"&:last-child":{paddingBottom:1.5},gap:2},children:[e.jsx(se,{}),e.jsx(q,{sx:{flexGrow:1},variant:"h6",component:"h2",children:a.name}),e.jsxs(z,{sx:{flexDirection:"row"},children:[e.jsx(T,{title:r("global.button.edit"),children:e.jsx(S,{component:u,onClick:c,size:"large",children:e.jsx(ge,{})})}),e.jsx(T,{title:r("chapter.action.download.delete.label.action"),children:e.jsx(S,{component:u,onClick:h,size:"large",children:e.jsx(U,{})})})]})]})})})};function fe(){const{t:a}=F(),{setTitle:s,setAction:c}=W();n.useLayoutEffect(()=>(s(a("category.dialog.title.edit_category_other")),c(null),()=>{s(""),c(null)}),[a]);const{data:r,loading:h,error:C,refetch:B}=i.useGetCategories(V,{notifyOnNetworkStatusChange:!0}),l=n.useMemo(()=>{var o;const t=[...(o=r==null?void 0:r.categories.nodes)!=null?o:[]];return t.length>0&&t[0].name==="Default"&&t.shift(),t},[r]),[x,D]=n.useState(-1),[w,d]=n.useState(!1),[p,m]=n.useState(""),[f,b]=n.useState(!1),[A,{reset:R}]=i.useReorderCategory(),E=X(),G=(t,o,g)=>{const j=t[o];A({variables:{input:{id:j.id,position:g+1}}}).catch(()=>R())},L=t=>{t.destination&&G(l,t.source.index,t.destination.index)},N=()=>{m(""),b(!1),D(-1)},O=()=>{N(),d(!0)},v=t=>{m(l[t].name),b(l[t].default),D(t),d(!0)},_=()=>{d(!1)},H=()=>{if(d(!1),x===-1)i.createCategory({name:p,default:f}).response.catch(t=>I(a("category.error.label.create_failure"),"error",y(t)));else{const t=l[x];i.updateCategory(t.id,{name:p,default:f}).response.catch(o=>I(a("global.error.label.failed_to_save_changes"),"error",y(o)))}};return h?e.jsx(J,{}):C?e.jsx(K,{message:a("category.error.label.request_failure"),messageExtra:y(C),retry:()=>B().catch(Q())}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{onDragEnd:L,children:e.jsx(le,{droppableId:"droppable",children:t=>e.jsxs(u,{ref:t.innerRef,sx:{paddingBottom:ce},children:[l.map((o,g)=>e.jsx(ie,{draggableId:o.id.toString(),index:g,children:j=>e.jsx(ue,{provided:j,category:o,onEdit:()=>v(g)})},o.id)),t.placeholder]})})}),e.jsx(de,{color:"primary","aria-label":"add",style:{position:"fixed",bottom:E.spacing(2),right:E.spacing(2)},onClick:O,children:e.jsx(Y,{})}),e.jsxs(Z,{open:w,onClose:_,children:[e.jsx($,{id:"form-dialog-title",children:a(x===-1?"category.dialog.title.new_category":"category.dialog.title.edit_category_one")}),e.jsxs(ee,{children:[e.jsx(te,{autoFocus:!0,margin:"dense",id:"name",label:a("category.label.category_name"),type:"text",fullWidth:!0,value:p,onChange:t=>m(t.target.value)}),e.jsx(ae,{control:e.jsx(oe,{checked:f,onChange:t=>b(t.target.checked)}),label:a("category.label.use_as_default_category")})]}),e.jsxs(re,{children:[e.jsx(k,{onClick:_,color:"primary",children:a("global.button.cancel")}),e.jsx(k,{onClick:H,color:"primary",children:a("global.button.submit")})]})]})]})}export{fe as CategorySettings};
