import{bX as A,bY as M,h as x,bZ as R,b_ as U,j as t,a9 as F,b6 as P,b$ as E,u as w,r as b,af as N,aZ as D,ag as O,aJ as j,c0 as $,ap as q,aq as W,aS as B,aT as G,b5 as V,aV as J,e as C,o as v,m as I,f as Z,q as H,O as K,E as X,n as S,l as Y,w as k,aU as _,s as z,b3 as Q}from"./index-BKHCEc_C.js";import{P as ee}from"./PasswordTextField-CGwdle5-.js";import{T as h}from"./Trackers-D4pSmk7a.js";import{A as te}from"./Avatar-CTaLFrXq.js";import{C as se}from"./Chip-0kfDpumZ.js";import{S as y}from"./Switch-BSyxNVq4.js";function ae(e){return A("MuiListItemAvatar",e)}M("MuiListItemAvatar",["root","alignItemsFlexStart"]);const re=e=>{const{alignItems:s,classes:r}=e;return E({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},ae,r)},ne=F("div",{name:"MuiListItemAvatar",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:r}=e;return[s.root,r.alignItems==="flex-start"&&s.alignItemsFlexStart]}})({minWidth:56,flexShrink:0,variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}),ie=x.forwardRef(function(s,r){const l=R({props:s,name:"MuiListItemAvatar"}),{className:u,...n}=l,m=x.useContext(U),i={...l,alignItems:m.alignItems},g=re(i);return t.jsx(ne,{className:P(g.root,u),ownerState:i,ref:r,...n})}),oe=({tracker:e})=>{const{t:s}=w(),[r,{loading:l}]=b.useLoginToTrackerCredentials(),[u]=b.useLogoutFromTracker(),[n,m]=x.useState(""),[i,g]=x.useState(""),d=!e.isLoggedIn&&!!e.authUrl,p=async()=>{try{await u({variables:{trackerId:e.id}})}catch(a){v(s("tracking.action.logout.label.failure",{name:e.name}),"error",I(a))}},f=async()=>{if(d){const a={redirectUrl:"".concat(window.location.origin,"/tracker/login/oauth"),clientName:"Suwayomi-WebUI",trackerId:e.id,trackerName:e.name};window.open("".concat(e.authUrl,"&state=").concat(JSON.stringify(a)),"_self");return}try{await r({variables:{input:{trackerId:e.id,username:n,password:i}}})}catch(a){v(s("tracking.action.login.label.failure",{name:e.name}),"error",I(a))}},L=a=>{if(!d){a();return}f()};return t.jsx(N,{variant:"popover",popupId:"tracker-dialog",children:a=>t.jsxs(t.Fragment,{children:[t.jsxs(D,{...O(a),onClick:()=>L(a.open),children:[t.jsx(ie,{sx:{paddingRight:"20px"},children:t.jsx(te,{alt:"".concat(e.name),src:b.getValidImgUrlFor(e.icon),variant:"rounded",sx:{width:64,height:64}})}),t.jsx(j,{primary:e.name}),h.isLoggedIn(e)&&t.jsx($,{children:t.jsx(se,{label:s("global.label.logged_in"),color:"success"})})]}),t.jsxs(q,{...W(a),open:(h.isLoggedIn(e)||!e.authUrl)&&a.isOpen,disableRestoreFocus:!0,children:[t.jsx(B,{children:s(h.isLoggedIn(e)?"tracking.settings.dialog.title.log_out":"tracking.settings.dialog.title.log_in",{name:e.name})}),!d&&!e.isLoggedIn&&t.jsxs(G,{children:[t.jsx(V,{autoFocus:!0,margin:"dense",id:"username",name:"username",label:s("global.label.username"),type:"text",fullWidth:!0,variant:"standard",onChange:c=>m(c.target.value)}),t.jsx(ee,{margin:"dense",fullWidth:!0,variant:"standard",onChange:c=>g(c.target.value)})]}),t.jsxs(J,{children:[t.jsx(C,{onClick:a.close,children:s("global.button.cancel")}),t.jsx(C,{variant:"contained",disabled:!d&&!e.isLoggedIn&&(l||!n.length||!i.length),onClick:()=>h.isLoggedIn(e)?p():f(),children:s(h.isLoggedIn(e)?"global.button.log_out":"global.button.log_in")})]})]})]})})},he=()=>{var T;const{t:e}=w(),{setTitle:s}=Z();x.useLayoutEffect(()=>{s(e("tracking.settings.title.settings"))},[e]);const{settings:{updateProgressAfterReading:r,updateProgressManualMarkRead:l},loading:u,request:{error:n,refetch:m}}=H(),i=z(o=>v(e("global.error.label.failed_to_save_changes"),"error",I(o))),{data:g,loading:d,error:p,refetch:f}=b.useGetTrackerList(K,{notifyOnNetworkStatusChange:!0}),L=(T=g==null?void 0:g.trackers.nodes)!=null?T:[],a=u||d,c=n!=null?n:p;return c?t.jsx(X,{message:e("global.error.label.failed_to_load_data"),messageExtra:I(c),retry:()=>{n&&m().catch(S()),p&&f().catch(S())}}):a?t.jsx(Y,{}):t.jsxs(t.Fragment,{children:[t.jsxs(k,{sx:{pt:0},children:[t.jsxs(_,{children:[t.jsx(j,{primary:e("tracking.settings.label.update_progress_reading")}),t.jsx(y,{edge:"end",checked:r,onChange:o=>i("updateProgressAfterReading",o.target.checked)})]}),t.jsxs(_,{children:[t.jsx(j,{primary:e("tracking.settings.label.update_progress_manual"),secondary:e("tracking.settings.label.update_progress_reading_description")}),t.jsx(y,{edge:"end",checked:l,onChange:o=>i("updateProgressManualMarkRead",o.target.checked)})]})]}),t.jsx(k,{subheader:t.jsx(Q,{component:"div",id:"tracking-trackers",children:e("tracking.settings.title.trackers")}),children:L.map(o=>t.jsx(oe,{tracker:o},o.id))})]})};export{he as TrackingSettings};
