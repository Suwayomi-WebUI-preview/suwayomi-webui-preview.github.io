import{r as M,i as T,j as e,u as $,c as n,f as v,N as F,k as f,I as u,J as x,l as K,E as P,m as g,n as z,B as b,V as G,C as J,a as W,L as U,A as X,b as Y,d as Z,T as q,K as ee,O as te,P as ae,Q as re,o as w}from"./index-CdMcb195.js";import{D as oe,S as se,P as ne,d as le}from"./StrictModeDroppable-DZ0SEuWk.js";import{d as de}from"./PlayArrow-BRV_mkpZ.js";var _={},ie=T;Object.defineProperty(_,"__esModule",{value:!0});var H=_.default=void 0,ce=ie(M()),ue=e;H=_.default=(0,ce.default)((0,ue.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause");var D={},pe=T;Object.defineProperty(D,"__esModule",{value:!0});var L=D.default=void 0,he=pe(M()),xe=e;L=D.default=(0,he.default)((0,xe.jsx)("path",{d:"M15 16h4v2h-4zm0-8h7v2h-7zm0 4h6v2h-6zM3 18c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V8H3zM14 5h-3l-1-1H6L5 5H2v2h12z"}),"DeleteSweep");const ge=({children:a,...o})=>e.jsx(b,{...o,style:{height:o["data-known-size"]||void 0},children:a}),k=({provided:a,item:o,handleDelete:j,handleRetry:i})=>{const{t:p}=$();return e.jsx(b,{...a.draggableProps,...a.dragHandleProps,ref:a.innerRef,sx:{p:1,pb:0},children:e.jsx(J,{children:e.jsx(W,{component:U,to:X.manga.path(o.manga.id),children:e.jsxs(Y,{sx:{display:"flex",alignItems:"center",p:1.5},children:[e.jsx(u,{sx:{pointerEvents:"none"},children:e.jsx(le,{})}),e.jsxs(Z,{sx:{flex:1,ml:1},direction:"column",children:[e.jsx(q,{variant:"h6",component:"h3",children:o.manga.title}),e.jsx(q,{variant:"caption",sx:{display:"block"},children:o.chapter.name})]}),e.jsx(ee,{download:o}),o.state===te.Error&&e.jsx(f,{title:p("global.button.retry"),children:e.jsx(u,{onClick:l=>{l.preventDefault(),l.stopPropagation(),i(o.chapter)},size:"large",children:e.jsx(ae,{})})}),e.jsx(f,{title:p("chapter.action.download.delete.label.action"),children:e.jsx(u,{onClick:l=>{l.preventDefault(),l.stopPropagation(),j(o.chapter)},size:"large",children:e.jsx(re,{})})})]})})})})},ve=()=>{var R,I;const{t:a}=$(),[o,{reset:j}]=n.useReorderChapterInDownloadQueue(),{data:i,loading:p,error:l,refetch:Q}=n.useGetDownloadStatus({notifyOnNetworkStatusChange:!0}),d=i==null?void 0:i.downloadStatus,h=(R=d==null?void 0:d.queue)!=null?R:[],c=(I=d==null?void 0:d.state)!=null?I:"STARTED",m=!h.length,{setTitle:y,setAction:C}=v.useContext(F),A=async()=>{try{await n.clearDownloads().response}catch(t){w(a("download.queue.error.label.failed_delete_all"),"error",g(t))}},O=()=>{c===x.Stopped?n.startDownloads():n.stopDownloads()};v.useLayoutEffect(()=>(y(a("download.queue.title")),C(e.jsxs(e.Fragment,{children:[e.jsx(f,{title:a("download.queue.label.delete_all"),children:e.jsx(u,{onClick:A,size:"large",color:"inherit",children:e.jsx(L,{})})}),e.jsx(f,{title:a(c===x.Started?"global.button.start":"global.button.stop"),children:e.jsx(u,{onClick:O,size:"large",disabled:m,color:"inherit",children:c===x.Stopped?e.jsx(de,{}):e.jsx(H,{})})})]})),()=>{y(""),C(null)}),[a,c,m]),v.useEffect(()=>{const t=r=>{(r.message==="ResizeObserver loop completed with undelivered notifications."||r.message==="ResizeObserver loop limit exceeded")&&r.stopImmediatePropagation()};return window.addEventListener("error",t),()=>window.removeEventListener("error",t)},[]);const V=(t,r,s)=>{r!==s&&o({variables:{input:{chapterId:t[r].chapter.id,to:s}}}).catch(()=>{j()})},B=t=>{t.destination&&V(h,t.source.index,t.destination.index)},S=async t=>{try{await n.addChapterToDownloadQueue(t.id).response}catch(r){w(a("download.queue.error.label.failed_to_remove"),"error",g(r))}},E=async t=>{const r=c===x.Started;try{r&&await n.stopDownloads().response,await Promise.all([n.removeChapterFromDownloadQueue(t.id).response,n.deleteDownloadedChapter(t.id).response])}catch(s){w(a("download.queue.error.label.failed_to_retry"),"error",g(s))}r&&n.startDownloads().response.catch(z())};return p?e.jsx(K,{}):l?e.jsx(P,{message:a("global.error.label.failed_to_load_data"),messageExtra:g(l),retry:()=>Q().catch(z())}):m?e.jsx(P,{message:a("download.queue.label.no_downloads")}):e.jsx(oe,{onDragEnd:B,children:e.jsx(se,{droppableId:"droppable",mode:"virtual",renderClone:(t,r,s)=>e.jsx(k,{provided:t,item:h[s.source.index],handleDelete:E,handleRetry:S}),children:t=>e.jsx(b,{ref:t.innerRef,children:e.jsx(G,{useWindowScroll:!0,overscan:window.innerHeight*.5,data:h,components:{Item:ge},computeItemKey:(r,s)=>s.chapter.id,itemContent:(r,s)=>e.jsx(ne,{draggableId:"".concat(s.chapter.id),index:r,children:N=>e.jsx(k,{provided:N,item:s,handleDelete:E,handleRetry:S})})})})})})};export{ve as DownloadQueue};
