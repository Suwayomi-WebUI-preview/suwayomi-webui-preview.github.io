import{c as M,j as s,f as t,u as $,b as C,G as T,aw as q,aH as U,B as _,r as G,b8 as A}from"./index-D8Oh_qVq.js";import{R as O}from"./Refresh-DvhQbzDR.js";import{I as Q}from"./Image-0CLmpHMJ.js";const J=M(s.jsx("path",{d:"M21 5v6.59l-3-3.01-4 4.01-4-4-4 4-3-3.01V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2m-3 6.42 3 3.01V19c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2v-6.58l3 2.99 4-4 4 4z"})),N=(n,f,{ignoreInitialObserve:l=!1,root:p,rootMargin:d,threshold:u}={})=>{const[y,r]=t.useState(()=>{});return t.useLayoutEffect(()=>{const h=n instanceof HTMLElement?n:n==null?void 0:n.current;if(!h)return()=>{};let c=!0;const o=new IntersectionObserver((...m)=>{if(l&&c){c=!1;return}f(...m)},{root:p,rootMargin:d,threshold:u});return o.observe(h),r(()=>()=>o.disconnect()),()=>o.disconnect()},[n,f,l,p,d,u]),y},Z=({ref:n,...f})=>{const{shouldLoad:l=!0,shouldDecode:p,useFetchApi:d,disableCors:u,ignoreQueue:y,src:r,alt:h,onLoad:c,onError:o,spinnerStyle:{small:m,...v}={},imgStyle:g,hideImgStyle:R,priority:B,retryKeyPrefix:w}=f,{t:H}=$(),E=t.useRef(null),j=!r.length,[I,P]=t.useState(),[k,V]=t.useState(0),[x,z]=t.useState(),[b,D]=t.useState(!1),[F,K]=t.useState(!1),S=(e,i=!1,a=!1)=>{z(e),D(i),i&&!e&&!a&&(o==null||o()),!e&&!i&&!a&&(c==null||c())};return N(E,t.useCallback(e=>K(e[0].isIntersecting),[])),t.useEffect(()=>{if(j||!l||I)return()=>{};let e={response:Promise.resolve(""),cleanup:A,abortRequest:A,fromCache:!1};return(async()=>{try{e=await G.requestImage(r,{priority:B,shouldDecode:p,useFetchApi:d,disableCors:u,ignoreQueue:y}),e.fromCache||S(!0);const a=await e.response;S(!1),P(a)}catch(a){const L=a instanceof Error&&(a.name==="AbortError"||a.message==="Component was unmounted");S(!1,!L,L)}})().catch(()=>{}),()=>{e.cleanup(),e.abortRequest(new Error("Component was unmounted"))}},[r,k,w,j,l]),s.jsxs(s.Fragment,{children:[j?s.jsx(C,{ref:n,sx:{height:"100%",alignItems:"center",justifyContent:"center",background:e=>e.palette.background.default,...v},children:s.jsx(Q,{fontSize:"large"})}):s.jsx(T,{component:"img",sx:[...Array.isArray(g)?g!=null?g:[]:[g],q(!I||x||b,{...R,...q(!R,{display:"none"})})],ref:n,crossOrigin:u?void 0:"anonymous",src:I,alt:h,draggable:!1},"".concat(r,"_").concat(k,"_").concat(w)),(!!x||r&&!I||b)&&s.jsx(C,{ref:E,sx:{height:"100%",justifyContent:"center",alignItems:"center",...v},children:s.jsxs(C,{sx:{height:"100%",alignItems:"center",justifyContent:"center"},children:[F&&!!x&&s.jsx(U,{thickness:5}),b&&x===!1&&s.jsxs(s.Fragment,{children:[s.jsx(J,{}),s.jsx(_,{startIcon:!m&&s.jsx(O,{}),onClick:e=>{e.stopPropagation(),e.preventDefault(),V(i=>(i+1)%100)},size:m?"small":"large",children:m?s.jsx(O,{}):H("global.button.retry")})]})]})})]})};export{Z as S,N as u};
