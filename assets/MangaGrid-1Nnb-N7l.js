import{bA as Te,bB as Ge,e as m,bC as Ee,j as t,aP as Pe,bD as _e,bE as $e,aQ as Le,aN as Be,bF as Oe,Y as Q,bw as Ae,ad as Fe,ao as Ne,ap as me,aq as We,bG as ne,bH as ze,bI as Ue,M as ye,o as F,a4 as He,u as K,W as R,L as X,A as q,D as Ce,i as je,bJ as Ke,f as Ve,ar as Ye,d as re,l as qe,n as Qe,q as Xe,aD as Je,S as U,B as O,m as Ze,a3 as et,C as A,I as tt,ag as nt,ab as ot,O as L,bK as oe,Z as rt,T as we,a2 as st,a5 as it,a as at,b as ct,z as he,g as ke,p as lt,bb as dt,al as ut,bc as ft}from"./index-CCIw14dI.js";import{M as Y,Y as pt}from"./MUI.util-CBC1fb2m.js";import{E as mt}from"./EmptyViewAbsoluteCentered-BYJ_1j9v.js";import{b as ht,c as gt,d as $,C as xt,e as bt,f as yt,D as Ct,R as jt,F as wt,g as ge,a as kt,V as vt,M as Mt}from"./useManageMangaLibraryState-5xywokxs.js";import{D as It}from"./Delete-C7sxCtq4.js";import{D as St}from"./Download-CeGXLsqD.js";import{C as Rt,S as Dt,L as Tt,T as Gt}from"./ChaptersDownloadActionMenuItems-Czz4wFqt.js";import{S as Et}from"./Sync-BDovuK0y.js";import{C as Z}from"./CheckboxInput-D7naHIgO.js";import{F as Pt}from"./FormGroup-Bz-ngFVw.js";import{C as _t}from"./Checkbox-BwKGBKnK.js";import{L as $t}from"./Link-CATq7yuI.js";import{C as ve}from"./Card-cqFx8CyL.js";import{C as Me}from"./CardActionArea-jN0QJyDw.js";import{L as Lt}from"./ListCardAvatar-BIuMB4cn.js";import{L as Bt}from"./ListCardContent-jc_5Ywlc.js";import{P as Ot}from"./PlayArrow-Dg7ZaShp.js";import{D as At}from"./StyledFab-DL8VdI0Z.js";const Ft=(e,n)=>e.filter(o=>n.includes(o)),V=(e,n,o)=>{const i=e.keys[0];Array.isArray(n)?n.forEach((s,r)=>{o((a,u)=>{r<=e.keys.length-1&&(r===0?Object.assign(a,u):a[e.up(e.keys[r])]=u)},s)}):n&&typeof n=="object"?(Object.keys(n).length>e.keys.length?e.keys:Ft(e.keys,Object.keys(n))).forEach(r=>{if(e.keys.includes(r)){const a=n[r];a!==void 0&&o((u,f)=>{i===r?Object.assign(u,f):u[e.up(r)]=f},a)}}):(typeof n=="number"||typeof n=="string")&&o((s,r)=>{Object.assign(s,r)},n)};function ee(e){return"--Grid-".concat(e,"Spacing")}function te(e){return"--Grid-parent-".concat(e,"Spacing")}const xe="--Grid-columns",H="--Grid-parent-columns",Nt=({theme:e,ownerState:n})=>{const o={};return V(e.breakpoints,n.size,(i,s)=>{let r={};s==="grow"&&(r={flexBasis:0,flexGrow:1,maxWidth:"100%"}),s==="auto"&&(r={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof s=="number"&&(r={flexGrow:0,flexBasis:"auto",width:"calc(100% * ".concat(s," / var(").concat(H,") - (var(").concat(H,") - ").concat(s,") * (var(").concat(te("column"),") / var(").concat(H,")))")}),i(o,r)}),o},Wt=({theme:e,ownerState:n})=>{const o={};return V(e.breakpoints,n.offset,(i,s)=>{let r={};s==="auto"&&(r={marginLeft:"auto"}),typeof s=="number"&&(r={marginLeft:s===0?"0px":"calc(100% * ".concat(s," / var(").concat(H,") + var(").concat(te("column"),") * ").concat(s," / var(").concat(H,"))")}),i(o,r)}),o},zt=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={[xe]:12};return V(e.breakpoints,n.columns,(i,s)=>{const r=s!=null?s:12;i(o,{[xe]:r,"> *":{[H]:r}})}),o},Ut=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return V(e.breakpoints,n.rowSpacing,(i,s)=>{var a;const r=typeof s=="string"?s:(a=e.spacing)==null?void 0:a.call(e,s);i(o,{[ee("row")]:r,"> *":{[te("row")]:r}})}),o},Ht=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return V(e.breakpoints,n.columnSpacing,(i,s)=>{var a;const r=typeof s=="string"?s:(a=e.spacing)==null?void 0:a.call(e,s);i(o,{[ee("column")]:r,"> *":{[te("column")]:r}})}),o},Kt=({theme:e,ownerState:n})=>{if(!n.container)return{};const o={};return V(e.breakpoints,n.direction,(i,s)=>{i(o,{flexDirection:s})}),o},Vt=({ownerState:e})=>({minWidth:0,boxSizing:"border-box",...e.container&&{display:"flex",flexWrap:"wrap",...e.wrap&&e.wrap!=="wrap"&&{flexWrap:e.wrap},gap:"var(".concat(ee("row"),") var(").concat(ee("column"),")")}}),Yt=e=>{const n=[];return Object.entries(e).forEach(([o,i])=>{i!==!1&&i!==void 0&&n.push("grid-".concat(o,"-").concat(String(i)))}),n},qt=(e,n="xs")=>{function o(i){return i===void 0?!1:typeof i=="string"&&!Number.isNaN(Number(i))||typeof i=="number"&&i>0}if(o(e))return["spacing-".concat(n,"-").concat(String(e))];if(typeof e=="object"&&!Array.isArray(e)){const i=[];return Object.entries(e).forEach(([s,r])=>{o(r)&&i.push("spacing-".concat(s,"-").concat(String(r)))}),i}return[]},Qt=e=>e===void 0?[]:typeof e=="object"?Object.entries(e).map(([n,o])=>"direction-".concat(n,"-").concat(o)):["direction-xs-".concat(String(e))];function Xt(e,n){e.item!==void 0&&delete e.item,e.zeroMinWidth!==void 0&&delete e.zeroMinWidth,n.keys.forEach(o=>{e[o]!==void 0&&delete e[o]})}const Jt=Oe(),Zt=Te("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,n)=>n.root});function en(e){return $e({props:e,name:"MuiGrid",defaultTheme:Jt})}function tn(e={}){const{createStyledComponent:n=Zt,useThemeProps:o=en,useTheme:i=Ge,componentName:s="MuiGrid"}=e,r=(l,c)=>{const{container:g,direction:p,spacing:x,wrap:h,size:d}=l,b={root:["root",g&&"container",h!=="wrap"&&"wrap-xs-".concat(String(h)),...Qt(p),...Yt(d),...g?qt(x,c.breakpoints.keys[0]):[]]};return Le(b,y=>Be(s,y),{})};function a(l,c,g=()=>!0){const p={};return l===null||(Array.isArray(l)?l.forEach((x,h)=>{x!==null&&g(x)&&c.keys[h]&&(p[c.keys[h]]=x)}):typeof l=="object"?Object.keys(l).forEach(x=>{const h=l[x];h!=null&&g(h)&&(p[x]=h)}):p[c.keys[0]]=l),p}const u=n(zt,Ht,Ut,Nt,Kt,Vt,Wt),f=m.forwardRef(function(c,g){var ie,ae,ce,le,de,ue;const p=i(),x=o(c),h=Ee(x);Xt(h,p.breakpoints);const{className:d,children:b,columns:y=12,container:w=!1,component:M="div",direction:D="row",wrap:j="wrap",size:k={},offset:I={},spacing:T=0,rowSpacing:G=T,columnSpacing:E=T,unstable_level:v=0,...S}=h,P=a(k,p.breakpoints,_=>_!==!1),C=a(I,p.breakpoints),N=(ie=c.columns)!=null?ie:v?void 0:y,B=(ae=c.spacing)!=null?ae:v?void 0:T,W=(le=(ce=c.rowSpacing)!=null?ce:c.spacing)!=null?le:v?void 0:G,J=(ue=(de=c.columnSpacing)!=null?de:c.spacing)!=null?ue:v?void 0:E,z={...h,level:v,columns:N,container:w,direction:D,wrap:j,spacing:B,rowSpacing:W,columnSpacing:J,size:P,offset:C},De=r(z,p);return t.jsx(u,{ref:g,as:M,ownerState:z,className:Pe(De.root,d),...S,children:m.Children.map(b,_=>{var fe,pe;return m.isValidElement(_)&&_e(_,["Grid"])&&w&&_.props.container?m.cloneElement(_,{unstable_level:(pe=(fe=_.props)==null?void 0:fe.unstable_level)!=null?pe:v+1}):_})})});return f.muiName="Grid",f}const se=tn({createStyledComponent:Q("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,n)=>{const{ownerState:o}=e;return[n.root,o.container&&n.container]}}),componentName:"MuiGrid",useThemeProps:e=>Ae({props:e,name:"MuiGrid"}),useTheme:Fe}),nn=m.forwardRef(({MenuItemProps:e,className:n,label:o,LeftIcon:i,renderLabel:s,RightIcon:r,...a},u)=>t.jsxs(Ne,{...e,ref:u,className:n,...a,children:[i&&t.jsx(me,{children:t.jsx(i,{fontSize:"small"})}),t.jsx(We,{children:o}),r&&t.jsx(me,{style:{minWidth:0},children:t.jsx(r,{fontSize:"small"})})]})),Ie=m.forwardRef((e,n)=>{const{parentMenuOpen:o,label:i,renderLabel:s,RightIcon:r=ne(Ue,ze),LeftIcon:a,children:u,className:f,tabIndex:l,ContainerProps:c={},MenuProps:g,...p}=e,x=ye.useIsTouchDevice(),{ref:h,...d}=c,b=m.useRef(null);m.useImperativeHandle(n,()=>b.current);const y=m.useRef(null);m.useImperativeHandle(h,()=>y.current);const w=m.useRef(null),[M,D]=m.useState(!1),j=C=>{if(M!==C){if(e.disabled){D(!1);return}D(C)}},k=C=>{x||(j(!0),d.onMouseEnter&&d.onMouseEnter(C))},I=C=>{j(!1),d.onMouseLeave&&d.onMouseLeave(C)},T=()=>{var N,B;const C=(B=(N=y.current)==null?void 0:N.ownerDocument.activeElement)!=null?B:null;if(w.current==null)return!1;for(const W of w.current.children)if(W===C)return!0;return!1},G=C=>{x||(C.target===y.current&&j(!0),d.onFocus&&d.onFocus(C))},E=C=>{j(!M),d.onClick&&d.onClick(C)},v=C=>{var B,W,J;if(C.key==="Escape")return;T()&&C.stopPropagation();const N=(B=y.current)==null?void 0:B.ownerDocument.activeElement;if(C.key==="ArrowLeft"&&T()&&((W=y.current)==null||W.focus()),C.key==="ArrowRight"&&C.target===y.current&&C.target===N){const z=(J=w.current)==null?void 0:J.children[0];z==null||z.focus()}},S=M&&o;let P;return e.disabled||(P=l!==void 0?l:-1),t.jsxs(F,{...d,ref:y,onFocus:G,onClick:E,tabIndex:P,onMouseEnter:k,onMouseLeave:I,onKeyDown:v,children:[t.jsx(nn,{MenuItemProps:p,className:f,ref:b,LeftIcon:a,RightIcon:r,label:i,renderLabel:s}),t.jsx(He,{style:{pointerEvents:"none"},anchorEl:b.current,anchorOrigin:{horizontal:ne("right","left"),vertical:"top"},transformOrigin:{horizontal:ne("left","right"),vertical:"top"},open:S,autoFocus:!1,disableAutoFocus:!0,disableEnforceFocus:!0,onClose:()=>{j(!1)},...g,children:t.jsx(F,{ref:w,style:{pointerEvents:"auto"},children:u})})]})});Ie.displayName="NestedMenuItem";const on=["remove_from_library"],rn=({manga:e,handleSelection:n,selectedMangas:o,onClose:i,setHideMenu:s})=>{var G,E;const{t:r}=K(),[a,u]=m.useState(!1),f=!!e,l=o!=null?o:[],c=bt(f,Ke),g=gt(f),p=yt(f),x=!!e&&e.downloadCount===e.chapters.totalCount,h=!!(e!=null&&e.downloadCount),d=!!(e!=null&&e.unreadCount),b=!!e&&e.unreadCount!==e.chapters.totalCount,{openCategorySelect:y,CategorySelectComponent:w}=ht({mangaId:e==null?void 0:e.id,mangaIds:o?R.getIds(l):void 0,onClose:()=>i(!0),addToLibrary:!1}),M=()=>{n==null||n(e.id,!0),i(!0)},D=(v,S)=>{R.performAction(v,e?[e.id]:R.getIds(S),{wasManuallyMarkedAsRead:!0}).catch(je()),i(!on.includes(v))},{downloadableMangas:j,downloadedMangas:k,unreadMangas:I,readMangas:T}=m.useMemo(()=>({downloadableMangas:[...R.getNotDownloaded(l),...R.getPartiallyDownloaded(l)],downloadedMangas:[...R.getPartiallyDownloaded(l),...R.getFullyDownloaded(l)],unreadMangas:[...R.getUnread(l),...R.getPartiallyRead(l)],readMangas:[...R.getPartiallyRead(l),...R.getFullyRead(l)]}),[l]);return t.jsxs(t.Fragment,{children:[!!n&&f&&t.jsx($,{onClick:M,Icon:xt,title:r("chapter.action.label.select")}),g(!x)&&t.jsx(Ie,{disabled:p(!j.length),LeftIcon:St,label:c("download",j.length),parentMenuOpen:!0,children:t.jsx(Rt,{mangaIds:f?[e.id]:R.getIds(l),closeMenu:()=>i(!0)})}),g(h)&&t.jsx($,{Icon:It,disabled:p(!k.length),onClick:()=>D("delete",k),title:c("delete",k.length)}),g(d)&&t.jsx($,{Icon:Ct,disabled:p(!I.length),onClick:()=>D("mark_as_read",I),title:c("mark_as_read",I.length)}),g(b)&&t.jsx($,{Icon:jt,disabled:p(!T.length),onClick:()=>D("mark_as_unread",T),title:c("mark_as_unread",T.length)}),f&&t.jsx(X,{to:"".concat(q.migrate.childRoutes.search.path((G=e==null?void 0:e.sourceId)!=null?G:-1,(E=e==null?void 0:e.id)!=null?E:-1),"?query=").concat(e==null?void 0:e.title),state:{mangaTitle:e==null?void 0:e.title},style:{textDecoration:"none",color:"inherit"},children:t.jsx($,{Icon:Dt,title:c("migrate",l.length)})}),f&&t.jsx($,{onClick:()=>{u(!0),s(!0)},Icon:Et,title:c("track",l.length)}),t.jsx($,{onClick:()=>{y(!0),s(!0)},Icon:Tt,title:c("change_categories",l.length)}),t.jsx($,{onClick:()=>D("remove_from_library",l),Icon:wt,title:c("remove_from_library",l.length)}),w,a&&t.jsx(Ce,{open:!0,maxWidth:"md",fullWidth:!0,scroll:"paper",onClose:()=>{u(!1),i(!0)},children:t.jsx(Gt,{manga:e})})]})},sn=({mangaIdToMigrateTo:e,onClose:n})=>{const{t:o}=K(),i=Ve(),{mangaId:s}=Ye(),r=Number(s),{settings:{migrateChapters:a,migrateCategories:u,migrateTracking:f,deleteChapters:l}}=re(),[c,g]=m.useState(!1),p=Xe(je()),x=async h=>{if(r==null)throw new Error('MigrateDialog::migrate: unexpected mangaId "'.concat(r,'"'));Ze(o("migrate.label.info"),"info"),g(!0);try{await R.migrate(r,e,{mode:h,migrateChapters:a,migrateCategories:u,migrateTracking:f,deleteChapters:l}),i(q.manga.path(e),{replace:!0})}catch(d){g(!1)}};return t.jsxs(Ce,{open:!0,fullWidth:!0,onClose:n,children:[t.jsx(qe,{children:o("migrate.dialog.title")}),t.jsx(Qe,{dividers:!0,children:t.jsxs(Pt,{children:[t.jsx(Z,{disabled:c,label:o("chapter.title_one"),checked:a,onChange:(h,d)=>p("migrateChapters",d)}),t.jsx(Z,{disabled:c,label:o("category.title.category_one"),checked:u,onChange:(h,d)=>p("migrateCategories",d)}),t.jsx(Z,{disabled:c,label:o("tracking.title"),checked:f,onChange:(h,d)=>p("migrateTracking",d)}),t.jsx(Z,{disabled:c,label:o("migrate.dialog.label.delete_downloaded"),checked:l,onChange:(h,d)=>p("deleteChapters",d)})]})}),t.jsx(Je,{children:t.jsxs(U,{direction:"row",sx:{justifyContent:"space-between",width:"100%"},children:[t.jsx(O,{disabled:c,component:X,to:q.manga.path(e),children:o("migrate.dialog.action.button.show_entry")}),t.jsxs(U,{direction:"row",children:[t.jsx(O,{disabled:c,onClick:n,children:o("global.button.cancel")}),t.jsx(O,{disabled:c,onClick:()=>x("copy"),children:o("global.button.copy")}),t.jsx(O,{disabled:c,onClick:()=>x("migrate"),children:o("global.button.migrate")})]})]})})]})},Se=m.forwardRef(({id:e,selected:n,handleSelection:o,asCheckbox:i=!1,popupState:s},r)=>{const{t:a}=K(),u=m.useMemo(()=>et(s),[s]),f=g=>{g.stopPropagation(),g.preventDefault()},l=(g,p)=>{f(g),o==null||o(e,p)};return o?n!==null?i?t.jsx(A,{title:a(n?"global.button.deselect":"global.button.select"),children:t.jsx(_t,{...Y.preventRippleProp(),checked:n,onChange:l})}):null:i?t.jsx(A,{title:a("global.button.options"),children:t.jsx(tt,{ref:r,...Y.preventRippleProp(u,{onClick:f}),"aria-label":"more",children:t.jsx(ge,{})})}):t.jsx(A,{title:a("global.button.options"),children:t.jsx(O,{ref:r,...Y.preventRippleProp(u,{onClick:f}),className:"manga-option-button",size:"small",variant:"contained",sx:{minWidth:"unset",paddingX:"0",paddingY:"2.5px",visibility:s.isOpen?"visible":"hidden",pointerEvents:"none","@media not (pointer: fine)":{display:"none"}},children:t.jsx(ge,{})})}):null}),an=Q("div")({position:"absolute",bottom:0,width:"100%",height:"30%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),cn=Q("div")({position:"absolute",bottom:0,width:"100%",height:"20%",background:"linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 100%)"}),ln=m.memo(({manga:e,longPressBind:n,popupState:o,handleClick:i,mangaLinkTo:s,selected:r,inLibraryIndicator:a,isInLibrary:u,gridLayout:f,handleSelection:l,continueReadingButton:c,mangaBadges:g,mode:p})=>{const x=m.useRef(null),{id:h,title:d}=e;return t.jsx($t,{component:X,...n(()=>o.open(x.current)),onClick:i,to:s,state:{mangaTitle:d},sx:{textDecoration:"none",touchCallout:"none"},children:t.jsxs(F,{sx:{display:"flex",flexDirection:"column",m:.25,outline:r?"4px solid":void 0,borderRadius:r?"1px":void 0,outlineColor:b=>b.palette.primary.main,backgroundColor:b=>r?b.palette.primary.main:void 0,"@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:p==="source"?"none":"flex"}}},children:[t.jsx(ve,{sx:{aspectRatio:nt,display:"flex"},children:t.jsxs(Me,{sx:{position:"relative",height:"100%"},children:[t.jsx(ot,{alt:d,src:R.getThumbnailUrl(e),imgStyle:a&&u?{height:"100%",width:"100%",objectFit:"cover",filter:"brightness(0.4)"}:{height:"100%",width:"100%",objectFit:"cover"},spinnerStyle:{display:"grid",placeItems:"center"}}),t.jsxs(U,{direction:"row",sx:{alignItems:"start",justifyContent:"space-between",position:"absolute",top:b=>b.spacing(1),left:b=>b.spacing(1),right:b=>b.spacing(1)},children:[g,t.jsx(Se,{ref:x,popupState:o,id:h,selected:r,handleSelection:l})]}),t.jsxs(t.Fragment,{children:[f!==L.Comfortable&&t.jsxs(t.Fragment,{children:[t.jsx(an,{}),t.jsx(cn,{})]}),t.jsxs(U,{direction:"row",sx:{justifyContent:f!==L.Comfortable?"space-between":"end",alignItems:"end",position:"absolute",bottom:0,width:"100%",p:1,gap:1},children:[f!==L.Comfortable&&t.jsx(A,{title:d,placement:"top",children:t.jsx(oe,{component:"h3",sx:{color:"white",textShadow:"0px 0px 3px #000000"},children:d})}),c]})]})]})}),f===L.Comfortable&&t.jsx(U,{sx:{pb:1},children:t.jsx(A,{title:d,placement:"top",children:t.jsx(oe,{component:"h3",sx:{color:b=>r?b.palette.primary.contrastText:"text.primary",height:"3rem",pt:.5},children:d})})})]})})}),dn=m.memo(({manga:e,longPressBind:n,popupState:o,handleClick:i,mangaLinkTo:s,selected:r,inLibraryIndicator:a,isInLibrary:u,handleSelection:f,continueReadingButton:l,mangaBadges:c,mode:g})=>{const p=m.useRef(null),{id:x,title:h}=e;return t.jsx(ve,{children:t.jsx(Me,{component:X,to:s,state:{mangaTitle:h},onClick:i,...n(()=>o.open(p.current)),sx:{touchCallout:"none","@media (hover: hover) and (pointer: fine)":{"&:hover .manga-option-button":{visibility:"visible",pointerEvents:"all"},"&:hover .source-manga-library-state-button":{display:"inline-flex"},"&:hover .source-manga-library-state-indicator":{display:g==="source"?"none":"inline-flex"}}},children:t.jsxs(Bt,{sx:{justifyContent:"space-between",position:"relative"},children:[t.jsx(Lt,{iconUrl:R.getThumbnailUrl(e),alt:e.title,slots:{spinnerImageProps:{imgStyle:{imageRendering:"pixelated",filter:a&&u?"brightness(0.4)":void 0}}}}),t.jsx(F,{sx:{display:"flex",flexDirection:"row",flexGrow:1,width:"min-content"},children:t.jsx(A,{title:h,placement:"top",children:t.jsx(oe,{variant:"h6",component:"h3",children:h})})}),t.jsxs(U,{direction:"row",sx:{alignItems:"center",gap:.5},children:[c,l,t.jsx(Se,{ref:p,popupState:o,id:x,selected:r,handleSelection:f,asCheckbox:!0})]})]})})})}),un=({showContinueReadingButton:e,chapter:n,mangaLinkTo:o})=>{const{t:i}=K();if(!e||!n)return null;const{sourceOrder:s}=n,r=s===1;return t.jsx(A,{title:i(r?"global.button.start":"global.button.resume"),children:t.jsx(O,{...Y.preventRippleProp(),variant:"contained",size:"small",sx:{minWidth:"unset",py:.5,px:.75},component:X,to:"".concat(o,"/chapter/").concat(n.sourceOrder),state:rt.getReaderOpenChapterLocationState(n),onClick:a=>a.stopPropagation(),children:t.jsx(Ot,{})})})},fn=Q("div")(({theme:e})=>({display:"flex",height:"fit-content",borderRadius:e.shape.borderRadius,overflow:"hidden"})),be=Q(we)(({theme:e})=>({color:e.palette.primary.contrastText,paddingInline:e.spacing(.3)})),pn=({inLibraryIndicator:e,updateLibraryState:n,isInLibrary:o,unread:i,downloadCount:s,mode:r})=>{const{t:a}=K(),u=ye.useIsTouchDevice(),{settings:{showUnreadBadge:f,showDownloadBadge:l}}=re();return t.jsxs(fn,{children:[!u&&e&&r==="source"&&t.jsx(O,{className:"source-manga-library-state-button",component:"div",variant:"contained",size:"small",...Y.preventRippleProp(),onClick:c=>{c.preventDefault(),c.stopPropagation(),n()},sx:{display:"none"},color:o?"error":"primary",children:a(o?"manga.action.library.remove.label.action":"manga.button.add_to_library")}),e&&o&&t.jsx(we,{className:"source-manga-library-state-indicator",sx:{backgroundColor:"primary.dark",color:"primary.contrastText",p:.3},children:a("manga.button.in_library")}),(f&&r==="default"||r==="duplicate")&&(i!=null?i:0)>0&&t.jsx(be,{sx:{backgroundColor:"primary.main",color:"primary.contrastText"},children:i}),(l&&r==="default"||r==="duplicate")&&(s!=null?s:0)>0&&t.jsx(be,{sx:{backgroundColor:"secondary.main",color:"secondary.contrastText"},children:s})]})},mn=(e,n,o,i)=>{switch(e){case"default":case"source":case"duplicate":return q.manga.path(n);case"migrate.search":return"".concat(q.migrate.childRoutes.search.path(o!=null?o:"-1",n),"?query=").concat(i);case"migrate.select":return"";default:throw new Error('getMangaLinkTo: unexpected MangaCardMode "'.concat(e,'"'))}},hn=m.memo(e=>{const{manga:n,gridLayout:o,inLibraryIndicator:i,selected:s,handleSelection:r,mode:a="default"}=e,{id:u,firstUnreadChapter:f,downloadCount:l,unreadCount:c}=n,{settings:{showContinueReadingButton:g}}=re(),{CategorySelectComponent:p,updateLibraryState:x,isInLibrary:h}=kt(n,a==="source"),d=mn(a,n.id,n.sourceId,n.title),[b,y]=m.useState(!1),w=m.useCallback((j,k)=>{const I=a==="default",T=a==="source",G=a==="migrate.select",E=s!==null;if(G||E||(I||T)&&k){if(j.preventDefault(),T){x();return}if(E){r==null||r(u,!s,{selectRange:j.shiftKey});return}if(I){k==null||k();return}G&&y(!0)}},[a,s,x,r]),M=vt(m.useCallback((j,{context:k})=>{j.shiftKey=!0,w(j,k)},[w])),D=m.useMemo(()=>o===L.List?dn:ln,[o]);return t.jsxs(t.Fragment,{children:[b&&t.jsx(sn,{mangaIdToMigrateTo:n.id,onClose:()=>y(!1)}),t.jsx(st,{variant:"popover",popupId:"manga-card-action-menu",children:j=>t.jsxs(t.Fragment,{children:[t.jsx(D,{...e,longPressBind:M,popupState:j,handleClick:w,mangaLinkTo:d,isInLibrary:h,inLibraryIndicator:i,continueReadingButton:t.jsx(un,{showContinueReadingButton:g&&a==="default",chapter:f,mangaLinkTo:d}),mangaBadges:t.jsx(pn,{inLibraryIndicator:i,isInLibrary:h,unread:c,downloadCount:l,updateLibraryState:x,mode:a})}),!!r&&j.isOpen&&t.jsx(Mt,{...it(j),children:(k,I)=>t.jsx(rn,{manga:n,handleSelection:r,onClose:k,setHideMenu:I})}),p]})})]})}),gn=ut.forwardRef(({children:e,...n},o)=>t.jsx(se,{...n,ref:o,container:!0,spacing:1,children:e})),xn=(e,n,o,i=12)=>{const s=Math.ceil(e/n),r=o===L.List?i:i/s;return({children:a,...u})=>t.jsx(se,{...u,size:r,children:a})},Re=(e,n,o,i=!1,s,r,a)=>t.jsx(hn,{manga:e,gridLayout:n,inLibraryIndicator:o,selected:i?s==null?void 0:s.includes(e.id):null,handleSelection:r,mode:a}),bn=m.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:i,gridLayout:s,isSelectModeActive:r,selectedMangaIds:a,handleSelection:u,mode:f},l)=>t.jsx(se,{ref:l,container:!0,spacing:1,sx:{width:"100%",overflowX:"auto",display:"-webkit-inline-box",flexWrap:"nowrap"},children:e?t.jsx(ke,{}):n.map(c=>t.jsx(i,{children:Re(c,s,o,r,a,u,f)},c.id))})),yn=e=>"MangaGrid-snapshot-location-".concat(e.key),Cn=m.forwardRef(({isLoading:e,mangas:n,inLibraryIndicator:o,GridItemContainer:i,gridLayout:s,hasNextPage:r,loadMore:a,isSelectModeActive:u,selectedMangaIds:f,handleSelection:l,mode:c},g)=>{const p=lt(),x=yn(p),[h]=dt(x,void 0),d=m.useRef(void 0),b=y=>{const w=window.location.href;clearTimeout(d.current),d.current=setTimeout(()=>{w===window.location.href&&ft.session.setItem(x,y,!1)},250)};return m.useEffect(()=>clearTimeout(d.current),[p.key,d.current]),t.jsxs(t.Fragment,{children:[t.jsx(F,{ref:g,children:t.jsx(pt,{useWindowScroll:!0,increaseViewportBy:window.innerHeight*.5,totalCount:n.length,components:{List:gn,Item:i},restoreStateFrom:h,stateChanged:b,endReached:()=>a(),computeItemKey:y=>n[y].id,itemContent:y=>Re(n[y],s,o,u,f,l,c)})}),u&&s===L.List?t.jsx(F,{sx:{paddingBottom:At}}):e?t.jsx(ke,{}):r?t.jsx("div",{style:{height:"75px"}}):null]})}),An=({mangas:e,isLoading:n,message:o,messageExtra:i,hasNextPage:s,loadMore:r,gridLayout:a,horizontal:u,noFaces:f,inLibraryIndicator:l,isSelectModeActive:c,selectedMangaIds:g,handleSelection:p,mode:x,retry:h,gridWrapperProps:d})=>{var G,E;const{t:b}=K(),{navBarWidth:y}=at(),w=m.useRef(null),M=m.useRef(null),[D,j]=m.useState((E=(G=M.current)==null?void 0:G.offsetWidth)!=null?E:Math.max(0,document.documentElement.offsetWidth-y)),[k]=ct("ItemWidth",300),I=m.useMemo(()=>xn(D,k,a),[D,k,a]);return m.useLayoutEffect(()=>{if(u)return()=>{};let v;const S=P=>{v=setTimeout(()=>{if(document.body.style.overflow.includes("hidden")){S(250);return}document.body.style.overflowY=a===L.List?"auto":"scroll"},P)};return S(0),()=>{clearTimeout(v)}},[a]),m.useLayoutEffect(()=>()=>{u||(document.body.style.overflowY="auto")},[]),he(M,m.useCallback(()=>{j((()=>{var P;const S=(P=M.current)==null?void 0:P.offsetWidth;return S||document.documentElement.offsetWidth-y})())},[y])),he(w,m.useCallback((v,S)=>{const P=v[0].target.clientHeight,C=P>document.documentElement.clientHeight;if(!n&&P){if(C){S.disconnect();return}r(),S.disconnect()}},[w,r,n])),!n&&e.length===0?t.jsx(mt,{noFaces:f,message:o!=null?o:b("manga.error.label.no_mangas_found"),messageExtra:i,retry:h}):t.jsx(F,{...d,ref:M,sx:{...d==null?void 0:d.sx,overflow:"hidden"},children:u?t.jsx(bn,{ref:w,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:I,gridLayout:a,isSelectModeActive:c,selectedMangaIds:g,handleSelection:p,mode:x}):t.jsx(Cn,{ref:w,isLoading:n,mangas:e,inLibraryIndicator:l,GridItemContainer:I,hasNextPage:s,loadMore:r,gridLayout:a,isSelectModeActive:c,selectedMangaIds:g,handleSelection:p,mode:x})})};export{An as M,rn as a,hn as b,yn as g};
