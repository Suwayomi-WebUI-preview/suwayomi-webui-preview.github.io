import{c as M,j as e,u as S,r as K,a9 as W,d as q,e as _,_ as i,db as Y,i as J,ae as Q,a5 as X,S as w,am as f,L as Z,dY as ee,C as z,I as te,a3 as ae,a7 as re,p as E,T as oe,B as se}from"./index-YZjYIyFe.js";import{c as ne,d as u,C as le,e as ie,f as de,D as ce,R as me,V as pe,g as he,M as xe}from"./useManageMangaLibraryState-DvURRXnk.js";import{C as ue,D as ke}from"./ChapterCardMetadata-C0QrNIPV.js";import{D as ge}from"./Delete-BJF6sdMK.js";import{D as Ce}from"./Download-jv4FcZMx.js";import{D as be}from"./DoneAll-CSBqzoks.js";import{M as fe}from"./index-DJkOhQQr.js";import{L as Ie}from"./ListCardContent-D-agXhNa.js";import{C as je}from"./Card-BH9uP2SM.js";import{C as ye}from"./CardActionArea-B-tf_p4o.js";import{C as De}from"./Checkbox-Dgmui1oJ.js";const _e=M(e.jsx("path",{d:"M21 7h-6V5h6zm-2 3.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v16l7-3 7 3z"})),we=M(e.jsx("path",{d:"M21 7h-2v2h-2V7h-2V5h2V3h2v2h2zm-2 14-7-3-7 3V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"})),Me=M(e.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),Te=({chapter:t,handleSelection:s,canBeDownloaded:o=!1,selectedChapters:d=[],onClose:n,selectable:r=!0})=>{var P,V,L;const{t:g}=S(),c=!!t,{isDownloaded:p,isRead:C,isBookmarked:m}=t!=null?t:{},I=(L=(V=K.useGetMangaChapters(W,(P=t==null?void 0:t.mangaId)!=null?P:-1,{skip:!t,fetchPolicy:"cache-only"}).data)==null?void 0:V.chapters.nodes)!=null?L:[],{settings:{deleteChaptersWithBookmark:j}}=q(),h=ie(c,Y),k=ne(c),a=de(c),{downloadableChapters:l,downloadedChapters:x,unbookmarkedChapters:T,bookmarkedChapters:R,unreadChapters:v,readChapters:B}=_.useMemo(()=>({downloadableChapters:i.getDownloadable(d),downloadedChapters:i.getDownloaded(d),unbookmarkedChapters:i.getNonBookmarked(d),bookmarkedChapters:i.getBookmarked(d),unreadChapters:i.getNonRead(d),readChapters:i.getRead(d)}),[d]),U=()=>{s==null||s(t.id,!0),n()},b=(N,$)=>{var O;const G=N==="mark_prev_as_read",H=G?"mark_as_read":N;if(H==="delete"&&t&&!i.isDeletable(t,j)){n();return}const D=(()=>{if(!t)return $;if(!G)return[t];const A=I.findIndex(({id:F})=>F===t.id);return A+1>I.length-1?[]:I.slice(A+1)})();if(!D.length){n();return}i.performAction(H,i.getIds(D),{chapters:D,wasManuallyMarkedAsRead:!0,trackProgressMangaId:(O=D[0])==null?void 0:O.mangaId}).catch(J()),n()};return e.jsxs(e.Fragment,{children:[c&&r&&e.jsx(u,{onClick:U,Icon:le,title:g("chapter.action.label.select")}),c&&e.jsx(u,{Icon:Me,disabled:!t.realUrl,onClick:()=>{window.open(t.realUrl,"_blank","noopener,noreferrer"),n()},title:g("chapter.action.label.open_on_source")}),k(o)&&e.jsx(u,{Icon:Ce,disabled:a(!l.length),onClick:()=>b("download",l),title:h("download",l.length)}),k(p)&&e.jsx(u,{Icon:ge,disabled:a(!x.length),onClick:()=>b("delete",i.getDeletable(x,j)),title:h("delete",x.length)}),k(!m)&&e.jsx(u,{Icon:we,disabled:a(!T.length),onClick:()=>b("bookmark",T),title:h("bookmark",T.length)}),k(m)&&e.jsx(u,{Icon:_e,disabled:a(!R.length),onClick:()=>b("unbookmark",R),title:h("unbookmark",R.length)}),k(!C)&&e.jsx(u,{Icon:ce,disabled:a(!v.length),onClick:()=>b("mark_as_read",v),title:h("mark_as_read",v.length)}),k(C)&&e.jsx(u,{Icon:me,disabled:a(!B.length),onClick:()=>b("mark_as_unread",B),title:h("mark_as_unread",B.length)}),c&&e.jsx(u,{onClick:()=>b("mark_prev_as_read",[]),Icon:be,title:g("chapter.action.mark_as_read.add.label.action.previous")})]})},Re=M(e.jsx("path",{d:"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2"})),ve=_.memo(t=>{const{t:s}=S(),o=Q(),d=_.useRef(null),{mode:n="manga.page",chapter:r,showChapterNumber:g,onSelect:c,selected:p,selectable:C=!0,isActiveChapter:m=!1}=t,y=p!==null,{isDownloaded:I}=r,j=a=>{y&&(a.preventDefault(),a.stopPropagation(),c(r.id,!p,a.shiftKey))},h=(a,l)=>{a.stopPropagation(),a.preventDefault(),l==null||l(a)},k=pe((a,{context:l})=>{if(!y&&d.current){h(a,()=>l==null?void 0:l(d.current));return}a.shiftKey=!0,j(a)});return e.jsx(X,{variant:"popover",popupId:"chapter-card-action-menu",children:a=>{var l;return e.jsxs(w,{sx:{pt:1,px:1},children:[e.jsx(je,{sx:{...f(n==="reader"&&m,{backgroundColor:"primary.main"})},children:e.jsx(ye,{component:Z,to:i.getReaderUrl(r),style:{color:o.palette.text[r.isRead?"disabled":"primary"],userSelect:"none"},state:i.getReaderOpenChapterLocationState(r,!0),replace:n==="reader",onClick:x=>j(x),...k(a.open),children:e.jsxs(Ie,{children:[e.jsx(ue,{title:g?"".concat(s("chapter.title_one")," ").concat(r.chapterNumber):r.name,secondaryText:r.scanlator,ternaryText:"".concat(ee(Number((l=r.uploadDate)!=null?l:0),!0)).concat(I?" â€¢ ".concat(s("chapter.status.label.downloaded")):""),infoIcons:r.isBookmarked&&e.jsx(Re,{color:n==="reader"&&m?"secondary":"primary"}),slotProps:{title:{variant:"h6",component:"h3",sx:f(n==="reader"&&m,{color:o.palette.primary.contrastText})},secondaryText:{sx:f(n==="reader"&&m,{color:o.palette.primary.contrastText})},ternaryText:{sx:f(n==="reader"&&m,{color:o.palette.primary.contrastText})}}}),e.jsx(ke,{chapterId:r.id,color:n==="reader"&&m?o.palette.primary.contrastText:void 0}),e.jsx(w,{sx:{minHeight:"48px"},children:p===null?e.jsx(z,{title:s("global.button.options"),children:e.jsx(te,{ref:d,...fe.preventRippleProp(ae(a),{onClick:x=>h(x)}),"aria-label":"more",sx:{color:"inherit",...f(n==="reader"&&m,{color:"primary.contrastText"})},children:e.jsx(he,{})})}):e.jsx(z,{title:s(p?"global.button.deselect":"global.button.select"),children:e.jsx(De,{checked:p})})})]})})}),!y&&a.isOpen&&e.jsx(xe,{...re(a),children:x=>e.jsx(Te,{onClose:x,chapter:r,handleSelection:()=>c(r.id,!0),canBeDownloaded:i.isDownloadable(r),selectable:C})})]})}})}),Be=({missingChaptersGap:t})=>{const{t:s}=S();return e.jsxs(w,{sx:{width:"100%",flexDirection:"row",justifyContent:"center",alignItems:"center",p:2,pt:3.5,pb:2.5},children:[e.jsx(E,{sx:{flexGrow:1,border:"1px solid",borderColor:o=>o.palette.text.secondary}}),e.jsx(oe,{sx:{px:2},variant:"body2",color:"textSecondary",children:s("chapter.missing",{count:t})}),e.jsx(E,{sx:{flexGrow:1,border:"1px solid",borderColor:o=>o.palette.text.secondary}})]})},Fe=({index:t,isSortDesc:s,chapters:o,...d})=>{var C;const n=s?t+1:t-1,r=o[t],g=(C=o[n])!=null?C:{chapterNumber:0},c=i.getGap(r,g),p=c>0;return e.jsxs(w,{sx:f(!s,{flexDirection:"column-reverse"}),children:[e.jsx(ve,{...d,chapter:o[t]}),p&&e.jsx(Be,{missingChaptersGap:c})]})},Ke=_.forwardRef(({children:t,...s},o)=>e.jsx(se,{ref:o,...s,sx:{minWidth:"unset",px:"10px",...s.sx},children:t}));export{Re as B,Fe as C,Me as L,Te as a,Ke as b};
