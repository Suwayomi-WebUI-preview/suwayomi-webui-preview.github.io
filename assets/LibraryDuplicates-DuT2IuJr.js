import{u as v,d as b,y as f,c as a,N as B,j as t,P as E,I as S,K as A,bh as _,V as D,O as F,a2 as P,a as N,bB as V,g as w,h as K,B as U}from"./index-BLgYiawO.js";import{G as W}from"./GridLayouts-ZrJa2kvp.js";import{C as H}from"./CheckboxInput-Bmcx3LoB.js";import{E as O}from"./EmptyViewAbsoluteCentered-DdVIYYLb.js";import{b as R}from"./MangaGrid-CBCABCYr.js";import{V as $,S as q,a as C,b as z}from"./Virtuoso.util-CuAimmpM.js";import{B as J}from"./BaseMangaGrid-B9-u6g0Q.js";import"./Checkbox-C2R3MqBz.js";import"./TextField-DjPg3JDd.js";import"./SwitchBase-C5DQKxRJ.js";import"./ListPreference-Df7TMBpU.js";import"./index-DxfBLnT1.js";import"./useManageMangaLibraryState-vuUZRzEt.js";import"./Trackers-D4pSmk7a.js";import"./Card-qMlyKuip.js";import"./CardContent-CSR8wzft.js";import"./Avatar-CoCpqgd0.js";import"./Info-lIpiSW30.js";import"./InputAdornment-D0Kz6aT1.js";import"./CheckCircle-DFAyKAc3.js";import"./SpinnerImage-BKahaNo_.js";import"./Refresh-n1UR1Umw.js";import"./TypographyMaxLines-DgqbLyXa.js";import"./Mangas-BNy2IDHP.js";import"./Chapters-Dg3CQzep.js";import"./CardActionArea-CzxepwG4.js";import"./Collapse-barFscOo.js";import"./Link-DGgLj-kO.js";import"./NumberSetting-Cy_AuEb1.js";import"./useMobilePicker-CYQOQmND.js";import"./Chip-C0edXhid.js";import"./SelectSetting-FKar5L0O.js";import"./Select-O-0yV8lJ.js";import"./ThreeStateCheckboxInput-CWoMaR0c.js";import"./Delete-yg-QzkHg.js";import"./Download-CekKEQTg.js";import"./Sync-CTViG22A.js";import"./PlayArrow-qrxQsm6h.js";import"./StyledFab-Bn_g68I2.js";const Fe=()=>{const{t:l}=v(),[n,j]=b("libraryDuplicatesGridLayout",f.List),[m,L]=b("libraryDuplicatesCheckAlternativeTitles",!1),{setTitle:c,setAction:d}=a.useContext(B);a.useLayoutEffect(()=>(c(l("library.settings.advanced.duplicates.label.title")),d(t.jsxs(t.Fragment,{children:[t.jsx(W,{gridLayout:n,onChange:j}),t.jsx(E,{variant:"popover",popupId:"library-dupliactes-settings",children:e=>t.jsxs(t.Fragment,{children:[t.jsx(S,{...A(e),color:"inherit",children:t.jsx(_,{})}),t.jsx(D,{...F(e),children:t.jsx(P,{children:t.jsx(H,{label:l("library.settings.advanced.duplicates.settings.label.check_description"),checked:m,onChange:(r,p)=>L(p)})})})]})})]})),()=>{c(""),d(null)}),[l,n,m]);const{data:i,loading:M,error:g,refetch:k}=N.useGetMangas(V,{condition:{inLibrary:!0}}),[G,h]=a.useState(!0),[o,y]=a.useState({});a.useEffect(()=>{var p;h(!0);const e=(p=i==null?void 0:i.mangas.nodes)!=null?p:[];if(!e.length)return y({}),()=>{};const r=new Worker(new URL("/assets/LibraryDuplicatesWorker-CoLlk4gN.js",import.meta.url),{type:"module"});return r.onmessage=T=>{y(T.data),h(!1)},r.postMessage({mangas:e,checkAlternativeTitles:m}),()=>r.terminate()},[i==null?void 0:i.mangas.nodes,m]);const s=a.useMemo(()=>Object.keys(o).toSorted((e,r)=>e.localeCompare(r)),[o]),u=a.useMemo(()=>s.map(e=>o[e]).flat(),[o]),x=a.useMemo(()=>s.map(e=>o[e]).map(e=>e.length),[o]),I=$.useCreateGroupedComputeItemKey(x,a.useCallback(e=>s[e],[s]),a.useCallback((e,r)=>"".concat(s[r],"-").concat(u[e].id,"}"),[s,u]));return M||G?t.jsx(w,{}):g?t.jsx(O,{message:l("global.error.label.failed_to_load_data"),messageExtra:g.message,retry:()=>k().catch(K())}):n===f.List?t.jsx(q,{groupCounts:x,groupContent:e=>t.jsx(C,{variant:"h5",isFirstItem:e===0,children:s[e]}),computeItemKey:I,itemContent:e=>t.jsx(z,{children:t.jsx(R,{manga:u[e],gridLayout:n,selected:null,mode:"duplicate"})})}):s.map((e,r)=>t.jsxs(U,{children:[t.jsx(C,{sx:{pt:r===0?void 0:0,pb:0},variant:"h5",isFirstItem:!1,children:e}),t.jsx(J,{mangas:o[e],hasNextPage:!1,loadMore:()=>{},isLoading:!1,gridLayout:n,inLibraryIndicator:!1,horizontal:!0,mode:"duplicate"})]},e))};export{Fe as LibraryDuplicates};
